[{"content":"é€šå¸¸æ¥è¯´ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨æŸä¸ªå…·ä½“çš„å¯¹è±¡ï¼ˆstructï¼‰æ¥ä½œä¸ºreceiverå®ç°æ¥å£ï¼Œä½†æœ‰æ—¶å€™ï¼Œä½¿ç”¨å‡½æ•°ä½œä¸ºreceiverå¯ä»¥èµ·åˆ°ä¸ä¸€æ ·çš„æ•ˆæœã€‚\nä½¿ç”¨å‡½æ•°ä½œä¸ºreceiverä¸€ä¸ªæœ€å¸¸è§çš„ä¾‹å­æ˜¯HandleFunc:\ntype HandlerFunc func(ResponseWriter, *Request) func (f HandlerFunc) ServeHTTP(w ResponseWriter, r *Request) { f(w, r) } è¿™é‡Œå°†HandleFuncä½œä¸ºæ¥æ”¶å™¨ï¼Œå®ç°äº†ServeHTTPæ–¹æ³•ï¼ŒåŒæ—¶ä¹Ÿå®ç°äº†http.Handleræ¥å£\ntype Handler interface { ServeHTTP(ResponseWriter, *Request) } ä»£ç æ³¨é‡Šä¸­å¯¹ä¸HandleFuncçš„è§£é‡Šå¦‚ä¸‹ï¼š\n// The HandlerFunc type is an adapter to allow the use of // ordinary functions as HTTP handlers. If f is a function // with the appropriate signature, HandlerFunc(f) is a // Handler that calls f. HandleFuncçš„å®šä½æ˜¯ï¼šé€‚é…å™¨ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´ï¼Ÿæœ‰äº†è¿™ä¸ªé€‚é…å™¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿™æ ·å®Œæˆä¸€ä¸ªhttp serverï¼š\nfunc main() { http.HandleFunc(\u0026#34;/echo\u0026#34;, func(w http.ResponseWriter, r *http.Request) { // do something  }) http.ListenAndServe(\u0026#34;:8888\u0026#34;, nil) } è¿™é‡Œæˆ‘ä»¬ç®€å•çš„å°†ä¸€ä¸ªå‡½æ•°ä½œä¸ºå®å‚ä¼ å…¥äº†http.HandleFuncï¼Œhttp.HandleFuncåº•å±‚è°ƒç”¨äº†mux.Handleè¿›è¡Œæ³¨å†Œï¼Œmux.Handleå‡½æ•°ç­¾åå¦‚ä¸‹ï¼š\nfunc (mux *ServeMux) Handle(pattern string, handler Handler) è¿™é‡Œçš„Handlerï¼Œå°±æ˜¯ä¸Šé¢æåˆ°çš„http.Handleræ¥å£ã€‚ä¸­é—´å‘ç”Ÿäº†ä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆä¸€ä¸ªå‡½æ•°çªç„¶å˜æˆäº†ä¸€ä¸ªæ¥å£å¯¹è±¡ï¼Œä»ä¸€ä¸ªè¢«å®šä¹‰çš„è¡Œä¸ºï¼Œå˜æˆäº†ä¸€ä¸ªæ‰§è¡ŒæŸç§åŠ¨ä½œçš„å¯¹è±¡ã€‚é­”æ³•å‘ç”Ÿåœ¨mux.HandleFuncï¼š\nfunc (mux *ServeMux) HandleFunc(pattern string, handler func(ResponseWriter, *Request)) { if handler == nil { panic(\u0026#34;http: nil handler\u0026#34;) } mux.Handle(pattern, HandlerFunc(handler)) // è¿™é‡Œè¿›è¡Œäº†ç±»å‹çš„è½¬åŒ– } ç»è¿‡ä¸€ä¸ªç±»å‹è½¬æ¢ï¼Œä¸€ä¸ªä¸å…·åå‡½æ•°ç±»å‹ï¼Œå˜æˆäº†ä¸€ä¸ªå…·åå‡½æ•°ç±»å‹HandlerFuncã€‚ç„¶ååœ¨ä»£ç çš„è°ƒç”¨é“¾ä¸­ï¼Œæœ€ç»ˆåˆè°ƒç”¨äº†è¿™ä¸ªå…·åå‡½æ•°ç±»å‹çš„ServerHTTPæ–¹æ³•ï¼Œè¿™ä¸ªServerHTTPæ–¹æ³•å†…éƒ¨åˆæ˜¯è°ƒç”¨çš„è¿™ä¸ªå‡½æ•°æœ¬èº«ã€‚\nfunc (sh serverHandler) ServeHTTP(rw ResponseWriter, req *Request) { // ...  handler.ServeHTTP(rw, req) // è¿™é‡Œçš„handleå°±æ˜¯æˆ‘ä»¬ä¼ å…¥çš„ä¸å…·åå‡½æ•°å¯¹è±¡è½¬åŒ–è€Œæ¥çš„å…·åå‡½æ•°å¯¹è±¡ } é‚£ä¹ˆï¼Œå¦‚æœæ²¡æœ‰HandleFuncé€‚é…å™¨ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ\nfunc (mux *ServeMux) Handle(pattern string, handler Handler) è¿™ä¸ªå‡½æ•°çš„ç¬¬äºŒä¸ªå½¢å‚æ˜¯ä¸€ä¸ªæ¥å£ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªæ¥å£çš„å…·ä½“å®ç°ï¼Œæ¥å£çš„å…·ä½“å®ç°éœ€è¦ä¸€ä¸ªreceiverï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªreceiverï¼Œï¼Œä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå®šä¹‰ä¸€ä¸ªç©ºstructï¼Œå¹¶è®©ä»–æ¥å®ç°ServeHTTP(ResponseWriter, *Request)æ–¹æ³•ï¼ˆæˆä¸ºHandleræ¥å£å¯¹è±¡ï¼‰\ntype HandlerReceiver struct { } func (h HandlerReceiver) ServeHTTP(w http.ResponseWriter, r *http.Request) { // ... } è¿™ä¸ªæˆ‘ä»¬å®ç°ä¸€ä¸ªæ¥å£handlerçš„è¿‡ç¨‹ï¼Œå¦‚æœæœ‰å¤šä¸ªhandlerå‘¢ï¼Œä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œä¸Šç™¾ä¸ªæ¥å£æ€»æ˜¯æœ‰çš„ï¼Œéš¾é“æˆ‘ä»¬éœ€è¦å®šä¹‰ä¸Šç™¾ä¸ªç”šè‡³æ›´å¤šç©ºçš„ã€æ— æ„ä¹‰çš„structæ¥å®Œæˆè¿™ä¸ªé€‚é…ï¼Ÿ\nFunction As Method Receiverè¿˜èƒ½åšä»€ä¹ˆï¼ŸTODO\n","permalink":"http://yangchnet.github.io/Dessert/posts/golang/function-as-a-method-receiver/","summary":"é€šå¸¸æ¥è¯´ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨æŸä¸ªå…·ä½“çš„å¯¹è±¡ï¼ˆstructï¼‰æ¥ä½œä¸ºreceiverå®ç°æ¥å£ï¼Œä½†æœ‰æ—¶å€™ï¼Œä½¿ç”¨å‡½æ•°ä½œä¸ºreceiverå¯ä»¥èµ·åˆ°ä¸ä¸€æ ·çš„æ•ˆæœã€‚\nä½¿ç”¨å‡½æ•°ä½œä¸ºreceiverä¸€ä¸ªæœ€å¸¸è§çš„ä¾‹å­æ˜¯HandleFunc:\ntype HandlerFunc func(ResponseWriter, *Request) func (f HandlerFunc) ServeHTTP(w ResponseWriter, r *Request) { f(w, r) } è¿™é‡Œå°†HandleFuncä½œä¸ºæ¥æ”¶å™¨ï¼Œå®ç°äº†ServeHTTPæ–¹æ³•ï¼ŒåŒæ—¶ä¹Ÿå®ç°äº†http.Handleræ¥å£\ntype Handler interface { ServeHTTP(ResponseWriter, *Request) } ä»£ç æ³¨é‡Šä¸­å¯¹ä¸HandleFuncçš„è§£é‡Šå¦‚ä¸‹ï¼š\n// The HandlerFunc type is an adapter to allow the use of // ordinary functions as HTTP handlers. If f is a function // with the appropriate signature, HandlerFunc(f) is a // Handler that calls f. HandleFuncçš„å®šä½æ˜¯ï¼šé€‚é…å™¨ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´ï¼Ÿæœ‰äº†è¿™ä¸ªé€‚é…å™¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿™æ ·å®Œæˆä¸€ä¸ªhttp serverï¼š\nfunc main() { http.HandleFunc(\u0026#34;/echo\u0026#34;, func(w http.ResponseWriter, r *http.","title":"Function as a Method Receiver"},{"content":"ncï¼š ä»»æ„çš„TCP/UDPè¿æ¥å’Œç›‘å¬\nIt can open TCP connections, send UDP packets, listen on arbitrary TCP and UDP ports, do port scanning, and deal with both IPv4 and IPv6.\nä½¿ç”¨case  å¿«é€Ÿåˆ›å»ºclient/serverå¯¹  nc -l 1234 nc 127.0.0.1 1234 ä»»ä½•åœ¨clientç«¯çš„è¾“å‡ºéƒ½å°†åœ¨serverç«¯æ˜¾ç¤º\nç«¯å£æ‰«æ  nc -zv 127.0.0.1 8885-8889 å…¶ä»–ä¾‹å­  nc -p 31337 -w 5 abc.com 42 nc -u abc.com 53 nc -s 10.1.2.3 abc.com 42 nc -lU /var/tmp/dsocket ","permalink":"http://yangchnet.github.io/Dessert/posts/linux/linux%E5%91%BD%E4%BB%A4%E4%B9%8Bnc/","summary":"ncï¼š ä»»æ„çš„TCP/UDPè¿æ¥å’Œç›‘å¬\nIt can open TCP connections, send UDP packets, listen on arbitrary TCP and UDP ports, do port scanning, and deal with both IPv4 and IPv6.\nä½¿ç”¨case  å¿«é€Ÿåˆ›å»ºclient/serverå¯¹  nc -l 1234 nc 127.0.0.1 1234 ä»»ä½•åœ¨clientç«¯çš„è¾“å‡ºéƒ½å°†åœ¨serverç«¯æ˜¾ç¤º\nç«¯å£æ‰«æ  nc -zv 127.0.0.1 8885-8889 å…¶ä»–ä¾‹å­  nc -p 31337 -w 5 abc.com 42 nc -u abc.com 53 nc -s 10.1.2.3 abc.com 42 nc -lU /var/tmp/dsocket ","title":"Linuxå‘½ä»¤ä¹‹nc"},{"content":"è¦åˆ›å»ºä¸€ä¸ªæ–°çš„ Linux æ–‡ä»¶ç³»ç»Ÿåˆ†åŒºå¹¶è¿›è¡ŒæŒ‚è½½ï¼Œæ‚¨å¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œæ“ä½œï¼š\n é¦–å…ˆï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä¹‹ä¸€æ¥æŸ¥çœ‹ç³»ç»Ÿä¸­å·²è¿æ¥çš„ç£ç›˜å’Œåˆ†åŒºï¼š  sudo fdisk -l æˆ–è€…\nsudo lsblk è¿™å°†æ˜¾ç¤ºç³»ç»Ÿä¸­çš„ç£ç›˜å’Œåˆ†åŒºåˆ—è¡¨ã€‚æ‰¾åˆ°æ‚¨è¦åˆ›å»ºåˆ†åŒºçš„ç£ç›˜ã€‚\nä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ‰“å¼€ç£ç›˜åˆ†åŒºå·¥å…·ï¼ˆä¾‹å¦‚ fdiskï¼‰ï¼š  sudo fdisk /dev/\u0026lt;disk_name\u0026gt; å°† \u0026lt;disk_name\u0026gt; æ›¿æ¢ä¸ºæ‚¨è¦åˆ›å»ºåˆ†åŒºçš„ç£ç›˜çš„åç§°ï¼Œä¾‹å¦‚ /dev/sdaã€‚\nåœ¨ç£ç›˜åˆ†åŒºå·¥å…·ä¸­ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»ºæ–°çš„åˆ†åŒºï¼š  n ç„¶åæŒ‰ç…§æç¤ºé€‰æ‹©åˆ†åŒºç±»å‹ã€èµ·å§‹æ‰‡åŒºå’Œç»“æŸæ‰‡åŒºã€‚å¯¹äº Linux æ–‡ä»¶ç³»ç»Ÿï¼Œé€šå¸¸é€‰æ‹©é»˜è®¤é€‰é¡¹å³å¯ã€‚\nè®¾ç½®åˆ†åŒºçš„æ–‡ä»¶ç³»ç»Ÿç±»å‹ä¸º Linuxã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š  t ç„¶åé€‰æ‹©æ–°åˆ›å»ºçš„åˆ†åŒºç¼–å·ï¼Œå¹¶é€‰æ‹© Linux æ–‡ä»¶ç³»ç»Ÿç±»å‹ï¼ˆä¾‹å¦‚ 83ï¼‰ã€‚\nä¿å­˜å¹¶é€€å‡ºç£ç›˜åˆ†åŒºå·¥å…·ã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š  w ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿï¼š  sudo mkfs.ext4 /dev/\u0026lt;partition\u0026gt; å°† æ›¿æ¢ä¸ºæ‚¨åˆšåˆšåˆ›å»ºçš„åˆ†åŒºè®¾å¤‡åç§°ï¼Œä¾‹å¦‚ /dev/sda1ã€‚\nåˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œç”¨äºæŒ‚è½½æ–‡ä»¶ç³»ç»Ÿã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š  sudo mkdir /mnt/\u0026lt;mount_point\u0026gt; å°† \u0026lt;mount_point\u0026gt; æ›¿æ¢ä¸ºæ‚¨å¸Œæœ›æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿçš„ç›®å½•è·¯å¾„ã€‚\nä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†æ–‡ä»¶ç³»ç»ŸæŒ‚è½½åˆ°ç›®æ ‡ç›®å½•ï¼š  sudo mount /dev/\u0026lt;partition\u0026gt; /mnt/\u0026lt;mount_point\u0026gt; å°† æ›¿æ¢ä¸ºæ‚¨åˆšåˆšåˆ›å»ºçš„åˆ†åŒºè®¾å¤‡åç§°ï¼Œ\u0026lt;mount_point\u0026gt; æ›¿æ¢ä¸ºæ‚¨åœ¨ç¬¬ 7 æ­¥ä¸­åˆ›å»ºçš„ç›®å½•è·¯å¾„ã€‚\næŒ‚è½½æˆåŠŸåï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥éªŒè¯æ–‡ä»¶ç³»ç»Ÿæ˜¯å¦å·²æŒ‚è½½ï¼š  df -h è¿™å°†æ˜¾ç¤ºå·²æŒ‚è½½çš„æ–‡ä»¶ç³»ç»Ÿåˆ—è¡¨ï¼ŒåŒ…æ‹¬æŒ‚è½½ç‚¹å’Œå¯ç”¨ç©ºé—´ã€‚\nå¦‚æœå¸Œæœ›åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿï¼Œæ‚¨å¯ä»¥å°†å…¶æ·»åŠ åˆ° /etc/fstab æ–‡ä»¶ä¸­ã€‚æ‰“å¼€ /etc/fstab æ–‡ä»¶ï¼Œå¹¶åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ ä»¥ä¸‹è¡Œï¼š  /dev/\u0026lt;partition\u0026gt; /mnt/\u0026lt;mount_point\u0026gt; ext4 defaults 0 0 å°† æ›¿æ¢ä¸ºæ‚¨åˆšåˆšåˆ›å»ºçš„åˆ†åŒºè®¾å¤‡åç§°ï¼Œ\u0026lt;mount_point\u0026gt; æ›¿æ¢ä¸ºæ‚¨åœ¨ç¬¬ 7 æ­¥ä¸­åˆ›å»ºçš„ç›®å½•è·¯å¾„ã€‚\n","permalink":"http://yangchnet.github.io/Dessert/posts/linux/%E5%88%9B%E5%BB%BAlinux%E6%96%B0%E5%88%86%E5%8C%BA%E5%B9%B6%E6%8C%82%E8%BD%BD/","summary":"è¦åˆ›å»ºä¸€ä¸ªæ–°çš„ Linux æ–‡ä»¶ç³»ç»Ÿåˆ†åŒºå¹¶è¿›è¡ŒæŒ‚è½½ï¼Œæ‚¨å¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œæ“ä½œï¼š\n é¦–å…ˆï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä¹‹ä¸€æ¥æŸ¥çœ‹ç³»ç»Ÿä¸­å·²è¿æ¥çš„ç£ç›˜å’Œåˆ†åŒºï¼š  sudo fdisk -l æˆ–è€…\nsudo lsblk è¿™å°†æ˜¾ç¤ºç³»ç»Ÿä¸­çš„ç£ç›˜å’Œåˆ†åŒºåˆ—è¡¨ã€‚æ‰¾åˆ°æ‚¨è¦åˆ›å»ºåˆ†åŒºçš„ç£ç›˜ã€‚\nä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ‰“å¼€ç£ç›˜åˆ†åŒºå·¥å…·ï¼ˆä¾‹å¦‚ fdiskï¼‰ï¼š  sudo fdisk /dev/\u0026lt;disk_name\u0026gt; å°† \u0026lt;disk_name\u0026gt; æ›¿æ¢ä¸ºæ‚¨è¦åˆ›å»ºåˆ†åŒºçš„ç£ç›˜çš„åç§°ï¼Œä¾‹å¦‚ /dev/sdaã€‚\nåœ¨ç£ç›˜åˆ†åŒºå·¥å…·ä¸­ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»ºæ–°çš„åˆ†åŒºï¼š  n ç„¶åæŒ‰ç…§æç¤ºé€‰æ‹©åˆ†åŒºç±»å‹ã€èµ·å§‹æ‰‡åŒºå’Œç»“æŸæ‰‡åŒºã€‚å¯¹äº Linux æ–‡ä»¶ç³»ç»Ÿï¼Œé€šå¸¸é€‰æ‹©é»˜è®¤é€‰é¡¹å³å¯ã€‚\nè®¾ç½®åˆ†åŒºçš„æ–‡ä»¶ç³»ç»Ÿç±»å‹ä¸º Linuxã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š  t ç„¶åé€‰æ‹©æ–°åˆ›å»ºçš„åˆ†åŒºç¼–å·ï¼Œå¹¶é€‰æ‹© Linux æ–‡ä»¶ç³»ç»Ÿç±»å‹ï¼ˆä¾‹å¦‚ 83ï¼‰ã€‚\nä¿å­˜å¹¶é€€å‡ºç£ç›˜åˆ†åŒºå·¥å…·ã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š  w ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿï¼š  sudo mkfs.ext4 /dev/\u0026lt;partition\u0026gt; å°† æ›¿æ¢ä¸ºæ‚¨åˆšåˆšåˆ›å»ºçš„åˆ†åŒºè®¾å¤‡åç§°ï¼Œä¾‹å¦‚ /dev/sda1ã€‚\nåˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œç”¨äºæŒ‚è½½æ–‡ä»¶ç³»ç»Ÿã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š  sudo mkdir /mnt/\u0026lt;mount_point\u0026gt; å°† \u0026lt;mount_point\u0026gt; æ›¿æ¢ä¸ºæ‚¨å¸Œæœ›æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿçš„ç›®å½•è·¯å¾„ã€‚\nä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†æ–‡ä»¶ç³»ç»ŸæŒ‚è½½åˆ°ç›®æ ‡ç›®å½•ï¼š  sudo mount /dev/\u0026lt;partition\u0026gt; /mnt/\u0026lt;mount_point\u0026gt; å°† æ›¿æ¢ä¸ºæ‚¨åˆšåˆšåˆ›å»ºçš„åˆ†åŒºè®¾å¤‡åç§°ï¼Œ\u0026lt;mount_point\u0026gt; æ›¿æ¢ä¸ºæ‚¨åœ¨ç¬¬ 7 æ­¥ä¸­åˆ›å»ºçš„ç›®å½•è·¯å¾„ã€‚\næŒ‚è½½æˆåŠŸåï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥éªŒè¯æ–‡ä»¶ç³»ç»Ÿæ˜¯å¦å·²æŒ‚è½½ï¼š  df -h è¿™å°†æ˜¾ç¤ºå·²æŒ‚è½½çš„æ–‡ä»¶ç³»ç»Ÿåˆ—è¡¨ï¼ŒåŒ…æ‹¬æŒ‚è½½ç‚¹å’Œå¯ç”¨ç©ºé—´ã€‚","title":"åˆ›å»ºLinuxæ–°åˆ†åŒºï¼Œå¹¶æŒ‚è½½"},{"content":"å®‰è£…å·¥å…·ï¼š\napt install bridge-utils net-tools åˆ›å»ºä¸€ä¸ªæ–°çš„ç½‘ç»œå‘½åç©ºé—´\n$ ip netns add net1 # net1ä¸ºè¯¥ç½‘ç»œç©ºé—´çš„åç§° æŸ¥çœ‹å‘½åç©ºé—´çš„iptableï¼Œ è·¯ç”±è¡¨ï¼Œè®¾å¤‡\n$ ip netns exec net1 route # æŸ¥çœ‹è·¯ç”±è¡¨ Kernel IP routing table Destination Gateway Genmask Flags Metric Ref Use Iface $ ip netns exec net1 iptables -L # æŸ¥çœ‹iptable Chain INPUT (policy ACCEPT) target prot opt source destination Chain FORWARD (policy ACCEPT) target prot opt source destination Chain OUTPUT (policy ACCEPT) target prot opt source destination $ ip netns exec net1 ip link list # æŸ¥çœ‹è®¾å¤‡ 1: lo: \u0026lt;LOOPBACK\u0026gt; mtu 65536 qdisc noop state DOWN mode DEFAULT group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 # ç›®å‰åªæœ‰æœ¬åœ°å›ç¯è®¾å¤‡ï¼Œ å¹¶ä¸”çŠ¶æ€ä¸ºDOWNï¼ˆæœªå¯åŠ¨ï¼‰ åˆ›å»ºä¸€å¯¹vethï¼Œå¹¶å°†vethçš„ä¸€å¤´æ·»åŠ åˆ°net1ä¸­\n$ ip link add veth1 type veth peer name veth1_p $ ip link set veth1 netns net1 æŸ¥çœ‹ä¸»æœºä¸Šå½“å‰è®¾å¤‡ï¼Œåªèƒ½çœ‹åˆ°veth1_pè¿™ä¸ªè®¾å¤‡äº†\n$ ip link list | grep veth 1284: veth1_p@if1285: \u0026lt;BROADCAST,MULTICAST\u0026gt; mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000 æŸ¥çœ‹net1ç½‘ç»œå‘½åç©ºé—´ï¼Œveth1åœ¨è¿™ä¸ªç©ºé—´é‡Œé¢\n$ ip netns exec net1 ip link list 1: lo: \u0026lt;LOOPBACK\u0026gt; mtu 65536 qdisc noop state DOWN mode DEFAULT group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 1285: veth1@if1284: \u0026lt;BROADCAST,MULTICAST\u0026gt; mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000 link/ether 8a:b3:bb:2a:3a:92 brd ff:ff:ff:ff:ff:ff link-netnsid 0 ä¸ºè¿™å¯¹vethé…ç½®ipï¼Œå¹¶å¯åŠ¨èµ·æ¥\n$ ip addr add 10.68.0.100/24 dev veth1_p # é…ç½®net1ä¸­çš„è®¾å¤‡ip $ ip netns exec net1 ip addr add 10.68.0.101/24 dev veth1 $ ip netns exec net1 ip link set dev veth1 up # å¯åŠ¨net1ä¸­çš„è®¾å¤‡ $ ip link set dev veth1_p up # å¯åŠ¨æ¯æœºä¸­çš„è®¾å¤‡ åˆ†åˆ«æŸ¥çœ‹å½“å‰å¯åŠ¨çš„ç½‘ç»œè®¾å¤‡\n$ ifconfig | grep veth1 # æ¯æœº veth1_p: flags=4163\u0026lt;UP,BROADCAST,RUNNING,MULTICAST\u0026gt; mtu 1500 $ ip netns exec net1 ifconfig veth1: flags=4163\u0026lt;UP,BROADCAST,RUNNING,MULTICAST\u0026gt; mtu 1500 inet 192.168.0.101 netmask 255.255.255.0 broadcast 0.0.0.0 inet6 fe80::88b3:bbff:fe2a:3a92 prefixlen 64 scopeid 0x20\u0026lt;link\u0026gt; ether 8a:b3:bb:2a:3a:92 txqueuelen 1000 (Ethernet) RX packets 57 bytes 7088 (6.9 KiB) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 10 bytes 796 (796.0 B) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0 æµ‹è¯•é€šä¿¡\n$ ip netns exec net1 ping 10.68.0.100 -I veth1 PING 10.68.0.100 (10.68.0.100) æ¥è‡ª 10.68.0.101 veth1 56(84) å­—èŠ‚çš„æ•°æ®ã€‚ 64 å­—èŠ‚ï¼Œæ¥è‡ª 10.68.0.100: icmp_seq=1 ttl=64 æ—¶é—´=0.040 æ¯«ç§’ 64 å­—èŠ‚ï¼Œæ¥è‡ª 10.68.0.100: icmp_seq=2 ttl=64 æ—¶é—´=0.096 æ¯«ç§’ 64 å­—èŠ‚ï¼Œæ¥è‡ª 10.68.0.100: icmp_seq=3 ttl=64 æ—¶é—´=0.057 æ¯«ç§’ 64 å­—èŠ‚ï¼Œæ¥è‡ª 10.68.0.100: icmp_seq=4 ttl=64 æ—¶é—´=0.070 æ¯«ç§’ 64 å­—èŠ‚ï¼Œæ¥è‡ª 10.68.0.100: icmp_seq=5 ttl=64 æ—¶é—´=0.070 æ¯«ç§’ 64 å­—èŠ‚ï¼Œæ¥è‡ª 10.68.0.100: icmp_seq=6 ttl=64 æ—¶é—´=0.070 æ¯«ç§’ ^C --- 10.68.0.100 ping ç»Ÿè®¡ --- å·²å‘é€ 6 ä¸ªåŒ…ï¼Œ å·²æ¥æ”¶ 6 ä¸ªåŒ…, 0% packet loss, time 5077ms rtt min/avg/max/mdev = 0.040/0.067/0.096/0.016 ms åˆ›å»ºç½‘æ¡¥\n$ brctl addbr mybridge è®¾ç½®ç½‘æ¡¥ip\n$ ip addr add 10.68.0.1/24 dev mybridge å¯åŠ¨ç½‘æ¡¥\n$ ip link set dev mybridge up æŸ¥çœ‹ç½‘æ¡¥\n$ ip addr show mybridge 35: mybridge: \u0026lt;NO-CARRIER,BROADCAST,MULTICAST,UP\u0026gt; mtu 1500 qdisc noqueue state DOWN group default qlen 1000 link/ether 7e:06:1f:5a:53:f5 brd ff:ff:ff:ff:ff:ff inet 10.68.0.1/24 scope global mybridge valid_lft forever preferred_lft forever å°†è®¾å¤‡æ’å…¥ç½‘æ¡¥\n$ ip link set veth1_p master mybridge æŸ¥çœ‹æ˜¯å¦æ’å…¥æˆåŠŸ\n$ brctl show bridge name\tbridge id\tSTP enabled\tinterfaces mybridge\t8000.7e061f5a53f5\tno\tveth1_p ä»vethå¯¹çš„å¦ä¸€ç«¯pingç½‘æ¡¥\n$ ip netns exec net1 ping 10.68.0.1 -I veth1 PING 10.68.0.1 (10.68.0.1) æ¥è‡ª 10.68.0.101 veth1 56(84) å­—èŠ‚çš„æ•°æ®ã€‚ 64 å­—èŠ‚ï¼Œæ¥è‡ª 10.68.0.1: icmp_seq=1 ttl=64 æ—¶é—´=0.051 æ¯«ç§’ 64 å­—èŠ‚ï¼Œæ¥è‡ª 10.68.0.1: icmp_seq=2 ttl=64 æ—¶é—´=0.063 æ¯«ç§’ 64 å­—èŠ‚ï¼Œæ¥è‡ª 10.68.0.1: icmp_seq=3 ttl=64 æ—¶é—´=0.094 æ¯«ç§’ ^C --- 10.68.0.1 ping ç»Ÿè®¡ --- å·²å‘é€ 3 ä¸ªåŒ…ï¼Œ å·²æ¥æ”¶ 3 ä¸ªåŒ…, 0% packet loss, time 2036ms rtt min/avg/max/mdev = 0.051/0.069/0.094/0.018 ms æŸ¥çœ‹net1ç©ºé—´ä¸­çš„è·¯ç”±è§„åˆ™\n$ ip netns exec net1 ip route 10.68.0.0/24 dev veth1 proto kernel scope link src 10.68.0.101 è®¾ç½®ä¸€æ¡é»˜è®¤è·¯ç”±ï¼š\n$ ip netns exec net1 route add default gw 10.68.0.1 dev veth1 ç°åœ¨ä¸ºæ­¢ï¼Œå·²ç»å¯ä»¥å®ç°åœ¨ä¸€å°å®¿ä¸»æœºä¸Šçš„ä¸¤ä¸ªå®¹å™¨çš„ç›¸äº’é€šä¿¡ã€‚\nå°†ç‰©ç†æ¥å£ä¸ç½‘æ¡¥æ¡¥æ¥ï¼š\n$ brctl addif mybridge eth0 é…ç½®è·¯ç”±å’Œè½¬å‘\nsysctl net.ipv4.ip_forward=1 ç°åœ¨ï¼Œåº”è¯¥å¯ä»¥ä»net1ä¸­çš„veth1å‘å¤–ç•Œå‘é€æ¶ˆæ¯ï¼š\n$ ip netns exec net1 ping 8.8.8.8 -I veth1 PING 8.8.8.8 (8.8.8.8) from 10.68.0.101 veth1: 56(84) bytes of data. 64 bytes from 8.8.8.8: icmp_seq=2 ttl=62 time=39.5 ms 64 bytes from 8.8.8.8: icmp_seq=3 ttl=62 time=40.5 ms 64 bytes from 8.8.8.8: icmp_seq=4 ttl=62 time=39.3 ms 64 bytes from 8.8.8.8: icmp_seq=5 ttl=62 time=49.9 ms 64 bytes from 8.8.8.8: icmp_seq=6 ttl=62 time=40.3 ms 64 bytes from 8.8.8.8: icmp_seq=7 ttl=62 time=39.1 ms 64 bytes from 8.8.8.8: icmp_seq=8 ttl=62 time=39.1 ms ^C --- 8.8.8.8 ping statistics --- 8 packets transmitted, 7 received, 12.5% packet loss, time 7015ms rtt min/avg/max/mdev = 39.062/41.081/49.859/3.620 ms Refercences Build your own bridgechatpgtHow to Configure Network Bridge on Linux? - zenarmor.comhttps://zhuanlan.zhihu.com/p/65566171\n","permalink":"http://yangchnet.github.io/Dessert/posts/container/%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E5%AE%9E%E9%AA%8C/","summary":"å®‰è£…å·¥å…·ï¼š\napt install bridge-utils net-tools åˆ›å»ºä¸€ä¸ªæ–°çš„ç½‘ç»œå‘½åç©ºé—´\n$ ip netns add net1 # net1ä¸ºè¯¥ç½‘ç»œç©ºé—´çš„åç§° æŸ¥çœ‹å‘½åç©ºé—´çš„iptableï¼Œ è·¯ç”±è¡¨ï¼Œè®¾å¤‡\n$ ip netns exec net1 route # æŸ¥çœ‹è·¯ç”±è¡¨ Kernel IP routing table Destination Gateway Genmask Flags Metric Ref Use Iface $ ip netns exec net1 iptables -L # æŸ¥çœ‹iptable Chain INPUT (policy ACCEPT) target prot opt source destination Chain FORWARD (policy ACCEPT) target prot opt source destination Chain OUTPUT (policy ACCEPT) target prot opt source destination $ ip netns exec net1 ip link list # æŸ¥çœ‹è®¾å¤‡ 1: lo: \u0026lt;LOOPBACK\u0026gt; mtu 65536 qdisc noop state DOWN mode DEFAULT group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 # ç›®å‰åªæœ‰æœ¬åœ°å›ç¯è®¾å¤‡ï¼Œ å¹¶ä¸”çŠ¶æ€ä¸ºDOWNï¼ˆæœªå¯åŠ¨ï¼‰ åˆ›å»ºä¸€å¯¹vethï¼Œå¹¶å°†vethçš„ä¸€å¤´æ·»åŠ åˆ°net1ä¸­","title":"å®¹å™¨ç½‘ç»œå®éªŒ"},{"content":" TL;DR: Too Long; Donâ€™t Read. PR å†…å®¹å¤ªå¤šï¼Œæ²¡åŠæ³•çœ‹ PRï¼šPull Request. æ‹‰å–è¯·æ±‚ï¼Œç»™å…¶ä»–é¡¹ç›®æäº¤ä»£ç  PTALï¼šPlease take a look. è¯·çœ‹ä¸€çœ‹ LGTM: Looks Good To Me. ä»£ç å·²ç»è¿‡ reviewï¼Œå¯ä»¥åˆå¹¶ SGTM: Sounds Good To Me. å’Œä¸Šé¢é‚£å¥æ„æ€å·®ä¸å¤šï¼Œä¹Ÿæ˜¯å·²ç»é€šè¿‡äº† review çš„æ„æ€ WIP: Work In Progress. å‘Šè¯‰é¡¹ç›®ç»´æŠ¤è€…è¿™ä¸ªåŠŸèƒ½è¿˜æœªå®Œæˆï¼Œæ–¹ä¾¿ç»´æŠ¤è€…å‰ review å·²æäº¤çš„ä»£ç  PTAL: Please Take A Look. æç¤ºé¡¹ç›® Owner/contributor review TBR: To Be Reviewed. æç¤ºç»´æŠ¤è€…è¿›è¡Œ review TBD: To Be Done (or Defined/Discussed/Decided/Determined). æ ¹æ®è¯­å¢ƒä¸åŒæ„ä¹‰æœ‰æ‰€åŒºåˆ«ï¼Œä½†ä¸€èˆ¬éƒ½æ˜¯è¿˜æ²¡æå®šçš„æ„æ€ IMO: In My Opinion åœ¨æˆ‘çœ‹æ¥ã€ä¾æˆ‘çœ‹ã€ä¾æˆ‘æ‰€è§ IMHO: In My Humble Opinion IMO è°¦è™šçš„è¯´æ³• LGT1: Looks Good To 1. å¦‚æœæœ‰ä¸€ä¸ªå›å¤ LGTM åˆ™å¯ä»¥æ·»åŠ ä¸º LGT1ï¼Œ1 ä»£è¡¨ç›®å‰æœ‰ 1 ä¸ªèµ LGT2: Looks Good To 2. å¦‚æœæœ‰ä¸¤ä¸ªå›å¤ LGTM åˆ™å¯ä»¥æ·»åŠ ä¸º LGT2ï¼Œ2 ä»£è¡¨ç›®å‰æœ‰ 2 ä¸ªèµ DNM: Do not merge. ä¸è¦åˆå¹¶  ","permalink":"http://yangchnet.github.io/Dessert/posts/%E6%9D%82%E8%AE%B0/github%E9%BB%91%E8%AF%9D/","summary":"TL;DR: Too Long; Donâ€™t Read. PR å†…å®¹å¤ªå¤šï¼Œæ²¡åŠæ³•çœ‹ PRï¼šPull Request. æ‹‰å–è¯·æ±‚ï¼Œç»™å…¶ä»–é¡¹ç›®æäº¤ä»£ç  PTALï¼šPlease take a look. è¯·çœ‹ä¸€çœ‹ LGTM: Looks Good To Me. ä»£ç å·²ç»è¿‡ reviewï¼Œå¯ä»¥åˆå¹¶ SGTM: Sounds Good To Me. å’Œä¸Šé¢é‚£å¥æ„æ€å·®ä¸å¤šï¼Œä¹Ÿæ˜¯å·²ç»é€šè¿‡äº† review çš„æ„æ€ WIP: Work In Progress. å‘Šè¯‰é¡¹ç›®ç»´æŠ¤è€…è¿™ä¸ªåŠŸèƒ½è¿˜æœªå®Œæˆï¼Œæ–¹ä¾¿ç»´æŠ¤è€…å‰ review å·²æäº¤çš„ä»£ç  PTAL: Please Take A Look. æç¤ºé¡¹ç›® Owner/contributor review TBR: To Be Reviewed. æç¤ºç»´æŠ¤è€…è¿›è¡Œ review TBD: To Be Done (or Defined/Discussed/Decided/Determined). æ ¹æ®è¯­å¢ƒä¸åŒæ„ä¹‰æœ‰æ‰€åŒºåˆ«ï¼Œä½†ä¸€èˆ¬éƒ½æ˜¯è¿˜æ²¡æå®šçš„æ„æ€ IMO: In My Opinion åœ¨æˆ‘çœ‹æ¥ã€ä¾æˆ‘çœ‹ã€ä¾æˆ‘æ‰€è§ IMHO: In My Humble Opinion IMO è°¦è™šçš„è¯´æ³• LGT1: Looks Good To 1.","title":"githubé»‘è¯"},{"content":"1. å®‰è£… yay -S fcitx5 fcitx5-rime fcitx5-input-support fcitx5-chinese-addons fcitx5-qt fcitx5-gtk fcitx5-configtool rime-double-pinyin rime-double-pinyin æ˜¯åŒæ‹¼è¾“å…¥æ³•ï¼Œæˆ‘ä½¿ç”¨å°é¹¤åŒæ‹¼ã€‚\nå¼€æœºè‡ªå¯ï¼š\ncp /usr/share/applications/org.fcitx.Fcitx5.desktop ~/.config/autostart/ é…ç½® fcitx5çš„é…ç½®ç›®å½•åœ¨ï¼šmkdir ~/.local/share/fcitx5/rime/\nåœ¨è¿™ä¸ªç›®å½•ä¸‹åˆ›å»ºdefault.custom.yaml:\npatch: schema_list: - schema: double_pinyin_flypy ä½¿ç”¨å°é¹¤åŒæ‹¼è¾“å…¥æ–¹æ¡ˆã€‚\nè‹¥æƒ³å¯¹æŸä¸ªè¾“å…¥æ–¹æ¡ˆè¿›è¡Œè‡ªå®šä¹‰ï¼Œä¾‹å¦‚å°é¹¤åŒæ‹¼ï¼Œå…¶åŸé…ç½®æ–‡ä»¶ä¸ºï¼š~/.local/share/fcitx5/rime/double_pinyin_flypy.schema.yaml.åˆ™éœ€è¦åœ¨~/.local/share/fcitx5/rime/ä¸‹åˆ›å»ºdouble_pinyin_flypy.custom.yamlï¼Œç„¶ååœ¨å…¶ä¸­è¿›è¡Œè‡ªå®šä¹‰ã€‚ ä¾‹å¦‚ï¼š\n# encoding: utf-8 patch: \u0026#34;switches/@0/reset\u0026#34;: 1 switches: - name: ascii_mode reset: 1 states: [ ä¸­æ–‡, è¥¿æ–‡ ] # é»˜è®¤è‹±è¯­ - name: full_shape reset: 0 # é»˜è®¤åŠè§’ states: [ åŠè§’, å…¨è§’ ] - name: zh_simp  # æ³¨æ„é€™è£ï¼ˆâ€»1ï¼‰ reset: 1 # é»˜è®¤ç®€ä½“ states: [ æ¼¢å­—, æ±‰å­— ] switches/@next: name: emoji_suggestion reset: 1 # é»˜è®¤å¼€å¯emoji states: [ \u0026#34;ğŸˆšï¸\u0026#34;, \u0026#34;ğŸˆ¶\u0026#34; ] \u0026#39;engine/filters/@before 0\u0026#39;: simplifier@emoji_suggestion emoji_suggestion: opencc_config: emoji.json option_name: emoji_suggestion tips: none inherit_comment: false ä¸»é¢˜è®¾ç½®ï¼š\ngit clone https://github.com/thep0y/fcitx5-themes.git cd fcitx5-themes cp spring ~/.local/share/fcitx5/themes -r ä¿®æ”¹fcitx5é…ç½®æ–‡ä»¶ï¼š\nvim ~/.config/fcitx5/conf/classicui.conf # å‚ç›´å€™é€‰åˆ—è¡¨ Vertical Candidate List=False # æŒ‰å±å¹• DPI ä½¿ç”¨ PerScreenDPI=True # Font (è®¾ç½®æˆä½ å–œæ¬¢çš„å­—ä½“) Font=\u0026quot;Smartisan Compact CNS 13\u0026quot; # ä¸»é¢˜(è¿™é‡Œè¦æ”¹æˆä½ æƒ³è¦ä½¿ç”¨çš„ä¸»é¢˜åï¼Œä¸»é¢˜åå°±åœ¨ä¸‹é¢) Theme=spring Reference https://wiki.archlinuxcn.org/wiki/Fcitx5\nhttps://wiki.archlinuxcn.org/wiki/Rime#%E9%85%8D%E7%BD%AE%E7%9B%AE%E5%BD%95\nhttps://github.com/thep0y/fcitx5-themes\n","permalink":"http://yangchnet.github.io/Dessert/posts/tool/linux%E9%85%8D%E7%BD%AEfcitx5%E8%BE%93%E5%85%A5%E6%B3%95/","summary":"1. å®‰è£… yay -S fcitx5 fcitx5-rime fcitx5-input-support fcitx5-chinese-addons fcitx5-qt fcitx5-gtk fcitx5-configtool rime-double-pinyin rime-double-pinyin æ˜¯åŒæ‹¼è¾“å…¥æ³•ï¼Œæˆ‘ä½¿ç”¨å°é¹¤åŒæ‹¼ã€‚\nå¼€æœºè‡ªå¯ï¼š\ncp /usr/share/applications/org.fcitx.Fcitx5.desktop ~/.config/autostart/ é…ç½® fcitx5çš„é…ç½®ç›®å½•åœ¨ï¼šmkdir ~/.local/share/fcitx5/rime/\nåœ¨è¿™ä¸ªç›®å½•ä¸‹åˆ›å»ºdefault.custom.yaml:\npatch: schema_list: - schema: double_pinyin_flypy ä½¿ç”¨å°é¹¤åŒæ‹¼è¾“å…¥æ–¹æ¡ˆã€‚\nè‹¥æƒ³å¯¹æŸä¸ªè¾“å…¥æ–¹æ¡ˆè¿›è¡Œè‡ªå®šä¹‰ï¼Œä¾‹å¦‚å°é¹¤åŒæ‹¼ï¼Œå…¶åŸé…ç½®æ–‡ä»¶ä¸ºï¼š~/.local/share/fcitx5/rime/double_pinyin_flypy.schema.yaml.åˆ™éœ€è¦åœ¨~/.local/share/fcitx5/rime/ä¸‹åˆ›å»ºdouble_pinyin_flypy.custom.yamlï¼Œç„¶ååœ¨å…¶ä¸­è¿›è¡Œè‡ªå®šä¹‰ã€‚ ä¾‹å¦‚ï¼š\n# encoding: utf-8 patch: \u0026#34;switches/@0/reset\u0026#34;: 1 switches: - name: ascii_mode reset: 1 states: [ ä¸­æ–‡, è¥¿æ–‡ ] # é»˜è®¤è‹±è¯­ - name: full_shape reset: 0 # é»˜è®¤åŠè§’ states: [ åŠè§’, å…¨è§’ ] - name: zh_simp  # æ³¨æ„é€™è£ï¼ˆâ€»1ï¼‰ reset: 1 # é»˜è®¤ç®€ä½“ states: [ æ¼¢å­—, æ±‰å­— ] switches/@next: name: emoji_suggestion reset: 1 # é»˜è®¤å¼€å¯emoji states: [ \u0026#34;ğŸˆšï¸\u0026#34;, \u0026#34;ğŸˆ¶\u0026#34; ] \u0026#39;engine/filters/@before 0\u0026#39;: simplifier@emoji_suggestion emoji_suggestion: opencc_config: emoji.","title":"manjaroé…ç½®fcitx5è¾“å…¥æ³•"},{"content":"åœ¨è¿›è¡Œä¸€äº›ç½‘ç»œæµ‹è¯•æ—¶ï¼Œå¯èƒ½ä¼šéœ€è¦ä¸€äº›ç½‘ç»œç›‘å¬ï¼Œè¿™æ—¶å¦‚æœå†æ‰‹åŠ¨å†™ä¸€ä¸ªç½‘ç»œç¨‹åºï¼Œæœªå…æœ‰äº›éº»çƒ¦ï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨ncå‘½ä»¤ç›´æ¥åˆ›å»ºtcpè¿æ¥æˆ–ç›‘å¬æŸç«¯å£ã€‚\nIt can open TCP connections, send UDP packets, listen on arbitrary TCP and UDP ports, do port scanning, and deal with both IPv4 and IPv6.\nä½¿ç”¨case  å¿«é€Ÿåˆ›å»ºclient/serverå¯¹  nc -l 1234 nc 127.0.0.1 1234 ä»»ä½•åœ¨clientç«¯çš„è¾“å‡ºéƒ½å°†åœ¨serverç«¯æ˜¾ç¤º\nç«¯å£æ‰«æ  nc -zv 127.0.0.1 8885-8889 å…¶ä»–ä¾‹å­  nc -p 31337 -w 5 abc.com 42 nc -u abc.com 53 nc -s 10.1.2.3 abc.com 42 nc -lU /var/tmp/dsocket ","permalink":"http://yangchnet.github.io/Dessert/posts/linux/nc/","summary":"åœ¨è¿›è¡Œä¸€äº›ç½‘ç»œæµ‹è¯•æ—¶ï¼Œå¯èƒ½ä¼šéœ€è¦ä¸€äº›ç½‘ç»œç›‘å¬ï¼Œè¿™æ—¶å¦‚æœå†æ‰‹åŠ¨å†™ä¸€ä¸ªç½‘ç»œç¨‹åºï¼Œæœªå…æœ‰äº›éº»çƒ¦ï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨ncå‘½ä»¤ç›´æ¥åˆ›å»ºtcpè¿æ¥æˆ–ç›‘å¬æŸç«¯å£ã€‚\nIt can open TCP connections, send UDP packets, listen on arbitrary TCP and UDP ports, do port scanning, and deal with both IPv4 and IPv6.\nä½¿ç”¨case  å¿«é€Ÿåˆ›å»ºclient/serverå¯¹  nc -l 1234 nc 127.0.0.1 1234 ä»»ä½•åœ¨clientç«¯çš„è¾“å‡ºéƒ½å°†åœ¨serverç«¯æ˜¾ç¤º\nç«¯å£æ‰«æ  nc -zv 127.0.0.1 8885-8889 å…¶ä»–ä¾‹å­  nc -p 31337 -w 5 abc.com 42 nc -u abc.com 53 nc -s 10.1.2.3 abc.com 42 nc -lU /var/tmp/dsocket ","title":"nc-ä»»æ„çš„TCP/UDPè¿æ¥å’Œç›‘å¬"},{"content":"åŸºæœ¬æ¦‚å¿µ VXLAN(Virtual Extensible LAN, è™šæ‹Ÿå±€åŸŸç½‘æ‰©å±•)æ˜¯ä¸€ç§ç½‘ç»œè™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œå®ƒè¯•å›¾æ”¹å–„å¤§äº‘è®¡ç®—éƒ¨ç½²ç›¸å…³çš„å¯æ‰©å±•æ€§é—®é¢˜ã€‚å®ƒé‡‡ç”¨ç±»ä¼¼ VLAN çš„å°è£…æŠ€æœ¯æ¥å°è£…åŸºäº MAC å«æ‹¬ç¬¬4å±‚çš„ UDP æ•°æ®åŒ…çš„ OSI ç¬¬2å±‚ ä»¥å¤ªç½‘å¸§ï¼Œä½¿ç”¨ 4789 ä½œä¸ºé»˜è®¤åˆ†é…çš„ IANA ç›®çš„åœ° UDP ç«¯å£å·ã€‚\nVTEPæ˜¯å‚ä¸VXLANç½‘ç»œä¸­çš„ä¸»æœºã€è™šæ‹Ÿäº¤æ¢æœºæˆ–ç‰©ç†äº¤æ¢æœºè®¾å¤‡ï¼Œç”¨äºåœ¨VXLANéš§é“å’ŒåŸºç¡€ç½‘ç»œä¹‹é—´è¿›è¡Œæ•°æ®åŒ…çš„å°è£…å’Œè§£å°è£…ã€‚ å…·ä½“è€Œè¨€ï¼ŒVTEPè®¾å¤‡è´Ÿè´£å°†æœ¬åœ°ä¸»æœºæˆ–è™šæ‹Ÿæœºçš„æ•°æ®åŒ…å°è£…ä¸ºVXLANæ•°æ®åŒ…ï¼Œä»¥ä¾¿åœ¨åº•å±‚IPç½‘ç»œä¸­è¿›è¡Œä¼ è¾“ã€‚å®ƒæ·»åŠ äº†VXLANå¤´éƒ¨ï¼Œå…¶ä¸­åŒ…æ‹¬VXLANæ ‡è¯†ç¬¦ï¼ˆVNIï¼‰å’Œæº/ç›®çš„VTEP IPåœ°å€ã€‚VTEPè¿˜è´Ÿè´£åœ¨æ¥æ”¶åˆ°VXLANæ•°æ®åŒ…æ—¶è§£å°è£…æ•°æ®åŒ…ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™ç›®æ ‡ä¸»æœºæˆ–è™šæ‹Ÿæœºã€‚\nVTEP (VXLAN Tunnel End Pointï¼ˆè™šæ‹Ÿéš§é“ç«¯ç‚¹ï¼‰)ï¼švxlan ç½‘ç»œçš„è¾¹ç¼˜è®¾å¤‡ï¼Œç”¨æ¥è¿›è¡Œ vxlan æŠ¥æ–‡çš„å¤„ç†ï¼ˆå°åŒ…å’Œè§£åŒ…ï¼‰ã€‚vtep å¯ä»¥æ˜¯ç½‘ç»œè®¾å¤‡ï¼ˆæ¯”å¦‚äº¤æ¢æœºï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€å°æœºå™¨ï¼ˆæ¯”å¦‚è™šæ‹ŸåŒ–é›†ç¾¤ä¸­çš„å®¿ä¸»æœºï¼‰ VNIï¼ˆVXLAN Network Identifierï¼‰ï¼šVNI æ˜¯æ¯ä¸ª vxlan çš„æ ‡è¯†ï¼Œæ˜¯ä¸ª 24 ä½æ•´æ•°ï¼Œä¸€å…±æœ‰ 2^24 = 16,777,216ï¼ˆä¸€åƒå¤šä¸‡ï¼‰ï¼Œä¸€èˆ¬æ¯ä¸ª VNI å¯¹åº”ä¸€ä¸ªç§Ÿæˆ·ï¼Œä¹Ÿå°±æ˜¯è¯´ä½¿ç”¨ vxlan æ­å»ºçš„å…¬æœ‰äº‘å¯ä»¥ç†è®ºä¸Šå¯ä»¥æ”¯æ’‘åƒä¸‡çº§åˆ«çš„ç§Ÿæˆ·\nåœ¨VXLANï¼ˆVirtual Extensible LANï¼‰ä¸­ï¼ŒVNIï¼ˆVXLAN Network Identifierï¼‰ç”¨äºæ ‡è¯†ä¸åŒçš„è™šæ‹Ÿç½‘ç»œã€‚ VNIæ˜¯ä¸€ä¸ª32ä½çš„æ ‡è¯†ç¬¦ï¼Œå®ƒåœ¨VXLANéš§é“ä¸­çš„å¤´éƒ¨ä¸­æ‰¿è½½ï¼Œä»¥ä¾¿åœ¨åº•å±‚IPç½‘ç»œä¸­ä¼ é€’ã€‚VNIå…è®¸ä¸åŒçš„è™šæ‹Ÿç½‘ç»œå…±äº«åŒæ ·çš„ç‰©ç†ç½‘ç»œåŸºç¡€è®¾æ–½ï¼Œæ¯ä¸ªè™šæ‹Ÿç½‘ç»œéƒ½å¯ä»¥å…·æœ‰ä¸åŒçš„VNI\nå…·ä½“è€Œè¨€ï¼ŒVNIçš„ä½œç”¨å¦‚ä¸‹ï¼š\n è™šæ‹Ÿç½‘ç»œéš”ç¦»ï¼šVNIç”¨äºå°†ä¸åŒçš„è™šæ‹Ÿç½‘ç»œéš”ç¦»å¼€æ¥ã€‚å½“VXLANç½‘ç»œä¸­çš„ä¸»æœºæˆ–è™šæ‹Ÿæœºå‘é€æ•°æ®åŒ…æ—¶ï¼ŒVNIç”¨äºå°†æ•°æ®åŒ…ä¸ç‰¹å®šçš„è™šæ‹Ÿç½‘ç»œå…³è”èµ·æ¥ã€‚è¿™æ ·ï¼ŒVXLANç½‘ç»œå¯ä»¥åœ¨ç›¸åŒçš„ç‰©ç†åŸºç¡€è®¾æ–½ä¸ŠåŒæ—¶æ”¯æŒå¤šä¸ªè™šæ‹Ÿç½‘ç»œï¼Œè€Œä¸ä¼šç›¸äº’å¹²æ‰°ã€‚ æ•°æ®åŒ…è¯†åˆ«ï¼šå½“æ¥æ”¶åˆ°VXLANæ•°æ®åŒ…æ—¶ï¼Œç›®çš„VTEPï¼ˆVXLAN Tunnel Endpointï¼‰è®¾å¤‡ä¼šæ ¹æ®VNIè§£ææ•°æ®åŒ…ï¼Œå¹¶æ ¹æ®VNIå°†æ•°æ®åŒ…äº¤ä»˜åˆ°æ­£ç¡®çš„è™šæ‹Ÿç½‘ç»œã€‚VNIå……å½“äº†åœ¨åº•å±‚IPç½‘ç»œä¸Šä¼ é€’æ•°æ®åŒ…ï¼Œå¹¶è¯†åˆ«æ•°æ®åŒ…çš„è™šæ‹Ÿç½‘ç»œå½’å±çš„å…³é”®æ ‡è¯†ç¬¦ã€‚  FDB(Forwarding Database) äºŒå±‚ç½‘æ¡¥çš„FDBè¡¨é¡¹æ ¼å¼å¯è¡¨è¾¾ä¸º:\n\u0026lt;MAC\u0026gt; \u0026lt;VLAN\u0026gt; \u0026lt;DEV PORT\u0026gt; VXLANè®¾å¤‡çš„è¡¨é¡¹ä¸ä¹‹ç±»ä¼¼ï¼Œå¯ä»¥è¡¨è¾¾ä¸º:\n\u0026lt;MAC\u0026gt; \u0026lt;VNI\u0026gt; \u0026lt;REMOTE IP\u0026gt; VXLANè®¾å¤‡æ ¹æ®MACåœ°å€æ¥æŸ¥æ‰¾ç›¸åº”çš„VTEP IPåœ°å€ï¼Œç»§è€Œå°†äºŒå±‚æ•°æ®å¸§å°è£…å‘é€è‡³ç›¸åº”VTEPã€‚ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹fdbè¡¨é¡¹ï¼š\n$ bridge fdb ç‚¹å¯¹ç‚¹vxlan $ ip link add vxlan0 type vxlan \\  id 1 \\  remote 192.168.56.3 \\  local 192.168.56.2 \\  dstport 4789 \\  dev eth1 $ ip addr add 10.0.0.2/24 dev vxlan0 # è®¾ç½®ip $ ip link set vxlan0 up # å¯åŠ¨è®¾å¤‡ $ ip -d link show dev vxlan0 # æŸ¥çœ‹è®¾å¤‡ ip link add vxlan0 type vxlan \\  id 1 \\  remote 192.168.56.2 \\  local 192.168.56.3 \\  dstport 4789 \\  dev eth1 $ ip addr add 10.0.0.3/24 dev vxlan0 # è®¾ç½®ip $ ip link set vxlan0 up # å¯åŠ¨è®¾å¤‡ $ ip -d link show dev vxlan0 # æŸ¥çœ‹è®¾å¤‡ å¤šæ’­vxlan å¦‚æœ vxlan è¦ä½¿ç”¨å¤šæ’­æ¨¡å¼ï¼Œé‚£ä¹ˆåº•å±‚çš„ç½‘ç»œç»“æ„éœ€è¦æ”¯æŒå¤šæ’­çš„åŠŸèƒ½ï¼Œ virtualbox ç½‘ç»œæ”¯æŒå¤šæ’­ã€‚ è¦ç»„æˆåŒä¸€ä¸ª vxlan ç½‘ç»œï¼Œvtep å¿…é¡»èƒ½æ„ŸçŸ¥åˆ°å½¼æ­¤çš„å­˜åœ¨ã€‚\n$ ip link add vxlan0 type vxlan \\  id 42 \\  dstport 4789 \\  group 239.1.1.1 \\  dev eth1 $ ip addr add 10.20.1.2/24 dev vxlan0 # è®¾ç½®ip $ ip link set vxlan0 up # å¯åŠ¨vxlan0 $ ip link add vxlan0 type vxlan \\  id 42 \\  dstport 4789 \\  group 239.1.1.1 \\  dev eth1 $ ip addr add 10.20.1.3/24 dev vxlan0 # è®¾ç½®ip $ ip link set vxlan0 up # å¯åŠ¨vxlan0 References linux ä¸Šå®ç° vxlan ç½‘ç»œ | Cizixs Write Here\n","permalink":"http://yangchnet.github.io/Dessert/posts/net/vxlan/","summary":"åŸºæœ¬æ¦‚å¿µ VXLAN(Virtual Extensible LAN, è™šæ‹Ÿå±€åŸŸç½‘æ‰©å±•)æ˜¯ä¸€ç§ç½‘ç»œè™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œå®ƒè¯•å›¾æ”¹å–„å¤§äº‘è®¡ç®—éƒ¨ç½²ç›¸å…³çš„å¯æ‰©å±•æ€§é—®é¢˜ã€‚å®ƒé‡‡ç”¨ç±»ä¼¼ VLAN çš„å°è£…æŠ€æœ¯æ¥å°è£…åŸºäº MAC å«æ‹¬ç¬¬4å±‚çš„ UDP æ•°æ®åŒ…çš„ OSI ç¬¬2å±‚ ä»¥å¤ªç½‘å¸§ï¼Œä½¿ç”¨ 4789 ä½œä¸ºé»˜è®¤åˆ†é…çš„ IANA ç›®çš„åœ° UDP ç«¯å£å·ã€‚\nVTEPæ˜¯å‚ä¸VXLANç½‘ç»œä¸­çš„ä¸»æœºã€è™šæ‹Ÿäº¤æ¢æœºæˆ–ç‰©ç†äº¤æ¢æœºè®¾å¤‡ï¼Œç”¨äºåœ¨VXLANéš§é“å’ŒåŸºç¡€ç½‘ç»œä¹‹é—´è¿›è¡Œæ•°æ®åŒ…çš„å°è£…å’Œè§£å°è£…ã€‚ å…·ä½“è€Œè¨€ï¼ŒVTEPè®¾å¤‡è´Ÿè´£å°†æœ¬åœ°ä¸»æœºæˆ–è™šæ‹Ÿæœºçš„æ•°æ®åŒ…å°è£…ä¸ºVXLANæ•°æ®åŒ…ï¼Œä»¥ä¾¿åœ¨åº•å±‚IPç½‘ç»œä¸­è¿›è¡Œä¼ è¾“ã€‚å®ƒæ·»åŠ äº†VXLANå¤´éƒ¨ï¼Œå…¶ä¸­åŒ…æ‹¬VXLANæ ‡è¯†ç¬¦ï¼ˆVNIï¼‰å’Œæº/ç›®çš„VTEP IPåœ°å€ã€‚VTEPè¿˜è´Ÿè´£åœ¨æ¥æ”¶åˆ°VXLANæ•°æ®åŒ…æ—¶è§£å°è£…æ•°æ®åŒ…ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™ç›®æ ‡ä¸»æœºæˆ–è™šæ‹Ÿæœºã€‚\nVTEP (VXLAN Tunnel End Pointï¼ˆè™šæ‹Ÿéš§é“ç«¯ç‚¹ï¼‰)ï¼švxlan ç½‘ç»œçš„è¾¹ç¼˜è®¾å¤‡ï¼Œç”¨æ¥è¿›è¡Œ vxlan æŠ¥æ–‡çš„å¤„ç†ï¼ˆå°åŒ…å’Œè§£åŒ…ï¼‰ã€‚vtep å¯ä»¥æ˜¯ç½‘ç»œè®¾å¤‡ï¼ˆæ¯”å¦‚äº¤æ¢æœºï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€å°æœºå™¨ï¼ˆæ¯”å¦‚è™šæ‹ŸåŒ–é›†ç¾¤ä¸­çš„å®¿ä¸»æœºï¼‰ VNIï¼ˆVXLAN Network Identifierï¼‰ï¼šVNI æ˜¯æ¯ä¸ª vxlan çš„æ ‡è¯†ï¼Œæ˜¯ä¸ª 24 ä½æ•´æ•°ï¼Œä¸€å…±æœ‰ 2^24 = 16,777,216ï¼ˆä¸€åƒå¤šä¸‡ï¼‰ï¼Œä¸€èˆ¬æ¯ä¸ª VNI å¯¹åº”ä¸€ä¸ªç§Ÿæˆ·ï¼Œä¹Ÿå°±æ˜¯è¯´ä½¿ç”¨ vxlan æ­å»ºçš„å…¬æœ‰äº‘å¯ä»¥ç†è®ºä¸Šå¯ä»¥æ”¯æ’‘åƒä¸‡çº§åˆ«çš„ç§Ÿæˆ·\nåœ¨VXLANï¼ˆVirtual Extensible LANï¼‰ä¸­ï¼ŒVNIï¼ˆVXLAN Network Identifierï¼‰ç”¨äºæ ‡è¯†ä¸åŒçš„è™šæ‹Ÿç½‘ç»œã€‚ VNIæ˜¯ä¸€ä¸ª32ä½çš„æ ‡è¯†ç¬¦ï¼Œå®ƒåœ¨VXLANéš§é“ä¸­çš„å¤´éƒ¨ä¸­æ‰¿è½½ï¼Œä»¥ä¾¿åœ¨åº•å±‚IPç½‘ç»œä¸­ä¼ é€’ã€‚VNIå…è®¸ä¸åŒçš„è™šæ‹Ÿç½‘ç»œå…±äº«åŒæ ·çš„ç‰©ç†ç½‘ç»œåŸºç¡€è®¾æ–½ï¼Œæ¯ä¸ªè™šæ‹Ÿç½‘ç»œéƒ½å¯ä»¥å…·æœ‰ä¸åŒçš„VNI\nå…·ä½“è€Œè¨€ï¼ŒVNIçš„ä½œç”¨å¦‚ä¸‹ï¼š\n è™šæ‹Ÿç½‘ç»œéš”ç¦»ï¼šVNIç”¨äºå°†ä¸åŒçš„è™šæ‹Ÿç½‘ç»œéš”ç¦»å¼€æ¥ã€‚å½“VXLANç½‘ç»œä¸­çš„ä¸»æœºæˆ–è™šæ‹Ÿæœºå‘é€æ•°æ®åŒ…æ—¶ï¼ŒVNIç”¨äºå°†æ•°æ®åŒ…ä¸ç‰¹å®šçš„è™šæ‹Ÿç½‘ç»œå…³è”èµ·æ¥ã€‚è¿™æ ·ï¼ŒVXLANç½‘ç»œå¯ä»¥åœ¨ç›¸åŒçš„ç‰©ç†åŸºç¡€è®¾æ–½ä¸ŠåŒæ—¶æ”¯æŒå¤šä¸ªè™šæ‹Ÿç½‘ç»œï¼Œè€Œä¸ä¼šç›¸äº’å¹²æ‰°ã€‚ æ•°æ®åŒ…è¯†åˆ«ï¼šå½“æ¥æ”¶åˆ°VXLANæ•°æ®åŒ…æ—¶ï¼Œç›®çš„VTEPï¼ˆVXLAN Tunnel Endpointï¼‰è®¾å¤‡ä¼šæ ¹æ®VNIè§£ææ•°æ®åŒ…ï¼Œå¹¶æ ¹æ®VNIå°†æ•°æ®åŒ…äº¤ä»˜åˆ°æ­£ç¡®çš„è™šæ‹Ÿç½‘ç»œã€‚VNIå……å½“äº†åœ¨åº•å±‚IPç½‘ç»œä¸Šä¼ é€’æ•°æ®åŒ…ï¼Œå¹¶è¯†åˆ«æ•°æ®åŒ…çš„è™šæ‹Ÿç½‘ç»œå½’å±çš„å…³é”®æ ‡è¯†ç¬¦ã€‚  FDB(Forwarding Database) äºŒå±‚ç½‘æ¡¥çš„FDBè¡¨é¡¹æ ¼å¼å¯è¡¨è¾¾ä¸º:\n\u0026lt;MAC\u0026gt; \u0026lt;VLAN\u0026gt; \u0026lt;DEV PORT\u0026gt; VXLANè®¾å¤‡çš„è¡¨é¡¹ä¸ä¹‹ç±»ä¼¼ï¼Œå¯ä»¥è¡¨è¾¾ä¸º:\n\u0026lt;MAC\u0026gt; \u0026lt;VNI\u0026gt; \u0026lt;REMOTE IP\u0026gt; VXLANè®¾å¤‡æ ¹æ®MACåœ°å€æ¥æŸ¥æ‰¾ç›¸åº”çš„VTEP IPåœ°å€ï¼Œç»§è€Œå°†äºŒå±‚æ•°æ®å¸§å°è£…å‘é€è‡³ç›¸åº”VTEPã€‚ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹fdbè¡¨é¡¹ï¼š","title":"vxlan"},{"content":"0. è½¯ç¡¬ç¯å¢ƒ  ç³»ç»Ÿï¼šmanjaroï¼ˆå†…æ ¸6.1.44ï¼‰ é¼ æ ‡ï¼šmx anywhere 2s æ— è“ç‰™  1. é€šè¿‡ä¼˜è”è¿æ¥é¼ æ ‡ä¸ä¸»æœº è¿™é‡Œéœ€è¦ä¸‹è½½solaaråŒ…æ¥è¿›è¡Œè¿æ¥ã€‚\nyay -S solaar  Solaar æ˜¯è®¸å¤šç½—æŠ€é”®ç›˜ã€é¼ æ ‡å’Œè§¦æ§æ¿çš„ Linux ç®¡ç†å™¨ï¼Œå¯æ— çº¿è¿æ¥åˆ° USB Unifyingã€Boltã€Lightspeed æˆ– Nano æ¥æ”¶å™¨ï¼› é€šè¿‡ USB çº¿ç›´æ¥è¿æ¥ï¼› æˆ–é€šè¿‡è“ç‰™è¿æ¥ã€‚ Solar ä¸èƒ½ä¸å…¶ä»–å…¬å¸çš„å¤–å›´è®¾å¤‡é…åˆä½¿ç”¨ã€‚\n å®‰è£…å®Œæˆä¹‹åï¼Œæ‰“å¼€solaarï¼Œå°†æœ‰å¦‚ä¸‹uiç•Œé¢å‡ºç°ï¼ŒæŒ‰æ­¥éª¤è¿æ¥é¼ æ ‡å³å¯ã€‚ 2. è®¾ç½®é¼ æ ‡æŒ‰é”® æˆ‘çš„é¼ æ ‡mx anywhere 2sä¸Šæœ‰ä¸€äº›æŒ‰é”®ï¼Œå¦‚æœåªç”¨solaarè¿æ¥åˆ°ç”µè„‘ï¼Œè¿™äº›æŒ‰é”®å¯èƒ½å¹¶ä¸èƒ½å‘æŒ¥å®ƒçš„ä½œç”¨ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å°†è¿™äº›æŒ‰é”®å’Œå¿«æ·é”®è¿›è¡Œç»‘å®šã€‚ è¿™é‡Œä½¿ç”¨logiops\nå®‰è£…ï¼š\nyay -S logiops é…ç½®ï¼š\nsudo vim /etc/logid.cfg åœ¨logid.cfgä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š\ndevices: ({ name: \u0026#34;Wireless Mobile Mouse MX Anywhere 2\u0026#34;; // A lower threshold number makes the wheel switch to free-spin mode // quicker when scrolling fast. #smartshift: { on: true; threshold: 20; }; #hiresscroll: { hires: true; invert: false; target: false; }; // Higher numbers make the mouse more sensitive (cursor moves faster), // 4000 max for MX Master 3. dpi: 1200; buttons: ( // Make thumb button 10. { # Next tab instead of fwd in history, Comment to default behavior cid: 0x52; action = { type : \u0026#34;Keypress\u0026#34;; keys: [\u0026#34;KEY_LEFTCTRL\u0026#34;, \u0026#34;KEY_LEFTSHIFT\u0026#34;, \u0026#34;KEY_W\u0026#34;]; }; }, { # Next tab instead of fwd in history, Comment to default behavior cid: 0x53; action = { type : \u0026#34;Keypress\u0026#34;; keys: [\u0026#34;KEY_LEFTMETA\u0026#34;, \u0026#34;KEY_LEFTALT\u0026#34;, \u0026#34;KEY_LEFT\u0026#34;]; }; }, { # Next tab instead of fwd in history, Comment to default behavior cid: 0x56; action = { type : \u0026#34;Keypress\u0026#34;; keys: [\u0026#34;KEY_LEFTMETA\u0026#34;, \u0026#34;KEY_LEFTALT\u0026#34;, \u0026#34;KEY_RIGHT\u0026#34;]; }; }, { # Next tab instead of fwd in history, Comment to default behavior cid: 0x5b; action = { type : \u0026#34;Keypress\u0026#34;; keys: [\u0026#34;KEY_LEFTCTRL\u0026#34;, \u0026#34;KEY_LEFTALT\u0026#34;, \u0026#34;KEY_RIGHT\u0026#34;]; }; }, { # Next tab instead of fwd in history, Comment to default behavior cid: 0x5d; action = { type : \u0026#34;Keypress\u0026#34;; keys: [\u0026#34;KEY_LEFTCTRL\u0026#34;, \u0026#34;KEY_LEFTALT\u0026#34;, \u0026#34;KEY_LEFT\u0026#34;]; }; }, ); }); è¿™é‡Œçš„cidå­—æ®µä»£è¡¨é¼ æ ‡æŒ‰ä¸‹åè¾“å‡ºçš„é”®å€¼ï¼Œå¯ä»¥ä»https://github.com/PixlOne/logiops/wiki/CIDsè¿™é‡ŒæŸ¥çœ‹é¼ æ ‡æŒ‰é”®ä¸é”®å€¼çš„å¯¹åº”å…³ç³»ã€‚\næœ‰äº†é”®å€¼ï¼Œç„¶ååœ¨keysä¸­é…ç½®ç›¸åº”çš„æŒ‰é”®ç»„åˆï¼Œé‚£ä¹ˆå°±å¯ä»¥å°†é¼ æ ‡æŒ‰é”®ä¸å¿«æ·é”®è¿›è¡Œç»‘å®šäº†ã€‚\nlogiopsè¿˜æœ‰è°ƒèŠ‚é¼ æ ‡dpiå’Œæ»šè½®é€Ÿåº¦çš„åŠŸèƒ½ã€‚\nReference:\nhttps://github.com/PixlOne/logiops/wiki/CIDs\nhttps://wiki.archlinux.org/title/Logitech_MX_Master\nhttps://aur.archlinux.org/packages/logiops\nhttps://aur.archlinux.org/packages/solaar-git\n","permalink":"http://yangchnet.github.io/Dessert/posts/tool/%E5%9C%A8manjaro%E5%8F%B0%E5%BC%8F%E6%9C%BA%E4%B8%8A%E4%BD%BF%E7%94%A8%E7%BD%97%E6%8A%80%E8%93%9D%E7%89%99%E9%BC%A0%E6%A0%87/","summary":"0. è½¯ç¡¬ç¯å¢ƒ  ç³»ç»Ÿï¼šmanjaroï¼ˆå†…æ ¸6.1.44ï¼‰ é¼ æ ‡ï¼šmx anywhere 2s æ— è“ç‰™  1. é€šè¿‡ä¼˜è”è¿æ¥é¼ æ ‡ä¸ä¸»æœº è¿™é‡Œéœ€è¦ä¸‹è½½solaaråŒ…æ¥è¿›è¡Œè¿æ¥ã€‚\nyay -S solaar  Solaar æ˜¯è®¸å¤šç½—æŠ€é”®ç›˜ã€é¼ æ ‡å’Œè§¦æ§æ¿çš„ Linux ç®¡ç†å™¨ï¼Œå¯æ— çº¿è¿æ¥åˆ° USB Unifyingã€Boltã€Lightspeed æˆ– Nano æ¥æ”¶å™¨ï¼› é€šè¿‡ USB çº¿ç›´æ¥è¿æ¥ï¼› æˆ–é€šè¿‡è“ç‰™è¿æ¥ã€‚ Solar ä¸èƒ½ä¸å…¶ä»–å…¬å¸çš„å¤–å›´è®¾å¤‡é…åˆä½¿ç”¨ã€‚\n å®‰è£…å®Œæˆä¹‹åï¼Œæ‰“å¼€solaarï¼Œå°†æœ‰å¦‚ä¸‹uiç•Œé¢å‡ºç°ï¼ŒæŒ‰æ­¥éª¤è¿æ¥é¼ æ ‡å³å¯ã€‚ 2. è®¾ç½®é¼ æ ‡æŒ‰é”® æˆ‘çš„é¼ æ ‡mx anywhere 2sä¸Šæœ‰ä¸€äº›æŒ‰é”®ï¼Œå¦‚æœåªç”¨solaarè¿æ¥åˆ°ç”µè„‘ï¼Œè¿™äº›æŒ‰é”®å¯èƒ½å¹¶ä¸èƒ½å‘æŒ¥å®ƒçš„ä½œç”¨ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å°†è¿™äº›æŒ‰é”®å’Œå¿«æ·é”®è¿›è¡Œç»‘å®šã€‚ è¿™é‡Œä½¿ç”¨logiops\nå®‰è£…ï¼š\nyay -S logiops é…ç½®ï¼š\nsudo vim /etc/logid.cfg åœ¨logid.cfgä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š\ndevices: ({ name: \u0026#34;Wireless Mobile Mouse MX Anywhere 2\u0026#34;; // A lower threshold number makes the wheel switch to free-spin mode // quicker when scrolling fast.","title":"åœ¨manjaroå°å¼æœºä¸Šä½¿ç”¨ç½—æŠ€è“ç‰™é¼ æ ‡"},{"content":"1. draw.io åœ¨çº¿ç”»å›¾å·¥å…· https://app.diagrams.net/\n2. sql to Gorm SQLè¯­å¥è½¬åŒ–ä¸ºgoç»“æ„ä½“ https://sql2gorm.mccode.info/\n3. ä¸€äº›ç¼–ç¨‹å­—ä½“ https://www.nerdfonts.com/font-downloads\n4. å›¢é˜Ÿåä½œå·¥å…· https://www.devbefore.com/product\n5. markdown å†™ä½œå·¥å…·ï¼ˆå¼€æºå…è´¹ï¼‰ https://marktext.app/\n6. z ç›®å½•å¿«é€Ÿè·³è½¬ (å¼ºçƒˆæ¨è) https://github.com/rupa/z (å®‰è£…)https://yangchnet.github.io/Dessert/posts/tool/z/\n7. nvm npmå¤šç‰ˆæœ¬ç®¡ç† (å¼ºçƒˆæ¨è) https://github.com/nvm-sh/nvm\n8. lazydocker å®¹å™¨æŸ¥çœ‹å·¥å…· https://github.com/jesseduffield/lazydocker\n9. dive é•œåƒæŸ¥çœ‹å·¥å…· https://github.com/wagoodman/dive\n10. corc æ–‡ä»¶è½¬å‘å·¥å…·ï¼ˆä»»æ„ä¸»æœºï¼‰ (å¼ºçƒˆæ¨è) https://github.com/schollz/croc\n11. asciinema ç»ˆç«¯ä¼šè¯è®°å½•å·¥å…· https://github.com/asciinema/asciinema\n12. tree ç›®å½•æ ‘å·¥å…· sudo apt-get install tree\n13. Dev hints æŠ€æœ¯é€ŸæŸ¥è¡¨ https://devhints.io/\n15. utools å¿«æ·å¯åŠ¨å·¥å…· (å¼ºçƒˆæ¨è) https://u.tools/\n16. è¯­é›€ æ–‡æ¡£å†™ä½œå·¥å…·ï¼ˆå›¢é˜Ÿ/ä¸ªäººï¼‰ https://www.yuque.com/\n17. fehelper ä¸€äº›å°å·¥å…·çš„é›†åˆï¼ˆæµè§ˆå™¨æ’ä»¶ï¼‰(å¼ºçƒˆæ¨è) https://www.baidufe.com/fehelper/index/index.html\n18. Dark Reader ä¸€é”®åˆ‡æ¢é¡µé¢é£æ ¼ï¼ˆæµè§ˆå™¨æ’ä»¶ï¼‰ https://chrome.google.com/webstore/detail/dark-reader/eimadpbcbfnmbkopoojfekhnkhdbieeh\n19. Octotree githubç›®å½•æ ‘æ’ä»¶ï¼ˆæµè§ˆå™¨æ’ä»¶ï¼‰ https://chrome.google.com/webstore/detail/octotree-github-code-tree/bkhaagjahfmjljalopjnoealnfndnagc\n20. Surfingkeys åƒæ“ä½œvimä¸€æ ·æ“ä½œæµè§ˆå™¨ï¼ˆæµè§ˆå™¨æ’ä»¶ï¼‰ https://chrome.google.com/webstore/detail/surfingkeys/gfbliohnnapiefjpjlpjnehglfpaknnc\n21. roboform å¯†ç ç®¡ç†å™¨ http://www.roboform.com/\n22. oneTab æ ‡ç­¾é¡µç®¡ç†ï¼šä¸€é”®æ”¶é›†ï¼Œä¸€é”®è¿˜åŸ ï¼ˆæµè§ˆå™¨æ’ä»¶ï¼‰ https://chrome.google.com/webstore/detail/onetab/chphlpgkkbolifaimnlloiipkdnihall\n23. transform æ–‡æœ¬è½¬åŒ–å·¥å…· https://transform.tools/\n24. smartpdf pdfå¤„ç†å·¥å…· https://smartpdf.org/\n25. (Linux) é¡¹ç›®ç®¡ç†è½¯ä»¶ ProjectLibre\n26. (Linux) æ—¥ç¨‹ç®¡ç† Planner https://planner-todo.web.app/\n27. (Linux) flathubè½¯ä»¶å•†åº— https://flathub.org/home\n28. (Linux) UnOfficial Microsoft Todo https://github.com/davidsmorais/kuro\n29. (Linux) å¯åŠ¨ç›˜åˆ¶ä½œ balena etcher https://www.balena.io/etcher\n30. æ²™æ‹‰æŸ¥è¯ - é«˜æ•ˆçš„ç½‘é¡µç¿»è¯‘å·¥å…· https://saladict.crimx.com/\n31. Astral - ç®¡ç†GitHubä¸Šstarçš„é¡¹ç›® https://app.astralapp.com/\n32. SnippetsLab - ä»£ç ç‰‡æ®µç®¡ç†å·¥å…·(MAC) https://www.renfei.org/snippets-lab/\n33. CodeRunner çŸ­ä»£ç æµ‹è¯•å·¥å…·ï¼ˆMACï¼‰ https://coderunnerapp.com/\n34. syncthing å¤šè®¾å¤‡åŒæ­¥å·¥å…·ï¼ˆå…¨å¹³å°ï¼‰ https://syncthing.net/downloads/\n35. ForkLift3 MACæ–‡ä»¶ç®¡ç† https://binarynights.com/\n36. cockos gifå½•åˆ¶å·¥å…·(windows, mac) https://www.cockos.com/licecap/\n37. peek gifåŠ¨ç”»å½•åˆ¶å·¥å…· https://github.com/phw/peek\n38. airmail MACé‚®ä»¶å®¢æˆ·ç«¯ https://airmailapp.com/\n39. shortcat ä¸¢æ‰é¼ æ ‡ï¼Œä½¿ç”¨é”®ç›˜(MAC) https://shortcat.app/\n40. manictime è·¨å¹³å°æ—¶é—´è¿½è¸ªå·¥å…· https://www.manictime.com/linux/download\n41. hammerspoon ä¸€æ¬¾å…è´¹åˆå¼ºå¤§çš„ macOS è‡ªåŠ¨åŒ–å·¥å…· http://www.hammerspoon.org/\n42. Wave Terminal ä¸€ä¸ªç±»ä¼¼wrapçš„æ–°ç»ˆç«¯ï¼š https://www.warp.dev/\n","permalink":"http://yangchnet.github.io/Dessert/posts/tool/%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88/","summary":"1. draw.io åœ¨çº¿ç”»å›¾å·¥å…· https://app.diagrams.net/\n2. sql to Gorm SQLè¯­å¥è½¬åŒ–ä¸ºgoç»“æ„ä½“ https://sql2gorm.mccode.info/\n3. ä¸€äº›ç¼–ç¨‹å­—ä½“ https://www.nerdfonts.com/font-downloads\n4. å›¢é˜Ÿåä½œå·¥å…· https://www.devbefore.com/product\n5. markdown å†™ä½œå·¥å…·ï¼ˆå¼€æºå…è´¹ï¼‰ https://marktext.app/\n6. z ç›®å½•å¿«é€Ÿè·³è½¬ (å¼ºçƒˆæ¨è) https://github.com/rupa/z (å®‰è£…)https://yangchnet.github.io/Dessert/posts/tool/z/\n7. nvm npmå¤šç‰ˆæœ¬ç®¡ç† (å¼ºçƒˆæ¨è) https://github.com/nvm-sh/nvm\n8. lazydocker å®¹å™¨æŸ¥çœ‹å·¥å…· https://github.com/jesseduffield/lazydocker\n9. dive é•œåƒæŸ¥çœ‹å·¥å…· https://github.com/wagoodman/dive\n10. corc æ–‡ä»¶è½¬å‘å·¥å…·ï¼ˆä»»æ„ä¸»æœºï¼‰ (å¼ºçƒˆæ¨è) https://github.com/schollz/croc\n11. asciinema ç»ˆç«¯ä¼šè¯è®°å½•å·¥å…· https://github.com/asciinema/asciinema\n12. tree ç›®å½•æ ‘å·¥å…· sudo apt-get install tree\n13. Dev hints æŠ€æœ¯é€ŸæŸ¥è¡¨ https://devhints.io/\n15. utools å¿«æ·å¯åŠ¨å·¥å…· (å¼ºçƒˆæ¨è) https://u.tools/\n16. è¯­é›€ æ–‡æ¡£å†™ä½œå·¥å…·ï¼ˆå›¢é˜Ÿ/ä¸ªäººï¼‰ https://www.yuque.com/\n17. fehelper ä¸€äº›å°å·¥å…·çš„é›†åˆï¼ˆæµè§ˆå™¨æ’ä»¶ï¼‰(å¼ºçƒˆæ¨è) https://www.","title":"å¸¸ç”¨å·¥å…·é›†åˆ"},{"content":"ä¸‰åˆ†ç†è®º - ç¬¬ä¸€é˜¶æ®µ æ¥å—ä½ çš„å­˜åœ¨ 0-1åˆ† - ç¬¬äºŒé˜¶æ®µ ä¹ æƒ¯ä½ çš„å­˜åœ¨ 1-2åˆ† - ç¬¬ä¸‰é˜¶æ®µ ä¾èµ–ä½ çš„å­˜åœ¨ 2-3åˆ† 0.7ä»¥ä¸Šå°±å¯ä»¥è¡¨ç™½ï¼Œ2åˆ†ä»¥ä¸Šå¯ç»“å©š\nä¸‰è‰ç†è®º å…”å­ä¸åƒçªè¾¹è‰ å¥½é©¬ä¸åƒå›å¤´è‰ å¤©æ¶¯ä½•å¤„æ— èŠ³è‰ æ¥è‡ªæ”€ç§‘åŒå¿—~\né”šç‚¹ä¸æ–—äº‰ç†è®ºï¼ˆWIPï¼‰ é©¬å…‹æ€è¯´ï¼šäººæ˜¯æ‰€æœ‰ç¤¾ä¼šå…³ç³»çš„æ€»å’Œã€‚è€Œå¦‚æœç”¨ä¸€å¼ å›¾æ¥æè¿°ç¤¾ä¼šå…³ç³»çš„è¯ï¼Œå¯¹äºä¸åŒçš„ç¤¾ä¼šå…³ç³»ï¼Œç‚¹ä¸ç‚¹ä¹‹é—´çš„æƒé‡ï¼ˆè¾¹çš„ç²—ç»†ï¼‰æ˜¯ä¸åŒçš„ï¼Œæ›´å¤§çš„æƒé‡å¯ä»¥å½¢è±¡çš„ç†è§£ä¸ºï¼šæ›´ä¸ºäº²å¯†çš„å…³ç³»ï¼ˆæ›´ç²—çš„çº¿ï¼‰ã€‚äººä¸ç¤¾ä¼šï¼ˆç»„ç»‡ï¼‰ä¸­æ‰€æœ‰å…¶ä»–äººçš„å…³ç³»ï¼Œå…±åŒç»„æˆäº†äººå¯¹è¿™ä¸ªç»„ç»‡ï¼ˆç¤¾ä¼šï¼‰çš„å½’å±æ„Ÿã€‚è€Œå…¶ä¸­æœ€äº²å¯†çš„å…³ç³»ï¼Œå¯ä»¥ç§°ä¸ºäººåœ¨è¿™ä¸ªç»„ç»‡çš„é”šç‚¹ï¼Œåœ¨æ‹çˆ±ä¸­ï¼Œæ‹çˆ±çš„å¯¹è±¡å°±æ˜¯è¿™ä¸ªé”šç‚¹ã€‚\nåœ¨æ‹çˆ±ä¸­ï¼Œä¸¤ä¸ªäººæœ‰çŸ›ç›¾æ˜¯æ­£å¸¸çš„ï¼Œè€ŒçŸ›ç›¾ç»ˆç©¶è¦é€šè¿‡æ–—äº‰çš„å½¢å¼ï¼Œæœ€ç»ˆä»¥æŸä¸€æ–¹çš„å¦¥åç»“æŸã€‚æ–—äº‰çš„è¿‡ç¨‹ï¼Œæ˜¯ä¸€ä¸ªæ±‚åŒå­˜å¼‚çš„è¿‡ç¨‹ï¼Œæ²¡æœ‰æ–—äº‰ï¼Œé å†·æˆ˜ã€éæš´åŠ›ä¸åˆä½œç­‰å½¢å¼å¾—æ¥çš„å¦¥åï¼Œæ˜¯ä¸å½»åº•çš„ã€‚å°±å¥½æ¯”ä¸­å›½ä¸å°åº¦çš„æ°‘æ—ç‹¬ç«‹è¿‡ç¨‹ï¼Œä¸­å›½ä»¥æ­¦è£…æ–—äº‰è¿›è¡ŒæŠ—äº‰ï¼Œå°åº¦ä»¥â€œéæš´åŠ›ä¸åˆä½œâ€ã€ç»é£Ÿç­‰å½¢å¼æŠ—äº‰ï¼Œæœ€ç»ˆå¾—æ¥çš„å¦¥åï¼Œä¸€ä¸ªæ˜¯ä»ä¸Šåˆ°ä¸‹ï¼Œå½»å½»åº•åº•çš„ï¼Œä¸€ä¸ªæ˜¯è¡¨é¢åŠŸå¤«ï¼Œç»£èŠ±æ•å¤´ã€‚\n","permalink":"http://yangchnet.github.io/Dessert/posts/%E6%9D%82%E8%AE%B0/%E6%81%8B%E7%88%B1%E7%90%86%E8%AE%BA/","summary":"ä¸‰åˆ†ç†è®º - ç¬¬ä¸€é˜¶æ®µ æ¥å—ä½ çš„å­˜åœ¨ 0-1åˆ† - ç¬¬äºŒé˜¶æ®µ ä¹ æƒ¯ä½ çš„å­˜åœ¨ 1-2åˆ† - ç¬¬ä¸‰é˜¶æ®µ ä¾èµ–ä½ çš„å­˜åœ¨ 2-3åˆ† 0.7ä»¥ä¸Šå°±å¯ä»¥è¡¨ç™½ï¼Œ2åˆ†ä»¥ä¸Šå¯ç»“å©š\nä¸‰è‰ç†è®º å…”å­ä¸åƒçªè¾¹è‰ å¥½é©¬ä¸åƒå›å¤´è‰ å¤©æ¶¯ä½•å¤„æ— èŠ³è‰ æ¥è‡ªæ”€ç§‘åŒå¿—~\né”šç‚¹ä¸æ–—äº‰ç†è®ºï¼ˆWIPï¼‰ é©¬å…‹æ€è¯´ï¼šäººæ˜¯æ‰€æœ‰ç¤¾ä¼šå…³ç³»çš„æ€»å’Œã€‚è€Œå¦‚æœç”¨ä¸€å¼ å›¾æ¥æè¿°ç¤¾ä¼šå…³ç³»çš„è¯ï¼Œå¯¹äºä¸åŒçš„ç¤¾ä¼šå…³ç³»ï¼Œç‚¹ä¸ç‚¹ä¹‹é—´çš„æƒé‡ï¼ˆè¾¹çš„ç²—ç»†ï¼‰æ˜¯ä¸åŒçš„ï¼Œæ›´å¤§çš„æƒé‡å¯ä»¥å½¢è±¡çš„ç†è§£ä¸ºï¼šæ›´ä¸ºäº²å¯†çš„å…³ç³»ï¼ˆæ›´ç²—çš„çº¿ï¼‰ã€‚äººä¸ç¤¾ä¼šï¼ˆç»„ç»‡ï¼‰ä¸­æ‰€æœ‰å…¶ä»–äººçš„å…³ç³»ï¼Œå…±åŒç»„æˆäº†äººå¯¹è¿™ä¸ªç»„ç»‡ï¼ˆç¤¾ä¼šï¼‰çš„å½’å±æ„Ÿã€‚è€Œå…¶ä¸­æœ€äº²å¯†çš„å…³ç³»ï¼Œå¯ä»¥ç§°ä¸ºäººåœ¨è¿™ä¸ªç»„ç»‡çš„é”šç‚¹ï¼Œåœ¨æ‹çˆ±ä¸­ï¼Œæ‹çˆ±çš„å¯¹è±¡å°±æ˜¯è¿™ä¸ªé”šç‚¹ã€‚\nåœ¨æ‹çˆ±ä¸­ï¼Œä¸¤ä¸ªäººæœ‰çŸ›ç›¾æ˜¯æ­£å¸¸çš„ï¼Œè€ŒçŸ›ç›¾ç»ˆç©¶è¦é€šè¿‡æ–—äº‰çš„å½¢å¼ï¼Œæœ€ç»ˆä»¥æŸä¸€æ–¹çš„å¦¥åç»“æŸã€‚æ–—äº‰çš„è¿‡ç¨‹ï¼Œæ˜¯ä¸€ä¸ªæ±‚åŒå­˜å¼‚çš„è¿‡ç¨‹ï¼Œæ²¡æœ‰æ–—äº‰ï¼Œé å†·æˆ˜ã€éæš´åŠ›ä¸åˆä½œç­‰å½¢å¼å¾—æ¥çš„å¦¥åï¼Œæ˜¯ä¸å½»åº•çš„ã€‚å°±å¥½æ¯”ä¸­å›½ä¸å°åº¦çš„æ°‘æ—ç‹¬ç«‹è¿‡ç¨‹ï¼Œä¸­å›½ä»¥æ­¦è£…æ–—äº‰è¿›è¡ŒæŠ—äº‰ï¼Œå°åº¦ä»¥â€œéæš´åŠ›ä¸åˆä½œâ€ã€ç»é£Ÿç­‰å½¢å¼æŠ—äº‰ï¼Œæœ€ç»ˆå¾—æ¥çš„å¦¥åï¼Œä¸€ä¸ªæ˜¯ä»ä¸Šåˆ°ä¸‹ï¼Œå½»å½»åº•åº•çš„ï¼Œä¸€ä¸ªæ˜¯è¡¨é¢åŠŸå¤«ï¼Œç»£èŠ±æ•å¤´ã€‚","title":"æ‹çˆ±ç†è®º"},{"content":"è·Ÿè—ç‹ğŸ¦Šå­¦çš„ä¸€æ‹›ã€‚\nåŸæ–™ï¼šåœŸè±†2æšã€ç¡¼é…¸ã€ç™½ç³–\næ­¥éª¤ï¼š\n ä¸¤ä¸ªåœŸè±†è’¸ç†Ÿç¢¾æˆæ³¥ åœŸè±†æ³¥åŠ ä¸¤å‹ºç¡¼é…¸ï¼Œä¸¤å‹ºç³–ï¼Œæ…æ‹Œå‡åŒ€ ææˆå›¢å­ï¼Œæ”¾åœ¨èŸ‘è‚å‡ºæ²¡çš„åœ°æ–¹ ä¸€å‘¨åï¼ŒèŸ‘è‚ä¸è§äº†ã€‚ã€‚  ","permalink":"http://yangchnet.github.io/Dessert/posts/%E7%94%9F%E6%B4%BB/%E9%99%A4%E8%9F%91%E8%9E%82%E5%B0%8F%E5%A6%99%E6%8B%9B/","summary":"è·Ÿè—ç‹ğŸ¦Šå­¦çš„ä¸€æ‹›ã€‚\nåŸæ–™ï¼šåœŸè±†2æšã€ç¡¼é…¸ã€ç™½ç³–\næ­¥éª¤ï¼š\n ä¸¤ä¸ªåœŸè±†è’¸ç†Ÿç¢¾æˆæ³¥ åœŸè±†æ³¥åŠ ä¸¤å‹ºç¡¼é…¸ï¼Œä¸¤å‹ºç³–ï¼Œæ…æ‹Œå‡åŒ€ ææˆå›¢å­ï¼Œæ”¾åœ¨èŸ‘è‚å‡ºæ²¡çš„åœ°æ–¹ ä¸€å‘¨åï¼ŒèŸ‘è‚ä¸è§äº†ã€‚ã€‚  ","title":"é™¤èŸ‘è‚å°å¦™æ‹›"},{"content":"1. è´Ÿè½½å‡è¡¡çš„ä½œç”¨ è´Ÿè½½å‡è¡¡ï¼ˆLoad Balance LBï¼‰ï¼Œæ˜¯é€šè¿‡å•ä¸€çš„å…¥å£ï¼Œä½¿ç”¨æŸäº›ç®—æ³•ï¼Œå¯¹ç”¨æˆ·æµé‡è¿›è¡Œåˆ†å‘ï¼Œä½¿ç”¨æˆ·è¯·æ±‚åˆç†çš„åˆ†é…åˆ°å¤šä¸ªæœåŠ¡å™¨èŠ‚ç‚¹ä¸­çš„ä¸€ç§æŠ€æœ¯ã€‚\nç°ä»£åº”ç”¨é€šå¸¸éœ€è¦åŒæ—¶å¯¹å¤§é‡ç”¨æˆ·æä¾›æœåŠ¡ï¼Œæ­¤æ—¶å•å°æœºå™¨å·²ç»éš¾ä»¥æ‰¿æ‹…è¿™äº›éœ€æ±‚ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨å¤šä¸ªèŠ‚ç‚¹åŒæ—¶ä¸ºç”¨æˆ·æä¾›æœåŠ¡ï¼Œä½†æ˜¾ç„¶ä¸èƒ½è®©ç”¨æˆ·è®°ä½å¤šä¸ªåŸŸåç”šè‡³IPã€‚LBä½äºç”¨æˆ·ä¸æœåŠ¡å™¨é›†ç¾¤ä¹‹é—´ï¼Œå……å½“ä¸å¯è§çš„åè°ƒè€…ï¼Œç¡®ä¿å‡ç­‰ä½¿ç”¨æ‰€æœ‰èµ„æºæœåŠ¡å™¨ã€‚\n2. DNSè´Ÿè½½å‡è¡¡ åŸºäºDNSçš„è´Ÿè½½å‡è¡¡æ¯”è¾ƒç®€å•ï¼Œå…¶åŸç†æ˜¯ä¸ºä¸€ä¸ªåŸŸåé…ç½®å¤šä¸ªAè®°å½•ï¼Œè¿™æ ·å½“å¯¹åŸŸåè¿›è¡Œè¯·æ±‚æ—¶ï¼Œå°±å¯ä»¥é€šè¿‡è¿”å›ä¸åŒçš„åŸŸåè¿›è¡Œæµé‡çš„åˆ†é…ã€‚\nä¸€ç§æœ€å¸¸è§çš„ DNS è´Ÿè½½å¹³è¡¡æŠ€æœ¯æ˜¯å¾ªç¯ DNSã€‚å³åœ¨è¯·æ±‚åˆ°æ¥æ—¶ï¼ŒIPåœ°å€ä»¥å¾ªç¯æ–¹å¼è½®æ¢è¿”å›ï¼Œè¯·è¯·æ±‚åˆ†æ•£åˆ°å…³è”çš„æœåŠ¡å™¨ä¸Šã€‚\nå½“ç„¶ï¼Œä¹Ÿå¯ä»¥é‡‡ç”¨å…¶ä»–è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œä¾‹å¦‚æ ¹æ®IPåœ°å€çš„åœ°åŸŸç­‰åˆ†é…è¾ƒåŠ²çš„æœåŠ¡å™¨ã€‚\n3. å››å±‚LBä¸ä¸ƒå±‚LB ä»å½¢å¼ä¸Šæ¥è¯´LBéƒ½å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼šå››å±‚è´Ÿè½½å‡è¡¡å’Œä¸ƒå±‚è´Ÿè½½å‡è¡¡ã€‚å…¶ä¸­å››å±‚è´Ÿè½½å‡è¡¡çš„ä¼˜åŠ¿æ˜¯æ€§èƒ½é«˜ï¼Œä¸ƒå±‚è´Ÿè½½å‡è¡¡çš„ä¼˜åŠ¿æ˜¯åŠŸèƒ½å¼ºã€‚è¿™é‡Œçš„å››å±‚ã€ä¸ƒå±‚æŒ‡çš„æ˜¯OSIç½‘ç»œåˆ†å±‚æ ‡å‡†ä¸­çš„ç¬¬å››å±‚ä¼ è¾“å±‚å’Œç¬¬ä¸ƒå±‚åº”ç”¨å±‚ã€‚\n3.1 å››å±‚LB è¿™é‡Œå­˜åœ¨ä¸€ä¸ªè¯¯è§£: **å››å±‚è´Ÿè½½å‡è¡¡å¹¶ä¸æ˜¯åªå·¥ä½œåœ¨ç¬¬å››å±‚ä¼ è¾“å±‚ï¼Œäº‹å®ä¸Šå®ƒä»¬ä¸»è¦å·¥ä½œåœ¨äºŒå±‚ï¼ˆæ•°æ®é“¾è·¯å±‚ï¼‰å’Œä¸‰å±‚ï¼ˆç½‘ç»œå±‚ï¼‰ä¸Šã€‚**æ ¹æ®OSIæ¨¡å‹ï¼Œå½“æ•°æ®åŒ…åˆ°è¾¾ç¬¬å››å±‚ï¼Œå…¶å®å·²ç»åˆ°è¾¾äº†ç›®æ ‡ä¸»æœºä¸Šï¼Œæ‰€ä»¥æ­¤æ—¶æ˜¾ç„¶ä¸å­˜åœ¨ä»€ä¹ˆæµé‡è½¬å‘äº†ã€‚å››å±‚è´Ÿè½½å‡è¡¡çš„çœŸæ­£å«ä¹‰æ˜¯ï¼šè¿™äº›å·¥ä½œæ¨¡å¼çš„å…±åŒç‰¹ç‚¹æ˜¯éƒ½ç»´æŒç€åŒä¸€ä¸ªTCPè¿æ¥ã€‚\næ•°æ®é“¾è·¯å±‚LB\næ•°æ®é“¾è·¯å±‚æ•°æ®å¸§ä¸­åŒ…æ‹¬æœ‰ç›®çš„MACåœ°å€å’ŒæºMACåœ°å€ï¼Œæ•°æ®é“¾è·¯å±‚è´Ÿè½½å‡è¡¡æ‰€åšçš„å·¥ä½œï¼Œæ˜¯ä¿®æ”¹è¯·æ±‚çš„æ•°æ®å¸§ä¸­çš„ MAC ç›®æ ‡åœ°å€ï¼Œè®©ç”¨æˆ·åŸæœ¬æ˜¯å‘é€ç»™è´Ÿè½½å‡è¡¡å™¨çš„è¯·æ±‚çš„æ•°æ®å¸§ï¼Œè¢«äºŒå±‚äº¤æ¢æœºæ ¹æ®æ–°çš„ MAC ç›®æ ‡åœ°å€ï¼Œè½¬å‘åˆ°æœåŠ¡å™¨é›†ç¾¤ä¸­ï¼Œå¯¹åº”çš„æœåŠ¡å™¨çš„ç½‘å¡ä¸Šï¼Œè¿™æ ·çœŸå®æœåŠ¡å™¨å°±è·å¾—äº†ä¸€ä¸ªåŸæœ¬ç›®æ ‡å¹¶ä¸æ˜¯å‘é€ç»™å®ƒçš„æ•°æ®å¸§ã€‚\næ•°æ®é“¾è·¯å±‚çš„è´Ÿè½½å‡è¡¡åªå¯¹ç›®æ ‡MACåœ°å€è¿›è¡Œäº†ä¿®æ”¹ï¼Œä¸æ¶‰åŠå…¶ä»–å±‚æ¬¡ï¼Œå› æ­¤å¯¹äºæ›´ä¸Šå±‚çš„ç½‘ç»œå±‚æ¥è¯´ï¼Œæ•°æ®æ˜¯æ— å˜åŒ–çš„ï¼Œè¿™æ ·ç½‘ç»œå±‚æ‰èƒ½æ­£å¸¸å·¥ä½œã€‚\nè¿™æ˜¯å› ä¸ºç¬¬ä¸‰å±‚çš„æ•°æ®åŒ…ï¼Œä¹Ÿå°±æ˜¯ IP æ•°æ®åŒ…ä¸­ï¼ŒåŒ…å«äº†æºï¼ˆå®¢æˆ·ç«¯ï¼‰å’Œç›®æ ‡ï¼ˆå‡è¡¡å™¨ï¼‰çš„ IP åœ°å€ï¼Œåªæœ‰çœŸå®æœåŠ¡å™¨ä¿è¯è‡ªå·±çš„ IP åœ°å€ä¸æ•°æ®åŒ…ä¸­çš„ç›®æ ‡ IP åœ°å€ä¸€è‡´ï¼Œè¿™ä¸ªæ•°æ®åŒ…æ‰èƒ½è¢«æ­£ç¡®å¤„ç†ã€‚\næ‰€ä»¥ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨è¿™ç§è´Ÿè½½å‡è¡¡æ¨¡å¼çš„æ—¶å€™ï¼Œéœ€è¦æŠŠçœŸå®ç‰©ç†æœåŠ¡å™¨é›†ç¾¤æ‰€æœ‰æœºå™¨çš„è™šæ‹Ÿ IP åœ°å€ï¼ˆVirtual IP Addressï¼ŒVIPï¼‰ï¼Œé…ç½®æˆè·Ÿè´Ÿè½½å‡è¡¡å™¨çš„è™šæ‹Ÿ IP ä¸€æ ·ï¼Œè¿™æ ·ç»å‡è¡¡å™¨è½¬å‘åçš„æ•°æ®åŒ…ï¼Œå°±èƒ½åœ¨çœŸå®æœåŠ¡å™¨ä¸­é¡ºåˆ©åœ°ä½¿ç”¨ã€‚\nå¦å¤–ï¼Œä¹Ÿæ­£æ˜¯å› ä¸ºå®é™…å¤„ç†è¯·æ±‚çš„çœŸå®ç‰©ç†æœåŠ¡å™¨ IP å’Œæ•°æ®è¯·æ±‚ä¸­çš„ç›®çš„ IP æ˜¯ä¸€è‡´çš„ï¼Œæ‰€ä»¥å“åº”ç»“æœå°±ä¸å†éœ€è¦é€šè¿‡è´Ÿè½½å‡è¡¡æœåŠ¡å™¨è¿›è¡Œåœ°å€äº¤æ¢ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå“åº”ç»“æœçš„æ•°æ®åŒ…ç›´æ¥ä»çœŸå®æœåŠ¡å™¨è¿”å›ç»™ç”¨æˆ·çš„å®¢æˆ·ç«¯ï¼Œé¿å…è´Ÿè½½å‡è¡¡å™¨ç½‘å¡å¸¦å®½æˆä¸ºç“¶é¢ˆï¼Œæ‰€ä»¥æ•°æ®é“¾è·¯å±‚çš„è´Ÿè½½å‡è¡¡æ•ˆç‡æ˜¯ç›¸å½“é«˜çš„ã€‚\nè¿™ç§ä¼ è¾“æ–¹å¼è¢«ç§°ä¸ºä¸‰è§’ä¼ è¾“ï¼Œè¿”å›çš„æµé‡ä¸ç»è¿‡LBï¼Œé¿å…è´Ÿè½½å‡è¡¡å™¨ç½‘å¡å¸¦å®½æˆä¸ºç“¶é¢ˆï¼Œæ•ˆç‡è¾ƒé«˜.\næ•°æ®é“¾è·¯å±‚çš„åŠ£åŠ¿ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œå› ä¸ºå…¶éœ€è¦é€šè¿‡ä¿®æ”¹MACåœ°å€çš„æ–¹å¼è¿›è¡Œå·¥ä½œï¼Œå› æ­¤çœŸå®ç›®æ ‡æœåŠ¡å™¨å¿…é¡»å’ŒLBæœåŠ¡å™¨åœ¨åŒä¸€å­ç½‘ä¸‹ã€‚\nç½‘ç»œå±‚LB\nä¸æ•°æ®é“¾è·¯å±‚ç±»ä¼¼çš„ï¼Œç½‘ç»œå±‚æ˜¯é€šè¿‡ä¿®æ”¹ä¸‰å±‚æ•°æ®åŒ…çš„ç›®æ ‡IPåœ°å€è¿›è¡Œå·¥ä½œï¼š\nå…¶ä¿®æ”¹æ–¹å¼ä¸»è¦æœ‰ä¸¤ç§ï¼š\n ç¬¬ä¸€ç§æ˜¯ä¿æŒåŸæ¥çš„æ•°æ®åŒ…ä¸å˜ï¼Œæ–°åˆ›å»ºä¸€ä¸ªæ•°æ®åŒ…ï¼ŒæŠŠåŸæ¥æ•°æ®åŒ…çš„ Headers å’Œ Payload æ•´ä½“ä½œä¸ºå¦ä¸€ä¸ªæ–°çš„æ•°æ®åŒ…çš„ Payloadï¼Œåœ¨è¿™ä¸ªæ–°æ•°æ®åŒ…çš„ Headers ä¸­ï¼Œå†™å…¥çœŸå®æœåŠ¡å™¨çš„ IP ä½œä¸ºç›®æ ‡åœ°å€ï¼Œç„¶åæŠŠå®ƒå‘é€å‡ºå»ã€‚  è¿™ç§æ–¹å¼éœ€è¦åœ¨æ¥æ”¶æ—¶é‡æ–°è¿›è¡Œæ‹†åŒ…ï¼Œå–å‡ºåŸæ¥è¦å‘é€çš„æ•°æ®åŒ…ï¼Œè¿™æ ·ï¼ŒIPæ•°æ®åŒ…çš„æºIPå’Œç›®çš„IPæ— å˜åŒ–ï¼ŒçœŸå®æœåŠ¡å™¨ä»ç„¶å¯ä»¥ç›´æ¥å°†æ•°æ®å‘é€ç»™å®¢æˆ·ç«¯ï¼Œä¸éœ€è¦ç»è¿‡LBï¼Œä¹Ÿå³ä»å…·æœ‰ä¸‰è§’ä¼ è¾“çš„ç‰¹æ€§ã€‚\nè¿™ç§æ–¹å¼è¢«ç§°ä¸ºIPéš§é“ï¼Œå› ä¸ºå…¶å·¥ä½œåœ¨ç½‘ç»œå±‚ï¼Œå¯ä»¥è·¨VLANè¿›è¡Œä¼ è¾“ï¼Œä½†è¦æ±‚ç›®æ ‡æœåŠ¡å™¨æ”¯æŒIPéš§é“åè®®ã€‚\n ç¬¬äºŒç§æ–¹å¼ç›´æ¥æŠŠæ•°æ®åŒ… Headers ä¸­çš„ç›®æ ‡åœ°å€æ”¹æ‰ï¼Œä¿®æ”¹ååŸæœ¬ç”±ç”¨æˆ·å‘ç»™å‡è¡¡å™¨çš„æ•°æ®åŒ…ï¼Œä¹Ÿä¼šè¢«ä¸‰å±‚äº¤æ¢æœºè½¬å‘é€åˆ°çœŸå®æœåŠ¡å™¨çš„ç½‘å¡ä¸Šï¼Œè€Œä¸”å› ä¸ºæ²¡æœ‰ç»è¿‡ IP éš§é“çš„é¢å¤–åŒ…è£…ï¼Œä¹Ÿå°±æ— éœ€å†æ‹†åŒ…äº†ã€‚  ä½†è¿™æ ·çš„è¯ï¼ŒçœŸå®æœåŠ¡å™¨åœ¨å°†æ•°æ®è¿”å›ç»™å®¢æˆ·ç«¯æ—¶ï¼Œå°±ä¼šä½¿ç”¨è‡ªå·±çš„IPä½œä¸ºæºIPï¼Œå®¢æˆ·ç«¯ä¸€çœ‹ï¼šâ€œæˆ‘æƒ³è¦çš„æ˜¯AæœåŠ¡å™¨å“åº”ï¼Œä½ ç»™æˆ‘æ¥äº†ä¸ªBæœåŠ¡å™¨å“åº”ï¼Œæ»šçŠŠå­â€ï¼Œä¸èƒ½æ­£å¸¸å¤„ç†è¿™ä¸ªåº”ç­”ï¼Œå› æ­¤å¿…é¡»è®©å“åº”è¿”å›LBå†å‘ç»™å®¢æˆ·ç«¯ã€‚\nè¿™ç§æ–¹å¼ç±»ä¼¼äºNATåè®®ï¼Œä¹Ÿå› æ­¤è¢«ç§°ä¸ºNATæ¨¡å¼çš„è´Ÿè½½å‡è¡¡ã€‚ç”±äºæ‰€æœ‰çš„æµé‡éƒ½éœ€è¦LBè¿›è¡Œè½¬å‘ï¼Œå› æ­¤è¿™ç§æ–¹å¼çš„æ•ˆç‡ç›¸å¯¹è¾ƒä½ã€‚\nè¿˜æœ‰ä¸€ç§æ›´åŠ å½»åº•çš„æ–¹å¼Source NATï¼ˆSNATï¼‰ï¼ŒLBä¸ä»…å°†ç›®æ ‡IPä¿®æ”¹ä¸ºçœŸå®æœåŠ¡å™¨åœ°å€ï¼Œè€Œä¸”å°†æºIPä¹Ÿä¿®æ”¹ä¸ºè‡ªå·±çš„IPåœ°å€ã€‚è¿™æ ·åšçš„å¥½å¤„åœ¨äºå¯¹äºçœŸå®æœåŠ¡å™¨æ˜¯å½»åº•é€æ˜çš„ï¼Œä½†ä¼šä¸¢å¤±å®¢æˆ·ç«¯IPä¿¡æ¯ã€‚\n3.2 ä¸ƒå±‚LB æ•°æ®é“¾è·¯å±‚LBå’Œç½‘ç»œå±‚LBéƒ½æ˜¯â€œè½¬å‘â€æ¨¡å¼ï¼Œå³ç›´æ¥å°†æ‰¿è½½ç€TCPæŠ¥æ–‡çš„åº•å±‚æ•°æ®åŒ…è½¬å‘åˆ°çœŸå®æœåŠ¡å™¨ä¸Šï¼Œæ­¤æ—¶å®¢æˆ·ç«¯åˆ°å“åº”è¯·æ±‚çš„çœŸå®æœåŠ¡å™¨ç»´æŒç€åŒä¸€æ¡ TCP é€šé“ï¼Œå³å®¢æˆ·ç«¯é€šè¿‡ä¸€ä¸ªTCPè¿æ¥ç›´æ¥è·ŸçœŸå®æœåŠ¡å™¨å¯¹è¯ã€‚\nä½†å·¥ä½œåœ¨å››å±‚åçš„LBä¸èƒ½ä»¥è¿™ç§æ–¹å¼å·¥ä½œï¼ˆå››å±‚ä»¥ä¸Šçœ‹ä¸åˆ°TCPæ•°æ®åŒ…ï¼‰ï¼Œå¿…é¡»é€šè¿‡â€œä»£ç†â€çš„æ–¹å¼ï¼Œæ­¤æ—¶ï¼Œå®¢æˆ·ç«¯ä¸çœŸå®æœåŠ¡å™¨ä¹‹é—´æ²¡æœ‰ç›´è¿çš„TCPè¿æ¥ï¼Œè€Œæ˜¯é€šè¿‡å®¢æˆ·ç«¯-LBï¼ŒLB-çœŸå®æœåŠ¡å™¨ä¸¤ä¸ªè¿æ¥æ¥è¿›è¡Œå¯¹è¯ã€‚\nè¿™æ ·ï¼Œä¸ƒå±‚è´Ÿè½½å‡è¡¡å™¨è‚¯å®šæ˜¯æ— è®ºå¦‚ä½•æ¯”ä¸è¿‡å››å±‚è´Ÿè½½å‡è¡¡å™¨çš„ã€‚æ¯•ç«Ÿå®ƒæ¯”å››å±‚è´Ÿè½½å‡è¡¡å™¨è‡³å°‘è¦å¤šä¸€è½® TCP æ¡æ‰‹ï¼Œè¿˜æœ‰ç€è·Ÿ NAT è½¬å‘æ¨¡å¼ä¸€æ ·çš„å¸¦å®½é—®é¢˜ï¼Œè€Œä¸”é€šå¸¸è¦è€—è´¹æ›´å¤šçš„ CPUï¼Œå› ä¸ºå¯ç”¨çš„è§£æè§„åˆ™è¿œæ¯”å››å±‚ä¸°å¯Œã€‚\nä½†ä¸ƒå±‚LBå¯ä»¥æ„ŸçŸ¥åº”ç”¨å±‚é€šè®¯çš„å…·ä½“å†…å®¹ï¼Œè¿™å°±æ„å‘³ç€å®ƒèƒ½å¤Ÿåšå‡ºæ›´æ˜æ™ºçš„å†³ç­–ï¼Œç©å‡ºæ›´å¤šçš„èŠ±æ ·æ¥ï¼š\n ä¸ƒå±‚LBå¯ä»¥ç”¨æ¥åšé™æ€èµ„æºç¼“å­˜ã€åè®®å‡çº§ã€å®‰å…¨é˜²æŠ¤ã€è®¿é—®æ§åˆ¶ç­‰ å®ç°æ›´æ™ºèƒ½åŒ–çš„è·¯ç”± æŸäº›å®‰å…¨æ”»å‡»å¯ä»¥ç”±ä¸ƒå±‚è´Ÿè½½å‡è¡¡å™¨æ¥æŠµå¾¡ è¿›è¡Œå¾®æœåŠ¡æ²»ç†ç­‰  3.3 LBç­–ç•¥ è´Ÿè½½å‡è¡¡çš„ä¸¤å¤§èŒè´£æ˜¯â€œé€‰æ‹©è°æ¥å¤„ç†ç”¨æˆ·è¯·æ±‚â€ï¼Œâ€œå¦‚ä½•å°†ç”¨æˆ·è¯·æ±‚è½¬å‘å‡ºå»â€ï¼Œå››å±‚ã€ä¸ƒå±‚LBè§£å†³çš„é—®é¢˜æ˜¯å¦‚ä½•å°†ç”¨æˆ·è¯·æ±‚è½¬å‘å‡ºå»ï¼Œè€Œå¯¹äºâ€œé€‰æ‹©è°æ¥å¤„ç†ç”¨æˆ·è¯·æ±‚â€ï¼Œåˆ™éœ€è¦å…·ä½“çš„LBç­–ç•¥ã€‚\n  è½®å¾ªå‡è¡¡ï¼ˆRound Robinï¼‰å³æ¯ä¸€æ¬¡æ¥è‡ªç½‘ç»œçš„è¯·æ±‚ï¼Œä¼šè½®æµåˆ†é…ç»™å†…éƒ¨ä¸­çš„æœåŠ¡å™¨ï¼Œä» 1 åˆ° N ç„¶åé‡æ–°å¼€å§‹ã€‚è¿™ç§å‡è¡¡ç®—æ³•é€‚ç”¨äºæœåŠ¡å™¨ç»„ä¸­çš„æ‰€æœ‰æœåŠ¡å™¨éƒ½æœ‰ç›¸åŒçš„è½¯ç¡¬ä»¶é…ç½®ï¼Œå¹¶ä¸”å¹³å‡æœåŠ¡è¯·æ±‚ç›¸å¯¹å‡è¡¡çš„æƒ…å†µã€‚\n  æƒé‡è½®å¾ªå‡è¡¡ï¼ˆWeighted Round Robinï¼‰å³æ ¹æ®æœåŠ¡å™¨çš„ä¸åŒå¤„ç†èƒ½åŠ›ï¼Œç»™æ¯ä¸ªæœåŠ¡å™¨åˆ†é…ä¸åŒçš„æƒå€¼ï¼Œä½¿å…¶èƒ½å¤Ÿæ¥å—ç›¸åº”æƒå€¼æ•°çš„æœåŠ¡è¯·æ±‚ã€‚æ¯”å¦‚ï¼ŒæœåŠ¡å™¨ A çš„æƒå€¼è¢«è®¾è®¡æˆ 1ï¼ŒB çš„æƒå€¼æ˜¯ 3ï¼ŒC çš„æƒå€¼æ˜¯ 6ï¼Œåˆ™æœåŠ¡å™¨ Aã€Bã€C å°†åˆ†åˆ«æ¥æ”¶åˆ° 10%ã€30ï¼…ã€60ï¼…çš„æœåŠ¡è¯·æ±‚ã€‚è¿™ç§å‡è¡¡ç®—æ³•èƒ½ç¡®ä¿é«˜æ€§èƒ½çš„æœåŠ¡å™¨å¾—åˆ°æ›´å¤šçš„ä½¿ç”¨ç‡ï¼Œé¿å…ä½æ€§èƒ½çš„æœåŠ¡å™¨è´Ÿè½½è¿‡é‡ã€‚\n  éšæœºå‡è¡¡ï¼ˆRandomï¼‰å³æŠŠæ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚éšæœºåˆ†é…ç»™å†…éƒ¨ä¸­çš„å¤šä¸ªæœåŠ¡å™¨ã€‚è¿™ç§å‡è¡¡ç®—æ³•åœ¨æ•°æ®è¶³å¤Ÿå¤§çš„åœºæ™¯ä¸‹ï¼Œèƒ½è¾¾åˆ°ç›¸å¯¹å‡è¡¡çš„åˆ†å¸ƒã€‚æƒé‡éšæœºå‡è¡¡ï¼ˆWeighted Randomï¼‰è¿™ç§å‡è¡¡ç®—æ³•ç±»ä¼¼äºæƒé‡è½®å¾ªç®—æ³•ï¼Œä¸è¿‡åœ¨å¤„ç†è¯·æ±‚åˆ†æ‹…çš„æ—¶å€™ï¼Œå®ƒæ˜¯ä¸ªéšæœºé€‰æ‹©çš„è¿‡ç¨‹ã€‚\n  ä¸€è‡´æ€§å“ˆå¸Œå‡è¡¡ï¼ˆConsistency Hashï¼‰å³æ ¹æ®è¯·æ±‚ä¸­çš„æŸäº›æ•°æ®ï¼ˆå¯ä»¥æ˜¯ MACã€IP åœ°å€ï¼Œä¹Ÿå¯ä»¥æ˜¯æ›´ä¸Šå±‚åè®®ä¸­çš„æŸäº›å‚æ•°ä¿¡æ¯ï¼‰ä½œä¸ºç‰¹å¾å€¼ï¼Œæ¥è®¡ç®—éœ€è¦è½åœ¨å“ªäº›èŠ‚ç‚¹ä¸Šï¼Œç®—æ³•ä¸€èˆ¬ä¼šä¿è¯åŒä¸€ä¸ªç‰¹å¾å€¼ï¼Œæ¯æ¬¡éƒ½ä¸€å®šè½åœ¨ç›¸åŒçš„æœåŠ¡å™¨ä¸Šã€‚è¿™é‡Œä¸€è‡´æ€§çš„æ„æ€å°±æ˜¯ï¼Œä¿è¯å½“æœåŠ¡é›†ç¾¤çš„æŸä¸ªçœŸå®æœåŠ¡å™¨å‡ºç°æ•…éšœçš„æ—¶å€™ï¼Œåªå½±å“è¯¥æœåŠ¡å™¨çš„å“ˆå¸Œï¼Œè€Œä¸ä¼šå¯¼è‡´æ•´ä¸ªæœåŠ¡é›†ç¾¤çš„å“ˆå¸Œé”®å€¼é‡æ–°åˆ†å¸ƒã€‚\n  å“åº”é€Ÿåº¦å‡è¡¡ï¼ˆResponse Timeï¼‰å³è´Ÿè½½å‡è¡¡è®¾å¤‡å¯¹å†…éƒ¨å„æœåŠ¡å™¨å‘å‡ºä¸€ä¸ªæ¢æµ‹è¯·æ±‚ï¼ˆå¦‚ Pingï¼‰ï¼Œç„¶åæ ¹æ®å†…éƒ¨ä¸­å„æœåŠ¡å™¨å¯¹æ¢æµ‹è¯·æ±‚çš„æœ€å¿«å“åº”æ—¶é—´ï¼Œæ¥å†³å®šå“ªä¸€å°æœåŠ¡å™¨æ¥å“åº”å®¢æˆ·ç«¯çš„æœåŠ¡è¯·æ±‚ã€‚è¿™ç§å‡è¡¡ç®—æ³•èƒ½æ¯”è¾ƒå¥½åœ°åæ˜ æœåŠ¡å™¨çš„å½“å‰è¿è¡ŒçŠ¶æ€ï¼Œä½†è¦æ³¨æ„ï¼Œè¿™é‡Œçš„æœ€å¿«å“åº”æ—¶é—´ï¼Œä»…ä»…æŒ‡çš„æ˜¯è´Ÿè½½å‡è¡¡è®¾å¤‡ä¸æœåŠ¡å™¨é—´çš„æœ€å¿«å“åº”æ—¶é—´ï¼Œè€Œä¸æ˜¯å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨é—´çš„æœ€å¿«å“åº”æ—¶é—´ã€‚\n  æœ€å°‘è¿æ¥æ•°å‡è¡¡ï¼ˆLeast Connectionï¼‰å®¢æˆ·ç«¯çš„æ¯ä¸€æ¬¡è¯·æ±‚æœåŠ¡ï¼Œåœ¨æœåŠ¡å™¨åœç•™çš„æ—¶é—´å¯èƒ½ä¼šæœ‰æ¯”è¾ƒå¤§çš„å·®å¼‚ã€‚é‚£ä¹ˆéšç€å·¥ä½œæ—¶é—´åŠ é•¿ï¼Œå¦‚æœé‡‡ç”¨ç®€å•çš„è½®å¾ªæˆ–è€…éšæœºå‡è¡¡ç®—æ³•ï¼Œæ¯ä¸€å°æœåŠ¡å™¨ä¸Šçš„è¿æ¥è¿›ç¨‹å¯èƒ½ä¼šäº§ç”Ÿæå¤§çš„ä¸å¹³è¡¡ï¼Œå¹¶æ²¡æœ‰è¾¾åˆ°çœŸæ­£çš„è´Ÿè½½å‡è¡¡ã€‚æ‰€ä»¥ï¼Œæœ€å°‘è¿æ¥æ•°å‡è¡¡ç®—æ³•å°±ä¼šå¯¹å†…éƒ¨ä¸­éœ€è¦è´Ÿè½½çš„æ¯ä¸€å°æœåŠ¡å™¨ï¼Œéƒ½æœ‰ä¸€ä¸ªæ•°æ®è®°å½•ï¼Œä¹Ÿå°±æ˜¯è®°å½•å½“å‰è¯¥æœåŠ¡å™¨æ­£åœ¨å¤„ç†çš„è¿æ¥æ•°é‡ï¼Œå½“æœ‰æ–°çš„æœåŠ¡è¿æ¥è¯·æ±‚æ—¶ï¼Œå°±æŠŠå½“å‰è¯·æ±‚åˆ†é…ç»™è¿æ¥æ•°æœ€å°‘çš„æœåŠ¡å™¨ï¼Œä½¿å‡è¡¡æ›´åŠ ç¬¦åˆ\n  3.4 LBçš„è½¯ç¡¬ä»¶å®ç° è´Ÿè½½å‡è¡¡å™¨çš„å®ç°æœ‰â€œè½¯ä»¶å‡è¡¡å™¨â€å’Œâ€œç¡¬ä»¶å‡è¡¡å™¨â€ä¸¤ç±»ã€‚\nåœ¨è½¯ä»¶å‡è¡¡å™¨æ–¹é¢ï¼Œåˆåˆ†ä¸ºç›´æ¥å»ºè®¾åœ¨æ“ä½œç³»ç»Ÿå†…æ ¸çš„å‡è¡¡å™¨å’Œåº”ç”¨ç¨‹åºå½¢å¼çš„å‡è¡¡å™¨ä¸¤ç§ã€‚å‰è€…çš„ä»£è¡¨æ˜¯ LVSï¼ˆLinux Virtual Serverï¼‰ï¼Œåè€…çš„ä»£è¡¨æœ‰ Nginxã€HAProxyã€KeepAlivedï¼Œç­‰ç­‰ï¼›å‰è€…çš„æ€§èƒ½ä¼šæ›´å¥½ï¼Œå› ä¸ºå®ƒä¸éœ€è¦åœ¨å†…æ ¸ç©ºé—´å’Œåº”ç”¨ç©ºé—´ä¸­æ¥å›å¤åˆ¶æ•°æ®åŒ…ï¼›è€Œåè€…çš„ä¼˜åŠ¿æ˜¯é€‰æ‹©å¹¿æ³›ï¼Œä½¿ç”¨æ–¹ä¾¿ï¼ŒåŠŸèƒ½ä¸å—é™äºå†…æ ¸ç‰ˆæœ¬ã€‚\nåœ¨ç¡¬ä»¶å‡è¡¡å™¨æ–¹é¢ï¼Œå¾€å¾€ä¼šç›´æ¥é‡‡ç”¨åº”ç”¨ä¸“ç”¨é›†æˆç”µè·¯ï¼ˆApplication Specific Integrated Circuitï¼ŒASICï¼‰æ¥å®ç°ã€‚å› ä¸ºå®ƒæœ‰ä¸“ç”¨å¤„ç†èŠ¯ç‰‡çš„æ”¯æŒï¼Œå¯ä»¥é¿å…æ“ä½œç³»ç»Ÿå±‚é¢çš„æŸè€—ï¼Œä»è€Œèƒ½å¤Ÿè¾¾åˆ°æœ€é«˜çš„æ€§èƒ½ã€‚è¿™ç±»çš„ä»£è¡¨å°±æ˜¯è‘—åçš„ F5 å’Œ A10 å…¬å¸çš„è´Ÿè½½å‡è¡¡äº§å“ã€‚\nReferences https://time.geekbang.org/column/article/327417\nhttps://www.cloudflare.com/zh-cn/learning/performance/what-is-dns-load-balancing/\nhttps://cloud.tencent.com/developer/article/1885429\n","permalink":"http://yangchnet.github.io/Dessert/posts/net/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/","summary":"1. è´Ÿè½½å‡è¡¡çš„ä½œç”¨ è´Ÿè½½å‡è¡¡ï¼ˆLoad Balance LBï¼‰ï¼Œæ˜¯é€šè¿‡å•ä¸€çš„å…¥å£ï¼Œä½¿ç”¨æŸäº›ç®—æ³•ï¼Œå¯¹ç”¨æˆ·æµé‡è¿›è¡Œåˆ†å‘ï¼Œä½¿ç”¨æˆ·è¯·æ±‚åˆç†çš„åˆ†é…åˆ°å¤šä¸ªæœåŠ¡å™¨èŠ‚ç‚¹ä¸­çš„ä¸€ç§æŠ€æœ¯ã€‚\nç°ä»£åº”ç”¨é€šå¸¸éœ€è¦åŒæ—¶å¯¹å¤§é‡ç”¨æˆ·æä¾›æœåŠ¡ï¼Œæ­¤æ—¶å•å°æœºå™¨å·²ç»éš¾ä»¥æ‰¿æ‹…è¿™äº›éœ€æ±‚ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨å¤šä¸ªèŠ‚ç‚¹åŒæ—¶ä¸ºç”¨æˆ·æä¾›æœåŠ¡ï¼Œä½†æ˜¾ç„¶ä¸èƒ½è®©ç”¨æˆ·è®°ä½å¤šä¸ªåŸŸåç”šè‡³IPã€‚LBä½äºç”¨æˆ·ä¸æœåŠ¡å™¨é›†ç¾¤ä¹‹é—´ï¼Œå……å½“ä¸å¯è§çš„åè°ƒè€…ï¼Œç¡®ä¿å‡ç­‰ä½¿ç”¨æ‰€æœ‰èµ„æºæœåŠ¡å™¨ã€‚\n2. DNSè´Ÿè½½å‡è¡¡ åŸºäºDNSçš„è´Ÿè½½å‡è¡¡æ¯”è¾ƒç®€å•ï¼Œå…¶åŸç†æ˜¯ä¸ºä¸€ä¸ªåŸŸåé…ç½®å¤šä¸ªAè®°å½•ï¼Œè¿™æ ·å½“å¯¹åŸŸåè¿›è¡Œè¯·æ±‚æ—¶ï¼Œå°±å¯ä»¥é€šè¿‡è¿”å›ä¸åŒçš„åŸŸåè¿›è¡Œæµé‡çš„åˆ†é…ã€‚\nä¸€ç§æœ€å¸¸è§çš„ DNS è´Ÿè½½å¹³è¡¡æŠ€æœ¯æ˜¯å¾ªç¯ DNSã€‚å³åœ¨è¯·æ±‚åˆ°æ¥æ—¶ï¼ŒIPåœ°å€ä»¥å¾ªç¯æ–¹å¼è½®æ¢è¿”å›ï¼Œè¯·è¯·æ±‚åˆ†æ•£åˆ°å…³è”çš„æœåŠ¡å™¨ä¸Šã€‚\nå½“ç„¶ï¼Œä¹Ÿå¯ä»¥é‡‡ç”¨å…¶ä»–è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œä¾‹å¦‚æ ¹æ®IPåœ°å€çš„åœ°åŸŸç­‰åˆ†é…è¾ƒåŠ²çš„æœåŠ¡å™¨ã€‚\n3. å››å±‚LBä¸ä¸ƒå±‚LB ä»å½¢å¼ä¸Šæ¥è¯´LBéƒ½å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼šå››å±‚è´Ÿè½½å‡è¡¡å’Œä¸ƒå±‚è´Ÿè½½å‡è¡¡ã€‚å…¶ä¸­å››å±‚è´Ÿè½½å‡è¡¡çš„ä¼˜åŠ¿æ˜¯æ€§èƒ½é«˜ï¼Œä¸ƒå±‚è´Ÿè½½å‡è¡¡çš„ä¼˜åŠ¿æ˜¯åŠŸèƒ½å¼ºã€‚è¿™é‡Œçš„å››å±‚ã€ä¸ƒå±‚æŒ‡çš„æ˜¯OSIç½‘ç»œåˆ†å±‚æ ‡å‡†ä¸­çš„ç¬¬å››å±‚ä¼ è¾“å±‚å’Œç¬¬ä¸ƒå±‚åº”ç”¨å±‚ã€‚\n3.1 å››å±‚LB è¿™é‡Œå­˜åœ¨ä¸€ä¸ªè¯¯è§£: **å››å±‚è´Ÿè½½å‡è¡¡å¹¶ä¸æ˜¯åªå·¥ä½œåœ¨ç¬¬å››å±‚ä¼ è¾“å±‚ï¼Œäº‹å®ä¸Šå®ƒä»¬ä¸»è¦å·¥ä½œåœ¨äºŒå±‚ï¼ˆæ•°æ®é“¾è·¯å±‚ï¼‰å’Œä¸‰å±‚ï¼ˆç½‘ç»œå±‚ï¼‰ä¸Šã€‚**æ ¹æ®OSIæ¨¡å‹ï¼Œå½“æ•°æ®åŒ…åˆ°è¾¾ç¬¬å››å±‚ï¼Œå…¶å®å·²ç»åˆ°è¾¾äº†ç›®æ ‡ä¸»æœºä¸Šï¼Œæ‰€ä»¥æ­¤æ—¶æ˜¾ç„¶ä¸å­˜åœ¨ä»€ä¹ˆæµé‡è½¬å‘äº†ã€‚å››å±‚è´Ÿè½½å‡è¡¡çš„çœŸæ­£å«ä¹‰æ˜¯ï¼šè¿™äº›å·¥ä½œæ¨¡å¼çš„å…±åŒç‰¹ç‚¹æ˜¯éƒ½ç»´æŒç€åŒä¸€ä¸ªTCPè¿æ¥ã€‚\næ•°æ®é“¾è·¯å±‚LB\næ•°æ®é“¾è·¯å±‚æ•°æ®å¸§ä¸­åŒ…æ‹¬æœ‰ç›®çš„MACåœ°å€å’ŒæºMACåœ°å€ï¼Œæ•°æ®é“¾è·¯å±‚è´Ÿè½½å‡è¡¡æ‰€åšçš„å·¥ä½œï¼Œæ˜¯ä¿®æ”¹è¯·æ±‚çš„æ•°æ®å¸§ä¸­çš„ MAC ç›®æ ‡åœ°å€ï¼Œè®©ç”¨æˆ·åŸæœ¬æ˜¯å‘é€ç»™è´Ÿè½½å‡è¡¡å™¨çš„è¯·æ±‚çš„æ•°æ®å¸§ï¼Œè¢«äºŒå±‚äº¤æ¢æœºæ ¹æ®æ–°çš„ MAC ç›®æ ‡åœ°å€ï¼Œè½¬å‘åˆ°æœåŠ¡å™¨é›†ç¾¤ä¸­ï¼Œå¯¹åº”çš„æœåŠ¡å™¨çš„ç½‘å¡ä¸Šï¼Œè¿™æ ·çœŸå®æœåŠ¡å™¨å°±è·å¾—äº†ä¸€ä¸ªåŸæœ¬ç›®æ ‡å¹¶ä¸æ˜¯å‘é€ç»™å®ƒçš„æ•°æ®å¸§ã€‚\næ•°æ®é“¾è·¯å±‚çš„è´Ÿè½½å‡è¡¡åªå¯¹ç›®æ ‡MACåœ°å€è¿›è¡Œäº†ä¿®æ”¹ï¼Œä¸æ¶‰åŠå…¶ä»–å±‚æ¬¡ï¼Œå› æ­¤å¯¹äºæ›´ä¸Šå±‚çš„ç½‘ç»œå±‚æ¥è¯´ï¼Œæ•°æ®æ˜¯æ— å˜åŒ–çš„ï¼Œè¿™æ ·ç½‘ç»œå±‚æ‰èƒ½æ­£å¸¸å·¥ä½œã€‚\nè¿™æ˜¯å› ä¸ºç¬¬ä¸‰å±‚çš„æ•°æ®åŒ…ï¼Œä¹Ÿå°±æ˜¯ IP æ•°æ®åŒ…ä¸­ï¼ŒåŒ…å«äº†æºï¼ˆå®¢æˆ·ç«¯ï¼‰å’Œç›®æ ‡ï¼ˆå‡è¡¡å™¨ï¼‰çš„ IP åœ°å€ï¼Œåªæœ‰çœŸå®æœåŠ¡å™¨ä¿è¯è‡ªå·±çš„ IP åœ°å€ä¸æ•°æ®åŒ…ä¸­çš„ç›®æ ‡ IP åœ°å€ä¸€è‡´ï¼Œè¿™ä¸ªæ•°æ®åŒ…æ‰èƒ½è¢«æ­£ç¡®å¤„ç†ã€‚\næ‰€ä»¥ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨è¿™ç§è´Ÿè½½å‡è¡¡æ¨¡å¼çš„æ—¶å€™ï¼Œéœ€è¦æŠŠçœŸå®ç‰©ç†æœåŠ¡å™¨é›†ç¾¤æ‰€æœ‰æœºå™¨çš„è™šæ‹Ÿ IP åœ°å€ï¼ˆVirtual IP Addressï¼ŒVIPï¼‰ï¼Œé…ç½®æˆè·Ÿè´Ÿè½½å‡è¡¡å™¨çš„è™šæ‹Ÿ IP ä¸€æ ·ï¼Œè¿™æ ·ç»å‡è¡¡å™¨è½¬å‘åçš„æ•°æ®åŒ…ï¼Œå°±èƒ½åœ¨çœŸå®æœåŠ¡å™¨ä¸­é¡ºåˆ©åœ°ä½¿ç”¨ã€‚\nå¦å¤–ï¼Œä¹Ÿæ­£æ˜¯å› ä¸ºå®é™…å¤„ç†è¯·æ±‚çš„çœŸå®ç‰©ç†æœåŠ¡å™¨ IP å’Œæ•°æ®è¯·æ±‚ä¸­çš„ç›®çš„ IP æ˜¯ä¸€è‡´çš„ï¼Œæ‰€ä»¥å“åº”ç»“æœå°±ä¸å†éœ€è¦é€šè¿‡è´Ÿè½½å‡è¡¡æœåŠ¡å™¨è¿›è¡Œåœ°å€äº¤æ¢ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå“åº”ç»“æœçš„æ•°æ®åŒ…ç›´æ¥ä»çœŸå®æœåŠ¡å™¨è¿”å›ç»™ç”¨æˆ·çš„å®¢æˆ·ç«¯ï¼Œé¿å…è´Ÿè½½å‡è¡¡å™¨ç½‘å¡å¸¦å®½æˆä¸ºç“¶é¢ˆï¼Œæ‰€ä»¥æ•°æ®é“¾è·¯å±‚çš„è´Ÿè½½å‡è¡¡æ•ˆç‡æ˜¯ç›¸å½“é«˜çš„ã€‚\nè¿™ç§ä¼ è¾“æ–¹å¼è¢«ç§°ä¸ºä¸‰è§’ä¼ è¾“ï¼Œè¿”å›çš„æµé‡ä¸ç»è¿‡LBï¼Œé¿å…è´Ÿè½½å‡è¡¡å™¨ç½‘å¡å¸¦å®½æˆä¸ºç“¶é¢ˆï¼Œæ•ˆç‡è¾ƒé«˜.\næ•°æ®é“¾è·¯å±‚çš„åŠ£åŠ¿ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œå› ä¸ºå…¶éœ€è¦é€šè¿‡ä¿®æ”¹MACåœ°å€çš„æ–¹å¼è¿›è¡Œå·¥ä½œï¼Œå› æ­¤çœŸå®ç›®æ ‡æœåŠ¡å™¨å¿…é¡»å’ŒLBæœåŠ¡å™¨åœ¨åŒä¸€å­ç½‘ä¸‹ã€‚\nç½‘ç»œå±‚LB\nä¸æ•°æ®é“¾è·¯å±‚ç±»ä¼¼çš„ï¼Œç½‘ç»œå±‚æ˜¯é€šè¿‡ä¿®æ”¹ä¸‰å±‚æ•°æ®åŒ…çš„ç›®æ ‡IPåœ°å€è¿›è¡Œå·¥ä½œï¼š\nå…¶ä¿®æ”¹æ–¹å¼ä¸»è¦æœ‰ä¸¤ç§ï¼š\n ç¬¬ä¸€ç§æ˜¯ä¿æŒåŸæ¥çš„æ•°æ®åŒ…ä¸å˜ï¼Œæ–°åˆ›å»ºä¸€ä¸ªæ•°æ®åŒ…ï¼ŒæŠŠåŸæ¥æ•°æ®åŒ…çš„ Headers å’Œ Payload æ•´ä½“ä½œä¸ºå¦ä¸€ä¸ªæ–°çš„æ•°æ®åŒ…çš„ Payloadï¼Œåœ¨è¿™ä¸ªæ–°æ•°æ®åŒ…çš„ Headers ä¸­ï¼Œå†™å…¥çœŸå®æœåŠ¡å™¨çš„ IP ä½œä¸ºç›®æ ‡åœ°å€ï¼Œç„¶åæŠŠå®ƒå‘é€å‡ºå»ã€‚  è¿™ç§æ–¹å¼éœ€è¦åœ¨æ¥æ”¶æ—¶é‡æ–°è¿›è¡Œæ‹†åŒ…ï¼Œå–å‡ºåŸæ¥è¦å‘é€çš„æ•°æ®åŒ…ï¼Œè¿™æ ·ï¼ŒIPæ•°æ®åŒ…çš„æºIPå’Œç›®çš„IPæ— å˜åŒ–ï¼ŒçœŸå®æœåŠ¡å™¨ä»ç„¶å¯ä»¥ç›´æ¥å°†æ•°æ®å‘é€ç»™å®¢æˆ·ç«¯ï¼Œä¸éœ€è¦ç»è¿‡LBï¼Œä¹Ÿå³ä»å…·æœ‰ä¸‰è§’ä¼ è¾“çš„ç‰¹æ€§ã€‚\nè¿™ç§æ–¹å¼è¢«ç§°ä¸ºIPéš§é“ï¼Œå› ä¸ºå…¶å·¥ä½œåœ¨ç½‘ç»œå±‚ï¼Œå¯ä»¥è·¨VLANè¿›è¡Œä¼ è¾“ï¼Œä½†è¦æ±‚ç›®æ ‡æœåŠ¡å™¨æ”¯æŒIPéš§é“åè®®ã€‚\n ç¬¬äºŒç§æ–¹å¼ç›´æ¥æŠŠæ•°æ®åŒ… Headers ä¸­çš„ç›®æ ‡åœ°å€æ”¹æ‰ï¼Œä¿®æ”¹ååŸæœ¬ç”±ç”¨æˆ·å‘ç»™å‡è¡¡å™¨çš„æ•°æ®åŒ…ï¼Œä¹Ÿä¼šè¢«ä¸‰å±‚äº¤æ¢æœºè½¬å‘é€åˆ°çœŸå®æœåŠ¡å™¨çš„ç½‘å¡ä¸Šï¼Œè€Œä¸”å› ä¸ºæ²¡æœ‰ç»è¿‡ IP éš§é“çš„é¢å¤–åŒ…è£…ï¼Œä¹Ÿå°±æ— éœ€å†æ‹†åŒ…äº†ã€‚  ä½†è¿™æ ·çš„è¯ï¼ŒçœŸå®æœåŠ¡å™¨åœ¨å°†æ•°æ®è¿”å›ç»™å®¢æˆ·ç«¯æ—¶ï¼Œå°±ä¼šä½¿ç”¨è‡ªå·±çš„IPä½œä¸ºæºIPï¼Œå®¢æˆ·ç«¯ä¸€çœ‹ï¼šâ€œæˆ‘æƒ³è¦çš„æ˜¯AæœåŠ¡å™¨å“åº”ï¼Œä½ ç»™æˆ‘æ¥äº†ä¸ªBæœåŠ¡å™¨å“åº”ï¼Œæ»šçŠŠå­â€ï¼Œä¸èƒ½æ­£å¸¸å¤„ç†è¿™ä¸ªåº”ç­”ï¼Œå› æ­¤å¿…é¡»è®©å“åº”è¿”å›LBå†å‘ç»™å®¢æˆ·ç«¯ã€‚","title":"è´Ÿè½½å‡è¡¡"},{"content":" å®˜æ–¹ç»™å‡ºçš„æ•™ç¨‹æ˜¯ä½¿ç”¨docker desktop, ä½†å†…å­˜å ç”¨å¤ªå¤§ã€‚\n 1. å®‰è£…dockeräºŒè¿›åˆ¶æ–‡ä»¶ ä»è¿™é‡Œä¸‹è½½å¹³å°å¯¹åº”çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼šhttps://download.docker.com/linux/static/stable/\nç„¶åè§£å‹å®‰è£…ï¼š\n$ tar xzvf /path/to/\u0026lt;FILE\u0026gt;.tar.gz $ sudo cp docker/* /usr/bin/  è¿™æ—¶å¯ä»¥æ‰‹åŠ¨æ‰§è¡Œsudo dockerd \u0026amp;ä»¥å¯åŠ¨å®ˆæŠ¤è¿›ç¨‹ï¼Œä½†æˆ‘ä»¬ä¸è¿™æ ·åš\n é…ç½®å®ˆæŠ¤è¿›ç¨‹ ä»https://github.com/moby/moby/tree/master/contrib/init/systemdæ‹·è´docker.service, docker.socketä¸¤ä¸ªæ–‡ä»¶åˆ°/etc/systemd/system/docker.service, /etc/systemd/system/docker.socket\nç„¶åè¿è¡Œï¼š\n$ sudo systemctl daemon-reload # é‡æ–°åŠ è½½é…ç½® $ sudo systemctl start docker #å¯åŠ¨dockerd $ sudo systemctl enable docker # è®¾ç½®å¼€æœºå¯åŠ¨  å…¶å®ä¹Ÿå¯ä»¥ç›´æ¥yay -S docker :-)\n docker-compose $ yay -S docker-compose References https://docs.docker.com/desktop/install/archlinux/\nhttps://docs.docker.com/engine/install/binaries/#install-daemon-and-client-binaries-on-linux\nhttps://docs.docker.com/config/daemon/systemd/\nhttps://wiki.archlinux.org/title/docker\nhttps://wiki.archlinux.org/title/Systemd#Drop-in_files\n","permalink":"http://yangchnet.github.io/Dessert/posts/linux/install-docker-on-arch/","summary":"å®˜æ–¹ç»™å‡ºçš„æ•™ç¨‹æ˜¯ä½¿ç”¨docker desktop, ä½†å†…å­˜å ç”¨å¤ªå¤§ã€‚\n 1. å®‰è£…dockeräºŒè¿›åˆ¶æ–‡ä»¶ ä»è¿™é‡Œä¸‹è½½å¹³å°å¯¹åº”çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼šhttps://download.docker.com/linux/static/stable/\nç„¶åè§£å‹å®‰è£…ï¼š\n$ tar xzvf /path/to/\u0026lt;FILE\u0026gt;.tar.gz $ sudo cp docker/* /usr/bin/  è¿™æ—¶å¯ä»¥æ‰‹åŠ¨æ‰§è¡Œsudo dockerd \u0026amp;ä»¥å¯åŠ¨å®ˆæŠ¤è¿›ç¨‹ï¼Œä½†æˆ‘ä»¬ä¸è¿™æ ·åš\n é…ç½®å®ˆæŠ¤è¿›ç¨‹ ä»https://github.com/moby/moby/tree/master/contrib/init/systemdæ‹·è´docker.service, docker.socketä¸¤ä¸ªæ–‡ä»¶åˆ°/etc/systemd/system/docker.service, /etc/systemd/system/docker.socket\nç„¶åè¿è¡Œï¼š\n$ sudo systemctl daemon-reload # é‡æ–°åŠ è½½é…ç½® $ sudo systemctl start docker #å¯åŠ¨dockerd $ sudo systemctl enable docker # è®¾ç½®å¼€æœºå¯åŠ¨  å…¶å®ä¹Ÿå¯ä»¥ç›´æ¥yay -S docker :-)\n docker-compose $ yay -S docker-compose References https://docs.docker.com/desktop/install/archlinux/\nhttps://docs.docker.com/engine/install/binaries/#install-daemon-and-client-binaries-on-linux\nhttps://docs.docker.com/config/daemon/systemd/\nhttps://wiki.archlinux.org/title/docker\nhttps://wiki.archlinux.org/title/Systemd#Drop-in_files","title":"Install Docker on Arch"},{"content":"https://wiki.manjaro.org/index.php/GRUB/Restore_the_GRUB_Bootloader#EFI_System\nå¯åŠ¨ç¬”è®°æœ¬æ—¶ï¼Œçªç„¶å‘ç°gurbå¼•å¯¼é¡¹æ•…éšœäº†ï¼Œè®°å½•ä¸€ä¸‹ä¿®å¤è¿‡ç¨‹ï¼š\né¦–å…ˆç”¨Uç›˜åˆ¶å¤‡ä¸€ä¸ªmanjaroå¼•å¯¼ç›˜ã€‚ç„¶åæœ‰ä¸¤ç§æ–¹å¼\n timeshift  è¿›å…¥ç³»ç»ŸBIOSè®¾ç½®Uç›˜å¯åŠ¨ï¼Œç„¶åç›´æ¥ä»Uç›˜å¯åŠ¨ä¸€ä¸ªmanjaroã€‚\nå¦‚æœä½ æœ‰timeshiftå¤‡ä»½ï¼Œå¯ä»¥å…ˆå°è¯•ä½¿ç”¨timeshiftè¿›è¡Œæ¢å¤ï¼Œä¸è¡Œçš„è¯ï¼Œå°±å°è¯•æ–¹æ³•äºŒ\ngrubæ¢å¤  è¿›å…¥ç³»ç»ŸBIOSè®¾ç½®Uç›˜å¯åŠ¨ï¼Œåœ¨manjaroæç¤ºä½ é€‰æ‹©å¦‚ä½•å¯åŠ¨ç³»ç»Ÿæ—¶ï¼Œé€‰æ‹©Select a bootloaderï¼Œç„¶åé€‰æ‹©grubï¼Œä¸å‡ºæ„å¤–ï¼Œä½ çš„åŸç³»ç»Ÿå°±å¯åŠ¨äº†ï¼Œä½†è¿™æ—¶å¦‚æœé‡å¯ï¼Œè¿˜æ˜¯æ‰¾ä¸åˆ°grubå¼•å¯¼é¡¹ã€‚å¯åšå¦‚ä¸‹æ“ä½œï¼š\né¦–å…ˆæ›´æ–°grub\nsudo pacman -Syu grub ç„¶åï¼š\ngrub-install --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id=manjaro --recheck grub-mkconfig -o /boot/grub/grub.cfg å¦‚æœç¬¬äºŒä¸ªå‘½ä»¤æç¤ºï¼š/usr/bin/grub-probeï¼šè­¦å‘Šï¼š æœªçŸ¥çš„è®¾å¤‡ç±»å‹ nvme0n1.\né‚£ä¹ˆç›´æ¥åˆ é™¤/etc/grub.d/60_memtest86+è¿™ä¸ªæ–‡ä»¶å³å¯ï¼ˆæ— é£é™©ï¼‰\nç„¶åé‡è¯•ï¼š\ngrub-mkconfig -o /boot/grub/grub.cfg æç¤ºå®Œæˆåï¼Œæ‹”æ‰Uç›˜é‡å¯ï¼Œåº”è¯¥å°±å¯ä»¥äº†ã€‚\n","permalink":"http://yangchnet.github.io/Dessert/posts/linux/manjaro%E6%81%A2%E5%A4%8Dgrub/","summary":"https://wiki.manjaro.org/index.php/GRUB/Restore_the_GRUB_Bootloader#EFI_System\nå¯åŠ¨ç¬”è®°æœ¬æ—¶ï¼Œçªç„¶å‘ç°gurbå¼•å¯¼é¡¹æ•…éšœäº†ï¼Œè®°å½•ä¸€ä¸‹ä¿®å¤è¿‡ç¨‹ï¼š\né¦–å…ˆç”¨Uç›˜åˆ¶å¤‡ä¸€ä¸ªmanjaroå¼•å¯¼ç›˜ã€‚ç„¶åæœ‰ä¸¤ç§æ–¹å¼\n timeshift  è¿›å…¥ç³»ç»ŸBIOSè®¾ç½®Uç›˜å¯åŠ¨ï¼Œç„¶åç›´æ¥ä»Uç›˜å¯åŠ¨ä¸€ä¸ªmanjaroã€‚\nå¦‚æœä½ æœ‰timeshiftå¤‡ä»½ï¼Œå¯ä»¥å…ˆå°è¯•ä½¿ç”¨timeshiftè¿›è¡Œæ¢å¤ï¼Œä¸è¡Œçš„è¯ï¼Œå°±å°è¯•æ–¹æ³•äºŒ\ngrubæ¢å¤  è¿›å…¥ç³»ç»ŸBIOSè®¾ç½®Uç›˜å¯åŠ¨ï¼Œåœ¨manjaroæç¤ºä½ é€‰æ‹©å¦‚ä½•å¯åŠ¨ç³»ç»Ÿæ—¶ï¼Œé€‰æ‹©Select a bootloaderï¼Œç„¶åé€‰æ‹©grubï¼Œä¸å‡ºæ„å¤–ï¼Œä½ çš„åŸç³»ç»Ÿå°±å¯åŠ¨äº†ï¼Œä½†è¿™æ—¶å¦‚æœé‡å¯ï¼Œè¿˜æ˜¯æ‰¾ä¸åˆ°grubå¼•å¯¼é¡¹ã€‚å¯åšå¦‚ä¸‹æ“ä½œï¼š\né¦–å…ˆæ›´æ–°grub\nsudo pacman -Syu grub ç„¶åï¼š\ngrub-install --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id=manjaro --recheck grub-mkconfig -o /boot/grub/grub.cfg å¦‚æœç¬¬äºŒä¸ªå‘½ä»¤æç¤ºï¼š/usr/bin/grub-probeï¼šè­¦å‘Šï¼š æœªçŸ¥çš„è®¾å¤‡ç±»å‹ nvme0n1.\né‚£ä¹ˆç›´æ¥åˆ é™¤/etc/grub.d/60_memtest86+è¿™ä¸ªæ–‡ä»¶å³å¯ï¼ˆæ— é£é™©ï¼‰\nç„¶åé‡è¯•ï¼š\ngrub-mkconfig -o /boot/grub/grub.cfg æç¤ºå®Œæˆåï¼Œæ‹”æ‰Uç›˜é‡å¯ï¼Œåº”è¯¥å°±å¯ä»¥äº†ã€‚","title":"Manjaroæ¢å¤grub"},{"content":"å¦‚ä½•åœ¨AURä¸Šå‘å¸ƒåŒ… 1. å‡†å¤‡PKGBUILD æ–‡ä»¶  https://wiki.archlinux.org/title/PKGBUILD https://wiki.archlinux.org/title/Creating_packages\n æƒ³è¦æ‰“åŒ…ä¸€ä¸ªå¯ä»¥åœ¨AURä¸Šå‘å¸ƒçš„packageï¼Œ éœ€è¦ä½¿ç”¨makepkgå·¥å…·ï¼Œmakepkgåœ¨è¿è¡Œæ—¶ä¼šå¯»æ‰¾å½“å‰å·¥ä½œç›®å½•ä¸‹çš„PKGBUILDæ–‡ä»¶ã€‚\næ‰¾åˆ°ä¹‹åï¼Œä¼šä»PKGBUILDé…ç½®çš„sourceå»è·å–æºç å¹¶æ ¹æ®PKGBUILDçš„é…ç½®å»è¿›è¡Œç¼–è¯‘ï¼Œæœ€ç»ˆäº§ç”ŸäºŒè¿›åˆ¶æ–‡ä»¶ä»¥åŠä¸€äº›å…ƒä¿¡æ¯æ–‡ä»¶ã€‚\nå¦‚æœä½ ä½¿ç”¨çš„æ˜¯archç³»çš„ç³»ç»Ÿï¼Œå¯ä»¥åœ¨/usr/share/pacman/ç›®å½•ä¸‹æ‰¾åˆ°ä¸€äº›PKGBUILDç¤ºä¾‹æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼š\n$ cat /usr/share/pacman/PKGBUILD.proto # This is an example PKGBUILD file. Use this as a start to creating your own, # and remove these comments. For more information, see \u0026#39;man PKGBUILD\u0026#39;. # NOTE: Please fill out the license field for your package! If it is unknown, # then please put \u0026#39;unknown\u0026#39;. # Maintainer: Your Name \u0026lt;youremail@domain.com\u0026gt; pkgname=NAME pkgver=VERSION pkgrel=1 epoch= pkgdesc=\u0026#34;\u0026#34; arch=() url=\u0026#34;\u0026#34; license=(\u0026#39;GPL\u0026#39;) groups=() depends=() makedepends=() checkdepends=() optdepends=() provides=() conflicts=() replaces=() backup=() options=() install= changelog= source=(\u0026#34;$pkgname-$pkgver.tar.gz\u0026#34; \u0026#34;$pkgname-$pkgver.patch\u0026#34;) noextract=() md5sums=() validpgpkeys=() prepare() { cd \u0026#34;$pkgname-$pkgver\u0026#34; patch -p1 -i \u0026#34;$srcdir/$pkgname-$pkgver.patch\u0026#34; } build() { cd \u0026#34;$pkgname-$pkgver\u0026#34; ./configure --prefix=/usr make } check() { cd \u0026#34;$pkgname-$pkgver\u0026#34; make -k check } package() { cd \u0026#34;$pkgname-$pkgver\u0026#34; make DESTDIR=\u0026#34;$pkgdir/\u0026#34; install } æ–‡ä»¶ç±»å‹æ˜¯protoï¼Œä¸è¿‡è¿™è·Ÿgrpcçš„protobufåº”è¯¥å…³ç³»ä¸å¤§ã€‚ã€‚\n1.1 PKGBUILDä¸­çš„å¸¸è§å˜é‡ PKGBUILDä¸­æœ‰å¾ˆå¤šå­—æ®µï¼Œä¸‹é¢ä»‹ç»ä¸€äº›å¸¸ç”¨çš„ï¼š\n pkgname: åŒ…çš„åç§° pkgver: åŒ…çš„ç‰ˆæœ¬ pkgrel: ç‰ˆæœ¬å·ï¼Œåº”è¯¥ä¸ºä¸€ä¸ªæ­£æ•´æ•°ï¼Œå°†æ˜¾ç¤ºåœ¨æœ€ç»ˆæ‰“åŒ…çš„æ–‡ä»¶åä¸­ pkgdesc: åŒ…çš„è¯´æ˜ï¼Œå»ºè®®å°äº80ä¸ªå­—ç¬¦ arch: æ”¯æŒçš„æ¶æ„ url: è½¯ä»¶å®˜ç½‘åœ°å€ license: è¯ä¹¦ depends: ä¾èµ–çš„åŒ… source: è½¯ä»¶æºåœ°å€ï¼Œå¯ä»¥æ˜¯æ–‡ä»¶è·¯å¾„ã€HTTPã€FTPã€Gitåœ°å€ sha1sums: sourceä¸­åŒ…å«çš„æ–‡ä»¶çš„sha1æ ¡éªŒå€¼,è¿™å¯¹äºgitä»“åº“æ¥è¯´å¹¶ä¸æ˜¯å¿…é¡»çš„  1.2 PKGBUILDä¸­çš„å†…å»ºå˜é‡ é™¤æ­¤ä¹‹å¤–ï¼ŒPKGBUILDè¿˜æœ‰ä¸€äº›å†…å»ºçš„å˜é‡, é€šè¿‡$variableçš„æ–¹å¼ä½¿ç”¨ï¼š\n srcdir: æŒ‡å‘ makepkg æå–æˆ–ç¬¦å·é“¾æ¥æºæ•°ç»„ä¸­æ‰€æœ‰æ–‡ä»¶çš„ç›®å½•ï¼Œå¯ç®€å•ç†è§£ä¸ºmakepkgè¿è¡Œçš„ç›®å½• pkgdir: æŒ‡å‘ makepkg æ‰“åŒ…å®‰è£…åŒ…çš„ç›®å½•ï¼Œå®ƒæˆä¸ºæ„å»ºåŒ…çš„æ ¹ç›®å½•  1.3 PKGBUILDçš„å†…å»ºå‡½æ•° å½“ä½¿ç”¨makepkgæ„å»ºåŒ…æ—¶ï¼Œå°†è°ƒç”¨PKGBUILDä¸­å­˜åœ¨çš„ä»¥ä¸‹äº”ä¸ªå‡½æ•°ï¼š\næ³¨æ„: package()æ˜¯å¿…é¡»çš„\n  prepare() è¿™ä¸ªå‡½æ•°åœ¨åŒ…è¢«æå–åï¼Œ åœ¨pkgver()å’Œbuild()è¿è¡Œã€‚è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œå°†è¿è¡Œç”¨äºå‡†å¤‡ç”Ÿæˆæºçš„å‘½ä»¤ã€‚\n  pkgver()\n  pkgver()åœ¨åŒ…è¢«æ‹‰å–ã€è§£å‹ä»¥åŠprepare()è¿è¡Œä¹‹åè¿è¡Œã€‚ä½ å¯ä»¥åœ¨è¿™ä¸€é˜¶æ®µè°ƒæ•´åŒ…çš„ç‰ˆæœ¬\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨pkgver()ä¸­çš„è¾“å‡ºã€sedä¿®æ”¹ï¼Œéƒ½ä¼šè¢«è®¤ä¸ºæ˜¯åœ¨æ“ä½œ$pkgverå˜é‡\nbuild() æ­¤å‡½æ•°ä½¿ç”¨ Bash è¯­æ³•ä¸­çš„å¸¸è§ shell å‘½ä»¤è‡ªåŠ¨ç¼–è¯‘è½¯ä»¶å¹¶åˆ›å»ºä¸€ä¸ªåä¸ºpkgçš„å®‰è£…è½¯ä»¶çš„ç›®å½•ã€‚è¿™å…è®¸ makepkg æ‰“åŒ…æ–‡ä»¶ï¼Œè€Œæ— éœ€ç­›é€‰æ–‡ä»¶ç³»ç»Ÿã€‚  build()å‡½æ•°çš„ç¬¬ä¸€æ­¥æ˜¯åˆ‡æ¢åˆ°è§£å‹ç¼©æºç åŒ…æ—¶åˆ›å»ºçš„ç›®å½•ã€‚makepkg ä¼šåœ¨æ‰§è¡Œbuild()ä¹‹å‰å°†$srcdirè®¾ä¸ºå½“å‰ç›®å½•ã€‚å› æ­¤ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¦‚/usr/share/pacman/PKGBUILD.protoä¸­å»ºè®®çš„é‚£æ ·ï¼Œç¬¬ä¸€ä¸ªå‘½ä»¤å°†å¦‚ä¸‹æ‰€ç¤ºï¼š\ncd \u0026#34;$pkgname-$pkgver\u0026#34; ç„¶åï¼Œä½ å¯ä»¥åœ¨ä¸‹é¢åˆ—å‡ºç¼–è¯‘è½¯ä»¶æ‰€éœ€çš„å‘½ä»¤ï¼Œæ¯”å¦‚make buildç­‰\n check() è°ƒç”¨make checkä»¥åŠå…¶ä»–ä»»ä½•æ£€æŸ¥é€»è¾‘çš„åœ°æ–¹ã€‚\n  package() æœ€åä¸€æ­¥æ˜¯å°†ç¼–è¯‘çš„æ–‡ä»¶æ”¾åœ¨ä¸€ä¸ªç›®å½•ä¸­ï¼Œmakepkgå¯ä»¥åœ¨å…¶ä¸­æ£€ç´¢è¿™äº›æ–‡ä»¶å¹¶åˆ›å»ºåŒ…ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™æ˜¯pkgæ–‡ä»¶å¤¹ï¼šä¸€ä¸ªâ€œfakerootâ€ç¯å¢ƒï¼Œå³ä¸€ä¸ªå‡çš„æ ¹ç›®å½•ã€‚è¿™ä¸ªpkgç›®å½•å°†å¤åˆ¶è½¯ä»¶å®‰è£…ç›®å½•çš„æ ¹ç›®å½•å±‚æ¬¡ç»“æ„ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ è¦å®‰è£…ä¸€ä¸ªæ–‡ä»¶åˆ°/usr/binï¼Œåˆ™åº”å°†å…¶æ”¾åœ¨$pkgdir/usr/binä¸­ï¼Œ\n  1.4 æ£€æŸ¥PKGBUILDçš„è¯­æ³• ä½¿ç”¨namcapè¿›è¡Œæ£€æŸ¥\n$ namcap PKGBUILD 2. å®æˆ˜è¿›è¡Œæ‰“åŒ… 2.1 æ‰“åŒ…æœ¬åœ°äºŒè¿›åˆ¶æ–‡ä»¶ å‡†å¤‡ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶hello, è¯¥æ–‡ä»¶çš„ä½œç”¨æ˜¯è¾“å‡º\u0026quot;hello aur\u0026quot;ï¼Œå­˜æ”¾åœ¨workspaceç›®å½•ä¸­ï¼š\nmkdir workspace \u0026amp;\u0026amp; cd workspace mv /path/to/hello . è®¡ç®—å‡ºhelloæ–‡ä»¶çš„md5:\n$ md5sum hello 2acd771608bd1552ae27795a864d87ac hello åœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»ºPKGBUILDæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹:\n# Maintainer: Crest Lee \u0026lt;crest@selefra.io\u0026gt; pkgname=hello pkgver=0.1 pkgrel=1 pkgdesc='say hello to everyone' arch=('any') license=('GPL3') source=(\u0026quot;$srcdir/hello\u0026quot;) md5sums=('2acd771608bd1552ae27795a864d87ac') package() { cd $srcdir mkdir -p $pkgdir/usr/bin install hello $pkgdir/usr/bin/$pkgname } ç„¶åæ‰§è¡Œï¼š\n$ makepkg ==\u0026gt; æ­£åœ¨åˆ›å»ºè½¯ä»¶åŒ…ï¼šhello 0.1-1 (2023å¹´02æœˆ10æ—¥ æ˜ŸæœŸäº” 18æ—¶27åˆ†27ç§’) ==\u0026gt; æ­£åœ¨æ£€æŸ¥è¿è¡Œæ—¶ä¾èµ–å…³ç³»... ==\u0026gt; æ­£åœ¨æ£€æŸ¥ç¼–è¯‘æ—¶ä¾èµ–å…³ç³»==\u0026gt; è·å–æºä»£ç ... -\u0026gt; æ‰¾åˆ° hello ==\u0026gt; æ­£åœ¨éªŒè¯ source æ–‡ä»¶ï¼Œä½¿ç”¨md5sums... hello ... é€šè¿‡==\u0026gt; æ­£åœ¨é‡Šæ”¾æºç ... ==\u0026gt; æ­£åœ¨åˆ é™¤ç°å­˜çš„ $pkgdir/ ç›®å½•... ==\u0026gt; æ­£åœ¨è¿›å…¥ fakeroot ç¯å¢ƒ... ==\u0026gt; æ­£åœ¨å¼€å§‹ package()... ==\u0026gt; æ­£åœ¨æ¸…ç†å®‰è£…... -\u0026gt; æ­£åœ¨åˆ é™¤ libtool æ–‡ä»¶... -\u0026gt; æ­£åœ¨æ¸…é™¤ä¸æ‰“ç®—è¦çš„æ–‡ä»¶... -\u0026gt; æ­£åœ¨ç§»é™¤é™æ€åº“æ–‡ä»¶... -\u0026gt; æ­£åœ¨ä»äºŒè¿›åˆ¶æ–‡ä»¶å’Œåº“ä¸­æ¸…é™¤ä¸éœ€è¦çš„ç³»ç»Ÿç¬¦å·... -\u0026gt; æ­£åœ¨å‹ç¼© man åŠ info æ–‡æ¡£... ==\u0026gt; æ­£åœ¨æ£€æŸ¥æ‰“åŒ…é—®é¢˜... ==\u0026gt; æ­£åœ¨æ„å»ºè½¯ä»¶åŒ…\u0026#34;hello\u0026#34;... -\u0026gt; æ­£åœ¨ç”Ÿæˆ .PKGINFO æ–‡ä»¶... -\u0026gt; æ­£åœ¨ç”Ÿæˆ .BUILDINFO æ–‡ä»¶... -\u0026gt; æ­£åœ¨ç”Ÿæˆ .MTREE æ–‡ä»¶... -\u0026gt; æ­£åœ¨å‹ç¼©è½¯ä»¶åŒ…... ==\u0026gt; æ­£åœ¨ç¦»å¼€ fakeroot ç¯å¢ƒã€‚==\u0026gt; å®Œæˆåˆ›å»ºï¼šhello 0.1-1 (2023å¹´02æœˆ10æ—¥ æ˜ŸæœŸäº” 18æ—¶27åˆ†28ç§’) æ„å»ºå®Œæˆåï¼Œworkspaceçš„ç›®å½•ç»“æ„ä¸ºï¼š\n. â”œâ”€â”€ hello â”œâ”€â”€ hello-0.1-1-any.pkg.tar.zst â”œâ”€â”€ pkg â”‚Â â””â”€â”€ hello â”‚Â â”œâ”€â”€ .BUILDINFO â”‚Â â”œâ”€â”€ .MTREE â”‚Â â”œâ”€â”€ .PKGINFO â”‚Â â””â”€â”€ usr â”‚Â â””â”€â”€ bin â”‚Â â””â”€â”€ hello â”œâ”€â”€ PKGBUILD â””â”€â”€ src â””â”€â”€ hello -\u0026gt; /path/to/hello å¯ä»¥çœ‹åˆ°ï¼Œç”Ÿæˆäº†ä¸€äº›å…ƒä¿¡æ¯æ–‡ä»¶ã€‚æ‰“åŒ…ç»“æœä¸ºï¼šhello-0.1-1-any.pkg.tar.zst\nå®‰è£…å®ƒï¼š\n$ sudo pacman -U hello-0.1-1-any.pkg.tar.zst æµ‹è¯•ï¼š\n$ hello hello world $ which hello /usr/bin/hello å¸è½½è¿™ä¸ªåŒ…ï¼š\n$ sudo pacman -R hello å®Œæˆ\n2.2 æ‰“åŒ…gitä»“åº“ å‡†å¤‡ä¸€ä¸ªgitä»“åº“ï¼šhttps://github.com/yangchnet/hello-aur\nè¿™æ˜¯ä¸€ä¸ªgolangè¯­è¨€ç¼–å†™çš„ç®€å•ç¨‹åºï¼Œè¾“å‡º\nhello, aur. Version: \u0026lt;version\u0026gt; å› æ­¤ï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼Œä½ å¯èƒ½éœ€è¦å®‰è£…golangã€‚\næ–°å»ºä¸€ä¸ªå·¥ä½œç›®å½•ï¼š\nmkdir workspace \u0026amp;\u0026amp; cd workspace åˆ›å»ºä¸€ä¸ªPKGBUILDæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\n# Maintainer: yangchent 1048887414@qq.com _pkgname=hello-aur pkgname=\u0026#34;$_pkgname\u0026#34;-git pkgver=1 pkgrel=1 pkgdesc=\u0026#34;say hello to aur in your computer\u0026#34; arch=(\u0026#34;any\u0026#34;) license=(\u0026#39;GPL\u0026#39;) source=(\u0026#34;git+https://github.com/yangchnet/$_pkgname.git\u0026#34;) md5sums=(\u0026#34;SKIP\u0026#34;) pkgver() { cd \u0026#34;$_pkgname\u0026#34; printf \u0026#34;r%s.%s\u0026#34; \u0026#34;$(git rev-list --count HEAD)\u0026#34; \u0026#34;$(git rev-parse --short=8 HEAD)\u0026#34; sed -i \u0026#39;s/{{.version}}/\u0026#39;$pkgver\u0026#39;/\u0026#39; main.go } build() { cd \u0026#34;$_pkgname\u0026#34; go build -o hello-aur main.go } check() { cd \u0026#34;$_pkgname\u0026#34; if [ -f \u0026#34;hello-aur\u0026#34; ];then echo \u0026#34;æ£€æŸ¥é€šè¿‡\u0026#34; else exit 1 fi } package() { cd \u0026#34;$_pkgname\u0026#34; mkdir -p $pkgdir/usr/bin mv hello-aur $pkgdir/usr/bin/hello-aur } è¿™é‡Œè·Ÿæ„å»ºæœ¬åœ°äºŒè¿›åˆ¶æ–‡ä»¶æœ‰ç‚¹ä¸åŒï¼Œä¾‹å¦‚\n  pkgnameå¿…é¡»ä»¥â€-gitâ€œç»“å°¾\n  sourceå¿…é¡»ç¬¦åˆ\u0026rsquo;project_name::git+https://project_url#branch=project_branch\u0026rsquo;çš„æ ¼å¼\n  å¯¹äºmd5æˆ–sha1çš„éªŒè¯å¯ä»¥é€šè¿‡é…ç½®\u0026quot;SKIP\u0026quot;ç•¥è¿‡ï¼Œå› ä¸ºgitæœ¬èº«å·²ç»è¿›è¡Œäº†éªŒè¯\n  éœ€è¦å‚è€ƒï¼šhttps://wiki.archlinux.org/title/VCS_package_guidelines#top-page https://bbs.archlinux.org/viewtopic.php?id=223966\næ„å»ºï¼š\n$ makepkg å®‰è£…ï¼š\n$ sudo pacman -U hello-aur-git-r1.9f29fc45-1-any.pkg.tar.zst æµ‹è¯•ï¼š\n$ hello-aur hello, aur. Version: 1 è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œçœ‹ä¸€ä¸‹pkgver()å‡½æ•°ï¼Œæˆ‘ä»¬åœ¨æœ€åå°†ä»£ç å†…éƒ¨{{.Version}}æ›¿æ¢ä¸ºç”±git commit idç»„æˆçš„ç‰ˆæœ¬å·ï¼Œä½†å¹¶æ²¡æœ‰ç”Ÿæ•ˆï¼Œä»ç„¶æ˜¯åˆå§‹çš„1ï¼Œè¿™å¯èƒ½è¡¨æ˜ï¼š$pkgveræ˜¯åœ¨pkgver()å‡½æ•°ç»“æŸåæ‰è¢«èµ‹å€¼çš„ã€‚\nå¸è½½:\nsudo pacman -R hello-aur-git # æ³¨æ„pkgnameå¤šäº†\u0026#34;-git\u0026#34;åç¼€ 3. å‘å¸ƒ TODO\nReferences https://wiki.archlinux.org/title/Arch_User_Repository#top-page\nhttps://wiki.archlinux.org/title/Makepkg\nhttps://wiki.archlinux.org/title/PKGBUILD\nhttps://wiki.archlinux.org/title/Creating_packages\nhttps://wiki.archlinux.org/title/VCS_package_guidelines#top-page\n","permalink":"http://yangchnet.github.io/Dessert/posts/linux/%E5%9C%A8aur%E4%B8%8A%E5%8F%91%E5%B8%83%E5%8C%85/","summary":"å¦‚ä½•åœ¨AURä¸Šå‘å¸ƒåŒ… 1. å‡†å¤‡PKGBUILD æ–‡ä»¶  https://wiki.archlinux.org/title/PKGBUILD https://wiki.archlinux.org/title/Creating_packages\n æƒ³è¦æ‰“åŒ…ä¸€ä¸ªå¯ä»¥åœ¨AURä¸Šå‘å¸ƒçš„packageï¼Œ éœ€è¦ä½¿ç”¨makepkgå·¥å…·ï¼Œmakepkgåœ¨è¿è¡Œæ—¶ä¼šå¯»æ‰¾å½“å‰å·¥ä½œç›®å½•ä¸‹çš„PKGBUILDæ–‡ä»¶ã€‚\næ‰¾åˆ°ä¹‹åï¼Œä¼šä»PKGBUILDé…ç½®çš„sourceå»è·å–æºç å¹¶æ ¹æ®PKGBUILDçš„é…ç½®å»è¿›è¡Œç¼–è¯‘ï¼Œæœ€ç»ˆäº§ç”ŸäºŒè¿›åˆ¶æ–‡ä»¶ä»¥åŠä¸€äº›å…ƒä¿¡æ¯æ–‡ä»¶ã€‚\nå¦‚æœä½ ä½¿ç”¨çš„æ˜¯archç³»çš„ç³»ç»Ÿï¼Œå¯ä»¥åœ¨/usr/share/pacman/ç›®å½•ä¸‹æ‰¾åˆ°ä¸€äº›PKGBUILDç¤ºä¾‹æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼š\n$ cat /usr/share/pacman/PKGBUILD.proto # This is an example PKGBUILD file. Use this as a start to creating your own, # and remove these comments. For more information, see \u0026#39;man PKGBUILD\u0026#39;. # NOTE: Please fill out the license field for your package! If it is unknown, # then please put \u0026#39;unknown\u0026#39;. # Maintainer: Your Name \u0026lt;youremail@domain.com\u0026gt; pkgname=NAME pkgver=VERSION pkgrel=1 epoch= pkgdesc=\u0026#34;\u0026#34; arch=() url=\u0026#34;\u0026#34; license=(\u0026#39;GPL\u0026#39;) groups=() depends=() makedepends=() checkdepends=() optdepends=() provides=() conflicts=() replaces=() backup=() options=() install= changelog= source=(\u0026#34;$pkgname-$pkgver.","title":"åœ¨AURä¸Šå‘å¸ƒåŒ…"},{"content":"pythonç”Ÿæˆå™¨å‡½æ•° def gen_char(): \u0026#34;\u0026#34;\u0026#34; å®šä¹‰äº†ä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°ï¼Œå°†ä¼šç”Ÿæˆa~z \u0026#34;\u0026#34;\u0026#34; for i in range(0, 26): yield chr(ord(\u0026#39;a\u0026#39;) +i) for char in gen_char(): print(char, end=\u0026#39; \u0026#39;) # è¾“å‡º # a b c d e f g h i j k l m n o p q r s t u v w x y z golangé€šé“ func main() { ch := make(chan string) // ä¸€ä¸ªé€šé“ \twg := \u0026amp;sync.WaitGroup{} // ç”¨äºgoroutineåŒæ­¥  wg.Add(1) go func() { // å®šä¹‰äº†ä¸€ä¸ªâ€œç”Ÿæˆå™¨å‡½æ•°â€œ \tdefer wg.Done() var r rune = \u0026#39;a\u0026#39; for i := 0; i \u0026lt; 26; i++ { ch \u0026lt;- string(r + rune(i)) // åŠŸèƒ½ç±»ä¼¼äºyield chr(ord(\u0026#39;a\u0026#39;) + i) è¿™ä¸€å¥ \t} close(ch) }() wg.Add(1) go func() { defer wg.Done() for { // éå†â€œç”Ÿæˆå™¨å‡½æ•°â€ \tselect { case r, ok := \u0026lt;-ch: if !ok { return } fmt.Printf(\u0026#34;%v \u0026#34;, r) } } }() wg.Wait() } äºŒè€…çš„ç›¸ä¼¼æ€§ åœ¨é˜…è¯»ã€Šæµç•…çš„Pythonã€‹ç¬¬16.2èŠ‚æ—¶ï¼Œæœ‰è¿™æ ·ä¸€æ®µä»£ç ï¼š\ndef simple_coroutine(): print(\u0026#39;-\u0026gt; coroutine started\u0026#39;) x = yield print(\u0026#39;-\u0026gt; coroutine received:\u0026#39;, x) my_coro = simple_coroutine() next(my_coro) # -\u0026gt; coroutine started my_coro.send(42) # -\u0026gt; coroutine received: 42 # Traceback (most recent call last): # ... # StopIteration è¿™ä¸€æ®µä»£ç å±•ç¤ºäº†yieldçš„ä¸€ç§ç”¨æ³•ï¼Œå½“ä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°å†…éƒ¨å­˜åœ¨x = yield, å¹¶å¯¹å…¶ä½¿ç”¨.send()æ–¹æ³•æ—¶ï¼Œ.send()å‘é€çš„å†…å®¹å°±ä¼šä¼ é€åˆ°ç”Ÿæˆå™¨å‡½æ•°å†…éƒ¨ã€‚\nè€Œç›¸åº”çš„ï¼Œyieldçš„å¦ä¸€ç§ç”¨æ³•æ˜¯ï¼Œå°†å‡½æ•°å†…éƒ¨çš„å€¼ä¸æ–­â€œå‘é€å‡ºå»â€ï¼Œä¾‹å¦‚æˆ‘ä»¬ä¸Šæ–‡çš„pythonç¨‹åºã€‚\nå¦‚æ­¤çœ‹æ¥ï¼Œyieldå®é™…ä¸Šæä¾›äº†ä¸€ç§é€šé“ï¼Œä¸€ç§è”é€šå‡½æ•°å†…éƒ¨å’Œå¤–éƒ¨çš„é€šé“ï¼Œé€šè¿‡yieldå…³é”®å­—ï¼Œæˆ‘ä»¬å¯ä»¥ä»å‡½æ•°å†…éƒ¨è·å¾—å€¼ï¼Œä¹Ÿå¯ä»¥åœ¨å‡½æ•°å¤–éƒ¨åƒå‡½æ•°å†…éƒ¨å‘é€å€¼ï¼ˆå¦‚æœå†…éƒ¨æœ‰æ¥æ”¶ï¼‰ã€‚\nä¸Šé¢çš„simple_coroutineå‡½æ•°ç‰‡æ®µç”¨goå¯ä»¥è¿™æ ·å†™ï¼š\nfunc main() { wg := \u0026amp;sync.WaitGroup{} var ch chan int = nil sig := make(chan struct{}) wg.Add(1) simple_coroutine := func() { defer wg.Done() ch = make(chan int, 1) fmt.Println(\u0026#34;-\u0026gt; coroutine started\u0026#34;) sig \u0026lt;- struct{}{} // ç”¨äºåŒæ­¥ \ti := \u0026lt;-ch // å¯¹åº”x = yield \tfmt.Printf(\u0026#34;-\u0026gt; coroutine received: %d\u0026#34;, i) } go simple_coroutine() // å¯¹åº”next(my_coro)  \u0026lt;-sig ch \u0026lt;- 42 wg.Wait() } // -\u0026gt; coroutine started // -\u0026gt; coroutine received: 42 æ€»ç»“ä¸€ä¸‹\nå½“åœ¨pythonå‡½æ•°ä¸­ä½¿ç”¨yield x æ—¶ï¼Œè¿™ä¸ªpythonå‡½æ•°å°±æˆä¸ºä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°ï¼Œæ­¤æ—¶ï¼Œè¿™ä¸ªç”Ÿæˆå™¨å‡½æ•°çš„è¡Œä¸ºç±»ä¼¼äºä¸€ä¸ªé€šé“ï¼Œå®ƒä¼šä¸æ–­çš„å¾€å¤–å‘é€å€¼(é€šé“å†™å…¥)ï¼Œæ­¤æ—¶è¿™ä¸ªpythonå‡½æ•°ç”Ÿæˆå™¨çš„è¡Œä¸ºç±»ä¼¼äºgolangçš„é€šé“ã€‚è€Œé€šè¿‡yieldï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¾€å‡½æ•°å†…éƒ¨å‘é€å€¼ã€‚\nè€Œæ ¹æ®ç”Ÿæˆå™¨å‡½æ•°å†…éƒ¨æ˜¯æƒ°æ€§ç”Ÿæˆå€¼è¿˜æ˜¯éæƒ°æ€§ç”Ÿæˆå€¼ï¼Œåˆå¯ç»†åŒ–çš„å¯¹åº”äºgolangä¸­çš„æ— ç¼“å†²é€šé“å’Œæœ‰ç¼“å†²é€šé“ã€‚\n","permalink":"http://yangchnet.github.io/Dessert/posts/python/python%E7%94%9F%E6%88%90%E5%99%A8%E5%87%BD%E6%95%B0%E5%92%8Cgo%E9%80%9A%E9%81%93/","summary":"pythonç”Ÿæˆå™¨å‡½æ•° def gen_char(): \u0026#34;\u0026#34;\u0026#34; å®šä¹‰äº†ä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°ï¼Œå°†ä¼šç”Ÿæˆa~z \u0026#34;\u0026#34;\u0026#34; for i in range(0, 26): yield chr(ord(\u0026#39;a\u0026#39;) +i) for char in gen_char(): print(char, end=\u0026#39; \u0026#39;) # è¾“å‡º # a b c d e f g h i j k l m n o p q r s t u v w x y z golangé€šé“ func main() { ch := make(chan string) // ä¸€ä¸ªé€šé“ \twg := \u0026amp;sync.WaitGroup{} // ç”¨äºgoroutineåŒæ­¥  wg.Add(1) go func() { // å®šä¹‰äº†ä¸€ä¸ªâ€œç”Ÿæˆå™¨å‡½æ•°â€œ \tdefer wg.","title":"pythonç”Ÿæˆå™¨å‡½æ•°å’Œgoé€šé“"},{"content":" å¦‚æœä¸€ä¸ªå‡½æ•°èƒ½æ¥æ”¶ä¸€ä¸ªå‡½æ•°ä¸ºå‚æ•°æˆ–è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œé‚£è¿™ä¸ªå‡½æ•°å°±è¢«ç§°ä¸ºé«˜é˜¶å‡½æ•°ã€‚\n 1. sorted sortedå¯ä»¥è¯´æ˜¯æœ€å¸¸ç”¨çš„é«˜é˜¶å‡½æ•°ï¼Œå…¶ç”¨æ³•å¦‚ä¸‹ï¼š\nm = {\u0026#34;three\u0026#34;: 3, \u0026#34;tow\u0026#34;: 2, \u0026#34;one\u0026#34;: 1 sorted(m.items(), key=lambda x: x[1]) # [(\u0026#39;one\u0026#39;, 1), (\u0026#39;tow\u0026#39;, 2), (\u0026#39;three\u0026#39;, 3)] sortedå¯æ ¹æ®å…¶å‚æ•°keyè¿”å›çš„å€¼æ¥è¿›è¡Œæ’åºã€‚\n2. map map()å‡½æ•°æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯å‡½æ•°ï¼Œä¸€ä¸ªæ˜¯Iterableï¼Œmapå°†ä¼ å…¥çš„å‡½æ•°ä¾æ¬¡ä½œç”¨åˆ°åºåˆ—çš„æ¯ä¸ªå…ƒç´ ï¼Œå¹¶æŠŠç»“æœä½œä¸ºæ–°çš„Iteratorè¿”å›ã€‚\nå¦‚ï¼š\ndef add10(x): return x+10 print(map(add10, [1, 2, 3])) # \u0026lt;map object at 0x7f5824cd01c0\u0026gt; list(map(add10, [1, 2, 3])) # [11, 12, 13] list(map(str, [1, 2, 3, 4, 5, 6, 7, 8, 9])) # [\u0026#39;1\u0026#39;, \u0026#39;2\u0026#39;, \u0026#39;3\u0026#39;, \u0026#39;4\u0026#39;, \u0026#39;5\u0026#39;, \u0026#39;6\u0026#39;, \u0026#39;7\u0026#39;, \u0026#39;8\u0026#39;, \u0026#39;9\u0026#39;] functools.reduce reduceæŠŠä¸€ä¸ªå‡½æ•°ä½œç”¨åœ¨ä¸€ä¸ªåºåˆ—[x1, x2, x3, \u0026hellip;]ä¸Šï¼Œè¿™ä¸ªå‡½æ•°å¿…é¡»æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼ŒreduceæŠŠç»“æœç»§ç»­å’Œåºåˆ—çš„ä¸‹ä¸€ä¸ªå…ƒç´ åšç´¯ç§¯è®¡ç®—ï¼Œå…¶æ•ˆæœå°±æ˜¯ï¼š\nreduce(f, [x1, x2, x3, x4]) = f(f(f(x1, x2), x3), x4) ä¾‹å¦‚ï¼š\nfrom functools import reduce from operator import mul reduce(mul, range(1, 5)) # 24 (1*2*3*4) filter filter() å‡½æ•°ç”¨äºè¿‡æ»¤åºåˆ—ï¼Œè¿‡æ»¤æ‰ä¸ç¬¦åˆæ¡ä»¶çš„å…ƒç´ ï¼Œè¿”å›ç”±ç¬¦åˆæ¡ä»¶å…ƒç´ ç»„æˆçš„æ–°åˆ—è¡¨ã€‚\nè¯¥æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªä¸ºå‡½æ•°ï¼Œç¬¬äºŒä¸ªä¸ºåºåˆ—ï¼Œåºåˆ—çš„æ¯ä¸ªå…ƒç´ ä½œä¸ºå‚æ•°ä¼ é€’ç»™å‡½æ•°è¿›è¡Œåˆ¤æ–­ï¼Œç„¶åè¿”å› True æˆ– Falseï¼Œæœ€åå°†è¿”å› True çš„å…ƒç´ æ”¾åˆ°æ–°åˆ—è¡¨ä¸­ã€‚\nç”¨æ³•ï¼š\ndef even(x:int) -\u0026gt; bool: \u0026#34;\u0026#34;\u0026#34;åˆ¤æ–­æ˜¯å¦æ˜¯å¥‡æ•° \u0026#34;\u0026#34;\u0026#34; if x % 2 == 0: return False else: return True list(filter(even, range(1, 10))) # [1, 3, 5, 7, 9] zip zip() å‡½æ•°ç”¨äºå°†å¯è¿­ä»£çš„å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œå°†å¯¹è±¡ä¸­å¯¹åº”çš„å…ƒç´ æ‰“åŒ…æˆä¸€ä¸ªä¸ªå…ƒç»„ï¼Œç„¶åè¿”å›ç”±è¿™äº›å…ƒç»„ç»„æˆçš„åˆ—è¡¨ã€‚\nå¦‚æœå„ä¸ªè¿­ä»£å™¨çš„å…ƒç´ ä¸ªæ•°ä¸ä¸€è‡´ï¼Œåˆ™è¿”å›åˆ—è¡¨é•¿åº¦ä¸æœ€çŸ­çš„å¯¹è±¡ç›¸åŒï¼Œåˆ©ç”¨ * å·æ“ä½œç¬¦ï¼Œå¯ä»¥å°†å…ƒç»„è§£å‹ä¸ºåˆ—è¡¨ã€‚\nç”¨æ³•ï¼š\na = [\u0026#34;one\u0026#34;, \u0026#34;two\u0026#34;, \u0026#34;three\u0026#34;] b = [1, 2, 3, 4] list(zip(a, b)) # [(\u0026#39;one\u0026#39;, 1), (\u0026#39;two\u0026#39;, 2), (\u0026#39;three\u0026#39;, 3)] operator.attrgetter è¿”å›ä¸€ä¸ªå¯ä»æ“ä½œæ•°ä¸­è·å– attr çš„å¯è°ƒç”¨å¯¹è±¡ã€‚ å¦‚æœè¯·æ±‚äº†ä¸€ä¸ªä»¥ä¸Šçš„å±æ€§ï¼Œåˆ™è¿”å›ä¸€ä¸ªå±æ€§å…ƒç»„ã€‚ å±æ€§åç§°è¿˜å¯åŒ…å«ç‚¹å·ã€‚ ä¾‹å¦‚ï¼š\nåœ¨ f = attrgetter(\u0026lsquo;name\u0026rsquo;) ä¹‹åï¼Œè°ƒç”¨ f(b) å°†è¿”å› b.nameã€‚\nåœ¨ f = attrgetter(\u0026lsquo;name\u0026rsquo;, \u0026lsquo;date\u0026rsquo;) ä¹‹åï¼Œè°ƒç”¨ f(b) å°†è¿”å› (b.name, b.date)ã€‚\nåœ¨ f = attrgetter(\u0026lsquo;name.first\u0026rsquo;, \u0026lsquo;name.last\u0026rsquo;) ä¹‹åï¼Œè°ƒç”¨ f(b) å°†è¿”å› (b.name.first, b.name.last)ã€‚\nç”¨æ³•ï¼š\nfrom collections import namedtuple Name = namedtuple(\u0026#39;Name\u0026#39;, \u0026#39;firstname lastname\u0026#39;) Person = namedtuple(\u0026#39;Person\u0026#39;, \u0026#39;name age height\u0026#39;) myname = Name(firstname=\u0026#39;li\u0026#39;, lastname=\u0026#39;chang\u0026#39;) me = Person(name=myname, age=18, height=180) print(me) # Person(name=Name(firstname=\u0026#39;li\u0026#39;, lastname=\u0026#39;chang\u0026#39;), age=18, height=180) nameFn = attrgetter(\u0026#34;name\u0026#34;) nameFn(me) # Name(firstname=\u0026#39;li\u0026#39;, lastname=\u0026#39;chang\u0026#39;) firstNameFn = attrgetter(\u0026#34;name.firstname\u0026#34;) firstNameFn(me) # \u0026#39;li\u0026#39; operator.itemgetter è¿”å›ä¸€ä¸ªä½¿ç”¨æ“ä½œæ•°çš„ getitem() æ–¹æ³•ä»æ“ä½œæ•°ä¸­è·å– item çš„å¯è°ƒç”¨å¯¹è±¡ã€‚ å¦‚æœæŒ‡å®šäº†å¤šä¸ªæ¡ç›®ï¼Œåˆ™è¿”å›ä¸€ä¸ªæŸ¥æ‰¾å€¼çš„å…ƒç»„ã€‚\nä¾‹å¦‚ï¼š\nåœ¨ f = itemgetter(2) ä¹‹åï¼Œè°ƒç”¨ f(r) å°†è¿”å› r[2]ã€‚\nåœ¨ g = itemgetter(2, 5, 3) ä¹‹åï¼Œè°ƒç”¨ g(r) å°†è¿”å› (r[2], r[5], r[3])ã€‚\nç”¨æ³•ï¼š\nfrom operator import itemgetter index1 = itemgetter(1) index1(range(1, 10)) # 2 index1([\u0026#34;one\u0026#34;, \u0026#34;two\u0026#34;, \u0026#34;three\u0026#34;]) # \u0026#39;two\u0026#39; functools.partial ç§°ä¸ºåå‡½æ•°ï¼Œä½œç”¨æ˜¯æŠŠä¸€ä¸ªå‡½æ•°çš„æŸäº›å‚æ•°ç»™å›ºå®šä½\nç”¨æ³•ï¼š\nfrom functools import partial def powN(a, n=2): return a**n powN(2) # 4 pow10 = partial(powN, n=10) pow10(2) # 1024 å½“partialæ²¡æœ‰æŒ‡å®šå‚æ•°çš„åå­—æ—¶ï¼Œä¼šæŠŠå‚æ•°åŠ åˆ°è¢«è°ƒç”¨å‡½æ•°çš„å‚æ•°åˆ—è¡¨å·¦è¾¹ï¼Œå¦‚ï¼š\nfrom functools import partial maxOr10 = partial(max, 10) maxOr10(11) # 11 maxOr10(1) # 1 ","permalink":"http://yangchnet.github.io/Dessert/posts/python/python%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0/","summary":"å¦‚æœä¸€ä¸ªå‡½æ•°èƒ½æ¥æ”¶ä¸€ä¸ªå‡½æ•°ä¸ºå‚æ•°æˆ–è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œé‚£è¿™ä¸ªå‡½æ•°å°±è¢«ç§°ä¸ºé«˜é˜¶å‡½æ•°ã€‚\n 1. sorted sortedå¯ä»¥è¯´æ˜¯æœ€å¸¸ç”¨çš„é«˜é˜¶å‡½æ•°ï¼Œå…¶ç”¨æ³•å¦‚ä¸‹ï¼š\nm = {\u0026#34;three\u0026#34;: 3, \u0026#34;tow\u0026#34;: 2, \u0026#34;one\u0026#34;: 1 sorted(m.items(), key=lambda x: x[1]) # [(\u0026#39;one\u0026#39;, 1), (\u0026#39;tow\u0026#39;, 2), (\u0026#39;three\u0026#39;, 3)] sortedå¯æ ¹æ®å…¶å‚æ•°keyè¿”å›çš„å€¼æ¥è¿›è¡Œæ’åºã€‚\n2. map map()å‡½æ•°æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯å‡½æ•°ï¼Œä¸€ä¸ªæ˜¯Iterableï¼Œmapå°†ä¼ å…¥çš„å‡½æ•°ä¾æ¬¡ä½œç”¨åˆ°åºåˆ—çš„æ¯ä¸ªå…ƒç´ ï¼Œå¹¶æŠŠç»“æœä½œä¸ºæ–°çš„Iteratorè¿”å›ã€‚\nå¦‚ï¼š\ndef add10(x): return x+10 print(map(add10, [1, 2, 3])) # \u0026lt;map object at 0x7f5824cd01c0\u0026gt; list(map(add10, [1, 2, 3])) # [11, 12, 13] list(map(str, [1, 2, 3, 4, 5, 6, 7, 8, 9])) # [\u0026#39;1\u0026#39;, \u0026#39;2\u0026#39;, \u0026#39;3\u0026#39;, \u0026#39;4\u0026#39;, \u0026#39;5\u0026#39;, \u0026#39;6\u0026#39;, \u0026#39;7\u0026#39;, \u0026#39;8\u0026#39;, \u0026#39;9\u0026#39;] functools.","title":"pythoné«˜é˜¶å‡½æ•°"},{"content":"1. sysstatç®€ä»‹ sysstatæ˜¯ä¸€ä¸ªè½¯ä»¶åŒ…ï¼ŒåŒ…å«ç›‘æµ‹ç³»ç»Ÿæ€§èƒ½åŠæ•ˆç‡çš„ä¸€ç»„å·¥å…·ï¼Œè¿™äº›å·¥å…·å¯¹äºæˆ‘ä»¬æ”¶é›†ç³»ç»Ÿæ€§èƒ½æ•°æ®ï¼Œæ¯”å¦‚ï¼šCPU ä½¿ç”¨ç‡ã€ç¡¬ç›˜å’Œç½‘ç»œååæ•°æ®ï¼Œè¿™äº›æ•°æ®çš„æ”¶é›†å’Œåˆ†æï¼Œæœ‰åˆ©äºæˆ‘ä»¬åˆ¤æ–­ç³»ç»Ÿæ˜¯å¦æ­£å¸¸è¿è¡Œï¼Œæ˜¯æé«˜ç³»ç»Ÿè¿è¡Œæ•ˆç‡ã€å®‰å…¨è¿è¡ŒæœåŠ¡å™¨çš„å¾—åŠ›åŠ©æ‰‹ã€‚\nsysstatåŒ…å«å¤šä¸ªå·¥å…·å¥—ä»¶ï¼š é¦–å…ˆæ˜¯statç³»åˆ—\n iostat è¾“å‡ºCPUçš„ç»Ÿè®¡ä¿¡æ¯å’Œæ‰€æœ‰I/Oè®¾å¤‡çš„è¾“å…¥è¾“å‡ºï¼ˆI/Oï¼‰ç»Ÿè®¡ä¿¡æ¯ mpstat å…³äºCPUçš„è¯¦ç»†ä¿¡æ¯ï¼ˆå•ç‹¬è¾“å‡ºæˆ–è€…åˆ†ç»„è¾“å‡ºï¼‰ pidstat å…³äºè¿è¡Œä¸­çš„è¿›ç¨‹/ä»»åŠ¡ã€CPUã€å†…å­˜ç­‰çš„ç»Ÿè®¡ä¿¡æ¯ sysstat sysstat å·¥å…·åŒ…çš„ man å¸®åŠ©é¡µé¢ã€‚ nfsiostat NFSï¼ˆNetwork File Systemï¼‰çš„I/Oç»Ÿè®¡ä¿¡æ¯ cifsiostat CIFS(Common Internet File System)çš„ç»Ÿè®¡ä¿¡æ¯  è¿˜æœ‰saç³»åˆ— 7. sar ä¿å­˜å¹¶è¾“å‡ºä¸åŒç³»ç»Ÿèµ„æºï¼ˆCPUã€å†…å­˜ã€IOã€ç½‘ç»œã€å†…æ ¸ç­‰ï¼‰çš„è¯¦ç»†ä¿¡æ¯ 8. sadc ç³»ç»Ÿæ´»åŠ¨æ•°æ®æ”¶é›†å™¨ï¼Œç”¨äºæ”¶é›†sarå·¥å…·çš„åç«¯æ•°æ® 9. sa1 ç³»ç»Ÿæ”¶é›†å¹¶å­˜å‚¨sadcæ•°æ®æ–‡ä»¶çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œä¸sadcå·¥å…·é…åˆä½¿ç”¨ 10. sa2 é…åˆsarå·¥å…·ä½¿ç”¨ï¼Œäº§ç”Ÿæ¯æ—¥çš„æ‘˜è¦æŠ¥å‘Š 11. sadf ç”¨äºä»¥ä¸åŒçš„æ•°æ®æ ¼å¼ï¼ˆCVSæˆ–è€…XMLï¼‰æ¥æ ¼å¼åŒ–sarå·¥å…·çš„è¾“å‡º\n2. ç®€å•ä½¿ç”¨  iostat    iostat: æ˜¾ç¤ºä»ç³»ç»Ÿå¯åŠ¨è‡³ä»Šçš„ioå†å²æ•°æ®\n  iostat -d 2: æ¯éš”ä¸¤ç§’æ˜¾ç¤ºä¸€ä¸ªè¿ç»­çš„è®¾å¤‡æŠ¥å‘Šã€‚\n  iostat -d 2 6: ä¸ºæ‰€æœ‰è®¾å¤‡æ˜¾ç¤º6ä¸ªæŠ¥å‘Šï¼Œæ¯éš”ä¸¤ç§’æ˜¾ç¤ºä¸€ä¸ª\n  iostat -x sda sdb 2 6: ä¸ºsdaå’Œsdbä¸¤ä¸ªè®¾å¤‡æ˜¾ç¤º6ä¸ªæŠ¥å‘Šï¼Œæ¯éš”2ç§’æ˜¾ç¤ºä¸€ä¸ª\n  iostat -p sda 2 6: ä¸ºsdaè®¾å¤‡å’Œå…¶æ‰€æœ‰éƒ¨åˆ†æ˜¾ç¤º6ä¸ªæŠ¥å‘Šï¼Œæ¯éš”ä¸¤ç§’\n  mpstat    mpstat -o JSON 2 2: ä»¥jsonæ ¼å¼è¾“å‡ºcpuä¿¡æ¯ï¼Œ æ¯éš”ä¸¤ç§’è¾“å‡ºä¸€æ¬¡ï¼Œè¾“å‡ºä¸¤ä¸ª\n  mpstat -P ALL 2 5: ä»¥2ç§’ä¸ºé—´éš”è¾“å‡º5ä¸ªç»Ÿè®¡ä¿¡æ¯\n  pidstat    pidstat 2 5: ä¸ºæ‰€æœ‰æ´»åŠ¨ä»»åŠ¡ä»¥2ç§’ä¸ºé—´éš”è¾“å‡º5ä¸ªç»Ÿè®¡ä¿¡æ¯\n  pidstat -r -p 1643 2 5: è¾“å‡ºpidä¸º1643çš„è¿›ç¨‹çš„ç¼ºé¡µä¿¡æ¯ï¼Œ2/5\n  pidstat -T CHILD -r 2 5: ä¸ºæ‰€æœ‰ä»»åŠ¡çš„å­è¿›ç¨‹è¾“å‡ºç¼ºé¡µä¿¡æ¯ï¼Œåªæœ‰é0çš„ç¼ºé¡µæ‰ä¼šè¢«ç»Ÿè®¡\n  pidstat -C \u0026quot;fox|bird\u0026quot; -r -p ALL-: ä¸ºå‘½ä»¤ååŒ…å«â€œboxâ€æˆ–â€œbirdâ€çš„è¿›ç¨‹è¾“å‡ºå…¨å±€ç¼ºé¡µä¿¡æ¯\n  sar    sar -u 2 5: æ¯ 2 ç§’æŠ¥å‘Šä¸€æ¬¡ CPU åˆ©ç”¨ç‡, æ˜¾ç¤º 5 è¡Œã€‚\n  sar -I 14 -o int14.file 2 10: æ¯ 2 ç§’æŠ¥å‘Šä¸€æ¬¡ IRQ 14 çš„ç»Ÿè®¡ä¿¡æ¯, æ˜¾ç¤º 10 è¡Œ, æ•°æ®å­˜å‚¨åœ¨åä¸º int14.file çš„æ–‡ä»¶ä¸­ã€‚\n  sar -r -n DEV -f /var/log/sa/sa16: æ˜¾ç¤ºä¿å­˜åœ¨æ¯æ—¥æ•°æ®æ–‡ä»¶â€œsa16â€ä¸­çš„å†…å­˜å’Œç½‘ç»œç»Ÿè®¡ä¿¡æ¯ã€‚\n  sar -A: æ˜¾ç¤ºå½“å‰æ¯æ—¥æ•°æ®æ–‡ä»¶ä¸­ä¿å­˜çš„æ‰€æœ‰ç»Ÿè®¡æ•°æ®ã€‚\n  ","permalink":"http://yangchnet.github.io/Dessert/posts/linux/%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7-sysstat/","summary":"1. sysstatç®€ä»‹ sysstatæ˜¯ä¸€ä¸ªè½¯ä»¶åŒ…ï¼ŒåŒ…å«ç›‘æµ‹ç³»ç»Ÿæ€§èƒ½åŠæ•ˆç‡çš„ä¸€ç»„å·¥å…·ï¼Œè¿™äº›å·¥å…·å¯¹äºæˆ‘ä»¬æ”¶é›†ç³»ç»Ÿæ€§èƒ½æ•°æ®ï¼Œæ¯”å¦‚ï¼šCPU ä½¿ç”¨ç‡ã€ç¡¬ç›˜å’Œç½‘ç»œååæ•°æ®ï¼Œè¿™äº›æ•°æ®çš„æ”¶é›†å’Œåˆ†æï¼Œæœ‰åˆ©äºæˆ‘ä»¬åˆ¤æ–­ç³»ç»Ÿæ˜¯å¦æ­£å¸¸è¿è¡Œï¼Œæ˜¯æé«˜ç³»ç»Ÿè¿è¡Œæ•ˆç‡ã€å®‰å…¨è¿è¡ŒæœåŠ¡å™¨çš„å¾—åŠ›åŠ©æ‰‹ã€‚\nsysstatåŒ…å«å¤šä¸ªå·¥å…·å¥—ä»¶ï¼š é¦–å…ˆæ˜¯statç³»åˆ—\n iostat è¾“å‡ºCPUçš„ç»Ÿè®¡ä¿¡æ¯å’Œæ‰€æœ‰I/Oè®¾å¤‡çš„è¾“å…¥è¾“å‡ºï¼ˆI/Oï¼‰ç»Ÿè®¡ä¿¡æ¯ mpstat å…³äºCPUçš„è¯¦ç»†ä¿¡æ¯ï¼ˆå•ç‹¬è¾“å‡ºæˆ–è€…åˆ†ç»„è¾“å‡ºï¼‰ pidstat å…³äºè¿è¡Œä¸­çš„è¿›ç¨‹/ä»»åŠ¡ã€CPUã€å†…å­˜ç­‰çš„ç»Ÿè®¡ä¿¡æ¯ sysstat sysstat å·¥å…·åŒ…çš„ man å¸®åŠ©é¡µé¢ã€‚ nfsiostat NFSï¼ˆNetwork File Systemï¼‰çš„I/Oç»Ÿè®¡ä¿¡æ¯ cifsiostat CIFS(Common Internet File System)çš„ç»Ÿè®¡ä¿¡æ¯  è¿˜æœ‰saç³»åˆ— 7. sar ä¿å­˜å¹¶è¾“å‡ºä¸åŒç³»ç»Ÿèµ„æºï¼ˆCPUã€å†…å­˜ã€IOã€ç½‘ç»œã€å†…æ ¸ç­‰ï¼‰çš„è¯¦ç»†ä¿¡æ¯ 8. sadc ç³»ç»Ÿæ´»åŠ¨æ•°æ®æ”¶é›†å™¨ï¼Œç”¨äºæ”¶é›†sarå·¥å…·çš„åç«¯æ•°æ® 9. sa1 ç³»ç»Ÿæ”¶é›†å¹¶å­˜å‚¨sadcæ•°æ®æ–‡ä»¶çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œä¸sadcå·¥å…·é…åˆä½¿ç”¨ 10. sa2 é…åˆsarå·¥å…·ä½¿ç”¨ï¼Œäº§ç”Ÿæ¯æ—¥çš„æ‘˜è¦æŠ¥å‘Š 11. sadf ç”¨äºä»¥ä¸åŒçš„æ•°æ®æ ¼å¼ï¼ˆCVSæˆ–è€…XMLï¼‰æ¥æ ¼å¼åŒ–sarå·¥å…·çš„è¾“å‡º\n2. ç®€å•ä½¿ç”¨  iostat    iostat: æ˜¾ç¤ºä»ç³»ç»Ÿå¯åŠ¨è‡³ä»Šçš„ioå†å²æ•°æ®\n  iostat -d 2: æ¯éš”ä¸¤ç§’æ˜¾ç¤ºä¸€ä¸ªè¿ç»­çš„è®¾å¤‡æŠ¥å‘Šã€‚\n  iostat -d 2 6: ä¸ºæ‰€æœ‰è®¾å¤‡æ˜¾ç¤º6ä¸ªæŠ¥å‘Šï¼Œæ¯éš”ä¸¤ç§’æ˜¾ç¤ºä¸€ä¸ª\n  iostat -x sda sdb 2 6: ä¸ºsdaå’Œsdbä¸¤ä¸ªè®¾å¤‡æ˜¾ç¤º6ä¸ªæŠ¥å‘Šï¼Œæ¯éš”2ç§’æ˜¾ç¤ºä¸€ä¸ª","title":"statç³»åˆ—æ€§èƒ½åˆ†æå·¥å…·"},{"content":"npm: nvm\npython: pyenv\ngo: asdf\nasdfå¯ç”¨äºå¤šä¸ªè¯­è¨€çš„å¤šç‰ˆæœ¬ç¯å¢ƒç®¡ç†\n","permalink":"http://yangchnet.github.io/Dessert/posts/env/%E5%A4%9A%E7%89%88%E6%9C%AC%E8%AF%AD%E8%A8%80%E7%8E%AF%E5%A2%83/","summary":"npm: nvm\npython: pyenv\ngo: asdf\nasdfå¯ç”¨äºå¤šä¸ªè¯­è¨€çš„å¤šç‰ˆæœ¬ç¯å¢ƒç®¡ç†","title":"å¤šç‰ˆæœ¬è¯­è¨€ç¯å¢ƒ"},{"content":" æœ¬ç³»åˆ—ä»£ç åŸºäºgolang1.19\n  runtimeç¯‡ä¸€ï¼šæ¥å£ runtimeç¯‡äºŒï¼šé€šé“ runtimeç¯‡ä¸‰ï¼šdefer runtimeç¯‡å››ï¼španic runtimeç¯‡äº”ï¼šslice   æ¨èé˜…è¯»ï¼šsliceå’Œæ•°ç»„çš„åŒºåˆ« åˆ‡ç‰‡appendè§„åˆ™\n 1. åˆ‡ç‰‡çš„ç»“æ„ åˆ‡ç‰‡çš„åº•å±‚è¡¨ç¤ºæ˜¯runtime.slice:\ntype slice struct { array unsafe.Pointer len int cap int } éå¸¸ç®€å•ï¼Œåªæœ‰ä¸€ä¸ªarrayæŒ‡é’ˆæŒ‡å‘åº•å±‚æ•°ç»„ç»“æ„ï¼Œlenæ ‡è®°åˆ‡ç‰‡é•¿åº¦ï¼Œcapæ ‡è®°æ•°ç»„å®¹é‡ã€‚\n2. æ–°å»ºä¸€ä¸ªåˆ‡ç‰‡ å½“æˆ‘ä»¬ä½¿ç”¨å¦‚make([]int, 0)è¯­æ³•æ¥æ–°å»ºä¸€ä¸ªåˆ‡ç‰‡çš„æ—¶å€™ï¼Œè°ƒç”¨çš„æ˜¯runtime.makesliceå‡½æ•°ï¼š\nfunc makeslice(et *_type, len, cap int) unsafe.Pointer { mem, overflow := math.MulUintptr(et.size, uintptr(cap)) if overflow || mem \u0026gt; maxAlloc || len \u0026lt; 0 || len \u0026gt; cap { // NOTE: Produce a \u0026#39;len out of range\u0026#39; error instead of a \t// \u0026#39;cap out of range\u0026#39; error when someone does make([]T, bignumber). \t// \u0026#39;cap out of range\u0026#39; is true too, but since the cap is only being \t// supplied implicitly, saying len is clearer. \t// See golang.org/issue/4085. \tmem, overflow := math.MulUintptr(et.size, uintptr(len)) if overflow || mem \u0026gt; maxAlloc || len \u0026lt; 0 { panicmakeslicelen() } panicmakeslicecap() } return mallocgc(mem, et, true) } è¿™ä¸ªå‡½æ•°ä¹Ÿå¾ˆç®€å•ï¼Œé¦–å…ˆæ˜¯ä½¿ç”¨math.MulUintptrè®¡ç®—sliceéœ€è¦çš„ç©ºé—´ï¼Œmath.MulUintpträ¼šè¿”å›_typeå¤§å°å’Œlençš„ä¹˜ç§¯ä»¥åŠoverflowæ ‡å¿—æ¥è¡¨æ˜æ˜¯å¦è¶…å‡ºå†…å­˜é™åˆ¶ã€‚å¦‚æœè¶…å‡ºå†…å­˜é™åˆ¶æˆ–è€…lenå°äº0ï¼Œæˆ–len\u0026gt;capï¼Œåˆ™åˆ†é…å¤±è´¥ï¼ŒæŠ›å‡ºpanicã€‚\nå¦åˆ™ç›´æ¥è°ƒç”¨mallocgcæ¥ä¸ºsliceåˆ†é…ç©ºé—´ï¼Œå¹¶å°†è¿”å›çš„unsafe.Pointerèµ‹å€¼çµ¦slice.array\nå¯¹äºä»¥ä¸‹ä»£ç æ¥è¯´ï¼š\na := make([]int, 10) å…¶sliceæ„é€ è¿‡ç¨‹ä¸ºè¿™æ ·ï¼š\n0x0018 00024 (main.go:6) LEAQ type.int(SB), AX # AXä¸­å­˜çš„æ˜¯type.intï¼Œå³int(_type) 0x001f 00031 (main.go:6) MOVL $10, BX # BXä¸­å­˜çš„æ˜¯10ï¼Œåˆ‡ç‰‡len 0x0024 00036 (main.go:6) MOVQ BX, CX # CXä¸BXç›¸ç­‰ï¼Œä¸ºcap = 10 0x0027 00039 (main.go:6) PCDATA $1, $0 0x0027 00039 (main.go:6) CALL runtime.makeslice(SB) # runtime.makeslice(AX, BX, CX) 0x002c 00044 (main.go:6) MOVQ AX, \u0026#34;\u0026#34;.a+56(SP) # runtime.makesliceçš„è¿”å›å€¼AXèµ‹å€¼ç»™\u0026#34;\u0026#34;.a+56(SP)ï¼Œå³slice.array 0x0031 00049 (main.go:6) MOVQ $10, \u0026#34;\u0026#34;.a+64(SP) # \u0026#34;\u0026#34;.a+64(SP)ï¼Œå³slice.len ä¸º10 0x003a 00058 (main.go:6) MOVQ $10, \u0026#34;\u0026#34;.a+72(SP) # \u0026#34;\u0026#34;.a+72(SP)ï¼Œå³slice.cap ä¸º10 3. åˆ‡ç‰‡å®¹é‡å¢é•¿  å¤§çº¦2021å¹´8æœˆä»½ï¼Œgoç¤¾åŒºå¯¹åˆ‡ç‰‡å®¹é‡å¢é•¿çš„æ–¹å¼è¿›è¡Œäº†ä¸€æ¬¡è°ƒæ•´ã€‚å…·ä½“è®¨è®ºå¯è§ï¼šhttps://groups.google.com/g/golang-nuts/c/UaVlMQ8Nz3o\n 3.1 ä¹‹å‰çš„å¢é•¿è§„åˆ™ å…ˆçœ‹æºç \n runtime/slice.go\n func growslice(et *_type, old slice, cap int) slice { // çœç•¥éƒ¨åˆ†æ¡ä»¶æ£€æŸ¥  // ...  newcap := old.cap doublecap := newcap + newcap if cap \u0026gt; doublecap { newcap = cap } else { if old.cap \u0026lt; 1024 { newcap = doublecap } else { // Check 0 \u0026lt; newcap to detect overflow \t// and prevent an infinite loop. \tfor 0 \u0026lt; newcap \u0026amp;\u0026amp; newcap \u0026lt; cap { newcap += newcap / 4 } // Set newcap to the requested cap when \t// the newcap calculation overflowed. \tif newcap \u0026lt;= 0 { newcap = cap } } } // å¯¹åˆ‡ç‰‡è¿›è¡Œå†…å­˜å¯¹é½ï¼Œå¯èƒ½ä¼šè°ƒæ•´åˆ‡ç‰‡å®¹é‡å¤§å°  // ...  return slice{p, old.len, newcap} } ä»ä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œå½“cap \u0026lt; 1024æ—¶ï¼Œåˆ‡ç‰‡å®¹é‡å¢é•¿2å€ï¼Œå½“cap \u0026gt; 1024æ—¶å¢é•¿1.25å€ï¼Œå½“ç„¶ï¼Œåœ¨ç»è¿‡å†…å­˜å¯¹é½ç­‰æ“ä½œåï¼Œåˆ‡ç‰‡çš„é•¿åº¦å¯èƒ½ä¸ä¼šä¸¥æ ¼ç­‰äºåŸæ¥çš„2å€æˆ–1.25å€ã€‚\nå­˜åœ¨çš„é—®é¢˜ï¼š\n not monotonically increasing ï¼ˆä¸å¹³æ»‘ï¼‰  x1 := make([]int, 897) x2 := make([]int, 1024) y := make([]int, 100) println(cap(append(x1, y...))) // 2048 println(cap(append(x2, y...))) // 1280 å¯¹äºappend(x1, y...), è¿›è¡Œgrowsliceï¼Œä¼ å…¥çš„capä¸ºæ‰€éœ€çš„æœ€å°å®¹é‡ï¼Œä¸ºï¼šcap(x1) + cap(y) = 997ã€‚ æ­¤æ—¶newcapä¸º897, doublecapä¸º897Ã—2 = 1794ã€‚ç”±äºold.cap = 897 \u0026lt; 1024, æ‰€ä»¥newcap = doublecapï¼Œä¸º1794,å†ç»è¿‡å†…å­˜å¯¹é½åï¼Œæœ€ç»ˆçš„å®¹é‡ä¸º2048.\nå¯¹äºappend(x2, y...), è¿›è¡Œgrowsliceï¼Œä¼ å…¥çš„capä¸º1124,æ­¤æ—¶newcapä¸º1024, doublecapä¸º1024Ã—2 = 2048. ç”±äºcap \u0026lt; doublecapä¸”newcap\u0026lt; cap,å› æ­¤newcap += newcap / 4 = 1280.ç»è¿‡å†…å­˜å¯¹é½åï¼Œä»ä¸º1280.ã€‚\nè¿™æ ·å°±äº§ç”Ÿäº†ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨ä¸€å®šæ¡ä»¶ä¸‹ï¼Œå¦‚æœcap(A) \u0026lt; cap(B), ä½†äºŒè€…éƒ½appendä¸€ä¸ªç›¸åŒé•¿åº¦çš„Cåï¼Œåè€Œcap(A) \u0026gt; cap(B)ã€‚\nnot symmetrical ï¼ˆä¸å¯¹ç§°ï¼‰  x := make([]int, 98) y := make([]int, 666) println(cap(append(x, y...))) // 768 println(cap(append(y, x...))) // 1360 3.2 è°ƒæ•´ä¹‹å æºç ï¼š\nfunc growslice(et *_type, old slice, cap int) slice { // çœç•¥éƒ¨åˆ†æ¡ä»¶æ£€æŸ¥  // ...  newcap := old.cap doublecap := newcap + newcap if cap \u0026gt; doublecap { newcap = cap } else { const threshold = 256 if old.cap \u0026lt; threshold { newcap = doublecap } else { // Check 0 \u0026lt; newcap to detect overflow \t// and prevent an infinite loop. \tfor 0 \u0026lt; newcap \u0026amp;\u0026amp; newcap \u0026lt; cap { // Transition from growing 2x for small slices \t// to growing 1.25x for large slices. This formula \t// gives a smooth-ish transition between the two. \tnewcap += (newcap + 3*threshold) / 4 } // Set newcap to the requested cap when \t// the newcap calculation overflowed. \tif newcap \u0026lt;= 0 { newcap = cap } } } // å¯¹åˆ‡ç‰‡è¿›è¡Œå†…å­˜å¯¹é½ï¼Œå¯èƒ½ä¼šè°ƒæ•´åˆ‡ç‰‡å®¹é‡å¤§å°  // ...  return slice{p, old.len, newcap} } è¿›è¡Œçš„è°ƒæ•´ï¼š\n å¢åŠ äº†threshold = 256 å¢é•¿ç­–ç•¥ä¸åŒçš„é˜ˆå€¼ä»1024å˜ä¸º256 å½“åˆ‡ç‰‡å®¹é‡å¤§äºé˜ˆå€¼æ—¶ï¼Œå¢é•¿ç­–ç•¥å˜åŒ–  åŸæ¥çš„é—®é¢˜ï¼š\n å¢é•¿ä¸å¹³æ»‘  x1 := make([]int, 897) x2 := make([]int, 1024) y := make([]int, 100) println(cap(append(x1, y...))) // 1360 println(cap(append(x2, y...))) // 1536 å¢é•¿ä¸å¯¹ç§°  x := make([]int, 98) y := make([]int, 666) println(cap(append(x, y...))) // 768 println(cap(append(y, x...))) // 1024 å¢é•¿ä¸å¹³æ»‘çš„é—®é¢˜å¾—åˆ°äº†è¾ƒå¥½çš„è§£å†³ï¼ŒåŒæ—¶ä¸å¯¹ç§°çš„é—®é¢˜ä¹Ÿå¾—åˆ°äº†ç¼“è§£ã€‚\n3.3 è¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼š\n åœ¨ç»è¿‡appendä¹‹åï¼Œslice.arrayå‘ç”Ÿäº†å˜åŒ–ï¼Œå¯èƒ½ä¸å†æ˜¯åŸæ¥æŒ‡å‘çš„åœ°å€äº† åœ¨appendä¸­ï¼Œæœ€ç»ˆè¦ç»è¿‡ä¸€æ¬¡åœ°å€å¯¹é½ï¼Œè¿›è¡Œå†…å­˜å¯¹é½ä¹‹åï¼Œæ–° slice çš„å®¹é‡æ˜¯è¦ å¤§äºç­‰äº æŒ‰ç…§å‰åŠéƒ¨åˆ†ç”Ÿæˆçš„newcap  4. Reference https://golang.design/go-questions/slice/grow/\nhttps://www.cnblogs.com/qcrao-2018/p/10631989.html\nhttps://yangchnet.github.io/Dessert/posts/golang/slice%E5%92%8C%E6%95%B0%E7%BB%84%E7%9A%84%E5%8C%BA%E5%88%AB/\nhttps://yangchnet.github.io/Dessert/posts/golang/%E5%88%87%E7%89%87append%E8%A7%84%E5%88%99/\n","permalink":"http://yangchnet.github.io/Dessert/posts/golang/runtime%E7%AF%87%E4%BA%94slice/","summary":"æœ¬ç³»åˆ—ä»£ç åŸºäºgolang1.19\n  runtimeç¯‡ä¸€ï¼šæ¥å£ runtimeç¯‡äºŒï¼šé€šé“ runtimeç¯‡ä¸‰ï¼šdefer runtimeç¯‡å››ï¼španic runtimeç¯‡äº”ï¼šslice   æ¨èé˜…è¯»ï¼šsliceå’Œæ•°ç»„çš„åŒºåˆ« åˆ‡ç‰‡appendè§„åˆ™\n 1. åˆ‡ç‰‡çš„ç»“æ„ åˆ‡ç‰‡çš„åº•å±‚è¡¨ç¤ºæ˜¯runtime.slice:\ntype slice struct { array unsafe.Pointer len int cap int } éå¸¸ç®€å•ï¼Œåªæœ‰ä¸€ä¸ªarrayæŒ‡é’ˆæŒ‡å‘åº•å±‚æ•°ç»„ç»“æ„ï¼Œlenæ ‡è®°åˆ‡ç‰‡é•¿åº¦ï¼Œcapæ ‡è®°æ•°ç»„å®¹é‡ã€‚\n2. æ–°å»ºä¸€ä¸ªåˆ‡ç‰‡ å½“æˆ‘ä»¬ä½¿ç”¨å¦‚make([]int, 0)è¯­æ³•æ¥æ–°å»ºä¸€ä¸ªåˆ‡ç‰‡çš„æ—¶å€™ï¼Œè°ƒç”¨çš„æ˜¯runtime.makesliceå‡½æ•°ï¼š\nfunc makeslice(et *_type, len, cap int) unsafe.Pointer { mem, overflow := math.MulUintptr(et.size, uintptr(cap)) if overflow || mem \u0026gt; maxAlloc || len \u0026lt; 0 || len \u0026gt; cap { // NOTE: Produce a \u0026#39;len out of range\u0026#39; error instead of a \t// \u0026#39;cap out of range\u0026#39; error when someone does make([]T, bignumber).","title":"runtimeç¯‡äº”ï¼šslice"},{"content":" æœ¬ç³»åˆ—ä»£ç åŸºäºgolang1.19\n  runtimeç¯‡ä¸€ï¼šæ¥å£ runtimeç¯‡äºŒï¼šé€šé“ runtimeç¯‡ä¸‰ï¼šdefer runtimeç¯‡å››ï¼španic runtimeç¯‡äº”ï¼šslice  1. deferæ˜¯ä»€ä¹ˆ deferï¼Œæ˜¯ä¸€ç§ç‰¹æ®Šçš„æœºåˆ¶ï¼Œåœ¨è°ƒç”¨æ™®é€šå‡½æ•°æˆ–æ–¹æ³•å‰åŠ ä¸Šå…³é”®å­—deferï¼Œå°±å®Œæˆäº†deferæ‰€éœ€è¦çš„è¯­æ³•ã€‚å½“deferè¯­å¥è¢«æ‰§è¡Œæ—¶ï¼Œè·Ÿåœ¨deferåé¢çš„å‡½æ•°ä¼šè¢«å»¶è¿Ÿæ‰§è¡Œã€‚ç›´åˆ°åŒ…å«è¯¥deferè¯­å¥çš„å‡½æ•°æ‰§è¡Œå®Œæ¯•æ—¶ï¼Œdeferåçš„å‡½æ•°æ‰ä¼šè¢«æ‰§è¡Œï¼Œå¤šä¸ªdeferçš„æ‰§è¡Œé¡ºåºä¸å£°æ˜é¡ºåºç›¸åã€‚\nå¯¹äºdeferçš„ä½¿ç”¨åŠéœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼Œå¯å‚è€ƒdeferç”¨æ³•ã€‚è¿™é‡Œä¸å†è®¨è®ºã€‚\nåœ¨golang runtimeä¸­ï¼Œdeferè¢«æè¿°ä¸ºä¸€ä¸ªç»“æ„ä½“ï¼š\ntype _defer struct { started bool // æ˜¯å¦å¼€å§‹æ‰§è¡Œdeferå‡½æ•° \theap bool // æ˜¯å¦åˆ†é…åœ¨å †ä¸Š  openDefer bool // æ˜¯å¦ç»è¿‡å¼€æ”¾ç¼–ç ï¼ˆopen-codedï¼‰çš„ä¼˜åŒ– \tsp uintptr // è°ƒç”¨deferæ—¶çš„æ ˆæŒ‡é’ˆ stack pointer \tpc uintptr // è°ƒç”¨deferå‡½æ•°æ—¶çš„pcå€¼ \tfn func() // deferå…³é”®å­—ä¼ å…¥çš„å‡½æ•°ï¼Œ å½“ä½¿ç”¨open-coded deferæ—¶å¯ä¸ºç©º \t_panic *_panic // deferå‡½æ•°ä¸­çš„_panicé“¾è¡¨ \tlink *_defer // åœ¨goroutineä¸­çš„ä¸‹ä¸€ä¸ªdeferï¼Œå¯æŒ‡å‘å †æˆ–æ ˆ  // å¦‚æœopenDeferä¸ºtrueï¼Œåˆ™ä¸‹é¢çš„å­—æ®µå°†è®°å½•å…·æœ‰open-code deferçš„æ ˆå¸§å’Œç›¸å…³çš„å‡½æ•°ã€‚  // ä¸Šé¢çš„spå°†ä¸ºå¸§çš„spï¼Œpcå°†ä¸ºdeferè°ƒç”¨çš„åœ°å€ã€‚ \tfd unsafe.Pointer // funcdata for the function associated with the frame \tvarp uintptr // value of varp for the stack frame  framepc uintptr // å½“å‰æ ˆå¸§çš„pc } ä¸€ä¸ª_deferç»“æ„ä½“æ˜¯deferè°ƒç”¨çš„ä¸€ç¯ï¼Œä¸€ä¸ªå‡½æ•°ä¸­çš„å¤šä¸ªdeferè¢«ç»„ç»‡ä¸ºé“¾è¡¨çš„å½¢å¼ã€‚deferæœ‰çš„åˆ†é…åœ¨æ ˆä¸Šï¼Œæœ‰çš„åˆ†é…åœ¨å †ä¸Šï¼Œä½†é€»è¾‘ä¸Šä»–ä»¬éƒ½æ˜¯å±äºæ ˆçš„ï¼Œå› æ­¤åœ¨è¿›è¡Œè®¿é—®ä¸éœ€è¦åŠ å†™å±éšœã€‚\nå¯ä»¥çœ‹åˆ°ï¼Œ _deferä¸­ä¿å­˜äº†å¾ˆå¤šå­—æ®µï¼Œä¸»è¦å¯åˆ†ä¸ºä¸‰ç±»ï¼Œä¸€æ˜¯æŒ‡ç¤ºdeferè‡ªèº«çŠ¶æ€çš„æ ‡å¿—ä½ï¼Œå¦‚started,heapç­‰ï¼›äºŒæ˜¯ä¿å­˜deferä¸Šä¸‹æ–‡ï¼Œå¦‚sp, pcç­‰ï¼›ä¸‰æ˜¯æœ‰å…³å¼€æ”¾ç¼–ç çš„ä¸€äº›å­—æ®µã€‚\n1.1 open-coded defer åœ¨_deferä¸­ï¼Œæœ‰ä¸€ä¸ªå­—æ®µopenDeferæŒ‡ç¤ºæ˜¯å¦è¿™ä¸ªdeferç»è¿‡å¼€æ”¾ç¼–ç çš„ä¼˜åŒ–ï¼Œé‚£ä¹ˆï¼Œä»€ä¹ˆæ˜¯open code defer?\nå¯¹äºä¸€ä¸ªdeferå‡½æ•°æ¥è¯´ï¼Œå°†å…¶æ”¾å…¥deferé“¾è¡¨è°ƒç”¨ä¸ç›´æ¥è°ƒç”¨æ˜¯å­˜åœ¨æ€§èƒ½å·®å¼‚çš„ï¼Œä¾‹å¦‚ç›´æ¥è°ƒç”¨çš„è€—æ—¶å¯èƒ½åœ¨6nså·¦å³ï¼Œè€Œä»deferé“¾è¡¨ä¸­è°ƒç”¨çš„è€—æ—¶åœ¨35nså·¦å³[1]ï¼Œå…¶ä¸­çš„ä¸»è¦åŸå› åœ¨äºï¼Œå°†å‡½æ•°æ”¾å…¥deferé“¾è¡¨æˆ–å°†å…¶å–å‡ºæ‰§è¡Œæ—¶ï¼Œéœ€è¦å¯¹ä¸Šä¸‹æ–‡ç¯å¢ƒåšä¿å­˜å’Œé‡åšã€‚å› æ­¤ï¼Œåœ¨go1.14ä¸­å¯¹å…¶è¿›è¡Œäº†ä¼˜åŒ–ï¼Œå¯¹äºæ»¡è¶³ä¸€å®šæ¡ä»¶çš„deferï¼Œä¼šè¿›è¡Œopen-codedä¼˜åŒ–ã€‚\nä¾‹å¦‚ï¼Œå¯¹äºå¦‚ä¸‹ä»£ç ï¼š\ndefer f1(a) if cond { defer f2(b) } body... å°†è¢«ç¼–è¯‘ä¸ºï¼š\n// è®¾ç½®æ ‡è¯†ä½ deferBits |= 1\u0026lt;\u0026lt;0 tmpF1 = f1 tmpA = a if cond { deferBits |= 1\u0026lt;\u0026lt;1 tmpF2 = f2 tmpB = b } body... exit: // åœ¨é€€å‡ºæ—¶æ£€æŸ¥æ ‡è®°ä½ï¼Œä»¥åˆ¤æ–­æŸä¸ªdeferå‡½æ•°æ˜¯å¦éœ€è¦è¢«æ‰§è¡Œ if deferBits \u0026amp; 1\u0026lt;\u0026lt;1 != 0 { deferBits \u0026amp;^= 1\u0026lt;\u0026lt;1 tmpF2(tmpB) } if deferBits \u0026amp; 1\u0026lt;\u0026lt;0 != 0 { deferBits \u0026amp;^= 1\u0026lt;\u0026lt;0 tmpF1(tmpA) } è¿™é‡Œä¸å†å°†deferç®€å•çš„æ”¾å…¥deferé“¾è¡¨äº†äº‹ï¼Œè€Œæ˜¯å°†å…¶æ·»åŠ åˆ°äº†å‡½æ•°çš„åº•éƒ¨ï¼Œå¹¶é€šè¿‡æ ‡å¿—ä½è¿›è¡Œæ£€æŸ¥ã€‚\n1.2 newdefer // æ¯ä¸ªpç»´æŠ¤ä¸€ä¸ªdeferæ±   // Allocate a Defer, usually using per-P pool. // Each defer must be released with freedefer. The defer is not // added to any defer chain yet. func newdefer() *_defer { var d *_defer mp := acquirem() // è·å–å½“å‰gçš„m, m.locks++ \tpp := mp.p.ptr() // mä¸Šçš„p \tif len(pp.deferpool) == 0 \u0026amp;\u0026amp; sched.deferpool != nil { // pçš„deferpoolä¸ºç©ºï¼Œä½†schedçš„deferpoolä¸ä¸ºç©º \tlock(\u0026amp;sched.deferlock) // åŠ é” \tfor len(pp.deferpool) \u0026lt; cap(pp.deferpool)/2 \u0026amp;\u0026amp; sched.deferpool != nil { // pçš„deferpoolé•¿åº¦å°äºå…¶å®¹é‡çš„ä¸€åŠï¼Œä¸”schedçš„deferpoolä¸ä¸ºç©º \td := sched.deferpool // ä»sched.deferpoolå–å‡ºä¸€ä¸ª_deferç»“æ„ä½“ \tsched.deferpool = d.link // å°†å–å‡ºçš„_deferçš„ä¸‹ä¸€ä¸ª_deferé‡æ–°é“¾æ¥åˆ°sched.deferpool \td.link = nil // æ–­é“¾ \tpp.deferpool = append(pp.deferpool, d) // å–å‡ºçš„è¿™ä¸ª_deferåŠ å…¥åˆ°pçš„deferpoolä¸­ \t} unlock(\u0026amp;sched.deferlock) // è§£é” \t} if n := len(pp.deferpool); n \u0026gt; 0 { // ä»pçš„deferpoolä¸­å–å‡ºä¸€ä¸ª_defer \td = pp.deferpool[n-1] pp.deferpool[n-1] = nil pp.deferpool = pp.deferpool[:n-1] } releasem(mp) // m.locks-- \tmp, pp = nil, nil if d == nil { // å¦‚æœä»schedçš„deferpoolå’Œpçš„deferpoolä¸­éƒ½æ²¡æœ‰å–åˆ°ç°æˆçš„_deferï¼Œåªè¦æ–°æ„å»ºä¸€ä¸ª \t// Allocate new defer. \td = new(_defer) } d.heap = true // é»˜è®¤deferåˆ†é…åœ¨å †ä¸Š \treturn d } ä»newdeferå‡½æ•°ä¸­ä¸­å¯ä»¥çœ‹å‡ºï¼Œschedå’Œpä¸Šå‡æœ‰deferpoolï¼Œé‡Œé¢å‡ä¿å­˜äº†è‹¥å¹²ç©ºçš„_deferå¯¹è±¡ä»¥ä¾¿å¤ç”¨ï¼Œåœ¨æƒ³è¦åˆ›å»ºä¸€ä¸ªæ–°çš„_deferæ—¶ï¼Œå¦‚æœpçš„deferpoolä¸ºç©ºï¼Œä¼šå°è¯•ä»schedçš„deferpoolä¸­å»å–ï¼Œç„¶åæ”¾åœ¨pçš„deferpoolä¸­ã€‚å¦‚æœä¸¤ä¸ªåœ°æ–¹éƒ½æ²¡æœ‰ç©º_deferå¯¹è±¡ï¼Œé‚£å°±åªè¦æ–°å»ºä¸€ä¸ªäº†ï¼Œè€Œæ–°å»ºçš„è¿™ä¸ª_deferå¯¹è±¡ï¼Œé»˜è®¤åˆ†é…åœ¨å †ä¸Šã€‚\næ—¢ç„¶åœ¨newdeferæ—¶ä¼šä»sched.deferpoolä¸­å–ï¼Œé‚£ä¹ˆåœ¨é‡Šæ”¾_deferï¼Œå“åº”çš„åº”è¯¥ä¹Ÿä¼šå°†ç”¨è¿‡çš„ç©º_deferæ”¾å…¥schedæˆ–pçš„deferpoolä¸­å»ã€‚\n1.3 freedefer func freedefer(d *_defer) { d.link = nil // æ–­é“¾ \t// After this point we can copy the stack.  if d._panic != nil { freedeferpanic() } if d.fn != nil { freedeferfn() } if !d.heap { // _deferä¸åœ¨å †ä¸Šï¼Œä¸éœ€è¦å•ç‹¬è¿›è¡Œé‡Šæ”¾ \treturn } mp := acquirem() // è·å–å½“å‰gçš„m \tpp := mp.p.ptr() // è·å–mçš„p \tif len(pp.deferpool) == cap(pp.deferpool) { // pçš„deferpoolæ»¡äº† \t// Transfer half of local cache to the central cache. \t// å°†ä¸€åŠçš„_deferä»p.deferpoolç§»åŠ¨åˆ°sched.deferpoolä¸­ \tvar first, last *_defer // è¿™ä¸ªå¾ªç¯å–p.deferpoolä¸­çš„ä¸€åŠ_deferç»„æˆä¸€ä¸ªé“¾è¡¨ï¼Œfirstã€laståˆ†åˆ«ä¸ºå…¶ç¬¬ä¸€ã€æœ€åä¸€ä¸ªå…ƒç´  \tfor len(pp.deferpool) \u0026gt; cap(pp.deferpool)/2 { n := len(pp.deferpool) d := pp.deferpool[n-1] // dæ˜¯p.deferpoolä¸­çš„æœ€åä¸€ä¸ª_defer \tpp.deferpool[n-1] = nil pp.deferpool = pp.deferpool[:n-1] // p.deferpoolé•¿åº¦-1 \tif first == nil { first = d } else { last.link = d } last = d } lock(\u0026amp;sched.deferlock) // åŠ é” \tlast.link = sched.deferpool // å¤´æ’ \tsched.deferpool = first unlock(\u0026amp;sched.deferlock) // é‡Šæ”¾é” \t} *d = _defer{} // æ¸…ç©ºå†…éƒ¨å­—æ®µ  pp.deferpool = append(pp.deferpool, d) // ç›´æ¥æ”¾å…¥p.deferpool  releasem(mp) mp, pp = nil, nil } å½“ä¸€ä¸ª_deferè¦è¢«é‡Šæ”¾æ—¶ï¼Œä¼šå°è¯•å°†å…¶æ”¾å…¥å½“å‰gæ‰€å±pçš„deferpoolä¸­å»ï¼Œå¦‚æœpçš„deferpoolæ»¡äº†ï¼Œåˆ™å°†pçš„deferpoolä¸­çš„ä¸€åŠå…ƒç´ æ”¾åˆ°schedçš„deferpoolä¸­ï¼Œç„¶åå†å°†_deferæ”¾åˆ°p.deferpool\n2. è°ƒç”¨defer ä»_deferçš„ç»“æ„æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ_deferå¯èƒ½ä¼šåˆ†é…åˆ°æ ˆä¸Šï¼Œä¹Ÿå¯èƒ½ä¼šåˆ†é…åœ¨å †ä¸Šã€‚\n2.1 æ ˆä¸Šåˆ†é… å¯¹äºå¤§éƒ¨åˆ†åœºæ™¯æ¥è¯´ï¼Œåœ¨ä¸å¼€å¯open-coded deferçš„æƒ…å†µä¸‹ä¼šä½¿ç”¨æ ˆä¸Šåˆ†é…ã€‚\nå¯¹äºå¦‚ä¸‹ä»£ç ï¼š\npackage main import \u0026#34;fmt\u0026#34; func main() { defer fmt.Println(1) defer fmt.Println(2) defer fmt.Println(3) defer func() { fmt.Println(4) }() } å¯¹å…¶è¿›è¡Œç¼–è¯‘:\ngo tool compile -S -N main.go # -Nå‚æ•°ç¦æ­¢ç¼–è¯‘æ—¶ä¼˜åŒ–ï¼Œå¦‚æœä¸åŠ -Nï¼Œä¼šä½¿ç”¨open-coded defer ... 0x01e2 00482 (main.go:9) LEAQ \u0026#34;\u0026#34;.main.func1Â·f(SB), CX 0x01e9 00489 (main.go:9) MOVQ CX, \u0026#34;\u0026#34;..autotmp_12+112(SP) 0x01ee 00494 (main.go:9) LEAQ \u0026#34;\u0026#34;..autotmp_12+88(SP), AX 0x01f3 00499 (main.go:9) CALL runtime.deferprocStack(SB) ... 0x01e2å¤„ï¼Œå°†\u0026quot;\u0026quot;.main.func1Â·f(SB)å‡½æ•°åŠ è½½åˆ°CXï¼Œæ¥ä¸‹æ¥å°†CXä¸­çš„å†…å®¹æ”¾ç½®åœ¨\u0026quot;\u0026quot;..autotmp_12+112(SP)ã€‚ä¸‹ä¸€æ­¥å°†\u0026quot;\u0026quot;..autotmp_12+88(SP)ä½œä¸ºruntime.deferprocStackçš„å‚æ•°ã€‚\nè¿™é‡Œå¯ä»¥ç®€å•åˆ†æä¸€ä¸‹ï¼Œä»\u0026quot;\u0026quot;..autotmp_12+88(SP)åˆ°\u0026quot;\u0026quot;..autotmp_12+112(SP)ï¼Œè¿™ä¸­é—´æœ‰24ä¸ªå­—èŠ‚çš„å®½åº¦ï¼Œè€Œ_deferçš„å‰å‡ ä¸ªå­—æ®µå¦‚ä¸‹ï¼š\ntype _defer struct { started bool // 1å­—èŠ‚ \theap bool // 1å­—èŠ‚  openDefer bool // 1å­—èŠ‚ \tsp uintptr // 8å­—èŠ‚ \tpc uintptr // 8å­—èŠ‚ \tfn func() // deferå…³é”®å­—ä¼ å…¥çš„å‡½æ•°ï¼Œ å½“ä½¿ç”¨open-coded deferæ—¶å¯ä¸ºç©º \t... } åœ¨fnä¹‹å‰å…±æœ‰1+1+1+8+8=19ä¸ªå­—èŠ‚çš„å®½åº¦ï¼Œä½†å®é™…ä¸Šåœ¨è¿›è¡Œå†…å­˜åˆ†é…æ—¶ï¼Œåœ¨3ä¸ªboolå‹å­—æ®µåï¼Œéœ€è¦æ·»åŠ 5å­—èŠ‚è¿›è¡Œå†…å­˜å¯¹é½ï¼Œå› æ­¤ä»_deferçš„å¼€å§‹åœ°å€åˆ°fnçš„åœ°å€ï¼Œè¿™ä¸­é—´çš„å®½åº¦å°±å˜æˆäº†1+1+1+5+8+8=24ã€‚\nå› æ­¤æˆ‘ä»¬å¯ä»¥çŸ¥é“è¿™å‡ è¡Œæ±‡ç¼–çš„å‰ä¸‰è¡Œï¼Œæ˜¯å°†å‡½æ•°èµ‹å€¼åˆ°_deferçš„fnå­—æ®µä¸Šã€‚\nçŸ¥é“äº†è¿™äº›ï¼Œæˆ‘ä»¬å†æ¥çœ‹runtime.deferprocStack`ï¼š\nfunc deferprocStack(d *_defer) { gp := getg() // è·å–å½“å‰g \tif gp.m.curg != gp { // go code on the system stack can\u0026#39;t defer \tthrow(\u0026#34;defer on system stack\u0026#34;) } // fnå·²è¢«èµ‹å€¼è¿‡ï¼Œå…¶ä»–çš„å­—æ®µåœ¨è¿™é‡Œèµ‹å€¼ \td.started = false d.heap = false d.openDefer = false d.sp = getcallersp() d.pc = getcallerpc() d.framepc = 0 d.varp = 0 *(*uintptr)(unsafe.Pointer(\u0026amp;d._panic)) = 0 *(*uintptr)(unsafe.Pointer(\u0026amp;d.fd)) = 0 *(*uintptr)(unsafe.Pointer(\u0026amp;d.link)) = uintptr(unsafe.Pointer(gp._defer)) *(*uintptr)(unsafe.Pointer(\u0026amp;gp._defer)) = uintptr(unsafe.Pointer(d)) return0() } å°†_deferåˆ†é…åœ¨æ ˆä¸Šï¼Œå¹¶å°†å…¶æ”¾å…¥gçš„deferé“¾è¡¨ä¸­ã€‚\n2.2 å †ä¸Šåˆ†é… å †ä¸Šåˆ†é…æ˜¯é»˜è®¤çš„å…œåº•æ–¹æ¡ˆã€‚\nç¼–è¯‘å¦‚ä¸‹ä»£ç ï¼š\npackage main import \u0026#34;fmt\u0026#34; func main() { for i := 0; i \u0026lt; 10; i++ { defer func(i int) { fmt.Println(i) }(i) } } go tool compile -S -N main.go å¯çœ‹åˆ°å…¶è°ƒç”¨äº†runtime.deferproc:\nfunc deferproc(fn func()) { gp := getg() // è·å–g \tif gp.m.curg != gp { // go code on the system stack can\u0026#39;t defer \tthrow(\u0026#34;defer on system stack\u0026#34;) } d := newdefer() // è·å–ä¸€ä¸ª_defer \tif d._panic != nil { throw(\u0026#34;deferproc: d.panic != nil after newdefer\u0026#34;) } d.link = gp._defer // å°†_deferä»¥å¤´æ’æ³•æ’å…¥åˆ°gçš„_deferé“¾è¡¨ä¸­ \tgp._defer = d d.fn = fn // è®¾ç½®_deferå‡½æ•° \td.pc = getcallerpc() // ä¿å­˜ä¸Šä¸‹æ–‡ç¯å¢ƒ \td.sp = getcallersp() return0() } ç›¸å¯¹äºæ ˆä¸Šåˆ†é…ï¼Œåœ¨å †ä¸Šåˆ†é…è®¾è®¡åˆ°newdeferçš„è°ƒç”¨ï¼Œè€Œé€šè¿‡ä¸Šæ–‡çš„åˆ†ææˆ‘ä»¬å¯çŸ¥ï¼Œåœ¨è°ƒç”¨newdeferæ—¶ï¼Œä¼šæ¶‰åŠåˆ°schedã€pä»¥åŠå¯¹mçš„åŠ é”ï¼Œå› æ­¤æ€§èƒ½ä¸Šä¸å¦‚æ ˆä¸Šåˆ†é…ã€‚ä¸”ï¼Œæ ˆä¸Šåˆ†é…ä¸éœ€è¦å†™å±éšœã€‚\n3. æ‰§è¡Œdefer package main import \u0026#34;fmt\u0026#34; func main() { defer fmt.Println(1) defer fmt.Println(2) defer fmt.Println(3) defer func() { fmt.Println(4) }() } æŸ¥çœ‹ä»¥ä¸Šä»£ç çš„æ±‡ç¼–ä»£ç æ—¶ï¼Œå¯çœ‹åˆ°ï¼š\n0x0200 00512 (main.go:12) CALL runtime.deferreturn(SB) 0x0205 00517 (main.go:12) MOVQ 440(SP), BP 0x020d 00525 (main.go:12) ADDQ $448, SP 0x0214 00532 (main.go:12) RET 0x0215 00533 (main.go:9) CALL runtime.deferreturn(SB) 0x021a 00538 (main.go:9) MOVQ 440(SP), BP 0x0222 00546 (main.go:9) ADDQ $448, SP 0x0229 00553 (main.go:9) RET 0x022a 00554 (main.go:8) CALL runtime.deferreturn(SB) 0x022f 00559 (main.go:8) MOVQ 440(SP), BP 0x0237 00567 (main.go:8) ADDQ $448, SP 0x023e 00574 (main.go:8) RET 0x023f 00575 (main.go:8) NOP 0x0240 00576 (main.go:7) CALL runtime.deferreturn(SB) 0x0245 00581 (main.go:7) MOVQ 440(SP), BP 0x024d 00589 (main.go:7) ADDQ $448, SP 0x0254 00596 (main.go:7) RET 0x0255 00597 (main.go:6) CALL runtime.deferreturn(SB) å¯ä»¥çœ‹åˆ°ä¼šdeferçš„è°ƒç”¨æ˜¯æŒ‰ç…§å…¶å®šä¹‰çš„é¡ºåºåå‘è°ƒç”¨çš„ã€‚\nåœ¨è°ƒç”¨äº†deferçš„å‡½æ•°ä¸­ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨åœ¨å‡½æ•°å°¾éƒ¨æ’å…¥å¯¹runtime.deferreturnçš„è°ƒç”¨ã€‚\nfunc deferreturn() { gp := getg() // è·å–å½“å‰g \tfor { d := gp._defer // deferé“¾è¡¨çš„ç¬¬ä¸€ä¸ªdeferï¼Œä¹Ÿæ˜¯æœ€åä¸€ä¸ªè¢«å®šä¹‰çš„defer \tif d == nil { return } sp := getcallersp() if d.sp != sp { return } if d.openDefer { // å¦‚æœå¼€å¯äº†open-coded defer \tdone := runOpenDeferFrame(gp, d) if !done { throw(\u0026#34;unfinished open-coded defers in deferreturn\u0026#34;) } gp._defer = d.link //// åˆ é™¤é“¾è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´  \tfreedefer(d) // If this frame uses open defers, then this \t// must be the only defer record for the \t// frame, so we can just return. \treturn } fn := d.fn // å–å‡ºdeferå‡½æ•° \td.fn = nil gp._defer = d.link // åˆ é™¤é“¾è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´  \tfreedefer(d) // é‡Šæ”¾_defer \tfn() // è°ƒç”¨deferå‡½æ•° \t} } 4. deferçš„ä¸‰ç§å¤„ç†æœºåˆ¶ ç»è¿‡ä»¥ä¸Šçš„åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥æ€»ç»“ä¸€ä¸‹ï¼Œdeferçš„ä¸‰ç§å¤„ç†æœºåˆ¶ï¼š\n open-coded defer æ ˆä¸Šåˆ†é…çš„defer å †ä¸Šåˆ†é…çš„defer  å…¶æ‰§è¡Œæ•ˆç‡ä¸ºï¼šopen-coded defer \u0026gt; æ ˆä¸Šåˆ†é…çš„defer \u0026gt; å †ä¸Šåˆ†é…çš„defer\n4.1 å¤„ç†æœºåˆ¶çš„é€‰æ‹©   åœ¨deferè¯­å¥å‡ºç°åœ¨äº†å¾ªç¯è¯­å¥é‡Œï¼Œæˆ–è€…æ— æ³•æ‰§è¡Œæ›´é«˜é˜¶çš„ç¼–è¯‘å™¨ä¼˜åŒ–æ—¶ï¼Œäº¦æˆ–è€…åŒä¸€ä¸ªå‡½æ•°ä¸­ä½¿ç”¨äº†è¿‡å¤šçš„deferæ—¶ï¼Œä¼šä½¿ç”¨å †ä¸Šåˆ†é…[2]  æ»¡è¶³ä»¥ä¸‹ä¸‰ç§æƒ…å†µæ—¶[3]ï¼Œä¼šä½¿ç”¨open-coded defer\n æ²¡æœ‰ç¦ç”¨ç¼–è¯‘å™¨ä¼˜åŒ–ï¼Œå³æ²¡æœ‰è®¾ç½® -gcflags \u0026ldquo;-N\u0026rdquo;ï¼› å‡½æ•°å†… defer çš„æ•°é‡ä¸è¶…è¿‡ 8 ä¸ªï¼Œä¸”è¿”å›è¯­å¥ä¸å»¶è¿Ÿè¯­å¥ä¸ªæ•°çš„ä¹˜ç§¯ä¸è¶…è¿‡ 15ï¼› defer ä¸æ˜¯åœ¨å¾ªç¯è¯­å¥ä¸­ã€‚    å…¶ä»–å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œä¼šä½¿ç”¨æ ˆä¸Šåˆ†é…\n  END\nReferences https://github.com/golang/proposal/blob/master/design/34481-opencoded-defers.md\nhttps://cloud.tencent.com/developer/article/1596802\nhttps://draveness.me/golang/docs/part2-foundation/ch05-keyword/golang-defer/#535-%e5%bc%80%e6%94%be%e7%bc%96%e7%a0%81\nhttps://juejin.cn/post/6844904078569373710\nhttps://xargin.com/go-1-13-defer-change/\nhttps://juejin.cn/post/6975686540601245709\nhttps://zhuanlan.zhihu.com/p/401339057\n","permalink":"http://yangchnet.github.io/Dessert/posts/golang/runtime%E7%AF%87%E4%B8%89defer/","summary":"æœ¬ç³»åˆ—ä»£ç åŸºäºgolang1.19\n  runtimeç¯‡ä¸€ï¼šæ¥å£ runtimeç¯‡äºŒï¼šé€šé“ runtimeç¯‡ä¸‰ï¼šdefer runtimeç¯‡å››ï¼španic runtimeç¯‡äº”ï¼šslice  1. deferæ˜¯ä»€ä¹ˆ deferï¼Œæ˜¯ä¸€ç§ç‰¹æ®Šçš„æœºåˆ¶ï¼Œåœ¨è°ƒç”¨æ™®é€šå‡½æ•°æˆ–æ–¹æ³•å‰åŠ ä¸Šå…³é”®å­—deferï¼Œå°±å®Œæˆäº†deferæ‰€éœ€è¦çš„è¯­æ³•ã€‚å½“deferè¯­å¥è¢«æ‰§è¡Œæ—¶ï¼Œè·Ÿåœ¨deferåé¢çš„å‡½æ•°ä¼šè¢«å»¶è¿Ÿæ‰§è¡Œã€‚ç›´åˆ°åŒ…å«è¯¥deferè¯­å¥çš„å‡½æ•°æ‰§è¡Œå®Œæ¯•æ—¶ï¼Œdeferåçš„å‡½æ•°æ‰ä¼šè¢«æ‰§è¡Œï¼Œå¤šä¸ªdeferçš„æ‰§è¡Œé¡ºåºä¸å£°æ˜é¡ºåºç›¸åã€‚\nå¯¹äºdeferçš„ä½¿ç”¨åŠéœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼Œå¯å‚è€ƒdeferç”¨æ³•ã€‚è¿™é‡Œä¸å†è®¨è®ºã€‚\nåœ¨golang runtimeä¸­ï¼Œdeferè¢«æè¿°ä¸ºä¸€ä¸ªç»“æ„ä½“ï¼š\ntype _defer struct { started bool // æ˜¯å¦å¼€å§‹æ‰§è¡Œdeferå‡½æ•° \theap bool // æ˜¯å¦åˆ†é…åœ¨å †ä¸Š  openDefer bool // æ˜¯å¦ç»è¿‡å¼€æ”¾ç¼–ç ï¼ˆopen-codedï¼‰çš„ä¼˜åŒ– \tsp uintptr // è°ƒç”¨deferæ—¶çš„æ ˆæŒ‡é’ˆ stack pointer \tpc uintptr // è°ƒç”¨deferå‡½æ•°æ—¶çš„pcå€¼ \tfn func() // deferå…³é”®å­—ä¼ å…¥çš„å‡½æ•°ï¼Œ å½“ä½¿ç”¨open-coded deferæ—¶å¯ä¸ºç©º \t_panic *_panic // deferå‡½æ•°ä¸­çš„_panicé“¾è¡¨ \tlink *_defer // åœ¨goroutineä¸­çš„ä¸‹ä¸€ä¸ªdeferï¼Œå¯æŒ‡å‘å †æˆ–æ ˆ  // å¦‚æœopenDeferä¸ºtrueï¼Œåˆ™ä¸‹é¢çš„å­—æ®µå°†è®°å½•å…·æœ‰open-code deferçš„æ ˆå¸§å’Œç›¸å…³çš„å‡½æ•°ã€‚  // ä¸Šé¢çš„spå°†ä¸ºå¸§çš„spï¼Œpcå°†ä¸ºdeferè°ƒç”¨çš„åœ°å€ã€‚ \tfd unsafe.","title":"runtimeç¯‡ä¸‰ï¼šdefer"},{"content":" æœ¬ç³»åˆ—ä»£ç åŸºäºgolang1.19\n  runtimeç¯‡ä¸€ï¼šæ¥å£ runtimeç¯‡äºŒï¼šé€šé“ runtimeç¯‡ä¸‰ï¼šdefer runtimeç¯‡å››ï¼španic runtimeç¯‡äº”ï¼šslice  1. panicçš„åº•å±‚ç»“æ„ panicåœ¨runtimeä¸­çš„åº•å±‚è¡¨ç¤ºæ˜¯runtime._panicç»“æ„ä½“ã€‚\ntype _panic struct { argp unsafe.Pointer // æŒ‡å‘deferè°ƒç”¨æ—¶å‚æ•°çš„æŒ‡é’ˆ \targ any // panicå‚æ•° \tlink *_panic // è¿æ¥åˆ°æ›´æ—©çš„_panic \tpc uintptr // ç¨‹åºè®¡æ•°å™¨ \tsp unsafe.Pointer // æ ˆæŒ‡é’ˆ \trecovered bool // å½“å‰panicæ˜¯å¦è¢«recoveræ¢å¤ \taborted bool // å½“å‰panicæ˜¯å¦è¢«ä¸­æ­¢ \tgoexit bool // æ˜¯å¦è°ƒç”¨äº†runtime.Goexit } ç±»ä¼¼äº_deferï¼Œpanicä¹Ÿè¢«ç»„ç»‡æˆé“¾è¡¨ç»“æ„ï¼Œå¤šä¸ªpanicé€šè¿‡linkå­—æ®µè¿æ¥æˆä¸€ä¸ªé“¾è¡¨ã€‚\nåœ¨_panicç»“æ„ä½“ä¸­ï¼Œpcã€spã€goexitä¸‰ä¸ªå­—æ®µæ˜¯ä¸ºäº†ä¿®å¤runtime.Goexitå¸¦æ¥çš„é—®é¢˜å¼•å…¥çš„[1].\n2. è°ƒç”¨panic åœ¨å‡½æ•°ä¸­è°ƒç”¨panicæ—¶ï¼Œåº•å±‚ä¼šè°ƒç”¨runtime.gopanicï¼Œå…¶æºç å¦‚ä¸‹ï¼š\nfunc gopanic(e any) { gp := getg() // è·å–å½“å‰g  // ...  // æ­¤å¤„çœç•¥éƒ¨åˆ†ä»£ç   var p _panic p.arg = e // panicå‚æ•° \tp.link = gp._panic // å¤´æ’ \tgp._panic = (*_panic)(noescape(unsafe.Pointer(\u0026amp;p))) // çœç•¥deferè°ƒç”¨éƒ¨åˆ†  // ran out of deferred calls - old-school panic now \t// Because it is unsafe to call arbitrary user code after freezing \t// the world, we call preprintpanics to invoke all necessary Error \t// and String methods to prepare the panic strings before startpanic. \tpreprintpanics(gp._panic) fatalpanic(gp._panic) // should not return \t*(*int)(nil) = 0 // not reached } å…ˆçœ‹panicä¸»å¹²æµç¨‹ï¼Œé¦–å…ˆè·å–å½“å‰å‘ç”Ÿäº†panicçš„gï¼Œç„¶åæ–°å»ºäº†ä¸€ä¸ª_panicï¼Œå°†å…¶å­—æ®µèµ‹å€¼åï¼Œä»¥å¤´æ’çš„å½¢å¼æ’å…¥åˆ°gçš„_panicé“¾è¡¨ä¸­ï¼Œåœ¨å‡½æ•°çš„æœ€åï¼Œè°ƒç”¨äº†runtime.fatalpanicï¼Œè¿™ä¸ªå‡½æ•°å®ç°äº†æ— æ³•è¢«æ¢å¤çš„ç¨‹åºå´©æºƒï¼š\nfunc fatalpanic(msgs *_panic) { pc := getcallerpc() sp := getcallersp() gp := getg() var docrash bool // Switch to the system stack to avoid any stack growth, which \t// may make things worse if the runtime is in a bad state.  // åˆ‡æ¢åˆ°ç³»ç»Ÿæ ˆä»¥é¿å…ç”¨æˆ·æ ˆå¢é•¿ \tsystemstack(func() { // startpanic_måœ¨åº”è¯¥æ‰“å°panicä¿¡æ¯æ—¶è¿”å›true \tif startpanic_m() \u0026amp;\u0026amp; msgs != nil { // \tatomic.Xadd(\u0026amp;runningPanicDefers, -1) printpanics(msgs) // æ‰“å°panicä¿¡æ¯ \t} docrash = dopanic_m(gp, pc, sp) }) if docrash { crash() } systemstack(func() { exit(2) }) *(*int)(nil) = 0 // not reached } runtime.fatalpanicæœ€åè°ƒç”¨exit(2)ç»ˆæ­¢ç¨‹åºï¼Œè¿”å›å€¼ä¸º2.\n3. åœ¨æœ‰deferè°ƒç”¨æ—¶panic ä¸Šé¢ä»‹ç»çš„æƒ…å†µæ˜¯åœ¨å‡½æ•°è¿è¡Œæ—¶æ²¡æœ‰è®¾ç½®deferè°ƒç”¨ï¼Œç„¶åç›´æ¥panicï¼Œç°åœ¨æ¥çœ‹å…·æœ‰deferè°ƒç”¨çš„å‡½æ•°å‘ç”Ÿpanicæ—¶ä¼šæ€æ ·ã€‚\nå›é¡¾runtimeç¯‡ä¸‰ï¼šdeferæˆ‘ä»¬çŸ¥é“ï¼Œç¨‹åºçš„deferè°ƒç”¨ä»¥_deferé“¾è¡¨çš„å½¢å¼å­˜å‚¨åœ¨gä¸­ã€‚\nå…ˆå¤§è‡´çœ‹ä¸‹æºç :\nfunc gopanic(e any) { gp := getg() // è·å–å½“å‰g  // çœç•¥éƒ¨åˆ†ä»£ç   var p _panic p.arg = e // panicå‚æ•° \tp.link = gp._panic // å¤´æ’ \tgp._panic = (*_panic)(noescape(unsafe.Pointer(\u0026amp;p))) // å°†å½“å‰è¿™ä¸ªpanicèµ‹å€¼ç»™å½“å‰defer  atomic.Xadd(\u0026amp;runningPanicDefers, 1) // By calculating getcallerpc/getcallersp here, we avoid scanning the \t// gopanic frame (stack scanning is slow...) \taddOneOpenDeferFrame(gp, getcallerpc(), unsafe.Pointer(getcallersp())) // è¿™é‡Œæ·»åŠ äº†ä¸€ä¸ªopen-code defer  // æ£€æŸ¥gä¸­æ˜¯å¦è¿˜å­˜åœ¨deferè°ƒç”¨ \tfor { d := gp._defer // å°è¯•è·å–_defer \tif d == nil { // å¦‚æœæ²¡æœ‰è®¾ç½®_deferï¼Œåˆ™ç›´æ¥è·³å‡º \tbreak } // å¦‚æœdeferè¢«æ›´æ—©çš„panicæˆ–Goexitå¯åŠ¨äº†ï¼ˆæˆ–è€…åœ¨ç¨‹åºåˆ°è¾¾è¿™é‡Œä¹‹å‰ï¼Œåˆè§¦å‘äº†ä¸€ä¸ªæ–°çš„panicï¼‰ï¼Œ \t// åˆ™å°†å½“å‰deferç§»å‡ºdeferé“¾è¡¨ï¼Œå…ˆå‰çš„panicå°†ä¸å†æ‰§è¡Œï¼Œä½†ç¡®ä¿å…ˆå‰çš„Goexitç»§ç»­æ‰§è¡Œ  if d.started { // deferå·²ç»è¢«å¯åŠ¨äº† \tif d._panic != nil { // deferå‡½æ•°ä¸­ä¹Ÿå­˜åœ¨panic \td._panic.aborted = true // ç»ˆæ­¢deferçš„panic \t} d._panic = nil if !d.openDefer { // æœªä½¿ç”¨å¼€æ”¾ç¼–ç  \td.fn = nil gp._defer = d.link // ç»§ç»­æ£€æŸ¥ä¸‹ä¸€ä¸ªdefer \tfreedefer(d) continue } } // Mark defer as started, but keep on list, so that traceback \t// can find and update the defer\u0026#39;s argument frame if stack growth \t// or a garbage collection happens before executing d.fn. \td.started = true // å°†deferæ ‡è®°ä¸ºå¯åŠ¨  // Record the panic that is running the defer. \t// If there is a new panic during the deferred call, that panic \t// will find d in the list and will mark d._panic (this panic) aborted. \td._panic = (*_panic)(noescape(unsafe.Pointer(\u0026amp;p))) // å°†å½“å‰panicèµ‹å€¼çµ¦defer  done := true if d.openDefer { done = runOpenDeferFrame(gp, d) if done \u0026amp;\u0026amp; !d._panic.recovered { addOneOpenDeferFrame(gp, 0, nil) } } else { p.argp = unsafe.Pointer(getargp()) d.fn() // è°ƒç”¨deferå‡½æ•° \t} p.argp = nil // Deferred function did not panic. Remove d. \tif gp._defer != d { throw(\u0026#34;bad defer entry in panic\u0026#34;) } d._panic = nil // trigger shrinkage to test stack copy. See stack_test.go:TestStackPanic \t//GC()  pc := d.pc sp := unsafe.Pointer(d.sp) // must be pointer so it gets adjusted during stack copy \tif done { // å¦‚æœå®Œæˆäº†deferå‡½æ•° \td.fn = nil gp._defer = d.link freedefer(d) } if p.recovered { // å¦‚æœpanicè¢«recoverï¼Œåˆ™ç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªpanic \t// çœç•¥recoveréƒ¨åˆ† \t} } preprintpanics(gp._panic) fatalpanic(gp._panic) // should not return \t*(*int)(nil) = 0 // not reached } æœ‰ç‚¹å¤æ‚ï¼Œç»“åˆå…·ä½“ç¨‹åºæ¥çœ‹è¿™æ®µä»£ç ï¼š\n1â”‚ package main 2â”‚ 3â”‚ func main() { 4â”‚ defer func() { 5â”‚ panic(\u0026#34;2\u0026#34;) 6â”‚ }() 7â”‚ panic(\u0026#34;1\u0026#34;) 8â”‚ } å¯¹äºè¿™ä¸ªç¨‹åºï¼Œæˆ‘ä»¬æ¥åˆ†æå®ƒçš„è¿è¡Œè¿‡ç¨‹ï¼Œé¦–å…ˆç¨‹åºåœ¨è¿è¡Œåˆ°ç¬¬4è¡Œæ—¶ï¼Œä¼šå°†è¿™ä¸ªdeferæ”¾å…¥gçš„_deferé“¾è¡¨ä¸­ï¼Œè¿™ä¸ªdeferçš„fnå­—æ®µæŒ‡å‘func(){panic(\u0026quot;2\u0026quot;)}ã€‚ç„¶åç¨‹åºç»§ç»­æ‰§è¡Œï¼Œæ¥åˆ°ç¬¬7è¡Œï¼Œåœ¨è¿™é‡Œè°ƒç”¨äº†runtime.gopanicå‡½æ•°ã€‚\n æ–°å»ºäº†ä¸€ä¸ª_panicç»“æ„ä½“ï¼Œå¹¶å°†å…¶æ’å…¥åˆ°gçš„_panicé“¾è¡¨å¤´éƒ¨ï¼Œè¿™é‡Œç§°ä¸ºpanic1 åœ¨gä¸Šåˆæ–°å¢äº†ä¸€ä¸ªopen-coded deferï¼Œç°åœ¨gä¸Šæœ‰ä¸¤ä¸ªdeferäº†ï¼Œç¬¬ä¸€ä¸ªä¸ºæˆ‘ä»¬è°ƒç”¨deferäº§ç”Ÿçš„ï¼ˆæš‚ç§°ä¸ºmydeferï¼‰ï¼Œç¬¬äºŒä¸ªä¸ºopen-coded deferï¼Œæ˜¯runtimeæ·»åŠ çš„(æš‚ç§°openDefer) å½“gä¸Šè¿˜æœ‰deferæ—¶ï¼Œå–å‡ºç¬¬ä¸€ä¸ªdeferï¼Œè¿™é‡Œä¸ºmydefer  mydeferæ²¡æœ‰åœ¨è¿è¡Œ æ ‡è®°mydeferä¸ºè¿è¡ŒçŠ¶æ€ï¼Œå°†panic1æ”¾å…¥mydeferçš„_panicå­—æ®µ æ£€æŸ¥mydeferä¸æ˜¯open-coded deferï¼Œè°ƒç”¨_defer.fn()     è¿™é‡Œæš‚åœä¸€ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦æ˜ç¡®æ­¤æ—¶gä¸­_deferå’Œ_panicçš„çŠ¶æ€ï¼Œåœ¨è°ƒç”¨_defer.fn()ä¹‹å‰ï¼Œgä¸­æœ‰ä¸¤ä¸ªdeferï¼Œåˆ†åˆ«ä¸ºmydeferã€openDeferï¼Œä¸”mydefer.link = openDeferï¼šæœ‰ä¸€ä¸ªpanicï¼Œä¸ºpanic1ã€‚ä¸”ï¼Œmydefer._panic = panic1.\n ç»§ç»­ï¼Œè¿™é‡Œè°ƒç”¨çš„_defer.fn()ä¸ºfunc(){panic(\u0026quot;2\u0026quot;)}ï¼Œåœ¨deferå‡½æ•°ä¸­å†ä¸€æ¬¡è°ƒç”¨äº†panicï¼Œæ³¨æ„è¿™é‡Œè¿›è¡Œäº†æ ˆå¸§çš„åˆ‡æ¢ï¼Œå½“å‰çš„panicå˜æˆäº†panic2ã€‚è¿™æ¬¡è°ƒç”¨panicçš„æ‰§è¡Œè¿‡ç¨‹ä¸ºï¼š\n æ–°å»ºä¸€ä¸ªæ–°å»ºäº†ä¸€ä¸ª_panicç»“æ„ä½“ï¼Œå¹¶å°†å…¶æ’å…¥åˆ°gçš„_panicé“¾è¡¨å¤´éƒ¨ï¼Œè¿™é‡Œç§°ä¸ºpanic2 è¿™å›ä¸å†å¢åŠ æ–°çš„open-coded defer å½“gä¸Šè¿˜æœ‰deferæ—¶ï¼Œå–å‡ºç¬¬ä¸€ä¸ªdeferï¼Œè¿™é‡Œä¸ºmydefer  mydeferåœ¨è¿è¡Œ  mydefer._panicä¸ä¸ºç©ºï¼Œå°†å…¶æ ‡è®°ä¸ºabortedï¼Œå³æŠŠpanic1æ ‡è®°ä¸ºaborted mydeferä¸æ˜¯open-coded deferï¼Œå°†mydefer.fnè®¾ä¸ºç©ºï¼Œå°†mydeferä»g._deferé“¾è¡¨ä¸­å–å‡º é‡æ–°æ£€æŸ¥g._deferä¸­æ˜¯å¦è¿˜å­˜åœ¨defer       å†æ¬¡æš‚åœï¼Œæ­¤æ—¶gä¸Šåªå‰©ä¸‹ä¸€ä¸ª_deferï¼šopenDefer\n ç»§ç»­ï¼š\n gä¸Šè¿˜æœ‰openDeferå­˜åœ¨ openDeferä¸åœ¨è¿è¡Œï¼Œå°†å…¶æ ‡è®°ä¸ºè¿è¡Œï¼Œå°†panic2èµ‹å€¼åˆ°openDefer._panicä¸Š æ‰§è¡ŒopenDefer å®ŒæˆopenDeferåï¼Œfree it æ£€æŸ¥æ˜¯å¦æœ‰recoverè°ƒç”¨ è°ƒç”¨fatalpanicä½¿ç¨‹åºå´©æºƒ  åˆ†æå®Œæ¯•ã€‚\n4. recover ç¼–è¯‘å™¨åœ¨å°†å…³é”®å­—recoverè½¬æ¢æˆruntime.gorecover:\nfunc gorecover(argp uintptr) any { gp := getg() p := gp._panic if p != nil \u0026amp;\u0026amp; !p.goexit \u0026amp;\u0026amp; !p.recovered \u0026amp;\u0026amp; argp == uintptr(p.argp) { p.recovered = true return p.arg } return nil } è¿™ä¸ªå‡½æ•°å¾ˆç®€å•ï¼Œå…ˆæ˜¯è·å–gï¼Œç„¶åå†è·å–g._panicçš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œç„¶åå°†å…¶recoveredæ ‡å¿—è®¾ä¸ºtrueã€‚\nè®©æˆ‘ä»¬å…ˆç»“åˆå…·ä½“ç¨‹åºæ¥ç®€å•çœ‹ä¸‹recoveræµç¨‹ï¼š\n1 â”‚ package main 2 â”‚ 3 â”‚ func main() { 4 â”‚ defer func() { 5 â”‚ if r := recover(); r != nil { 6 â”‚ println(r) 7 â”‚ } 8 â”‚ }() 9 â”‚ panic(\u0026#34;1\u0026#34;) 10â”‚ } é¦–å…ˆç¨‹åºä¼šæ‰§è¡Œåˆ°ç¬¬9è¡Œï¼Œç„¶åä¸€ä¸ªpanic1å°†ä¼šè¢«æ·»åŠ åˆ°g._panicé“¾è¡¨ä¸Šï¼›ç„¶ååœ¨runtime.gopanicä¸­ä¼šæ·»åŠ ä¸€ä¸ªopenDefer, ç„¶åè°ƒç”¨defer.fnï¼Œä¼šæ‰§è¡Œåˆ°recoverï¼Œæ ¹æ®runtime.gorecoverï¼Œä¼šå°†g._panicçš„ç¬¬ä¸€ä¸ªå…ƒç´ å–å‡ºï¼Œç„¶åå°†å…¶è®¾ç½®ä¸ºå¯recoverã€‚\nç°åœ¨ï¼Œgä¸­æœ‰äº†ä¸¤ä¸ª_deferï¼ˆmydefer.link = openDeferï¼‰ï¼Œä¸€ä¸ª_panicï¼ˆpanic1ï¼‰ï¼Œä¸”mydeferè¢«è®¾ç½®recovered = trueã€‚æˆ‘ä»¬å¯ä»¥å¼€å§‹åˆ†ærecoveræ˜¯æ€ä¹ˆæ‰§è¡Œçš„äº†ï¼š\nè€Œå¯¹recoverçš„å¤„ç†ï¼Œè¿˜è¦æ¥çœ‹runtime.gopanic:\n1 â”‚func gopanic(e any) { 2 â”‚ ... 3 â”‚ for { 4 â”‚ d := gp._defer // panicé€€å‡ºç¨‹åºå‰ï¼Œè¦æ‰§è¡Œdefer 5 â”‚ if d == nil { 6 â”‚ break 7 â”‚ } 8 â”‚ 9 â”‚ ... 10â”‚ 11â”‚ if p.recovered { // å¦‚æœpanicè¢«recoverï¼Œåˆ™ç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªpanic 12â”‚ gp._panic = p.link 13â”‚ if gp._panic != nil \u0026amp;\u0026amp; gp._panic.goexit \u0026amp;\u0026amp; gp._panic.aborted { 14â”‚ // A normal recover would bypass/abort the Goexit. Instead, 15â”‚ // we return to the processing loop of the Goexit. 16â”‚ gp.sigcode0 = uintptr(gp._panic.sp) 17â”‚ gp.sigcode1 = uintptr(gp._panic.pc) 18â”‚ mcall(recovery) 19â”‚ throw(\u0026#34;bypassed recovery failed\u0026#34;) // mcall should not return 20â”‚ } 21â”‚ atomic.Xadd(\u0026amp;runningPanicDefers, -1) 22â”‚ 23â”‚ // After a recover, remove any remaining non-started, 24â”‚ // open-coded defer entries, since the corresponding defers 25â”‚ // will be executed normally (inline). Any such entry will 26â”‚ // become stale once we run the corresponding defers inline 27â”‚ // and exit the associated stack frame. We only remove up to 28â”‚ // the first started (in-progress) open defer entry, not 29â”‚ // including the current frame, since any higher entries will 30â”‚ // be from a higher panic in progress, and will still be 31â”‚ // needed. 32â”‚ d := gp._defer 33â”‚ var prev *_defer 34â”‚ if !done { 35â”‚ // Skip our current frame, if not done. It is 36â”‚ // needed to complete any remaining defers in 37â”‚ // deferreturn() 38â”‚ prev = d 39â”‚ d = d.link 40â”‚ } 41â”‚ for d != nil { // è¿™é‡Œå»é™¤äº†å·²ç»å¼€å§‹çš„open defer 42â”‚ // æš‚æ—¶çœç•¥ 43â”‚ } 44â”‚ 45â”‚ gp._panic = p.link 46â”‚ // Aborted panics are marked but remain on the g.panic list. 47â”‚ // Remove them from the list. 48â”‚ for gp._panic != nil \u0026amp;\u0026amp; gp._panic.aborted { 49â”‚ gp._panic = gp._panic.link 50â”‚ } 51â”‚ if gp._panic == nil { // must be done with signal 52â”‚ gp.sig = 0 53â”‚ } 54â”‚ // Pass information about recovering frame to recovery. 55â”‚ gp.sigcode0 = uintptr(sp) 56â”‚ gp.sigcode1 = pc 57â”‚ mcall(recovery) 58â”‚ throw(\u0026#34;recovery failed\u0026#34;) // mcall should not return 59â”‚ } 60â”‚ } 61â”‚ 62â”‚ // ... 63â”‚} å½“ç¨‹åºå¼€å§‹è¿›è¡Œrecoveræ—¶ï¼Œé¦–å…ˆåœ¨13è¡Œä¼šåšä¸€ä¸ªifåˆ¤æ–­ã€‚æ­£å¸¸recoveræ˜¯ä¼šç»•è¿‡Goexitçš„ï¼Œæ‰€ä»¥ä¸ºäº†è§£å†³è¿™ä¸ªï¼Œæ·»åŠ äº†è¿™ä¸ªåˆ¤æ–­ï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯Goexitä¹Ÿä¼šè¢«recoverä½ï¼Œè¿™é‡Œæ˜¯é€šè¿‡ä»runtime._panicä¸­å–å‡ºäº†ç¨‹åºè®¡æ•°å™¨pcå’Œæ ˆæŒ‡é’ˆspå¹¶ä¸”è°ƒç”¨runtime.recoveryå‡½æ•°è§¦å‘goroutineçš„è°ƒåº¦ï¼Œè°ƒåº¦ä¹‹å‰ä¼šå‡†å¤‡å¥½ spã€pc ä»¥åŠå‡½æ•°çš„è¿”å›å€¼ã€‚\nå¯¹äºæˆ‘ä»¬çš„ç¨‹åºæ¥è¯´ï¼Œå¹¶æœªè°ƒç”¨Goexitï¼Œå› æ­¤è¿™é‡Œä¼šè·³è¿‡ï¼Œç„¶ååœ¨32ï½43è¡Œï¼Œç”±äºdoneä¸ºtrueï¼Œè¿™é‡Œdå°†ä¼šè¢«èµ‹å€¼ä¸ºmydeferï¼Œç„¶åæ¥åˆ°45è¡Œï¼Œå°†defer1ä»g._panicé“¾è¡¨ä¸­å–å‡ºï¼Œç„¶åå°†ä½™ä¸‹çš„è¢«æ ‡è®°ä¸ºabortedçš„_panicåˆ é™¤ï¼Œè¿™é‡Œæ²¡æœ‰ã€‚\n55ã€56ä¸¤è¡Œè®¾ç½®gçš„sigcode0ã€sigcode1æŒ‡é’ˆï¼Œç”¨äºè·³è½¬ï¼Œç„¶å57è¡Œmcall(recovery)ã€‚\nmcallæ˜¯ä¸€ä¸ªæ±‡ç¼–å®ç°çš„å‡½æ•°ï¼Œå…¶å‡½æ•°åŸå‹ä¸ºï¼šfunc mcall(fn func(*g))ï¼Œå…¶ä¸»è¦åŠŸèƒ½æ˜¯åˆ‡æ¢åˆ°g0çš„æ ˆï¼Œç„¶åè°ƒç”¨fn(g)ï¼Œfn(g)å°†ä¸ä¼šè¿”å›ï¼Œå¹¶ä¸”è§¦å‘gçš„é‡æ–°è°ƒåº¦ã€‚\nè¿™é‡Œçš„fnå°±æ˜¯recoveryï¼Œæ¥çœ‹ï¼š\nfunc recovery(gp *g) { // Info about defer passed in G struct. \tsp := gp.sigcode0 pc := gp.sigcode1 // d\u0026#39;s arguments need to be in the stack. \tif sp != 0 \u0026amp;\u0026amp; (sp \u0026lt; gp.stack.lo || gp.stack.hi \u0026lt; sp) { print(\u0026#34;recover: \u0026#34;, hex(sp), \u0026#34; not in [\u0026#34;, hex(gp.stack.lo), \u0026#34;, \u0026#34;, hex(gp.stack.hi), \u0026#34;]\\n\u0026#34;) throw(\u0026#34;bad recovery\u0026#34;) } // Make the deferproc for this d return again, \t// this time returning 1. The calling function will \t// jump to the standard return epilogue. \tgp.sched.sp = sp gp.sched.pc = pc gp.sched.lr = 0 gp.sched.ret = 1 gogo(\u0026amp;gp.sched) } æ²¡ä»€ä¹ˆç‰¹åˆ«çš„é­”æ³•ï¼Œå°±æ˜¯é‡æ–°è®¾ç½®äº†gçš„ä¸€äº›æŒ‡é’ˆï¼Œç„¶åå¯¹å…¶é‡æ–°è¿›è¡Œè°ƒåº¦ã€‚\nè¿™æ ·å°±å®Œæˆäº†panicçš„æ¢å¤ã€‚\n5. åœºæ™¯åˆ†æ Q1 ä¸ºä»€ä¹ˆrecoverå¿…é¡»æ”¾åœ¨deferé‡Œé¢ A1 ä¸æ”¾åˆ°deferé‡Œé¢ï¼Œæ²¡æœºä¼šè¿è¡Œå•Šã€‚ã€‚ã€‚\nQ2 ä¸ºä»€ä¹ˆå¦‚ä¸‹ä½¿ç”¨æ–¹æ³•ä¸ä¼šæ¢å¤ï¼š\nfunc main() { defer recover() panic(\u0026#34;1\u0026#34;) } A2 åœ¨è°ƒç”¨recover()å‡½æ•°æ—¶ï¼Œä¼šæœ‰å¦‚ä¸‹ifæ¡ä»¶ï¼š\nif p != nil \u0026amp;\u0026amp; !p.goexit \u0026amp;\u0026amp; !p.recovered \u0026amp;\u0026amp; argp == uintptr(p.argp) { p.recovered = true return p.arg } è¿™é‡Œp != nil \u0026amp;\u0026amp; !p.goexit \u0026amp;\u0026amp; !p.recoveredä¼šæ»¡è¶³ï¼Œè€Œargpå’Œuintptr(p.argp)å¹¶ä¸ç›¸ç­‰ï¼Œargpæ˜¯runtime.gopinicæŠ¥å‘Šçš„å‚æ•°æŒ‡é’ˆï¼Œp.argpæ˜¯æœ€é¡¶å±‚ defer å‡½æ•°è°ƒç”¨çš„å‚æ•°æŒ‡é’ˆï¼ŒäºŒè€…å¹¶ä¸ç›¸ç­‰ã€‚\nQ3 ä¸‹é¢è¿™æ®µä»£ç å°†è¾“å‡ºä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ\nfunc main() { defer func() { // topdefer \tfmt.Println(recover()) }() defer panic(3) // defer3 \tdefer panic(2) // defer2 \tdefer panic(1) // defer1 \tpanic(0) } A3 å°†è¾“å‡º3.\nåˆ†æï¼šåœ¨runtime.gopanicä¸­ï¼Œæœ‰å¦‚ä¸‹ä»£ç ï¼š\nif d.started { if d._panic != nil { d._panic.aborted = true } d._panic = nil if !d.openDefer { d.fn = nil gp._defer = d.link freedefer(d) continue } } å½“æˆ‘ä»¬æ‰§è¡Œåˆ°panic(0)åï¼Œå°†è¿”å›æ‰§è¡Œdefer1ï¼Œè¿™æ—¶defer1è¢«è®¾ç½®ä¸ºstartedï¼Œpanic(0)è¢«è®¾ç½®ä¸ºabortedï¼Œç„¶ådefer1è¢«é‡Šæ”¾ï¼› ç´§æ¥ç€æ‰§è¡Œdefer2ï¼Œdefer2è¢«è®¾ç½®ä¸ºstartedï¼Œpanic(1)è¢«è®¾ç½®ä¸ºabortedï¼Œç„¶ådefer2è¢«é‡Šæ”¾ï¼› ç´§æ¥ç€æ‰§è¡Œdefer3ï¼Œdefer3è¢«è®¾ç½®ä¸ºstartedï¼Œpanic(2)è¢«è®¾ç½®ä¸ºabortedï¼Œç„¶ådefer3è¢«é‡Šæ”¾ï¼› æœ€åæ‰§è¡Œåˆ°topdeferï¼Œåˆå› å¦‚ä¸‹ä»£ç ï¼š\nfor gp._panic != nil \u0026amp;\u0026amp; gp._panic.aborted { gp._panic = gp._panic.link } è¢«æ ‡è®°ä¸ºabortedçš„panicå°†è¢«å¿½ç•¥ï¼Œå› æ­¤åªå‰©ä¸‹äº†panic(3)ã€‚\nè¿™æ ·ï¼Œæœ€åè¾“å‡ºçš„å€¼å°±æ˜¯3ã€‚\nQ4 ä¸ºä»€ä¹ˆrecoverä¸èƒ½æ•è·ä¸åŒgoroutineçš„panic A4 æŸ¥çœ‹runtime.gorecoveræºç ï¼š\nfunc gorecover(argp uintptr) any { gp := getg() p := gp._panic if p != nil \u0026amp;\u0026amp; !p.goexit \u0026amp;\u0026amp; !p.recovered \u0026amp;\u0026amp; argp == uintptr(p.argp) { p.recovered = true return p.arg } return nil } è¿™ä¸ªå‡½æ•°è·å–äº†å½“å‰çš„gï¼Œå¹¶ä¸ºå…¶ç¬¬ä¸€ä¸ª_panicè®¾ç½®recoverï¼Œè·Ÿå…¶ä»–gæ²¡æœ‰å…³ç³»\nQ5 ä¸ºä»€ä¹ˆå­goroutineçš„panicä¸è¢«recoverä¼šé€ æˆæ•´ä¸ªç¨‹åºçš„å´©æºƒ A5 æŸ¥çœ‹runtime.fatalpanic:\nfunc fatalpanic(msgs *_panic) { // ...  systemstack(func() { exit(2) }) *(*int)(nil) = 0 // not reached } å…¶åœ¨æ‰§è¡Œexit(2)æ—¶ï¼Œæ˜¯åœ¨systemstackä¸Šæ‰§è¡Œçš„ï¼Œå› æ­¤æ•´ä¸ªç¨‹åºéƒ½ä¼šé€€å‡ºã€‚\nEND\nReferences https://gfw.go101.org/article/panic-and-recover-more.html\nhttps://golang.design/under-the-hood/zh-cn/part1basic/ch03lang/panic/\nhttps://www.purewhite.io/2019/11/28/runtime-hacking-translate/\nhttps://zhuanlan.zhihu.com/p/346514343\nhttps://draveness.me/golang/docs/part2-foundation/ch05-keyword/golang-panic-recover/\nhttps://xiaomi-info.github.io/2020/01/20/go-trample-panic-recover/\n","permalink":"http://yangchnet.github.io/Dessert/posts/golang/runtime%E7%AF%87%E5%9B%9Bpanic/","summary":"æœ¬ç³»åˆ—ä»£ç åŸºäºgolang1.19\n  runtimeç¯‡ä¸€ï¼šæ¥å£ runtimeç¯‡äºŒï¼šé€šé“ runtimeç¯‡ä¸‰ï¼šdefer runtimeç¯‡å››ï¼španic runtimeç¯‡äº”ï¼šslice  1. panicçš„åº•å±‚ç»“æ„ panicåœ¨runtimeä¸­çš„åº•å±‚è¡¨ç¤ºæ˜¯runtime._panicç»“æ„ä½“ã€‚\ntype _panic struct { argp unsafe.Pointer // æŒ‡å‘deferè°ƒç”¨æ—¶å‚æ•°çš„æŒ‡é’ˆ \targ any // panicå‚æ•° \tlink *_panic // è¿æ¥åˆ°æ›´æ—©çš„_panic \tpc uintptr // ç¨‹åºè®¡æ•°å™¨ \tsp unsafe.Pointer // æ ˆæŒ‡é’ˆ \trecovered bool // å½“å‰panicæ˜¯å¦è¢«recoveræ¢å¤ \taborted bool // å½“å‰panicæ˜¯å¦è¢«ä¸­æ­¢ \tgoexit bool // æ˜¯å¦è°ƒç”¨äº†runtime.Goexit } ç±»ä¼¼äº_deferï¼Œpanicä¹Ÿè¢«ç»„ç»‡æˆé“¾è¡¨ç»“æ„ï¼Œå¤šä¸ªpanicé€šè¿‡linkå­—æ®µè¿æ¥æˆä¸€ä¸ªé“¾è¡¨ã€‚\nåœ¨_panicç»“æ„ä½“ä¸­ï¼Œpcã€spã€goexitä¸‰ä¸ªå­—æ®µæ˜¯ä¸ºäº†ä¿®å¤runtime.Goexitå¸¦æ¥çš„é—®é¢˜å¼•å…¥çš„[1].\n2. è°ƒç”¨panic åœ¨å‡½æ•°ä¸­è°ƒç”¨panicæ—¶ï¼Œåº•å±‚ä¼šè°ƒç”¨runtime.gopanicï¼Œå…¶æºç å¦‚ä¸‹ï¼š\nfunc gopanic(e any) { gp := getg() // è·å–å½“å‰g  // .","title":"runtimeç¯‡å››ï¼španic"},{"content":" åœ¨ä½¿ç”¨topå‘½ä»¤æŸ¥çœ‹ç³»ç»ŸçŠ¶æ€æ—¶ï¼Œä¼šå‡ºç°ä¸€å †å‚æ•°ï¼Œè¿™äº›å‚æ•°åˆ†åˆ«ä»£è¡¨ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ\n ç¬¬ä¸€è¡Œ é¦–å…ˆæ‰“å°äº†å½“å‰æ—¶é—´21:11:55ï¼Œç„¶åæ˜¯ç³»ç»Ÿå·²ç»å¯åŠ¨äº†å¤šä¹…up 4 days, 8:45ï¼Œæˆ‘å·²ç»4å¤©8å°æ—¶45åˆ†é’Ÿæ²¡å…³æœºäº†ã€‚ã€‚\nç„¶åå½“å‰æœ‰3ä¸ªç”¨æˆ·ç™»å½•3 usersï¼Œload averageæ˜¯1.47, 1.33, 1.14\nload average load averageåé¢æœ‰ä¸‰ä¸ªå€¼ï¼Œåˆ†åˆ«ä»£è¡¨è¿‡å» 1 åˆ†é’Ÿï¼Œ5 åˆ†é’Ÿï¼Œ15 åˆ†é’Ÿåœ¨è¿™ä¸ªèŠ‚ç‚¹ä¸Šçš„ load average.\nLoad Average æ˜¯ä¸€ç§ CPU èµ„æºéœ€æ±‚çš„åº¦é‡ã€‚\nä¸¾ä¾‹æ¥è¯´ï¼Œå¯¹äºä¸€ä¸ªå•ä¸ª CPU çš„ç³»ç»Ÿï¼Œå¦‚æœåœ¨ 1 åˆ†é’Ÿçš„æ—¶é—´é‡Œï¼Œå¤„ç†å™¨ä¸Šå§‹ç»ˆæœ‰ä¸€ä¸ªè¿›ç¨‹åœ¨è¿è¡Œï¼ŒåŒæ—¶æ“ä½œç³»ç»Ÿçš„è¿›ç¨‹å¯è¿è¡Œé˜Ÿåˆ—ä¸­å§‹ç»ˆéƒ½æœ‰ 9 ä¸ªè¿›ç¨‹åœ¨ç­‰å¾…è·å– CPU èµ„æºã€‚é‚£ä¹ˆå¯¹äºè¿™ 1 åˆ†é’Ÿçš„æ—¶é—´æ¥è¯´ï¼Œç³»ç»Ÿçš„\u0026quot;load average\u0026quot;å°±æ˜¯ 1+9=10ï¼Œè¿™ä¸ªå®šä¹‰å¯¹ç»å¤§éƒ¨åˆ†çš„ Unix ç³»ç»Ÿéƒ½é€‚ç”¨ã€‚\nå¯¹äº Linux æ¥è¯´ï¼Œå¦‚æœåªè€ƒè™‘ CPU çš„èµ„æºï¼ŒLoad Averag ç­‰äºå•ä½æ—¶é—´å†…æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹åŠ ä¸Šå¯è¿è¡Œé˜Ÿåˆ—çš„è¿›ç¨‹ï¼Œè¿™ä¸ªå®šä¹‰ä¹Ÿæ˜¯æˆç«‹çš„ã€‚\nå¯¹äºload averageçš„ç†è§£æœ‰ä»¥ä¸‹ä¸‰ç‚¹ï¼š\n  ä¸è®ºè®¡ç®—æœº CPU æ˜¯ç©ºé—²è¿˜æ˜¯æ»¡è´Ÿè½½ï¼ŒLoad Average éƒ½æ˜¯ Linux è¿›ç¨‹è°ƒåº¦å™¨ä¸­å¯è¿è¡Œé˜Ÿåˆ—ï¼ˆRunning Queueï¼‰é‡Œçš„ä¸€æ®µæ—¶é—´çš„å¹³å‡è¿›ç¨‹æ•°ç›®ã€‚\n  è®¡ç®—æœºä¸Šçš„ CPU è¿˜æœ‰ç©ºé—²çš„æƒ…å†µä¸‹ï¼ŒCPU Usage å¯ä»¥ç›´æ¥åæ˜ åˆ°\u0026quot;load average\u0026quot;ä¸Šï¼Œä»€ä¹ˆæ˜¯ CPU è¿˜æœ‰ç©ºé—²å‘¢ï¼Ÿå…·ä½“æ¥è¯´å°±æ˜¯å¯è¿è¡Œé˜Ÿåˆ—ä¸­çš„è¿›ç¨‹æ•°ç›®å°äº CPU ä¸ªæ•°ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå•ä½æ—¶é—´è¿›ç¨‹ CPU Usage ç›¸åŠ çš„å¹³å‡å€¼åº”è¯¥å°±æ˜¯\u0026quot;load average\u0026quot;çš„å€¼ã€‚\n  è®¡ç®—æœºä¸Šçš„ CPU æ»¡è´Ÿè½½çš„æƒ…å†µä¸‹ï¼Œè®¡ç®—æœºä¸Šçš„ CPU å·²ç»æ˜¯æ»¡è´Ÿè½½äº†ï¼ŒåŒæ—¶è¿˜æœ‰æ›´å¤šçš„è¿›ç¨‹åœ¨æ’é˜Ÿéœ€è¦ CPU èµ„æºã€‚è¿™æ—¶\u0026quot;load average\u0026quot;å°±ä¸èƒ½å’Œ CPU Usage ç­‰åŒäº†ã€‚\n  æ¯”å¦‚å¯¹äºå•ä¸ª CPU çš„ç³»ç»Ÿï¼ŒCPU Usage æœ€å¤§åªæ˜¯æœ‰ 100%ï¼Œä¹Ÿå°± 1 ä¸ª CPUï¼›è€Œ\u0026quot;load average\u0026quot;çš„å€¼å¯ä»¥è¿œè¿œå¤§äº 1ï¼Œå› ä¸º\u0026quot;load average\u0026quot;çœ‹çš„æ˜¯æ“ä½œç³»ç»Ÿä¸­å¯è¿è¡Œé˜Ÿåˆ—ä¸­è¿›ç¨‹çš„ä¸ªæ•°ã€‚\nè¦æ³¨æ„çš„æ˜¯ï¼Œå¹³å‡è´Ÿè½½ç»Ÿè®¡äº†è¿™ä¸¤ç§æƒ…å†µçš„è¿›ç¨‹ï¼š\n  ç¬¬ä¸€ç§æ˜¯ Linux è¿›ç¨‹è°ƒåº¦å™¨ä¸­å¯è¿è¡Œé˜Ÿåˆ—ï¼ˆRunning Queueï¼‰ä¸€æ®µæ—¶é—´ï¼ˆ1 åˆ†é’Ÿï¼Œ5 åˆ†é’Ÿï¼Œ15 åˆ†é’Ÿï¼‰çš„è¿›ç¨‹å¹³å‡æ•°ã€‚\n  ç¬¬äºŒç§æ˜¯ Linux è¿›ç¨‹è°ƒåº¦å™¨ä¸­ä¼‘çœ é˜Ÿåˆ—ï¼ˆSleeping Queueï¼‰é‡Œçš„ä¸€æ®µæ—¶é—´çš„ TASK_UNINTERRUPTIBLE çŠ¶æ€ä¸‹çš„è¿›ç¨‹å¹³å‡æ•°ã€‚æ‰€ä»¥ï¼Œæœ€åçš„å…¬å¼å°±æ˜¯ï¼šLoad Average= å¯è¿è¡Œé˜Ÿåˆ—è¿›ç¨‹å¹³å‡æ•° + ä¼‘çœ é˜Ÿåˆ—ä¸­ä¸å¯æ‰“æ–­çš„è¿›ç¨‹å¹³å‡æ•°\n  å› æ­¤ï¼ŒLoad Average= å¯è¿è¡Œé˜Ÿåˆ—è¿›ç¨‹å¹³å‡æ•° + ä¼‘çœ é˜Ÿåˆ—ä¸­ä¸å¯æ‰“æ–­çš„è¿›ç¨‹å¹³å‡æ•°\nç¬¬äºŒè¡Œ ç¬¬äºŒè¡Œä¸»è¦è®°å½•äº†å½“å‰ç³»ç»Ÿä¸­çš„è¿›ç¨‹æ•°é‡å’Œå…¶çŠ¶æ€ä¿¡æ¯ã€‚\nä¾‹å¦‚å½“å‰æˆ‘çš„ç³»ç»Ÿä¸­æœ‰373ä¸ªè¿›ç¨‹totol 373ï¼Œä½†åªæœ‰ä¸€ä¸ªè¿›ç¨‹æ­£åœ¨è¿è¡Œ1 runningï¼Œ365ä¸ªåœ¨sleep365 sleepï¼Œ0ä¸ªstoped0 stopedï¼Œ7ä¸ªä¸ºåƒµå°¸è¿›ç¨‹7 zombie\nzombie çŠ¶æ€ä¸‹ å­è¿›ç¨‹ç»“æŸæ—¶çˆ¶è¿›ç¨‹æ²¡æœ‰è°ƒç”¨wait()/waitpid()ç­‰å¾…å­è¿›ç¨‹ç»“æŸï¼Œé‚£ä¹ˆå°±ä¼šäº§ç”Ÿåƒµå°¸è¿›ç¨‹ã€‚\nåŸå› æ˜¯å­è¿›ç¨‹ç»“æŸæ—¶å¹¶æ²¡æœ‰çœŸæ­£é€€å‡ºï¼Œè€Œæ˜¯ç•™ä¸‹ä¸€ä¸ªåƒµå°¸è¿›ç¨‹çš„æ•°æ®ç»“æ„åœ¨ç³»ç»Ÿè¿›ç¨‹è¡¨ä¸­ï¼Œç­‰å¾…çˆ¶è¿›ç¨‹æ¸…ç†ï¼Œå¦‚æœçˆ¶è¿›ç¨‹å·²ç»é€€å‡ºåˆ™ä¼šç”±initè¿›ç¨‹æ¥æ›¿çˆ¶è¿›ç¨‹è¿›è¡Œå¤„ç†ï¼ˆæ”¶å°¸ï¼‰ã€‚ä¹‹æ‰€ä»¥è¦ç•™ä¸‹ä¸€ä¸ªåƒµå°¸è¿›ç¨‹zombieæ˜¯å› ä¸ºçˆ¶è¿›ç¨‹å¯èƒ½ä¼šéœ€è¦å­è¿›ç¨‹çš„çš„æŸäº›ç»“æœã€‚\nç”±æ­¤å¯è§ï¼Œå¦‚æœçˆ¶è¿›ç¨‹ä¸ä½œä¸ºå¹¶ä¸”åˆä¸é€€å‡ºï¼Œå°±ä¼šæœ‰å¤§é‡çš„åƒµå°¸è¿›ç¨‹ï¼Œæ¯ä¸ªåƒµå°¸è¿›ç¨‹ä¼šå ç”¨è¿›ç¨‹è¡¨çš„ä¸€ä¸ªä½ç½®ï¼ˆslotï¼‰ï¼Œå¦‚æœåƒµå°¸è¿›ç¨‹å¤ªå¤šä¼šå¯¼è‡´ç³»ç»Ÿæ— æ³•åˆ›å»ºæ–°çš„è¿›ç¨‹ï¼Œå› ä¸ºè¿›ç¨‹è¡¨çš„å®¹é‡æ˜¯æœ‰é™çš„ã€‚æ‰€ä»¥å½“zombieè¿™ä¸ªæŒ‡æ ‡å¤ªå¤§æ—¶éœ€è¦å¼•èµ·æˆ‘ä»¬çš„æ³¨æ„ã€‚\næ€æ­»åƒµå°¸è¿›ç¨‹çš„æ–¹æ³•ä¸æ˜¯ç›´æ¥å¯¹å…¶è¿›è¡Œkillï¼Œè€Œæ˜¯å»æ‰¾ä»–çš„çˆ¶è¿›ç¨‹ï¼Œå¯¹å…¶é™„è¿›ç¨‹è¿›è¡Œkill -9ï¼Œæ¯•ç«Ÿï¼Œåƒµå°¸æ˜¯æ€ä¸æ­»çš„å˜›ã€‚ã€‚\nç¬¬ä¸‰è¡Œ ç¬¬ä¸‰è¡Œæ¯”è¾ƒå¤æ‚ï¼Œå€¼æ¯”è¾ƒå¤šï¼Œå…ˆæ¥æ€»ä½“çœ‹çœ‹ï¼š\n us: user è¡¨ç¤ºç”¨æˆ·æ€çš„CPUæ—¶é—´æ¯”ä¾‹ sy: system è¡¨ç¤ºå†…æ ¸æ€çš„CPUæ—¶é—´æ¯”ä¾‹ wa: iowait è¡¨ç¤ºå¤„äºIOç­‰å¾…çš„CPUæ—¶é—´æ¯”ä¾‹ ni: nice è¡¨ç¤ºè¿è¡Œä½ä¼˜å…ˆçº§è¿›ç¨‹çš„CPUæ—¶é—´æ¯”ä¾‹ id: idle è¡¨ç¤ºç©ºé—²CPUæ—¶é—´æ¯”ä¾‹ hi: hard interrupt è¡¨ç¤ºå¤„ç†ç¡¬ä¸­æ–­çš„CPUæ—¶é—´æ¯”ä¾‹ si: soft interrupt è¡¨ç¤ºå¤„ç†è½¯ä¸­æ–­çš„CPUæ—¶é—´æ¯”ä¾‹ st: steal è¡¨ç¤ºå½“å‰ç³»ç»Ÿè¿è¡Œåœ¨è™šæ‹Ÿæœºä¸­çš„æ—¶å€™ï¼Œè¢«å…¶ä»–è™šæ‹Ÿæœºå ç”¨çš„CPUæ—¶é—´æ¯”ä¾‹ã€‚  è§£é‡Šä¸€ä¸‹:\nå¯¹äºä¸‹å›¾ï¼Œæ¨ªå‘ä¸ºæ—¶é—´è½´ï¼Œä¸ŠåŠéƒ¨åˆ†ä»£è¡¨ç³»ç»Ÿç”¨æˆ·æ€ï¼Œä¸‹åŠéƒ¨åˆ†ä»£è¡¨ç³»ç»Ÿå†…æ ¸æ€ï¼Œå‡è®¾ç³»ç»Ÿåªæœ‰ä¸€ä¸ªCPU\nå‡è®¾ä¸€ä¸ªç”¨æˆ·ç¨‹åºå¼€å§‹è¿è¡Œäº†ï¼Œé‚£ä¹ˆå°±å¯¹åº”ç€ç¬¬ä¸€ä¸ª\u0026quot;us\u0026quot;æ¡†ï¼Œ\u0026ldquo;us\u0026quot;æ˜¯\u0026quot;user\u0026quot;çš„ç¼©å†™ï¼Œä»£è¡¨ Linux çš„ç”¨æˆ·æ€ CPU Usageã€‚æ™®é€šç”¨æˆ·ç¨‹åºä»£ç ä¸­ï¼Œåªè¦ä¸æ˜¯è°ƒç”¨ç³»ç»Ÿè°ƒç”¨ï¼ˆSystem Callï¼‰ï¼Œè¿™äº›ä»£ç çš„æŒ‡ä»¤æ¶ˆè€—çš„ CPU å°±éƒ½å±äº\u0026quot;us\u0026rdquo;ã€‚\nå½“è¿™ä¸ªç”¨æˆ·ç¨‹åºä»£ç ä¸­è°ƒç”¨äº†ç³»ç»Ÿè°ƒç”¨ï¼Œæ¯”å¦‚è¯´ read() å»è¯»å–ä¸€ä¸ªæ–‡ä»¶ï¼Œè¿™æ—¶å€™è¿™ä¸ªç”¨æˆ·è¿›ç¨‹å°±ä¼šä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€ã€‚\nå†…æ ¸æ€ read() ç³»ç»Ÿè°ƒç”¨åœ¨è¯»åˆ°çœŸæ­£ disk ä¸Šçš„æ–‡ä»¶å‰ï¼Œå°±ä¼šè¿›è¡Œä¸€äº›æ–‡ä»¶ç³»ç»Ÿå±‚çš„æ“ä½œã€‚é‚£ä¹ˆè¿™äº›ä»£ç æŒ‡ä»¤çš„æ¶ˆè€—å°±å±äº\u0026quot;sy\u0026quot;ï¼Œè¿™é‡Œå°±å¯¹åº”ä¸Šé¢å›¾é‡Œçš„ç¬¬äºŒä¸ªæ¡†ã€‚\u0026ldquo;sy\u0026quot;æ˜¯ \u0026ldquo;system\u0026quot;çš„ç¼©å†™ï¼Œä»£è¡¨å†…æ ¸æ€ CPU ä½¿ç”¨ã€‚\næ¥ä¸‹æ¥ï¼Œè¿™ä¸ª read() ç³»ç»Ÿè°ƒç”¨ä¼šå‘ Linux çš„ Block Layer å‘å‡ºä¸€ä¸ª I/O Requestï¼Œè§¦å‘ä¸€ä¸ªçœŸæ­£çš„ç£ç›˜è¯»å–æ“ä½œã€‚\nè¿™æ—¶å€™ï¼Œè¿™ä¸ªè¿›ç¨‹ä¸€èˆ¬ä¼šè¢«ç½®ä¸º TASK_UNINTERRUPTIBLEã€‚è€Œ Linux ä¼šæŠŠè¿™æ®µæ—¶é—´æ ‡ç¤ºæˆ\u0026quot;wa\u0026rdquo;ï¼Œå¯¹åº”å›¾ä¸­çš„ç¬¬ä¸‰ä¸ªæ¡†ã€‚\u0026ldquo;wa\u0026quot;æ˜¯\u0026quot;iowait\u0026quot;çš„ç¼©å†™ï¼Œä»£è¡¨ç­‰å¾… I/O çš„æ—¶é—´ï¼Œè¿™é‡Œçš„ I/O æ˜¯æŒ‡ Disk I/Oã€‚\nç´§æ¥ç€ï¼Œå½“ç£ç›˜è¿”å›æ•°æ®æ—¶ï¼Œè¿›ç¨‹åœ¨å†…æ ¸æ€æ‹¿åˆ°æ•°æ®ï¼Œè¿™é‡Œä»æ—§æ˜¯å†…æ ¸æ€çš„ CPU ä½¿ç”¨ä¸­çš„\u0026quot;sy\u0026rdquo;ï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­çš„ç¬¬å››ä¸ªæ¡†ã€‚\nç„¶åï¼Œè¿›ç¨‹å†ä»å†…æ ¸æ€åˆ‡æ¢å›ç”¨æˆ·æ€ï¼Œåœ¨ç”¨æˆ·æ€å¾—åˆ°æ–‡ä»¶æ•°æ®ï¼Œè¿™é‡Œè¿›ç¨‹åˆå›åˆ°ç”¨æˆ·æ€çš„ CPU ä½¿ç”¨ï¼Œ\u0026ldquo;us\u0026rdquo;ï¼Œå¯¹åº”å›¾ä¸­ç¬¬äº”ä¸ªæ¡†ã€‚\nå¥½ï¼Œè¿™é‡Œæˆ‘ä»¬å‡è®¾ä¸€ä¸‹ï¼Œè¿™ä¸ªç”¨æˆ·è¿›ç¨‹åœ¨è¯»å–æ•°æ®ä¹‹åï¼Œæ²¡äº‹å¯åšå°±ä¼‘çœ äº†ã€‚å¹¶ä¸”æˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥å‡è®¾ï¼Œè¿™æ—¶åœ¨è¿™ä¸ª CPU ä¸Šä¹Ÿæ²¡æœ‰å…¶ä»–éœ€è¦è¿è¡Œçš„è¿›ç¨‹äº†ï¼Œé‚£ä¹ˆç³»ç»Ÿå°±ä¼šè¿›å…¥\u0026quot;id\u0026quot;è¿™ä¸ªæ­¥éª¤ï¼Œä¹Ÿå°±æ˜¯ç¬¬å…­ä¸ªæ¡†ã€‚\u0026ldquo;id\u0026quot;æ˜¯\u0026quot;idle\u0026quot;çš„ç¼©å†™ï¼Œä»£è¡¨ç³»ç»Ÿå¤„äºç©ºé—²çŠ¶æ€ã€‚\nå¦‚æœè¿™æ—¶è¿™å°æœºå™¨åœ¨ç½‘ç»œæ”¶åˆ°ä¸€ä¸ªç½‘ç»œæ•°æ®åŒ…ï¼Œç½‘å¡å°±ä¼šå‘å‡ºä¸€ä¸ªä¸­æ–­ï¼ˆinterruptï¼‰ã€‚ç›¸åº”åœ°ï¼ŒCPU ä¼šå“åº”ä¸­æ–­ï¼Œç„¶åè¿›å…¥ä¸­æ–­æœåŠ¡ç¨‹åºã€‚\nè¿™æ—¶ï¼ŒCPU å°±ä¼šè¿›å…¥\u0026quot;hi\u0026rdquo;ï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸ƒä¸ªæ¡†ã€‚\u0026ldquo;hi\u0026quot;æ˜¯\u0026quot;hardware irq\u0026quot;çš„ç¼©å†™ï¼Œä»£è¡¨ CPU å¤„ç†ç¡¬ä¸­æ–­çš„å¼€é”€ã€‚ç”±äºæˆ‘ä»¬çš„ä¸­æ–­æœåŠ¡å¤„ç†éœ€è¦å…³é—­ä¸­æ–­ï¼Œæ‰€ä»¥è¿™ä¸ªç¡¬ä¸­æ–­çš„æ—¶é—´ä¸èƒ½å¤ªé•¿ã€‚\nä½†æ˜¯ï¼Œå‘ç”Ÿä¸­æ–­åçš„å·¥ä½œæ˜¯å¿…é¡»è¦å®Œæˆçš„ï¼Œå¦‚æœè¿™äº›å·¥ä½œæ¯”è¾ƒè€—æ—¶é‚£æ€ä¹ˆåŠå‘¢ï¼ŸLinux ä¸­æœ‰ä¸€ä¸ªè½¯ä¸­æ–­çš„æ¦‚å¿µï¼ˆsoftirqï¼‰ï¼Œå®ƒå¯ä»¥å®Œæˆè¿™äº›è€—æ—¶æ¯”è¾ƒé•¿çš„å·¥ä½œã€‚\nä½ å¯ä»¥è¿™æ ·ç†è§£è¿™ä¸ªè½¯ä¸­æ–­ï¼Œä»ç½‘å¡æ”¶åˆ°æ•°æ®åŒ…çš„å¤§éƒ¨åˆ†å·¥ä½œï¼Œéƒ½æ˜¯é€šè¿‡è½¯ä¸­æ–­æ¥å¤„ç†çš„ã€‚é‚£ä¹ˆï¼ŒCPU å°±ä¼šè¿›å…¥åˆ°ç¬¬å…«ä¸ªæ¡†ï¼Œ\u0026ldquo;si\u0026rdquo;ã€‚è¿™é‡Œ\u0026quot;si\u0026quot;æ˜¯\u0026quot;softirq\u0026quot;çš„ç¼©å†™ï¼Œä»£è¡¨ CPU å¤„ç†è½¯ä¸­æ–­çš„å¼€é”€ã€‚\nè¿™é‡Œä½ è¦æ³¨æ„ï¼Œæ— è®ºæ˜¯\u0026quot;hi\u0026quot;è¿˜æ˜¯\u0026quot;si\u0026rdquo;ï¼Œå®ƒä»¬çš„ CPU æ—¶é—´éƒ½ä¸ä¼šè®¡å…¥è¿›ç¨‹çš„ CPU æ—¶é—´ã€‚è¿™æ˜¯å› ä¸ºæœ¬èº«å®ƒä»¬åœ¨å¤„ç†çš„æ—¶å€™å°±ä¸å±äºä»»ä½•ä¸€ä¸ªè¿›ç¨‹ã€‚\né™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰niï¼Œæ˜¯\u0026quot;nice\u0026quot;çš„ç¼©å†™ï¼Œè¿™é‡Œè¡¨ç¤ºå¦‚æœè¿›ç¨‹çš„ nice å€¼æ˜¯æ­£å€¼ï¼ˆ1-19ï¼‰ï¼Œä»£è¡¨ä¼˜å…ˆçº§æ¯”è¾ƒä½çš„è¿›ç¨‹è¿è¡Œæ—¶æ‰€å ç”¨çš„ CPUã€‚\nè¿˜æœ‰stï¼Œstæ˜¯\u0026quot;steal\u0026quot;çš„ç¼©å†™ï¼Œæ˜¯åœ¨è™šæ‹Ÿæœºé‡Œç”¨çš„ä¸€ä¸ª CPU ä½¿ç”¨ç±»å‹ï¼Œè¡¨ç¤ºæœ‰å¤šå°‘æ—¶é—´æ˜¯è¢«åŒä¸€ä¸ªå®¿ä¸»æœºä¸Šçš„å…¶ä»–è™šæ‹ŸæœºæŠ¢èµ°çš„ã€‚\nç¬¬å››ã€äº”è¡Œ ç¬¬4ã€5è¡Œæ˜¾ç¤ºçš„æ˜¯ç³»ç»Ÿå†…å­˜ä½¿ç”¨ï¼Œå•ä½KiBã€‚totol è¡¨ç¤ºæ€»å†…å­˜ï¼Œfree è¡¨ç¤ºæ²¡ä½¿ç”¨è¿‡çš„å†…å®¹ï¼Œusedæ˜¯å·²ç»ä½¿ç”¨çš„å†…å­˜ã€‚buffè¡¨ç¤ºç”¨äºè¯»å†™ç£ç›˜ç¼“å­˜çš„å†…å­˜ï¼Œcacheè¡¨ç¤ºç”¨äºè¯»å†™æ–‡ä»¶ç¼“å­˜çš„å†…å­˜,availè¡¨ç¤ºå¯ç”¨çš„åº”ç”¨å†…å­˜ã€‚\nSwapï¼š totalè¡¨ç¤ºèƒ½ç”¨çš„swapæ€»é‡ï¼Œ freeè¡¨ç¤ºå‰©ä½™ï¼Œusedè¡¨ç¤ºå·²ç»ä½¿ç”¨çš„ï¼Œavailè¡¨ç¤ºå¯ç”¨çš„äº¤æ¢åŒºå¤§å°ã€‚\nå…¶ä»– ä»ç¬¬6è¡Œå¼€å§‹ï¼Œè¡¨ç¤ºçš„æ˜¯å…·ä½“çš„è¿›ç¨‹çŠ¶æ€ï¼š\n PID è¿›ç¨‹ID USER è¿›ç¨‹æ‰€æœ‰è€…çš„ç”¨æˆ·åï¼Œä¾‹å¦‚root PRè¿›ç¨‹è°ƒåº¦ä¼˜å…ˆçº§ NIè¿›ç¨‹niceå€¼ï¼ˆä¼˜å…ˆçº§ï¼‰ï¼Œè¶Šå°çš„å€¼ä»£è¡¨è¶Šé«˜çš„ä¼˜å…ˆçº§ VIRT è¿›ç¨‹ä½¿ç”¨çš„è™šæ‹Ÿå†…å­˜ RES è¿›ç¨‹ä½¿ç”¨çš„ç‰©ç†å†…å­˜ï¼ˆä¸åŒ…æ‹¬å…±äº«å†…å­˜ï¼‰ SHR è¿›ç¨‹ä½¿ç”¨çš„å…±äº«å†…å­˜ CPU è¿›ç¨‹ä½¿ç”¨çš„CPUå æ¯” MEM è¿›ç¨‹ä½¿ç”¨çš„å†…å­˜å æ¯” TIME è¿›ç¨‹å¯åŠ¨ååˆ°ç°åœ¨æ‰€ç”¨çš„å…¨éƒ¨CPUæ—¶é—´ COMMAND è¿›ç¨‹çš„å¯åŠ¨å‘½ä»¤ï¼ˆé»˜è®¤åªæ˜¾ç¤ºäºŒè¿›åˆ¶ï¼Œtop -cèƒ½å¤Ÿæ˜¾ç¤ºå‘½ä»¤è¡Œå’Œå¯åŠ¨å‚æ•°ï¼‰  From https://www.cnblogs.com/makelu/p/11169270.html\nhttps://time.geekbang.org/column/article/311054\n","permalink":"http://yangchnet.github.io/Dessert/posts/linux/top%E5%91%BD%E4%BB%A4/","summary":"åœ¨ä½¿ç”¨topå‘½ä»¤æŸ¥çœ‹ç³»ç»ŸçŠ¶æ€æ—¶ï¼Œä¼šå‡ºç°ä¸€å †å‚æ•°ï¼Œè¿™äº›å‚æ•°åˆ†åˆ«ä»£è¡¨ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ\n ç¬¬ä¸€è¡Œ é¦–å…ˆæ‰“å°äº†å½“å‰æ—¶é—´21:11:55ï¼Œç„¶åæ˜¯ç³»ç»Ÿå·²ç»å¯åŠ¨äº†å¤šä¹…up 4 days, 8:45ï¼Œæˆ‘å·²ç»4å¤©8å°æ—¶45åˆ†é’Ÿæ²¡å…³æœºäº†ã€‚ã€‚\nç„¶åå½“å‰æœ‰3ä¸ªç”¨æˆ·ç™»å½•3 usersï¼Œload averageæ˜¯1.47, 1.33, 1.14\nload average load averageåé¢æœ‰ä¸‰ä¸ªå€¼ï¼Œåˆ†åˆ«ä»£è¡¨è¿‡å» 1 åˆ†é’Ÿï¼Œ5 åˆ†é’Ÿï¼Œ15 åˆ†é’Ÿåœ¨è¿™ä¸ªèŠ‚ç‚¹ä¸Šçš„ load average.\nLoad Average æ˜¯ä¸€ç§ CPU èµ„æºéœ€æ±‚çš„åº¦é‡ã€‚\nä¸¾ä¾‹æ¥è¯´ï¼Œå¯¹äºä¸€ä¸ªå•ä¸ª CPU çš„ç³»ç»Ÿï¼Œå¦‚æœåœ¨ 1 åˆ†é’Ÿçš„æ—¶é—´é‡Œï¼Œå¤„ç†å™¨ä¸Šå§‹ç»ˆæœ‰ä¸€ä¸ªè¿›ç¨‹åœ¨è¿è¡Œï¼ŒåŒæ—¶æ“ä½œç³»ç»Ÿçš„è¿›ç¨‹å¯è¿è¡Œé˜Ÿåˆ—ä¸­å§‹ç»ˆéƒ½æœ‰ 9 ä¸ªè¿›ç¨‹åœ¨ç­‰å¾…è·å– CPU èµ„æºã€‚é‚£ä¹ˆå¯¹äºè¿™ 1 åˆ†é’Ÿçš„æ—¶é—´æ¥è¯´ï¼Œç³»ç»Ÿçš„\u0026quot;load average\u0026quot;å°±æ˜¯ 1+9=10ï¼Œè¿™ä¸ªå®šä¹‰å¯¹ç»å¤§éƒ¨åˆ†çš„ Unix ç³»ç»Ÿéƒ½é€‚ç”¨ã€‚\nå¯¹äº Linux æ¥è¯´ï¼Œå¦‚æœåªè€ƒè™‘ CPU çš„èµ„æºï¼ŒLoad Averag ç­‰äºå•ä½æ—¶é—´å†…æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹åŠ ä¸Šå¯è¿è¡Œé˜Ÿåˆ—çš„è¿›ç¨‹ï¼Œè¿™ä¸ªå®šä¹‰ä¹Ÿæ˜¯æˆç«‹çš„ã€‚\nå¯¹äºload averageçš„ç†è§£æœ‰ä»¥ä¸‹ä¸‰ç‚¹ï¼š\n  ä¸è®ºè®¡ç®—æœº CPU æ˜¯ç©ºé—²è¿˜æ˜¯æ»¡è´Ÿè½½ï¼ŒLoad Average éƒ½æ˜¯ Linux è¿›ç¨‹è°ƒåº¦å™¨ä¸­å¯è¿è¡Œé˜Ÿåˆ—ï¼ˆRunning Queueï¼‰é‡Œçš„ä¸€æ®µæ—¶é—´çš„å¹³å‡è¿›ç¨‹æ•°ç›®ã€‚\n  è®¡ç®—æœºä¸Šçš„ CPU è¿˜æœ‰ç©ºé—²çš„æƒ…å†µä¸‹ï¼ŒCPU Usage å¯ä»¥ç›´æ¥åæ˜ åˆ°\u0026quot;load average\u0026quot;ä¸Šï¼Œä»€ä¹ˆæ˜¯ CPU è¿˜æœ‰ç©ºé—²å‘¢ï¼Ÿå…·ä½“æ¥è¯´å°±æ˜¯å¯è¿è¡Œé˜Ÿåˆ—ä¸­çš„è¿›ç¨‹æ•°ç›®å°äº CPU ä¸ªæ•°ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå•ä½æ—¶é—´è¿›ç¨‹ CPU Usage ç›¸åŠ çš„å¹³å‡å€¼åº”è¯¥å°±æ˜¯\u0026quot;load average\u0026quot;çš„å€¼ã€‚","title":"topå‘½ä»¤"},{"content":"å®¹å™¨å…·æœ‰è‡ªå·±çš„Network Namespace.\neht0æ˜¯è¿™ä¸ªNetwork Namespaceé‡Œçš„ç½‘ç»œæ¥å£ã€‚è€Œå®¿ä¸»æœºä¸Šä¹Ÿæœ‰è‡ªå·±çš„ eth0ï¼Œå®¿ä¸»æœºä¸Šçš„ eth0 å¯¹åº”ç€çœŸæ­£çš„ç‰©ç†ç½‘å¡ï¼Œå¯ä»¥å’Œå¤–é¢é€šè®¯\nè¦è®©å®¹å™¨ Network Namespace ä¸­çš„æ•°æ®åŒ…æœ€ç»ˆå‘é€åˆ°ç‰©ç†ç½‘å¡ä¸Šï¼Œéœ€è¦ä»¥ä¸‹ä¸¤æ­¥ï¼š\n å°†æ•°æ®åŒ…ä»å®¹å™¨çš„ Network Namespace å‘é€åˆ° Host Network Namespace ä¸Š æ•°æ®åŒ…ä»å®¿ä¸»æœºçš„eth0å‘é€å‡ºå»  è¦æƒ³è®©å®¹å™¨ä»è‡ªå·±çš„Network Namespaceè¿æ¥åˆ°Host Namespaceï¼Œä¸€èˆ¬æ¥è¯´å°±åªæœ‰ä¸¤ç±»è®¾å¤‡æ¥å£ï¼Œä¸€æ˜¯vethï¼Œå¦å¤–æ˜¯macvlan/ipvlan.\nvethæ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„ç½‘ç»œè®¾å¤‡ï¼Œä¸€èˆ¬æ˜¯æˆå¯¹å»ºç«‹ï¼Œè€Œä¸”è¿™å¯¹è®¾å¤‡æ˜¯ç›¸äº’è¿æ¥çš„ã€‚å½“æ¯ä¸ªè®¾å¤‡åœ¨ä¸åŒçš„ Network Namespaces çš„æ—¶å€™ï¼ŒNamespace ä¹‹é—´å°±å¯ä»¥ç”¨è¿™å¯¹ veth è®¾å¤‡æ¥è¿›è¡Œç½‘ç»œé€šè®¯äº†ã€‚\nåˆ°è¿™é‡Œï¼Œè§£å†³äº†ç¬¬ä¸€æ­¥ï¼Œä¸‹ä¸€æ­¥éœ€è¦å°†æ•°æ®åŒ…ä»å®¿ä¸»æœºçš„eth0å‘é€å‡ºå»ã€‚\nDocker ç¨‹åºåœ¨èŠ‚ç‚¹ä¸Šå®‰è£…å®Œä¹‹åï¼Œå°±ä¼šè‡ªåŠ¨å»ºç«‹äº†ä¸€ä¸ª docker0 çš„ bridge interfaceã€‚æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦æŠŠç¬¬ä¸€æ­¥ä¸­å»ºç«‹çš„ veth_host è¿™ä¸ªè®¾å¤‡ï¼Œæ¥å…¥åˆ° docker0 è¿™ä¸ª bridge ä¸Šã€‚\nå®¹å™¨å’Œdocker0ç»„æˆäº†ä¸€ä¸ªå­ç½‘ï¼Œdocker0ä¸Šçš„IPå°±æ˜¯è¿™ä¸ªå­ç½‘çš„ç½‘å…³IPã€‚\nç„¶ådocekr0é€šè¿‡natæˆ–routeçš„æ–¹å¼ï¼Œç»è¿‡eth0å°†æ•°æ®åŒ…å‘å¤–å‘é€ã€‚\nReference https://time.geekbang.org/column/article/323325\nhttp://icyfenix.cn/immutable-infrastructure/network/linux-vnet.html\nhttps://morven.life/posts/networking-4-docker-sigle-host/\nhttps://network.51cto.com/article/708901.html\n","permalink":"http://yangchnet.github.io/Dessert/posts/container/%E6%A6%82%E8%A7%88%E5%AE%B9%E5%99%A8%E7%AF%87%E4%BA%8C%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C/","summary":"å®¹å™¨å…·æœ‰è‡ªå·±çš„Network Namespace.\neht0æ˜¯è¿™ä¸ªNetwork Namespaceé‡Œçš„ç½‘ç»œæ¥å£ã€‚è€Œå®¿ä¸»æœºä¸Šä¹Ÿæœ‰è‡ªå·±çš„ eth0ï¼Œå®¿ä¸»æœºä¸Šçš„ eth0 å¯¹åº”ç€çœŸæ­£çš„ç‰©ç†ç½‘å¡ï¼Œå¯ä»¥å’Œå¤–é¢é€šè®¯\nè¦è®©å®¹å™¨ Network Namespace ä¸­çš„æ•°æ®åŒ…æœ€ç»ˆå‘é€åˆ°ç‰©ç†ç½‘å¡ä¸Šï¼Œéœ€è¦ä»¥ä¸‹ä¸¤æ­¥ï¼š\n å°†æ•°æ®åŒ…ä»å®¹å™¨çš„ Network Namespace å‘é€åˆ° Host Network Namespace ä¸Š æ•°æ®åŒ…ä»å®¿ä¸»æœºçš„eth0å‘é€å‡ºå»  è¦æƒ³è®©å®¹å™¨ä»è‡ªå·±çš„Network Namespaceè¿æ¥åˆ°Host Namespaceï¼Œä¸€èˆ¬æ¥è¯´å°±åªæœ‰ä¸¤ç±»è®¾å¤‡æ¥å£ï¼Œä¸€æ˜¯vethï¼Œå¦å¤–æ˜¯macvlan/ipvlan.\nvethæ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„ç½‘ç»œè®¾å¤‡ï¼Œä¸€èˆ¬æ˜¯æˆå¯¹å»ºç«‹ï¼Œè€Œä¸”è¿™å¯¹è®¾å¤‡æ˜¯ç›¸äº’è¿æ¥çš„ã€‚å½“æ¯ä¸ªè®¾å¤‡åœ¨ä¸åŒçš„ Network Namespaces çš„æ—¶å€™ï¼ŒNamespace ä¹‹é—´å°±å¯ä»¥ç”¨è¿™å¯¹ veth è®¾å¤‡æ¥è¿›è¡Œç½‘ç»œé€šè®¯äº†ã€‚\nåˆ°è¿™é‡Œï¼Œè§£å†³äº†ç¬¬ä¸€æ­¥ï¼Œä¸‹ä¸€æ­¥éœ€è¦å°†æ•°æ®åŒ…ä»å®¿ä¸»æœºçš„eth0å‘é€å‡ºå»ã€‚\nDocker ç¨‹åºåœ¨èŠ‚ç‚¹ä¸Šå®‰è£…å®Œä¹‹åï¼Œå°±ä¼šè‡ªåŠ¨å»ºç«‹äº†ä¸€ä¸ª docker0 çš„ bridge interfaceã€‚æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦æŠŠç¬¬ä¸€æ­¥ä¸­å»ºç«‹çš„ veth_host è¿™ä¸ªè®¾å¤‡ï¼Œæ¥å…¥åˆ° docker0 è¿™ä¸ª bridge ä¸Šã€‚\nå®¹å™¨å’Œdocker0ç»„æˆäº†ä¸€ä¸ªå­ç½‘ï¼Œdocker0ä¸Šçš„IPå°±æ˜¯è¿™ä¸ªå­ç½‘çš„ç½‘å…³IPã€‚\nç„¶ådocekr0é€šè¿‡natæˆ–routeçš„æ–¹å¼ï¼Œç»è¿‡eth0å°†æ•°æ®åŒ…å‘å¤–å‘é€ã€‚\nReference https://time.geekbang.org/column/article/323325\nhttp://icyfenix.cn/immutable-infrastructure/network/linux-vnet.html\nhttps://morven.life/posts/networking-4-docker-sigle-host/\nhttps://network.51cto.com/article/708901.html","title":"æ¦‚è§ˆå®¹å™¨ç¯‡äºŒï¼šå®¹å™¨ç½‘ç»œ"},{"content":" æœ¬ç³»åˆ—ä»£ç åŸºäºgolang1.19\n  runtimeç¯‡ä¸€ï¼šæ¥å£ runtimeç¯‡äºŒï¼šé€šé“ runtimeç¯‡ä¸‰ï¼šdefer runtimeç¯‡å››ï¼španic runtimeç¯‡äº”ï¼šslice  1. chançš„ç»“æ„ ä¸€ä¸ªchannelé•¿è¿™æ ·ï¼š\ntype hchan struct { qcount uint // total data in the queue \tdataqsiz uint // size of the circular queue \tbuf unsafe.Pointer // points to an array of dataqsiz elements \telemsize uint16 // chanä¸­å…ƒç´ å¤§å° \tclosed uint32 // æ˜¯å¦å…³é—­ \telemtype *_type // element type \tsendx uint // send index \trecvx uint // receive index \trecvq waitq // list of recv waiters \tsendq waitq // list of send waiters  lock mutex } channelçš„å­—æ®µä¸­ï¼Œä¸»è¦å¯ä»¥åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š\nç¬¬ä¸€éƒ¨åˆ†æ˜¯æ ‡è¯†channelè‡ªèº«çš„ä¸€äº›çŠ¶æ€å’Œæ€§è´¨ï¼Œå¦‚hchan.closedæ ‡è¯†chanæ˜¯å¦å…³é—­ï¼Œhchan.elemsizeæ ‡è¯†chanä¸­å…ƒç´ çš„å¤§å°ã€hchan.elemtypeæ ‡è¯†chanä¸­å…ƒç´ ç±»å‹ï¼›\nç¬¬äºŒéƒ¨åˆ†æ˜¯æ ‡è¯†åº•å±‚å¾ªç¯æ•°ç»„çš„çŠ¶æ€çš„å­—æ®µï¼Œå¦‚hchan.qcountæ ‡è¯†å½“å‰æ•°ç»„ä¸­å…ƒç´ æ•°é‡ã€hchan.dataqsizæ ‡è¯†å¾ªç¯æ•°ç»„çš„å¤§å°ã€hchan.bufæ˜¯æŒ‡å‘åº•å±‚æ•°ç»„çš„æŒ‡é’ˆã€hchan.sendxæ ‡è¯†å¾…å‘é€å…ƒç´ çš„ä¸‹æ ‡ã€hchan.recvxæ ‡è¯†å¾…æ¥æ”¶å…ƒç´ çš„ä¸‹æ ‡ï¼›\nç¬¬ä¸‰éƒ¨åˆ†æ˜¯å­˜å‚¨æ­£ç­‰å¾…å½“å‰chançš„goroutineï¼Œå¦‚hchan.recvqå­˜å‚¨ç­‰å¾…æ¥æ”¶çš„goroutineï¼Œhchan.sendqå­˜å‚¨ç­‰å¾…å‘é€çš„gotoutine\næœ€åæ˜¯ä¸€ä¸ªé”ï¼Œä¿è¯äº†å¹¶å‘å®‰å…¨ã€‚\n1.1 å¦‚ä½•æ„é€ ä¸€ä¸ªchan é€šè¿‡æ±‡ç¼–å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æ„é€ chanæ—¶ï¼Œè°ƒç”¨çš„æ˜¯runtime.makechanå‡½æ•°ï¼Œå‡½æ•°å¦‚ä¸‹ï¼š\ntype chantype struct { typ _type elem *_type dir uintptr } func makechan(t *chantype, size int) *hchan { elem := t.elem // ...  // çœç•¥éƒ¨åˆ†æ£€æŸ¥ä»£ç   mem, overflow := math.MulUintptr(elem.size, uintptr(size)) if overflow || mem \u0026gt; maxAlloc-hchanSize || size \u0026lt; 0 { panic(plainError(\u0026#34;makechan: size out of range\u0026#34;)) } // Hchan does not contain pointers interesting for GC when elements stored in buf do not contain pointers. \t// buf points into the same allocation, elemtype is persistent. \t// SudoG\u0026#39;s are referenced from their owning thread so they can\u0026#39;t be collected. \t// TODO(dvyukov,rlh): Rethink when collector can move allocated objects. \tvar c *hchan switch { case mem == 0: // Queue or element size is zero. \tc = (*hchan)(mallocgc(hchanSize, nil, true)) // Race detector uses this location for synchronization. \tc.buf = c.raceaddr() case elem.ptrdata == 0: // Elements do not contain pointers. \t// Allocate hchan and buf in one call. \tc = (*hchan)(mallocgc(hchanSize+mem, nil, true)) c.buf = add(unsafe.Pointer(c), hchanSize) default: // Elements contain pointers. \tc = new(hchan) c.buf = mallocgc(mem, elem, true) } c.elemsize = uint16(elem.size) c.elemtype = elem c.dataqsiz = uint(size) lockInit(\u0026amp;c.lock, lockRankHchan) if debugChan { print(\u0026#34;makechan: chan=\u0026#34;, c, \u0026#34;; elemsize=\u0026#34;, elem.size, \u0026#34;; dataqsiz=\u0026#34;, size, \u0026#34;\\n\u0026#34;) } return c } é¦–å…ˆå¯¹memè¿›è¡Œäº†è®¡ç®—ï¼Œmemæ˜¯chanä¸­å…ƒç´ æ‰€å çš„ç©ºé—´\nruntime.makechanå‡½æ•°ä¸­ï¼Œå—å…ˆæ˜¯ä¸€äº›æ£€æŸ¥ï¼Œç„¶åæ ¹æ®chançš„é•¿åº¦å’Œelemçš„ç±»å‹ï¼Œä¼šæœ‰ä¸åŒçš„æ„é€ ç­–ç•¥ï¼š\n å¦‚æœæ˜¯æ„é€ ä¸€ä¸ªæ— ç¼“å†²chanï¼Œå³å‚æ•°sizeä¸º0ï¼Œé‚£ä¹ˆé»˜è®¤åˆ†é…hchanSize=96å­—èŠ‚ç©ºé—´å¹¶å¼ºåˆ¶è½¬æ¢ä¸º*hchanç±»å‹ï¼Œ96å­—èŠ‚æ˜¯ä¸€ä¸ªhchançš„å¤§å°ã€‚ç„¶å å¦‚æœchançš„elemä¸åŒ…å«æŒ‡é’ˆï¼Œåˆ™åˆ†é…hchanSize+memç©ºé—´ç»™chanï¼Œå¹¶å°†hchanSizeä¹‹åçš„æ‰€æœ‰ç©ºé—´åˆ†é…ç»™hchan.bufã€‚ å¦‚æœchançš„elelåŒ…å«æŒ‡é’ˆï¼Œé‚£ä¹ˆç›´æ¥newä¸€ä¸ªchanï¼Œå¹¶ä¸ºhchan.bufåˆ†é…memeå¤§å°çš„ç©ºé—´  æœ€åå°†hchan.elemsizeã€hchan.elemtypeã€hchan.dataqsizè¿›è¡Œèµ‹å€¼ã€‚\nè¿”å›ä¸€ä¸ªhchançš„æŒ‡é’ˆï¼Œè¿™ä¿è¯äº†æˆ‘ä»¬åœ¨å¯¹channelè¿›è¡Œä¼ é€’æ—¶ä¸ä¼šè¿›è¡Œå¤åˆ¶ã€‚\n2. chançš„å‘é€ä¸æ¥æ”¶ 2.1 chançš„å‘é€ chanå‘é€æ—¶è°ƒç”¨äº†runtime.chansend1:\nfunc chansend(c *hchan, ep unsafe.Pointer, block bool, callerpc uintptr) bool { if c == nil { // å¦‚æœchanä¸ºnil \tif !block { // å¦‚æœä¸å¯é˜»å¡ \treturn false // å‘é€å¤±è´¥ \t} gopark(nil, nil, waitReasonChanSendNilChan, traceEvGoStop, 2) // å¯é˜»å¡ï¼ŒgoroutineæŒ‚èµ· \tthrow(\u0026#34;unreachable\u0026#34;) } // çœç•¥éƒ¨åˆ†ä»£ç   if !block \u0026amp;\u0026amp; c.closed == 0 \u0026amp;\u0026amp; full(c) { // ä¸å¯é˜»å¡ï¼Œchanæœªå…³é—­ä¸”å·²æ»¡ï¼Œåˆ™å‘é€å¤±è´¥ \treturn false } var t0 int64 if blockprofilerate \u0026gt; 0 { t0 = cputicks() } lock(\u0026amp;c.lock) // åŠ é”ï¼Œå¹¶å‘å®‰å…¨  if c.closed != 0 { // å¦‚æœchanå·²ç»è¢«å…³é—­äº† \tunlock(\u0026amp;c.lock) // è§£é” \tpanic(plainError(\u0026#34;send on closed channel\u0026#34;)) // å‘å·²å…³é—­çš„chanå‘é€ä¼španic \t} // å¦‚æœæ¥æ”¶é˜Ÿåˆ—ä¸­å­˜åœ¨goroutineï¼Œåˆ™ä¸ç»è¿‡hchan.bufï¼Œè€Œç›´æ¥å¤åˆ¶åˆ°æ¥æ”¶ç«¯ç¼“å†²åŒº \tif sg := c.recvq.dequeue(); sg != nil { // Found a waiting receiver. We pass the value we want to send \t// directly to the receiver, bypassing the channel buffer (if any). \tsend(c, sg, ep, func() { unlock(\u0026amp;c.lock) }, 3) return true } // chanè¿˜æ²¡æ»¡ \tif c.qcount \u0026lt; c.dataqsiz { // Space is available in the channel buffer. Enqueue the element to send. \tqp := chanbuf(c, c.sendx) // è®¡ç®—å­˜æ”¾å…ƒç´ çš„å†…å­˜åœ°å€ \tif raceenabled { racenotify(c, c.sendx, nil) } typedmemmove(c.elemtype, qp, ep) // å°†å…ƒç´ å¤åˆ¶åˆ°buf \tc.sendx++ // å¾…å‘é€ä¸‹æ ‡+1 \tif c.sendx == c.dataqsiz { // å¾ªç¯æ•°ç»„ \tc.sendx = 0 } c.qcount++ // æ€»å…ƒç´ æ•°é‡+1 \tunlock(\u0026amp;c.lock) // è§£é” \treturn true // å‘é€æˆåŠŸ \t} // chanæ»¡äº†  if !block { // chanæ»¡äº†ï¼Œä¸”è¦æ±‚ä¸å¯é˜»å¡ï¼Œåˆ™ç›´æ¥å¤±è´¥ \tunlock(\u0026amp;c.lock) return false } // å¯ä»¥é˜»å¡  // è·å–å½“å‰goroutineæŒ‡é’ˆ \tgp := getg() mysg := acquireSudog() mysg.releasetime = 0 if t0 != 0 { mysg.releasetime = -1 } mysg.elem = ep mysg.waitlink = nil mysg.g = gp mysg.isSelect = false mysg.c = c gp.waiting = mysg gp.param = nil c.sendq.enqueue(mysg) // å½“å‰goroutineè¿›å…¥chançš„å¾…å‘é€é˜Ÿåˆ—  atomic.Store8(\u0026amp;gp.parkingOnChan, 1) // æŒ‚èµ·å½“å‰goroutine \tgopark(chanparkcommit, unsafe.Pointer(\u0026amp;c.lock), waitReasonChanSend, traceEvGoBlockSend, 2) KeepAlive(ep) // å½“å‰goroutineè¢«å”¤é†’äº† \tif mysg != gp.waiting { throw(\u0026#34;G waiting list is corrupted\u0026#34;) } gp.waiting = nil gp.activeStackChans = false closed := !mysg.success gp.param = nil if mysg.releasetime \u0026gt; 0 { blockevent(mysg.releasetime-t0, 2) } mysg.c = nil releaseSudog(mysg) if closed { // è¢«å”¤é†’åå‘ç°chanå…³é—­äº† \tif c.closed == 0 { throw(\u0026#34;chansend: spurious wakeup\u0026#34;) } panic(plainError(\u0026#34;send on closed channel\u0026#34;)) } return true } ä¸Šè¿°ä»£ç çš„ä¸»è¦é€»è¾‘æ˜¯ï¼š\n æ£€æŸ¥ä¼šå‘é€å¤±è´¥çš„æƒ…å†µ åŠ é”  å†æ¬¡æ£€æŸ¥ä¼šå‘é€å¤±è´¥çš„æƒ…å†µï¼Œå¤±è´¥åˆ™è§£é”è¿”å›å¤±è´¥ å¦‚æœæœ‰goroutineåœ¨ç­‰ç€æ¥æ”¶ï¼Œç›´æ¥å¤åˆ¶ç»™å®ƒï¼Œè§£é”è¿”å›æˆåŠŸ chançš„bufæ²¡æ»¡ï¼Œå¤åˆ¶åˆ°bufä¸­ï¼Œè§£é”è¿”å›æˆåŠŸ å¦‚æœchançš„bufæ»¡äº†  ä¸å¯ä»¥é˜»å¡ï¼Œè§£é”è¿”å›å¤±è´¥ å¯ä»¥é˜»å¡ï¼Œè®©goroutineè¿›å…¥ç­‰å¾…é˜Ÿåˆ—å¹¶æŒ‚èµ·ï¼Œç­‰å¾…å”¤é†’      å”¤é†’åï¼Œä¸ä¼šå†è¿›è¡Œå‘é€æˆ–å¤åˆ¶ç­‰ï¼Œå› ä¸ºä¸€ä¸ªgoroutineå¦‚æœæ˜¯ä»ç­‰å¾…é˜Ÿåˆ—è¢«å”¤é†’ï¼Œåˆ™æ˜¯ç›´æ¥ä»å‘é€goroutineå°†æ¶ˆæ¯å¤åˆ¶è¿‡æ¥ï¼Œç„¶åæ‰å”¤é†’ï¼Œå› æ­¤å¯ä»¥ç›´æ¥ç»“æŸã€‚\nå¦‚æœåœ¨å‘é€æ—¶å‘ç°æœ‰ç­‰å¾…æ¥æ”¶çš„goroutineï¼Œä¼šè°ƒç”¨runtime.sendå°†å…ƒç´ å¤åˆ¶ç»™ç­‰å¾…çš„goroutineï¼Œruntime.sendå¦‚ä¸‹ï¼š\nfunc send(c *hchan, sg *sudog, ep unsafe.Pointer, unlockf func(), skip int) { if raceenabled { if c.dataqsiz == 0 { racesync(c, sg) } else { // Pretend we go through the buffer, even though \t// we copy directly. Note that we need to increment \t// the head/tail locations only when raceenabled. \tracenotify(c, c.recvx, nil) racenotify(c, c.recvx, sg) c.recvx++ if c.recvx == c.dataqsiz { c.recvx = 0 } c.sendx = c.recvx // c.sendx = (c.sendx+1) % c.dataqsiz \t} } // sg.elem æŒ‡å‘æ¥æ”¶åˆ°çš„å€¼å­˜æ”¾çš„ä½ç½®ï¼Œå¦‚ val \u0026lt;- chï¼ŒæŒ‡çš„å°±æ˜¯ \u0026amp;val \tif sg.elem != nil { sendDirect(c.elemtype, sg, ep) sg.elem = nil } gp := sg.g unlockf() gp.param = unsafe.Pointer(sg) sg.success = true if sg.releasetime != 0 { sg.releasetime = cputicks() } goready(gp, skip+1) } 2.2 chançš„æ¥æ”¶ chanæ¥æ”¶æ—¶è°ƒç”¨çš„å‡½æ•°ä¸ºruntime.chanrecv:\nfunc chanrecv(c *hchan, ep unsafe.Pointer, block bool) (selected, received bool) { if debugChan { print(\u0026#34;chanrecv: chan=\u0026#34;, c, \u0026#34;\\n\u0026#34;) } if c == nil { // chanä¸ºnil \tif !block { // ä¸”ä¸å¯é˜»å¡ \treturn\t// ç›´æ¥è¿”å›å¤±è´¥ \t} gopark(nil, nil, waitReasonChanReceiveNilChan, traceEvGoStop, 2) // å¯é˜»å¡ï¼ŒgotoutineæŒ‚èµ· \tthrow(\u0026#34;unreachable\u0026#34;) } // Fast path: check for failed non-blocking operation without acquiring the lock. \tif !block \u0026amp;\u0026amp; empty(c) { // ä¸å¯é˜»å¡ä¸”chanä¸ºç©º \tif atomic.Load(\u0026amp;c.closed) == 0 { // chanæ²¡å…³é—­ \treturn } // The channel is irreversibly closed. Re-check whether the channel has any pending data \t// to receive, which could have arrived between the empty and closed checks above. \t// Sequential consistency is also required here, when racing with such a send. \tif empty(c) { // chanè¢«å…³é—­äº†ï¼Œä½†å…¶ä¸­å¯èƒ½è¿˜æœ‰æœªå–å‡ºçš„å€¼ \t// The channel is irreversibly closed and empty. \tif raceenabled { raceacquire(c.raceaddr()) } if ep != nil { typedmemclr(c.elemtype, ep) } return true, false } } var t0 int64 if blockprofilerate \u0026gt; 0 { t0 = cputicks() } lock(\u0026amp;c.lock) // ä¸Šé”  if c.closed != 0 {\t// å†æ¬¡æ£€æŸ¥chanæ˜¯å¦è¢«å…³é—­ \tif c.qcount == 0 { if raceenabled { raceacquire(c.raceaddr()) } unlock(\u0026amp;c.lock) if ep != nil { typedmemclr(c.elemtype, ep) } return true, false } // The channel has been closed, but the channel\u0026#39;s buffer have data. \t} else { // Just found waiting sender with not closed. \tif sg := c.sendq.dequeue(); sg != nil { // æœ‰ä¸ªchanç­‰ç€å‘ \t// Found a waiting sender. If buffer is size 0, receive value \t// directly from sender. Otherwise, receive from head of queue \t// and add sender\u0026#39;s value to the tail of the queue (both map to \t// the same buffer slot because the queue is full). \trecv(c, sg, ep, func() { unlock(\u0026amp;c.lock) }, 3) return true, true } } if c.qcount \u0026gt; 0 { // å½“å‰chanä¸­æœ‰å€¼ \t// Receive directly from queue \tqp := chanbuf(c, c.recvx) if raceenabled { racenotify(c, c.recvx, nil) } if ep != nil { typedmemmove(c.elemtype, ep, qp)\t// å°†æ¶ˆæ¯å¤åˆ¶ç»™æ¥æ”¶è€… \t} typedmemclr(c.elemtype, qp)\t// æ¸…ç†å‘é€è€…å†…å­˜ç©ºé—´ \tc.recvx++ if c.recvx == c.dataqsiz { c.recvx = 0 } c.qcount-- unlock(\u0026amp;c.lock) return true, true } if !block {\t// å½“å‰chanä¸­æ²¡æœ‰å€¼ï¼Œåˆä¸èƒ½é˜»å¡ï¼Œåªå¥½å¤±è´¥ \tunlock(\u0026amp;c.lock) return false, false } // å¯ä»¥é˜»å¡ï¼Œå…ˆåç­‰ä¸€ä¼š \tgp := getg() mysg := acquireSudog() mysg.releasetime = 0 if t0 != 0 { mysg.releasetime = -1 } // No stack splits between assigning elem and enqueuing mysg \t// on gp.waiting where copystack can find it. \tmysg.elem = ep mysg.waitlink = nil gp.waiting = mysg mysg.g = gp mysg.isSelect = false mysg.c = c gp.param = nil c.recvq.enqueue(mysg) atomic.Store8(\u0026amp;gp.parkingOnChan, 1) gopark(chanparkcommit, unsafe.Pointer(\u0026amp;c.lock), waitReasonChanReceive, traceEvGoBlockRecv, 2) // è¢«å”¤é†’äº† \tif mysg != gp.waiting { throw(\u0026#34;G waiting list is corrupted\u0026#34;) } gp.waiting = nil gp.activeStackChans = false if mysg.releasetime \u0026gt; 0 { blockevent(mysg.releasetime-t0, 2) } success := mysg.success gp.param = nil mysg.c = nil releaseSudog(mysg) return true, success } æ€»ä½“æ¥çœ‹ï¼Œå’Œå‘é€çš„è¿‡ç¨‹å¾ˆç›¸ä¼¼ï¼Œä¸»è¦æ˜¯æ£€æŸ¥chanæ˜¯å¦å…³é—­ï¼Œæ˜¯å¦å¯é˜»å¡ï¼Œæ˜¯å¦æœ‰å‘é€è€…ç­‰å¾…ï¼Œchanä¸­æ˜¯å¦æœ‰å€¼ï¼Œç„¶ååšå‡ºå“åº”çš„å¤„ç†ã€‚\nåœ¨ä½¿ç”¨chanè¿›è¡Œæ¥æ”¶æ—¶ï¼Œæœ‰æ—¶å¯ä»¥ä½¿ç”¨okæ¥æ ‡è¯†æ˜¯å¦çœŸçš„ä»chanä¸­æ¥æ”¶åˆ°äº†å€¼ï¼Œgoåº•å±‚é€šè¿‡ä¸åŒçš„å‡½æ•°åšåˆ°è¿™ä¸€ç‚¹ï¼š\n// a := \u0026lt;-chan func chanrecv1(c *hchan, elem unsafe.Pointer) { chanrecv(c, elem, true) } // a, ok := \u0026lt;-chan func chanrecv2(c *hchan, elem unsafe.Pointer) (received bool) { _, received = chanrecv(c, elem, true) return } 3. chançš„å…³é—­ å…³é—­chanæ—¶ï¼Œè°ƒç”¨çš„æ˜¯runtime.closechan:\nfunc closechan(c *hchan) { if c == nil { // ä¸èƒ½å…³é—­ä¸€ä¸ªnilchan \tpanic(plainError(\u0026#34;close of nil channel\u0026#34;)) } lock(\u0026amp;c.lock) if c.closed != 0 { // ä¸èƒ½é‡å¤å…³é—­chan \tunlock(\u0026amp;c.lock) panic(plainError(\u0026#34;close of closed channel\u0026#34;)) } if raceenabled { callerpc := getcallerpc() racewritepc(c.raceaddr(), callerpc, abi.FuncPCABIInternal(closechan)) racerelease(c.raceaddr()) } c.closed = 1 // è®¾ç½®chançŠ¶æ€ä¸ºå…³é—­  var glist gList // å¤„ç†æ‰€æœ‰ç­‰å¾…è¯»å–çš„goroutine \tfor { sg := c.recvq.dequeue() if sg == nil { // å½“recvqä¸­æ²¡æœ‰goroutineæ—¶è·³å‡º \tbreak } if sg.elem != nil { // sg.elemä¸ä¸ºç©ºè¯´æ˜æ¥å—è€…æœªå¿½ç•¥æ¥æ”¶å€¼ \ttypedmemclr(c.elemtype, sg.elem) // ç»™ç­‰å¾…è¯»å–çš„è®¾ç½®é›¶å€¼ \tsg.elem = nil } if sg.releasetime != 0 { sg.releasetime = cputicks() } // æŠŠgoroutineå–å‡ºæ¥ \tgp := sg.g gp.param = unsafe.Pointer(sg) sg.success = false if raceenabled { raceacquireg(gp, c.raceaddr()) } glist.push(gp) // å°†goroutineæ¨å…¥glist \t} // æ‰€æœ‰æƒ³è¦å‘é€çš„goroutineï¼Œå¯¹ä¸èµ·ï¼Œä½ ä»¬panicå§ \tfor { sg := c.sendq.dequeue() if sg == nil { break } sg.elem = nil if sg.releasetime != 0 { sg.releasetime = cputicks() } gp := sg.g gp.param = unsafe.Pointer(sg) sg.success = false if raceenabled { raceacquireg(gp, c.raceaddr()) } glist.push(gp) // å°†goroutineæ¨å…¥glist \t} unlock(\u0026amp;c.lock) // éå†gListï¼ŒæŠŠå…¶ä¸­çš„æ‰€æœ‰goroutineå”¤é†’ \tfor !glist.empty() { gp := glist.pop() gp.schedlink = 0 goready(gp, 3) } } å¯¹äºchançš„å…³é—­ï¼Œä¸»è¦æœ‰ä¸¤ç‚¹ï¼š\n å¯¹äºå¾…æ¥æ”¶çš„chanï¼Œå¦‚æœchanç¼“å†²åŒºä¸­æ²¡æœ‰å€¼äº†ï¼Œåˆ™è¿”å›å…¶ä¸€ä¸ªé›¶å€¼ï¼Œå¦‚æœç¼“å†²åŒºè¿˜æœ‰å€¼ï¼Œåˆ™æŠŠå€¼äº¤ç»™å®ƒ å¯¹äºå¾…å‘é€çš„chanï¼Œå¯¹ä¸èµ·äº†å®è´ä»¬ï¼Œä½ ä»¬éƒ½ç»™çˆ·çˆ·panicå§  References https://golang.design/go-questions/channel/struct/\nhttps://codeburst.io/diving-deep-into-the-golang-channels-549fd4ed21a8\n","permalink":"http://yangchnet.github.io/Dessert/posts/golang/runtime%E7%AF%87%E4%BA%8C%E9%80%9A%E9%81%93/","summary":"æœ¬ç³»åˆ—ä»£ç åŸºäºgolang1.19\n  runtimeç¯‡ä¸€ï¼šæ¥å£ runtimeç¯‡äºŒï¼šé€šé“ runtimeç¯‡ä¸‰ï¼šdefer runtimeç¯‡å››ï¼španic runtimeç¯‡äº”ï¼šslice  1. chançš„ç»“æ„ ä¸€ä¸ªchannelé•¿è¿™æ ·ï¼š\ntype hchan struct { qcount uint // total data in the queue \tdataqsiz uint // size of the circular queue \tbuf unsafe.Pointer // points to an array of dataqsiz elements \telemsize uint16 // chanä¸­å…ƒç´ å¤§å° \tclosed uint32 // æ˜¯å¦å…³é—­ \telemtype *_type // element type \tsendx uint // send index \trecvx uint // receive index \trecvq waitq // list of recv waiters \tsendq waitq // list of send waiters  lock mutex } channelçš„å­—æ®µä¸­ï¼Œä¸»è¦å¯ä»¥åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š","title":"runtimeç¯‡äºŒï¼šé€šé“"},{"content":" æœ¬ç³»åˆ—ä»£ç åŸºäºgolang1.19\n  runtimeç¯‡ä¸€ï¼šæ¥å£ runtimeç¯‡äºŒï¼šé€šé“ runtimeç¯‡ä¸‰ï¼šdefer runtimeç¯‡å››ï¼španic runtimeç¯‡äº”ï¼šslice  1. æ¥å£çš„å†…éƒ¨ç»“æ„ type iface struct { tab *itab data unsafe.Pointer } ä¸€ä¸ªæ¥å£æ˜¯ä¸€ä¸ªifaceç»“æ„ä½“ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªitabæŒ‡é’ˆå’Œä¸€ä¸ªunsafe.Pointerã€‚\næ¦‚å¿µä¸Šè®²ä¸€ä¸ªæ¥å£çš„å€¼,æ¥å£å€¼,ç”±ä¸¤ä¸ªéƒ¨åˆ†ç»„æˆ,ä¸€ä¸ªå…·ä½“çš„ç±»å‹å’Œé‚£ä¸ªç±»å‹çš„å€¼ã€‚å®ƒä»¬è¢«ç§°ä¸ºæ¥å£çš„åŠ¨æ€ç±»å‹å’ŒåŠ¨æ€å€¼ã€‚\nä¸€ä¸ªitabå¯ä»¥è¡¨ç¤ºä¸€ä¸ªæ¥å£çš„ç±»å‹å’Œèµ‹ç»™è¿™ä¸ªæ¥å£çš„å®ä½“ç±»å‹ï¼Œå³ä¸ºæ¥å£çš„åŠ¨æ€ç±»å‹ï¼Œè€Œdataæ‰€æŒ‡å‘çš„unsafe.Pointeråˆ™æŒ‡å‘æ¥å£çš„åŠ¨æ€å€¼ã€‚\nè¿‘è·ç¦»æ¥çœ‹itabï¼š\ntype itab struct { inter *interfacetype _type *_type hash uint32 // copy of _type.hash. Used for type switches. \t_ [4]byte fun [1]uintptr // variable sized. fun[0]==0 means _type does not implement inter. } å…¶ä¸­interå­—æ®µæè¿°äº†æ¥å£çš„ç±»å‹ï¼Œ_typeå­—æ®µæè¿°äº†å®ä½“ç±»å‹ï¼Œhashå­—æ®µæ˜¯ç±»å‹å“ˆå¸Œï¼Œç”¨äºç±»å‹åŒ¹é…ï¼Œfunå­—æ®µæ”¾ç½®å’Œæ¥å£æ–¹æ³•å¯¹åº”çš„å…·ä½“æ•°æ®ç±»å‹çš„æ–¹æ³•åœ°å€ã€‚\nå†æ¥çœ‹interfacetype\ntype interfacetype struct { typ _type pkgpath name mhdr []imethod } å…¶ä¸­typå’Œitabä¸­çš„_typeä¸ºåŒä¸€ä¸ªå€¼ï¼Œpkgpathåˆ™å­˜å‚¨äº†æ¥å£çš„åŒ…åï¼Œmhdråˆ™è¡¨ç¤ºæ¥å£æ‰€å®šä¹‰çš„å‡½æ•°åˆ—è¡¨ã€‚\nè¿™æ ·æ¥çœ‹ï¼Œä¸€ä¸ªæ¥å£ä¸»è¦æœ‰ä¸¤ä¸ªéƒ¨åˆ†æ„æˆï¼šç¬¬ä¸€æ˜¯å¯¹äºæ¥å£æœ¬èº«çš„æè¿°ï¼ŒåŒ…æ‹¬æ¥å£çš„åŒ…åiface.itab.inter.pkgpathã€æ¥å£çš„å‡½æ•°åˆ—è¡¨iface.itab.inter.mhdrï¼Œæ¥å£çš„hashå€¼iface.itab.hashã€‚ç¬¬äºŒéƒ¨åˆ†æ˜¯å¯¹äºå®ç°æ¥å£çš„å®ä½“çš„æè¿°ï¼ŒåŒ…æ‹¬å®ä½“çš„ç±»å‹iface.itab._typeï¼Œå®ä½“çš„å€¼iface.dataã€‚\nå¯ä»¥å°†itabçš„å€¼è¾“å‡ºçœ‹çœ‹ï¼š\ntype iface struct { tab *itab data unsafe.Pointer } type itab struct { inter *interfacetype _type uintptr hash uint32 _ [4]byte myfunc [1]uintptr } type interfacetype struct { mytype uintptr pkgpath string mhdr []uintptr } type Person interface { Walk() Say(words []string) string } type Student struct { name string age int } func (s Student) Walk() { return } func (s Student) Say(words []string) string { return strings.Join(words, \u0026#34; \u0026#34;) } func main() { var p = Person(Student{ name: \u0026#34;lichang\u0026#34;, age: 18, }) // æŸ¥çœ‹ifaceçš„ç»“æ„ \tp_iface := *(*iface)(unsafe.Pointer(\u0026amp;p)) fmt.Println(p_iface.tab) // æŸ¥çœ‹æ¥å£çš„åŠ¨æ€å€¼ \ts := (*Student)(unsafe.Pointer(p_iface.data)) fmt.Println(*s) } è¾“å‡ºï¼š\n\u0026amp;{0x489a80 4773888 3558907866 [0 0 0 0] [4234176]} {lichang 18} è€Œå¯¹äºä¸€ä¸ªç©ºæ¥å£æ¥è¯´ï¼Œå…¶å¹¶ä¸æ˜¯ä¸€ä¸ªifaceï¼Œè€Œæ˜¯ä¸€ä¸ªeface:\ntype eface struct { _type *_type data unsafe.Pointer } ä¸€ä¸ªç©ºæ¥å£ï¼Œå…¶æ²¡æœ‰å‡½æ•°åˆ—è¡¨ï¼Œç”¨äºæè¿°ç©ºæ¥å£çš„ç»“æ„ä½“åªæœ‰ä¸¤ä¸ªå­—æ®µï¼Œä¸€æ˜¯_typeï¼Œè¡¨ç¤ºå®ä½“ç±»å‹ï¼ŒäºŒæ˜¯dataï¼ŒæŒ‡å‘åŠ¨æ€å€¼ã€‚\n2. æ¥å£çš„ç±»å‹è½¬æ¢ 2.1 ç»“æ„ä½“åˆ°æ¥å£ç±»å‹çš„è½¬æ¢ å¯¹äºå¦‚ä¸‹ä»£ç ï¼š\ntype Person interface { Walk() Say(words []string) string } type Student struct { name string age int } func (s Student) Walk() { return } func (s Student) Say(words []string) string { return strings.Join(words, \u0026#34; \u0026#34;) } func main() { var p = Person(Student{ name: \u0026#34;lichang\u0026#34;, age: 18, }) fmt.Println(p) } é€šè¿‡æŸ¥çœ‹æ±‡ç¼–ä»£ç å¯çŸ¥ï¼Œå…¶åœ¨è¿›è¡ŒStudent-\u0026gt;Personçš„è½¬æ¢æ—¶ï¼Œè°ƒç”¨äº†runtime.convTï¼Œæ¥çœ‹ä¸€ä¸‹è¿™ä¸ªå‡½æ•°ï¼š\nfunc convT(t *_type, v unsafe.Pointer) unsafe.Pointer { // ... éƒ¨åˆ†æ¡ä»¶æ£€æŸ¥  x := mallocgc(t.size, t, true) typedmemmove(t, x, v) return x } func mallocgc(size uintptr, typ *_type, needzero bool) unsafe.Pointer func typedmemmove(typ *_type, dst, src unsafe.Pointer) convTå‡½æ•°æ¥æ”¶ä¸€ä¸ª*_typeï¼št, ä¸€ä¸ªunsafe.Pointerï¼švï¼Œå°†ç±»å‹ä¸ºtçš„væŒ‡å‘çš„å€¼è½¬æ¢ä¸ºä¸€ä¸ªå¯ä»¥ä½œä¸ºifaceç»“æ„ä½“ç¬¬äºŒä¸ªå­—æ®µçš„å€¼ã€‚\nçœŸæ­£å·¥ä½œçš„åªæœ‰ä¸¤è¡Œï¼Œç¬¬ä¸€è¡Œåˆ†é…ä¸€ä¸ªç±»å‹ä¸ºtçš„æ–°çš„å†…å­˜ç©ºé—´ï¼Œå¹¶ä¸ºå…¶èµ‹é›¶å€¼ï¼Œç¬¬äºŒè¡Œå°†væŒ‡å‘çš„å€¼å¤åˆ¶åˆ°xï¼Œæœ€åè¿”å›ã€‚\nå¯¹äºå¦‚ä¸‹ä»£ç ï¼š\nvar _ Person = (*Student)(nil) å¯ä»¥æ£€æŸ¥Studentæ˜¯å¦å®ç°äº†Personæ¥å£ï¼Œå…¶åº•å±‚åŒæ ·æ˜¯è°ƒç”¨çš„runtime.convT()ï¼Œå¦‚æœStudentæœªå®ç°Personæ¥å£ï¼Œåˆ™åœ¨typedmemmoveä¼šå‘ç”Ÿpanic\nä¸»è¦æ±‡ç¼–ä»£ç å¦‚ä¸‹ï¼š\n0x0027 00039 (main.go:28) LEAQ go.string.\u0026#34;lichang\u0026#34;(SB), CX\t# å°†å­—ç¬¦ä¸²ä»å†…å­˜è£…è½½åˆ°CXä¸­ 0x002e 00046 (main.go:28) MOVQ CX, \u0026#34;\u0026#34;..autotmp_6+56(SP)\t# CXä¸­çš„å€¼è¢«movåˆ°\u0026#34;\u0026#34;..autotmp_6+56(SP) 0x0033 00051 (main.go:28) MOVQ $7, \u0026#34;\u0026#34;..autotmp_6+64(SP)\t# å­—é¢é‡7è¢«movåˆ°\u0026#34;\u0026#34;..autotmp_6+64(SP)ï¼Œè¿™é‡Œå¯èƒ½æ˜¯è¦åšå†…å­˜å¯¹é½ 0x003c 00060 (main.go:29) MOVQ $18, \u0026#34;\u0026#34;..autotmp_6+72(SP)\t# å­—é¢é‡18è¢«movåˆ°\u0026#34;\u0026#34;..autotmp_6+72(SP) 0x0045 00069 (main.go:27) LEAQ type.\u0026#34;\u0026#34;.Student(SB), AX\t# ç»„è£…å¥½çš„Studentè¢«è£…è½½åˆ°AX 0x004c 00076 (main.go:27) LEAQ \u0026#34;\u0026#34;..autotmp_6+56(SP), BX\t# \u0026#34;\u0026#34;..autotmp_6+56(SP)è¢«è£…è½½åˆ°BX 0x0051 00081 (main.go:27) PCDATA $1, $0 0x0051 00081 (main.go:27) CALL runtime.convT(SB)\t# è°ƒç”¨runtime.convTæ„é€ itab 0x0056 00086 (main.go:32) MOVUPS X15, \u0026#34;\u0026#34;..autotmp_11+40(SP) 0x005c 00092 (main.go:32) MOVQ go.itab.\u0026#34;\u0026#34;.Student,\u0026#34;\u0026#34;.Person+8(SB), CX # æ„é€ å¥½çš„itabè¢«è£…è½½åˆ°CX 0x0063 00099 (main.go:32) MOVQ CX, \u0026#34;\u0026#34;..autotmp_11+40(SP)\t# CXä¸­çš„å€¼ï¼Œå³itabè¢«movåˆ°\u0026#34;\u0026#34;..autotmp_11+40(SP) 0x0068 00104 (main.go:32) MOVQ AX, \u0026#34;\u0026#34;..autotmp_11+48(SP)\t# AXä¸­çš„å€¼ï¼Œå³Studentå­—é¢é‡è¢«è£…è½½åˆ°\u0026#34;\u0026#34;..autotmp_11+48(SP) 2.2 æ¥å£ç±»å‹ä¹‹é—´çš„è½¬æ¢ type Person interface { Walk() Say(words []string) string } type Walker interface { Walk() } type Student struct { name string age int } func (s Student) Walk() { return } func (s Student) Say(words []string) string { return strings.Join(words, \u0026#34; \u0026#34;) } func main() { var p = Person(Student{ name: \u0026#34;lichang\u0026#34;, age: 18, }) var w Walker = p fmt.Println(w) } ç¼–è¯‘åæŸ¥çœ‹æ±‡ç¼–ä»£ç å¯çŸ¥ï¼Œåœ¨è¿›è¡ŒPersonæ¥å£åˆ°Studentæ¥å£çš„è½¬æ¢æ—¶è°ƒç”¨äº†runtime.convI2I:\nfunc convI2I(dst *interfacetype, src *itab) *itab { if src == nil { return nil } if src.inter == dst { return src } return getitab(dst, src._type, false) } runtime.convI2Iå‡½æ•°å°†src itabä¸­çš„interè½¬æ¢åˆ°dstç±»å‹ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„itabï¼Œé¦–å…ˆæ£€æŸ¥srcä¸ä¸ºç©ºï¼Œç„¶ååˆ¤æ–­srcçš„interæ˜¯å¦ä¸dstç›¸ç­‰ï¼Œæœ€åè°ƒç”¨äº†runtime.getitab\næ¥çœ‹runtime.getitab\nfunc getitab(inter *interfacetype, typ *_type, canfail bool) *itab { // ...  var m *itab // é¦–å…ˆä¼šä»å·²ç»å­˜åœ¨çš„è¡¨ä¸­æŸ¥æ‰¾ï¼Œå¦‚æœæ‰¾åˆ°äº†å¯ä»¥ç›´æ¥ç»“æŸï¼Œå¦åˆ™è¿›è¡Œä¸‹ä¸€æ­¥ã€‚  // è¿™é‡Œä½¿ç”¨åŸå­æ“ä½œä¿è¯åœ¨è¿™ä¹‹å‰å¯¹itabTableçš„å†™æ“ä½œç»“æŸã€‚ \tt := (*itabTableType)(atomic.Loadp(unsafe.Pointer(\u0026amp;itabTable))) if m = t.find(inter, typ); m != nil { goto finish } // å¦‚æœæ²¡æ‰¾åˆ°ï¼ŒåŠ é”ç»§ç»­æ‰¾ \tlock(\u0026amp;itabLock) if m = itabTable.find(inter, typ); m != nil { unlock(\u0026amp;itabLock) goto finish } // è¿˜æ²¡æ‰¾åˆ°ï¼Œæä¸ªæ–°çš„ \tm = (*itab)(persistentalloc(unsafe.Sizeof(itab{})+uintptr(len(inter.mhdr)-1)*goarch.PtrSize, 0, \u0026amp;memstats.other_sys)) m.inter = inter m._type = typ m.hash = 0 m.init() itabAdd(m) unlock(\u0026amp;itabLock) finish: if m.fun[0] != 0 { return m } if canfail { return nil } panic(\u0026amp;TypeAssertionError{concrete: typ, asserted: \u0026amp;inter.typ, missingMethod: m.init()}) } è¿™é‡Œä¸€å¼€å§‹åœ¨æ„é€ itabæ—¶å¹¶æ²¡æœ‰ç›´æ¥æ„é€ ï¼Œè€Œæ˜¯å»ä¸€ä¸ªruntime.itabTableTypeç»“æ„ä½“ä¸­å»æŸ¥æ‰¾è¿™ä¸ªitabæ˜¯å¦å­˜åœ¨ï¼Œruntime.itabTableTypeçš„å®šä¹‰å¦‚ä¸‹ï¼š\ntype itabTableType struct { size uintptr // length of entries array. Always a power of 2. \tcount uintptr // current number of filled entries. \tentries [itabInitSize]*itab // really [size] large } ç”¨äºæŸ¥æ‰¾itabçš„å‡½æ•°å¦‚ä¸‹ï¼š\nfunc (t *itabTableType) find(inter *interfacetype, typ *_type) *itab { // Implemented using quadratic probing. \t// Probe sequence is h(i) = h0 + i*(i+1)/2 mod 2^k. \t// We\u0026#39;re guaranteed to hit all table entries using this probe sequence. \tmask := t.size - 1 h := itabHashFunc(inter, typ) \u0026amp; mask for i := uintptr(1); ; i++ { p := (**itab)(add(unsafe.Pointer(\u0026amp;t.entries), h*goarch.PtrSize)) // Use atomic read here so if we see m != nil, we also see \t// the initializations of the fields of m. \t// m := *p \tm := (*itab)(atomic.Loadp(unsafe.Pointer(p))) if m == nil { return nil } if m.inter == inter \u0026amp;\u0026amp; m._type == typ { return m } h += i h \u0026amp;= mask } } åœ¨å®Œæˆè¿™äº›æ­¥éª¤ä¹‹åï¼Œä¸€ä¸ªæ–°çš„itabå°±æ„é€ å®Œæˆäº†ï¼Œè€Œç”±äºåœ¨è¿›è¡Œè½¬æ¢æ—¶å®ç°æ¥å£çš„å®ä½“å¹¶æ²¡æœ‰å˜åŒ–ï¼Œåªæ˜¯æ¥å£ç±»å‹å‘ç”Ÿäº†å˜åŒ–ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦å°†iface.itabé‡æ–°èµ‹å€¼ä¸ºæˆ‘ä»¬éœ€è¦çš„itabå³å¯ã€‚\n2.3 ç©ºæ¥å£çš„è½¬æ¢ func main() { var x int = 1 var ix interface{} = x fmt.Println(ix) } è¿™é‡Œè°ƒç”¨çš„æ˜¯runtime.convT64(SB)å‡½æ•°ï¼š\nfunc convT64(val uint64) (x unsafe.Pointer) { if val \u0026lt; uint64(len(staticuint64s)) { x = unsafe.Pointer(\u0026amp;staticuint64s[val]) } else { x = mallocgc(8, uint64Type, false) *(*uint64)(x) = val } return } è¿™é‡Œé¦–å…ˆæ£€æŸ¥å…¶å€¼æ˜¯å¦å°äºlen(staticuint64s)ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œå°±ä¸éœ€è¦å†å»è¿›è¡Œå†…å­˜åˆ†é…ï¼Œè€Œæ˜¯ç›´æ¥åˆ°æ•°ç»„ä¸­å–ï¼Œç®—æ˜¯è¿›è¡Œäº†ä¸€æ­¥ä¼˜åŒ–ã€‚å¦åˆ™è°ƒç”¨mallocgcä¸ºå…¶åˆ†é…ä¸€ä¸ªæ–°çš„å†…å­˜ç©ºé—´ï¼Œç„¶åå°†å…¶åº•å±‚å€¼èµ‹å€¼ä¸ºvalã€‚\nè¿™é‡Œå¦‚æœæ˜¯å°†ä¸€ä¸ªå­—ç¬¦ä¸²è½¬æ¢ä¸ºç©ºæ¥å£ç±»å‹ï¼Œåˆ™è°ƒç”¨çš„æ˜¯runtime.convTstring:\nfunc convTstring(val string) (x unsafe.Pointer) { if val == \u0026#34;\u0026#34; { x = unsafe.Pointer(\u0026amp;zeroVal[0]) } else { x = mallocgc(unsafe.Sizeof(val), stringType, true) *(*string)(x) = val } return } é€»è¾‘ç›¸å·®ä¸å¤§ã€‚\nåœ¨runtimeåŒ…ä¸­ï¼Œå¯¹äºæŸäº›ç‰¹æ®Šçš„ç±»å‹åšäº†ä¼˜åŒ–ï¼Œå¯ç›´æ¥è°ƒç”¨ç›¸åº”çš„å‡½æ•°è¿›è¡Œå®ä½“ç±»å‹åˆ°ç©ºæ¥å£ç±»å‹çš„è½¬åŒ–ï¼Œè¿™äº›è¢«è°ƒç”¨çš„å‡½æ•°æœ‰ï¼š\nfunc convT16(val uint16) unsafe.Pointer func convT32(val uint32) unsafe.Pointer func convT64(val uint64) unsafe.Pointer func convTstring(val string) unsafe.Pointer func convTslice(val []uint8) unsafe.Pointer 3. ç±»å‹æ–­è¨€ 3.1 ç©ºæ¥å£æ–­è¨€ å¯¹å¦‚ä¸‹golangä»£ç è¿›è¡Œç¼–è¯‘ï¼š\ntype User struct { name string } func main() { var x interface{} = \u0026amp;User{name: \u0026#34;lichang\u0026#34;} i, ok := x.(int) if !ok { return } else { fmt.Println(i) } } ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ç¼–è¯‘\ngo tool compile -S -N -l main.go # -Nç¦æ­¢ä¼˜åŒ–ï¼Œ-lç¦æ­¢å†…è” # æ„é€ æ¥å£ 0x0026 00038 (main.go:11) MOVUPS X15, \u0026#34;\u0026#34;..autotmp_8+96(SP) 0x002c 00044 (main.go:11) LEAQ \u0026#34;\u0026#34;..autotmp_8+96(SP), CX 0x0031 00049 (main.go:11) MOVQ CX, \u0026#34;\u0026#34;..autotmp_7+48(SP) 0x0036 00054 (main.go:11) TESTB AL, (CX) 0x0038 00056 (main.go:11) MOVQ $7, \u0026#34;\u0026#34;..autotmp_8+104(SP) 0x0041 00065 (main.go:11) LEAQ go.string.\u0026#34;lichang\u0026#34;(SB), DX 0x0048 00072 (main.go:11) MOVQ DX, \u0026#34;\u0026#34;..autotmp_8+96(SP) 0x004d 00077 (main.go:11) MOVQ CX, \u0026#34;\u0026#34;..autotmp_3+56(SP) 0x0052 00082 (main.go:11) LEAQ type.*\u0026#34;\u0026#34;.User(SB), DX 0x0059 00089 (main.go:11) MOVQ DX, \u0026#34;\u0026#34;.x+80(SP) # \u0026#34;\u0026#34;.x+80(SP)æ˜¯eface._type 0x005e 00094 (main.go:11) MOVQ CX, \u0026#34;\u0026#34;.x+88(SP)\t# \u0026#34;\u0026#34;.x+88(SP)æ˜¯eface.data # æ¥å£æ–­è¨€ 0x0063 00099 (main.go:13) MOVQ \u0026#34;\u0026#34;.x+80(SP), CX\t# å°†eface._typeç§»åŠ¨åˆ°CX 0x0068 00104 (main.go:13) MOVQ \u0026#34;\u0026#34;.x+88(SP), DX\t# å°†eface._dataç§»åŠ¨åˆ°DX 0x006d 00109 (main.go:13) LEAQ type.int(SB), BX\t# åŠ è½½intçš„_typeåˆ°BX 0x0074 00116 (main.go:13) CMPQ CX, BX\t# å¯¹æ¯”CXä¸BXï¼Œå³eface._typeä¸int._type 0x0077 00119 (main.go:13) JEQ 123\t# å¦‚æœ_typeå¯¹æ¯”æˆåŠŸï¼Œåˆ™è·³è½¬åˆ°123 0x0079 00121 (main.go:13) JMP 133\t# å¯¹æ¯”ä¸æˆåŠŸï¼Œè·³è½¬133 0x007b 00123 (main.go:13) MOVQ (DX), CX\t# å°†eface.dataæš‚å­˜åˆ°CX 0x007e 00126 (main.go:13) MOVL $1, AX 0x0083 00131 (main.go:13) JMP 139 0x0085 00133 (main.go:13) XORL CX, CX\t# ç±»å‹æ–­è¨€å¤±è´¥ï¼Œæ¸…ç©ºå¯„å­˜å™¨ 0x0087 00135 (main.go:13) XORL AX, AX\t# æ¸…ç©ºAXå¯„å­˜å™¨ 0x0089 00137 (main.go:13) JMP 139 0x008b 00139 (main.go:13) MOVQ CX, \u0026#34;\u0026#34;..autotmp_4+40(SP) 0x0090 00144 (main.go:13) MOVB AL, \u0026#34;\u0026#34;..autotmp_5+31(SP) 0x0094 00148 (main.go:13) MOVQ \u0026#34;\u0026#34;..autotmp_4+40(SP), CX 0x0099 00153 (main.go:13) MOVQ CX, \u0026#34;\u0026#34;.i+32(SP)\t# æ–­è¨€ç»“æœä¿å­˜åœ¨\u0026#34;\u0026#34;.i+32(SP) 0x009e 00158 (main.go:13) MOVBLZX \u0026#34;\u0026#34;..autotmp_5+31(SP), CX 0x00a3 00163 (main.go:13) MOVB CL, \u0026#34;\u0026#34;.ok+30(SP)\t# okä¿å­˜åœ¨\u0026#34;\u0026#34;.ok+30(SP) ä»ä»¥ä¸Šæ±‡ç¼–ä»£ç å¯ä»¥çœ‹å‡ºï¼Œç©ºæ¥å£åœ¨è¿›è¡Œç±»å‹æ–­è¨€æ—¶ï¼Œä¼šå°†eface._typeå–å‡ºä¸æ–­è¨€ç±»å‹çš„_typeè¿›è¡Œå¯¹æ¯”ï¼Œå¦‚æœå¯¹æ¯”æˆåŠŸï¼Œåˆ™å°†å…¶eface.dataå–å‡ºä½¿ç”¨ï¼Œå¦åˆ™æ–­è¨€å¤±è´¥ã€‚\n3.2 éç©ºæ¥å£æ–­è¨€ 3.2.1 æ–­è¨€ä¸ºæ¥å£ å¯¹å¦‚ä¸‹ä»£ç è¿›è¡Œç¼–è¯‘ï¼š\ntype Person interface { Walk() Say(words []string) string } type Walker interface { Walk() } type Student struct { name string age int } func (s Student) Walk() { return } func (s Student) Say(words []string) string { return strings.Join(words, \u0026#34; \u0026#34;) } func main() { var p = Person(Student{ name: \u0026#34;lichang\u0026#34;, age: 18, }) w, ok := p.(Walker) if !ok { return } else { fmt.Println(w) } } go tool compile -S -N -l main.go å¯å¾—éƒ¨åˆ†æ±‡ç¼–ä»£ç å¦‚ä¸‹ï¼š\n# ifaceæ„å»º 0x0026 00038 (main.go:32) MOVQ $0, \u0026#34;\u0026#34;..autotmp_3+176(SP) 0x0032 00050 (main.go:31) MOVUPS X15, \u0026#34;\u0026#34;..autotmp_3+184(SP) 0x003b 00059 (main.go:32) LEAQ go.string.\u0026#34;lichang\u0026#34;(SB), CX 0x0042 00066 (main.go:32) MOVQ CX, \u0026#34;\u0026#34;..autotmp_3+176(SP) 0x004a 00074 (main.go:32) MOVQ $7, \u0026#34;\u0026#34;..autotmp_3+184(SP) 0x0056 00086 (main.go:33) MOVQ $18, \u0026#34;\u0026#34;..autotmp_3+192(SP) 0x0062 00098 (main.go:31) LEAQ type.\u0026#34;\u0026#34;.Student(SB), AX 0x0069 00105 (main.go:31) LEAQ \u0026#34;\u0026#34;..autotmp_3+176(SP), BX 0x0071 00113 (main.go:31) PCDATA $1, $0 0x0071 00113 (main.go:31) CALL runtime.convT(SB) 0x0076 00118 (main.go:31) MOVQ AX, \u0026#34;\u0026#34;..autotmp_7+56(SP) 0x007b 00123 (main.go:31) LEAQ go.itab.\u0026#34;\u0026#34;.Student,\u0026#34;\u0026#34;.Person(SB), CX 0x0082 00130 (main.go:31) MOVQ CX, \u0026#34;\u0026#34;.p+88(SP)\t# iface.itabåœ¨\u0026#34;\u0026#34;.p+88(SP)å¤„ 0x0087 00135 (main.go:31) MOVQ AX, \u0026#34;\u0026#34;.p+96(SP)\t# iface.dataåœ¨\u0026#34;\u0026#34;.p+96(SP)å¤„ # ç±»å‹æ–­è¨€ 0x008c 00140 (main.go:36) MOVUPS X15, \u0026#34;\u0026#34;..autotmp_4+120(SP) 0x0092 00146 (main.go:36) MOVQ \u0026#34;\u0026#34;.p+88(SP), BX\t# iface.itabè¢«è½¬ç§»åˆ°BX 0x0097 00151 (main.go:36) MOVQ \u0026#34;\u0026#34;.p+96(SP), CX\t# iface.dataè¢«è½¬ç§»åˆ°CX 0x009c 00156 (main.go:36) LEAQ type.\u0026#34;\u0026#34;.Walker(SB), AX\t# Walker._typeè¢«åŠ è½½åˆ°AX 0x00a3 00163 (main.go:36) CALL runtime.assertI2I2(SB)\t# è°ƒç”¨runtime.assertI2I2 0x00a8 00168 (main.go:36) MOVQ AX, \u0026#34;\u0026#34;..autotmp_4+120(SP)\t# runtime.assertI2I2çš„è¿”å›å€¼å­˜å‚¨åœ¨\u0026#34;\u0026#34;..autotmp_4+120(SP) 0x00ad 00173 (main.go:36) MOVQ BX, \u0026#34;\u0026#34;..autotmp_4+128(SP) 0x00b5 00181 (main.go:36) TESTQ AX, AX 0x00b8 00184 (main.go:36) SETNE \u0026#34;\u0026#34;..autotmp_5+47(SP) 0x00bd 00189 (main.go:36) MOVQ \u0026#34;\u0026#34;..autotmp_4+128(SP), CX 0x00c5 00197 (main.go:36) MOVQ \u0026#34;\u0026#34;..autotmp_4+120(SP), DX 0x00ca 00202 (main.go:36) MOVQ DX, \u0026#34;\u0026#34;.w+72(SP)\t# æ–­è¨€æ¥å£çš„itabåœ¨\u0026#34;\u0026#34;.w+72(SP) 0x00cf 00207 (main.go:36) MOVQ CX, \u0026#34;\u0026#34;.w+80(SP)\t# æ–­è¨€æ¥å£çš„dataåœ¨\u0026#34;\u0026#34;.w+80(SP) 0x00d4 00212 (main.go:36) MOVBLZX \u0026#34;\u0026#34;..autotmp_5+47(SP), CX 0x00d9 00217 (main.go:36) MOVB CL, \u0026#34;\u0026#34;.ok+46(SP)\t# okè¢«å­˜å‚¨åœ¨\u0026#34;\u0026#34;.ok+46(SP) runtime.assertI2I2å‡½æ•°å¦‚ä¸‹ï¼š\nfunc assertI2I2(inter *interfacetype, i iface) (r iface) { tab := i.tab if tab == nil { return } if tab.inter != inter { tab = getitab(inter, tab._type, true) if tab == nil { return } } r.tab = tab r.data = i.data return } è¯¥å‡½æ•°æ¥å—ä¸€ä¸ªä¸€ä¸ªinterfacetypeå’Œä¸€ä¸ªifaceï¼Œæ£€æŸ¥iface.itab.interæ˜¯å¦ä¸ä¼ å…¥çš„interfacetypeç›¸åŒï¼Œè‹¥ç›¸åŒï¼Œåˆ™ç›´æ¥å°†åŸæ¥çš„ifaceå¤åˆ¶ä¸€ä¸ªæ–°çš„è¿”å›ï¼Œå¦åˆ™æ„å»ºä¸€ä¸ªå…·æœ‰ä¼ å…¥çš„interfacetypeçš„æ–°çš„itabï¼Œå¹¶èµ‹å€¼ç»™æ–°çš„iface;iface.dataç›´æ¥å¤åˆ¶åˆ°æ–°çš„ifaceã€‚\n3.2.2 æ–­è¨€ä¸ºå®ä½“å¯¹è±¡ å¯¹å¦‚ä¸‹ä»£ç è¿›è¡Œç¼–è¯‘ï¼š\ntype Person interface { Walk() Say(words []string) string } type Student struct { name string age int } func (s Student) Walk() { return } func (s Student) Say(words []string) string { return strings.Join(words, \u0026#34; \u0026#34;) } func main() { var p = Person(Student{ name: \u0026#34;lichang\u0026#34;, age: 18, }) w, ok := p.(Student) if !ok { return } else { fmt.Println(w) } } go tool compile -S -N -l main.go æœ‰å…³ç±»å‹æ–­è¨€çš„æ±‡ç¼–ä»£ç å¦‚ä¸‹ï¼š\n# æ¥å£æ„é€  0x0035 00053 (main.go:27) MOVUPS X15, \u0026#34;\u0026#34;..autotmp_8+224(SP) 0x003e 00062 (main.go:28) LEAQ go.string.\u0026#34;lichang\u0026#34;(SB), CX 0x0045 00069 (main.go:28) MOVQ CX, \u0026#34;\u0026#34;..autotmp_8+216(SP) 0x004d 00077 (main.go:28) MOVQ $7, \u0026#34;\u0026#34;..autotmp_8+224(SP) 0x0059 00089 (main.go:29) MOVQ $18, \u0026#34;\u0026#34;..autotmp_8+232(SP) 0x0065 00101 (main.go:27) MOVQ CX, \u0026#34;\u0026#34;..autotmp_12+240(SP) 0x006d 00109 (main.go:27) MOVQ $7, \u0026#34;\u0026#34;..autotmp_12+248(SP) 0x0079 00121 (main.go:27) MOVQ $18, \u0026#34;\u0026#34;..autotmp_12+256(SP) 0x0085 00133 (main.go:27) LEAQ go.itab.\u0026#34;\u0026#34;.Student,\u0026#34;\u0026#34;.Person(SB), CX 0x008c 00140 (main.go:27) MOVQ CX, \u0026#34;\u0026#34;.p+88(SP)\t# iface.itab 0x0091 00145 (main.go:27) LEAQ \u0026#34;\u0026#34;..autotmp_12+240(SP), CX 0x0099 00153 (main.go:27) MOVQ CX, \u0026#34;\u0026#34;.p+96(SP)\t# iface.data # ç±»å‹æ–­è¨€ 0x009e 00158 (main.go:32) MOVQ $0, \u0026#34;\u0026#34;..autotmp_8+216(SP) 0x00aa 00170 (main.go:32) MOVUPS X15, \u0026#34;\u0026#34;..autotmp_8+224(SP) 0x00b3 00179 (main.go:32) MOVQ \u0026#34;\u0026#34;.p+96(SP), CX\t# iface.dataè¢«è£…è½½åˆ°CX 0x00b8 00184 (main.go:32) MOVQ \u0026#34;\u0026#34;.p+88(SP), DX\t# iface.itabè¢«è£…è½½åˆ°DX 0x00bd 00189 (main.go:32) LEAQ go.itab.\u0026#34;\u0026#34;.Student,\u0026#34;\u0026#34;.Person(SB), SI # é‡æ–°æ„é€ ä¸€ä¸ªitabï¼Œå­˜å‚¨åœ¨SI 0x00c4 00196 (main.go:32) CMPQ DX, SI # å¯¹æ¯”æ–°æ„é€ çš„itabå’Œè€çš„itab 0x00c7 00199 (main.go:32) JEQ 203 0x00c9 00201 (main.go:32) JMP 221 0x00cb 00203 (main.go:32) MOVQ (CX), DX\t# CX(iface.data)æŒ‡å‘çš„å€¼0-7ä¸ªå­—èŠ‚movåˆ°DX 0x00ce 00206 (main.go:32) MOVQ 8(CX), SI\t# ç¬¬8-15ä¸ªå­—èŠ‚movåˆ°SI 0x00d2 00210 (main.go:32) MOVQ 16(CX), CX\t# ç¬¬16-24ä¸ªå­—èŠ‚movåˆ°CX 0x00d6 00214 (main.go:32) MOVL $1, AX 0x00db 00219 (main.go:32) JMP 231 0x00dd 00221 (main.go:32) XORL SI, SI\t# æ–­è¨€å¤±è´¥æ‰§è¡Œ 0x00df 00223 (main.go:32) XORL CX, CX 0x00e1 00225 (main.go:32) XORL AX, AX 0x00e3 00227 (main.go:32) XORL DX, DX 0x00e5 00229 (main.go:32) JMP 231 0x00e7 00231 (main.go:32) MOVQ DX, \u0026#34;\u0026#34;..autotmp_8+216(SP) 0x00ef 00239 (main.go:32) MOVQ SI, \u0026#34;\u0026#34;..autotmp_8+224(SP) 0x00f7 00247 (main.go:32) MOVQ CX, \u0026#34;\u0026#34;..autotmp_8+232(SP) 0x00ff 00255 (main.go:32) MOVB AL, \u0026#34;\u0026#34;..autotmp_9+47(SP) 0x0103 00259 (main.go:32) MOVQ \u0026#34;\u0026#34;..autotmp_8+216(SP), CX 0x010b 00267 (main.go:32) MOVQ \u0026#34;\u0026#34;..autotmp_8+224(SP), DX 0x0113 00275 (main.go:32) MOVQ \u0026#34;\u0026#34;..autotmp_8+232(SP), SI 0x011b 00283 (main.go:32) MOVQ CX, \u0026#34;\u0026#34;.s+168(SP)\t# æ„é€ Studentç»“æ„ä½“ 0x0123 00291 (main.go:32) MOVQ DX, \u0026#34;\u0026#34;.s+176(SP) 0x012b 00299 (main.go:32) MOVQ SI, \u0026#34;\u0026#34;.s+184(SP) 0x0133 00307 (main.go:32) MOVBLZX \u0026#34;\u0026#34;..autotmp_9+47(SP), CX 0x0138 00312 (main.go:32) MOVB CL, \u0026#34;\u0026#34;.ok+46(SP)\t# okå­˜å‚¨åœ¨\u0026#34;\u0026#34;.ok+46(SP) åœ¨è¿›è¡Œæ¥å£åˆ°å®ä½“å¯¹è±¡çš„æ–­è¨€æ—¶ï¼Œç¼–è¯‘å™¨ä¼šå°è¯•æ„å»ºä¸€ä¸ªæ–­è¨€å¯¹è±¡å¯¹åº”çš„itabï¼Œç„¶åå’ŒåŸæ¥å£çš„itabè¿›è¡Œå¯¹æ¯”ï¼Œå¦‚æœç›¸åŒï¼Œåˆ™æ–­è¨€å¯æˆåŠŸï¼Œå¦åˆ™å¤±è´¥ã€‚\næ–­è¨€æˆåŠŸåï¼Œå°†iface.dataè§£æï¼Œé‡æ–°ç»„è£…æˆæ–­è¨€å¯¹è±¡ã€‚æ–­è¨€å¤±è´¥åˆ™æ¸…ç©ºå¯„å­˜å™¨ï¼Œè¿”å›ä¸€ä¸ªæ–­è¨€å¯¹è±¡çš„é›¶å€¼\nReferences Go Questions\ninterfaceçš„ç±»å‹æ–­è¨€æ˜¯å¦‚ä½•å®ç°\n","permalink":"http://yangchnet.github.io/Dessert/posts/golang/runtime%E7%AF%87%E4%B8%80%E6%8E%A5%E5%8F%A3/","summary":"æœ¬ç³»åˆ—ä»£ç åŸºäºgolang1.19\n  runtimeç¯‡ä¸€ï¼šæ¥å£ runtimeç¯‡äºŒï¼šé€šé“ runtimeç¯‡ä¸‰ï¼šdefer runtimeç¯‡å››ï¼španic runtimeç¯‡äº”ï¼šslice  1. æ¥å£çš„å†…éƒ¨ç»“æ„ type iface struct { tab *itab data unsafe.Pointer } ä¸€ä¸ªæ¥å£æ˜¯ä¸€ä¸ªifaceç»“æ„ä½“ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªitabæŒ‡é’ˆå’Œä¸€ä¸ªunsafe.Pointerã€‚\næ¦‚å¿µä¸Šè®²ä¸€ä¸ªæ¥å£çš„å€¼,æ¥å£å€¼,ç”±ä¸¤ä¸ªéƒ¨åˆ†ç»„æˆ,ä¸€ä¸ªå…·ä½“çš„ç±»å‹å’Œé‚£ä¸ªç±»å‹çš„å€¼ã€‚å®ƒä»¬è¢«ç§°ä¸ºæ¥å£çš„åŠ¨æ€ç±»å‹å’ŒåŠ¨æ€å€¼ã€‚\nä¸€ä¸ªitabå¯ä»¥è¡¨ç¤ºä¸€ä¸ªæ¥å£çš„ç±»å‹å’Œèµ‹ç»™è¿™ä¸ªæ¥å£çš„å®ä½“ç±»å‹ï¼Œå³ä¸ºæ¥å£çš„åŠ¨æ€ç±»å‹ï¼Œè€Œdataæ‰€æŒ‡å‘çš„unsafe.Pointeråˆ™æŒ‡å‘æ¥å£çš„åŠ¨æ€å€¼ã€‚\nè¿‘è·ç¦»æ¥çœ‹itabï¼š\ntype itab struct { inter *interfacetype _type *_type hash uint32 // copy of _type.hash. Used for type switches. \t_ [4]byte fun [1]uintptr // variable sized. fun[0]==0 means _type does not implement inter. } å…¶ä¸­interå­—æ®µæè¿°äº†æ¥å£çš„ç±»å‹ï¼Œ_typeå­—æ®µæè¿°äº†å®ä½“ç±»å‹ï¼Œhashå­—æ®µæ˜¯ç±»å‹å“ˆå¸Œï¼Œç”¨äºç±»å‹åŒ¹é…ï¼Œfunå­—æ®µæ”¾ç½®å’Œæ¥å£æ–¹æ³•å¯¹åº”çš„å…·ä½“æ•°æ®ç±»å‹çš„æ–¹æ³•åœ°å€ã€‚\nå†æ¥çœ‹interfacetype\ntype interfacetype struct { typ _type pkgpath name mhdr []imethod } å…¶ä¸­typå’Œitabä¸­çš„_typeä¸ºåŒä¸€ä¸ªå€¼ï¼Œpkgpathåˆ™å­˜å‚¨äº†æ¥å£çš„åŒ…åï¼Œmhdråˆ™è¡¨ç¤ºæ¥å£æ‰€å®šä¹‰çš„å‡½æ•°åˆ—è¡¨ã€‚","title":"runtimeç¯‡ä¸€ï¼šæ¥å£"},{"content":"1. TLSåœ¨å“ªäº›åœ°æ–¹è¢«ä½¿ç”¨ TLS(Transport Layer Security),æ˜¯ä¸ºè®¡ç®—æœºç½‘ç»œä¸­æä¾›å®‰å…¨é€šä¿¡çš„å¯†ç å­¦åè®®ã€‚\n HTTPS = HTTP +ã€€TLS SMTPS = SMTPS + TLS FTPS = FTP + TLS \u0026hellip;  2. TLSç»™æˆ‘ä»¬å¸¦æ¥äº†ä»€ä¹ˆ  è®¤è¯  TLSæ£€æŸ¥é€šä¿¡åŒæ–¹çš„èº«ä»½ å€ŸåŠ©äºéå¯¹ç§°åŠ å¯†ï¼ŒTLSä¿è¯æˆ‘ä»¬è®¿é—®çš„æ˜¯â€œçœŸç½‘ç«™â€ï¼Œä¸æ˜¯å‡å†’çš„ã€‚   åŠ å¯†  TLS é€šè¿‡ä½¿ç”¨å¯¹ç§°åŠ å¯†ç®—æ³•å¯¹å…¶è¿›è¡ŒåŠ å¯†æ¥ä¿æŠ¤äº¤æ¢çš„æ•°æ®å…å—æœªç»æˆæƒçš„è®¿é—®ã€‚   æ ¡éªŒ  TLS é€šè¿‡æ£€æŸ¥æ¶ˆæ¯éªŒè¯ç æ¥è¯†åˆ«ä¼ è¾“è¿‡ç¨‹ä¸­çš„ä»»ä½•æ•°æ®æ›´æ”¹    3. TLSé€šä¿¡çš„å·¥ä½œçš„åŸºæœ¬æµç¨‹ é€šå¸¸ï¼ŒTLSåŒ…å«2ä¸ªè¿‡ç¨‹ï¼Œæˆ–è€…è¯´2ä¸ªåè®®ã€‚\n Handshake Protocol åœ¨è¿™ä¸ªé˜¶æ®µï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ï¼š  åå•†åè®®ç‰ˆæœ¬ é€‰æ‹©åŠ å¯†ç®—æ³• é€šè¿‡éå¯¹ç§°åŠ å¯†ç®—æ³•éªŒè¯å¯¹æ–¹èº«ä»½å‘¢ å»ºç«‹ä¸€ä¸ªå…±äº«çš„å¯¹ç§°åŠ å¯†å¯†é’¥ä»¥åº”ç”¨äºæ¥ä¸‹æ¥çš„é€šä¿¡   Record Protocol åœ¨è¿™ä¸ªé˜¶æ®µï¼š  æ‰€æœ‰å‘å‡ºçš„ä¿¡æ¯éƒ½è¢«ä¸Šä¸ªé˜¶æ®µå•†å®šçš„å¯¹ç§°å¯†é’¥åŠ å¯† ä¿¡æ¯è¢«å‘é€åˆ°å¯¹é¢ æ¥æ”¶æ–¹éªŒè¯ä¿¡æ¯æ˜¯å¦å—åˆ°ç¯¡æ”¹ å¦‚æœæœªè¢«ç¯¡æ”¹ï¼Œä¿¡æ¯å°†è¢«è§£å¯†    4. ä¸ºä»€ä¹ˆTLSè¦åŒæ—¶ä½¿ç”¨å¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯† å¾ˆæ˜æ˜¾ï¼Œå¯¹ç§°åŠ å¯†ä¸èƒ½ä¿è¯é€šä¿¡çš„å®‰å…¨æ€§ï¼Œé€šä¿¡åŒæ–¹å…±äº«åŒä¸€ä¸ªå¯†é’¥ï¼Œä»–ä»¬æ²¡æ³•è¿›è¡Œå½¼æ­¤éªŒè¯ï¼Œå¹¶ä¸”å¾ˆéš¾ä¿è¯å¯†é’¥ä¸è¢«æ³„éœ²ã€‚\né‚£ä¹ˆä¸ºä»€ä¹ˆä¸éƒ½ä½¿ç”¨éå¯¹ç§°åŠ å¯†ï¼Ÿéå¯¹ç§°åŠ å¯†è¿œè¿œæ…¢äºå¯¹ç§°åŠ å¯†ï¼Œå¤§æ¦‚æ˜¯100ï½10000é‡çº§ï¼Œå› æ­¤ï¼Œåªä½¿ç”¨éå¯¹ç§°åŠ å¯†ä¹Ÿæ˜¯ä¸å¯å–çš„ã€‚\n5. å¯¹ç§°åŠ å¯† å¯¹ç§°åŠ å¯†çš„æµç¨‹å¤§æ¦‚æ˜¯è¿™æ ·ï¼š\nAliceæœ‰ä¸€ä¸ªæ–‡æœ¬æƒ³è¦å‘é€ç»™Bobï¼Œä½†ä¸æƒ³ä»»ä½•å…¶ä»–äººè¯»å–åˆ°å®ƒã€‚\nå› æ­¤å¥¹ä½¿ç”¨ä¹‹å‰å·²ç»å…±äº«è¿‡çš„å¯†é’¥å¯¹æ–‡æœ¬è¿›è¡ŒåŠ å¯†ï¼Œç„¶åå¥¹é€šè¿‡å…¬å…±äº’è”ç½‘å°†åŠ å¯†æ–‡æœ¬å‘é€ç»™Bob\næ¥æ”¶åˆ°åŠ å¯†æ–‡æœ¬åï¼ŒBobä½¿ç”¨ç›¸åŒçš„å¯†é’¥è§£å¯†ã€‚\nåŠ å¯†å’Œè§£å¯†ä½¿ç”¨çš„æ˜¯ç›¸åŒçš„å¯†é’¥ï¼Œå­˜åœ¨æŸç§æ„ä¹‰ä¸Šçš„â€œå¯¹ç§°â€ï¼Œå› æ­¤æˆ‘ä»¬ç§°ä¸ºâ€œå¯¹æˆåŠ å¯†â€\nç°åœ¨æœ‰ä¸€ä¸ªé»‘å®¢Harryï¼Œä»–å¯ä»¥ä»ç½‘ç»œä¸­æˆªå–åˆ°Aliceå’ŒBobä¹‹é—´çš„é€šä¿¡ä¿¡æ¯ã€‚é€šä¿¡ä¿¡æ¯æ˜¯åŠ å¯†çš„ï¼ŒHarryæ²¡æ³•è¯»å–å®ƒã€‚\nä½†ï¼ŒHarryå¯ä»¥å¯¹å…¶è¿›è¡Œæ›´æ”¹ï¼\n5.1 ä½ç¿»è½¬æ”»å‡» Bit-flipping attack ä½ç¿»è½¬æ”»å‡»çš„å·¥ä½œæ–¹å¼ç±»ä¼¼å¦‚ä¸‹æ‰€è¿°ï¼š\nAliceå‘é€æ¶ˆæ¯åˆ°é“¶è¡Œï¼Œæƒ³è¦è½¬è´¦çµ¦æŸäºº100å…ƒï¼Œè¿™ä¸ªæ¶ˆæ¯è¢«å¯†é’¥åŠ å¯†åé€šè¿‡ç½‘ç»œå‘é€ç»™é“¶è¡Œã€‚\nHarryæ•è·äº†åŠ å¯†ä¿¡æ¯ï¼Œä»–ä¸èƒ½è¿›è¡Œè§£å¯†ï¼Œä½†ä»–å¯ä»¥ç¿»è½¬å…¶ä¸­çš„æŸäº›ä½ï¼Œç„¶åå†å°†ä¿®æ”¹è¿‡çš„ä¿¡æ¯å‘é€ç»™é“¶è¡Œã€‚\nè¿™æ ·é“¶è¡Œåœ¨è§£å¯†æ¶ˆæ¯åï¼Œå¾—åˆ°çš„æ˜¯ä¸åŸæ¥ä¸åŒçš„æ¶ˆæ¯å†…å®¹ï¼Œè½¬è´¦100å…ƒå˜æˆäº†è½¬è´¦900å…ƒã€‚\næ˜¾ç„¶è¿™éå¸¸å±é™©ï¼Œæˆ‘ä»¬éœ€è¦æŸç§æ–¹æ³•æ¥ç¡®ä¿æ¶ˆæ¯åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ²¡æœ‰è¢«æ”¹å˜ã€‚\n5.2 åŠ å¯†è®¤è¯ Authenticated Encryption (AE) ä¸€ç§æ£€æŸ¥æ¶ˆæ¯æœªè¢«ç¯¡æ”¹çš„æ–¹å¼æ˜¯ä½¿ç”¨åŠ å¯†è®¤è¯ã€‚è¿™ç§æ–¹å¼å¹¶ä¸æ˜¯ç®€å•çš„åŠ å¯†ï¼Œè€Œæ˜¯éœ€è¦å¯¹æ¶ˆæ¯è¿›è¡Œè®¤è¯ã€‚\nç¬¬ä¸€æ­¥æ˜¯åŠ å¯†ã€‚\nAliceçš„æºæ–‡æœ¬é€šè¿‡ä¸€ä¸ªå¯¹ç§°åŠ å¯†ç®—æ³•è¢«åŠ å¯†ï¼Œå¦‚AES-256-GCMæˆ–CHACHA20.\nè¿™ä¸ªåŠ å¯†ç®—æ³•éœ€è¦ä¸€ä¸ªå…±äº«çš„å¯†é’¥å’Œä¸€ä¸ªéšæœºå€¼ï¼ˆnonceï¼‰ï¼Œæˆ–æ˜¯ä¸€ä¸ªåˆå§‹åŒ–å‘é‡initialization vector (IV)ä½œä¸ºè¾“å…¥ï¼Œè¿”å›åŠ å¯†æ¶ˆæ¯ã€‚\nç¬¬äºŒæ­¥æ˜¯è®¤è¯ã€‚\nåŠ å¯†æ¶ˆæ¯ã€å¯†é’¥ã€éšæœºnonceå€¼ä½œä¸ºMACç®—æ³•çš„è¾“å…¥ï¼Œä¾‹å¦‚ï¼Œå¦‚æœä½ ç”¨çš„æ˜¯AES-256-GCMå¯ä»¥ä½¿ç”¨GMACï¼Œå¦‚æœç”¨çš„æ˜¯CHACHA20å¯ä»¥ä½¿ç”¨POLY1305.\nè¿™äº›MACç®—æ³•ç±»ä¼¼ä¸€ä¸ªhashåŠ å¯†å‡½æ•°ï¼Œå…¶è¾“å‡ºä¸ºä¸€ä¸ªMACï¼Œmessage authentication code.\nè¿™ä¸ªMACå€¼å°†è¢«æ ‡è®°åˆ°åŠ å¯†æ¶ˆæ¯ä¸Šï¼Œç„¶åæ•´ä¸ªæ¶ˆæ¯å°†è¢«å‘é€åˆ°Bobã€‚å› æ­¤ï¼Œæˆ‘ä»¬æœ‰æ—¶ç§°è¿™ä¸ªMACä¸ºè®¤è¯æ ‡ç­¾ï¼ˆauthentication tagï¼‰ã€‚\næ·»åŠ é™„åŠ æ•°æ®ï¼ˆAssociated Data (AD)ï¼‰\nåœ¨TLS1.3ç‰ˆæœ¬ä¸­ï¼Œé™¤äº†åŠ å¯†æ¶ˆæ¯ï¼Œæˆ‘ä»¬è¿˜å¸Œæœ›è®¤è¯ä¸€äº›é¢å¤–çš„æ•°æ®ï¼Œæ¯”å¦‚åœ°å€ã€ç«¯å£ã€åè®®ç‰ˆæœ¬ï¼Œæˆ–æ˜¯åºåˆ—å·ã€‚è¯¥ä¿¡æ¯æ˜¯æœªåŠ å¯†çš„ï¼Œé€šä¿¡åŒæ–¹éƒ½çŸ¥é“\nå› æ­¤ADåŒæ ·æ˜¯MACç®—æ³•çš„æ•°æ®ï¼Œæ­£å› å¦‚æ­¤ï¼Œæ•´ä¸ªè¿‡ç¨‹è¢«ç§°ä¸ºAuthenticated Encryption with Associated Dataï¼Œç®€å†™ä¸ºAEAD.\nè§£å¯†å’ŒMACéªŒè¯\nç°åœ¨æ¥çœ‹Bobå¦‚ä½•æ£€æŸ¥åŠ å¯†æ¶ˆæ¯æ˜¯å¦è¢«ç¯¡æ”¹ã€‚\nè¿™æ˜¯ä¸€ä¸ªç®€å•çš„é€†è¿‡ç¨‹ï¼Œé¦–å…ˆæˆ‘ä»¬å°†æ ‡ç­¾ä»åŠ å¯†æ¶ˆæ¯ä¸­å–ä¸‹ã€‚\nç„¶ååŠ å¯†æ¶ˆæ¯å°†å’Œå¯†é’¥ï¼Œnonceä¸€èµ·è¢«å†æ¬¡è¾“å…¥åˆ°MACç®—æ³•ä¸­ï¼Œè¿™é‡Œæ³¨æ„éœ€è¦ä½¿ç”¨ä¸Aliceç›¸åŒçš„nonceå€¼ã€‚é€šå¸¸åœ¨å‘é€ç»™æ¥æ”¶è€…ä¹‹å‰ï¼Œéšæœºæ•°è¢«å¡«å……åˆ°åŠ å¯†æ¶ˆæ¯ä¸­ã€‚\né™„åŠ æ¶ˆæ¯ï¼ˆADï¼‰åŒæ ·è¢«æ·»åŠ åˆ°MACç®—æ³•ä¸­ï¼ŒMACç®—æ³•è¾“å‡ºå¦ä¸€ä¸ªhashå€¼ã€‚\nç„¶åBobå¯ä»¥ç®€å•çš„å¯¹æ¯”ä¸¤ä¸ªMACå€¼ï¼Œå¦‚æœæ˜¯ç›¸åŒçš„ï¼Œä»£è¡¨æ¶ˆæ¯æœªè¢«ç¯¡æ”¹ï¼Œä»–å¯ä»¥å®‰å¿ƒçš„è§£å¯†æ¶ˆæ¯å¹¶å¤„ç†ï¼Œå¦åˆ™æ¶ˆæ¯æ˜¯è¢«ç¯¡æ”¹è¿‡çš„ï¼Œåº”äºˆä»¥ä¸¢å¼ƒã€‚\n5.3 äº¤æ¢å¯†é’¥ ä¸Šé¢æè¿°çš„è¿‡ç¨‹å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šAliceå’ŒBobå¦‚ä½•åœ¨ä¸å°†å¯†é’¥æ³„éœ²çš„æƒ…å†µä¸‹å…±äº«åŒä¸€ä¸ªå¯†é’¥ã€‚\nç­”æ¡ˆæ˜¯ï¼šä»–ä»¬éœ€è¦ä½¿ç”¨éå¯¹ç§°åŠ å¯†æŠ€æœ¯æˆ–å…¬é’¥åŠ å¯†æ¥è¾¾åˆ°è¿™ä¸ªç›®çš„ã€‚ä¾‹å¦‚Diffie-Hellman Ephemeral,Elliptic-Curve Diffie-Hellman Ephemeral.\n5.3.1 Diffie-Hellman å¯†é’¥äº¤æ¢ é¦–å…ˆï¼ŒAliceå’ŒBobåå•†ç¡®è®¤ä¸¤ä¸ªæ•°å­—ï¼šåŸºæ•°gï¼Œå’Œæ¨¡æ•°pã€‚è¿™ä¸¤ä¸ªæ•°å­—æ˜¯ä¼—æ‰€å‘¨çŸ¥çš„ï¼ˆä»»ä½•äººéƒ½å¯ä»¥çŸ¥é“ï¼‰ã€‚\nç„¶åä»–ä»¬éƒ½ä¸ºè‡ªå·±é€‰æ‹©ä¸€ä¸ªç§æœ‰çš„æ•°å­—ï¼Œä¾‹å¦‚Aliceæ˜¯a,Bobæ˜¯b.\nç„¶åAliceè®¡ç®—å‡ºå¥¹çš„å…¬é’¥å¹¶å°†å…¶å‘é€ç»™Bobã€‚\nA = (g^a) mod p åŒæ ·çš„ï¼ŒBobè®¡ç®—ä»–çš„å…¬é’¥å¹¶å‘é€ç»™Alice\nB = (g^b) mod p Aliceæ”¶åˆ°äº†Bobçš„å…¬é’¥Bï¼ŒBobæ”¶åˆ°äº†Aliceçš„å…¬é’¥Aã€‚\né‡ç‚¹æ¥äº†ï¼\nAliceè¿›è¡Œå¦‚ä¸‹è®¡ç®—ï¼š\nS = (B^a) mod p Bobè¿›è¡Œå¦‚ä¸‹è®¡ç®—ï¼š\nS = (A^b) mod p ä»–ä»¬å¾—åˆ°äº†åŒæ ·çš„æ•°å­—S.\nè¯æ˜å¦‚ä¸‹ï¼š\n(B^a) mod p = (g^b)^a mod p = ( g^(b*a) ) mod p (A^b) mod p = (g^a)^b mod p = ( g^(a*b) ) mod p å› æ­¤Aliceå’ŒBobåœ¨ä¸æ³„éœ²å¯†é’¥çš„æƒ…å†µä¸‹æ‹¥æœ‰äº†åŒæ ·çš„å¯†é’¥S.\n5.3.2 å¯†é’¥å¯¼å‡ºå‡½æ•° Key Derivation Function - KDF ä¸åŒçš„åŠ å¯†ç®—æ³•å¯èƒ½éœ€è¦ä¸åŒé•¿åº¦çš„å¯†é’¥ï¼Œå› æ­¤è¦æƒ³è·å–å¯†é’¥ï¼ŒAliceå’ŒBobå¿…é¡»å°†Sè¾“å…¥ç›¸åŒçš„å¯†é’¥å¯¼å‡ºå‡½æ•°KDFï¼Œç„¶åè¾“å‡ºå°†æ˜¯æ‰€éœ€é•¿åº¦çš„å…±äº«å¯†é’¥ã€‚\nåœ¨TLS1.3ä¸­ï¼Œä½¿ç”¨åŸºäºHMACçš„å¯†é’¥å¯¼å‡ºå‡½æ•°ï¼Œç§°ä¸ºHKDF\né€šå¸¸ï¼ŒKDFéœ€è¦ä»¥ä¸‹è¾“å…¥ï¼š\n input key material (IKM),è¿™é‡ŒIKMä¸ºS æ‰€éœ€å¯†é’¥é•¿åº¦ ä¸€ä¸ªåŠ å¯†hashå‡½æ•°ï¼Œä¾‹å¦‚HMAC-SHA256 å¯é€‰çš„ä¸€äº›ä¿¡æ¯ å¯é€‰çš„ç›å€¼  5.3.3 é™·é—¨å‡½æ•° Trapdoor function ç°åœ¨è®©æˆ‘ä»¬å›åˆ°Diffie-Hellmanå¯†é’¥äº¤æ¢\næˆ‘ä»¬çŸ¥é“p, g, A, Bæ˜¯ä¼—æ‰€å‘¨çŸ¥çš„ï¼Œå› æ­¤Harryï¼ŒåŒæ ·å¯ä»¥è®¿é—®è¿™äº›æ•°å­—ã€‚\næˆ‘ä»¬å¯èƒ½ä¼šé—®ï¼šè¿™ç§å¯†é’¥åˆ†äº«æœºåˆ¶å®‰å…¨å—ï¼Ÿç»™å®šp, g, A, Bï¼ŒHarryæ˜¯å¦å¯ä»¥è®¡ç®—å‡ºa, b, S\nå¹¸è¿çš„æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬é€‰å®šè¾ƒå¥½çš„p, g, a, bï¼Œè¿™äº›å‡½æ•°å°†æˆä¸ºé™·é—¨å‡½æ•°ã€‚\nä¾‹å¦‚ï¼š\n é€‰æ‹©ä¸€ä¸ª2048ä½çš„ç´ æ•°ä¸ºp é€‰æ‹© g ä½œä¸ºåŸæ ¹æ¨¡ p é€‰æ‹©256ä½çš„éšæœºå€¼ä½œä¸ºaï¼Œb  é™·é—¨å‡½æ•°çš„åå­—æ¥æºäºå…¶å¯è½»æ˜“çš„ä»ä¸€ä¸ªæ–¹å‘è®¡ç®—å‡ºæ¥ï¼Œä½†ä»å¦ä¸€ä¸ªæ–¹å‘å¾ˆéš¾è®¡ç®—ã€‚å°±åƒé™·é˜±ï¼Œè¿›å»å¾ˆå®¹æ˜“ï¼Œä½†å‡ºæ¥å¾ˆå›°éš¾ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼š\n ç»™å®šp, g, aï¼Œå¾ˆå®¹æ˜“è®¡ç®—å‡ºA ä½†ç»™å®šp, g, Aï¼Œå¾ˆéš¾è®¡ç®—å‡ºa  æˆ‘ä»¬å¯ä»¥ä»¥O(log(a))çš„æ—¶é—´å¤æ‚åº¦è®¡ç®—å‡ºAï¼Œè¿™æ˜¯ä¼—æ‰€å‘¨çŸ¥çš„ Modular exponentiation problem\nä½†è®¡ç®—å‡ºaéå¸¸å›°éš¾ï¼Œè¿™æ˜¯ä¸€ä¸ªç¦»æ•£å¯¹æ•°é—®é¢˜ï¼Œåœ¨ç°æœ‰çš„è®¡ç®—èƒ½åŠ›ä¸‹éœ€è¦å¾ˆé•¿æ—¶é—´æ‰èƒ½è®¡ç®—å‡ºã€‚\nå› æ­¤æˆ‘ä»¬è‡³å°‘ç›®å‰æ˜¯å®‰å…¨çš„ï¼Œæˆ–åœ¨ä¸‹ä¸€ä»£é‡å­è®¡ç®—æœºåˆ°æ¥ä¹‹å‰ã€‚\nä½†ç›®å‰æ¥çœ‹ï¼Œä¸€ä¸ªå¾ˆé•¿æ—¶é—´æ‰èƒ½è§£å†³çš„é—®é¢˜ï¼Œæ„å‘³ç€æ— è§£ã€‚\n5.3.4 é™æ€æˆ–ä¸´æ—¶å¯†é’¥ï¼Ÿ å¦‚æœAliceå’ŒBobçš„æ¯æ¬¡é€šä¿¡éƒ½ä½¿ç”¨ç›¸åŒçš„å¯†é’¥aå’Œb,è¿™æ ·Harryå°±å¯ä»¥ä»ä»–ä»¬ç¬¬ä¸€æ¬¡ä¼šè¯å°±å¼€å§‹è®¡ç®—a.\nè™½ç„¶è®¡ç®—éœ€è¦èŠ±è´¹å¾ˆé•¿æ—¶é—´ï¼Œä½†ç»è¿‡Næ¬¡ä¼šè¯ï¼ŒHarryå¯èƒ½ä¼šå¾—åˆ°æ­£ç¡®çš„aã€‚é‚£ä¹ˆä»–å°±å¯ä»¥è®¡ç®—å‡ºæ­£ç¡®çš„å¯†é’¥Aï¼Œå› æ­¤ä»–å¯ä»¥è§£å¯†æ‰€æœ‰ä»–è®°å½•çš„ä¿¡æ¯ã€‚\nå¦‚ä½•è§£å†³ï¼Ÿ\nç­”æ¡ˆæ˜¯ä½¿ç”¨ä¸´æ—¶å¯†é’¥ï¼Œåœ¨æ¯æ¬¡ä¼šè¯ä¸­ä½¿ç”¨ä¸åŒçš„å¯†é’¥ã€‚è¿™æ ·åŠæ—¶Harryå·²ç»è®¡ç®—å‡ºç¬¬ä¸€æ¬¡ä¼šè¯çš„å¯†é’¥aï¼Œä½†ä»–ä¾ç„¶ä¸èƒ½å°†å…¶ç”¨äºå…¶ä»–ä¼šè¯ã€‚\nè¿™åœ¨TLSä¸­è¢«ç§°ä¸ºå®Œç¾å‰å‘ä¿å¯†\nç°åœ¨æˆ‘ä»¬å¯ä»¥ç†è§£ä»€ä¹ˆæ˜¯Diffie-Hellman Ephemeralï¼Œåªæ˜¯Diffie-Hellmanç®—æ³•åŠ ä¸Šä¸´æ—¶ï¼ŒçŸ­æœŸæœ‰æ•ˆçš„keyã€‚\n6. æ¤­åœ†æ›²çº¿å¯†ç å­¦ æ¤­åœ†æ›²çº¿å¯†ç å­¦ï¼ˆæˆ– ECCï¼‰æ˜¯ä¸€ç§éå¯¹ç§°å¯†ç å­¦æ–¹æ³•ï¼Œå…¶ç®—æ³•ç›¸ä¼¼ï¼Œä½†ä½¿ç”¨äº†ä¸åŒçš„é™·é—¨å‡½æ•°ã€‚\nè¯¥é™·é—¨å‡½æ•°åŸºäºæ¤­åœ†æ›²çº¿çš„ä»£æ•°ç»“æ„ã€‚è¿™å°±æ˜¯è¿™ä¸ªåå­—çš„åŸå› ã€‚\næ¤­åœ†æ›²çº¿å¯†ç å­¦çš„ä¸€ä¸ªé‡ç‚¹æ˜¯ï¼šå®ƒå¯ä»¥æ›´å°çš„å¯†é’¥æä¾›ç›¸åŒçš„å®‰å…¨ç­‰çº§ã€‚åœ¨ä¸RSAçš„æ¯”è¾ƒä¸­ç»å¸¸å¯ä»¥çœ‹åˆ°å®ƒã€‚\nç¾å›½å›½å®¶å®‰å…¨å±€ (NSA) è¿‡å»ä½¿ç”¨ ECC 384 ä½å¯†é’¥ä¿æŠ¤å…¶æœ€é«˜æœºå¯†ï¼Œè¯¥å¯†é’¥æä¾›ä¸ RSA-7680 ä½å¯†é’¥ç›¸åŒçš„å®‰å…¨çº§åˆ«ã€‚\nç„¶è€Œï¼Œæ¤­åœ†æ›²çº¿å¯†ç å­¦æ›´å®¹æ˜“æˆä¸ºé‡å­è®¡ç®—æ”»å‡»çš„ç›®æ ‡ã€‚ä¸ç ´è§£ RSA ç›¸æ¯”ï¼ŒShor çš„ç®—æ³•å¯ä»¥åœ¨å…·æœ‰æ›´å°‘é‡å­èµ„æºçš„å‡è®¾é‡å­è®¡ç®—æœºä¸Šç ´è§£ ECCã€‚\n7. éå¯¹ç§°åŠ å¯† ç°åœ¨è®©æˆ‘ä»¬å›åˆ°éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œè¿™ç§ä»¤äººæƒŠå¹çš„æŠ€æœ¯å¾—åˆ°äº†éå¸¸å¹¿æ³›çš„åº”ç”¨ã€‚\næˆ‘ä»¬å·²ç»ä½¿ç”¨Diffie-Hellman Ephemeral å’Œ Elliptic-Curve Diffie-Hellman Ephemeral è§£é‡Šäº†å…¶ä¸­ä¸€ä¸ªåº”ç”¨ï¼šå¯¹ç§°å¯†é’¥çš„äº¤æ¢ï¼Œ\näº‹å®ä¸Šï¼ŒRSAç®—æ³•åœ¨è¿‡å»ä¹Ÿè¢«ç”¨äºå¯†é’¥äº¤æ¢ï¼Œä½†ä»TLS1.3èµ·ç”±äºå„ç§æ”»å‡»å’Œä¸å…·æœ‰å‰å‘ä¿å¯†èƒ½åŠ›å…¶å·²è¢«ç§»é™¤ï¼Œ\néå¯¹ç§°åŠ å¯†è¿˜è¢«ç”¨äºä¿å¯†ç³»ç»Ÿã€‚ä¸‹é¢æ˜¯ä¸€äº›éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼š\n RSA with optimal asymmetric encryption padding (RSA-OAEP). RSA with public key cryptography standard 1 (RSA-PKCS1) with the latest version 2.2 Elgamal Encryption algorithm  æœ€åï¼Œéå¯¹ç§°åŠ å¯†çš„ä¸€ä¸ªé‡è¦ç‰¹æ€§å°±æ˜¯æ•°å­—ç­¾åï¼ŒTLSè¢«å¹¿æ³›ç”¨äºèº«ä»½éªŒè¯ã€‚\nä¸€äº›åœ¨TLSä½¿ç”¨çš„æµè¡Œçš„æ•°å­—ç­¾åç®—æ³•æœ‰ï¼š\n RSA with Probabilitic Signature Scheme. Elliptic-Curve Digital Signature Algorithm. Edwards-Curve Digital Signature Algorithm.  ä¸‹é¢æˆ‘ä»¬ä¼šä»‹ç»æ•°å­—è¯ä¹¦ï¼Œä½†å…ˆè®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹éå¯¹ç§°åŠ å¯†ç³»ç»Ÿæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚\n7.1 éå¯¹ç§°åŠ å¯† ç±»ä¼¼å¯¹ç§°åŠ å¯†ï¼ŒAliceæœ‰ä¸€ä¸ªæºæ–‡æœ¬éœ€è¦å‘é€ç»™Bobã€‚\nä½†è¿™æ¬¡ï¼Œä»–ä»¬ä¹‹é—´æ²¡æœ‰å…±äº«çš„å¯†é’¥ã€‚Aliceä½¿ç”¨Bobçš„å…¬é’¥åŠ å¯†æ¶ˆæ¯ï¼Œå¹¶å‘é€å¯†æ–‡çµ¦Bobã€‚\nBobå—åˆ°å¯†æ–‡åï¼Œç”¨ä»–çš„ç§é’¥è§£å¯†å¯†æ–‡ã€‚\nè™½ç„¶å…¬é’¥å’Œç§é’¥å®Œå…¨ä¸åŒï¼Œä½†ä»–ä»¬ä¹‹é—´ä»å­˜åœ¨æŸäº›é™·é—¨å‡½æ•°çš„è”ç³»ï¼Œå°±åƒæˆ‘ä»¬ä¹‹å‰åœ¨Diffie-Hellmanä¸­çœ‹åˆ°çš„é‚£æ ·ã€‚\nè¿™ä¸ªæœºåˆ¶è¿™æ ·è¿è¡Œï¼šå¯†é’¥æˆå¯¹å‡ºç°ï¼Œåªæœ‰å¯†é’¥å¯¹ä¸­çš„ç§é’¥å¯ä»¥è§£å¯†è¢«å…¬é’¥åŠ å¯†çš„å¯†æ–‡ã€‚\nå› æ­¤ï¼Œå³ä½¿Harryå…·æœ‰Aliceå‘é€çš„å¯†æ–‡å’ŒBobçš„å…¬é’¥ï¼Œä»–ä¾ç„¶æ— æ³•è§£å¯†æ¶ˆæ¯ã€‚\n7.2 å…¬é’¥å…±äº« å…¬é’¥å…±äº«éå¸¸ç®€å•ï¼ŒBobç›´æ¥é€šè¿‡å…¬å…±ç½‘ç»œå‘é€ä»–çš„å…¬é’¥ç»™Aliceè€Œä¸ç”¨æ‹…å¿ƒå¯†é’¥å¯ä»¥è§£å¯†ä»»ä½•æ¶ˆæ¯ã€‚\nè¿™ä¸ªå¯†é’¥æ˜¯å…¬å¼€çš„ï¼Œå› æ­¤ä»»ä½•äººéƒ½å¯ä»¥ç”¨å®ƒè¿›è¡ŒåŠ å¯†æ¶ˆæ¯ï¼Œä½†åªæœ‰Bobå¯ä»¥è¯»å–åŠ å¯†æ¶ˆæ¯ï¼Œå³ä½¿ä»–ä»¬ä»æœªäº¤æµè¿‡ã€‚\n7.3 ä¸­é—´äººæ”»å‡» æˆ‘ä»¬å·²ç»çŸ¥é“Harryä¸èƒ½é€šè¿‡Bobçš„å…¬é’¥è§£å¯†æ¶ˆæ¯ï¼Œä½†ä»–ä¾ç„¶å¯ä»¥å½±å“å…¬é’¥äº¤æ¢ï¼Œä¾‹å¦‚ä½¿ç”¨è‡ªå·±çš„å…¬é’¥æ›¿æ¢Bobçš„å…¬é’¥ã€‚\nç°åœ¨å½“ALiceå—åˆ°å¯†é’¥ï¼Œå¥¹ä¾ç„¶è®¤ä¸ºè¿™ä¸ªBobçš„å…¬é’¥ï¼Œä½†äº‹å®ä¸Šæ˜¯Harryçš„ã€‚å› æ­¤å½“Aliceä½¿ç”¨è¯¥å…¬é’¥åŠ å¯†æ¶ˆæ¯ï¼ŒHarryå°±å¯ä»¥ç”¨ä»–çš„ç§é’¥è§£å¯†æ¶ˆæ¯ã€‚\nåŸå› åœ¨äºå¯†é’¥åªæ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå¹¶æ²¡æœ‰èº«ä»½æ ‡è¯†å…¶æ‰€æœ‰è€…ã€‚\né¢å¯¹è¿™ç§é—®é¢˜ï¼Œæˆ‘ä»¬è¯¥æ€ä¹ˆåšï¼Ÿæˆ‘ä»¬åº”è¯¥å°†èº«ä»½ä¿¡æ¯æ·»åŠ åˆ°å¯†é’¥ä¸­ï¼Œè¿™å°±æ˜¯æ•°å­—è¯ä¹¦çš„åšæ³•ã€‚\n7.4 æ•°å­—è¯ä¹¦ Bobå°†ä»–çš„å¯†é’¥åŠ å…¥åˆ°è¯ä¹¦ä¸­ï¼Œè¯ä¹¦ä¸­åŒ…å«ä»–çš„å§“åæˆ–å…¶ä»–èº«ä»½ä¿¡æ¯ã€‚æ•°å­—è¯ä¹¦å°±åƒç°å®ä¸–ç•Œçš„ç­¾è¯ã€‚\nå½“æˆ‘ä»¬æ€ä¹ˆç¡®è®¤Bobç¡®å®æ˜¯è¯ä¹¦çš„æ‰€æœ‰è€…ï¼Ÿå¦‚ä½•ç»„ç»‡Harryä¼ªé€ ä¸€ä¸ªå…·æœ‰Bobçš„èº«ä»½ä¿¡æ¯å´åŒ…å«Harryå¯†é’¥çš„è¯ä¹¦ã€‚\nå°±åƒç°å®ä¸–ç•Œï¼Œç­¾è¯å¿…é¡»ç”±æƒå¨æœºæ„åœ¨ä¸€ç³»åˆ—èº«ä»½è®¤è¯åç­¾å‘ï¼Œåœ¨æ•°å­—ä¸–ç•Œï¼Œæ•°å­—è¯ä¹¦ä¹Ÿå¿…é¡»ç”±æŸäº›è¯ä¹¦é¢å‘æœºæ„è®¤å¯å¹¶ç­¾å‘ã€‚\nè¿™äº›è¯ä¹¦é¢å‘ç»“æ„(certificat authority CA)å’Œç­¾è¯é¢å‘ç»“æ„è¢«ç¬¬ä¸‰æ–¹è®¤å¯ï¼Œä»–ä»¬å¸®åŠ©æˆ‘ä»¬é˜»æ­¢è¯ä¹¦è¢«ä¼ªé€ ã€‚\nè¯ä¹¦ç­¾å\nè¯ä¹¦ç­¾åè¿‡ç¨‹å¦‚ä¸‹ï¼š\n Bobå…·æœ‰ä¸€å¯¹å…¬ç§é’¥ ç¬¬ä¸€æ­¥ï¼Œä»–æ„é€ ä¸€ä¸ªè¯ä¹¦ç­¾åè¯·æ±‚ï¼ˆcertificat signing request CSRï¼‰ï¼Œè¿™ä¸ªCSRåŒ…å«ä»–çš„å…¬é’¥å’Œä¸€äº›èº«ä»½ä¿¡æ¯ï¼Œä¾‹å¦‚ä»–çš„å§“åï¼Œç»„ç»‡å’Œé‚®ç®±ã€‚ ç¬¬äºŒæ­¥ï¼Œä»–ä½¿ç”¨ä»–çš„ç§é’¥å¯¹CSRè¿›è¡Œç­¾åï¼Œå¹¶ä¸”å°†å…¶å‘é€ç»™CA CAå°†éªŒè¯Bobçš„èº«ä»½ï¼Œå…¶å¯è¦æ±‚Bobæä¾›æ›´å¤šè¯æ˜èº«ä»½çš„ä¿¡æ¯ã€‚ ç„¶åè¯ä¹¦é¢å‘æœºæ„ä½¿ç”¨è¯ä¹¦ä¸­Bobçš„å…¬é’¥æ ¡éªŒBobçš„ç­¾åï¼Œè¿™å°†ç¡®è®¤Bobç¡®å®æ‹¥æœ‰ä¸è¯ä¹¦ä¸­å…¬é’¥ç›¸å¯¹åº”çš„ç§é’¥ã€‚ è®¤è¯å…¨éƒ¨é€šè¿‡ï¼ŒCAå°†ä½¿ç”¨ä»–ä»¬çš„ç§é’¥å¯¹è¯ä¹¦è¿›è¡Œç­¾åï¼Œå¹¶å°†å…¶å‘é€å›Bob  è¯ä¹¦åˆ†äº«è¿‡ç¨‹ï¼š ç°åœ¨Bobå°†æŠŠä»–çš„è¯ä¹¦åˆ†äº«ç»™Aliceï¼Œå…¶ä¸­åŒ…å«ä»–çš„å…¬é’¥ï¼Œè€Œä¸å†æ˜¯åªå‘é€ä»–çš„å…¬é’¥\næ”¶åˆ°è¯ä¹¦åï¼ŒAliceå¯ä»¥å¾ˆå®¹æ˜“é€šè¿‡CAçš„å…¬é’¥æ¥éªŒè¯Bobçš„è¯ä¹¦ã€‚\nå› æ­¤ï¼ŒHarryä¸èƒ½å°†å…¶ä¸­Bobçš„å…¬é’¥æ¢æˆä»–çš„å…¬é’¥ï¼Œå› ä¸ºHarryå¹¶æ²¡æœ‰CAçš„ç§é’¥ç”¨äºé‡æ–°å¯¹ä¼ªé€ çš„è¯ä¹¦è¿›è¡Œç­¾åã€‚\nè¿™å…¶ä¸­çš„é‡ç‚¹åœ¨äºæˆ‘ä»¬éƒ½ä¿¡ä»»CAï¼Œå¦‚æœCAä¸å¯ä¿¡ï¼Œå°†å…¶ç§é’¥æ³„éœ²ç»™Harryï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†é¢ä¸´ä¸¥é‡çš„å®‰å…¨é—®é¢˜ã€‚\n7.5 CA-ä¿¡ä»»é“¾ äº‹å®ä¸Šï¼ŒCAå…·æœ‰é“¾å¼çš„ç»“æ„ã€‚\næœ€é«˜å±‚æ˜¯æ ¹CAï¼Œä»–ä»¬è‡ªå·±ç­¾å‘è‡ªå·±çš„è¯ä¹¦ï¼ŒåŒæ ·ç­¾å‘ä»–ä»¬å­æœºæ„çš„è¯ä¹¦ï¼Œä¹Ÿå°±æ˜¯ä¸­é—´CAã€‚\nä¸­é—´CAåˆå¯ä»¥ç­¾å‘å…¶ä»–ä¸­é—´CAçš„è¯ä¹¦ï¼Œæˆ–è€…ä»–ä»¬å¯ä»¥ç­¾å‘end-entity certificatï¼Œä¹Ÿå³å¶å­è¯ä¹¦ã€‚\næ¯ä¸ªè¯ä¹¦éƒ½å°†å¼•ç”¨ä»–ä»¬ä¸Šå±‚çš„è¯ä¹¦ï¼Œä¸€ç›´åˆ°rootã€‚\næ“ä½œç³»ç»Ÿå’Œæµè§ˆå™¨å­˜å‚¨äº†ä¸€ç³»åˆ—å·²è¢«ä¿¡ä»»çš„CAç»“æ„ï¼Œé€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯æœ‰æ•ˆçš„éªŒè¯æ‰€æœ‰è¯ä¹¦çš„çœŸå®æ€§ã€‚\n7.6 æ•°å­—è¯ä¹¦ ç°åœ¨æ¥çœ‹æ•°å­—è¯ä¹¦åˆ°åº•æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚\nè¦å¯¹ä¸€ä¸ªæ–‡æ¡£è¿›è¡Œç­¾åï¼š\n ç­¾åè€…é¦–å…ˆéœ€è¦å¯¹æ–‡æ¡£è¿›è¡Œhash ç„¶åhashå€¼å°†è¢«ç”¨ç­¾åè€…çš„ç§é’¥è¿›è¡ŒåŠ å¯† åŠ å¯†ç»“æœå«æ•°å­—ç­¾ådigital signature æ•°å­—ç­¾åå°†è¢«é™„åŠ åˆ°åŸå§‹æ–‡æ¡£ä¸­ã€‚  è¿™æ˜¯ç­¾åè¿‡ç¨‹ï¼Œé‚£ä¹ˆå¦‚ä½•éªŒè¯ç­¾åæ˜¯æ­£ç¡®çš„ã€‚\nåªéœ€åšä¸€ä¸ªåå‘æ“ä½œï¼š\n é¦–å…ˆå°†æ•°å­—ç­¾åä»æ–‡æ¡£ä¸­å–å‡º ä½¿ç”¨signerçš„å…¬é’¥è¿›è¡Œè§£å¯†å¾—åˆ°hashå€¼ ç„¶åä½¿ç”¨åŒæ ·çš„ç®—æ³•å¯¹åŸå§‹æ–‡æ¡£è¿›è¡Œhash å¯¹æ¯”ä¸¤ä¸ªhashå€¼ å¦‚æœç›¸åŒï¼Œåˆ™æ•°å­—ç­¾åæ­£ç¡®  8. TLS1.3 æ¡æ‰‹åè®® ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸Šé¢çš„è¿™äº›çŸ¥è¯†ï¼Œå¯ä»¥æ¥è¿‘è·ç¦»çœ‹çœ‹TLSæ¡æ‰‹åè®®ã€‚\n8.1 å®Œæ•´æ¡æ‰‹ TLS1.3 å®Œæ•´æ¡æ‰‹ä»ä¸€ä¸ªå®¢æˆ·ç«¯å‘é€ç»™æœåŠ¡ç«¯çš„helloæ¶ˆæ¯å¼€å§‹ã€‚äº‹å®ä¸Šè¿™ä¸ªæ¶ˆæ¯åŒ…å«å¾ˆå¤šä¿¡æ¯ï¼Œä½†è¿™é‡Œåªåˆ—ä¸¾ä¸€äº›è¾ƒä¸ºé‡è¦çš„ï¼š\n é¦–å…ˆæ˜¯å®¢æˆ·ç«¯æ”¯æŒçš„åè®®ç‰ˆæœ¬å· ç„¶åæ˜¯æ”¯æŒçš„ AEAD å¯¹ç§°å¯†ç å¥—ä»¶åˆ—è¡¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæœ‰ 2 ä¸ªé€‰é¡¹ï¼šAES-256-GCM æˆ– CHACHA20-POLY1305 æ¥ç€æ˜¯å—æ”¯æŒçš„å¯†é’¥äº¤æ¢ç»„åˆ—è¡¨ã€‚ä¾‹å¦‚ï¼Œæ­¤å®¢æˆ·ç«¯æ”¯æŒæœ‰é™åŸŸ Diffie-Hellman Ephemeral å’Œ Elliptic-Curve Diffie-Hellman Ephemeralã€‚ è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå®¢æˆ·ç«¯è¿˜å…±äº«å…¶ 2 ä¸ªå…¬é’¥ï¼Œ1 ä¸ªç”¨äº Diffie-Hellmanï¼Œå¦ä¸€ä¸ªç”¨äº Elliptic-Curve Diffie-Hellmanã€‚è¿™æ ·ï¼Œæ— è®ºé€‰æ‹©ä½•ç§ç®—æ³•ï¼ŒæœåŠ¡å™¨éƒ½èƒ½å¤Ÿè®¡ç®—å…±äº«å¯†é’¥ã€‚ å®¢æˆ·ç«¯åœ¨æ­¤æ¶ˆæ¯ä¸­å‘é€çš„æœ€åä¸€ä¸ªå­—æ®µæ˜¯å®ƒæ”¯æŒçš„ç­¾åç®—æ³•åˆ—è¡¨ã€‚è¿™æ˜¯ä¸ºäº†è®©æœåŠ¡å™¨é€‰æ‹©å®ƒåº”è¯¥ä½¿ç”¨å“ªç§ç®—æ³•æ¥ç­¾ç½²æ•´ä¸ªæ¡æ‰‹ã€‚æˆ‘ä»¬ç¨åä¼šçœ‹åˆ°å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚  æ”¶åˆ°å®¢æˆ·ç«¯çš„helloæ¶ˆæ¯åï¼ŒæœåŠ¡ç«¯åŒæ ·è¿”å›ä¸€ä¸ªhelloæ¶ˆæ¯ï¼Œå…¶ä¸­åŒ…å«ï¼š\n é€‰æ‹©çš„åè®®ç‰ˆæœ¬ï¼š TLS1.3 é€‰æ‹©çš„å¯†ç å¥—ä»¶ï¼šAES-256-GCM é€‰æ‹©çš„å¯†é’¥äº¤æ¢æ–¹æ³•ï¼šDiffie-Hellman Ephemeral æ‰€é€‰æ–¹æ³•çš„æœåŠ¡å™¨å…¬é’¥ ä¸‹ä¸€ä¸ªå­—æ®µæ˜¯å¯¹å®¢æˆ·ç«¯è¯ä¹¦çš„è¯·æ±‚ï¼Œå®ƒæ˜¯å¯é€‰çš„ï¼Œåªæœ‰åœ¨æœåŠ¡å™¨æƒ³è¦é€šè¿‡å…¶è¯ä¹¦å¯¹å®¢æˆ·ç«¯è¿›è¡Œèº«ä»½éªŒè¯æ—¶æ‰ä¼šå‘é€ã€‚ é€šå¸¸åœ¨ HTTPS ç½‘ç«™ä¸Šï¼Œåªæœ‰æœåŠ¡å™¨ç«¯éœ€è¦å°†å…¶è¯ä¹¦å‘é€ç»™å®¢æˆ·ç«¯ã€‚è¿™å°†åœ¨æ­¤æ¶ˆæ¯çš„ä¸‹ä¸€ä¸ªå­—æ®µä¸­å‘é€ã€‚    ä¸‹ä¸€ä¸ªå­—æ®µæ˜¯è¯ä¹¦éªŒè¯ï¼Œå®é™…ä¸Šæ˜¯åˆ°æ­¤ä¸ºæ­¢çš„æ•´ä¸ªæ¡æ‰‹çš„ç­¾åã€‚ ä»¥ä¸‹æ˜¯å®ƒçš„ç”Ÿæˆæ–¹å¼ï¼šä»æ¡æ‰‹å¼€å§‹åˆ°è¯ä¹¦è¯·æ±‚çš„æ•´ä¸ªæ•°æ®ç§°ä¸ºæ¡æ‰‹ä¸Šä¸‹æ–‡ã€‚ æˆ‘ä»¬å°†æ­¤ä¸Šä¸‹æ–‡ä¸æœåŠ¡å™¨çš„è¯ä¹¦è¿æ¥ï¼Œå¯¹å…¶è¿›è¡Œå“ˆå¸Œå¤„ç†ï¼Œå¹¶ä½¿ç”¨å®¢æˆ·ç«¯æ”¯æŒçš„ä¸€ç§ç­¾åç®—æ³•ä½¿ç”¨æœåŠ¡å™¨çš„ç§é’¥å¯¹å“ˆå¸Œå€¼è¿›è¡Œç­¾åã€‚\n  ä»¥ç±»ä¼¼çš„æ–¹å¼ï¼Œé€šè¿‡è¿æ¥æ¡æ‰‹ä¸Šä¸‹æ–‡ã€è¯ä¹¦å’Œè¯ä¹¦æ¥ç”ŸæˆæœåŠ¡å™¨å®Œæˆï¼ŒéªŒè¯ã€æ•£åˆ—å®ƒï¼Œå¹¶å°†æ•£åˆ—å€¼æ”¾å…¥æ‰€é€‰å¯†ç å¥—ä»¶çš„ MAC ç®—æ³•ã€‚ ç»“æœæ˜¯æ•´ä¸ªæ¡æ‰‹çš„ MACã€‚\n  æ­¤å¤„çš„æœåŠ¡å™¨è¯ä¹¦ã€è¯ä¹¦éªŒè¯å’ŒæœåŠ¡å™¨å®Œæˆç§°ä¸ºèº«ä»½éªŒè¯æ¶ˆæ¯ï¼Œå› ä¸ºå®ƒä»¬ç”¨äºå¯¹æœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯ã€‚ å€ŸåŠ©æ•´ä¸ªæ¡æ‰‹çš„ç­¾åå’Œ MACï¼ŒTLS 1.3 å¯ä»¥å®‰å…¨åœ°æŠµå¾¡å¤šç§ç±»å‹çš„ä¸­é—´äººé™çº§æ”»å‡»ã€‚\nç°åœ¨å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡ç«¯çš„helloæ¶ˆæ¯åï¼Œä¼šä»¥rootæƒé™éªŒè¯æœåŠ¡ç«¯çš„è¯ä¹¦ï¼Œå¹¶æ£€æŸ¥æ•´ä¸ªæ¡æ‰‹è¿‡ç¨‹çš„ç­¾åå’ŒMACï¼Œç¡®ä¿æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚\nå¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œåˆ™å®¢æˆ·ç«¯å‘é€å…¶å®Œæˆæ¶ˆæ¯ï¼Œå…¶ä¸­åŒ…å«æ•´ä¸ªæ¡æ‰‹çš„ MACï¼Œå¹¶ä¸”å¯ä»¥é€‰æ‹©å®¢æˆ·ç«¯çš„è¯ä¹¦å’Œè¯ä¹¦éªŒè¯ä»¥é˜²æœåŠ¡å™¨è¯·æ±‚ã€‚\nè¿™å°±æ˜¯æ•´ä¸ªTLSæ¡æ‰‹çš„æµç¨‹ã€‚\n8.2 å¸¦ PSK æ¢å¤çš„ç®€çŸ­æ¡æ‰‹ ä¸ºäº†æé«˜æ€§èƒ½ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¹¶ä¸æ€»æ˜¯ç»è¿‡è¿™ä¸ªå®Œæ•´çš„æ¡æ‰‹ã€‚ æœ‰æ—¶ï¼Œä»–ä»¬é€šè¿‡ä½¿ç”¨é¢„å…±äº«å¯†é’¥æ¢å¤æ¥æ‰§è¡Œç®€çŸ­çš„æ¡æ‰‹ã€‚\næ€è·¯æ˜¯ï¼šåœ¨ä¸Šä¸€æ¬¡æ¡æ‰‹ä¹‹åï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å·²ç»ç›¸äº’è®¤è¯†ï¼Œä¸éœ€è¦å†æ¬¡è®¤è¯ã€‚\nå› æ­¤æœåŠ¡å™¨å¯èƒ½ä¼šå‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªæˆ–å¤šä¸ªä¼šè¯ç¥¨æ®ï¼Œè¯¥ç¥¨æ®å¯ä»¥ç”¨ä½œä¸‹æ¬¡æ¡æ‰‹æ—¶çš„é¢„å…±äº«å¯†é’¥ï¼ˆpre-shared key PSKï¼‰èº«ä»½ã€‚ å®ƒä¸ç¥¨è¯æœ‰æ•ˆæœŸä»¥åŠå…¶ä»–ä¸€äº›ä¿¡æ¯ä¸€èµ·ä½¿ç”¨ã€‚\nè¿™æ ·åœ¨ä¸‹ä¸€æ¬¡æ¡æ‰‹ï¼Œå®¢æˆ·ç«¯åªéœ€è¦å‘é€ä¸€ä¸ªç®€å•çš„helloæ¶ˆæ¯ï¼š\n ä»ä¸Šæ¬¡æ¡æ‰‹ä¸­è·å¾—çš„ PSK èº«ä»½ï¼ˆæˆ–ç¥¨è¯ï¼‰åˆ—è¡¨ ä¸€ç§ PSK å¯†é’¥äº¤æ¢æ¨¡å¼ï¼Œå¯ä»¥æ˜¯ä»… PSKï¼Œä¹Ÿå¯ä»¥æ˜¯å¸¦æœ‰ Diffie-Hellman çš„ PSKã€‚ å¦‚æœä½¿ç”¨å…·æœ‰ Diffie-Hellman æ¨¡å¼çš„ PSKï¼Œåˆ™å®¢æˆ·ç«¯è¿˜éœ€è¦å…±äº«å…¶ Diffie-Hellman å…¬é’¥ã€‚ è¿™å°†æä¾›å®Œç¾çš„å‰å‘ä¿å¯†ï¼Œå¹¶å…è®¸æœåŠ¡å™¨åœ¨éœ€è¦æ—¶å›é€€åˆ°å®Œå…¨æ¡æ‰‹ã€‚  æœåŠ¡æ”¶åˆ°å®¢æˆ·ç«¯çš„helloæ¶ˆæ¯åï¼Œå°†è¿”å›ä¸€ä¸ªhelloæ¶ˆæ¯ï¼š\n é€‰å®šçš„é¢„å…±äº«å¯†é’¥èº«ä»½ æœåŠ¡å™¨çš„å¯é€‰ Diffie-Hellman å…¬é’¥ å’ŒæœåŠ¡å™¨å®Œæˆå°±åƒåœ¨å®Œæ•´çš„æ¡æ‰‹ä¸­ä¸€æ ·ã€‚  æœ€åå®¢æˆ·ç«¯å‘å›å®ƒçš„ Finishï¼Œè¿™å°±æ˜¯ PSK æ¢å¤çš„ç»“æŸã€‚\nå¦‚æ‚¨æ‰€è§ï¼Œåœ¨è¿™ä¸ªç®€çŸ­çš„æ¡æ‰‹ä¸­ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´æ²¡æœ‰è¯ä¹¦èº«ä»½éªŒè¯ã€‚\nè¿™ä¹Ÿä¸ºé›¶å¾€è¿”æ—¶é—´ (0-RTT) æ•°æ®æä¾›äº†æœºä¼šï¼Œè¿™æ„å‘³ç€å®¢æˆ·ç«¯æ— éœ€ç­‰å¾…æ¡æ‰‹å®Œæˆå³å¯å°†å…¶ç¬¬ä¸€ä¸ªåº”ç”¨ç¨‹åºæ•°æ®å‘é€åˆ°æœåŠ¡å™¨ã€‚\n8.3 é›¶å¾€è¿” ï¼ˆ0-RTTï¼‰æ¡æ‰‹ åœ¨ 0-RTT ä¸­ï¼Œå®¢æˆ·ç«¯å°†åº”ç”¨ç¨‹åºæ•°æ®ä¸å®¢æˆ·ç«¯ hello æ¶ˆæ¯ä¸€èµ·å‘é€ã€‚ æ­¤æ•°æ®ä½¿ç”¨ä»ç¥¨è¯åˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ª PSK æ´¾ç”Ÿçš„å¯†é’¥è¿›è¡ŒåŠ å¯†ã€‚\nå®ƒè¿˜å¢åŠ äº† 1 ä¸ªå­—æ®µï¼šæ—©æœŸæ•°æ®æŒ‡ç¤ºï¼Œå‘Šè¯‰æœåŠ¡å™¨æœ‰æ—©æœŸåº”ç”¨ç¨‹åºæ•°æ®æ­£åœ¨å‘é€ã€‚\nå¦‚æœæœåŠ¡å™¨æ¥å—äº†è¿™ä¸ª 0-RTT è¯·æ±‚ï¼Œå®ƒå°†åƒæ­£å¸¸çš„ PSK æ¢å¤ä¸€æ ·å‘æœåŠ¡å™¨å‘é€ helloï¼Œå¹¶ä¸”è¿˜å¯ä»¥é€‰æ‹©ä¸€äº›åº”ç”¨ç¨‹åºæ•°æ®ã€‚\nå®¢æˆ·ç«¯å°†ä»¥åŒ…å« MAC çš„æ¶ˆæ¯å’Œæ—©æœŸæ•°æ®ç»“æŸæŒ‡ç¤ºç¬¦ç»“æŸã€‚ è¿™å°±æ˜¯ TLS 1.3 ä¸­ 0 å¾€è¿”æ—¶é—´çš„å·¥ä½œåŸç†ã€‚\nå®ƒçš„ä¼˜ç‚¹æ˜¯å°†å»¶è¿Ÿå‡å°‘ 1 ä¸ªå¾€è¿”æ—¶é—´ã€‚ ä½†ç¼ºç‚¹æ˜¯æ‰“å¼€äº†é‡æ”¾æ”»å‡»çš„æ½œåœ¨å¨èƒã€‚ è¿™æ„å‘³ç€ï¼Œé»‘å®¢å¯ä»¥å¤šæ¬¡å¤åˆ¶å¹¶å‘é€ç›¸åŒçš„åŠ å¯† 0-RTT è¯·æ±‚åˆ°æœåŠ¡å™¨ã€‚ ä¸ºé¿å…è¿™ç§æƒ…å†µï¼ŒæœåŠ¡å™¨åº”ç”¨ç¨‹åºå¿…é¡»ä»¥ä¸€ç§å¯¹é‡å¤è¯·æ±‚å…·æœ‰å¼¹æ€§çš„æ–¹å¼å®ç°ã€‚\n9. TLS1.2 VS TLS1.3 åœ¨æ–‡ç« ç»“æŸä¹‹å‰ï¼Œæ¥åšä¸€ä¸ªTLS1.3å’ŒTLS1.2çš„å¯¹æ¯”\n  TLS 1.3 å…·æœ‰æ›´å®‰å…¨çš„å¯†é’¥äº¤æ¢æœºåˆ¶ï¼Œå…¶ä¸­æ˜“å—æ”»å‡»çš„ RSA å’Œå…¶ä»–é™æ€å¯†é’¥äº¤æ¢æ–¹æ³•è¢«ç§»é™¤ï¼Œåªç•™ä¸‹çŸ­æš‚çš„ Diffie-Hellman æˆ– Elliptic-Curve Diffie-Hellmanï¼Œå› æ­¤å®ç°äº†å®Œç¾çš„å‰å‘ä¿å¯†ã€‚\n  TLS 1.3 æ¡æ‰‹æ¯” TLS 1.2 è‡³å°‘å¿« 1 æ¬¡å¾€è¿”ã€‚\n  TLS 1.3 ä¸­çš„å¯¹ç§°åŠ å¯†æ›´åŠ å®‰å…¨ï¼Œå› ä¸º AEAD å¯†ç å¥—ä»¶æ˜¯å¼ºåˆ¶æ€§çš„ï¼Œå¹¶ä¸”å®ƒè¿˜ä»åˆ—è¡¨ä¸­åˆ é™¤äº†ä¸€äº›å¼±ç®—æ³•ï¼Œä¾‹å¦‚å—å¯†ç æ¨¡å¼ (CBC)ã€RC4 æˆ–ä¸‰é‡ DESã€‚\n  TLS 1.3 ä¸­çš„å¯†ç å¥—ä»¶ä¹Ÿæ›´ç®€å•ï¼Œå› ä¸ºå®ƒåªåŒ…å« AEAD ç®—æ³•å’Œå“ˆå¸Œç®—æ³•ã€‚å¯†é’¥äº¤æ¢å’Œç­¾åç®—æ³•è¢«ç§»åˆ°å•ç‹¬çš„å­—æ®µä¸­ã€‚åœ¨ TLS 1.2 ä¸­ï¼Œå®ƒä»¬è¢«åˆå¹¶åˆ°å¯†ç å¥—ä»¶ä¸­ã€‚è¿™ä½¿å¾—æ¨èå¯†ç å¥—ä»¶çš„æ•°é‡å˜å¾—å¤ªå¤§ï¼Œå¦‚æœæˆ‘æ²¡è®°é”™çš„è¯ï¼ŒTLS 1.2 ä¸­æœ‰ 37 ä¸ªé€‰é¡¹ã€‚è€Œåœ¨ TLS 1.3 ä¸­ï¼Œåªæœ‰ 5 ä¸ªã€‚\n  æ¥ä¸‹æ¥ï¼ŒTLS 1.3 è¿˜ç»™äº†æˆ‘ä»¬æ›´å¼ºçš„ç­¾åï¼Œå› ä¸ºå®ƒå¯¹æ•´ä¸ªæ¡æ‰‹è¿›è¡Œç­¾åï¼Œè€Œä¸ä»…ä»…æ˜¯åƒ TLS 1.2 ä¸­é‚£æ ·è¦†ç›–å…¶ä¸­çš„ä¸€éƒ¨åˆ†ã€‚\n  æœ€åä½†å¹¶éæœ€ä¸é‡è¦çš„ä¸€ç‚¹æ˜¯ï¼Œæ¤­åœ†æ›²çº¿å¯†ç å­¦åœ¨ TLS 1.3 ä¸­å¾—åˆ°äº†æå¤§çš„å…³æ³¨ï¼Œå¹¶æ·»åŠ äº†ä¸€äº›æ›´å¥½çš„æ›²çº¿ç®—æ³•ï¼Œä¾‹å¦‚ Edward-curve æ•°å­—ç­¾åç®—æ³•ï¼Œå®ƒåœ¨ä¸ç‰ºç‰²å®‰å…¨æ€§çš„æƒ…å†µä¸‹é€Ÿåº¦æ›´å¿«ã€‚\n  END\nOrigin Article https://dev.to/techschoolguru/a-complete-overview-of-ssl-tls-and-its-cryptographic-system-36pd\n","permalink":"http://yangchnet.github.io/Dessert/posts/net/%E6%A6%82%E8%BF%B0tls/","summary":"1. TLSåœ¨å“ªäº›åœ°æ–¹è¢«ä½¿ç”¨ TLS(Transport Layer Security),æ˜¯ä¸ºè®¡ç®—æœºç½‘ç»œä¸­æä¾›å®‰å…¨é€šä¿¡çš„å¯†ç å­¦åè®®ã€‚\n HTTPS = HTTP +ã€€TLS SMTPS = SMTPS + TLS FTPS = FTP + TLS \u0026hellip;  2. TLSç»™æˆ‘ä»¬å¸¦æ¥äº†ä»€ä¹ˆ  è®¤è¯  TLSæ£€æŸ¥é€šä¿¡åŒæ–¹çš„èº«ä»½ å€ŸåŠ©äºéå¯¹ç§°åŠ å¯†ï¼ŒTLSä¿è¯æˆ‘ä»¬è®¿é—®çš„æ˜¯â€œçœŸç½‘ç«™â€ï¼Œä¸æ˜¯å‡å†’çš„ã€‚   åŠ å¯†  TLS é€šè¿‡ä½¿ç”¨å¯¹ç§°åŠ å¯†ç®—æ³•å¯¹å…¶è¿›è¡ŒåŠ å¯†æ¥ä¿æŠ¤äº¤æ¢çš„æ•°æ®å…å—æœªç»æˆæƒçš„è®¿é—®ã€‚   æ ¡éªŒ  TLS é€šè¿‡æ£€æŸ¥æ¶ˆæ¯éªŒè¯ç æ¥è¯†åˆ«ä¼ è¾“è¿‡ç¨‹ä¸­çš„ä»»ä½•æ•°æ®æ›´æ”¹    3. TLSé€šä¿¡çš„å·¥ä½œçš„åŸºæœ¬æµç¨‹ é€šå¸¸ï¼ŒTLSåŒ…å«2ä¸ªè¿‡ç¨‹ï¼Œæˆ–è€…è¯´2ä¸ªåè®®ã€‚\n Handshake Protocol åœ¨è¿™ä¸ªé˜¶æ®µï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ï¼š  åå•†åè®®ç‰ˆæœ¬ é€‰æ‹©åŠ å¯†ç®—æ³• é€šè¿‡éå¯¹ç§°åŠ å¯†ç®—æ³•éªŒè¯å¯¹æ–¹èº«ä»½å‘¢ å»ºç«‹ä¸€ä¸ªå…±äº«çš„å¯¹ç§°åŠ å¯†å¯†é’¥ä»¥åº”ç”¨äºæ¥ä¸‹æ¥çš„é€šä¿¡   Record Protocol åœ¨è¿™ä¸ªé˜¶æ®µï¼š  æ‰€æœ‰å‘å‡ºçš„ä¿¡æ¯éƒ½è¢«ä¸Šä¸ªé˜¶æ®µå•†å®šçš„å¯¹ç§°å¯†é’¥åŠ å¯† ä¿¡æ¯è¢«å‘é€åˆ°å¯¹é¢ æ¥æ”¶æ–¹éªŒè¯ä¿¡æ¯æ˜¯å¦å—åˆ°ç¯¡æ”¹ å¦‚æœæœªè¢«ç¯¡æ”¹ï¼Œä¿¡æ¯å°†è¢«è§£å¯†    4.","title":"è¯¦è§£TLSï¼ˆè¯‘ï¼‰"},{"content":" æå®¢æ—¶é—´ã€Šæ¶ˆæ¯é˜Ÿåˆ—é«˜æ‰‹è¯¾ã€‹ç¬”è®°\n  æ¦‚è§ˆæ¶ˆæ¯é˜Ÿåˆ—ç¯‡ã€‡ï¼šä¸ºä»€ä¹ˆéœ€è¦æ¶ˆæ¯é˜Ÿåˆ— æ¦‚è§ˆæ¶ˆæ¯é˜Ÿåˆ—ç¯‡ä¸€ï¼šä¸åŒçš„mqçš„æ¶ˆæ¯æ¨¡å‹ æ¦‚è§ˆæ¶ˆæ¯é˜Ÿåˆ—ç¯‡äºŒï¼šå¦‚ä½•ç¡®ä¿æ¶ˆæ¯ä¸ä¸¢å¤± æ¦‚è§ˆæ¶ˆæ¯é˜Ÿåˆ—ç¯‡ä¸‰ï¼šé‡å¤æ¶ˆæ¯çš„å¤„ç†  1. å¼‚æ­¥å¤„ç† å¯¹äºä¸€ä¸ªç§’æ€ç³»ç»Ÿï¼Œéœ€è¦è§£å†³çš„æ ¸å¿ƒé—®é¢˜æ˜¯ï¼Œå¦‚ä½•åˆ©ç”¨æœ‰é™çš„æœåŠ¡å™¨èµ„æºï¼Œå°½å¯èƒ½å¤šåœ°å¤„ç†çŸ­æ—¶é—´å†…çš„æµ·é‡è¯·æ±‚ã€‚\nå¤„ç†ä¸€ä¸ªç§’æ€è¯·æ±‚åŒ…å«äº†å¾ˆå¤šæ­¥éª¤ï¼šå¦‚é£é™©æ§åˆ¶ã€åº“å­˜é”å®šã€ç”Ÿæˆè®¢å•ã€çŸ­ä¿¡é€šçŸ¥ã€æ›´æ–°é€šçŸ¥æ•°æ®ç­‰ã€‚å¦‚æœæ²¡æœ‰ä»»ä½•ä¼˜åŒ–ï¼Œæ­£å¸¸çš„å¤„ç†æµç¨‹æ˜¯ï¼šApp å°†è¯·æ±‚å‘é€ç»™ç½‘å…³ï¼Œä¾æ¬¡è°ƒç”¨ä¸Šè¿° 5 ä¸ªæµç¨‹ï¼Œç„¶åå°†ç»“æœè¿”å›ç»™ APPã€‚\nä½†ä¸Šè¿°5ä¸ªæ­¥éª¤ä¸­ï¼Œåªéœ€è¦é£é™©æ§åˆ¶å’Œåº“å­˜é”å®šè¿™ä¸¤æ­¥å°±å¯ä»¥å†³å®šç§’æ€æ˜¯å¦æˆåŠŸï¼Œå¯¹äºåç»­çš„ç”Ÿæˆè®¢å•ã€çŸ­ä¿¡é€šçŸ¥å’Œæ›´æ–°ç»Ÿè®¡æ•°æ®ç­‰æ­¥éª¤ï¼Œå¹¶ä¸ä¸€å®šè¦åœ¨ç§’æ€è¯·æ±‚ä¸­å¤„ç†å®Œæˆã€‚\næ‰€ä»¥å½“æœåŠ¡ç«¯å®Œæˆå‰é¢ 2 ä¸ªæ­¥éª¤ï¼Œç¡®å®šæœ¬æ¬¡è¯·æ±‚çš„ç§’æ€ç»“æœåï¼Œå°±å¯ä»¥é©¬ä¸Šç»™ç”¨æˆ·è¿”å›å“åº”ï¼Œç„¶åæŠŠè¯·æ±‚çš„æ•°æ®æ”¾å…¥æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œç”±æ¶ˆæ¯é˜Ÿåˆ—å¼‚æ­¥åœ°è¿›è¡Œåç»­çš„æ“ä½œã€‚\nå¤„ç†ä¸€ä¸ªç§’æ€è¯·æ±‚ï¼Œä» 5 ä¸ªæ­¥éª¤å‡å°‘ä¸º 2 ä¸ªæ­¥éª¤ï¼Œè¿™æ ·ä¸ä»…å“åº”é€Ÿåº¦æ›´å¿«ï¼Œå¹¶ä¸”åœ¨ç§’æ€æœŸé—´ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå¤§é‡çš„æœåŠ¡å™¨èµ„æºç”¨æ¥å¤„ç†ç§’æ€è¯·æ±‚ã€‚ç§’æ€ç»“æŸåå†æŠŠèµ„æºç”¨äºå¤„ç†åé¢çš„æ­¥éª¤ï¼Œå……åˆ†åˆ©ç”¨æœ‰é™çš„æœåŠ¡å™¨èµ„æºå¤„ç†æ›´å¤šçš„ç§’æ€è¯·æ±‚ã€‚\nå¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œæ¶ˆæ¯é˜Ÿåˆ—è¢«ç”¨äºå®ç°æœåŠ¡çš„å¼‚æ­¥å¤„ç†ã€‚\nè¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼š\n å¯ä»¥æ›´å¿«åœ°è¿”å›ç»“æœï¼› å‡å°‘ç­‰å¾…ï¼Œè‡ªç„¶å®ç°äº†æ­¥éª¤ä¹‹é—´çš„å¹¶å‘ï¼Œæå‡ç³»ç»Ÿæ€»ä½“çš„æ€§èƒ½ã€‚  2. æµé‡æ§åˆ¶ åœ¨ç”¨æ¶ˆæ¯é˜Ÿåˆ—å®ç°äº†éƒ¨åˆ†å·¥ä½œçš„å¼‚æ­¥å¤„ç†åï¼Œæˆ‘ä»¬è¿˜éœ€è¦è€ƒè™‘å¦‚ä½•é¿å…è¿‡å¤šçš„è¯·æ±‚å‹å®æˆ‘ä»¬çš„ç§’æ€ç³»ç»Ÿã€‚\nä¸€ä¸ªè®¾è®¡å¥å£®çš„ç¨‹åºæœ‰è‡ªæˆ‘ä¿æŠ¤çš„èƒ½åŠ›ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒåº”è¯¥å¯ä»¥åœ¨æµ·é‡çš„è¯·æ±‚ä¸‹ï¼Œè¿˜èƒ½åœ¨è‡ªèº«èƒ½åŠ›èŒƒå›´å†…å°½å¯èƒ½å¤šåœ°å¤„ç†è¯·æ±‚ï¼Œæ‹’ç»å¤„ç†ä¸äº†çš„è¯·æ±‚å¹¶ä¸”ä¿è¯è‡ªèº«è¿è¡Œæ­£å¸¸ã€‚\næˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—éš”ç¦»ç½‘å…³å’Œåç«¯æœåŠ¡ï¼Œä»¥è¾¾åˆ°æµé‡æ§åˆ¶å’Œä¿æŠ¤åç«¯æœåŠ¡çš„ç›®çš„ã€‚\nåŠ å…¥æ¶ˆæ¯é˜Ÿåˆ—åï¼Œæ•´ä¸ªç§’æ€æµç¨‹å˜ä¸ºï¼š\n ç½‘å…³åœ¨æ”¶åˆ°è¯·æ±‚åï¼Œå°†è¯·æ±‚æ”¾å…¥è¯·æ±‚æ¶ˆæ¯é˜Ÿåˆ—ï¼› åç«¯æœåŠ¡ä»è¯·æ±‚æ¶ˆæ¯é˜Ÿåˆ—ä¸­è·å– APP è¯·æ±‚ï¼Œå®Œæˆåç»­ç§’æ€å¤„ç†è¿‡ç¨‹ï¼Œç„¶åè¿”å›ç»“æœã€‚  è¿™ç§è®¾è®¡çš„ä¼˜ç‚¹æ˜¯ï¼šèƒ½æ ¹æ®ä¸‹æ¸¸çš„å¤„ç†èƒ½åŠ›è‡ªåŠ¨è°ƒèŠ‚æµé‡ï¼Œè¾¾åˆ°â€œå‰Šå³°å¡«è°·â€çš„ä½œç”¨ã€‚ä½†è¿™æ ·åšåŒæ ·æ˜¯æœ‰ä»£ä»·çš„ï¼š\n å¢åŠ äº†ç³»ç»Ÿè°ƒç”¨é“¾ç¯èŠ‚ï¼Œå¯¼è‡´æ€»ä½“çš„å“åº”æ—¶å»¶å˜é•¿ã€‚ ä¸Šä¸‹æ¸¸ç³»ç»Ÿéƒ½è¦å°†åŒæ­¥è°ƒç”¨æ”¹ä¸ºå¼‚æ­¥æ¶ˆæ¯ï¼Œå¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚åº¦ã€‚  3. æœåŠ¡è§£è€¦ å¯¹äºä¸€ä¸ªç”µå•†ç³»ç»Ÿæ¥è¯´ï¼Œå½“ä¸€ä¸ªæ–°è®¢å•åˆ›å»ºæ—¶ï¼š\n æ”¯ä»˜ç³»ç»Ÿéœ€è¦å‘èµ·æ”¯ä»˜æµç¨‹ï¼› é£æ§ç³»ç»Ÿéœ€è¦å®¡æ ¸è®¢å•çš„åˆæ³•æ€§ï¼› å®¢æœç³»ç»Ÿéœ€è¦ç»™ç”¨æˆ·å‘çŸ­ä¿¡å‘ŠçŸ¥ç”¨æˆ·ï¼› ç»è¥åˆ†æç³»ç»Ÿéœ€è¦æ›´æ–°ç»Ÿè®¡æ•°æ®ï¼› â€¦â€¦  è¿™äº›è®¢å•ä¸‹æ¸¸çš„ç³»ç»Ÿéƒ½éœ€è¦å®æ—¶è·å¾—è®¢å•æ•°æ®ã€‚éšç€ä¸šåŠ¡ä¸æ–­å‘å±•ï¼Œè¿™äº›è®¢å•ä¸‹æ¸¸ç³»ç»Ÿä¸æ–­çš„å¢åŠ ï¼Œä¸æ–­å˜åŒ–ï¼Œå¹¶ä¸”æ¯ä¸ªç³»ç»Ÿå¯èƒ½åªéœ€è¦è®¢å•æ•°æ®çš„ä¸€ä¸ªå­é›†ï¼Œè´Ÿè´£è®¢å•æœåŠ¡çš„å¼€å‘å›¢é˜Ÿä¸å¾—ä¸èŠ±è´¹å¾ˆå¤§çš„ç²¾åŠ›ï¼Œåº”å¯¹ä¸æ–­å¢åŠ å˜åŒ–çš„ä¸‹æ¸¸ç³»ç»Ÿï¼Œä¸åœåœ°ä¿®æ”¹è°ƒè¯•è®¢å•ç³»ç»Ÿä¸è¿™äº›ä¸‹æ¸¸ç³»ç»Ÿçš„æ¥å£ã€‚ä»»ä½•ä¸€ä¸ªä¸‹æ¸¸ç³»ç»Ÿæ¥å£å˜æ›´ï¼Œéƒ½éœ€è¦è®¢å•æ¨¡å—é‡æ–°è¿›è¡Œä¸€æ¬¡ä¸Šçº¿ï¼Œå¯¹äºä¸€ä¸ªç”µå•†çš„æ ¸å¿ƒæœåŠ¡æ¥è¯´ï¼Œè¿™å‡ ä¹æ˜¯ä¸å¯æ¥å—çš„ã€‚\næ‰€æœ‰çš„ç”µå•†éƒ½é€‰æ‹©ç”¨æ¶ˆæ¯é˜Ÿåˆ—æ¥è§£å†³ç±»ä¼¼çš„ç³»ç»Ÿè€¦åˆè¿‡äºç´§å¯†çš„é—®é¢˜ã€‚å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—åï¼Œè®¢å•æœåŠ¡åœ¨è®¢å•å˜åŒ–æ—¶å‘é€ä¸€æ¡æ¶ˆæ¯åˆ°æ¶ˆæ¯é˜Ÿåˆ—çš„ä¸€ä¸ªä¸»é¢˜ Order ä¸­ï¼Œæ‰€æœ‰ä¸‹æ¸¸ç³»ç»Ÿéƒ½è®¢é˜…ä¸»é¢˜ Orderï¼Œè¿™æ ·æ¯ä¸ªä¸‹æ¸¸ç³»ç»Ÿéƒ½å¯ä»¥è·å¾—ä¸€ä»½å®æ—¶å®Œæ•´çš„è®¢å•æ•°æ®ã€‚æ— è®ºå¢åŠ ã€å‡å°‘ä¸‹æ¸¸ç³»ç»Ÿæˆ–æ˜¯ä¸‹æ¸¸ç³»ç»Ÿéœ€æ±‚å¦‚ä½•å˜åŒ–ï¼Œè®¢å•æœåŠ¡éƒ½æ— éœ€åšä»»ä½•æ›´æ”¹ï¼Œå®ç°äº†è®¢å•æœåŠ¡ä¸ä¸‹æ¸¸æœåŠ¡çš„è§£è€¦ã€‚\nå…¶ä»–  ä½œä¸ºå‘å¸ƒ / è®¢é˜…ç³»ç»Ÿå®ç°ä¸€ä¸ªå¾®æœåŠ¡çº§ç³»ç»Ÿé—´çš„è§‚å¯Ÿè€…æ¨¡å¼ï¼› è¿æ¥æµè®¡ç®—ä»»åŠ¡å’Œæ•°æ®ï¼› ç”¨äºå°†æ¶ˆæ¯å¹¿æ’­ç»™å¤§é‡æ¥æ”¶è€…ã€‚  æ¶ˆæ¯é˜Ÿåˆ—å¸¦æ¥çš„ä¸€äº›é—®é¢˜  å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—å¸¦æ¥çš„å»¶è¿Ÿé—®é¢˜ï¼› å¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚åº¦ï¼› å¯èƒ½äº§ç”Ÿæ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚  ","permalink":"http://yangchnet.github.io/Dessert/posts/mq/%E6%A6%82%E8%A7%88%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E7%AF%87%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/","summary":" æå®¢æ—¶é—´ã€Šæ¶ˆæ¯é˜Ÿåˆ—é«˜æ‰‹è¯¾ã€‹ç¬”è®°\n  æ¦‚è§ˆæ¶ˆæ¯é˜Ÿåˆ—ç¯‡ã€‡ï¼šä¸ºä»€ä¹ˆéœ€è¦æ¶ˆæ¯é˜Ÿåˆ— æ¦‚è§ˆæ¶ˆæ¯é˜Ÿåˆ—ç¯‡ä¸€ï¼šä¸åŒçš„mqçš„æ¶ˆæ¯æ¨¡å‹ æ¦‚è§ˆæ¶ˆæ¯é˜Ÿåˆ—ç¯‡äºŒï¼šå¦‚ä½•ç¡®ä¿æ¶ˆæ¯ä¸ä¸¢å¤± æ¦‚è§ˆæ¶ˆæ¯é˜Ÿåˆ—ç¯‡ä¸‰ï¼šé‡å¤æ¶ˆæ¯çš„å¤„ç†  1. å¼‚æ­¥å¤„ç† å¯¹äºä¸€ä¸ªç§’æ€ç³»ç»Ÿï¼Œéœ€è¦è§£å†³çš„æ ¸å¿ƒé—®é¢˜æ˜¯ï¼Œå¦‚ä½•åˆ©ç”¨æœ‰é™çš„æœåŠ¡å™¨èµ„æºï¼Œå°½å¯èƒ½å¤šåœ°å¤„ç†çŸ­æ—¶é—´å†…çš„æµ·é‡è¯·æ±‚ã€‚\nå¤„ç†ä¸€ä¸ªç§’æ€è¯·æ±‚åŒ…å«äº†å¾ˆå¤šæ­¥éª¤ï¼šå¦‚é£é™©æ§åˆ¶ã€åº“å­˜é”å®šã€ç”Ÿæˆè®¢å•ã€çŸ­ä¿¡é€šçŸ¥ã€æ›´æ–°é€šçŸ¥æ•°æ®ç­‰ã€‚å¦‚æœæ²¡æœ‰ä»»ä½•ä¼˜åŒ–ï¼Œæ­£å¸¸çš„å¤„ç†æµç¨‹æ˜¯ï¼šApp å°†è¯·æ±‚å‘é€ç»™ç½‘å…³ï¼Œä¾æ¬¡è°ƒç”¨ä¸Šè¿° 5 ä¸ªæµç¨‹ï¼Œç„¶åå°†ç»“æœè¿”å›ç»™ APPã€‚\nä½†ä¸Šè¿°5ä¸ªæ­¥éª¤ä¸­ï¼Œåªéœ€è¦é£é™©æ§åˆ¶å’Œåº“å­˜é”å®šè¿™ä¸¤æ­¥å°±å¯ä»¥å†³å®šç§’æ€æ˜¯å¦æˆåŠŸï¼Œå¯¹äºåç»­çš„ç”Ÿæˆè®¢å•ã€çŸ­ä¿¡é€šçŸ¥å’Œæ›´æ–°ç»Ÿè®¡æ•°æ®ç­‰æ­¥éª¤ï¼Œå¹¶ä¸ä¸€å®šè¦åœ¨ç§’æ€è¯·æ±‚ä¸­å¤„ç†å®Œæˆã€‚\næ‰€ä»¥å½“æœåŠ¡ç«¯å®Œæˆå‰é¢ 2 ä¸ªæ­¥éª¤ï¼Œç¡®å®šæœ¬æ¬¡è¯·æ±‚çš„ç§’æ€ç»“æœåï¼Œå°±å¯ä»¥é©¬ä¸Šç»™ç”¨æˆ·è¿”å›å“åº”ï¼Œç„¶åæŠŠè¯·æ±‚çš„æ•°æ®æ”¾å…¥æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œç”±æ¶ˆæ¯é˜Ÿåˆ—å¼‚æ­¥åœ°è¿›è¡Œåç»­çš„æ“ä½œã€‚\nå¤„ç†ä¸€ä¸ªç§’æ€è¯·æ±‚ï¼Œä» 5 ä¸ªæ­¥éª¤å‡å°‘ä¸º 2 ä¸ªæ­¥éª¤ï¼Œè¿™æ ·ä¸ä»…å“åº”é€Ÿåº¦æ›´å¿«ï¼Œå¹¶ä¸”åœ¨ç§’æ€æœŸé—´ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå¤§é‡çš„æœåŠ¡å™¨èµ„æºç”¨æ¥å¤„ç†ç§’æ€è¯·æ±‚ã€‚ç§’æ€ç»“æŸåå†æŠŠèµ„æºç”¨äºå¤„ç†åé¢çš„æ­¥éª¤ï¼Œå……åˆ†åˆ©ç”¨æœ‰é™çš„æœåŠ¡å™¨èµ„æºå¤„ç†æ›´å¤šçš„ç§’æ€è¯·æ±‚ã€‚\nå¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œæ¶ˆæ¯é˜Ÿåˆ—è¢«ç”¨äºå®ç°æœåŠ¡çš„å¼‚æ­¥å¤„ç†ã€‚\nè¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼š\n å¯ä»¥æ›´å¿«åœ°è¿”å›ç»“æœï¼› å‡å°‘ç­‰å¾…ï¼Œè‡ªç„¶å®ç°äº†æ­¥éª¤ä¹‹é—´çš„å¹¶å‘ï¼Œæå‡ç³»ç»Ÿæ€»ä½“çš„æ€§èƒ½ã€‚  2. æµé‡æ§åˆ¶ åœ¨ç”¨æ¶ˆæ¯é˜Ÿåˆ—å®ç°äº†éƒ¨åˆ†å·¥ä½œçš„å¼‚æ­¥å¤„ç†åï¼Œæˆ‘ä»¬è¿˜éœ€è¦è€ƒè™‘å¦‚ä½•é¿å…è¿‡å¤šçš„è¯·æ±‚å‹å®æˆ‘ä»¬çš„ç§’æ€ç³»ç»Ÿã€‚\nä¸€ä¸ªè®¾è®¡å¥å£®çš„ç¨‹åºæœ‰è‡ªæˆ‘ä¿æŠ¤çš„èƒ½åŠ›ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒåº”è¯¥å¯ä»¥åœ¨æµ·é‡çš„è¯·æ±‚ä¸‹ï¼Œè¿˜èƒ½åœ¨è‡ªèº«èƒ½åŠ›èŒƒå›´å†…å°½å¯èƒ½å¤šåœ°å¤„ç†è¯·æ±‚ï¼Œæ‹’ç»å¤„ç†ä¸äº†çš„è¯·æ±‚å¹¶ä¸”ä¿è¯è‡ªèº«è¿è¡Œæ­£å¸¸ã€‚\næˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—éš”ç¦»ç½‘å…³å’Œåç«¯æœåŠ¡ï¼Œä»¥è¾¾åˆ°æµé‡æ§åˆ¶å’Œä¿æŠ¤åç«¯æœåŠ¡çš„ç›®çš„ã€‚\nåŠ å…¥æ¶ˆæ¯é˜Ÿåˆ—åï¼Œæ•´ä¸ªç§’æ€æµç¨‹å˜ä¸ºï¼š\n ç½‘å…³åœ¨æ”¶åˆ°è¯·æ±‚åï¼Œå°†è¯·æ±‚æ”¾å…¥è¯·æ±‚æ¶ˆæ¯é˜Ÿåˆ—ï¼› åç«¯æœåŠ¡ä»è¯·æ±‚æ¶ˆæ¯é˜Ÿåˆ—ä¸­è·å– APP è¯·æ±‚ï¼Œå®Œæˆåç»­ç§’æ€å¤„ç†è¿‡ç¨‹ï¼Œç„¶åè¿”å›ç»“æœã€‚  è¿™ç§è®¾è®¡çš„ä¼˜ç‚¹æ˜¯ï¼šèƒ½æ ¹æ®ä¸‹æ¸¸çš„å¤„ç†èƒ½åŠ›è‡ªåŠ¨è°ƒèŠ‚æµé‡ï¼Œè¾¾åˆ°â€œå‰Šå³°å¡«è°·â€çš„ä½œç”¨ã€‚ä½†è¿™æ ·åšåŒæ ·æ˜¯æœ‰ä»£ä»·çš„ï¼š\n å¢åŠ äº†ç³»ç»Ÿè°ƒç”¨é“¾ç¯èŠ‚ï¼Œå¯¼è‡´æ€»ä½“çš„å“åº”æ—¶å»¶å˜é•¿ã€‚ ä¸Šä¸‹æ¸¸ç³»ç»Ÿéƒ½è¦å°†åŒæ­¥è°ƒç”¨æ”¹ä¸ºå¼‚æ­¥æ¶ˆæ¯ï¼Œå¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚åº¦ã€‚  3. æœåŠ¡è§£è€¦ å¯¹äºä¸€ä¸ªç”µå•†ç³»ç»Ÿæ¥è¯´ï¼Œå½“ä¸€ä¸ªæ–°è®¢å•åˆ›å»ºæ—¶ï¼š\n æ”¯ä»˜ç³»ç»Ÿéœ€è¦å‘èµ·æ”¯ä»˜æµç¨‹ï¼› é£æ§ç³»ç»Ÿéœ€è¦å®¡æ ¸è®¢å•çš„åˆæ³•æ€§ï¼› å®¢æœç³»ç»Ÿéœ€è¦ç»™ç”¨æˆ·å‘çŸ­ä¿¡å‘ŠçŸ¥ç”¨æˆ·ï¼› ç»è¥åˆ†æç³»ç»Ÿéœ€è¦æ›´æ–°ç»Ÿè®¡æ•°æ®ï¼› â€¦â€¦  è¿™äº›è®¢å•ä¸‹æ¸¸çš„ç³»ç»Ÿéƒ½éœ€è¦å®æ—¶è·å¾—è®¢å•æ•°æ®ã€‚éšç€ä¸šåŠ¡ä¸æ–­å‘å±•ï¼Œè¿™äº›è®¢å•ä¸‹æ¸¸ç³»ç»Ÿä¸æ–­çš„å¢åŠ ï¼Œä¸æ–­å˜åŒ–ï¼Œå¹¶ä¸”æ¯ä¸ªç³»ç»Ÿå¯èƒ½åªéœ€è¦è®¢å•æ•°æ®çš„ä¸€ä¸ªå­é›†ï¼Œè´Ÿè´£è®¢å•æœåŠ¡çš„å¼€å‘å›¢é˜Ÿä¸å¾—ä¸èŠ±è´¹å¾ˆå¤§çš„ç²¾åŠ›ï¼Œåº”å¯¹ä¸æ–­å¢åŠ å˜åŒ–çš„ä¸‹æ¸¸ç³»ç»Ÿï¼Œä¸åœåœ°ä¿®æ”¹è°ƒè¯•è®¢å•ç³»ç»Ÿä¸è¿™äº›ä¸‹æ¸¸ç³»ç»Ÿçš„æ¥å£ã€‚ä»»ä½•ä¸€ä¸ªä¸‹æ¸¸ç³»ç»Ÿæ¥å£å˜æ›´ï¼Œéƒ½éœ€è¦è®¢å•æ¨¡å—é‡æ–°è¿›è¡Œä¸€æ¬¡ä¸Šçº¿ï¼Œå¯¹äºä¸€ä¸ªç”µå•†çš„æ ¸å¿ƒæœåŠ¡æ¥è¯´ï¼Œè¿™å‡ ä¹æ˜¯ä¸å¯æ¥å—çš„ã€‚\næ‰€æœ‰çš„ç”µå•†éƒ½é€‰æ‹©ç”¨æ¶ˆæ¯é˜Ÿåˆ—æ¥è§£å†³ç±»ä¼¼çš„ç³»ç»Ÿè€¦åˆè¿‡äºç´§å¯†çš„é—®é¢˜ã€‚å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—åï¼Œè®¢å•æœåŠ¡åœ¨è®¢å•å˜åŒ–æ—¶å‘é€ä¸€æ¡æ¶ˆæ¯åˆ°æ¶ˆæ¯é˜Ÿåˆ—çš„ä¸€ä¸ªä¸»é¢˜ Order ä¸­ï¼Œæ‰€æœ‰ä¸‹æ¸¸ç³»ç»Ÿéƒ½è®¢é˜…ä¸»é¢˜ Orderï¼Œè¿™æ ·æ¯ä¸ªä¸‹æ¸¸ç³»ç»Ÿéƒ½å¯ä»¥è·å¾—ä¸€ä»½å®æ—¶å®Œæ•´çš„è®¢å•æ•°æ®ã€‚æ— è®ºå¢åŠ ã€å‡å°‘ä¸‹æ¸¸ç³»ç»Ÿæˆ–æ˜¯ä¸‹æ¸¸ç³»ç»Ÿéœ€æ±‚å¦‚ä½•å˜åŒ–ï¼Œè®¢å•æœåŠ¡éƒ½æ— éœ€åšä»»ä½•æ›´æ”¹ï¼Œå®ç°äº†è®¢å•æœåŠ¡ä¸ä¸‹æ¸¸æœåŠ¡çš„è§£è€¦ã€‚\nå…¶ä»–  ä½œä¸ºå‘å¸ƒ / è®¢é˜…ç³»ç»Ÿå®ç°ä¸€ä¸ªå¾®æœåŠ¡çº§ç³»ç»Ÿé—´çš„è§‚å¯Ÿè€…æ¨¡å¼ï¼› è¿æ¥æµè®¡ç®—ä»»åŠ¡å’Œæ•°æ®ï¼› ç”¨äºå°†æ¶ˆæ¯å¹¿æ’­ç»™å¤§é‡æ¥æ”¶è€…ã€‚  æ¶ˆæ¯é˜Ÿåˆ—å¸¦æ¥çš„ä¸€äº›é—®é¢˜  å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—å¸¦æ¥çš„å»¶è¿Ÿé—®é¢˜ï¼› å¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚åº¦ï¼› å¯èƒ½äº§ç”Ÿæ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚  ","title":"æ¦‚è§ˆæ¶ˆæ¯é˜Ÿåˆ—ç¯‡ã€‡ï¼šä¸ºä»€ä¹ˆéœ€è¦æ¶ˆæ¯é˜Ÿåˆ—"},{"content":" æå®¢æ—¶é—´ã€Šæ¶ˆæ¯é˜Ÿåˆ—é«˜æ‰‹è¯¾ã€‹ç¬”è®°\n  æ¦‚è§ˆæ¶ˆæ¯é˜Ÿåˆ—ç¯‡ã€‡ï¼šä¸ºä»€ä¹ˆéœ€è¦æ¶ˆæ¯é˜Ÿåˆ— æ¦‚è§ˆæ¶ˆæ¯é˜Ÿåˆ—ç¯‡ä¸€ï¼šä¸åŒçš„mqçš„æ¶ˆæ¯æ¨¡å‹ æ¦‚è§ˆæ¶ˆæ¯é˜Ÿåˆ—ç¯‡äºŒï¼šå¦‚ä½•ç¡®ä¿æ¶ˆæ¯ä¸ä¸¢å¤± æ¦‚è§ˆæ¶ˆæ¯é˜Ÿåˆ—ç¯‡ä¸‰ï¼šé‡å¤æ¶ˆæ¯çš„å¤„ç†  æ¶ˆæ¯é˜Ÿåˆ—æœ¬èº«å¯ä»¥ä¿è¯æ¶ˆæ¯ä¸é‡å¤å— åœ¨ MQTT åè®®ä¸­ï¼Œç»™å‡ºäº†ä¸‰ç§ä¼ é€’æ¶ˆæ¯æ—¶èƒ½å¤Ÿæä¾›çš„æœåŠ¡è´¨é‡æ ‡å‡†ï¼Œè¿™ä¸‰ç§æœåŠ¡è´¨é‡ä»ä½åˆ°é«˜ä¾æ¬¡æ˜¯ï¼š\n At most once: è‡³å¤šä¸€æ¬¡ã€‚æ¶ˆæ¯åœ¨ä¼ é€’æ—¶ï¼Œæœ€å¤šä¼šè¢«é€è¾¾ä¸€æ¬¡ã€‚æ¢ä¸€ä¸ªè¯´æ³•å°±æ˜¯ï¼Œæ²¡ä»€ä¹ˆæ¶ˆæ¯å¯é æ€§ä¿è¯ï¼Œå…è®¸ä¸¢æ¶ˆæ¯ã€‚ä¸€èˆ¬éƒ½æ˜¯ä¸€äº›å¯¹æ¶ˆæ¯å¯é æ€§è¦æ±‚ä¸å¤ªé«˜çš„ç›‘æ§åœºæ™¯ä½¿ç”¨ï¼Œæ¯”å¦‚æ¯åˆ†é’Ÿä¸ŠæŠ¥ä¸€æ¬¡æœºæˆ¿æ¸©åº¦æ•°æ®ï¼Œå¯ä»¥æ¥å—æ•°æ®å°‘é‡ä¸¢å¤±ã€‚ At least once: è‡³å°‘ä¸€æ¬¡ã€‚æ¶ˆæ¯åœ¨ä¼ é€’æ—¶ï¼Œè‡³å°‘ä¼šè¢«é€è¾¾ä¸€æ¬¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸å…è®¸ä¸¢æ¶ˆæ¯ï¼Œä½†æ˜¯å…è®¸æœ‰å°‘é‡é‡å¤æ¶ˆæ¯å‡ºç°ã€‚ Exactly onceï¼šæ°å¥½ä¸€æ¬¡ã€‚æ¶ˆæ¯åœ¨ä¼ é€’æ—¶ï¼Œåªä¼šè¢«é€è¾¾ä¸€æ¬¡ï¼Œä¸å…è®¸ä¸¢å¤±ä¹Ÿä¸å…è®¸é‡å¤ï¼Œè¿™ä¸ªæ˜¯æœ€é«˜çš„ç­‰çº§ã€‚  è¿™ä¸ªæœåŠ¡è´¨é‡æ ‡å‡†ä¸ä»…é€‚ç”¨äº MQTTï¼Œå¯¹æ‰€æœ‰çš„æ¶ˆæ¯é˜Ÿåˆ—éƒ½æ˜¯é€‚ç”¨çš„ã€‚æˆ‘ä»¬ç°åœ¨å¸¸ç”¨çš„ç»å¤§éƒ¨åˆ†æ¶ˆæ¯é˜Ÿåˆ—æä¾›çš„æœåŠ¡è´¨é‡éƒ½æ˜¯ At least onceï¼ŒåŒ…æ‹¬ RocketMQã€RabbitMQ å’Œ Kafka éƒ½æ˜¯è¿™æ ·ã€‚\nä¹Ÿå°±æ˜¯è¯´ï¼Œæ¶ˆæ¯é˜Ÿåˆ—å¾ˆéš¾ä¿è¯æ¶ˆæ¯ä¸é‡å¤\nç”¨å¹‚ç­‰æ€§è§£å†³é‡å¤æ¶ˆæ¯é—®é¢˜ ä¸€èˆ¬è§£å†³é‡å¤æ¶ˆæ¯çš„åŠæ³•æ˜¯ï¼Œåœ¨æ¶ˆè´¹ç«¯ï¼Œè®©æˆ‘ä»¬æ¶ˆè´¹æ¶ˆæ¯çš„æ“ä½œå…·å¤‡å¹‚ç­‰æ€§ã€‚\nä¸€ä¸ªå¹‚ç­‰æ“ä½œçš„ç‰¹ç‚¹æ˜¯ï¼Œå…¶ä»»æ„å¤šæ¬¡æ‰§è¡Œæ‰€äº§ç”Ÿçš„å½±å“å‡ä¸ä¸€æ¬¡æ‰§è¡Œçš„å½±å“ç›¸åŒã€‚\nä¸€ä¸ªå¹‚ç­‰çš„æ–¹æ³•ï¼Œä½¿ç”¨åŒæ ·çš„å‚æ•°ï¼Œå¯¹å®ƒè¿›è¡Œå¤šæ¬¡è°ƒç”¨å’Œä¸€æ¬¡è°ƒç”¨ï¼Œå¯¹ç³»ç»Ÿäº§ç”Ÿçš„å½±å“æ˜¯ä¸€æ ·çš„ã€‚æ‰€ä»¥ï¼Œå¯¹äºå¹‚ç­‰çš„æ–¹æ³•ï¼Œä¸ç”¨æ‹…å¿ƒé‡å¤æ‰§è¡Œä¼šå¯¹ç³»ç»Ÿé€ æˆä»»ä½•æ”¹å˜ã€‚\nå¦‚æœæˆ‘ä»¬ç³»ç»Ÿæ¶ˆè´¹æ¶ˆæ¯çš„ä¸šåŠ¡é€»è¾‘å…·å¤‡å¹‚ç­‰æ€§ï¼Œé‚£å°±ä¸ç”¨æ‹…å¿ƒæ¶ˆæ¯é‡å¤çš„é—®é¢˜äº†ï¼Œå› ä¸ºåŒä¸€æ¡æ¶ˆæ¯ï¼Œæ¶ˆè´¹ä¸€æ¬¡å’Œæ¶ˆè´¹å¤šæ¬¡å¯¹ç³»ç»Ÿçš„å½±å“æ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚ä¹Ÿå°±å¯ä»¥è®¤ä¸ºï¼Œæ¶ˆè´¹å¤šæ¬¡ç­‰äºæ¶ˆè´¹ä¸€æ¬¡ã€‚ä»å¯¹ç³»ç»Ÿçš„å½±å“ç»“æœæ¥è¯´ï¼šAt least once + å¹‚ç­‰æ¶ˆè´¹ = Exactly onceã€‚\nå¸¸ç”¨è®¾è®¡å¹‚ç­‰æ“ä½œçš„æ–¹æ³•\n åˆ©ç”¨æ•°æ®åº“çš„å”¯ä¸€çº¦æŸå®ç°å¹‚ç­‰  å¯¹äºä¸€ä¸ªè½¬è´¦æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®å¯¹äºæ¯ä¸€ä¸ªè½¬è´¦å•åªèƒ½è¿›è¡Œä¸€æ¬¡è½¬è´¦æ“ä½œï¼Œè¿™æ ·é™¤ç¬¬ä¸€æ¬¡æ“ä½œå¤–å…¶ä»–é‡å¤æ“ä½œéƒ½ä¼šå¤±è´¥ã€‚\nåŸºäºè¿™ä¸ªæ€è·¯ï¼Œä¸å…‰æ˜¯å¯ä»¥ä½¿ç”¨å…³ç³»å‹æ•°æ®åº“ï¼Œåªè¦æ˜¯æ”¯æŒç±»ä¼¼â€œINSERT IF NOT EXISTâ€è¯­ä¹‰çš„å­˜å‚¨ç±»ç³»ç»Ÿéƒ½å¯ä»¥ç”¨äºå®ç°å¹‚ç­‰ï¼Œæ¯”å¦‚ï¼Œè¿˜å¯ä»¥ç”¨ Redis çš„ SETNX å‘½ä»¤æ¥æ›¿ä»£æ•°æ®åº“ä¸­çš„å”¯ä¸€çº¦æŸï¼Œæ¥å®ç°å¹‚ç­‰æ¶ˆè´¹ã€‚\nä¸ºæ›´æ–°çš„æ•°æ®è®¾ç½®å‰ç½®æ¡ä»¶  å¦‚æœæ»¡è¶³æ¡ä»¶å°±æ›´æ–°æ•°æ®ï¼Œå¦åˆ™æ‹’ç»æ›´æ–°æ•°æ®ï¼Œåœ¨æ›´æ–°æ•°æ®çš„æ—¶å€™ï¼ŒåŒæ—¶å˜æ›´å‰ç½®æ¡ä»¶ä¸­éœ€è¦åˆ¤æ–­çš„æ•°æ®ã€‚è¿™æ ·ï¼Œé‡å¤æ‰§è¡Œè¿™ä¸ªæ“ä½œæ—¶ï¼Œç”±äºç¬¬ä¸€æ¬¡æ›´æ–°æ•°æ®çš„æ—¶å€™å·²ç»å˜æ›´äº†å‰ç½®æ¡ä»¶ä¸­éœ€è¦åˆ¤æ–­çš„æ•°æ®ï¼Œä¸æ»¡è¶³å‰ç½®æ¡ä»¶ï¼Œåˆ™ä¸ä¼šé‡å¤æ‰§è¡Œæ›´æ–°æ•°æ®æ“ä½œã€‚\nè®°å½•å¹¶æ£€æŸ¥æ“ä½œ  è®°å½•å¹¶æ£€æŸ¥æ“ä½œï¼Œä¹Ÿç§°ä¸ºâ€œToken æœºåˆ¶æˆ–è€… GUIDï¼ˆå…¨å±€å”¯ä¸€ IDï¼‰æœºåˆ¶â€ï¼Œå®ç°çš„æ€è·¯ç‰¹åˆ«ç®€å•ï¼šåœ¨æ‰§è¡Œæ•°æ®æ›´æ–°æ“ä½œä¹‹å‰ï¼Œå…ˆæ£€æŸ¥ä¸€ä¸‹æ˜¯å¦æ‰§è¡Œè¿‡è¿™ä¸ªæ›´æ–°æ“ä½œã€‚\nå…·ä½“çš„å®ç°æ–¹æ³•æ˜¯ï¼Œåœ¨å‘é€æ¶ˆæ¯æ—¶ï¼Œç»™æ¯æ¡æ¶ˆæ¯æŒ‡å®šä¸€ä¸ªå…¨å±€å”¯ä¸€çš„ IDï¼Œæ¶ˆè´¹æ—¶ï¼Œå…ˆæ ¹æ®è¿™ä¸ª ID æ£€æŸ¥è¿™æ¡æ¶ˆæ¯æ˜¯å¦æœ‰è¢«æ¶ˆè´¹è¿‡ï¼Œå¦‚æœæ²¡æœ‰æ¶ˆè´¹è¿‡ï¼Œæ‰æ›´æ–°æ•°æ®ï¼Œç„¶åå°†æ¶ˆè´¹çŠ¶æ€ç½®ä¸ºå·²æ¶ˆè´¹ã€‚\n","permalink":"http://yangchnet.github.io/Dessert/posts/mq/%E6%A6%82%E8%A7%88%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E7%AF%87%E4%B8%89%E9%87%8D%E5%A4%8D%E6%B6%88%E6%81%AF%E7%9A%84%E5%A4%84%E7%90%86/","summary":"æå®¢æ—¶é—´ã€Šæ¶ˆæ¯é˜Ÿåˆ—é«˜æ‰‹è¯¾ã€‹ç¬”è®°\n  æ¦‚è§ˆæ¶ˆæ¯é˜Ÿåˆ—ç¯‡ã€‡ï¼šä¸ºä»€ä¹ˆéœ€è¦æ¶ˆæ¯é˜Ÿåˆ— æ¦‚è§ˆæ¶ˆæ¯é˜Ÿåˆ—ç¯‡ä¸€ï¼šä¸åŒçš„mqçš„æ¶ˆæ¯æ¨¡å‹ æ¦‚è§ˆæ¶ˆæ¯é˜Ÿåˆ—ç¯‡äºŒï¼šå¦‚ä½•ç¡®ä¿æ¶ˆæ¯ä¸ä¸¢å¤± æ¦‚è§ˆæ¶ˆæ¯é˜Ÿåˆ—ç¯‡ä¸‰ï¼šé‡å¤æ¶ˆæ¯çš„å¤„ç†  æ¶ˆæ¯é˜Ÿåˆ—æœ¬èº«å¯ä»¥ä¿è¯æ¶ˆæ¯ä¸é‡å¤å— åœ¨ MQTT åè®®ä¸­ï¼Œç»™å‡ºäº†ä¸‰ç§ä¼ é€’æ¶ˆæ¯æ—¶èƒ½å¤Ÿæä¾›çš„æœåŠ¡è´¨é‡æ ‡å‡†ï¼Œè¿™ä¸‰ç§æœåŠ¡è´¨é‡ä»ä½åˆ°é«˜ä¾æ¬¡æ˜¯ï¼š\n At most once: è‡³å¤šä¸€æ¬¡ã€‚æ¶ˆæ¯åœ¨ä¼ é€’æ—¶ï¼Œæœ€å¤šä¼šè¢«é€è¾¾ä¸€æ¬¡ã€‚æ¢ä¸€ä¸ªè¯´æ³•å°±æ˜¯ï¼Œæ²¡ä»€ä¹ˆæ¶ˆæ¯å¯é æ€§ä¿è¯ï¼Œå…è®¸ä¸¢æ¶ˆæ¯ã€‚ä¸€èˆ¬éƒ½æ˜¯ä¸€äº›å¯¹æ¶ˆæ¯å¯é æ€§è¦æ±‚ä¸å¤ªé«˜çš„ç›‘æ§åœºæ™¯ä½¿ç”¨ï¼Œæ¯”å¦‚æ¯åˆ†é’Ÿä¸ŠæŠ¥ä¸€æ¬¡æœºæˆ¿æ¸©åº¦æ•°æ®ï¼Œå¯ä»¥æ¥å—æ•°æ®å°‘é‡ä¸¢å¤±ã€‚ At least once: è‡³å°‘ä¸€æ¬¡ã€‚æ¶ˆæ¯åœ¨ä¼ é€’æ—¶ï¼Œè‡³å°‘ä¼šè¢«é€è¾¾ä¸€æ¬¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸å…è®¸ä¸¢æ¶ˆæ¯ï¼Œä½†æ˜¯å…è®¸æœ‰å°‘é‡é‡å¤æ¶ˆæ¯å‡ºç°ã€‚ Exactly onceï¼šæ°å¥½ä¸€æ¬¡ã€‚æ¶ˆæ¯åœ¨ä¼ é€’æ—¶ï¼Œåªä¼šè¢«é€è¾¾ä¸€æ¬¡ï¼Œä¸å…è®¸ä¸¢å¤±ä¹Ÿä¸å…è®¸é‡å¤ï¼Œè¿™ä¸ªæ˜¯æœ€é«˜çš„ç­‰çº§ã€‚  è¿™ä¸ªæœåŠ¡è´¨é‡æ ‡å‡†ä¸ä»…é€‚ç”¨äº MQTTï¼Œå¯¹æ‰€æœ‰çš„æ¶ˆæ¯é˜Ÿåˆ—éƒ½æ˜¯é€‚ç”¨çš„ã€‚æˆ‘ä»¬ç°åœ¨å¸¸ç”¨çš„ç»å¤§éƒ¨åˆ†æ¶ˆæ¯é˜Ÿåˆ—æä¾›çš„æœåŠ¡è´¨é‡éƒ½æ˜¯ At least onceï¼ŒåŒ…æ‹¬ RocketMQã€RabbitMQ å’Œ Kafka éƒ½æ˜¯è¿™æ ·ã€‚\nä¹Ÿå°±æ˜¯è¯´ï¼Œæ¶ˆæ¯é˜Ÿåˆ—å¾ˆéš¾ä¿è¯æ¶ˆæ¯ä¸é‡å¤\nç”¨å¹‚ç­‰æ€§è§£å†³é‡å¤æ¶ˆæ¯é—®é¢˜ ä¸€èˆ¬è§£å†³é‡å¤æ¶ˆæ¯çš„åŠæ³•æ˜¯ï¼Œåœ¨æ¶ˆè´¹ç«¯ï¼Œè®©æˆ‘ä»¬æ¶ˆè´¹æ¶ˆæ¯çš„æ“ä½œå…·å¤‡å¹‚ç­‰æ€§ã€‚\nä¸€ä¸ªå¹‚ç­‰æ“ä½œçš„ç‰¹ç‚¹æ˜¯ï¼Œå…¶ä»»æ„å¤šæ¬¡æ‰§è¡Œæ‰€äº§ç”Ÿçš„å½±å“å‡ä¸ä¸€æ¬¡æ‰§è¡Œçš„å½±å“ç›¸åŒã€‚\nä¸€ä¸ªå¹‚ç­‰çš„æ–¹æ³•ï¼Œä½¿ç”¨åŒæ ·çš„å‚æ•°ï¼Œå¯¹å®ƒè¿›è¡Œå¤šæ¬¡è°ƒç”¨å’Œä¸€æ¬¡è°ƒç”¨ï¼Œå¯¹ç³»ç»Ÿäº§ç”Ÿçš„å½±å“æ˜¯ä¸€æ ·çš„ã€‚æ‰€ä»¥ï¼Œå¯¹äºå¹‚ç­‰çš„æ–¹æ³•ï¼Œä¸ç”¨æ‹…å¿ƒé‡å¤æ‰§è¡Œä¼šå¯¹ç³»ç»Ÿé€ æˆä»»ä½•æ”¹å˜ã€‚\nå¦‚æœæˆ‘ä»¬ç³»ç»Ÿæ¶ˆè´¹æ¶ˆæ¯çš„ä¸šåŠ¡é€»è¾‘å…·å¤‡å¹‚ç­‰æ€§ï¼Œé‚£å°±ä¸ç”¨æ‹…å¿ƒæ¶ˆæ¯é‡å¤çš„é—®é¢˜äº†ï¼Œå› ä¸ºåŒä¸€æ¡æ¶ˆæ¯ï¼Œæ¶ˆè´¹ä¸€æ¬¡å’Œæ¶ˆè´¹å¤šæ¬¡å¯¹ç³»ç»Ÿçš„å½±å“æ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚ä¹Ÿå°±å¯ä»¥è®¤ä¸ºï¼Œæ¶ˆè´¹å¤šæ¬¡ç­‰äºæ¶ˆè´¹ä¸€æ¬¡ã€‚ä»å¯¹ç³»ç»Ÿçš„å½±å“ç»“æœæ¥è¯´ï¼šAt least once + å¹‚ç­‰æ¶ˆè´¹ = Exactly onceã€‚\nå¸¸ç”¨è®¾è®¡å¹‚ç­‰æ“ä½œçš„æ–¹æ³•\n åˆ©ç”¨æ•°æ®åº“çš„å”¯ä¸€çº¦æŸå®ç°å¹‚ç­‰  å¯¹äºä¸€ä¸ªè½¬è´¦æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®å¯¹äºæ¯ä¸€ä¸ªè½¬è´¦å•åªèƒ½è¿›è¡Œä¸€æ¬¡è½¬è´¦æ“ä½œï¼Œè¿™æ ·é™¤ç¬¬ä¸€æ¬¡æ“ä½œå¤–å…¶ä»–é‡å¤æ“ä½œéƒ½ä¼šå¤±è´¥ã€‚\nåŸºäºè¿™ä¸ªæ€è·¯ï¼Œä¸å…‰æ˜¯å¯ä»¥ä½¿ç”¨å…³ç³»å‹æ•°æ®åº“ï¼Œåªè¦æ˜¯æ”¯æŒç±»ä¼¼â€œINSERT IF NOT EXISTâ€è¯­ä¹‰çš„å­˜å‚¨ç±»ç³»ç»Ÿéƒ½å¯ä»¥ç”¨äºå®ç°å¹‚ç­‰ï¼Œæ¯”å¦‚ï¼Œè¿˜å¯ä»¥ç”¨ Redis çš„ SETNX å‘½ä»¤æ¥æ›¿ä»£æ•°æ®åº“ä¸­çš„å”¯ä¸€çº¦æŸï¼Œæ¥å®ç°å¹‚ç­‰æ¶ˆè´¹ã€‚\nä¸ºæ›´æ–°çš„æ•°æ®è®¾ç½®å‰ç½®æ¡ä»¶  å¦‚æœæ»¡è¶³æ¡ä»¶å°±æ›´æ–°æ•°æ®ï¼Œå¦åˆ™æ‹’ç»æ›´æ–°æ•°æ®ï¼Œåœ¨æ›´æ–°æ•°æ®çš„æ—¶å€™ï¼ŒåŒæ—¶å˜æ›´å‰ç½®æ¡ä»¶ä¸­éœ€è¦åˆ¤æ–­çš„æ•°æ®ã€‚è¿™æ ·ï¼Œé‡å¤æ‰§è¡Œè¿™ä¸ªæ“ä½œæ—¶ï¼Œç”±äºç¬¬ä¸€æ¬¡æ›´æ–°æ•°æ®çš„æ—¶å€™å·²ç»å˜æ›´äº†å‰ç½®æ¡ä»¶ä¸­éœ€è¦åˆ¤æ–­çš„æ•°æ®ï¼Œä¸æ»¡è¶³å‰ç½®æ¡ä»¶ï¼Œåˆ™ä¸ä¼šé‡å¤æ‰§è¡Œæ›´æ–°æ•°æ®æ“ä½œã€‚\nè®°å½•å¹¶æ£€æŸ¥æ“ä½œ  è®°å½•å¹¶æ£€æŸ¥æ“ä½œï¼Œä¹Ÿç§°ä¸ºâ€œToken æœºåˆ¶æˆ–è€… GUIDï¼ˆå…¨å±€å”¯ä¸€ IDï¼‰æœºåˆ¶â€ï¼Œå®ç°çš„æ€è·¯ç‰¹åˆ«ç®€å•ï¼šåœ¨æ‰§è¡Œæ•°æ®æ›´æ–°æ“ä½œä¹‹å‰ï¼Œå…ˆæ£€æŸ¥ä¸€ä¸‹æ˜¯å¦æ‰§è¡Œè¿‡è¿™ä¸ªæ›´æ–°æ“ä½œã€‚\nå…·ä½“çš„å®ç°æ–¹æ³•æ˜¯ï¼Œåœ¨å‘é€æ¶ˆæ¯æ—¶ï¼Œç»™æ¯æ¡æ¶ˆæ¯æŒ‡å®šä¸€ä¸ªå…¨å±€å”¯ä¸€çš„ IDï¼Œæ¶ˆè´¹æ—¶ï¼Œå…ˆæ ¹æ®è¿™ä¸ª ID æ£€æŸ¥è¿™æ¡æ¶ˆæ¯æ˜¯å¦æœ‰è¢«æ¶ˆè´¹è¿‡ï¼Œå¦‚æœæ²¡æœ‰æ¶ˆè´¹è¿‡ï¼Œæ‰æ›´æ–°æ•°æ®ï¼Œç„¶åå°†æ¶ˆè´¹çŠ¶æ€ç½®ä¸ºå·²æ¶ˆè´¹ã€‚","title":"æ¦‚è§ˆæ¶ˆæ¯é˜Ÿåˆ—ç¯‡ä¸‰ï¼šé‡å¤æ¶ˆæ¯çš„å¤„ç†"},{"content":" æå®¢æ—¶é—´ã€Šæ¶ˆæ¯é˜Ÿåˆ—é«˜æ‰‹è¯¾ã€‹ç¬”è®°\n  æ¦‚è§ˆæ¶ˆæ¯é˜Ÿåˆ—ç¯‡ã€‡ï¼šä¸ºä»€ä¹ˆéœ€è¦æ¶ˆæ¯é˜Ÿåˆ— æ¦‚è§ˆæ¶ˆæ¯é˜Ÿåˆ—ç¯‡ä¸€ï¼šä¸åŒçš„mqçš„æ¶ˆæ¯æ¨¡å‹ æ¦‚è§ˆæ¶ˆæ¯é˜Ÿåˆ—ç¯‡äºŒï¼šå¦‚ä½•ç¡®ä¿æ¶ˆæ¯ä¸ä¸¢å¤± æ¦‚è§ˆæ¶ˆæ¯é˜Ÿåˆ—ç¯‡ä¸‰ï¼šé‡å¤æ¶ˆæ¯çš„å¤„ç†  æ£€æµ‹æ¶ˆæ¯ä¸¢å¤±çš„æ–¹æ³• å¯ä»¥ä½¿ç”¨ç±»ä¼¼åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªç³»ç»Ÿæ¥è¿½è¸ªæ¯ä¸€æ¡ä¿¡æ¯ã€‚\nè¿˜å¯ä»¥åˆ©ç”¨æ¶ˆæ¯é˜Ÿåˆ—çš„æœ‰åºæ€§æ¥éªŒè¯æ˜¯å¦æœ‰æ¶ˆæ¯ä¸¢å¤±ã€‚\nåœ¨ Producer ç«¯ï¼Œæˆ‘ä»¬ç»™æ¯ä¸ªå‘å‡ºçš„æ¶ˆæ¯é™„åŠ ä¸€ä¸ªè¿ç»­é€’å¢çš„åºå·ï¼Œç„¶ååœ¨ Consumer ç«¯æ¥æ£€æŸ¥è¿™ä¸ªåºå·çš„è¿ç»­æ€§\nå¦‚æœæ²¡æœ‰æ¶ˆæ¯ä¸¢å¤±ï¼ŒConsumer æ”¶åˆ°æ¶ˆæ¯çš„åºå·å¿…ç„¶æ˜¯è¿ç»­é€’å¢çš„ï¼Œæˆ–è€…è¯´æ”¶åˆ°çš„æ¶ˆæ¯ï¼Œå…¶ä¸­çš„åºå·å¿…ç„¶æ˜¯ä¸Šä¸€æ¡æ¶ˆæ¯çš„åºå· +1ã€‚å¦‚æœæ£€æµ‹åˆ°åºå·ä¸è¿ç»­ï¼Œé‚£å°±æ˜¯ä¸¢æ¶ˆæ¯äº†ã€‚\nå¤§å¤šæ•°æ¶ˆæ¯é˜Ÿåˆ—çš„å®¢æˆ·ç«¯éƒ½æ”¯æŒæ‹¦æˆªå™¨æœºåˆ¶ï¼Œä½ å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ‹¦æˆªå™¨æœºåˆ¶ï¼Œåœ¨ Producer å‘é€æ¶ˆæ¯ä¹‹å‰çš„æ‹¦æˆªå™¨ä¸­å°†åºå·æ³¨å…¥åˆ°æ¶ˆæ¯ä¸­ï¼Œåœ¨ Consumer æ”¶åˆ°æ¶ˆæ¯çš„æ‹¦æˆªå™¨ä¸­æ£€æµ‹åºå·çš„è¿ç»­æ€§ï¼Œè¿™æ ·å®ç°çš„å¥½å¤„æ˜¯æ¶ˆæ¯æ£€æµ‹çš„ä»£ç ä¸ä¼šä¾µå…¥åˆ°ä½ çš„ä¸šåŠ¡ä»£ç ä¸­ï¼Œå¾…ä½ çš„ç³»ç»Ÿç¨³å®šåï¼Œä¹Ÿæ–¹ä¾¿å°†è¿™éƒ¨åˆ†æ£€æµ‹çš„é€»è¾‘å…³é—­æˆ–è€…åˆ é™¤ã€‚\nç¡®ä¿æ¶ˆæ¯å¯é ä¼ é€’ ä¸€æ¡æ¶ˆæ¯ä»ç”Ÿäº§åˆ°æ¶ˆè´¹å®Œæˆè¿™ä¸ªè¿‡ç¨‹ï¼Œå¯ä»¥åˆ’åˆ†ä¸‰ä¸ªé˜¶æ®µï¼Œ\n ç”Ÿäº§é˜¶æ®µ: åœ¨è¿™ä¸ªé˜¶æ®µï¼Œä»æ¶ˆæ¯åœ¨ Producer åˆ›å»ºå‡ºæ¥ï¼Œç»è¿‡ç½‘ç»œä¼ è¾“å‘é€åˆ° Broker(mqæœåŠ¡ç«¯)ç«¯ã€‚ å­˜å‚¨é˜¶æ®µ: åœ¨è¿™ä¸ªé˜¶æ®µï¼Œæ¶ˆæ¯åœ¨ Broker ç«¯å­˜å‚¨ï¼Œå¦‚æœæ˜¯é›†ç¾¤ï¼Œæ¶ˆæ¯ä¼šåœ¨è¿™ä¸ªé˜¶æ®µè¢«å¤åˆ¶åˆ°å…¶ä»–çš„å‰¯æœ¬ä¸Šã€‚ æ¶ˆè´¹é˜¶æ®µ: åœ¨è¿™ä¸ªé˜¶æ®µï¼ŒConsumer ä» Broker ä¸Šæ‹‰å–æ¶ˆæ¯ï¼Œç»è¿‡ç½‘ç»œä¼ è¾“å‘é€åˆ° Consumer ä¸Šã€‚  ä¸‹é¢å°±å¦‚ä½•ç¡®ä¿æ¶ˆæ¯å¯é ä¼ é€’åˆ†åˆ«å¯¹ä¸‰ä¸ªé˜¶æ®µè¿›è¡Œåˆ†æ\n ç”Ÿäº§é˜¶æ®µ  åœ¨ç”Ÿäº§é˜¶æ®µï¼Œæ¶ˆæ¯é˜Ÿåˆ—é€šè¿‡æœ€å¸¸ç”¨çš„è¯·æ±‚ç¡®è®¤æœºåˆ¶ï¼Œæ¥ä¿è¯æ¶ˆæ¯çš„å¯é ä¼ é€’ï¼šå½“ä½ çš„ä»£ç è°ƒç”¨å‘æ¶ˆæ¯æ–¹æ³•æ—¶ï¼Œæ¶ˆæ¯é˜Ÿåˆ—çš„å®¢æˆ·ç«¯ä¼šæŠŠæ¶ˆæ¯å‘é€åˆ° Brokerï¼ŒBroker æ”¶åˆ°æ¶ˆæ¯åï¼Œä¼šç»™å®¢æˆ·ç«¯è¿”å›ä¸€ä¸ªç¡®è®¤å“åº”ï¼Œè¡¨æ˜æ¶ˆæ¯å·²ç»æ”¶åˆ°äº†ã€‚å®¢æˆ·ç«¯æ”¶åˆ°å“åº”åï¼Œå®Œæˆäº†ä¸€æ¬¡æ­£å¸¸æ¶ˆæ¯çš„å‘é€ã€‚\nåªè¦ Producer æ”¶åˆ°äº† Broker çš„ç¡®è®¤å“åº”ï¼Œå°±å¯ä»¥ä¿è¯æ¶ˆæ¯åœ¨ç”Ÿäº§é˜¶æ®µä¸ä¼šä¸¢å¤±ã€‚æœ‰äº›æ¶ˆæ¯é˜Ÿåˆ—åœ¨é•¿æ—¶é—´æ²¡æ”¶åˆ°å‘é€ç¡®è®¤å“åº”åï¼Œä¼šè‡ªåŠ¨é‡è¯•ï¼Œå¦‚æœé‡è¯•å†å¤±è´¥ï¼Œå°±ä¼šä»¥è¿”å›å€¼æˆ–è€…å¼‚å¸¸çš„æ–¹å¼å‘ŠçŸ¥ç”¨æˆ·ã€‚\nå­˜å‚¨é˜¶æ®µ  åœ¨å­˜å‚¨é˜¶æ®µæ­£å¸¸æƒ…å†µä¸‹ï¼Œåªè¦ Broker åœ¨æ­£å¸¸è¿è¡Œï¼Œå°±ä¸ä¼šå‡ºç°ä¸¢å¤±æ¶ˆæ¯çš„é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœ Broker å‡ºç°äº†æ•…éšœï¼Œæ¯”å¦‚è¿›ç¨‹æ­»æ‰äº†æˆ–è€…æœåŠ¡å™¨å®•æœºäº†ï¼Œè¿˜æ˜¯å¯èƒ½ä¼šä¸¢å¤±æ¶ˆæ¯çš„ã€‚\nå¦‚æœå¯¹æ¶ˆæ¯çš„å¯é æ€§è¦æ±‚éå¸¸é«˜ï¼Œå¯ä»¥é€šè¿‡é…ç½® Broker å‚æ•°æ¥é¿å…å› ä¸ºå®•æœºä¸¢æ¶ˆæ¯ã€‚\nå¯¹äºå•ä¸ªèŠ‚ç‚¹çš„ Brokerï¼Œéœ€è¦é…ç½® Broker å‚æ•°ï¼Œåœ¨æ”¶åˆ°æ¶ˆæ¯åï¼Œå°†æ¶ˆæ¯å†™å…¥ç£ç›˜åå†ç»™ Producer è¿”å›ç¡®è®¤å“åº”ï¼Œè¿™æ ·å³ä½¿å‘ç”Ÿå®•æœºï¼Œç”±äºæ¶ˆæ¯å·²ç»è¢«å†™å…¥ç£ç›˜ï¼Œå°±ä¸ä¼šä¸¢å¤±æ¶ˆæ¯ï¼Œæ¢å¤åè¿˜å¯ä»¥ç»§ç»­æ¶ˆè´¹ã€‚ä¾‹å¦‚ï¼Œåœ¨ RocketMQ ä¸­ï¼Œéœ€è¦å°†åˆ·ç›˜æ–¹å¼ flushDiskType é…ç½®ä¸º SYNC_FLUSH åŒæ­¥åˆ·ç›˜ã€‚\nå¦‚æœæ˜¯ Broker æ˜¯ç”±å¤šä¸ªèŠ‚ç‚¹ç»„æˆçš„é›†ç¾¤ï¼Œéœ€è¦å°† Broker é›†ç¾¤é…ç½®æˆï¼šè‡³å°‘å°†æ¶ˆæ¯å‘é€åˆ° 2 ä¸ªä»¥ä¸Šçš„èŠ‚ç‚¹ï¼Œå†ç»™å®¢æˆ·ç«¯å›å¤å‘é€ç¡®è®¤å“åº”ã€‚è¿™æ ·å½“æŸä¸ª Broker å®•æœºæ—¶ï¼Œå…¶ä»–çš„ Broker å¯ä»¥æ›¿ä»£å®•æœºçš„ Brokerï¼Œä¹Ÿä¸ä¼šå‘ç”Ÿæ¶ˆæ¯ä¸¢å¤±ã€‚\næ¶ˆè´¹è€…é˜¶æ®µ  æ¶ˆè´¹é˜¶æ®µé‡‡ç”¨å’Œç”Ÿäº§é˜¶æ®µç±»ä¼¼çš„ç¡®è®¤æœºåˆ¶æ¥ä¿è¯æ¶ˆæ¯çš„å¯é ä¼ é€’ï¼Œå®¢æˆ·ç«¯ä» Broker æ‹‰å–æ¶ˆæ¯åï¼Œæ‰§è¡Œç”¨æˆ·çš„æ¶ˆè´¹ä¸šåŠ¡é€»è¾‘ï¼ŒæˆåŠŸåï¼Œæ‰ä¼šç»™ Broker å‘é€æ¶ˆè´¹ç¡®è®¤å“åº”ã€‚å¦‚æœ Broker æ²¡æœ‰æ”¶åˆ°æ¶ˆè´¹ç¡®è®¤å“åº”ï¼Œä¸‹æ¬¡æ‹‰æ¶ˆæ¯çš„æ—¶å€™è¿˜ä¼šè¿”å›åŒä¸€æ¡æ¶ˆæ¯ï¼Œç¡®ä¿æ¶ˆæ¯ä¸ä¼šåœ¨ç½‘ç»œä¼ è¾“è¿‡ç¨‹ä¸­ä¸¢å¤±ï¼Œä¹Ÿä¸ä¼šå› ä¸ºå®¢æˆ·ç«¯åœ¨æ‰§è¡Œæ¶ˆè´¹é€»è¾‘ä¸­å‡ºé”™å¯¼è‡´ä¸¢å¤±ã€‚\nåœ¨ç¼–å†™æ¶ˆè´¹ä»£ç æ—¶éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸è¦åœ¨æ”¶åˆ°æ¶ˆæ¯åå°±ç«‹å³å‘é€æ¶ˆè´¹ç¡®è®¤ï¼Œè€Œæ˜¯åº”è¯¥åœ¨æ‰§è¡Œå®Œæ‰€æœ‰æ¶ˆè´¹ä¸šåŠ¡é€»è¾‘ä¹‹åï¼Œå†å‘é€æ¶ˆè´¹ç¡®è®¤ã€‚\n","permalink":"http://yangchnet.github.io/Dessert/posts/mq/%E6%A6%82%E8%A7%88%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E7%AF%87%E4%BA%8C%E5%A6%82%E4%BD%95%E7%A1%AE%E4%BF%9D%E6%B6%88%E6%81%AF%E4%B8%8D%E4%B8%A2%E5%A4%B1/","summary":"æå®¢æ—¶é—´ã€Šæ¶ˆæ¯é˜Ÿåˆ—é«˜æ‰‹è¯¾ã€‹ç¬”è®°\n  æ¦‚è§ˆæ¶ˆæ¯é˜Ÿåˆ—ç¯‡ã€‡ï¼šä¸ºä»€ä¹ˆéœ€è¦æ¶ˆæ¯é˜Ÿåˆ— æ¦‚è§ˆæ¶ˆæ¯é˜Ÿåˆ—ç¯‡ä¸€ï¼šä¸åŒçš„mqçš„æ¶ˆæ¯æ¨¡å‹ æ¦‚è§ˆæ¶ˆæ¯é˜Ÿåˆ—ç¯‡äºŒï¼šå¦‚ä½•ç¡®ä¿æ¶ˆæ¯ä¸ä¸¢å¤± æ¦‚è§ˆæ¶ˆæ¯é˜Ÿåˆ—ç¯‡ä¸‰ï¼šé‡å¤æ¶ˆæ¯çš„å¤„ç†  æ£€æµ‹æ¶ˆæ¯ä¸¢å¤±çš„æ–¹æ³• å¯ä»¥ä½¿ç”¨ç±»ä¼¼åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªç³»ç»Ÿæ¥è¿½è¸ªæ¯ä¸€æ¡ä¿¡æ¯ã€‚\nè¿˜å¯ä»¥åˆ©ç”¨æ¶ˆæ¯é˜Ÿåˆ—çš„æœ‰åºæ€§æ¥éªŒè¯æ˜¯å¦æœ‰æ¶ˆæ¯ä¸¢å¤±ã€‚\nåœ¨ Producer ç«¯ï¼Œæˆ‘ä»¬ç»™æ¯ä¸ªå‘å‡ºçš„æ¶ˆæ¯é™„åŠ ä¸€ä¸ªè¿ç»­é€’å¢çš„åºå·ï¼Œç„¶ååœ¨ Consumer ç«¯æ¥æ£€æŸ¥è¿™ä¸ªåºå·çš„è¿ç»­æ€§\nå¦‚æœæ²¡æœ‰æ¶ˆæ¯ä¸¢å¤±ï¼ŒConsumer æ”¶åˆ°æ¶ˆæ¯çš„åºå·å¿…ç„¶æ˜¯è¿ç»­é€’å¢çš„ï¼Œæˆ–è€…è¯´æ”¶åˆ°çš„æ¶ˆæ¯ï¼Œå…¶ä¸­çš„åºå·å¿…ç„¶æ˜¯ä¸Šä¸€æ¡æ¶ˆæ¯çš„åºå· +1ã€‚å¦‚æœæ£€æµ‹åˆ°åºå·ä¸è¿ç»­ï¼Œé‚£å°±æ˜¯ä¸¢æ¶ˆæ¯äº†ã€‚\nå¤§å¤šæ•°æ¶ˆæ¯é˜Ÿåˆ—çš„å®¢æˆ·ç«¯éƒ½æ”¯æŒæ‹¦æˆªå™¨æœºåˆ¶ï¼Œä½ å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ‹¦æˆªå™¨æœºåˆ¶ï¼Œåœ¨ Producer å‘é€æ¶ˆæ¯ä¹‹å‰çš„æ‹¦æˆªå™¨ä¸­å°†åºå·æ³¨å…¥åˆ°æ¶ˆæ¯ä¸­ï¼Œåœ¨ Consumer æ”¶åˆ°æ¶ˆæ¯çš„æ‹¦æˆªå™¨ä¸­æ£€æµ‹åºå·çš„è¿ç»­æ€§ï¼Œè¿™æ ·å®ç°çš„å¥½å¤„æ˜¯æ¶ˆæ¯æ£€æµ‹çš„ä»£ç ä¸ä¼šä¾µå…¥åˆ°ä½ çš„ä¸šåŠ¡ä»£ç ä¸­ï¼Œå¾…ä½ çš„ç³»ç»Ÿç¨³å®šåï¼Œä¹Ÿæ–¹ä¾¿å°†è¿™éƒ¨åˆ†æ£€æµ‹çš„é€»è¾‘å…³é—­æˆ–è€…åˆ é™¤ã€‚\nç¡®ä¿æ¶ˆæ¯å¯é ä¼ é€’ ä¸€æ¡æ¶ˆæ¯ä»ç”Ÿäº§åˆ°æ¶ˆè´¹å®Œæˆè¿™ä¸ªè¿‡ç¨‹ï¼Œå¯ä»¥åˆ’åˆ†ä¸‰ä¸ªé˜¶æ®µï¼Œ\n ç”Ÿäº§é˜¶æ®µ: åœ¨è¿™ä¸ªé˜¶æ®µï¼Œä»æ¶ˆæ¯åœ¨ Producer åˆ›å»ºå‡ºæ¥ï¼Œç»è¿‡ç½‘ç»œä¼ è¾“å‘é€åˆ° Broker(mqæœåŠ¡ç«¯)ç«¯ã€‚ å­˜å‚¨é˜¶æ®µ: åœ¨è¿™ä¸ªé˜¶æ®µï¼Œæ¶ˆæ¯åœ¨ Broker ç«¯å­˜å‚¨ï¼Œå¦‚æœæ˜¯é›†ç¾¤ï¼Œæ¶ˆæ¯ä¼šåœ¨è¿™ä¸ªé˜¶æ®µè¢«å¤åˆ¶åˆ°å…¶ä»–çš„å‰¯æœ¬ä¸Šã€‚ æ¶ˆè´¹é˜¶æ®µ: åœ¨è¿™ä¸ªé˜¶æ®µï¼ŒConsumer ä» Broker ä¸Šæ‹‰å–æ¶ˆæ¯ï¼Œç»è¿‡ç½‘ç»œä¼ è¾“å‘é€åˆ° Consumer ä¸Šã€‚  ä¸‹é¢å°±å¦‚ä½•ç¡®ä¿æ¶ˆæ¯å¯é ä¼ é€’åˆ†åˆ«å¯¹ä¸‰ä¸ªé˜¶æ®µè¿›è¡Œåˆ†æ\n ç”Ÿäº§é˜¶æ®µ  åœ¨ç”Ÿäº§é˜¶æ®µï¼Œæ¶ˆæ¯é˜Ÿåˆ—é€šè¿‡æœ€å¸¸ç”¨çš„è¯·æ±‚ç¡®è®¤æœºåˆ¶ï¼Œæ¥ä¿è¯æ¶ˆæ¯çš„å¯é ä¼ é€’ï¼šå½“ä½ çš„ä»£ç è°ƒç”¨å‘æ¶ˆæ¯æ–¹æ³•æ—¶ï¼Œæ¶ˆæ¯é˜Ÿåˆ—çš„å®¢æˆ·ç«¯ä¼šæŠŠæ¶ˆæ¯å‘é€åˆ° Brokerï¼ŒBroker æ”¶åˆ°æ¶ˆæ¯åï¼Œä¼šç»™å®¢æˆ·ç«¯è¿”å›ä¸€ä¸ªç¡®è®¤å“åº”ï¼Œè¡¨æ˜æ¶ˆæ¯å·²ç»æ”¶åˆ°äº†ã€‚å®¢æˆ·ç«¯æ”¶åˆ°å“åº”åï¼Œå®Œæˆäº†ä¸€æ¬¡æ­£å¸¸æ¶ˆæ¯çš„å‘é€ã€‚\nåªè¦ Producer æ”¶åˆ°äº† Broker çš„ç¡®è®¤å“åº”ï¼Œå°±å¯ä»¥ä¿è¯æ¶ˆæ¯åœ¨ç”Ÿäº§é˜¶æ®µä¸ä¼šä¸¢å¤±ã€‚æœ‰äº›æ¶ˆæ¯é˜Ÿåˆ—åœ¨é•¿æ—¶é—´æ²¡æ”¶åˆ°å‘é€ç¡®è®¤å“åº”åï¼Œä¼šè‡ªåŠ¨é‡è¯•ï¼Œå¦‚æœé‡è¯•å†å¤±è´¥ï¼Œå°±ä¼šä»¥è¿”å›å€¼æˆ–è€…å¼‚å¸¸çš„æ–¹å¼å‘ŠçŸ¥ç”¨æˆ·ã€‚\nå­˜å‚¨é˜¶æ®µ  åœ¨å­˜å‚¨é˜¶æ®µæ­£å¸¸æƒ…å†µä¸‹ï¼Œåªè¦ Broker åœ¨æ­£å¸¸è¿è¡Œï¼Œå°±ä¸ä¼šå‡ºç°ä¸¢å¤±æ¶ˆæ¯çš„é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœ Broker å‡ºç°äº†æ•…éšœï¼Œæ¯”å¦‚è¿›ç¨‹æ­»æ‰äº†æˆ–è€…æœåŠ¡å™¨å®•æœºäº†ï¼Œè¿˜æ˜¯å¯èƒ½ä¼šä¸¢å¤±æ¶ˆæ¯çš„ã€‚\nå¦‚æœå¯¹æ¶ˆæ¯çš„å¯é æ€§è¦æ±‚éå¸¸é«˜ï¼Œå¯ä»¥é€šè¿‡é…ç½® Broker å‚æ•°æ¥é¿å…å› ä¸ºå®•æœºä¸¢æ¶ˆæ¯ã€‚\nå¯¹äºå•ä¸ªèŠ‚ç‚¹çš„ Brokerï¼Œéœ€è¦é…ç½® Broker å‚æ•°ï¼Œåœ¨æ”¶åˆ°æ¶ˆæ¯åï¼Œå°†æ¶ˆæ¯å†™å…¥ç£ç›˜åå†ç»™ Producer è¿”å›ç¡®è®¤å“åº”ï¼Œè¿™æ ·å³ä½¿å‘ç”Ÿå®•æœºï¼Œç”±äºæ¶ˆæ¯å·²ç»è¢«å†™å…¥ç£ç›˜ï¼Œå°±ä¸ä¼šä¸¢å¤±æ¶ˆæ¯ï¼Œæ¢å¤åè¿˜å¯ä»¥ç»§ç»­æ¶ˆè´¹ã€‚ä¾‹å¦‚ï¼Œåœ¨ RocketMQ ä¸­ï¼Œéœ€è¦å°†åˆ·ç›˜æ–¹å¼ flushDiskType é…ç½®ä¸º SYNC_FLUSH åŒæ­¥åˆ·ç›˜ã€‚","title":"æ¦‚è§ˆæ¶ˆæ¯é˜Ÿåˆ—ç¯‡äºŒï¼šå¦‚ä½•ç¡®ä¿æ¶ˆæ¯ä¸ä¸¢å¤±"},{"content":" æå®¢æ—¶é—´ã€ŠRedis æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜ã€‹å­¦ä¹ ç¬”è®°\n  æ¦‚è§ˆRedisç¯‡ä¸€ï¼šå•çº¿ç¨‹æ¨¡å‹ æ¦‚è§ˆRedisç¯‡äºŒï¼šAOFæ—¥å¿— æ¦‚è§ˆRedisç¯‡ä¸‰ï¼šRDBå¿«ç…§ æ¦‚è§ˆRedisç¯‡å››ï¼šä¸»ä» æ¦‚è§ˆRedisç¯‡äº”ï¼šå“¨å…µ æ¦‚è§ˆRedisç¯‡å…­ï¼šåˆ‡ç‰‡é›†ç¾¤  ä»€ä¹ˆæ˜¯RDB æ‰€è°“RDBï¼Œå³Redis DataBaseã€‚æ˜¯å¯¹Redisåšçš„ä¸€ä¸ªå†…å­˜å¿«ç…§ï¼Œå³å°†å†…å­˜ä¸­çš„æ•°æ®åœ¨æŸä¸€ä¸ªæ—¶åˆ»çš„çŠ¶æ€è®°å½•ã€‚\nå¯¹ Redis æ¥è¯´ï¼Œå®ƒå®ç°ç±»ä¼¼ç…§ç‰‡è®°å½•æ•ˆæœçš„æ–¹å¼ï¼Œå°±æ˜¯æŠŠæŸä¸€æ—¶åˆ»çš„çŠ¶æ€ä»¥æ–‡ä»¶çš„å½¢å¼å†™åˆ°ç£ç›˜ä¸Šï¼Œä¹Ÿå°±æ˜¯å¿«ç…§ã€‚è¿™æ ·ä¸€æ¥ï¼Œå³ä½¿å®•æœºï¼Œå¿«ç…§æ–‡ä»¶ä¹Ÿä¸ä¼šä¸¢å¤±ï¼Œæ•°æ®çš„å¯é æ€§ä¹Ÿå°±å¾—åˆ°äº†ä¿è¯ã€‚è¿™ä¸ªå¿«ç…§æ–‡ä»¶å°±ç§°ä¸º RDB æ–‡ä»¶ã€‚\nå’Œ AOF ç›¸æ¯”ï¼ŒRDB è®°å½•çš„æ˜¯æŸä¸€æ—¶åˆ»çš„æ•°æ®ï¼Œå¹¶ä¸æ˜¯æ“ä½œï¼Œæ‰€ä»¥ï¼Œåœ¨åšæ•°æ®æ¢å¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æŠŠ RDB æ–‡ä»¶è¯»å…¥å†…å­˜ï¼Œå¾ˆå¿«åœ°å®Œæˆæ¢å¤ã€‚\nçµ¦å“ªäº›å†…å­˜æ•°æ®åšå¿«ç…§ çµ¦å“ªäº›å†…å­˜æ•°æ®åšå¿«ç…§ï¼Œè¿™å…³ç³»åˆ°å¿«ç…§çš„æ‰§è¡Œæ•ˆç‡ã€‚\nRedis çš„æ•°æ®éƒ½åœ¨å†…å­˜ä¸­ï¼Œä¸ºäº†æä¾›æ‰€æœ‰æ•°æ®çš„å¯é æ€§ä¿è¯ï¼Œå®ƒæ‰§è¡Œçš„æ˜¯å…¨é‡å¿«ç…§ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒæŠŠå†…å­˜ä¸­çš„æ‰€æœ‰æ•°æ®éƒ½è®°å½•åˆ°ç£ç›˜ä¸­ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œä¸€æ¬¡æ€§è®°å½•äº†æ‰€æœ‰æ•°æ®ï¼Œä¸€ä¸ªéƒ½ä¸å°‘ã€‚\nä½†ç»™å†…å­˜çš„å…¨é‡æ•°æ®åšå¿«ç…§ï¼ŒæŠŠå®ƒä»¬å…¨éƒ¨å†™å…¥ç£ç›˜ä¹Ÿä¼šèŠ±è´¹å¾ˆå¤šæ—¶é—´ã€‚è€Œä¸”ï¼Œå…¨é‡æ•°æ®è¶Šå¤šï¼ŒRDB æ–‡ä»¶å°±è¶Šå¤§ï¼Œå¾€ç£ç›˜ä¸Šå†™æ•°æ®çš„æ—¶é—´å¼€é”€å°±è¶Šå¤§ã€‚\nè¿™é‡Œæˆ‘ä»¬è¦åšä¸€ä¸ªâ€œçµé­‚ä¹‹é—®â€ï¼šRDBæ–‡ä»¶çš„ç”Ÿæˆä¼šé˜»å¡ä¸»çº¿ç¨‹å—ï¼Ÿ\nRedis æä¾›äº†ä¸¤ä¸ªå‘½ä»¤æ¥ç”Ÿæˆ RDB æ–‡ä»¶ï¼Œåˆ†åˆ«æ˜¯ save å’Œ bgsaveã€‚\n saveï¼šåœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œä¼šå¯¼è‡´é˜»å¡ï¼› bgsaveï¼šåˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œä¸“é—¨ç”¨äºå†™å…¥ RDB æ–‡ä»¶ï¼Œé¿å…äº†ä¸»çº¿ç¨‹çš„é˜»å¡ï¼Œè¿™ä¹Ÿæ˜¯ Redis RDB æ–‡ä»¶ç”Ÿæˆçš„é»˜è®¤é…ç½®ã€‚  å› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨bgsaveå‘½ä»¤æ¥æ‰§è¡Œå…¨é‡å¿«ç…§ï¼Œè¿™æ—¢æä¾›äº†æ•°æ®çš„å¯é æ€§ä¿è¯ï¼Œä¹Ÿé¿å…äº†å¯¹ Redis çš„æ€§èƒ½å½±å“ã€‚\nå¿«ç…§æ—¶æ•°æ®èƒ½ä¿®æ”¹å— è¿™ä¸ªé—®é¢˜éå¸¸é‡è¦ï¼Œè¿™æ˜¯å› ä¸ºï¼Œå¦‚æœæ•°æ®èƒ½è¢«ä¿®æ”¹ï¼Œé‚£å°±æ„å‘³ç€ Redis è¿˜èƒ½æ­£å¸¸å¤„ç†å†™æ“ä½œã€‚å¦åˆ™ï¼Œæ‰€æœ‰å†™æ“ä½œéƒ½å¾—ç­‰åˆ°å¿«ç…§å®Œäº†æ‰èƒ½æ‰§è¡Œï¼Œæ€§èƒ½ä¸€ä¸‹å­å°±é™ä½äº†ã€‚\nå¦‚æœæˆ‘ä»¬ä½¿ç”¨saveå‘½ä»¤ï¼Œæ˜¾ç„¶æ˜¯ä¸èƒ½ä¿®æ”¹çš„ï¼Œä»¥ä¸ºä¸»çº¿ç¨‹å·²ç»è¢«é˜»å¡æ‰äº†ã€‚\nå¦‚æœä½¿ç”¨bgsaveå‘½ä»¤ï¼Œçœ‹èµ·æ¥æ•°æ®è¿˜æ˜¯å¯ä»¥ä¿®æ”¹çš„ï¼Œå› ä¸ºä¸»çº¿ç¨‹æ²¡æœ‰è¢«é˜»å¡ã€‚ä½†é¿å…é˜»å¡å’Œæ­£å¸¸å¤„ç†å†™æ“ä½œå¹¶ä¸æ˜¯ä¸€å›äº‹ã€‚æ­¤æ—¶ï¼Œä¸»çº¿ç¨‹çš„ç¡®æ²¡æœ‰é˜»å¡ï¼Œå¯ä»¥æ­£å¸¸æ¥æ”¶è¯·æ±‚ï¼Œä½†æ˜¯ï¼Œä¸ºäº†ä¿è¯å¿«ç…§å®Œæ•´æ€§ï¼Œå®ƒåªèƒ½å¤„ç†è¯»æ“ä½œï¼Œå› ä¸ºä¸èƒ½ä¿®æ”¹æ­£åœ¨æ‰§è¡Œå¿«ç…§çš„æ•°æ®ã€‚\nä¸ºäº†å¿«ç…§è€Œæš‚åœå†™æ“ä½œï¼Œè‚¯å®šæ˜¯ä¸èƒ½æ¥å—çš„ã€‚æ‰€ä»¥è¿™ä¸ªæ—¶å€™ï¼ŒRedis å°±ä¼šå€ŸåŠ©æ“ä½œç³»ç»Ÿæä¾›çš„å†™æ—¶å¤åˆ¶æŠ€æœ¯ï¼ˆCopy-On-Write, COWï¼‰ï¼Œåœ¨æ‰§è¡Œå¿«ç…§çš„åŒæ—¶ï¼Œæ­£å¸¸å¤„ç†å†™æ“ä½œã€‚\nç®€å•æ¥è¯´ï¼Œbgsave å­è¿›ç¨‹æ˜¯ç”±ä¸»çº¿ç¨‹ fork ç”Ÿæˆçš„ï¼Œå¯ä»¥å…±äº«ä¸»çº¿ç¨‹çš„æ‰€æœ‰å†…å­˜æ•°æ®ã€‚bgsave å­è¿›ç¨‹è¿è¡Œåï¼Œå¼€å§‹è¯»å–ä¸»çº¿ç¨‹çš„å†…å­˜æ•°æ®ï¼Œå¹¶æŠŠå®ƒä»¬å†™å…¥ RDB æ–‡ä»¶ã€‚\næ­¤æ—¶ï¼Œå¦‚æœä¸»çº¿ç¨‹å¯¹è¿™äº›æ•°æ®ä¹Ÿéƒ½æ˜¯è¯»æ“ä½œï¼ˆä¾‹å¦‚å›¾ä¸­çš„é”®å€¼å¯¹ Aï¼‰ï¼Œé‚£ä¹ˆï¼Œä¸»çº¿ç¨‹å’Œ bgsave å­è¿›ç¨‹ç›¸äº’ä¸å½±å“ã€‚ä½†æ˜¯ï¼Œå¦‚æœä¸»çº¿ç¨‹è¦ä¿®æ”¹ä¸€å—æ•°æ®ï¼ˆä¾‹å¦‚å›¾ä¸­çš„é”®å€¼å¯¹ Cï¼‰ï¼Œé‚£ä¹ˆï¼Œè¿™å—æ•°æ®å°±ä¼šè¢«å¤åˆ¶ä¸€ä»½ï¼Œç”Ÿæˆè¯¥æ•°æ®çš„å‰¯æœ¬ï¼ˆé”®å€¼å¯¹ Câ€™ï¼‰ã€‚ç„¶åï¼Œä¸»çº¿ç¨‹åœ¨è¿™ä¸ªæ•°æ®å‰¯æœ¬ä¸Šè¿›è¡Œä¿®æ”¹ã€‚åŒæ—¶ï¼Œbgsave å­è¿›ç¨‹å¯ä»¥ç»§ç»­æŠŠåŸæ¥çš„æ•°æ®ï¼ˆé”®å€¼å¯¹ Cï¼‰å†™å…¥ RDB æ–‡ä»¶ã€‚\nè¿™æ—¢ä¿è¯äº†å¿«ç…§çš„å®Œæ•´æ€§ï¼Œä¹Ÿå…è®¸ä¸»çº¿ç¨‹åŒæ—¶å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œé¿å…äº†å¯¹æ­£å¸¸ä¸šåŠ¡çš„å½±å“ã€‚\nå¯ä»¥è¿æ‹å— å¯¹äºå¿«ç…§æ¥è¯´ï¼Œæ‰€è°“â€œè¿æ‹â€å°±æ˜¯æŒ‡è¿ç»­åœ°åšå¿«ç…§ã€‚è¿™æ ·ä¸€æ¥ï¼Œå¿«ç…§çš„é—´éš”æ—¶é—´å˜å¾—å¾ˆçŸ­ï¼Œå³ä½¿æŸä¸€æ—¶åˆ»å‘ç”Ÿå®•æœºäº†ï¼Œå› ä¸ºä¸Šä¸€æ—¶åˆ»å¿«ç…§åˆšæ‰§è¡Œï¼Œä¸¢å¤±çš„æ•°æ®ä¹Ÿä¸ä¼šå¤ªå¤šã€‚\nä½†æ˜¯ï¼Œå¦‚æœé¢‘ç¹åœ°æ‰§è¡Œå…¨é‡å¿«ç…§ï¼Œä¹Ÿä¼šå¸¦æ¥ä¸¤æ–¹é¢çš„å¼€é”€ã€‚\n  é¢‘ç¹å°†å…¨é‡æ•°æ®å†™å…¥ç£ç›˜ï¼Œä¼šç»™ç£ç›˜å¸¦æ¥å¾ˆå¤§å‹åŠ›ï¼Œå¤šä¸ªå¿«ç…§ç«äº‰æœ‰é™çš„ç£ç›˜å¸¦å®½ï¼Œå‰ä¸€ä¸ªå¿«ç…§è¿˜æ²¡æœ‰åšå®Œï¼Œåä¸€ä¸ªåˆå¼€å§‹åšäº†ï¼Œå®¹æ˜“é€ æˆæ¶æ€§å¾ªç¯ã€‚\n  bgsave å­è¿›ç¨‹éœ€è¦é€šè¿‡ fork æ“ä½œä»ä¸»çº¿ç¨‹åˆ›å»ºå‡ºæ¥ã€‚è™½ç„¶ï¼Œå­è¿›ç¨‹åœ¨åˆ›å»ºåä¸ä¼šå†é˜»å¡ä¸»çº¿ç¨‹ï¼Œä½†æ˜¯ï¼Œfork è¿™ä¸ªåˆ›å»ºè¿‡ç¨‹æœ¬èº«ä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼Œè€Œä¸”ä¸»çº¿ç¨‹çš„å†…å­˜è¶Šå¤§ï¼Œé˜»å¡æ—¶é—´è¶Šé•¿ã€‚å¦‚æœé¢‘ç¹ fork å‡º bgsave å­è¿›ç¨‹ï¼Œè¿™å°±ä¼šé¢‘ç¹é˜»å¡ä¸»çº¿ç¨‹äº†\n  é‚£ä¹ˆï¼Œå¦‚ä½•é˜²æ­¢åœ¨ä¸Šä¸€æ¬¡å¿«ç…§ä¹‹åä¿®æ”¹çš„æ•°æ®ä¸¢å¤±å‘¢ï¼Ÿ\nå¯ä»¥ä½¿ç”¨å¢é‡å¿«ç…§ï¼Œæ‰€è°“å¢é‡å¿«ç…§ï¼Œå°±æ˜¯æŒ‡ï¼Œåšäº†ä¸€æ¬¡å…¨é‡å¿«ç…§åï¼Œåç»­çš„å¿«ç…§åªå¯¹ä¿®æ”¹çš„æ•°æ®è¿›è¡Œå¿«ç…§è®°å½•ï¼Œè¿™æ ·å¯ä»¥é¿å…æ¯æ¬¡å…¨é‡å¿«ç…§çš„å¼€é”€ã€‚\nä½†è¿™æ ·åˆå¸¦æ¥å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼šåšå¢é‡å¿«ç…§éœ€è¦è®°ä½å“ªäº›æ•°æ®è¢«ä¿®æ”¹äº†ï¼Œè¿™åˆæ˜¯ä¸€ç¬”ä¸å°çš„å†…å­˜å¼€é”€ã€‚\nå¯¹æ¯”ä¹‹å‰çš„AOFæ—¥å¿—å¯ä»¥å‘ç°ï¼Œå¿«ç…§çš„æ¢å¤é€Ÿåº¦è¾ƒå¿«ï¼Œä½†é¢‘ç‡ä¸å¥½æŠŠæ¡ï¼Œå¦‚æœé¢‘ç‡å¤ªä½ï¼Œä¸¤æ¬¡å¿«ç…§é—´ä¸€æ—¦å®•æœºï¼Œå°±å¯èƒ½æœ‰æ¯”è¾ƒå¤šçš„æ•°æ®ä¸¢å¤±ã€‚å¦‚æœé¢‘ç‡å¤ªé«˜ï¼Œåˆä¼šäº§ç”Ÿé¢å¤–å¼€é”€ã€‚\nRedis 4.0 ä¸­æå‡ºäº†ä¸€ä¸ªæ··åˆä½¿ç”¨ AOF æ—¥å¿—å’Œå†…å­˜å¿«ç…§çš„æ–¹æ³•ã€‚ç®€å•æ¥è¯´ï¼Œå†…å­˜å¿«ç…§ä»¥ä¸€å®šçš„é¢‘ç‡æ‰§è¡Œï¼Œåœ¨ä¸¤æ¬¡å¿«ç…§ä¹‹é—´ï¼Œä½¿ç”¨ AOF æ—¥å¿—è®°å½•è¿™æœŸé—´çš„æ‰€æœ‰å‘½ä»¤æ“ä½œã€‚\nè¿™æ ·ä¸€æ¥ï¼Œå¿«ç…§ä¸ç”¨å¾ˆé¢‘ç¹åœ°æ‰§è¡Œï¼Œè¿™å°±é¿å…äº†é¢‘ç¹ fork å¯¹ä¸»çº¿ç¨‹çš„å½±å“ã€‚è€Œä¸”ï¼ŒAOF æ—¥å¿—ä¹Ÿåªç”¨è®°å½•ä¸¤æ¬¡å¿«ç…§é—´çš„æ“ä½œï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸éœ€è¦è®°å½•æ‰€æœ‰æ“ä½œäº†ï¼Œå› æ­¤ï¼Œå°±ä¸ä¼šå‡ºç°æ–‡ä»¶è¿‡å¤§çš„æƒ…å†µäº†ï¼Œä¹Ÿå¯ä»¥é¿å…é‡å†™å¼€é”€ã€‚\nå¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒT1 å’Œ T2 æ—¶åˆ»çš„ä¿®æ”¹ï¼Œç”¨ AOF æ—¥å¿—è®°å½•ï¼Œç­‰åˆ°ç¬¬äºŒæ¬¡åšå…¨é‡å¿«ç…§æ—¶ï¼Œå°±å¯ä»¥æ¸…ç©º AOF æ—¥å¿—ï¼Œå› ä¸ºæ­¤æ—¶çš„ä¿®æ”¹éƒ½å·²ç»è®°å½•åˆ°å¿«ç…§ä¸­äº†ï¼Œæ¢å¤æ—¶å°±ä¸å†ç”¨æ—¥å¿—äº†ã€‚\nå…³äºAOFå’ŒRDBçš„é€‰æ‹©  æ•°æ®ä¸èƒ½ä¸¢å¤±æ—¶ï¼Œå†…å­˜å¿«ç…§å’Œ AOF çš„æ··åˆä½¿ç”¨æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼› å¦‚æœå…è®¸åˆ†é’Ÿçº§åˆ«çš„æ•°æ®ä¸¢å¤±ï¼Œå¯ä»¥åªä½¿ç”¨ RDBï¼› å¦‚æœåªç”¨ AOFï¼Œä¼˜å…ˆä½¿ç”¨ everysec çš„é…ç½®é€‰é¡¹ï¼Œå› ä¸ºå®ƒåœ¨å¯é æ€§å’Œæ€§èƒ½ä¹‹é—´å–äº†ä¸€ä¸ªå¹³è¡¡ã€‚  ","permalink":"http://yangchnet.github.io/Dessert/posts/cache/%E6%A6%82%E8%A7%88redis%E7%AF%87%E4%B8%89rdb%E5%BF%AB%E7%85%A7/","summary":"æå®¢æ—¶é—´ã€ŠRedis æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜ã€‹å­¦ä¹ ç¬”è®°\n  æ¦‚è§ˆRedisç¯‡ä¸€ï¼šå•çº¿ç¨‹æ¨¡å‹ æ¦‚è§ˆRedisç¯‡äºŒï¼šAOFæ—¥å¿— æ¦‚è§ˆRedisç¯‡ä¸‰ï¼šRDBå¿«ç…§ æ¦‚è§ˆRedisç¯‡å››ï¼šä¸»ä» æ¦‚è§ˆRedisç¯‡äº”ï¼šå“¨å…µ æ¦‚è§ˆRedisç¯‡å…­ï¼šåˆ‡ç‰‡é›†ç¾¤  ä»€ä¹ˆæ˜¯RDB æ‰€è°“RDBï¼Œå³Redis DataBaseã€‚æ˜¯å¯¹Redisåšçš„ä¸€ä¸ªå†…å­˜å¿«ç…§ï¼Œå³å°†å†…å­˜ä¸­çš„æ•°æ®åœ¨æŸä¸€ä¸ªæ—¶åˆ»çš„çŠ¶æ€è®°å½•ã€‚\nå¯¹ Redis æ¥è¯´ï¼Œå®ƒå®ç°ç±»ä¼¼ç…§ç‰‡è®°å½•æ•ˆæœçš„æ–¹å¼ï¼Œå°±æ˜¯æŠŠæŸä¸€æ—¶åˆ»çš„çŠ¶æ€ä»¥æ–‡ä»¶çš„å½¢å¼å†™åˆ°ç£ç›˜ä¸Šï¼Œä¹Ÿå°±æ˜¯å¿«ç…§ã€‚è¿™æ ·ä¸€æ¥ï¼Œå³ä½¿å®•æœºï¼Œå¿«ç…§æ–‡ä»¶ä¹Ÿä¸ä¼šä¸¢å¤±ï¼Œæ•°æ®çš„å¯é æ€§ä¹Ÿå°±å¾—åˆ°äº†ä¿è¯ã€‚è¿™ä¸ªå¿«ç…§æ–‡ä»¶å°±ç§°ä¸º RDB æ–‡ä»¶ã€‚\nå’Œ AOF ç›¸æ¯”ï¼ŒRDB è®°å½•çš„æ˜¯æŸä¸€æ—¶åˆ»çš„æ•°æ®ï¼Œå¹¶ä¸æ˜¯æ“ä½œï¼Œæ‰€ä»¥ï¼Œåœ¨åšæ•°æ®æ¢å¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æŠŠ RDB æ–‡ä»¶è¯»å…¥å†…å­˜ï¼Œå¾ˆå¿«åœ°å®Œæˆæ¢å¤ã€‚\nçµ¦å“ªäº›å†…å­˜æ•°æ®åšå¿«ç…§ çµ¦å“ªäº›å†…å­˜æ•°æ®åšå¿«ç…§ï¼Œè¿™å…³ç³»åˆ°å¿«ç…§çš„æ‰§è¡Œæ•ˆç‡ã€‚\nRedis çš„æ•°æ®éƒ½åœ¨å†…å­˜ä¸­ï¼Œä¸ºäº†æä¾›æ‰€æœ‰æ•°æ®çš„å¯é æ€§ä¿è¯ï¼Œå®ƒæ‰§è¡Œçš„æ˜¯å…¨é‡å¿«ç…§ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒæŠŠå†…å­˜ä¸­çš„æ‰€æœ‰æ•°æ®éƒ½è®°å½•åˆ°ç£ç›˜ä¸­ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œä¸€æ¬¡æ€§è®°å½•äº†æ‰€æœ‰æ•°æ®ï¼Œä¸€ä¸ªéƒ½ä¸å°‘ã€‚\nä½†ç»™å†…å­˜çš„å…¨é‡æ•°æ®åšå¿«ç…§ï¼ŒæŠŠå®ƒä»¬å…¨éƒ¨å†™å…¥ç£ç›˜ä¹Ÿä¼šèŠ±è´¹å¾ˆå¤šæ—¶é—´ã€‚è€Œä¸”ï¼Œå…¨é‡æ•°æ®è¶Šå¤šï¼ŒRDB æ–‡ä»¶å°±è¶Šå¤§ï¼Œå¾€ç£ç›˜ä¸Šå†™æ•°æ®çš„æ—¶é—´å¼€é”€å°±è¶Šå¤§ã€‚\nè¿™é‡Œæˆ‘ä»¬è¦åšä¸€ä¸ªâ€œçµé­‚ä¹‹é—®â€ï¼šRDBæ–‡ä»¶çš„ç”Ÿæˆä¼šé˜»å¡ä¸»çº¿ç¨‹å—ï¼Ÿ\nRedis æä¾›äº†ä¸¤ä¸ªå‘½ä»¤æ¥ç”Ÿæˆ RDB æ–‡ä»¶ï¼Œåˆ†åˆ«æ˜¯ save å’Œ bgsaveã€‚\n saveï¼šåœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œä¼šå¯¼è‡´é˜»å¡ï¼› bgsaveï¼šåˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œä¸“é—¨ç”¨äºå†™å…¥ RDB æ–‡ä»¶ï¼Œé¿å…äº†ä¸»çº¿ç¨‹çš„é˜»å¡ï¼Œè¿™ä¹Ÿæ˜¯ Redis RDB æ–‡ä»¶ç”Ÿæˆçš„é»˜è®¤é…ç½®ã€‚  å› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨bgsaveå‘½ä»¤æ¥æ‰§è¡Œå…¨é‡å¿«ç…§ï¼Œè¿™æ—¢æä¾›äº†æ•°æ®çš„å¯é æ€§ä¿è¯ï¼Œä¹Ÿé¿å…äº†å¯¹ Redis çš„æ€§èƒ½å½±å“ã€‚\nå¿«ç…§æ—¶æ•°æ®èƒ½ä¿®æ”¹å— è¿™ä¸ªé—®é¢˜éå¸¸é‡è¦ï¼Œè¿™æ˜¯å› ä¸ºï¼Œå¦‚æœæ•°æ®èƒ½è¢«ä¿®æ”¹ï¼Œé‚£å°±æ„å‘³ç€ Redis è¿˜èƒ½æ­£å¸¸å¤„ç†å†™æ“ä½œã€‚å¦åˆ™ï¼Œæ‰€æœ‰å†™æ“ä½œéƒ½å¾—ç­‰åˆ°å¿«ç…§å®Œäº†æ‰èƒ½æ‰§è¡Œï¼Œæ€§èƒ½ä¸€ä¸‹å­å°±é™ä½äº†ã€‚\nå¦‚æœæˆ‘ä»¬ä½¿ç”¨saveå‘½ä»¤ï¼Œæ˜¾ç„¶æ˜¯ä¸èƒ½ä¿®æ”¹çš„ï¼Œä»¥ä¸ºä¸»çº¿ç¨‹å·²ç»è¢«é˜»å¡æ‰äº†ã€‚\nå¦‚æœä½¿ç”¨bgsaveå‘½ä»¤ï¼Œçœ‹èµ·æ¥æ•°æ®è¿˜æ˜¯å¯ä»¥ä¿®æ”¹çš„ï¼Œå› ä¸ºä¸»çº¿ç¨‹æ²¡æœ‰è¢«é˜»å¡ã€‚ä½†é¿å…é˜»å¡å’Œæ­£å¸¸å¤„ç†å†™æ“ä½œå¹¶ä¸æ˜¯ä¸€å›äº‹ã€‚æ­¤æ—¶ï¼Œä¸»çº¿ç¨‹çš„ç¡®æ²¡æœ‰é˜»å¡ï¼Œå¯ä»¥æ­£å¸¸æ¥æ”¶è¯·æ±‚ï¼Œä½†æ˜¯ï¼Œä¸ºäº†ä¿è¯å¿«ç…§å®Œæ•´æ€§ï¼Œå®ƒåªèƒ½å¤„ç†è¯»æ“ä½œï¼Œå› ä¸ºä¸èƒ½ä¿®æ”¹æ­£åœ¨æ‰§è¡Œå¿«ç…§çš„æ•°æ®ã€‚\nä¸ºäº†å¿«ç…§è€Œæš‚åœå†™æ“ä½œï¼Œè‚¯å®šæ˜¯ä¸èƒ½æ¥å—çš„ã€‚æ‰€ä»¥è¿™ä¸ªæ—¶å€™ï¼ŒRedis å°±ä¼šå€ŸåŠ©æ“ä½œç³»ç»Ÿæä¾›çš„å†™æ—¶å¤åˆ¶æŠ€æœ¯ï¼ˆCopy-On-Write, COWï¼‰ï¼Œåœ¨æ‰§è¡Œå¿«ç…§çš„åŒæ—¶ï¼Œæ­£å¸¸å¤„ç†å†™æ“ä½œã€‚\nç®€å•æ¥è¯´ï¼Œbgsave å­è¿›ç¨‹æ˜¯ç”±ä¸»çº¿ç¨‹ fork ç”Ÿæˆçš„ï¼Œå¯ä»¥å…±äº«ä¸»çº¿ç¨‹çš„æ‰€æœ‰å†…å­˜æ•°æ®ã€‚bgsave å­è¿›ç¨‹è¿è¡Œåï¼Œå¼€å§‹è¯»å–ä¸»çº¿ç¨‹çš„å†…å­˜æ•°æ®ï¼Œå¹¶æŠŠå®ƒä»¬å†™å…¥ RDB æ–‡ä»¶ã€‚\næ­¤æ—¶ï¼Œå¦‚æœä¸»çº¿ç¨‹å¯¹è¿™äº›æ•°æ®ä¹Ÿéƒ½æ˜¯è¯»æ“ä½œï¼ˆä¾‹å¦‚å›¾ä¸­çš„é”®å€¼å¯¹ Aï¼‰ï¼Œé‚£ä¹ˆï¼Œä¸»çº¿ç¨‹å’Œ bgsave å­è¿›ç¨‹ç›¸äº’ä¸å½±å“ã€‚ä½†æ˜¯ï¼Œå¦‚æœä¸»çº¿ç¨‹è¦ä¿®æ”¹ä¸€å—æ•°æ®ï¼ˆä¾‹å¦‚å›¾ä¸­çš„é”®å€¼å¯¹ Cï¼‰ï¼Œé‚£ä¹ˆï¼Œè¿™å—æ•°æ®å°±ä¼šè¢«å¤åˆ¶ä¸€ä»½ï¼Œç”Ÿæˆè¯¥æ•°æ®çš„å‰¯æœ¬ï¼ˆé”®å€¼å¯¹ Câ€™ï¼‰ã€‚ç„¶åï¼Œä¸»çº¿ç¨‹åœ¨è¿™ä¸ªæ•°æ®å‰¯æœ¬ä¸Šè¿›è¡Œä¿®æ”¹ã€‚åŒæ—¶ï¼Œbgsave å­è¿›ç¨‹å¯ä»¥ç»§ç»­æŠŠåŸæ¥çš„æ•°æ®ï¼ˆé”®å€¼å¯¹ Cï¼‰å†™å…¥ RDB æ–‡ä»¶ã€‚","title":"æ¦‚è§ˆRedisç¯‡ä¸‰ï¼šRDBå¿«ç…§"},{"content":" æå®¢æ—¶é—´ã€ŠRedis æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜ã€‹å­¦ä¹ ç¬”è®°\n  æ¦‚è§ˆRedisç¯‡ä¸€ï¼šå•çº¿ç¨‹æ¨¡å‹ æ¦‚è§ˆRedisç¯‡äºŒï¼šAOFæ—¥å¿— æ¦‚è§ˆRedisç¯‡ä¸‰ï¼šRDBå¿«ç…§ æ¦‚è§ˆRedisç¯‡å››ï¼šä¸»ä» æ¦‚è§ˆRedisç¯‡äº”ï¼šå“¨å…µ æ¦‚è§ˆRedisç¯‡å…­ï¼šåˆ‡ç‰‡é›†ç¾¤  ä»€ä¹ˆæ˜¯å“¨å…µï¼Œå“¨å…µæœ‰ä»€ä¹ˆç”¨ å“¨å…µå…¶å®å°±æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨ç‰¹æ®Šæ¨¡å¼ä¸‹çš„ Redis è¿›ç¨‹ï¼Œä¸»ä»åº“å®ä¾‹è¿è¡Œçš„åŒæ—¶ï¼Œå®ƒä¹Ÿåœ¨è¿è¡Œã€‚å“¨å…µä¸»è¦è´Ÿè´£çš„å°±æ˜¯ä¸‰ä¸ªä»»åŠ¡ï¼šç›‘æ§ã€é€‰ä¸»ï¼ˆé€‰æ‹©ä¸»åº“ï¼‰å’Œé€šçŸ¥ã€‚\næœ‰äº†å“¨å…µï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ä¸»åº“æ•…éšœçš„æƒ…å†µä¸‹å¿«é€Ÿå®ç°ä¸»ä»åº“è‡ªåŠ¨åˆ‡æ¢ã€‚\nå“¨å…µæœºåˆ¶çš„åŸºæœ¬æµç¨‹  ç›‘æ§  å“¨å…µåœ¨è¿è¡Œæ—¶ï¼Œä¼šå‘¨æœŸæ€§åœ°ç»™æ‰€æœ‰çš„ä¸»ä»åº“å‘é€ PING å‘½ä»¤ï¼Œæ£€æµ‹å®ƒä»¬æ˜¯å¦ä»ç„¶åœ¨çº¿è¿è¡Œã€‚å¦‚æœä»åº“æ²¡æœ‰åœ¨è§„å®šæ—¶é—´å†…å“åº”å“¨å…µçš„ PING å‘½ä»¤ï¼Œå“¨å…µå°±ä¼šæŠŠå®ƒæ ‡è®°ä¸ºâ€œä¸‹çº¿çŠ¶æ€â€ï¼›åŒæ ·ï¼Œå¦‚æœä¸»åº“ä¹Ÿæ²¡æœ‰åœ¨è§„å®šæ—¶é—´å†…å“åº”å“¨å…µçš„ PING å‘½ä»¤ï¼Œå“¨å…µå°±ä¼šåˆ¤å®šä¸»åº“ä¸‹çº¿ï¼Œç„¶åå¼€å§‹è‡ªåŠ¨åˆ‡æ¢ä¸»åº“çš„æµç¨‹ã€‚\né€‰ä¸»  ä¸»åº“æŒ‚äº†ä»¥åï¼Œå“¨å…µå°±éœ€è¦ä»å¾ˆå¤šä¸ªä»åº“é‡Œï¼ŒæŒ‰ç…§ä¸€å®šçš„è§„åˆ™é€‰æ‹©ä¸€ä¸ªä»åº“å®ä¾‹ï¼ŒæŠŠå®ƒä½œä¸ºæ–°çš„ä¸»åº“ã€‚\né€šçŸ¥  åœ¨é€‰å‡ºæ–°çš„ä¸»åº“åï¼Œå“¨å…µä¼šæŠŠæ–°ä¸»åº“çš„è¿æ¥ä¿¡æ¯å‘ç»™å…¶ä»–ä»åº“ï¼Œè®©å®ƒä»¬æ‰§è¡Œ replicaof å‘½ä»¤ï¼Œå’Œæ–°ä¸»åº“å»ºç«‹è¿æ¥ï¼Œå¹¶è¿›è¡Œæ•°æ®å¤åˆ¶ã€‚åŒæ—¶ï¼Œå“¨å…µä¼šæŠŠæ–°ä¸»åº“çš„è¿æ¥ä¿¡æ¯é€šçŸ¥ç»™å®¢æˆ·ç«¯ï¼Œè®©å®ƒä»¬æŠŠè¯·æ±‚æ“ä½œå‘åˆ°æ–°ä¸»åº“ä¸Šã€‚\nå“¨å…µå¦‚ä½•åˆ¤æ–­ä¸»åº“æ˜¯å¦ä¸‹çº¿  ä¸»è§‚ä¸‹çº¿  å“¨å…µè¿›ç¨‹ä¼šä½¿ç”¨ PING å‘½ä»¤æ£€æµ‹å®ƒè‡ªå·±å’Œä¸»ã€ä»åº“çš„ç½‘ç»œè¿æ¥æƒ…å†µï¼Œç”¨æ¥åˆ¤æ–­å®ä¾‹çš„çŠ¶æ€ã€‚å¦‚æœå“¨å…µå‘ç°ä¸»åº“æˆ–ä»åº“å¯¹ PING å‘½ä»¤çš„å“åº”è¶…æ—¶äº†ï¼Œé‚£ä¹ˆï¼Œå“¨å…µå°±ä¼šå…ˆæŠŠå®ƒæ ‡è®°ä¸ºâ€œä¸»è§‚ä¸‹çº¿â€\nå¦‚æœæ£€æµ‹çš„æ˜¯ä»åº“ï¼Œé‚£ä¹ˆï¼Œå“¨å…µç®€å•åœ°æŠŠå®ƒæ ‡è®°ä¸ºâ€œä¸»è§‚ä¸‹çº¿â€å°±è¡Œäº†ï¼Œå› ä¸ºä»åº“çš„ä¸‹çº¿å½±å“ä¸€èˆ¬ä¸å¤ªå¤§ï¼Œé›†ç¾¤çš„å¯¹å¤–æœåŠ¡ä¸ä¼šé—´æ–­ã€‚\nä½†æ˜¯ï¼Œå¦‚æœæ£€æµ‹çš„æ˜¯ä¸»åº“ï¼Œé‚£ä¹ˆï¼Œå“¨å…µè¿˜ä¸èƒ½ç®€å•åœ°æŠŠå®ƒæ ‡è®°ä¸ºâ€œä¸»è§‚ä¸‹çº¿â€ï¼Œå¼€å¯ä¸»ä»åˆ‡æ¢ã€‚å› ä¸ºå¾ˆæœ‰å¯èƒ½å­˜åœ¨è¿™ä¹ˆä¸€ä¸ªæƒ…å†µï¼šé‚£å°±æ˜¯å“¨å…µè¯¯åˆ¤äº†ï¼Œå…¶å®ä¸»åº“å¹¶æ²¡æœ‰æ•…éšœã€‚å¯æ˜¯ï¼Œä¸€æ—¦å¯åŠ¨äº†ä¸»ä»åˆ‡æ¢ï¼Œåç»­çš„é€‰ä¸»å’Œé€šçŸ¥æ“ä½œéƒ½ä¼šå¸¦æ¥é¢å¤–çš„è®¡ç®—å’Œé€šä¿¡å¼€é”€ã€‚\nå› æ­¤æˆ‘ä»¬è¦ç‰¹åˆ«æ³¨æ„è¯¯åˆ¤çš„æƒ…å†µã€‚\nä¸ºäº†å‡å°‘è¯¯åˆ¤ï¼Œå¯ä»¥é‡‡ç”¨å¤šå®ä¾‹ç»„æˆçš„é›†ç¾¤æ¨¡å¼è¿›è¡Œéƒ¨ç½²ï¼Œè¿™ä¹Ÿè¢«ç§°ä¸ºå“¨å…µé›†ç¾¤ã€‚å¼•å…¥å¤šä¸ªå“¨å…µå®ä¾‹ä¸€èµ·æ¥åˆ¤æ–­ï¼Œå°±å¯ä»¥é¿å…å•ä¸ªå“¨å…µå› ä¸ºè‡ªèº«ç½‘ç»œçŠ¶å†µä¸å¥½ï¼Œè€Œè¯¯åˆ¤ä¸»åº“ä¸‹çº¿çš„æƒ…å†µã€‚åŒæ—¶ï¼Œå¤šä¸ªå“¨å…µçš„ç½‘ç»œåŒæ—¶ä¸ç¨³å®šçš„æ¦‚ç‡è¾ƒå°ï¼Œç”±å®ƒä»¬ä¸€èµ·åšå†³ç­–ï¼Œè¯¯åˆ¤ç‡ä¹Ÿèƒ½é™ä½ã€‚\nå®¢è§‚ä¸‹çº¿  å½“å¤§å¤šæ•°çš„å“¨å…µå®ä¾‹ï¼Œéƒ½åˆ¤æ–­ä¸»åº“å·²ç»â€œä¸»è§‚ä¸‹çº¿â€äº†ï¼Œä¸»åº“æ‰ä¼šè¢«æ ‡è®°ä¸ºâ€œå®¢è§‚ä¸‹çº¿â€ï¼Œè¿™ä¸ªå«æ³•ä¹Ÿæ˜¯è¡¨æ˜ä¸»åº“ä¸‹çº¿æˆä¸ºä¸€ä¸ªå®¢è§‚äº‹å®äº†ã€‚\nå¦‚ä½•é€‰æ‹©æ–°ä¸»åº“ ç®€å•æ¥è¯´ï¼Œå“¨å…µé€‰æ‹©æ–°ä¸»åº“çš„è¿‡ç¨‹å¯ä»¥æè¿°ä¸ºâ€œç­›é€‰+æ‰“åˆ†â€ã€‚ç­›é€‰æ˜¯è¯´ï¼Œæˆ‘ä»¬åœ¨å¤šä¸ªä»åº“ä¸­ï¼Œå…ˆæŒ‰ç…§ä¸€å®šçš„ç­›é€‰æ¡ä»¶ï¼ŒæŠŠä¸ç¬¦åˆæ¡ä»¶çš„ä»åº“å»æ‰ã€‚è€Œæ‰“åˆ†æ„æ€æ˜¯æŒ‰ç…§ä¸€å®šçš„è§„åˆ™ï¼Œç»™å‰©ä¸‹çš„ä»åº“é€ä¸ªæ‰“åˆ†ï¼Œå°†å¾—åˆ†æœ€é«˜çš„ä»åº“é€‰ä¸ºæ–°ä¸»åº“ï¼Œ\né‚£ä¹ˆç­›é€‰å’Œæ‰“åˆ†çš„æ ‡å‡†æ˜¯æ€æ ·çš„ï¼Ÿ\nåœ¨ç­›é€‰æ—¶ï¼Œé™¤äº†è¦æ£€æŸ¥ä»åº“çš„å½“å‰åœ¨çº¿çŠ¶æ€ï¼Œè¿˜è¦åˆ¤æ–­å®ƒä¹‹å‰çš„ç½‘ç»œè¿æ¥çŠ¶æ€ã€‚ä½¿ç”¨é…ç½®é¡¹ down-after-milliseconds * 10ã€‚å…¶ä¸­ï¼Œdown-after-milliseconds æ˜¯æˆ‘ä»¬è®¤å®šä¸»ä»åº“æ–­è¿çš„æœ€å¤§è¿æ¥è¶…æ—¶æ—¶é—´ã€‚å¦‚æœåœ¨ down-after-milliseconds æ¯«ç§’å†…ï¼Œä¸»ä»èŠ‚ç‚¹éƒ½æ²¡æœ‰é€šè¿‡ç½‘ç»œè”ç³»ä¸Šï¼Œæˆ‘ä»¬å°±å¯ä»¥è®¤ä¸ºä¸»ä»èŠ‚ç‚¹æ–­è¿äº†ã€‚å¦‚æœå‘ç”Ÿæ–­è¿çš„æ¬¡æ•°è¶…è¿‡äº† 10 æ¬¡ï¼Œå°±è¯´æ˜è¿™ä¸ªä»åº“çš„ç½‘ç»œçŠ¶å†µä¸å¥½ï¼Œä¸é€‚åˆä½œä¸ºæ–°ä¸»åº“ã€‚\nç­›æ‰äº†ä¸é€‚åˆåšä¸»åº“çš„ä»åº“åï¼Œéœ€è¦å¯¹å‰©ä¸‹çš„ä»åº“è¿›è¡Œæ‰“åˆ†ã€‚åˆ†åˆ«æŒ‰ç…§ä¸€ä¸‹ä¸‰ä¸ªè§„åˆ™è¿›è¡Œä¸‰è½®ï¼š\n  ä¼˜å…ˆçº§æœ€é«˜çš„ä»åº“å¾—åˆ†é«˜ã€‚ ç”¨æˆ·å¯ä»¥é€šè¿‡ slave-priority é…ç½®é¡¹ï¼Œç»™ä¸åŒçš„ä»åº“è®¾ç½®ä¸åŒä¼˜å…ˆçº§ã€‚\n  å’Œæ—§ä¸»åº“åŒæ­¥ç¨‹åº¦æœ€æ¥è¿‘çš„ä»åº“å¾—åˆ†é«˜ å¦‚æœåœ¨æ‰€æœ‰ä»åº“ä¸­ï¼Œæœ‰ä»åº“çš„ slave_repl_offset æœ€æ¥è¿‘ master_repl_offsetï¼Œé‚£ä¹ˆå®ƒçš„å¾—åˆ†å°±æœ€é«˜ï¼Œå¯ä»¥ä½œä¸ºæ–°ä¸»åº“ã€‚\n  ID å·å°çš„ä»åº“å¾—åˆ†é«˜ Redis åœ¨é€‰ä¸»åº“æ—¶ï¼Œæœ‰ä¸€ä¸ªé»˜è®¤çš„è§„å®šï¼šåœ¨ä¼˜å…ˆçº§å’Œå¤åˆ¶è¿›åº¦éƒ½ç›¸åŒçš„æƒ…å†µä¸‹ï¼ŒID å·æœ€å°çš„ä»åº“å¾—åˆ†æœ€é«˜ï¼Œä¼šè¢«é€‰ä¸ºæ–°ä¸»åº“ã€‚\n  åœ¨ä¸‰è½®æ‰“åˆ†è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæœ‰ä¸€ä¸ªä»åº“åœ¨æŸè½®å¾—åˆ†æœ€é«˜ï¼Œé‚£ä¹ˆå…¶ç›´æ¥æˆä¸ºä¸»åº“ï¼Œä¸ç”¨å†è¿›è¡Œæ‰“åˆ†ã€‚\nåŸºäº pub/sub æœºåˆ¶çš„å“¨å…µé›†ç¾¤ç»„æˆ å“¨å…µé¦–å…ˆéœ€è¦çŸ¥é“ä¸»åº“çš„ipå’Œç«¯å£ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤é…ç½®ï¼š\nsentinel monitor \u0026lt;master-name\u0026gt; \u0026lt;ip\u0026gt; \u0026lt;redis-port\u0026gt; \u0026lt;quorum\u0026gt; å“¨å…µå®ä¾‹ä¹‹é—´å¯ä»¥ç›¸äº’å‘ç°ï¼Œè¦å½’åŠŸäº Redis æä¾›çš„ pub/sub æœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯å‘å¸ƒ/è®¢é˜…æœºåˆ¶ã€‚\nå“¨å…µåªè¦å’Œä¸»åº“å»ºç«‹èµ·äº†è¿æ¥ï¼Œå°±å¯ä»¥åœ¨ä¸»åº“ä¸Šå‘å¸ƒæ¶ˆæ¯äº†ï¼Œæ¯”å¦‚è¯´å‘å¸ƒå®ƒè‡ªå·±çš„è¿æ¥ä¿¡æ¯ï¼ˆIP å’Œç«¯å£ï¼‰ã€‚åŒæ—¶ï¼Œå®ƒä¹Ÿå¯ä»¥ä»ä¸»åº“ä¸Šè®¢é˜…æ¶ˆæ¯ï¼Œè·å¾—å…¶ä»–å“¨å…µå‘å¸ƒçš„è¿æ¥ä¿¡æ¯ã€‚å½“å¤šä¸ªå“¨å…µå®ä¾‹éƒ½åœ¨ä¸»åº“ä¸Šåšäº†å‘å¸ƒå’Œè®¢é˜…æ“ä½œåï¼Œå®ƒä»¬ä¹‹é—´å°±èƒ½çŸ¥é“å½¼æ­¤çš„ IP åœ°å€å’Œç«¯å£ã€‚\nåœ¨ä¸»ä»é›†ç¾¤ä¸­ï¼Œä¸»åº“ä¸Šæœ‰ä¸€ä¸ªåä¸º__sentinel__:helloçš„é¢‘é“ï¼Œä¸åŒå“¨å…µå°±æ˜¯é€šè¿‡å®ƒæ¥ç›¸äº’å‘ç°ï¼Œå®ç°äº’ç›¸é€šä¿¡çš„ã€‚\nå“¨å…µé™¤äº†å½¼æ­¤ä¹‹é—´å»ºç«‹èµ·è¿æ¥å½¢æˆé›†ç¾¤å¤–ï¼Œè¿˜éœ€è¦å’Œä»åº“å»ºç«‹è¿æ¥ã€‚è¿™æ˜¯å› ä¸ºï¼Œåœ¨å“¨å…µçš„ç›‘æ§ä»»åŠ¡ä¸­ï¼Œå®ƒéœ€è¦å¯¹ä¸»ä»åº“éƒ½è¿›è¡Œå¿ƒè·³åˆ¤æ–­ï¼Œè€Œä¸”åœ¨ä¸»ä»åº“åˆ‡æ¢å®Œæˆåï¼Œå®ƒè¿˜éœ€è¦é€šçŸ¥ä»åº“ï¼Œè®©å®ƒä»¬å’Œæ–°ä¸»åº“è¿›è¡ŒåŒæ­¥ã€‚\nå“¨å…µå¦‚ä½•çŸ¥é“ä»åº“çš„IPåœ°å€å’Œç«¯å£ï¼Ÿ\nè¿™æ˜¯ç”±å“¨å…µå‘ä¸»åº“å‘é€ INFO å‘½ä»¤æ¥å®Œæˆçš„ã€‚å“¨å…µç»™ä¸»åº“å‘é€ INFO å‘½ä»¤ï¼Œä¸»åº“æ¥å—åˆ°è¿™ä¸ªå‘½ä»¤åï¼Œå°±ä¼šæŠŠä»åº“åˆ—è¡¨è¿”å›ç»™å“¨å…µã€‚æ¥ç€ï¼Œå“¨å…µå°±å¯ä»¥æ ¹æ®ä»åº“åˆ—è¡¨ä¸­çš„è¿æ¥ä¿¡æ¯ï¼Œå’Œæ¯ä¸ªä»åº“å»ºç«‹è¿æ¥ï¼Œå¹¶åœ¨è¿™ä¸ªè¿æ¥ä¸ŠæŒç»­åœ°å¯¹ä»åº“è¿›è¡Œç›‘æ§ã€‚\nåŸºäº pub/sub æœºåˆ¶çš„å®¢æˆ·ç«¯äº‹ä»¶é€šçŸ¥ åœ¨è¿›è¡Œä¸»ä»åˆ‡æ¢æ—¶ä»¥åŠå®Œæˆä¸»ä»åˆ‡æ¢åï¼Œå“¨å…µéœ€è¦ç›‘æ§æ•´ä¸ªé›†ç¾¤çš„çŠ¶æ€ï¼Œè¿˜éœ€è¦é€šçŸ¥å®¢æˆ·ç«¯æ–°çš„ä¸»åº“ä¿¡æ¯ã€‚è¿™ä¹Ÿæ˜¯é€šè¿‡pub/subæœºåˆ¶å®Œæˆçš„ã€‚æ¯ä¸ªå“¨å…µå®ä¾‹ä¹Ÿæä¾› pub/sub æœºåˆ¶ï¼Œå®¢æˆ·ç«¯å¯ä»¥ä»å“¨å…µè®¢é˜…æ¶ˆæ¯ã€‚å“¨å…µæä¾›çš„æ¶ˆæ¯è®¢é˜…é¢‘é“æœ‰å¾ˆå¤šï¼Œä¸åŒé¢‘é“åŒ…å«äº†ä¸»ä»åº“åˆ‡æ¢è¿‡ç¨‹ä¸­çš„ä¸åŒå…³é”®äº‹ä»¶ã€‚\nå®¢æˆ·ç«¯åœ¨è®¢é˜…äº†ç›¸åº”çš„é¢‘é“åï¼Œå°±å¯ä»¥è·å–ä¸åŒçš„äº‹ä»¶æ¶ˆæ¯ï¼Œä»è€Œè¿›è¡Œå¿…è¦å“åº”ã€‚\nå“ªä¸ªå“¨å…µæ‰§è¡Œä¸»ä»åˆ‡æ¢ï¼Ÿ ç¡®å®šç”±å“ªä¸ªå“¨å…µæ‰§è¡Œä¸»ä»åˆ‡æ¢çš„è¿‡ç¨‹ï¼Œå’Œä¸»åº“â€œå®¢è§‚ä¸‹çº¿â€çš„åˆ¤æ–­è¿‡ç¨‹ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªâ€œæŠ•ç¥¨ä»²è£â€çš„è¿‡ç¨‹ã€‚\nä»»ä½•ä¸€ä¸ªå®ä¾‹åªè¦è‡ªèº«åˆ¤æ–­ä¸»åº“â€œä¸»è§‚ä¸‹çº¿â€åï¼Œå°±ä¼šç»™å…¶ä»–å®ä¾‹å‘é€ is-master-down-by-addr å‘½ä»¤ã€‚æ¥ç€ï¼Œå…¶ä»–å®ä¾‹ä¼šæ ¹æ®è‡ªå·±å’Œä¸»åº“çš„è¿æ¥æƒ…å†µï¼Œåšå‡º Y æˆ– N çš„å“åº”ï¼ŒY ç›¸å½“äºèµæˆç¥¨ï¼ŒN ç›¸å½“äºåå¯¹ç¥¨ã€‚\nä¸€ä¸ªå“¨å…µè·å¾—äº†ä»²è£æ‰€éœ€çš„èµæˆç¥¨æ•°åï¼Œå°±å¯ä»¥æ ‡è®°ä¸»åº“ä¸ºâ€œå®¢è§‚ä¸‹çº¿â€ã€‚è¿™ä¸ªæ‰€éœ€çš„èµæˆç¥¨æ•°æ˜¯é€šè¿‡å“¨å…µé…ç½®æ–‡ä»¶ä¸­çš„ quorum é…ç½®é¡¹è®¾å®šçš„ã€‚ä¾‹å¦‚ï¼Œç°åœ¨æœ‰ 5 ä¸ªå“¨å…µï¼Œquorum é…ç½®çš„æ˜¯ 3ï¼Œé‚£ä¹ˆï¼Œä¸€ä¸ªå“¨å…µéœ€è¦ 3 å¼ èµæˆç¥¨ï¼Œå°±å¯ä»¥æ ‡è®°ä¸»åº“ä¸ºâ€œå®¢è§‚ä¸‹çº¿â€äº†ã€‚è¿™ 3 å¼ èµæˆç¥¨åŒ…æ‹¬å“¨å…µè‡ªå·±çš„ä¸€å¼ èµæˆç¥¨å’Œå¦å¤–ä¸¤ä¸ªå“¨å…µçš„èµæˆç¥¨ã€‚\næ­¤æ—¶ï¼Œè¿™ä¸ªå“¨å…µå°±å¯ä»¥å†ç»™å…¶ä»–å“¨å…µå‘é€å‘½ä»¤ï¼Œè¡¨æ˜å¸Œæœ›ç”±è‡ªå·±æ¥æ‰§è¡Œä¸»ä»åˆ‡æ¢ï¼Œå¹¶è®©æ‰€æœ‰å…¶ä»–å“¨å…µè¿›è¡ŒæŠ•ç¥¨ã€‚è¿™ä¸ªæŠ•ç¥¨è¿‡ç¨‹ç§°ä¸ºâ€œLeader é€‰ä¸¾â€ã€‚å› ä¸ºæœ€ç»ˆæ‰§è¡Œä¸»ä»åˆ‡æ¢çš„å“¨å…µç§°ä¸º Leaderï¼ŒæŠ•ç¥¨è¿‡ç¨‹å°±æ˜¯ç¡®å®š Leaderã€‚\nåœ¨æŠ•ç¥¨è¿‡ç¨‹ä¸­ï¼Œä»»ä½•ä¸€ä¸ªæƒ³æˆä¸º Leader çš„å“¨å…µï¼Œè¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼šç¬¬ä¸€ï¼Œæ‹¿åˆ°åŠæ•°ä»¥ä¸Šçš„èµæˆç¥¨ï¼›ç¬¬äºŒï¼Œæ‹¿åˆ°çš„ç¥¨æ•°åŒæ—¶è¿˜éœ€è¦å¤§äºç­‰äºå“¨å…µé…ç½®æ–‡ä»¶ä¸­çš„ quorum å€¼ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœå“¨å…µé›†ç¾¤åªæœ‰ 2 ä¸ªå®ä¾‹ï¼Œæ­¤æ—¶ï¼Œä¸€ä¸ªå“¨å…µè¦æƒ³æˆä¸º Leaderï¼Œå¿…é¡»è·å¾— 2 ç¥¨ï¼Œè€Œä¸æ˜¯ 1 ç¥¨ã€‚æ‰€ä»¥ï¼Œå¦‚æœæœ‰ä¸ªå“¨å…µæŒ‚æ‰äº†ï¼Œé‚£ä¹ˆï¼Œæ­¤æ—¶çš„é›†ç¾¤æ˜¯æ— æ³•è¿›è¡Œä¸»ä»åº“åˆ‡æ¢çš„ã€‚å› æ­¤ï¼Œé€šå¸¸æˆ‘ä»¬è‡³å°‘ä¼šé…ç½® 3 ä¸ªå“¨å…µå®ä¾‹ã€‚\n","permalink":"http://yangchnet.github.io/Dessert/posts/cache/%E6%A6%82%E8%A7%88redis%E7%AF%87%E4%BA%94%E5%93%A8%E5%85%B5/","summary":"æå®¢æ—¶é—´ã€ŠRedis æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜ã€‹å­¦ä¹ ç¬”è®°\n  æ¦‚è§ˆRedisç¯‡ä¸€ï¼šå•çº¿ç¨‹æ¨¡å‹ æ¦‚è§ˆRedisç¯‡äºŒï¼šAOFæ—¥å¿— æ¦‚è§ˆRedisç¯‡ä¸‰ï¼šRDBå¿«ç…§ æ¦‚è§ˆRedisç¯‡å››ï¼šä¸»ä» æ¦‚è§ˆRedisç¯‡äº”ï¼šå“¨å…µ æ¦‚è§ˆRedisç¯‡å…­ï¼šåˆ‡ç‰‡é›†ç¾¤  ä»€ä¹ˆæ˜¯å“¨å…µï¼Œå“¨å…µæœ‰ä»€ä¹ˆç”¨ å“¨å…µå…¶å®å°±æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨ç‰¹æ®Šæ¨¡å¼ä¸‹çš„ Redis è¿›ç¨‹ï¼Œä¸»ä»åº“å®ä¾‹è¿è¡Œçš„åŒæ—¶ï¼Œå®ƒä¹Ÿåœ¨è¿è¡Œã€‚å“¨å…µä¸»è¦è´Ÿè´£çš„å°±æ˜¯ä¸‰ä¸ªä»»åŠ¡ï¼šç›‘æ§ã€é€‰ä¸»ï¼ˆé€‰æ‹©ä¸»åº“ï¼‰å’Œé€šçŸ¥ã€‚\næœ‰äº†å“¨å…µï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ä¸»åº“æ•…éšœçš„æƒ…å†µä¸‹å¿«é€Ÿå®ç°ä¸»ä»åº“è‡ªåŠ¨åˆ‡æ¢ã€‚\nå“¨å…µæœºåˆ¶çš„åŸºæœ¬æµç¨‹  ç›‘æ§  å“¨å…µåœ¨è¿è¡Œæ—¶ï¼Œä¼šå‘¨æœŸæ€§åœ°ç»™æ‰€æœ‰çš„ä¸»ä»åº“å‘é€ PING å‘½ä»¤ï¼Œæ£€æµ‹å®ƒä»¬æ˜¯å¦ä»ç„¶åœ¨çº¿è¿è¡Œã€‚å¦‚æœä»åº“æ²¡æœ‰åœ¨è§„å®šæ—¶é—´å†…å“åº”å“¨å…µçš„ PING å‘½ä»¤ï¼Œå“¨å…µå°±ä¼šæŠŠå®ƒæ ‡è®°ä¸ºâ€œä¸‹çº¿çŠ¶æ€â€ï¼›åŒæ ·ï¼Œå¦‚æœä¸»åº“ä¹Ÿæ²¡æœ‰åœ¨è§„å®šæ—¶é—´å†…å“åº”å“¨å…µçš„ PING å‘½ä»¤ï¼Œå“¨å…µå°±ä¼šåˆ¤å®šä¸»åº“ä¸‹çº¿ï¼Œç„¶åå¼€å§‹è‡ªåŠ¨åˆ‡æ¢ä¸»åº“çš„æµç¨‹ã€‚\né€‰ä¸»  ä¸»åº“æŒ‚äº†ä»¥åï¼Œå“¨å…µå°±éœ€è¦ä»å¾ˆå¤šä¸ªä»åº“é‡Œï¼ŒæŒ‰ç…§ä¸€å®šçš„è§„åˆ™é€‰æ‹©ä¸€ä¸ªä»åº“å®ä¾‹ï¼ŒæŠŠå®ƒä½œä¸ºæ–°çš„ä¸»åº“ã€‚\né€šçŸ¥  åœ¨é€‰å‡ºæ–°çš„ä¸»åº“åï¼Œå“¨å…µä¼šæŠŠæ–°ä¸»åº“çš„è¿æ¥ä¿¡æ¯å‘ç»™å…¶ä»–ä»åº“ï¼Œè®©å®ƒä»¬æ‰§è¡Œ replicaof å‘½ä»¤ï¼Œå’Œæ–°ä¸»åº“å»ºç«‹è¿æ¥ï¼Œå¹¶è¿›è¡Œæ•°æ®å¤åˆ¶ã€‚åŒæ—¶ï¼Œå“¨å…µä¼šæŠŠæ–°ä¸»åº“çš„è¿æ¥ä¿¡æ¯é€šçŸ¥ç»™å®¢æˆ·ç«¯ï¼Œè®©å®ƒä»¬æŠŠè¯·æ±‚æ“ä½œå‘åˆ°æ–°ä¸»åº“ä¸Šã€‚\nå“¨å…µå¦‚ä½•åˆ¤æ–­ä¸»åº“æ˜¯å¦ä¸‹çº¿  ä¸»è§‚ä¸‹çº¿  å“¨å…µè¿›ç¨‹ä¼šä½¿ç”¨ PING å‘½ä»¤æ£€æµ‹å®ƒè‡ªå·±å’Œä¸»ã€ä»åº“çš„ç½‘ç»œè¿æ¥æƒ…å†µï¼Œç”¨æ¥åˆ¤æ–­å®ä¾‹çš„çŠ¶æ€ã€‚å¦‚æœå“¨å…µå‘ç°ä¸»åº“æˆ–ä»åº“å¯¹ PING å‘½ä»¤çš„å“åº”è¶…æ—¶äº†ï¼Œé‚£ä¹ˆï¼Œå“¨å…µå°±ä¼šå…ˆæŠŠå®ƒæ ‡è®°ä¸ºâ€œä¸»è§‚ä¸‹çº¿â€\nå¦‚æœæ£€æµ‹çš„æ˜¯ä»åº“ï¼Œé‚£ä¹ˆï¼Œå“¨å…µç®€å•åœ°æŠŠå®ƒæ ‡è®°ä¸ºâ€œä¸»è§‚ä¸‹çº¿â€å°±è¡Œäº†ï¼Œå› ä¸ºä»åº“çš„ä¸‹çº¿å½±å“ä¸€èˆ¬ä¸å¤ªå¤§ï¼Œé›†ç¾¤çš„å¯¹å¤–æœåŠ¡ä¸ä¼šé—´æ–­ã€‚\nä½†æ˜¯ï¼Œå¦‚æœæ£€æµ‹çš„æ˜¯ä¸»åº“ï¼Œé‚£ä¹ˆï¼Œå“¨å…µè¿˜ä¸èƒ½ç®€å•åœ°æŠŠå®ƒæ ‡è®°ä¸ºâ€œä¸»è§‚ä¸‹çº¿â€ï¼Œå¼€å¯ä¸»ä»åˆ‡æ¢ã€‚å› ä¸ºå¾ˆæœ‰å¯èƒ½å­˜åœ¨è¿™ä¹ˆä¸€ä¸ªæƒ…å†µï¼šé‚£å°±æ˜¯å“¨å…µè¯¯åˆ¤äº†ï¼Œå…¶å®ä¸»åº“å¹¶æ²¡æœ‰æ•…éšœã€‚å¯æ˜¯ï¼Œä¸€æ—¦å¯åŠ¨äº†ä¸»ä»åˆ‡æ¢ï¼Œåç»­çš„é€‰ä¸»å’Œé€šçŸ¥æ“ä½œéƒ½ä¼šå¸¦æ¥é¢å¤–çš„è®¡ç®—å’Œé€šä¿¡å¼€é”€ã€‚\nå› æ­¤æˆ‘ä»¬è¦ç‰¹åˆ«æ³¨æ„è¯¯åˆ¤çš„æƒ…å†µã€‚\nä¸ºäº†å‡å°‘è¯¯åˆ¤ï¼Œå¯ä»¥é‡‡ç”¨å¤šå®ä¾‹ç»„æˆçš„é›†ç¾¤æ¨¡å¼è¿›è¡Œéƒ¨ç½²ï¼Œè¿™ä¹Ÿè¢«ç§°ä¸ºå“¨å…µé›†ç¾¤ã€‚å¼•å…¥å¤šä¸ªå“¨å…µå®ä¾‹ä¸€èµ·æ¥åˆ¤æ–­ï¼Œå°±å¯ä»¥é¿å…å•ä¸ªå“¨å…µå› ä¸ºè‡ªèº«ç½‘ç»œçŠ¶å†µä¸å¥½ï¼Œè€Œè¯¯åˆ¤ä¸»åº“ä¸‹çº¿çš„æƒ…å†µã€‚åŒæ—¶ï¼Œå¤šä¸ªå“¨å…µçš„ç½‘ç»œåŒæ—¶ä¸ç¨³å®šçš„æ¦‚ç‡è¾ƒå°ï¼Œç”±å®ƒä»¬ä¸€èµ·åšå†³ç­–ï¼Œè¯¯åˆ¤ç‡ä¹Ÿèƒ½é™ä½ã€‚\nå®¢è§‚ä¸‹çº¿  å½“å¤§å¤šæ•°çš„å“¨å…µå®ä¾‹ï¼Œéƒ½åˆ¤æ–­ä¸»åº“å·²ç»â€œä¸»è§‚ä¸‹çº¿â€äº†ï¼Œä¸»åº“æ‰ä¼šè¢«æ ‡è®°ä¸ºâ€œå®¢è§‚ä¸‹çº¿â€ï¼Œè¿™ä¸ªå«æ³•ä¹Ÿæ˜¯è¡¨æ˜ä¸»åº“ä¸‹çº¿æˆä¸ºä¸€ä¸ªå®¢è§‚äº‹å®äº†ã€‚\nå¦‚ä½•é€‰æ‹©æ–°ä¸»åº“ ç®€å•æ¥è¯´ï¼Œå“¨å…µé€‰æ‹©æ–°ä¸»åº“çš„è¿‡ç¨‹å¯ä»¥æè¿°ä¸ºâ€œç­›é€‰+æ‰“åˆ†â€ã€‚ç­›é€‰æ˜¯è¯´ï¼Œæˆ‘ä»¬åœ¨å¤šä¸ªä»åº“ä¸­ï¼Œå…ˆæŒ‰ç…§ä¸€å®šçš„ç­›é€‰æ¡ä»¶ï¼ŒæŠŠä¸ç¬¦åˆæ¡ä»¶çš„ä»åº“å»æ‰ã€‚è€Œæ‰“åˆ†æ„æ€æ˜¯æŒ‰ç…§ä¸€å®šçš„è§„åˆ™ï¼Œç»™å‰©ä¸‹çš„ä»åº“é€ä¸ªæ‰“åˆ†ï¼Œå°†å¾—åˆ†æœ€é«˜çš„ä»åº“é€‰ä¸ºæ–°ä¸»åº“ï¼Œ\né‚£ä¹ˆç­›é€‰å’Œæ‰“åˆ†çš„æ ‡å‡†æ˜¯æ€æ ·çš„ï¼Ÿ\nåœ¨ç­›é€‰æ—¶ï¼Œé™¤äº†è¦æ£€æŸ¥ä»åº“çš„å½“å‰åœ¨çº¿çŠ¶æ€ï¼Œè¿˜è¦åˆ¤æ–­å®ƒä¹‹å‰çš„ç½‘ç»œè¿æ¥çŠ¶æ€ã€‚ä½¿ç”¨é…ç½®é¡¹ down-after-milliseconds * 10ã€‚å…¶ä¸­ï¼Œdown-after-milliseconds æ˜¯æˆ‘ä»¬è®¤å®šä¸»ä»åº“æ–­è¿çš„æœ€å¤§è¿æ¥è¶…æ—¶æ—¶é—´ã€‚å¦‚æœåœ¨ down-after-milliseconds æ¯«ç§’å†…ï¼Œä¸»ä»èŠ‚ç‚¹éƒ½æ²¡æœ‰é€šè¿‡ç½‘ç»œè”ç³»ä¸Šï¼Œæˆ‘ä»¬å°±å¯ä»¥è®¤ä¸ºä¸»ä»èŠ‚ç‚¹æ–­è¿äº†ã€‚å¦‚æœå‘ç”Ÿæ–­è¿çš„æ¬¡æ•°è¶…è¿‡äº† 10 æ¬¡ï¼Œå°±è¯´æ˜è¿™ä¸ªä»åº“çš„ç½‘ç»œçŠ¶å†µä¸å¥½ï¼Œä¸é€‚åˆä½œä¸ºæ–°ä¸»åº“ã€‚\nç­›æ‰äº†ä¸é€‚åˆåšä¸»åº“çš„ä»åº“åï¼Œéœ€è¦å¯¹å‰©ä¸‹çš„ä»åº“è¿›è¡Œæ‰“åˆ†ã€‚åˆ†åˆ«æŒ‰ç…§ä¸€ä¸‹ä¸‰ä¸ªè§„åˆ™è¿›è¡Œä¸‰è½®ï¼š\n  ä¼˜å…ˆçº§æœ€é«˜çš„ä»åº“å¾—åˆ†é«˜ã€‚ ç”¨æˆ·å¯ä»¥é€šè¿‡ slave-priority é…ç½®é¡¹ï¼Œç»™ä¸åŒçš„ä»åº“è®¾ç½®ä¸åŒä¼˜å…ˆçº§ã€‚","title":"æ¦‚è§ˆRedisç¯‡äº”ï¼šå“¨å…µ"},{"content":" æå®¢æ—¶é—´ã€ŠRedis æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜ã€‹å­¦ä¹ ç¬”è®°\n  æ¦‚è§ˆRedisç¯‡ä¸€ï¼šå•çº¿ç¨‹æ¨¡å‹ æ¦‚è§ˆRedisç¯‡äºŒï¼šAOFæ—¥å¿— æ¦‚è§ˆRedisç¯‡ä¸‰ï¼šRDBå¿«ç…§ æ¦‚è§ˆRedisç¯‡å››ï¼šä¸»ä» æ¦‚è§ˆRedisç¯‡äº”ï¼šå“¨å…µ æ¦‚è§ˆRedisç¯‡å…­ï¼šåˆ‡ç‰‡é›†ç¾¤  ä»€ä¹ˆæ˜¯åˆ‡ç‰‡é›†ç¾¤ï¼Œæœ‰ä»€ä¹ˆç”¨ åˆ‡ç‰‡é›†ç¾¤ï¼Œä¹Ÿå«åˆ†ç‰‡é›†ç¾¤ï¼Œå°±æ˜¯æŒ‡å¯åŠ¨å¤šä¸ª Redis å®ä¾‹ç»„æˆä¸€ä¸ªé›†ç¾¤ï¼Œç„¶åæŒ‰ç…§ä¸€å®šçš„è§„åˆ™ï¼ŒæŠŠæ”¶åˆ°çš„æ•°æ®åˆ’åˆ†æˆå¤šä»½ï¼Œæ¯ä¸€ä»½ç”¨ä¸€ä¸ªå®ä¾‹æ¥ä¿å­˜ã€‚\nå½“Redisä¿å­˜å¤§é‡æ•°æ®æ—¶ï¼Œå…¶åœ¨è¿›è¡ŒRDBæŒä¹…åŒ–æ—¶éœ€è¦forkä¸€ä¸ªå­è¿›ç¨‹ï¼Œè€Œforkå­è¿›ç¨‹çš„ç”¨æ—¶å’ŒRedisçš„æ•°æ®é‡æ˜¯æ­£ç›¸å…³çš„ï¼Œè€Œ fork åœ¨æ‰§è¡Œæ—¶ä¼šé˜»å¡ä¸»çº¿ç¨‹ã€‚æ•°æ®é‡è¶Šå¤§ï¼Œfork æ“ä½œé€ æˆçš„ä¸»çº¿ç¨‹é˜»å¡çš„æ—¶é—´è¶Šé•¿ã€‚å› æ­¤å¦‚æœRedisä¿å­˜äº†å¤§é‡æ•°æ®ï¼Œä¼šå¯¼è‡´Rediså“åº”å˜æ…¢ã€‚\næ•°æ®åˆ‡ç‰‡åï¼Œåœ¨å¤šä¸ªå®ä¾‹ä¹‹é—´å¦‚ä½•åˆ†å¸ƒ ä» 3.0 å¼€å§‹ï¼Œå®˜æ–¹æä¾›äº†ä¸€ä¸ªåä¸º Redis Cluster çš„æ–¹æ¡ˆï¼Œç”¨äºå®ç°åˆ‡ç‰‡é›†ç¾¤ã€‚Redis Cluster æ–¹æ¡ˆä¸­å°±è§„å®šäº†æ•°æ®å’Œå®ä¾‹çš„å¯¹åº”è§„åˆ™ã€‚\nRedis Cluster æ–¹æ¡ˆé‡‡ç”¨å“ˆå¸Œæ§½Hash Slotï¼Œæ¥å¤„ç†æ•°æ®å’Œå®ä¾‹ä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚åœ¨ Redis Cluster æ–¹æ¡ˆä¸­ï¼Œä¸€ä¸ªåˆ‡ç‰‡é›†ç¾¤å…±æœ‰ 16384 ä¸ªå“ˆå¸Œæ§½ï¼Œè¿™äº›å“ˆå¸Œæ§½ç±»ä¼¼äºæ•°æ®åˆ†åŒºï¼Œæ¯ä¸ªé”®å€¼å¯¹éƒ½ä¼šæ ¹æ®å®ƒçš„ keyï¼Œè¢«æ˜ å°„åˆ°ä¸€ä¸ªå“ˆå¸Œæ§½ä¸­ã€‚\nå…·ä½“çš„æ˜ å°„è¿‡ç¨‹åˆ†ä¸ºä¸¤å¤§æ­¥ï¼šé¦–å…ˆæ ¹æ®é”®å€¼å¯¹çš„ keyï¼ŒæŒ‰ç…§CRC16 ç®—æ³•è®¡ç®—ä¸€ä¸ª 16 bit çš„å€¼ï¼›ç„¶åï¼Œå†ç”¨è¿™ä¸ª 16bit å€¼å¯¹ 16384 å–æ¨¡ï¼Œå¾—åˆ° 0~16383 èŒƒå›´å†…çš„æ¨¡æ•°ï¼Œæ¯ä¸ªæ¨¡æ•°ä»£è¡¨ä¸€ä¸ªç›¸åº”ç¼–å·çš„å“ˆå¸Œæ§½ã€‚\nåœ¨éƒ¨ç½² Redis Cluster æ–¹æ¡ˆæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ cluster create å‘½ä»¤åˆ›å»ºé›†ç¾¤ï¼Œæ­¤æ—¶ï¼ŒRedis ä¼šè‡ªåŠ¨æŠŠè¿™äº›æ§½å¹³å‡åˆ†å¸ƒåœ¨é›†ç¾¤å®ä¾‹ä¸Šã€‚ä¾‹å¦‚ï¼Œå¦‚æœé›†ç¾¤ä¸­æœ‰ N ä¸ªå®ä¾‹ï¼Œé‚£ä¹ˆï¼Œæ¯ä¸ªå®ä¾‹ä¸Šçš„æ§½ä¸ªæ•°ä¸º 16384/N ä¸ªã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨cluster meetå‘½ä»¤æ‰‹åŠ¨å»ºç«‹å®ä¾‹é—´çš„è¿æ¥ï¼Œå½¢æˆé›†ç¾¤ï¼Œå†ä½¿ç”¨cluster addslots å‘½ä»¤ï¼ŒæŒ‡å®šæ¯ä¸ªå®ä¾‹ä¸Šçš„å“ˆå¸Œæ§½ä¸ªæ•°ã€‚åœ¨æ‰‹åŠ¨åˆ†é…å“ˆå¸Œæ§½æ—¶ï¼Œéœ€è¦æŠŠ 16384 ä¸ªæ§½éƒ½åˆ†é…å®Œï¼Œå¦åˆ™ Redis é›†ç¾¤æ— æ³•æ­£å¸¸å·¥ä½œã€‚\nå®¢æˆ·ç«¯å¦‚ä½•å®šä½æ•°æ® Redis å®ä¾‹ä¼šæŠŠè‡ªå·±çš„å“ˆå¸Œæ§½ä¿¡æ¯å‘ç»™å’Œå®ƒç›¸è¿æ¥çš„å…¶å®ƒå®ä¾‹ï¼Œæ¥å®Œæˆå“ˆå¸Œæ§½åˆ†é…ä¿¡æ¯çš„æ‰©æ•£ã€‚å½“å®ä¾‹ä¹‹é—´ç›¸äº’è¿æ¥åï¼Œæ¯ä¸ªå®ä¾‹å°±æœ‰æ‰€æœ‰å“ˆå¸Œæ§½çš„æ˜ å°„å…³ç³»äº†ã€‚\nå®¢æˆ·ç«¯å’Œé›†ç¾¤å®ä¾‹å»ºç«‹è¿æ¥åï¼Œå®ä¾‹å°±ä¼šæŠŠå“ˆå¸Œæ§½çš„åˆ†é…ä¿¡æ¯å‘ç»™å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯æ”¶åˆ°å“ˆå¸Œæ§½ä¿¡æ¯åï¼Œä¼šæŠŠå“ˆå¸Œæ§½ä¿¡æ¯ç¼“å­˜åœ¨æœ¬åœ°ã€‚å½“å®¢æˆ·ç«¯è¯·æ±‚é”®å€¼å¯¹æ—¶ï¼Œä¼šå…ˆè®¡ç®—é”®æ‰€å¯¹åº”çš„å“ˆå¸Œæ§½ï¼Œç„¶åå°±å¯ä»¥ç»™ç›¸åº”çš„å®ä¾‹å‘é€è¯·æ±‚äº†ã€‚\nä½†å®ä¾‹ä¸Slotçš„å¯¹åº”å…³ç³»å¹¶ä¸æ˜¯ä¸€æˆä¸å˜çš„ï¼š\n åœ¨é›†ç¾¤ä¸­ï¼Œå®ä¾‹æœ‰æ–°å¢æˆ–åˆ é™¤ï¼ŒRedis éœ€è¦é‡æ–°åˆ†é…å“ˆå¸Œæ§½ï¼› ä¸ºäº†è´Ÿè½½å‡è¡¡ï¼ŒRedis éœ€è¦æŠŠå“ˆå¸Œæ§½åœ¨æ‰€æœ‰å®ä¾‹ä¸Šé‡æ–°åˆ†å¸ƒä¸€éã€‚  å®¢æˆ·ç«¯æ— æ³•ä¸»åŠ¨æ„ŸçŸ¥è¿™äº›å˜åŒ–ï¼Œä½†Redis Cluster æ–¹æ¡ˆæä¾›äº†ä¸€ç§é‡å®šå‘æœºåˆ¶ï¼Œæ‰€è°“çš„â€œé‡å®šå‘â€ï¼Œå°±æ˜¯æŒ‡ï¼Œå®¢æˆ·ç«¯ç»™ä¸€ä¸ªå®ä¾‹å‘é€æ•°æ®è¯»å†™æ“ä½œæ—¶ï¼Œè¿™ä¸ªå®ä¾‹ä¸Šå¹¶æ²¡æœ‰ç›¸åº”çš„æ•°æ®ï¼Œå®¢æˆ·ç«¯è¦å†ç»™ä¸€ä¸ªæ–°å®ä¾‹å‘é€æ“ä½œå‘½ä»¤ã€‚\nå½“å®¢æˆ·ç«¯æŠŠä¸€ä¸ªé”®å€¼å¯¹çš„æ“ä½œè¯·æ±‚å‘ç»™ä¸€ä¸ªå®ä¾‹æ—¶ï¼Œå¦‚æœè¿™ä¸ªå®ä¾‹ä¸Šå¹¶æ²¡æœ‰è¿™ä¸ªé”®å€¼å¯¹æ˜ å°„çš„å“ˆå¸Œæ§½ï¼Œé‚£ä¹ˆï¼Œè¿™ä¸ªå®ä¾‹å°±ä¼šç»™å®¢æˆ·ç«¯è¿”å›ä¸‹é¢çš„ MOVED å‘½ä»¤å“åº”ç»“æœï¼Œè¿™ä¸ªç»“æœä¸­å°±åŒ…å«äº†æ–°å®ä¾‹çš„è®¿é—®åœ°å€ã€‚\nGET hello:key (error) MOVED 13320 172.16.19.5:6379  Redis Clusterä¸é‡‡ç”¨æŠŠkeyç›´æ¥æ˜ å°„åˆ°å®ä¾‹çš„æ–¹å¼ï¼Œè€Œé‡‡ç”¨å“ˆå¸Œæ§½çš„æ–¹å¼åŸå› ï¼š\n1ã€æ•´ä¸ªé›†ç¾¤å­˜å‚¨keyçš„æ•°é‡æ˜¯æ— æ³•é¢„ä¼°çš„ï¼Œkeyçš„æ•°é‡éå¸¸å¤šæ—¶ï¼Œç›´æ¥è®°å½•æ¯ä¸ªkeyå¯¹åº”çš„å®ä¾‹æ˜ å°„å…³ç³»ï¼Œè¿™ä¸ªæ˜ å°„è¡¨ä¼šéå¸¸åºå¤§ï¼Œè¿™ä¸ªæ˜ å°„è¡¨æ— è®ºæ˜¯å­˜å‚¨åœ¨æœåŠ¡ç«¯è¿˜æ˜¯å®¢æˆ·ç«¯éƒ½å ç”¨äº†éå¸¸å¤§çš„å†…å­˜ç©ºé—´ã€‚\n2ã€Redis Clusteré‡‡ç”¨æ— ä¸­å¿ƒåŒ–çš„æ¨¡å¼ï¼ˆæ— proxyï¼Œå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ç›´è¿ï¼‰ï¼Œå®¢æˆ·ç«¯åœ¨æŸä¸ªèŠ‚ç‚¹è®¿é—®ä¸€ä¸ªkeyï¼Œå¦‚æœè¿™ä¸ªkeyä¸åœ¨è¿™ä¸ªèŠ‚ç‚¹ä¸Šï¼Œè¿™ä¸ªèŠ‚ç‚¹éœ€è¦æœ‰çº æ­£å®¢æˆ·ç«¯è·¯ç”±åˆ°æ­£ç¡®èŠ‚ç‚¹çš„èƒ½åŠ›ï¼ˆMOVEDå“åº”ï¼‰ï¼Œè¿™å°±éœ€è¦èŠ‚ç‚¹ä¹‹é—´äº’ç›¸äº¤æ¢è·¯ç”±è¡¨ï¼Œæ¯ä¸ªèŠ‚ç‚¹æ‹¥æœ‰æ•´ä¸ªé›†ç¾¤å®Œæ•´çš„è·¯ç”±å…³ç³»ã€‚å¦‚æœå­˜å‚¨çš„éƒ½æ˜¯keyä¸å®ä¾‹çš„å¯¹åº”å…³ç³»ï¼ŒèŠ‚ç‚¹ä¹‹é—´äº¤æ¢ä¿¡æ¯ä¹Ÿä¼šå˜å¾—éå¸¸åºå¤§ï¼Œæ¶ˆè€—è¿‡å¤šçš„ç½‘ç»œèµ„æºï¼Œè€Œä¸”å°±ç®—äº¤æ¢å®Œæˆï¼Œç›¸å½“äºæ¯ä¸ªèŠ‚ç‚¹éƒ½éœ€è¦é¢å¤–å­˜å‚¨å…¶ä»–èŠ‚ç‚¹çš„è·¯ç”±è¡¨ï¼Œå†…å­˜å ç”¨è¿‡å¤§é€ æˆèµ„æºæµªè´¹ã€‚\n3ã€å½“é›†ç¾¤åœ¨æ‰©å®¹ã€ç¼©å®¹ã€æ•°æ®å‡è¡¡æ—¶ï¼ŒèŠ‚ç‚¹ä¹‹é—´ä¼šå‘ç”Ÿæ•°æ®è¿ç§»ï¼Œè¿ç§»æ—¶éœ€è¦ä¿®æ”¹æ¯ä¸ªkeyçš„æ˜ å°„å…³ç³»ï¼Œç»´æŠ¤æˆæœ¬é«˜ã€‚\n4ã€è€Œåœ¨ä¸­é—´å¢åŠ ä¸€å±‚å“ˆå¸Œæ§½ï¼Œå¯ä»¥æŠŠæ•°æ®å’ŒèŠ‚ç‚¹è§£è€¦ï¼Œkeyé€šè¿‡Hashè®¡ç®—ï¼Œåªéœ€è¦å…³å¿ƒæ˜ å°„åˆ°äº†å“ªä¸ªå“ˆå¸Œæ§½ï¼Œç„¶åå†é€šè¿‡å“ˆå¸Œæ§½å’ŒèŠ‚ç‚¹çš„æ˜ å°„è¡¨æ‰¾åˆ°èŠ‚ç‚¹ï¼Œç›¸å½“äºæ¶ˆè€—äº†å¾ˆå°‘çš„CPUèµ„æºï¼Œä¸ä½†è®©æ•°æ®åˆ†å¸ƒæ›´å‡åŒ€ï¼Œè¿˜å¯ä»¥è®©è¿™ä¸ªæ˜ å°„è¡¨å˜å¾—å¾ˆå°ï¼Œåˆ©äºå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¿å­˜ï¼ŒèŠ‚ç‚¹ä¹‹é—´äº¤æ¢ä¿¡æ¯æ—¶ä¹Ÿå˜å¾—è½»é‡ã€‚\n5ã€å½“é›†ç¾¤åœ¨æ‰©å®¹ã€ç¼©å®¹ã€æ•°æ®å‡è¡¡æ—¶ï¼ŒèŠ‚ç‚¹ä¹‹é—´çš„æ“ä½œä¾‹å¦‚æ•°æ®è¿ç§»ï¼Œéƒ½ä»¥å“ˆå¸Œæ§½ä¸ºåŸºæœ¬å•ä½è¿›è¡Œæ“ä½œï¼Œç®€åŒ–äº†èŠ‚ç‚¹æ‰©å®¹ã€ç¼©å®¹çš„éš¾åº¦ï¼Œä¾¿äºé›†ç¾¤çš„ç»´æŠ¤å’Œç®¡ç†ã€‚\n","permalink":"http://yangchnet.github.io/Dessert/posts/cache/%E6%A6%82%E8%A7%88redis%E7%AF%87%E5%85%AD%E5%88%87%E7%89%87%E9%9B%86%E7%BE%A4/","summary":"æå®¢æ—¶é—´ã€ŠRedis æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜ã€‹å­¦ä¹ ç¬”è®°\n  æ¦‚è§ˆRedisç¯‡ä¸€ï¼šå•çº¿ç¨‹æ¨¡å‹ æ¦‚è§ˆRedisç¯‡äºŒï¼šAOFæ—¥å¿— æ¦‚è§ˆRedisç¯‡ä¸‰ï¼šRDBå¿«ç…§ æ¦‚è§ˆRedisç¯‡å››ï¼šä¸»ä» æ¦‚è§ˆRedisç¯‡äº”ï¼šå“¨å…µ æ¦‚è§ˆRedisç¯‡å…­ï¼šåˆ‡ç‰‡é›†ç¾¤  ä»€ä¹ˆæ˜¯åˆ‡ç‰‡é›†ç¾¤ï¼Œæœ‰ä»€ä¹ˆç”¨ åˆ‡ç‰‡é›†ç¾¤ï¼Œä¹Ÿå«åˆ†ç‰‡é›†ç¾¤ï¼Œå°±æ˜¯æŒ‡å¯åŠ¨å¤šä¸ª Redis å®ä¾‹ç»„æˆä¸€ä¸ªé›†ç¾¤ï¼Œç„¶åæŒ‰ç…§ä¸€å®šçš„è§„åˆ™ï¼ŒæŠŠæ”¶åˆ°çš„æ•°æ®åˆ’åˆ†æˆå¤šä»½ï¼Œæ¯ä¸€ä»½ç”¨ä¸€ä¸ªå®ä¾‹æ¥ä¿å­˜ã€‚\nå½“Redisä¿å­˜å¤§é‡æ•°æ®æ—¶ï¼Œå…¶åœ¨è¿›è¡ŒRDBæŒä¹…åŒ–æ—¶éœ€è¦forkä¸€ä¸ªå­è¿›ç¨‹ï¼Œè€Œforkå­è¿›ç¨‹çš„ç”¨æ—¶å’ŒRedisçš„æ•°æ®é‡æ˜¯æ­£ç›¸å…³çš„ï¼Œè€Œ fork åœ¨æ‰§è¡Œæ—¶ä¼šé˜»å¡ä¸»çº¿ç¨‹ã€‚æ•°æ®é‡è¶Šå¤§ï¼Œfork æ“ä½œé€ æˆçš„ä¸»çº¿ç¨‹é˜»å¡çš„æ—¶é—´è¶Šé•¿ã€‚å› æ­¤å¦‚æœRedisä¿å­˜äº†å¤§é‡æ•°æ®ï¼Œä¼šå¯¼è‡´Rediså“åº”å˜æ…¢ã€‚\næ•°æ®åˆ‡ç‰‡åï¼Œåœ¨å¤šä¸ªå®ä¾‹ä¹‹é—´å¦‚ä½•åˆ†å¸ƒ ä» 3.0 å¼€å§‹ï¼Œå®˜æ–¹æä¾›äº†ä¸€ä¸ªåä¸º Redis Cluster çš„æ–¹æ¡ˆï¼Œç”¨äºå®ç°åˆ‡ç‰‡é›†ç¾¤ã€‚Redis Cluster æ–¹æ¡ˆä¸­å°±è§„å®šäº†æ•°æ®å’Œå®ä¾‹çš„å¯¹åº”è§„åˆ™ã€‚\nRedis Cluster æ–¹æ¡ˆé‡‡ç”¨å“ˆå¸Œæ§½Hash Slotï¼Œæ¥å¤„ç†æ•°æ®å’Œå®ä¾‹ä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚åœ¨ Redis Cluster æ–¹æ¡ˆä¸­ï¼Œä¸€ä¸ªåˆ‡ç‰‡é›†ç¾¤å…±æœ‰ 16384 ä¸ªå“ˆå¸Œæ§½ï¼Œè¿™äº›å“ˆå¸Œæ§½ç±»ä¼¼äºæ•°æ®åˆ†åŒºï¼Œæ¯ä¸ªé”®å€¼å¯¹éƒ½ä¼šæ ¹æ®å®ƒçš„ keyï¼Œè¢«æ˜ å°„åˆ°ä¸€ä¸ªå“ˆå¸Œæ§½ä¸­ã€‚\nå…·ä½“çš„æ˜ å°„è¿‡ç¨‹åˆ†ä¸ºä¸¤å¤§æ­¥ï¼šé¦–å…ˆæ ¹æ®é”®å€¼å¯¹çš„ keyï¼ŒæŒ‰ç…§CRC16 ç®—æ³•è®¡ç®—ä¸€ä¸ª 16 bit çš„å€¼ï¼›ç„¶åï¼Œå†ç”¨è¿™ä¸ª 16bit å€¼å¯¹ 16384 å–æ¨¡ï¼Œå¾—åˆ° 0~16383 èŒƒå›´å†…çš„æ¨¡æ•°ï¼Œæ¯ä¸ªæ¨¡æ•°ä»£è¡¨ä¸€ä¸ªç›¸åº”ç¼–å·çš„å“ˆå¸Œæ§½ã€‚\nåœ¨éƒ¨ç½² Redis Cluster æ–¹æ¡ˆæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ cluster create å‘½ä»¤åˆ›å»ºé›†ç¾¤ï¼Œæ­¤æ—¶ï¼ŒRedis ä¼šè‡ªåŠ¨æŠŠè¿™äº›æ§½å¹³å‡åˆ†å¸ƒåœ¨é›†ç¾¤å®ä¾‹ä¸Šã€‚ä¾‹å¦‚ï¼Œå¦‚æœé›†ç¾¤ä¸­æœ‰ N ä¸ªå®ä¾‹ï¼Œé‚£ä¹ˆï¼Œæ¯ä¸ªå®ä¾‹ä¸Šçš„æ§½ä¸ªæ•°ä¸º 16384/N ä¸ªã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨cluster meetå‘½ä»¤æ‰‹åŠ¨å»ºç«‹å®ä¾‹é—´çš„è¿æ¥ï¼Œå½¢æˆé›†ç¾¤ï¼Œå†ä½¿ç”¨cluster addslots å‘½ä»¤ï¼ŒæŒ‡å®šæ¯ä¸ªå®ä¾‹ä¸Šçš„å“ˆå¸Œæ§½ä¸ªæ•°ã€‚åœ¨æ‰‹åŠ¨åˆ†é…å“ˆå¸Œæ§½æ—¶ï¼Œéœ€è¦æŠŠ 16384 ä¸ªæ§½éƒ½åˆ†é…å®Œï¼Œå¦åˆ™ Redis é›†ç¾¤æ— æ³•æ­£å¸¸å·¥ä½œã€‚","title":"æ¦‚è§ˆRedisç¯‡å…­ï¼šåˆ‡ç‰‡é›†ç¾¤"},{"content":" æå®¢æ—¶é—´ã€ŠRedis æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜ã€‹å­¦ä¹ ç¬”è®°\n  æ¦‚è§ˆRedisç¯‡ä¸€ï¼šå•çº¿ç¨‹æ¨¡å‹ æ¦‚è§ˆRedisç¯‡äºŒï¼šAOFæ—¥å¿— æ¦‚è§ˆRedisç¯‡ä¸‰ï¼šRDBå¿«ç…§ æ¦‚è§ˆRedisç¯‡å››ï¼šä¸»ä» æ¦‚è§ˆRedisç¯‡äº”ï¼šå“¨å…µ æ¦‚è§ˆRedisç¯‡å…­ï¼šåˆ‡ç‰‡é›†ç¾¤  Redisçš„é«˜å¯é æ€§ Redis å…·æœ‰é«˜å¯é æ€§ï¼Œåˆæ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿå…¶å®ï¼Œè¿™é‡Œæœ‰ä¸¤å±‚å«ä¹‰ï¼šä¸€æ˜¯æ•°æ®å°½é‡å°‘ä¸¢å¤±ï¼ŒäºŒæ˜¯æœåŠ¡å°½é‡å°‘ä¸­æ–­ã€‚\nAOF å’Œ RDB ä¿è¯äº†å‰è€…ï¼Œè€Œå¯¹äºåè€…ï¼ŒRedis çš„åšæ³•å°±æ˜¯å¢åŠ å‰¯æœ¬å†—ä½™é‡ï¼Œå°†ä¸€ä»½æ•°æ®åŒæ—¶ä¿å­˜åœ¨å¤šä¸ªå®ä¾‹ä¸Šã€‚å³ä½¿æœ‰ä¸€ä¸ªå®ä¾‹å‡ºç°äº†æ•…éšœï¼Œéœ€è¦è¿‡ä¸€æ®µæ—¶é—´æ‰èƒ½æ¢å¤ï¼Œå…¶ä»–å®ä¾‹ä¹Ÿå¯ä»¥å¯¹å¤–æä¾›æœåŠ¡ï¼Œä¸ä¼šå½±å“ä¸šåŠ¡ä½¿ç”¨ã€‚\nRedis æä¾›äº†ä¸»ä»åº“æ¨¡å¼ï¼Œä»¥ä¿è¯æ•°æ®å‰¯æœ¬çš„ä¸€è‡´ï¼Œä¸»ä»åº“ä¹‹é—´é‡‡ç”¨çš„æ˜¯è¯»å†™åˆ†ç¦»çš„æ–¹å¼ã€‚\n è¯»æ“ä½œï¼šä¸»åº“ã€ä»åº“éƒ½å¯ä»¥æ¥æ”¶ï¼› å†™æ“ä½œï¼šé¦–å…ˆåˆ°ä¸»åº“æ‰§è¡Œï¼Œç„¶åï¼Œä¸»åº“å°†å†™æ“ä½œåŒæ­¥ç»™ä»åº“ã€‚  ä¸ºä»€ä¹ˆè¦è¯»å†™åˆ†ç¦»\nå¦‚æœåœ¨ä¸Šå›¾ä¸­ï¼Œä¸ç®¡æ˜¯ä¸»åº“è¿˜æ˜¯ä»åº“ï¼Œéƒ½èƒ½æ¥æ”¶å®¢æˆ·ç«¯çš„å†™æ“ä½œï¼Œé‚£ä¹ˆï¼Œä¸€ä¸ªç›´æ¥çš„é—®é¢˜å°±æ˜¯ï¼šå¦‚æœå®¢æˆ·ç«¯å¯¹åŒä¸€ä¸ªæ•°æ®ï¼ˆä¾‹å¦‚ k1ï¼‰å‰åä¿®æ”¹äº†ä¸‰æ¬¡ï¼Œæ¯ä¸€æ¬¡çš„ä¿®æ”¹è¯·æ±‚éƒ½å‘é€åˆ°ä¸åŒçš„å®ä¾‹ä¸Šï¼Œåœ¨ä¸åŒçš„å®ä¾‹ä¸Šæ‰§è¡Œï¼Œé‚£ä¹ˆï¼Œè¿™ä¸ªæ•°æ®åœ¨è¿™ä¸‰ä¸ªå®ä¾‹ä¸Šçš„å‰¯æœ¬å°±ä¸ä¸€è‡´äº†ï¼ˆåˆ†åˆ«æ˜¯ v1ã€v2 å’Œ v3ï¼‰ã€‚åœ¨è¯»å–è¿™ä¸ªæ•°æ®çš„æ—¶å€™ï¼Œå°±å¯èƒ½è¯»å–åˆ°æ—§çš„å€¼ã€‚\nå½“ç„¶æˆ‘ä»¬å¯ä»¥ä½¿è¿™ä¸ªæ•°æ®åœ¨ä¸‰ä¸ªå®ä¾‹ä¸Šä¿æŒä¸€è‡´ï¼Œä½†è¿™æ¶‰åŠåˆ°åŠ é”ï¼Œå®ä¾‹é—´åå•†ç­‰ä¸€ç³»åˆ—æ“ä½œï¼Œä¼šå¸¦æ¥å·¨é¢çš„å¼€é”€ã€‚\nè€Œä¸»ä»åº“æ¨¡å¼ä¸€æ—¦é‡‡ç”¨äº†è¯»å†™åˆ†ç¦»ï¼Œæ‰€æœ‰æ•°æ®çš„ä¿®æ”¹åªä¼šåœ¨ä¸»åº“ä¸Šè¿›è¡Œï¼Œä¸ç”¨åè°ƒä¸‰ä¸ªå®ä¾‹ã€‚ä¸»åº“æœ‰äº†æœ€æ–°çš„æ•°æ®åï¼Œä¼šåŒæ­¥ç»™ä»åº“ï¼Œè¿™æ ·ï¼Œä¸»ä»åº“çš„æ•°æ®å°±æ˜¯ä¸€è‡´çš„ã€‚\nä¸»ä»åº“å¦‚ä½•è¿›è¡Œç¬¬ä¸€æ¬¡åŒæ­¥ å½“æˆ‘ä»¬å¯åŠ¨å¤šä¸ª Redis å®ä¾‹çš„æ—¶å€™ï¼Œå®ƒä»¬ç›¸äº’ä¹‹é—´å°±å¯ä»¥é€šè¿‡ replicaofï¼ˆRedis 5.0 ä¹‹å‰ä½¿ç”¨ slaveofï¼‰å‘½ä»¤å½¢æˆä¸»åº“å’Œä»åº“çš„å…³ç³»ï¼Œä¹‹åä¼šæŒ‰ç…§ä¸‰ä¸ªé˜¶æ®µå®Œæˆæ•°æ®çš„ç¬¬ä¸€æ¬¡åŒæ­¥ã€‚\nä¾‹å¦‚ï¼Œç°åœ¨æœ‰å®ä¾‹ 1ï¼ˆipï¼š172.16.19.3ï¼‰å’Œå®ä¾‹ 2ï¼ˆipï¼š172.16.19.5ï¼‰ï¼Œæˆ‘ä»¬åœ¨å®ä¾‹ 2 ä¸Šæ‰§è¡Œä»¥ä¸‹è¿™ä¸ªå‘½ä»¤åï¼Œå®ä¾‹ 2 å°±å˜æˆäº†å®ä¾‹ 1 çš„ä»åº“ï¼Œå¹¶ä»å®ä¾‹ 1 ä¸Šå¤åˆ¶æ•°æ®ï¼š\nreplicaof 172.16.19.3 6379 ä¸»ä»åº“é—´æ•°æ®ç¬¬ä¸€æ¬¡åŒæ­¥æœ‰ä¸‰ä¸ªé˜¶æ®µï¼š   ä¸»ä»åº“é—´å»ºç«‹è¿æ¥ã€åå•†åŒæ­¥ã€‚ä¸»è¦æ˜¯ä¸ºå…¨é‡å¤åˆ¶åšå‡†å¤‡ã€‚åœ¨è¿™ä¸€æ­¥ï¼Œä»åº“å’Œä¸»åº“å»ºç«‹èµ·è¿æ¥ï¼Œå¹¶å‘Šè¯‰ä¸»åº“å³å°†è¿›è¡ŒåŒæ­¥ï¼Œä¸»åº“ç¡®è®¤å›å¤åï¼Œä¸»ä»åº“é—´å°±å¯ä»¥å¼€å§‹åŒæ­¥äº†ã€‚\n å…·ä½“æ¥è¯´ï¼Œä»åº“ç»™ä¸»åº“å‘é€ psync å‘½ä»¤ï¼Œè¡¨ç¤ºè¦è¿›è¡Œæ•°æ®åŒæ­¥ï¼Œä¸»åº“æ ¹æ®è¿™ä¸ªå‘½ä»¤çš„å‚æ•°æ¥å¯åŠ¨å¤åˆ¶ã€‚psync å‘½ä»¤åŒ…å«äº†ä¸»åº“çš„ runID å’Œå¤åˆ¶è¿›åº¦ offset ä¸¤ä¸ªå‚æ•°.\n runIDï¼Œæ˜¯æ¯ä¸ª Redis å®ä¾‹å¯åŠ¨æ—¶éƒ½ä¼šè‡ªåŠ¨ç”Ÿæˆçš„ä¸€ä¸ªéšæœº IDï¼Œç”¨æ¥å”¯ä¸€æ ‡è®°è¿™ä¸ªå®ä¾‹ã€‚å½“ä»åº“å’Œä¸»åº“ç¬¬ä¸€æ¬¡å¤åˆ¶æ—¶ï¼Œå› ä¸ºä¸çŸ¥é“ä¸»åº“çš„ runIDï¼Œæ‰€ä»¥å°† runID è®¾ä¸ºâ€œï¼Ÿâ€ã€‚\noffsetï¼Œæ­¤æ—¶è®¾ä¸º -1ï¼Œè¡¨ç¤ºç¬¬ä¸€æ¬¡å¤åˆ¶ã€‚\n   ä¸»åº“æ”¶åˆ° psync å‘½ä»¤åï¼Œä¼šç”¨ FULLRESYNC å“åº”å‘½ä»¤å¸¦ä¸Šä¸¤ä¸ªå‚æ•°ï¼šä¸»åº“ runID å’Œä¸»åº“ç›®å‰çš„å¤åˆ¶è¿›åº¦ offsetï¼Œè¿”å›ç»™ä»åº“ã€‚ä»åº“æ”¶åˆ°å“åº”åï¼Œä¼šè®°å½•ä¸‹è¿™ä¸¤ä¸ªå‚æ•°ã€‚ è¿™é‡Œæœ‰ä¸ªåœ°æ–¹éœ€è¦æ³¨æ„ï¼ŒFULLRESYNC å“åº”è¡¨ç¤ºç¬¬ä¸€æ¬¡å¤åˆ¶é‡‡ç”¨çš„å…¨é‡å¤åˆ¶ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸»åº“ä¼šæŠŠå½“å‰æ‰€æœ‰çš„æ•°æ®éƒ½å¤åˆ¶ç»™ä»åº“ã€‚\n   ä¸»åº“å°†æ‰€æœ‰æ•°æ®åŒæ­¥ç»™ä»åº“ã€‚ä»åº“æ”¶åˆ°æ•°æ®åï¼Œåœ¨æœ¬åœ°å®Œæˆæ•°æ®åŠ è½½ã€‚è¿™ä¸ªè¿‡ç¨‹ä¾èµ–äºå†…å­˜å¿«ç…§ç”Ÿæˆçš„ RDB æ–‡ä»¶ã€‚\n å…·ä½“æ¥è¯´ï¼Œä¸»åº“æ‰§è¡Œ bgsave å‘½ä»¤ï¼Œç”Ÿæˆ RDB æ–‡ä»¶ï¼Œæ¥ç€å°†æ–‡ä»¶å‘ç»™ä»åº“ã€‚ä»åº“æ¥æ”¶åˆ° RDB æ–‡ä»¶åï¼Œä¼šå…ˆæ¸…ç©ºå½“å‰æ•°æ®åº“ï¼Œç„¶ååŠ è½½ RDB æ–‡ä»¶ã€‚è¿™æ˜¯å› ä¸ºä»åº“åœ¨é€šè¿‡ replicaof å‘½ä»¤å¼€å§‹å’Œä¸»åº“åŒæ­¥å‰ï¼Œå¯èƒ½ä¿å­˜äº†å…¶ä»–æ•°æ®ã€‚ä¸ºäº†é¿å…ä¹‹å‰æ•°æ®çš„å½±å“ï¼Œä»åº“éœ€è¦å…ˆæŠŠå½“å‰æ•°æ®åº“æ¸…ç©ºã€‚ åœ¨ä¸»åº“å°†æ•°æ®åŒæ­¥ç»™ä»åº“çš„è¿‡ç¨‹ä¸­ï¼Œä¸»åº“ä¸ä¼šè¢«é˜»å¡ï¼Œä»ç„¶å¯ä»¥æ­£å¸¸æ¥æ”¶è¯·æ±‚ã€‚å¦åˆ™ï¼ŒRedis çš„æœåŠ¡å°±è¢«ä¸­æ–­äº†ã€‚ä½†æ˜¯ï¼Œè¿™äº›è¯·æ±‚ä¸­çš„å†™æ“ä½œå¹¶æ²¡æœ‰è®°å½•åˆ°åˆšåˆšç”Ÿæˆçš„ RDB æ–‡ä»¶ä¸­ã€‚ä¸ºäº†ä¿è¯ä¸»ä»åº“çš„æ•°æ®ä¸€è‡´æ€§ï¼Œä¸»åº“ä¼šåœ¨å†…å­˜ä¸­ç”¨ä¸“é—¨çš„ replication bufferï¼Œè®°å½• RDB æ–‡ä»¶ç”Ÿæˆåæ”¶åˆ°çš„æ‰€æœ‰å†™æ“ä½œã€‚\n   ä¸»åº“æŠŠç¬¬äºŒé˜¶æ®µæ‰§è¡Œè¿‡ç¨‹ä¸­æ–°æ”¶åˆ°çš„å†™å‘½ä»¤ï¼Œå†å‘é€ç»™ä»åº“\n å½“ä¸»åº“å®Œæˆ RDB æ–‡ä»¶å‘é€åï¼Œå°±ä¼šæŠŠæ­¤æ—¶ replication buffer ä¸­çš„ä¿®æ”¹æ“ä½œå‘ç»™ä»åº“ï¼Œä»åº“å†é‡æ–°æ‰§è¡Œè¿™äº›æ“ä½œã€‚\n   ç»è¿‡è¿™æ ·ä¸‰æ­¥ï¼Œä¸»ä»åº“å°±å®ç°äº†åŒæ­¥ã€‚\nä¸»ä»çº§è” ä¸€æ¬¡å…¨é‡å¤åˆ¶ä¸­ï¼Œå¯¹äºä¸»åº“æ¥è¯´ï¼Œéœ€è¦å®Œæˆä¸¤ä¸ªè€—æ—¶çš„æ“ä½œï¼šç”Ÿæˆ RDB æ–‡ä»¶å’Œä¼ è¾“ RDB æ–‡ä»¶ã€‚\nå¦‚æœä»åº“æ•°é‡å¾ˆå¤šï¼Œè€Œä¸”éƒ½è¦å’Œä¸»åº“è¿›è¡Œå…¨é‡å¤åˆ¶çš„è¯ï¼Œå°±ä¼šå¯¼è‡´ä¸»åº“å¿™äº fork å­è¿›ç¨‹ç”Ÿæˆ RDB æ–‡ä»¶ï¼Œè¿›è¡Œæ•°æ®å…¨é‡åŒæ­¥ã€‚fork è¿™ä¸ªæ“ä½œä¼šé˜»å¡ä¸»çº¿ç¨‹å¤„ç†æ­£å¸¸è¯·æ±‚ï¼Œä»è€Œå¯¼è‡´ä¸»åº“å“åº”åº”ç”¨ç¨‹åºçš„è¯·æ±‚é€Ÿåº¦å˜æ…¢ã€‚æ­¤å¤–ï¼Œä¼ è¾“ RDB æ–‡ä»¶ä¹Ÿä¼šå ç”¨ä¸»åº“çš„ç½‘ç»œå¸¦å®½ï¼ŒåŒæ ·ä¼šç»™ä¸»åº“çš„èµ„æºä½¿ç”¨å¸¦æ¥å‹åŠ›ã€‚\næˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸» - ä» - ä»æ¨¡å¼å°†ä¸»åº“ç”Ÿæˆ RDB å’Œä¼ è¾“ RDB çš„å‹åŠ›ï¼Œä»¥çº§è”çš„æ–¹å¼åˆ†æ•£åˆ°ä»åº“ä¸Šã€‚\nç®€å•æ¥è¯´ï¼Œæˆ‘ä»¬åœ¨éƒ¨ç½²ä¸»ä»é›†ç¾¤çš„æ—¶å€™ï¼Œå¯ä»¥æ‰‹åŠ¨é€‰æ‹©ä¸€ä¸ªä»åº“ï¼ˆæ¯”å¦‚é€‰æ‹©å†…å­˜èµ„æºé…ç½®è¾ƒé«˜çš„ä»åº“ï¼‰ï¼Œç”¨äºçº§è”å…¶ä»–çš„ä»åº“ã€‚ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥å†é€‰æ‹©ä¸€äº›ä»åº“ï¼ˆä¾‹å¦‚ä¸‰åˆ†ä¹‹ä¸€çš„ä»åº“ï¼‰ï¼Œåœ¨è¿™äº›ä»åº“ä¸Šæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œè®©å®ƒä»¬å’Œåˆšæ‰æ‰€é€‰çš„ä»åº“ï¼Œå»ºç«‹èµ·ä¸»ä»å…³ç³»ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¤§å“¥çš„å°å¼Ÿä¹Ÿæ”¶äº†å°å°å¼Ÿäº†ã€‚\nreplicaof æ‰€é€‰ä»åº“çš„IP 6379 ä¸€æ—¦ä¸»ä»åº“å®Œæˆäº†å…¨é‡å¤åˆ¶ï¼Œå®ƒä»¬ä¹‹é—´å°±ä¼šä¸€ç›´ç»´æŠ¤ä¸€ä¸ªç½‘ç»œè¿æ¥ï¼Œä¸»åº“ä¼šé€šè¿‡è¿™ä¸ªè¿æ¥å°†åç»­é™†ç»­æ”¶åˆ°çš„å‘½ä»¤æ“ä½œå†åŒæ­¥ç»™ä»åº“ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¹Ÿç§°ä¸ºåŸºäºé•¿è¿æ¥çš„å‘½ä»¤ä¼ æ’­ï¼Œå¯ä»¥é¿å…é¢‘ç¹å»ºç«‹è¿æ¥çš„å¼€é”€ã€‚\nç½‘ç»œä¸­æ–­çš„é£é™© ä¸»ä»ä¹‹é—´è¦ä¿æŒé•¿è¿æ¥ï¼Œä»¥ä¾¿æ•°æ®äº¤æµï¼Œå¹¶èŠ‚çœé¢‘ç¹å»ºç«‹è¿æ¥çš„å¼€é”€ã€‚\nä½†å¦‚æœç½‘ç»œæ–­è¿ï¼Œä¸»ä»åº“ä¹‹é—´å°±æ— æ³•è¿›è¡Œå‘½ä»¤ä¼ æ’­äº†ï¼Œä»åº“çš„æ•°æ®è‡ªç„¶ä¹Ÿå°±æ²¡åŠæ³•å’Œä¸»åº“ä¿æŒä¸€è‡´äº†ï¼Œå®¢æˆ·ç«¯å°±å¯èƒ½ä»ä»åº“è¯»åˆ°æ—§æ•°æ®ã€‚\nåœ¨ Redis 2.8 ä¹‹å‰ï¼Œå¦‚æœä¸»ä»åº“åœ¨å‘½ä»¤ä¼ æ’­æ—¶å‡ºç°äº†ç½‘ç»œé—ªæ–­ï¼Œé‚£ä¹ˆï¼Œä»åº“å°±ä¼šå’Œä¸»åº“é‡æ–°è¿›è¡Œä¸€æ¬¡å…¨é‡å¤åˆ¶ï¼Œå¼€é”€éå¸¸å¤§ã€‚\nä» Redis 2.8 å¼€å§‹ï¼Œç½‘ç»œæ–­äº†ä¹‹åï¼Œä¸»ä»åº“ä¼šé‡‡ç”¨å¢é‡å¤åˆ¶çš„æ–¹å¼ç»§ç»­åŒæ­¥ã€‚\nå¢é‡å¤åˆ¶æ—¶ï¼Œä¸ºäº†ä¿æŒä¸»ä»ä¹‹é—´çš„åŒæ­¥ï¼Œéœ€è¦ä½¿ç”¨repl_backlog_bufferè¿™ä¸ªç¼“å†²åŒºã€‚\nå½“ä¸»ä»åº“æ–­è¿åï¼Œä¸»åº“ä¼šæŠŠæ–­è¿æœŸé—´æ”¶åˆ°çš„å†™æ“ä½œå‘½ä»¤ï¼Œå†™å…¥ repl_backlog_buffer è¿™ä¸ªç¼“å†²åŒºã€‚\nrepl_backlog_buffer æ˜¯ä¸€ä¸ªç¯å½¢ç¼“å†²åŒºï¼Œä¸»åº“ä¼šè®°å½•è‡ªå·±å†™åˆ°çš„ä½ç½®ï¼Œä»åº“åˆ™ä¼šè®°å½•è‡ªå·±å·²ç»è¯»åˆ°çš„ä½ç½®ã€‚\nåˆšå¼€å§‹çš„æ—¶å€™ï¼Œä¸»åº“å’Œä»åº“çš„å†™è¯»ä½ç½®åœ¨ä¸€èµ·ï¼Œè¿™ç®—æ˜¯å®ƒä»¬çš„èµ·å§‹ä½ç½®ã€‚éšç€ä¸»åº“ä¸æ–­æ¥æ”¶æ–°çš„å†™æ“ä½œï¼Œå®ƒåœ¨ç¼“å†²åŒºä¸­çš„å†™ä½ç½®ä¼šé€æ­¥åç¦»èµ·å§‹ä½ç½®ï¼Œæˆ‘ä»¬é€šå¸¸ç”¨åç§»é‡æ¥è¡¡é‡è¿™ä¸ªåç§»è·ç¦»çš„å¤§å°ï¼Œå¯¹ä¸»åº“æ¥è¯´ï¼Œå¯¹åº”çš„åç§»é‡å°±æ˜¯ master_repl_offsetã€‚ä¸»åº“æ¥æ”¶çš„æ–°å†™æ“ä½œè¶Šå¤šï¼Œè¿™ä¸ªå€¼å°±ä¼šè¶Šå¤§ã€‚\nåŒæ ·ï¼Œä»åº“åœ¨å¤åˆ¶å®Œå†™æ“ä½œå‘½ä»¤åï¼Œå®ƒåœ¨ç¼“å†²åŒºä¸­çš„è¯»ä½ç½®ä¹Ÿå¼€å§‹é€æ­¥åç§»åˆšæ‰çš„èµ·å§‹ä½ç½®ï¼Œæ­¤æ—¶ï¼Œä»åº“å·²å¤åˆ¶çš„åç§»é‡ slave_repl_offset ä¹Ÿåœ¨ä¸æ–­å¢åŠ ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œè¿™ä¸¤ä¸ªåç§»é‡åŸºæœ¬ç›¸ç­‰ã€‚\nä¸»ä»åº“çš„è¿æ¥æ¢å¤ä¹‹åï¼Œä»åº“é¦–å…ˆä¼šç»™ä¸»åº“å‘é€ psync å‘½ä»¤ï¼Œå¹¶æŠŠè‡ªå·±å½“å‰çš„ slave_repl_offset å‘ç»™ä¸»åº“ï¼Œä¸»åº“ä¼šåˆ¤æ–­è‡ªå·±çš„ master_repl_offset å’Œ slave_repl_offset ä¹‹é—´çš„å·®è·ã€‚\nåœ¨ç½‘ç»œæ–­è¿é˜¶æ®µï¼Œä¸»åº“å¯èƒ½ä¼šæ”¶åˆ°æ–°çš„å†™æ“ä½œå‘½ä»¤ï¼Œæ‰€ä»¥ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œmaster_repl_offset ä¼šå¤§äº slave_repl_offsetã€‚æ­¤æ—¶ï¼Œä¸»åº“åªç”¨æŠŠ master_repl_offset å’Œ slave_repl_offset ä¹‹é—´çš„å‘½ä»¤æ“ä½œåŒæ­¥ç»™ä»åº“å°±è¡Œã€‚\nå…³äºrepl_backlog_buffer è¿™é‡Œå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šrepl_backlog_bufferæ˜¯ä¸€ä¸ªç¯å½¢ç¼“å†²åŒºï¼Œå¦‚æœä»åº“çš„è¯»å–é€Ÿåº¦æ¯”è¾ƒæ…¢ï¼Œå°±æœ‰å¯èƒ½å¯¼è‡´ä»åº“è¿˜æœªè¯»å–çš„æ“ä½œè¢«ä¸»åº“æ–°å†™çš„æ“ä½œè¦†ç›–äº†ï¼Œè¿™ä¼šå¯¼è‡´ä¸»ä»ä¸ä¸€è‡´ã€‚\nå› æ­¤ï¼Œæˆ‘ä»¬è¦æƒ³åŠæ³•é¿å…è¿™ä¸€æƒ…å†µï¼Œä¸€èˆ¬è€Œè¨€ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒæ•´ repl_backlog_size è¿™ä¸ªå‚æ•°ã€‚è¿™ä¸ªå‚æ•°å’Œæ‰€éœ€çš„ç¼“å†²ç©ºé—´å¤§å°æœ‰å…³ã€‚ç¼“å†²ç©ºé—´çš„è®¡ç®—å…¬å¼æ˜¯ï¼šç¼“å†²ç©ºé—´å¤§å° = ä¸»åº“å†™å…¥å‘½ä»¤é€Ÿåº¦ * æ“ä½œå¤§å° - ä¸»ä»åº“é—´ç½‘ç»œä¼ è¾“å‘½ä»¤é€Ÿåº¦ * æ“ä½œå¤§å°ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè€ƒè™‘åˆ°å¯èƒ½å­˜åœ¨ä¸€äº›çªå‘çš„è¯·æ±‚å‹åŠ›ï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦æŠŠè¿™ä¸ªç¼“å†²ç©ºé—´æ‰©å¤§ä¸€å€ï¼Œå³ repl_backlog_size = ç¼“å†²ç©ºé—´å¤§å° * 2ï¼Œè¿™ä¹Ÿå°±æ˜¯ repl_backlog_sizeçš„æœ€ç»ˆå€¼ã€‚\nè¿™æ ·ä¸€æ¥ï¼Œå¢é‡å¤åˆ¶æ—¶ä¸»ä»åº“çš„æ•°æ®ä¸ä¸€è‡´é£é™©å°±é™ä½äº†ã€‚ä¸è¿‡ï¼Œå¦‚æœå¹¶å‘è¯·æ±‚é‡éå¸¸å¤§ï¼Œè¿ä¸¤å€çš„ç¼“å†²ç©ºé—´éƒ½å­˜ä¸ä¸‹æ–°æ“ä½œè¯·æ±‚çš„è¯ï¼Œæ­¤æ—¶ï¼Œä¸»ä»åº“æ•°æ®ä»ç„¶å¯èƒ½ä¸ä¸€è‡´ã€‚\né’ˆå¯¹è¿™ç§æƒ…å†µï¼Œä¸€æ–¹é¢ï¼Œä½ å¯ä»¥æ ¹æ® Redis æ‰€åœ¨æœåŠ¡å™¨çš„å†…å­˜èµ„æºå†é€‚å½“å¢åŠ  repl_backlog_size å€¼ï¼Œæ¯”å¦‚è¯´è®¾ç½®æˆç¼“å†²ç©ºé—´å¤§å°çš„ 4 å€ï¼Œå¦ä¸€æ–¹é¢ï¼Œä½ å¯ä»¥è€ƒè™‘ä½¿ç”¨åˆ‡ç‰‡é›†ç¾¤æ¥åˆ†æ‹…å•ä¸ªä¸»åº“çš„è¯·æ±‚å‹åŠ›ã€‚\nå¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼šä¸€ä¸ªä»åº“å¦‚æœå’Œä¸»åº“æ–­è¿æ—¶é—´è¿‡é•¿ï¼Œé€ æˆå®ƒåœ¨ä¸»åº“repl_backlog_bufferçš„slave_repl_offsetä½ç½®ä¸Šçš„æ•°æ®å·²ç»è¢«è¦†ç›–æ‰äº†ï¼Œæ­¤æ—¶ä»åº“å’Œä¸»åº“é—´å°†è¿›è¡Œå…¨é‡å¤åˆ¶ã€‚\nä¸ºä»€ä¹ˆä¸»ä»åŒæ­¥ä¸é€‚ç”¨AOF 1ã€RDBæ–‡ä»¶å†…å®¹æ˜¯ç»è¿‡å‹ç¼©çš„äºŒè¿›åˆ¶æ•°æ®ï¼ˆä¸åŒæ•°æ®ç±»å‹æ•°æ®åšäº†é’ˆå¯¹æ€§ä¼˜åŒ–ï¼‰ï¼Œæ–‡ä»¶å¾ˆå°ã€‚è€ŒAOFæ–‡ä»¶è®°å½•çš„æ˜¯æ¯ä¸€æ¬¡å†™æ“ä½œçš„å‘½ä»¤ï¼Œå†™æ“ä½œè¶Šå¤šæ–‡ä»¶ä¼šå˜å¾—å¾ˆå¤§ï¼Œå…¶ä¸­è¿˜åŒ…æ‹¬å¾ˆå¤šå¯¹åŒä¸€ä¸ªkeyçš„å¤šæ¬¡å†—ä½™æ“ä½œã€‚åœ¨ä¸»ä»å…¨é‡æ•°æ®åŒæ­¥æ—¶ï¼Œä¼ è¾“RDBæ–‡ä»¶å¯ä»¥å°½é‡é™ä½å¯¹ä¸»åº“æœºå™¨ç½‘ç»œå¸¦å®½çš„æ¶ˆè€—ï¼Œä»åº“åœ¨åŠ è½½RDBæ–‡ä»¶æ—¶ï¼Œä¸€æ˜¯æ–‡ä»¶å°ï¼Œè¯»å–æ•´ä¸ªæ–‡ä»¶çš„é€Ÿåº¦ä¼šå¾ˆå¿«ï¼ŒäºŒæ˜¯å› ä¸ºRDBæ–‡ä»¶å­˜å‚¨çš„éƒ½æ˜¯äºŒè¿›åˆ¶æ•°æ®ï¼Œä»åº“ç›´æ¥æŒ‰ç…§RDBåè®®è§£æè¿˜åŸæ•°æ®å³å¯ï¼Œé€Ÿåº¦ä¼šéå¸¸å¿«ï¼Œè€ŒAOFéœ€è¦ä¾æ¬¡é‡æ”¾æ¯ä¸ªå†™å‘½ä»¤ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šç»å†å†—é•¿çš„å¤„ç†é€»è¾‘ï¼Œæ¢å¤é€Ÿåº¦ç›¸æ¯”RDBä¼šæ…¢å¾—å¤šï¼Œæ‰€ä»¥ä½¿ç”¨RDBè¿›è¡Œä¸»ä»å…¨é‡åŒæ­¥çš„æˆæœ¬æœ€ä½ã€‚\n2ã€å‡è®¾è¦ä½¿ç”¨AOFåšå…¨é‡åŒæ­¥ï¼Œæ„å‘³ç€å¿…é¡»æ‰“å¼€AOFåŠŸèƒ½ï¼Œæ‰“å¼€AOFå°±è¦é€‰æ‹©æ–‡ä»¶åˆ·ç›˜çš„ç­–ç•¥ï¼Œé€‰æ‹©ä¸å½“ä¼šä¸¥é‡å½±å“Redisæ€§èƒ½ã€‚è€ŒRDBåªæœ‰åœ¨éœ€è¦å®šæ—¶å¤‡ä»½å’Œä¸»ä»å…¨é‡åŒæ­¥æ•°æ®æ—¶æ‰ä¼šè§¦å‘ç”Ÿæˆä¸€æ¬¡å¿«ç…§ã€‚è€Œåœ¨å¾ˆå¤šä¸¢å¤±æ•°æ®ä¸æ•æ„Ÿçš„ä¸šåŠ¡åœºæ™¯ï¼Œå…¶å®æ˜¯ä¸éœ€è¦å¼€å¯AOFçš„ã€‚\n replication buffer Rediså’Œå®¢æˆ·ç«¯é€šä¿¡ä¹Ÿå¥½ï¼Œå’Œä»åº“é€šä¿¡ä¹Ÿå¥½ï¼ŒRediséƒ½éœ€è¦ç»™åˆ†é…ä¸€ä¸ª å†…å­˜bufferè¿›è¡Œæ•°æ®äº¤äº’ï¼Œå®¢æˆ·ç«¯æ˜¯ä¸€ä¸ªclientï¼Œä»åº“ä¹Ÿæ˜¯ä¸€ä¸ªclientï¼Œæˆ‘ä»¬æ¯ä¸ªclientè¿ä¸ŠRedisåï¼ŒRediséƒ½ä¼šåˆ†é…ä¸€ä¸ªclient bufferï¼Œæ‰€æœ‰æ•°æ®äº¤äº’éƒ½æ˜¯é€šè¿‡è¿™ä¸ªbufferè¿›è¡Œçš„ï¼šRediså…ˆæŠŠæ•°æ®å†™åˆ°è¿™ä¸ªbufferä¸­ï¼Œç„¶åå†æŠŠbufferä¸­çš„æ•°æ®å‘åˆ°client socketä¸­å†é€šè¿‡ç½‘ç»œå‘é€å‡ºå»ï¼Œè¿™æ ·å°±å®Œæˆäº†æ•°æ®äº¤äº’ã€‚æ‰€ä»¥ä¸»ä»åœ¨å¢é‡åŒæ­¥æ—¶ï¼Œä»åº“ä½œä¸ºä¸€ä¸ªclientï¼Œä¹Ÿä¼šåˆ†é…ä¸€ä¸ªbufferï¼Œåªä¸è¿‡è¿™ä¸ªbufferä¸“é—¨ç”¨æ¥ä¼ æ’­ç”¨æˆ·çš„å†™å‘½ä»¤åˆ°ä»åº“ï¼Œä¿è¯ä¸»ä»æ•°æ®ä¸€è‡´ï¼Œæˆ‘ä»¬é€šå¸¸æŠŠå®ƒå«åšreplication buffer\nå†å»¶ä¼¸ä¸€ä¸‹ï¼Œæ—¢ç„¶æœ‰è¿™ä¸ªå†…å­˜bufferå­˜åœ¨ï¼Œé‚£ä¹ˆè¿™ä¸ªbufferæœ‰æ²¡æœ‰é™åˆ¶å‘¢ï¼Ÿå¦‚æœä¸»ä»åœ¨ä¼ æ’­å‘½ä»¤æ—¶ï¼Œå› ä¸ºæŸäº›åŸå› ä»åº“å¤„ç†å¾—éå¸¸æ…¢ï¼Œé‚£ä¹ˆä¸»åº“ä¸Šçš„è¿™ä¸ªbufferå°±ä¼šæŒç»­å¢é•¿ï¼Œæ¶ˆè€—å¤§é‡çš„å†…å­˜èµ„æºï¼Œç”šè‡³OOMã€‚æ‰€ä»¥Redisæä¾›äº†client-output-buffer-limitå‚æ•°é™åˆ¶è¿™ä¸ªbufferçš„å¤§å°ï¼Œå¦‚æœè¶…è¿‡é™åˆ¶ï¼Œä¸»åº“ä¼šå¼ºåˆ¶æ–­å¼€è¿™ä¸ªclientçš„è¿æ¥ï¼Œä¹Ÿå°±æ˜¯è¯´ä»åº“å¤„ç†æ…¢å¯¼è‡´ä¸»åº“å†…å­˜bufferçš„ç§¯å‹è¾¾åˆ°é™åˆ¶åï¼Œä¸»åº“ä¼šå¼ºåˆ¶æ–­å¼€ä»åº“çš„è¿æ¥ï¼Œæ­¤æ—¶ä¸»ä»å¤åˆ¶ä¼šä¸­æ–­ï¼Œä¸­æ–­åå¦‚æœä»åº“å†æ¬¡å‘èµ·å¤åˆ¶è¯·æ±‚ï¼Œé‚£ä¹ˆæ­¤æ—¶å¯èƒ½ä¼šå¯¼è‡´æ¶æ€§å¾ªç¯ï¼Œå¼•å‘å¤åˆ¶é£æš´ï¼Œè¿™ç§æƒ…å†µéœ€è¦æ ¼å¤–æ³¨æ„ã€‚\n","permalink":"http://yangchnet.github.io/Dessert/posts/cache/%E6%A6%82%E8%A7%88redis%E7%AF%87%E5%9B%9B%E4%B8%BB%E4%BB%8E/","summary":"æå®¢æ—¶é—´ã€ŠRedis æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜ã€‹å­¦ä¹ ç¬”è®°\n  æ¦‚è§ˆRedisç¯‡ä¸€ï¼šå•çº¿ç¨‹æ¨¡å‹ æ¦‚è§ˆRedisç¯‡äºŒï¼šAOFæ—¥å¿— æ¦‚è§ˆRedisç¯‡ä¸‰ï¼šRDBå¿«ç…§ æ¦‚è§ˆRedisç¯‡å››ï¼šä¸»ä» æ¦‚è§ˆRedisç¯‡äº”ï¼šå“¨å…µ æ¦‚è§ˆRedisç¯‡å…­ï¼šåˆ‡ç‰‡é›†ç¾¤  Redisçš„é«˜å¯é æ€§ Redis å…·æœ‰é«˜å¯é æ€§ï¼Œåˆæ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿå…¶å®ï¼Œè¿™é‡Œæœ‰ä¸¤å±‚å«ä¹‰ï¼šä¸€æ˜¯æ•°æ®å°½é‡å°‘ä¸¢å¤±ï¼ŒäºŒæ˜¯æœåŠ¡å°½é‡å°‘ä¸­æ–­ã€‚\nAOF å’Œ RDB ä¿è¯äº†å‰è€…ï¼Œè€Œå¯¹äºåè€…ï¼ŒRedis çš„åšæ³•å°±æ˜¯å¢åŠ å‰¯æœ¬å†—ä½™é‡ï¼Œå°†ä¸€ä»½æ•°æ®åŒæ—¶ä¿å­˜åœ¨å¤šä¸ªå®ä¾‹ä¸Šã€‚å³ä½¿æœ‰ä¸€ä¸ªå®ä¾‹å‡ºç°äº†æ•…éšœï¼Œéœ€è¦è¿‡ä¸€æ®µæ—¶é—´æ‰èƒ½æ¢å¤ï¼Œå…¶ä»–å®ä¾‹ä¹Ÿå¯ä»¥å¯¹å¤–æä¾›æœåŠ¡ï¼Œä¸ä¼šå½±å“ä¸šåŠ¡ä½¿ç”¨ã€‚\nRedis æä¾›äº†ä¸»ä»åº“æ¨¡å¼ï¼Œä»¥ä¿è¯æ•°æ®å‰¯æœ¬çš„ä¸€è‡´ï¼Œä¸»ä»åº“ä¹‹é—´é‡‡ç”¨çš„æ˜¯è¯»å†™åˆ†ç¦»çš„æ–¹å¼ã€‚\n è¯»æ“ä½œï¼šä¸»åº“ã€ä»åº“éƒ½å¯ä»¥æ¥æ”¶ï¼› å†™æ“ä½œï¼šé¦–å…ˆåˆ°ä¸»åº“æ‰§è¡Œï¼Œç„¶åï¼Œä¸»åº“å°†å†™æ“ä½œåŒæ­¥ç»™ä»åº“ã€‚  ä¸ºä»€ä¹ˆè¦è¯»å†™åˆ†ç¦»\nå¦‚æœåœ¨ä¸Šå›¾ä¸­ï¼Œä¸ç®¡æ˜¯ä¸»åº“è¿˜æ˜¯ä»åº“ï¼Œéƒ½èƒ½æ¥æ”¶å®¢æˆ·ç«¯çš„å†™æ“ä½œï¼Œé‚£ä¹ˆï¼Œä¸€ä¸ªç›´æ¥çš„é—®é¢˜å°±æ˜¯ï¼šå¦‚æœå®¢æˆ·ç«¯å¯¹åŒä¸€ä¸ªæ•°æ®ï¼ˆä¾‹å¦‚ k1ï¼‰å‰åä¿®æ”¹äº†ä¸‰æ¬¡ï¼Œæ¯ä¸€æ¬¡çš„ä¿®æ”¹è¯·æ±‚éƒ½å‘é€åˆ°ä¸åŒçš„å®ä¾‹ä¸Šï¼Œåœ¨ä¸åŒçš„å®ä¾‹ä¸Šæ‰§è¡Œï¼Œé‚£ä¹ˆï¼Œè¿™ä¸ªæ•°æ®åœ¨è¿™ä¸‰ä¸ªå®ä¾‹ä¸Šçš„å‰¯æœ¬å°±ä¸ä¸€è‡´äº†ï¼ˆåˆ†åˆ«æ˜¯ v1ã€v2 å’Œ v3ï¼‰ã€‚åœ¨è¯»å–è¿™ä¸ªæ•°æ®çš„æ—¶å€™ï¼Œå°±å¯èƒ½è¯»å–åˆ°æ—§çš„å€¼ã€‚\nå½“ç„¶æˆ‘ä»¬å¯ä»¥ä½¿è¿™ä¸ªæ•°æ®åœ¨ä¸‰ä¸ªå®ä¾‹ä¸Šä¿æŒä¸€è‡´ï¼Œä½†è¿™æ¶‰åŠåˆ°åŠ é”ï¼Œå®ä¾‹é—´åå•†ç­‰ä¸€ç³»åˆ—æ“ä½œï¼Œä¼šå¸¦æ¥å·¨é¢çš„å¼€é”€ã€‚\nè€Œä¸»ä»åº“æ¨¡å¼ä¸€æ—¦é‡‡ç”¨äº†è¯»å†™åˆ†ç¦»ï¼Œæ‰€æœ‰æ•°æ®çš„ä¿®æ”¹åªä¼šåœ¨ä¸»åº“ä¸Šè¿›è¡Œï¼Œä¸ç”¨åè°ƒä¸‰ä¸ªå®ä¾‹ã€‚ä¸»åº“æœ‰äº†æœ€æ–°çš„æ•°æ®åï¼Œä¼šåŒæ­¥ç»™ä»åº“ï¼Œè¿™æ ·ï¼Œä¸»ä»åº“çš„æ•°æ®å°±æ˜¯ä¸€è‡´çš„ã€‚\nä¸»ä»åº“å¦‚ä½•è¿›è¡Œç¬¬ä¸€æ¬¡åŒæ­¥ å½“æˆ‘ä»¬å¯åŠ¨å¤šä¸ª Redis å®ä¾‹çš„æ—¶å€™ï¼Œå®ƒä»¬ç›¸äº’ä¹‹é—´å°±å¯ä»¥é€šè¿‡ replicaofï¼ˆRedis 5.0 ä¹‹å‰ä½¿ç”¨ slaveofï¼‰å‘½ä»¤å½¢æˆä¸»åº“å’Œä»åº“çš„å…³ç³»ï¼Œä¹‹åä¼šæŒ‰ç…§ä¸‰ä¸ªé˜¶æ®µå®Œæˆæ•°æ®çš„ç¬¬ä¸€æ¬¡åŒæ­¥ã€‚\nä¾‹å¦‚ï¼Œç°åœ¨æœ‰å®ä¾‹ 1ï¼ˆipï¼š172.16.19.3ï¼‰å’Œå®ä¾‹ 2ï¼ˆipï¼š172.16.19.5ï¼‰ï¼Œæˆ‘ä»¬åœ¨å®ä¾‹ 2 ä¸Šæ‰§è¡Œä»¥ä¸‹è¿™ä¸ªå‘½ä»¤åï¼Œå®ä¾‹ 2 å°±å˜æˆäº†å®ä¾‹ 1 çš„ä»åº“ï¼Œå¹¶ä»å®ä¾‹ 1 ä¸Šå¤åˆ¶æ•°æ®ï¼š\nreplicaof 172.16.19.3 6379 ä¸»ä»åº“é—´æ•°æ®ç¬¬ä¸€æ¬¡åŒæ­¥æœ‰ä¸‰ä¸ªé˜¶æ®µï¼š   ä¸»ä»åº“é—´å»ºç«‹è¿æ¥ã€åå•†åŒæ­¥ã€‚ä¸»è¦æ˜¯ä¸ºå…¨é‡å¤åˆ¶åšå‡†å¤‡ã€‚åœ¨è¿™ä¸€æ­¥ï¼Œä»åº“å’Œä¸»åº“å»ºç«‹èµ·è¿æ¥ï¼Œå¹¶å‘Šè¯‰ä¸»åº“å³å°†è¿›è¡ŒåŒæ­¥ï¼Œä¸»åº“ç¡®è®¤å›å¤åï¼Œä¸»ä»åº“é—´å°±å¯ä»¥å¼€å§‹åŒæ­¥äº†ã€‚\n å…·ä½“æ¥è¯´ï¼Œä»åº“ç»™ä¸»åº“å‘é€ psync å‘½ä»¤ï¼Œè¡¨ç¤ºè¦è¿›è¡Œæ•°æ®åŒæ­¥ï¼Œä¸»åº“æ ¹æ®è¿™ä¸ªå‘½ä»¤çš„å‚æ•°æ¥å¯åŠ¨å¤åˆ¶ã€‚psync å‘½ä»¤åŒ…å«äº†ä¸»åº“çš„ runID å’Œå¤åˆ¶è¿›åº¦ offset ä¸¤ä¸ªå‚æ•°.\n runIDï¼Œæ˜¯æ¯ä¸ª Redis å®ä¾‹å¯åŠ¨æ—¶éƒ½ä¼šè‡ªåŠ¨ç”Ÿæˆçš„ä¸€ä¸ªéšæœº IDï¼Œç”¨æ¥å”¯ä¸€æ ‡è®°è¿™ä¸ªå®ä¾‹ã€‚å½“ä»åº“å’Œä¸»åº“ç¬¬ä¸€æ¬¡å¤åˆ¶æ—¶ï¼Œå› ä¸ºä¸çŸ¥é“ä¸»åº“çš„ runIDï¼Œæ‰€ä»¥å°† runID è®¾ä¸ºâ€œï¼Ÿâ€ã€‚","title":"æ¦‚è§ˆRedisç¯‡å››ï¼šä¸»ä»"},{"content":"8086ç»“æ„ x86æ¶æ„ä¸­ç»å…¸çš„å¤„ç†å™¨8086çš„å¤§ä½“ç»“æ„å¦‚ä¸‹ï¼š\nå…¶å¯»å€èŒƒå›´ä¸º1M\nä¸ºäº†æš‚å­˜æ•°æ®ï¼Œ8086 å¤„ç†å™¨å†…éƒ¨æœ‰ 8 ä¸ª 16 ä½çš„é€šç”¨å¯„å­˜å™¨ï¼Œä¹Ÿå°±æ˜¯åˆšæ‰è¯´çš„ CPU å†…éƒ¨çš„æ•°æ®å•å…ƒï¼Œåˆ†åˆ«æ˜¯ AXã€BXã€CXã€DXã€SPã€BPã€SIã€DIã€‚è¿™äº›å¯„å­˜å™¨ä¸»è¦ç”¨äºåœ¨è®¡ç®—è¿‡ç¨‹ä¸­æš‚å­˜æ•°æ®ã€‚è¿™äº›å¯„å­˜å™¨æ¯”è¾ƒçµæ´»ï¼Œå…¶ä¸­ AXã€BXã€CXã€DX å¯ä»¥åˆ†æˆä¸¤ä¸ª 8 ä½çš„å¯„å­˜å™¨æ¥ä½¿ç”¨ï¼Œåˆ†åˆ«æ˜¯ AHã€ALã€BHã€BLã€CHã€CLã€DHã€DLï¼Œå…¶ä¸­ H å°±æ˜¯ Highï¼ˆé«˜ä½ï¼‰ï¼ŒL å°±æ˜¯ Lowï¼ˆä½ä½ï¼‰çš„æ„æ€ã€‚\næ§åˆ¶å•å…ƒï¼š\nIP å¯„å­˜å™¨å°±æ˜¯æŒ‡ä»¤æŒ‡é’ˆå¯„å­˜å™¨ï¼ˆInstruction Pointer Registerï¼‰ï¼ŒæŒ‡å‘ä»£ç æ®µä¸­ä¸‹ä¸€æ¡æŒ‡ä»¤çš„ä½ç½®ã€‚CPU ä¼šæ ¹æ®å®ƒæ¥ä¸æ–­åœ°å°†æŒ‡ä»¤ä»å†…å­˜çš„ä»£ç æ®µä¸­ï¼ŒåŠ è½½åˆ° CPU çš„æŒ‡ä»¤é˜Ÿåˆ—ä¸­ï¼Œç„¶åäº¤ç»™è¿ç®—å•å…ƒå»æ‰§è¡Œã€‚\nå¦‚æœéœ€è¦åˆ‡æ¢è¿›ç¨‹ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½åˆ†ä»£ç æ®µå’Œæ•°æ®æ®µï¼Œä¸ºäº†æŒ‡å‘ä¸åŒè¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼Œæœ‰å››ä¸ª 16 ä½çš„æ®µå¯„å­˜å™¨ï¼Œåˆ†åˆ«æ˜¯ CSã€DSã€SSã€ESã€‚\nå…¶ä¸­ï¼ŒCS å°±æ˜¯ä»£ç æ®µå¯„å­˜å™¨ï¼ˆCode Segment Registerï¼‰ï¼Œé€šè¿‡å®ƒå¯ä»¥æ‰¾åˆ°ä»£ç åœ¨å†…å­˜ä¸­çš„ä½ç½®ï¼›DS æ˜¯æ•°æ®æ®µçš„å¯„å­˜å™¨ï¼Œé€šè¿‡å®ƒå¯ä»¥æ‰¾åˆ°æ•°æ®åœ¨å†…å­˜ä¸­çš„ä½ç½®ã€‚SS æ˜¯æ ˆå¯„å­˜å™¨ï¼ˆStack Registerï¼‰ã€‚æ ˆæ˜¯ç¨‹åºè¿è¡Œä¸­ä¸€ä¸ªç‰¹æ®Šçš„æ•°æ®ç»“æ„ï¼Œæ•°æ®çš„å­˜å–åªèƒ½ä»ä¸€ç«¯è¿›è¡Œï¼Œç§‰æ‰¿åè¿›å…ˆå‡ºçš„åŸåˆ™ï¼Œpush å°±æ˜¯å…¥æ ˆï¼Œpop å°±æ˜¯å‡ºæ ˆã€‚\nå­˜å‚¨èµ·å§‹åœ°å€çš„CSå’ŒDSéƒ½æ˜¯16ä½çš„ï¼›å­˜å‚¨åç§»é‡çš„IPå¯„å­˜å™¨å’Œé€šç”¨å¯„å­˜å™¨éƒ½æ˜¯16ä½çš„ï¼›ä½†8086åœ°å€æ€»çº¿æ˜¯20ä½çš„ã€‚å¦‚ä½•ä»16ä½çš„å¯„å­˜å™¨å¯»å€åˆ°20ä½çš„åœ°å€ï¼Ÿ\næ–¹æ³•æ˜¯ï¼šèµ·å§‹åœ°å€Ã—16+åç§»é‡ï¼Œä¹Ÿå°±æ˜¯æŠŠ CS å’Œ DS ä¸­çš„å€¼å·¦ç§» 4 ä½ï¼Œå˜æˆ 20 ä½çš„ï¼ŒåŠ ä¸Š 16 ä½çš„åç§»é‡ï¼Œè¿™æ ·å°±å¯ä»¥å¾—åˆ°æœ€ç»ˆ 20 ä½ï¼ˆ1Mï¼‰çš„æ•°æ®åœ°å€ã€‚\n32ä½å¤„ç†å™¨ 32ä½å¤„ç†å™¨å¿…é¡»ä¿æŒå’ŒåŸæ¥å¤„ç†å™¨çš„å…¼å®¹ã€‚\né¦–å…ˆï¼Œé€šç”¨å¯„å­˜å™¨æœ‰æ‰©å±•ï¼Œå¯ä»¥å°† 8 ä¸ª 16 ä½çš„æ‰©å±•åˆ° 8 ä¸ª 32 ä½çš„ï¼Œä½†æ˜¯ä¾ç„¶å¯ä»¥ä¿ç•™ 16 ä½çš„å’Œ 8 ä½çš„ä½¿ç”¨æ–¹å¼ã€‚å…¶ä¸­ï¼ŒæŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤çš„æŒ‡ä»¤æŒ‡é’ˆå¯„å­˜å™¨ IPï¼Œå°±ä¼šæ‰©å±•æˆ 32 ä½çš„ï¼ŒåŒæ ·ä¹Ÿå…¼å®¹ 16 ä½çš„ã€‚\nè€Œæ®µå¯„å­˜å™¨ä»ç„¶æ˜¯16ä½ï¼Œä½†å…¶å«ä¹‰ä¸å†æ˜¯æ®µçš„èµ·å§‹åœ°å€ã€‚æ®µçš„èµ·å§‹åœ°å€æ”¾åœ¨å†…å­˜çš„æŸä¸ªåœ°æ–¹ã€‚è¿™ä¸ªåœ°æ–¹æ˜¯ä¸€ä¸ªè¡¨æ ¼ï¼Œè¡¨æ ¼ä¸­çš„ä¸€é¡¹ä¸€é¡¹æ˜¯æ®µæè¿°ç¬¦ï¼ˆSegment Descriptorï¼‰ã€‚è¿™é‡Œé¢æ‰æ˜¯çœŸæ­£çš„æ®µçš„èµ·å§‹åœ°å€ã€‚è€Œæ®µå¯„å­˜å™¨é‡Œé¢ä¿å­˜çš„æ˜¯åœ¨è¿™ä¸ªè¡¨æ ¼ä¸­çš„å“ªä¸€é¡¹ï¼Œç§°ä¸ºé€‰æ‹©å­ï¼ˆSelectorï¼‰ã€‚\nè¿™æ ·ï¼Œå°†ä¸€ä¸ªä»æ®µå¯„å­˜å™¨ç›´æ¥æ‹¿åˆ°çš„æ®µèµ·å§‹åœ°å€ï¼Œå°±å˜æˆäº†å…ˆé—´æ¥åœ°ä»æ®µå¯„å­˜å™¨æ‰¾åˆ°è¡¨æ ¼ä¸­çš„ä¸€é¡¹ï¼Œå†ä»è¡¨æ ¼ä¸­çš„ä¸€é¡¹ä¸­æ‹¿åˆ°æ®µèµ·å§‹åœ°å€ã€‚è¿™æ ·æ®µèµ·å§‹åœ°å€å°±ä¼šå¾ˆçµæ´»äº†ã€‚å½“ç„¶ä¸ºäº†å¿«é€Ÿæ‹¿åˆ°æ®µèµ·å§‹åœ°å€ï¼Œæ®µå¯„å­˜å™¨ä¼šä»å†…å­˜ä¸­æ‹¿åˆ° CPU çš„æè¿°ç¬¦é«˜é€Ÿç¼“å­˜å™¨ä¸­ã€‚\nå®æ¨¡å¼å’Œä¿æŠ¤æ¨¡å¼ æ®µå¯„å­˜å™¨çš„å«ä¹‰æ”¹å˜åï¼Œå°±ä¸åŸæ¥çš„çš„æ¨¡å¼ä¸å…¼å®¹äº†ã€‚å¤„ç†è¿™ä¸ªé—®é¢˜çš„åŠæ³•æ˜¯ä¸ºå¤„ç†å™¨å®šä¹‰ä¸¤ç§æ¨¡å¼ï¼Œå½“ç³»ç»Ÿåˆšåˆšå¯åŠ¨æ—¶ï¼ŒCPUå¤„äºå®æ¨¡å¼ï¼Œè¿™æ—¶å€™å’ŒåŸæ¥çš„æ¨¡å¼æ˜¯å…¼å®¹çš„ã€‚å½“éœ€è¦æ›´å¤šå†…å­˜æ—¶ï¼Œåˆ‡æ¢åˆ°ä¿æŠ¤æ¨¡å¼ï¼Œå°±èƒ½ç”¨32ä½CPUæ›´å¼ºå¤§çš„èƒ½åŠ›ã€‚\nå®æ¨¡å¼ç›´æ¥è·å–åˆ°æ®µçš„èµ·å§‹åœ°å€ï¼Œä¿æŠ¤æ¨¡å¼å…ˆè¯»å–å¯„å­˜å™¨é€‰æ‹©å­ï¼Œå†ä»é€‰æ‹©å­ä¸­è·å–å®é™…çš„æ®µçš„èµ·å§‹åœ°å€\n åˆ‡æ¢åˆ°ä¿æŠ¤æ¨¡å¼éœ€è¦åšä»¥ä¸‹ä¸‰ä»¶äº‹:  å¯ç”¨åˆ†æ®µ, è¾…åŠ©è¿›ç¨‹ç®¡ç† å¯åŠ¨åˆ†é¡µ, è¾…åŠ©å†…å­˜ç®¡ç† æ‰“å¼€å…¶ä»–åœ°å€çº¿    ","permalink":"http://yangchnet.github.io/Dessert/posts/os/%E5%AE%9E%E6%A8%A1%E5%BC%8F%E5%92%8C%E4%BF%9D%E6%8A%A4%E6%A8%A1%E5%BC%8F/","summary":"8086ç»“æ„ x86æ¶æ„ä¸­ç»å…¸çš„å¤„ç†å™¨8086çš„å¤§ä½“ç»“æ„å¦‚ä¸‹ï¼š\nå…¶å¯»å€èŒƒå›´ä¸º1M\nä¸ºäº†æš‚å­˜æ•°æ®ï¼Œ8086 å¤„ç†å™¨å†…éƒ¨æœ‰ 8 ä¸ª 16 ä½çš„é€šç”¨å¯„å­˜å™¨ï¼Œä¹Ÿå°±æ˜¯åˆšæ‰è¯´çš„ CPU å†…éƒ¨çš„æ•°æ®å•å…ƒï¼Œåˆ†åˆ«æ˜¯ AXã€BXã€CXã€DXã€SPã€BPã€SIã€DIã€‚è¿™äº›å¯„å­˜å™¨ä¸»è¦ç”¨äºåœ¨è®¡ç®—è¿‡ç¨‹ä¸­æš‚å­˜æ•°æ®ã€‚è¿™äº›å¯„å­˜å™¨æ¯”è¾ƒçµæ´»ï¼Œå…¶ä¸­ AXã€BXã€CXã€DX å¯ä»¥åˆ†æˆä¸¤ä¸ª 8 ä½çš„å¯„å­˜å™¨æ¥ä½¿ç”¨ï¼Œåˆ†åˆ«æ˜¯ AHã€ALã€BHã€BLã€CHã€CLã€DHã€DLï¼Œå…¶ä¸­ H å°±æ˜¯ Highï¼ˆé«˜ä½ï¼‰ï¼ŒL å°±æ˜¯ Lowï¼ˆä½ä½ï¼‰çš„æ„æ€ã€‚\næ§åˆ¶å•å…ƒï¼š\nIP å¯„å­˜å™¨å°±æ˜¯æŒ‡ä»¤æŒ‡é’ˆå¯„å­˜å™¨ï¼ˆInstruction Pointer Registerï¼‰ï¼ŒæŒ‡å‘ä»£ç æ®µä¸­ä¸‹ä¸€æ¡æŒ‡ä»¤çš„ä½ç½®ã€‚CPU ä¼šæ ¹æ®å®ƒæ¥ä¸æ–­åœ°å°†æŒ‡ä»¤ä»å†…å­˜çš„ä»£ç æ®µä¸­ï¼ŒåŠ è½½åˆ° CPU çš„æŒ‡ä»¤é˜Ÿåˆ—ä¸­ï¼Œç„¶åäº¤ç»™è¿ç®—å•å…ƒå»æ‰§è¡Œã€‚\nå¦‚æœéœ€è¦åˆ‡æ¢è¿›ç¨‹ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½åˆ†ä»£ç æ®µå’Œæ•°æ®æ®µï¼Œä¸ºäº†æŒ‡å‘ä¸åŒè¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼Œæœ‰å››ä¸ª 16 ä½çš„æ®µå¯„å­˜å™¨ï¼Œåˆ†åˆ«æ˜¯ CSã€DSã€SSã€ESã€‚\nå…¶ä¸­ï¼ŒCS å°±æ˜¯ä»£ç æ®µå¯„å­˜å™¨ï¼ˆCode Segment Registerï¼‰ï¼Œé€šè¿‡å®ƒå¯ä»¥æ‰¾åˆ°ä»£ç åœ¨å†…å­˜ä¸­çš„ä½ç½®ï¼›DS æ˜¯æ•°æ®æ®µçš„å¯„å­˜å™¨ï¼Œé€šè¿‡å®ƒå¯ä»¥æ‰¾åˆ°æ•°æ®åœ¨å†…å­˜ä¸­çš„ä½ç½®ã€‚SS æ˜¯æ ˆå¯„å­˜å™¨ï¼ˆStack Registerï¼‰ã€‚æ ˆæ˜¯ç¨‹åºè¿è¡Œä¸­ä¸€ä¸ªç‰¹æ®Šçš„æ•°æ®ç»“æ„ï¼Œæ•°æ®çš„å­˜å–åªèƒ½ä»ä¸€ç«¯è¿›è¡Œï¼Œç§‰æ‰¿åè¿›å…ˆå‡ºçš„åŸåˆ™ï¼Œpush å°±æ˜¯å…¥æ ˆï¼Œpop å°±æ˜¯å‡ºæ ˆã€‚\nå­˜å‚¨èµ·å§‹åœ°å€çš„CSå’ŒDSéƒ½æ˜¯16ä½çš„ï¼›å­˜å‚¨åç§»é‡çš„IPå¯„å­˜å™¨å’Œé€šç”¨å¯„å­˜å™¨éƒ½æ˜¯16ä½çš„ï¼›ä½†8086åœ°å€æ€»çº¿æ˜¯20ä½çš„ã€‚å¦‚ä½•ä»16ä½çš„å¯„å­˜å™¨å¯»å€åˆ°20ä½çš„åœ°å€ï¼Ÿ\næ–¹æ³•æ˜¯ï¼šèµ·å§‹åœ°å€Ã—16+åç§»é‡ï¼Œä¹Ÿå°±æ˜¯æŠŠ CS å’Œ DS ä¸­çš„å€¼å·¦ç§» 4 ä½ï¼Œå˜æˆ 20 ä½çš„ï¼ŒåŠ ä¸Š 16 ä½çš„åç§»é‡ï¼Œè¿™æ ·å°±å¯ä»¥å¾—åˆ°æœ€ç»ˆ 20 ä½ï¼ˆ1Mï¼‰çš„æ•°æ®åœ°å€ã€‚\n32ä½å¤„ç†å™¨ 32ä½å¤„ç†å™¨å¿…é¡»ä¿æŒå’ŒåŸæ¥å¤„ç†å™¨çš„å…¼å®¹ã€‚\né¦–å…ˆï¼Œé€šç”¨å¯„å­˜å™¨æœ‰æ‰©å±•ï¼Œå¯ä»¥å°† 8 ä¸ª 16 ä½çš„æ‰©å±•åˆ° 8 ä¸ª 32 ä½çš„ï¼Œä½†æ˜¯ä¾ç„¶å¯ä»¥ä¿ç•™ 16 ä½çš„å’Œ 8 ä½çš„ä½¿ç”¨æ–¹å¼ã€‚å…¶ä¸­ï¼ŒæŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤çš„æŒ‡ä»¤æŒ‡é’ˆå¯„å­˜å™¨ IPï¼Œå°±ä¼šæ‰©å±•æˆ 32 ä½çš„ï¼ŒåŒæ ·ä¹Ÿå…¼å®¹ 16 ä½çš„ã€‚","title":"å®æ¨¡å¼å’Œä¿æŠ¤æ¨¡å¼"},{"content":"ä¸€ä¸ªUDPå®¢æˆ·å¯ä»¥åˆ›å»ºä¸€ä¸ªå¥—æ¥å£å¹¶å‘é€ä¸€ä¸ªæ•°æ®æŠ¥çµ¦ä¸€ä¸ªæœåŠ¡å™¨ï¼Œç„¶åç«‹å³ç”¨åŒä¸€ä¸ªå¥—æ¥å£å‘é€å¦ä¸€ä¸ªæ•°æ®æŠ¥çµ¦å¦ä¸€ä¸ªæœåŠ¡å™¨ã€‚åŒæ ·ï¼Œä¸€ä¸ªUDPæœåŠ¡å™¨å¯ä»¥ç”¨åŒä¸€ä¸ªUDPå¥—æ¥å£ä»5ä¸ªä¸åŒçš„å®¢æˆ·ä¸€è¿ä¸²æ¥æ”¶5ä¸ªæ•°æ®æŠ¥ã€‚\nUDPå¯ä»¥æ˜¯å…¨åŒå·¥çš„\n TCPè¿æ¥æ–­å¼€æ—¶ï¼Œä¸»åŠ¨è¦æ±‚æ–­å¼€çš„ä¸€æ–¹ä¼šå­˜åœ¨TIME_WAITçŠ¶æ€ï¼Œæ­¤çŠ¶æ€éœ€è¦æŒç»­60sæ—¶é—´ï¼ˆLinuxï¼‰ï¼Œåœ¨æ­¤çŠ¶æ€æœŸé—´ï¼Œè¿æ¥æœªå®Œå…¨æ–­å¼€ï¼Œä¾ç„¶å ç”¨ä¸€ä¸ªsocketè¿æ¥ã€‚\nå­˜åœ¨TIME_WAITçŠ¶æ€çš„ç†ç”±ï¼š\n  å®ç°ç»ˆæ­¢TCPå…¨åŒå·¥è¿æ¥çš„å¯é æ€§ å¦‚æœæœ€åä¸€ä¸ªACKä¸¢å¤±ï¼ŒæœåŠ¡å™¨å°†é‡å‘æœ€ç»ˆçš„FINï¼Œå› æ­¤å®¢æˆ·å¿…é¡»ç»´æŠ¤çŠ¶æ€ä¿¡æ¯ä»¥å…è®¸å®ƒé‡å‘æœ€ç»ˆçš„ACKã€‚\n  å…è®¸è€çš„é‡å¤åˆ†èŠ‚åœ¨ç½‘ç»œä¸­æ¶ˆé€ã€‚ å¦‚æœæŸä¸ªè¿æ¥è¢«å…³é—­åï¼Œåœ¨ä»¥åçš„æŸä¸ªæ—¶åˆ»åˆé‡æ–°å»ºç«‹èµ·ç›¸åŒçš„IPåœ°å€å¯ç«¯å£ä¹‹é—´çš„TCPè¿æ¥ã€‚åä¸€ä¸ªè¿æ¥ç§°ä¸ºå‰ä¸€ä¸ªè¿æ¥çš„åŒ–èº«ï¼ˆincarnationï¼‰ï¼Œå› ä¸ºå®ƒä»¬çš„IPåœ°å€å’Œç«¯å£å·éƒ½ç›¸åŒï¼ŒTCPå¿…é¡»é˜²æ­¢æ¥è‡ªæŸä¸ªè¿æ¥çš„è€é‡å¤åˆ†ç»„åœ¨è¿æ¥ç»ˆæ­¢åå†ç°ï¼Œä»è€Œè¢«è¯¯è§£æˆå±äºåŒä¸€è¿æ¥çš„åŒ–èº«ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼ŒæŸä¸€ä¸ªSocketå¯¹å¤±æ•ˆåï¼Œåœ¨ç½‘ç»œä¸­è¿˜æœ‰é’ˆå¯¹è¿™ä¸ªSocketå¯¹çš„åˆ†ç»„çš„æƒ…å†µä¸‹åˆå»ºç«‹äº†ä¸€ä¸ªä¸€æ ·çš„Socketå¯¹ï¼Œä¸ºäº†é˜²æ­¢ç½‘ç»œä¸­é’ˆå¯¹ä¸Šä¸€ä¸ªsocketå¯¹çš„åˆ†ç»„è¢«è¯¯è®¤ä¸ºæ˜¯å½“å‰è¿æ¥çš„åˆ†ç»„ï¼Œå¿…é¡»å­˜åœ¨ä¸€ä¸ªæ—¶é—´é—´éš”ï¼Œä½¿å¾—ç½‘ç»œä¸­é’ˆå¯¹ä¸Šä¸€ä¸ªsocketå¯¹çš„åˆ†ç»„å¤±æ•ˆã€‚\n   TCPè¿æ¥è€—å°½ï¼š å¯¹äºå®¢æˆ·ç«¯æ¥è¯´ï¼Œå…¶ç«¯å£è€—å°½åï¼Œå°±ä¸èƒ½å†å»ºç«‹è¿æ¥ã€‚ å¯¹äºæœåŠ¡ç«¯æ¥è¯´ï¼Œå…¶ä½¿ç”¨socketå¯¹server_ip.server_port:client_ip.client_portæ¥æ ‡è¯†ä¸€ä¸ªsocketè¿æ¥ï¼Œå¯¹äºæŸä¸ªç‰¹å®šæœåŠ¡æ¥è¯´ï¼Œå…¶server_ipå’Œserver_portæ˜¯ä¸å˜çš„ï¼Œæ¯æ¬¡æœ‰ä¸€ä¸ªè¿æ¥è¿›æ¥ï¼ŒæœåŠ¡ç«¯éƒ½ä¼šforkå‡ºä¸€ä¸ªè‡ªèº«çš„å­è¿›ç¨‹æ¥å¯¹è¿æ¥è¿›è¡ŒæœåŠ¡ã€‚è¿™æ ·ï¼Œå¯æœåŠ¡çš„è¿æ¥æ•°å°±ç”±client_ipå’Œclient_portä¸¤ä¸ªå…±åŒå†³å®šï¼Œclient_ipæœ€å¤šæœ‰$2^32$ä¸ªï¼Œclient_portæœ€å¤šæœ‰$2^16$ä¸ªï¼Œå› æ­¤ç†è®ºä¸Šæœ€å¤šå¯æœåŠ¡è¿æ¥æ•°ä¸º$2^48$ä¸ªã€‚ä½†æ¯ä¸€ä¸ªsocketè¿æ¥éƒ½éœ€è¦æ¶ˆè€—ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œå› æ­¤æœ€å¤§è¿æ¥æ•°è¿˜æ”¶åˆ°æ–‡ä»¶æè¿°ç¬¦æ•°ç›®çš„é™åˆ¶ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œsocketè¿æ¥è¿˜ä¼šå ç”¨å†…å­˜ç­‰èµ„æºï¼Œè¿™äº›èµ„æºä¹Ÿé™åˆ¶äº†æœ€å¤§è¿æ¥æ•°ã€‚\n Unixç³»ç»Ÿæœ‰ä¿ç•™ç«¯å£çš„æ¦‚å¿µï¼Œå®ƒæ˜¯å°äº1024çš„ä»»ä½•ç«¯å£ã€‚è¿™äº›ç«¯å£åªèƒ½åˆ†é…çµ¦è¶…çº§ç”¨æˆ·è¿›ç¨‹çš„å¥—æ¥å£ï¼Œæ‰€æœ‰ä¼—æ‰€å‘¨çŸ¥çš„ç«¯å£ï¼ˆ0-1023ï¼‰éƒ½ä¸ºä¿ç•™ç«¯å£ï¼Œå› æ­¤åˆ†é…è¿™äº›ç«¯å£çš„æœåŠ¡å™¨å¯åŠ¨æ—¶å¿…é¡»å…·æœ‰è¶…çº§ç”¨æˆ·çš„ç‰¹æƒã€‚\n TCPå¥—æ¥å£ç¼–ç¨‹  socketå‡½æ•°   ä¸ºäº†æ‰§è¡Œç½‘ç»œI/Oï¼Œä¸€ä¸ªè¿›ç¨‹å¿…é¡»åšçš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯è°ƒç”¨socketå‡½æ•°ï¼ŒæŒ‡å®šæœŸæœ›çš„é€šä¿¡åè®®ç±»å‹ã€‚\n #include \u0026lt;sys/socket.h\u0026gt; int socket(int family, int type, int protocol); å…¶ä¸­familyæŒ‡æ˜åè®®æ—ï¼Œtypeæ˜¯æŸä¸ªå¸¸å€¼ï¼Œå‚æ•°protocolä¸€èˆ¬è®¾ä¸º0ï¼Œé™¤éç”¨åœ¨åŸå§‹å¥—æ¥å£ä¸Šã€‚\nå¯¹äºfamilyï¼Œå…¶æ˜¯ä»¥ä¸‹å¸¸å€¼ä¹‹ä¸€ï¼š\n   æ— è§£é‡Š     AF_INET IPv4åè®®   AF_INET6 IPv6åè®®   AF_LOCAL UnixåŸŸåè®®   AF_ROUTE è·¯ç”±å¥—æ¥å£   AF_KEY å¯†é’¥å¥—æ¥å£    å¯¹äºtypeï¼Œå…¶æ˜¯ä»¥ä¸‹å¸¸å€¼ä¹‹ä¸€ï¼š\n   ç±»å‹ è§£é‡Š     SOCK_STREAM å­—èŠ‚æµå¥—æ¥å£   SOCK_DGRAM æ•°æ®æŠ¥å¥—æ¥å£   SOCKE_RAW åŸå§‹å¥—æ¥å£    socketå‡½æ•°åœ¨æˆåŠŸæ—¶è¿”å›ä¸€ä¸ªå°çš„éè´Ÿæ•´æ•°å€¼ï¼Œå®ƒä¸æ–‡ä»¶æè¿°å­—ç±»ä¼¼ï¼Œæˆ‘ä»¬å°†å…¶ç§°ä¸ºå¥—æ¥å£æè¿°å­—(socket descriptor)ï¼Œç®€ç§°å¥—æ¥å­—(socketfd)ã€‚æ³¨æ„ï¼Œå¥—æ¥å­—å¹¶æ²¡æœ‰æŒ‡å®šæœ¬åœ°åè®®åœ°å€æˆ–è¿œç¨‹åè®®åœ°å€ã€‚\nbindå‡½æ•°   å‡½æ•°bindçµ¦å¥—æ¥å­—åˆ†é…ä¸€ä¸ªæœ¬åœ°åè®®åœ°å€ï¼Œå¯¹äºç½‘é™…åè®®ï¼Œåè®®åœ°å€æ˜¯32ä½IPv4åœ°å€æˆ–128ä½IPv6ä¸16ä½çš„TCPæˆ–UDPç«¯å£å·çš„ç»„åˆã€‚\n #include\u0026lt;sys/socket.h\u0026gt; int bind(int sockefd, const struct sockeaddr *myaddr, sockelen_t addrlen); ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¥—æ¥å£æè¿°å­—ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæŒ‡å‘ç‰¹å®šäºåè®®çš„åœ°å€ç»“æ„çš„æŒ‡é’ˆï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯è¯¥åœ°å€ç»“æ„çš„é•¿åº¦ã€‚\nå¯¹äºTCPï¼Œè°ƒç”¨å‡½æ•°bindå¯ä»¥æŒ‡å®šä¸€ä¸ªç«¯å£å·ï¼ŒæŒ‡å®šä¸€ä¸ªIPåœ°å€ï¼Œå¯ä»¥ä¸¤è€…éƒ½æŒ‡å®šï¼Œä¹Ÿå¯ä»¥ä¸€ä¸ªä¹Ÿä¸æŒ‡å®šã€‚\nlistenå‡½æ•°  å‡½æ•°listenä»…è¢«TCPæœåŠ¡å™¨è°ƒç”¨ï¼Œå®ƒåšä¸¤ä»¶äº‹æƒ…ï¼š\n å½“å‡½æ•°socketåˆ›å»ºä¸€ä¸ªå¥—æ¥å£æ—¶ï¼Œå®ƒè¢«å‡è®¾ä¸ºä¸€ä¸ªä¸»åŠ¨æ¥å£ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒæ˜¯ä¸€ä¸ªå°†è°ƒç”¨connectå‘èµ·è¿æ¥çš„å®¢æˆ·å¥—æ¥å£ï¼Œå‡½æ•°listenå°†æœªè¿æ¥çš„å¥—æ¥å£è½¬æ¢æˆè¢«åŠ¨å¥—æ¥å£ï¼ŒæŒ‡ç¤ºå†…æ ¸åº”æ¥å—æŒ‡å‘æ­¤å¥—æ¥å£çš„è¿æ¥è¯·æ±‚ã€‚è°ƒç”¨å‡½æ•°listenå¯¼è‡´å¥—æ¥å£ä»CLOSEDçŠ¶æ€è½¬æ¢åˆ°LISTENçŠ¶æ€ å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°è§„å®šäº†å†…æ ¸ä¸ºæ­¤å¥—æ¥å£æ’é˜Ÿçš„æœ€å¤§è¿æ¥ä¸ªæ•°  #include\u0026lt;sys/socket.h\u0026gt; int listen(int sockefd, int backlog); // return: 0,success; -1,failed acceptå‡½æ•°  acceptç”±TCPæœåŠ¡å™¨è°ƒç”¨ï¼Œä»å·²å®Œæˆè¿æ¥é˜Ÿåˆ—å¤´è¿”å›ä¸‹ä¸€ä¸ªå·²å®Œæˆè¿æ¥ã€‚è‹¥å·²å®Œæˆè¿æ¥é˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™è¿›ç¨‹ç¡çœ ã€‚\n#include\u0026lt;sys/socket.h\u0026gt; int accept(int sockefd, struct sockaddr *cliaddr, socklen_t *addrlen); // return: éè´Ÿæè¿°å­—ï¼ŒOKï¼›-1ï¼Œå‡ºé”™ å‚æ•°cliaddrå’Œaddrlenç”¨æ¥è¿”å›è¿æ¥å¯¹æ–¹è¿›ç¨‹ï¼ˆå®¢æˆ·ï¼‰çš„åè®®åœ°å€ã€‚\nå¦‚æœå‡½æ•°acceptæ‰§è¡ŒæˆåŠŸï¼Œåˆ™è¿”å›å€¼æ˜¯ç”±å†…æ ¸è‡ªåŠ¨ç”Ÿæˆçš„ä¸€ä¸ªå…¨æ–°æè¿°å­—ï¼Œä»£è¡¨ä¸å®¢æˆ·çš„TCPè¿æ¥ã€‚\nå½“æˆ‘ä»¬è®¨è®ºå‡½æ•°acceptæ—¶ï¼Œå¸¸æŠŠå®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°ç§°ä¸ºç›‘å¬å¥—æ¥å£(linstening socket)æè¿°å­—(ç”±å‡½æ•°socketç”Ÿæˆçš„æè¿°å­—ï¼Œç”¨ä½œå‡½æ•°bindå’Œå‡½æ•°listençš„ç¬¬ä¸€ä¸ªå‚æ•°)ï¼ŒæŠŠå®ƒçš„è¿”å›å€¼ç§°ä¸ºå·²è¿æ¥å¥—æ¥å£(connected socket)æè¿°å­—ã€‚\nå°†è¿™ä¸¤ä¸ªå¥—æ¥å£åŒºåˆ†å¼€æ˜¯å¾ˆé‡è¦çš„ï¼Œä¸€ä¸ªç»™å®šçš„æœåŠ¡å¸¸å¸¸æ˜¯åªç”Ÿæˆä¸€ä¸ªç›‘å¬å¥—æ¥å£ä¸”ä¸€ç›´å­˜åœ¨ï¼Œç›´åˆ°è¯¥æœåŠ¡å…³é—­ã€‚å†…æ ¸ä¸ºæ¯ä¸ªè¢«æ¥å—çš„å®¢æˆ·è¿æ¥åˆ›å»ºäº†ä¸€ä¸ªå·²è¿æ¥å¥—æ¥å£(ä¹Ÿå°±æ˜¯è¯´å†…æ ¸å·²ä¸ºå®ƒå®ŒæˆTCPçš„ä¸‰è·¯æ¡æ‰‹è¿‡ç¨‹)ã€‚å½“æœåŠ¡å™¨å®ŒæˆæŸå®¢æˆ·çš„æœåŠ¡æ—¶ï¼Œå…³é—­å·²è¿æ¥å¥—æ¥å£ã€‚\nconnectå‡½æ•°  TCPå®¢æˆ·ç”¨connectå‡½æ•°æ¥å»ºç«‹ä¸€ä¸ªä¸TCPæœåŠ¡å™¨çš„è¿æ¥ã€‚\n#include\u0026lt;sys/socket.h\u0026gt; int connect(int sockefd, const struct sockeaddr *servaddr, socklen_t addrlen); // return: 0,success; -1,failed sockefdæ˜¯ç”±socketå‡½æ•°è¿”å›çš„å¥—æ¥å£æè¿°å­—ï¼Œç¬¬äºŒï¼Œç¬¬ä¸‰ä¸ªå‡½æ•°åˆ†åˆ«æ˜¯ä¸€ä¸ªæŒ‡å‘å¥—æ¥å£åœ°å€ç»“æ„çš„æŒ‡é’ˆå’Œè¯¥ç»“æ„çš„å¤§å°ã€‚\nå¦‚æœæ˜¯TCPå¥—æ¥å£çš„è¯ï¼Œå‡½æ•°connectæ¿€å‘TCPçš„ä¸‰è·¯æ¡æ‰‹è¿‡ç¨‹ï¼Œä¸”ä»…åœ¨è¿æ¥å»ºç«‹æˆåŠŸæˆ–å‡ºé”™æ—¶æ‰è¿”å›ã€‚\ncloseå‡½æ•°  closeç”¨æ¥å…³é—­å¥—æ¥å£ï¼Œç»ˆæ­¢TCPè¿æ¥\n#include\u0026lt;unistd.h\u0026gt; int close(int sockefd); // return: 0,ok; -1,failed ","permalink":"http://yangchnet.github.io/Dessert/posts/net/socket%E9%9A%8F%E7%AC%94/","summary":"ä¸€ä¸ªUDPå®¢æˆ·å¯ä»¥åˆ›å»ºä¸€ä¸ªå¥—æ¥å£å¹¶å‘é€ä¸€ä¸ªæ•°æ®æŠ¥çµ¦ä¸€ä¸ªæœåŠ¡å™¨ï¼Œç„¶åç«‹å³ç”¨åŒä¸€ä¸ªå¥—æ¥å£å‘é€å¦ä¸€ä¸ªæ•°æ®æŠ¥çµ¦å¦ä¸€ä¸ªæœåŠ¡å™¨ã€‚åŒæ ·ï¼Œä¸€ä¸ªUDPæœåŠ¡å™¨å¯ä»¥ç”¨åŒä¸€ä¸ªUDPå¥—æ¥å£ä»5ä¸ªä¸åŒçš„å®¢æˆ·ä¸€è¿ä¸²æ¥æ”¶5ä¸ªæ•°æ®æŠ¥ã€‚\nUDPå¯ä»¥æ˜¯å…¨åŒå·¥çš„\n TCPè¿æ¥æ–­å¼€æ—¶ï¼Œä¸»åŠ¨è¦æ±‚æ–­å¼€çš„ä¸€æ–¹ä¼šå­˜åœ¨TIME_WAITçŠ¶æ€ï¼Œæ­¤çŠ¶æ€éœ€è¦æŒç»­60sæ—¶é—´ï¼ˆLinuxï¼‰ï¼Œåœ¨æ­¤çŠ¶æ€æœŸé—´ï¼Œè¿æ¥æœªå®Œå…¨æ–­å¼€ï¼Œä¾ç„¶å ç”¨ä¸€ä¸ªsocketè¿æ¥ã€‚\nå­˜åœ¨TIME_WAITçŠ¶æ€çš„ç†ç”±ï¼š\n  å®ç°ç»ˆæ­¢TCPå…¨åŒå·¥è¿æ¥çš„å¯é æ€§ å¦‚æœæœ€åä¸€ä¸ªACKä¸¢å¤±ï¼ŒæœåŠ¡å™¨å°†é‡å‘æœ€ç»ˆçš„FINï¼Œå› æ­¤å®¢æˆ·å¿…é¡»ç»´æŠ¤çŠ¶æ€ä¿¡æ¯ä»¥å…è®¸å®ƒé‡å‘æœ€ç»ˆçš„ACKã€‚\n  å…è®¸è€çš„é‡å¤åˆ†èŠ‚åœ¨ç½‘ç»œä¸­æ¶ˆé€ã€‚ å¦‚æœæŸä¸ªè¿æ¥è¢«å…³é—­åï¼Œåœ¨ä»¥åçš„æŸä¸ªæ—¶åˆ»åˆé‡æ–°å»ºç«‹èµ·ç›¸åŒçš„IPåœ°å€å¯ç«¯å£ä¹‹é—´çš„TCPè¿æ¥ã€‚åä¸€ä¸ªè¿æ¥ç§°ä¸ºå‰ä¸€ä¸ªè¿æ¥çš„åŒ–èº«ï¼ˆincarnationï¼‰ï¼Œå› ä¸ºå®ƒä»¬çš„IPåœ°å€å’Œç«¯å£å·éƒ½ç›¸åŒï¼ŒTCPå¿…é¡»é˜²æ­¢æ¥è‡ªæŸä¸ªè¿æ¥çš„è€é‡å¤åˆ†ç»„åœ¨è¿æ¥ç»ˆæ­¢åå†ç°ï¼Œä»è€Œè¢«è¯¯è§£æˆå±äºåŒä¸€è¿æ¥çš„åŒ–èº«ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼ŒæŸä¸€ä¸ªSocketå¯¹å¤±æ•ˆåï¼Œåœ¨ç½‘ç»œä¸­è¿˜æœ‰é’ˆå¯¹è¿™ä¸ªSocketå¯¹çš„åˆ†ç»„çš„æƒ…å†µä¸‹åˆå»ºç«‹äº†ä¸€ä¸ªä¸€æ ·çš„Socketå¯¹ï¼Œä¸ºäº†é˜²æ­¢ç½‘ç»œä¸­é’ˆå¯¹ä¸Šä¸€ä¸ªsocketå¯¹çš„åˆ†ç»„è¢«è¯¯è®¤ä¸ºæ˜¯å½“å‰è¿æ¥çš„åˆ†ç»„ï¼Œå¿…é¡»å­˜åœ¨ä¸€ä¸ªæ—¶é—´é—´éš”ï¼Œä½¿å¾—ç½‘ç»œä¸­é’ˆå¯¹ä¸Šä¸€ä¸ªsocketå¯¹çš„åˆ†ç»„å¤±æ•ˆã€‚\n   TCPè¿æ¥è€—å°½ï¼š å¯¹äºå®¢æˆ·ç«¯æ¥è¯´ï¼Œå…¶ç«¯å£è€—å°½åï¼Œå°±ä¸èƒ½å†å»ºç«‹è¿æ¥ã€‚ å¯¹äºæœåŠ¡ç«¯æ¥è¯´ï¼Œå…¶ä½¿ç”¨socketå¯¹server_ip.server_port:client_ip.client_portæ¥æ ‡è¯†ä¸€ä¸ªsocketè¿æ¥ï¼Œå¯¹äºæŸä¸ªç‰¹å®šæœåŠ¡æ¥è¯´ï¼Œå…¶server_ipå’Œserver_portæ˜¯ä¸å˜çš„ï¼Œæ¯æ¬¡æœ‰ä¸€ä¸ªè¿æ¥è¿›æ¥ï¼ŒæœåŠ¡ç«¯éƒ½ä¼šforkå‡ºä¸€ä¸ªè‡ªèº«çš„å­è¿›ç¨‹æ¥å¯¹è¿æ¥è¿›è¡ŒæœåŠ¡ã€‚è¿™æ ·ï¼Œå¯æœåŠ¡çš„è¿æ¥æ•°å°±ç”±client_ipå’Œclient_portä¸¤ä¸ªå…±åŒå†³å®šï¼Œclient_ipæœ€å¤šæœ‰$2^32$ä¸ªï¼Œclient_portæœ€å¤šæœ‰$2^16$ä¸ªï¼Œå› æ­¤ç†è®ºä¸Šæœ€å¤šå¯æœåŠ¡è¿æ¥æ•°ä¸º$2^48$ä¸ªã€‚ä½†æ¯ä¸€ä¸ªsocketè¿æ¥éƒ½éœ€è¦æ¶ˆè€—ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œå› æ­¤æœ€å¤§è¿æ¥æ•°è¿˜æ”¶åˆ°æ–‡ä»¶æè¿°ç¬¦æ•°ç›®çš„é™åˆ¶ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œsocketè¿æ¥è¿˜ä¼šå ç”¨å†…å­˜ç­‰èµ„æºï¼Œè¿™äº›èµ„æºä¹Ÿé™åˆ¶äº†æœ€å¤§è¿æ¥æ•°ã€‚\n Unixç³»ç»Ÿæœ‰ä¿ç•™ç«¯å£çš„æ¦‚å¿µï¼Œå®ƒæ˜¯å°äº1024çš„ä»»ä½•ç«¯å£ã€‚è¿™äº›ç«¯å£åªèƒ½åˆ†é…çµ¦è¶…çº§ç”¨æˆ·è¿›ç¨‹çš„å¥—æ¥å£ï¼Œæ‰€æœ‰ä¼—æ‰€å‘¨çŸ¥çš„ç«¯å£ï¼ˆ0-1023ï¼‰éƒ½ä¸ºä¿ç•™ç«¯å£ï¼Œå› æ­¤åˆ†é…è¿™äº›ç«¯å£çš„æœåŠ¡å™¨å¯åŠ¨æ—¶å¿…é¡»å…·æœ‰è¶…çº§ç”¨æˆ·çš„ç‰¹æƒã€‚\n TCPå¥—æ¥å£ç¼–ç¨‹  socketå‡½æ•°   ä¸ºäº†æ‰§è¡Œç½‘ç»œI/Oï¼Œä¸€ä¸ªè¿›ç¨‹å¿…é¡»åšçš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯è°ƒç”¨socketå‡½æ•°ï¼ŒæŒ‡å®šæœŸæœ›çš„é€šä¿¡åè®®ç±»å‹ã€‚\n #include \u0026lt;sys/socket.h\u0026gt; int socket(int family, int type, int protocol); å…¶ä¸­familyæŒ‡æ˜åè®®æ—ï¼Œtypeæ˜¯æŸä¸ªå¸¸å€¼ï¼Œå‚æ•°protocolä¸€èˆ¬è®¾ä¸º0ï¼Œé™¤éç”¨åœ¨åŸå§‹å¥—æ¥å£ä¸Šã€‚\nå¯¹äºfamilyï¼Œå…¶æ˜¯ä»¥ä¸‹å¸¸å€¼ä¹‹ä¸€ï¼š\n   æ— è§£é‡Š     AF_INET IPv4åè®®   AF_INET6 IPv6åè®®   AF_LOCAL UnixåŸŸåè®®   AF_ROUTE è·¯ç”±å¥—æ¥å£   AF_KEY å¯†é’¥å¥—æ¥å£    å¯¹äºtypeï¼Œå…¶æ˜¯ä»¥ä¸‹å¸¸å€¼ä¹‹ä¸€ï¼š","title":"SOCKETéšç¬”"},{"content":" æå®¢æ—¶é—´ã€ŠRedis æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜ã€‹å­¦ä¹ ç¬”è®°\n  æ¦‚è§ˆRedisç¯‡ä¸€ï¼šå•çº¿ç¨‹æ¨¡å‹ æ¦‚è§ˆRedisç¯‡äºŒï¼šAOFæ—¥å¿— æ¦‚è§ˆRedisç¯‡ä¸‰ï¼šRDBå¿«ç…§ æ¦‚è§ˆRedisç¯‡å››ï¼šä¸»ä» æ¦‚è§ˆRedisç¯‡äº”ï¼šå“¨å…µ æ¦‚è§ˆRedisç¯‡å…­ï¼šåˆ‡ç‰‡é›†ç¾¤  AOF: Append Only File\nAOFæ—¥å¿—çš„WAL æ•°æ®åº“ä¸­çš„WALæ˜¯Write-Ahead Logging, ä¸ºå…ˆå†™æ—¥å¿—åæ‰§è¡Œã€‚è€ŒRedisä¸­çš„WALä¸ºWrite Ahead Log,å…ˆæ‰§è¡Œåå†™æ—¥å¿—ã€‚\nä¸ºäº†é¿å…é¢å¤–çš„å¼€é”€ï¼ŒRedisåœ¨å‘AOFé‡Œé¢è®°å½•æ—¥å¿—æ—¶ï¼Œä¸å›å»å¯¹è¿™äº›å‘½ä»¤è¿›è¡Œè¯­æ³•æ£€æŸ¥ï¼Œå› æ­¤ï¼Œå¦‚æœå…ˆè®°å½•æ—¥å¿—å†æ‰§è¡Œå‘½ä»¤çš„è¯ï¼Œæ—¥å¿—ä¸­æœ‰å¯èƒ½è®°å½•äº†é”™è¯¯çš„å‘½ä»¤ï¼ŒRedisåœ¨ä½¿ç”¨æ—¥å¿—æ¢å¤æ•°æ®æ—¶ï¼Œå°±å¯èƒ½ä¼šå‡ºé”™ã€‚\nAOFæ—¥å¿—ä¸­è®°å½•äº†ä»€ä¹ˆå†…å®¹ æœ‰å¦‚ä¸‹å‘½ä»¤ï¼š\nset testkey testvalue åˆ™AOFæ—¥å¿—å†…å®¹ä¸ºï¼š\n*3 $3 set $7 testkey $9 testvalue å…¶ä¸­â€œ*3â€è¡¨ç¤ºå½“å‰å‘½ä»¤æœ‰3ä¸ªéƒ¨åˆ†ï¼Œæ¯éƒ¨åˆ†éƒ½ç”±â€œ$+æ•°å­—â€å¼€å¤´ï¼Œåé¢ç´§è·Ÿå…·ä½“çš„å‘½ä»¤ã€é”®æˆ–å€¼ã€‚\nAOFçš„æ½œåœ¨é£é™© AOFä½¿ç”¨å…ˆæ‰§è¡Œï¼Œå†å†™æ—¥å¿—çš„æ–¹å¼ï¼Œè¿™æ ·å¯ä»¥é¿å…è®°å½•é”™è¯¯çš„å‘½ä»¤ï¼ŒåŒæ—¶ä¸ä¼šé˜»å¡å½“å‰çš„å†™æ“ä½œã€‚\nä½†è¿™æ ·ä¹Ÿå¸¦æ¥äº†ä¸€äº›æ½œåœ¨é£é™©ï¼š\n åˆšæ‰§è¡Œå®Œä¸€ä¸ªå‘½ä»¤ï¼Œæ²¡æ¥å¾—åŠè®°æ—¥å¿—å°±å®•æœºäº†ï¼Œè¿™ä¸ªå‘½ä»¤å’Œç›¸åº”çš„æ•°æ®å°±æœ‰ä¸¢å¤±çš„é£é™©ã€‚ AOFé¿å…äº†å¯¹å½“å‰å‘½ä»¤çš„é˜»å¡ï¼Œä½†AOFå†™æ—¥å¿—æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œçš„ï¼Œå¯èƒ½ä¼šç»™ä¸‹ä¸€ä¸ªæ“ä½œå¸¦æ¥é˜»å¡é£é™©ã€‚  è¿™å°±éœ€è¦æˆ‘ä»¬å¯¹AOFå†™æ—¥å¿—çš„å®é™…è¿›è¡ŒæŠŠæ§ã€‚\nAOFçš„ä¸‰ç§å†™å›ç­–ç•¥   Alwaysï¼ŒåŒæ­¥å†™å›ï¼šæ¯ä¸ªå†™å‘½ä»¤æ‰§è¡Œå®Œï¼Œç«‹é©¬åŒæ­¥åœ°å°†æ—¥å¿—å†™å›ç£ç›˜ï¼›\n  Everysecï¼Œæ¯ç§’å†™å›ï¼šæ¯ä¸ªå†™å‘½ä»¤æ‰§è¡Œå®Œï¼Œåªæ˜¯å…ˆæŠŠæ—¥å¿—å†™åˆ° AOF æ–‡ä»¶çš„å†…å­˜ç¼“å†²åŒºï¼Œæ¯éš”ä¸€ç§’æŠŠç¼“å†²åŒºä¸­çš„å†…å®¹å†™å…¥ç£ç›˜ï¼›\n  Noï¼Œæ“ä½œç³»ç»Ÿæ§åˆ¶çš„å†™å›ï¼šæ¯ä¸ªå†™å‘½ä»¤æ‰§è¡Œå®Œï¼Œåªæ˜¯å…ˆæŠŠæ—¥å¿—å†™åˆ° AOF æ–‡ä»¶çš„å†…å­˜ç¼“å†²åŒºï¼Œç”±æ“ä½œç³»ç»Ÿå†³å®šä½•æ—¶å°†ç¼“å†²åŒºå†…å®¹å†™å›ç£ç›˜ã€‚\n  é’ˆå¯¹é¿å…ä¸»çº¿ç¨‹é˜»å¡å’Œå‡å°‘æ•°æ®ä¸¢å¤±é—®é¢˜ï¼Œè¿™ä¸‰ç§å†™å›ç­–ç•¥éƒ½æ— æ³•åšåˆ°ä¸¤å…¨å…¶ç¾ã€‚åŸå› å¦‚ä¸‹ï¼š\n â€œåŒæ­¥å†™å›â€å¯ä»¥åšåˆ°åŸºæœ¬ä¸ä¸¢æ•°æ®ï¼Œä½†æ˜¯å®ƒåœ¨æ¯ä¸€ä¸ªå†™å‘½ä»¤åéƒ½æœ‰ä¸€ä¸ªæ…¢é€Ÿçš„è½ç›˜æ“ä½œï¼Œä¸å¯é¿å…åœ°ä¼šå½±å“ä¸»çº¿ç¨‹æ€§èƒ½ï¼› è™½ç„¶â€œæ“ä½œç³»ç»Ÿæ§åˆ¶çš„å†™å›â€åœ¨å†™å®Œç¼“å†²åŒºåï¼Œå°±å¯ä»¥ç»§ç»­æ‰§è¡Œåç»­çš„å‘½ä»¤ï¼Œä½†æ˜¯è½ç›˜çš„æ—¶æœºå·²ç»ä¸åœ¨ Redis æ‰‹ä¸­äº†ï¼Œåªè¦ AOF è®°å½•æ²¡æœ‰å†™å›ç£ç›˜ï¼Œä¸€æ—¦å®•æœºå¯¹åº”çš„æ•°æ®å°±ä¸¢å¤±äº†ï¼› â€œæ¯ç§’å†™å›â€é‡‡ç”¨ä¸€ç§’å†™å›ä¸€æ¬¡çš„é¢‘ç‡ï¼Œé¿å…äº†â€œåŒæ­¥å†™å›â€çš„æ€§èƒ½å¼€é”€ï¼Œè™½ç„¶å‡å°‘äº†å¯¹ç³»ç»Ÿæ€§èƒ½çš„å½±å“ï¼Œä½†æ˜¯å¦‚æœå‘ç”Ÿå®•æœºï¼Œä¸Šä¸€ç§’å†…æœªè½ç›˜çš„å‘½ä»¤æ“ä½œä»ç„¶ä¼šä¸¢å¤±ã€‚æ‰€ä»¥ï¼Œè¿™åªèƒ½ç®—æ˜¯ï¼Œåœ¨é¿å…å½±å“ä¸»çº¿ç¨‹æ€§èƒ½å’Œé¿å…æ•°æ®ä¸¢å¤±ä¸¤è€…é—´å–äº†ä¸ªæŠ˜ä¸­ã€‚  æ€»ç»“ä¸€ä¸‹ï¼š\n æƒ³è¦è·å¾—é«˜æ€§èƒ½ï¼Œå°±é€‰æ‹© No ç­–ç•¥ï¼› å¦‚æœæƒ³è¦å¾—åˆ°é«˜å¯é æ€§ä¿è¯ï¼Œå°±é€‰æ‹© Always ç­–ç•¥ï¼› å¦‚æœå…è®¸æ•°æ®æœ‰ä¸€ç‚¹ä¸¢å¤±ï¼Œåˆå¸Œæœ›æ€§èƒ½åˆ«å—å¤ªå¤§å½±å“çš„è¯ï¼Œé‚£ä¹ˆå°±é€‰æ‹© Everysec ç­–ç•¥ã€‚  AOFé‡å†™ å½“ç³»ç»Ÿè¿è¡Œä¸€æ®µæ—¶é—´åï¼ŒAOFæ—¥å¿—ä¼šè¶Šæ¥è¶Šå¤§ï¼Œè¿™ä¼šå¸¦æ¥ä¸€äº›é—®é¢˜ï¼š\n  æ–‡ä»¶ç³»ç»Ÿæœ¬èº«å¯¹æ–‡ä»¶å¤§å°æœ‰é™åˆ¶ï¼Œæ— æ³•ä¿å­˜è¿‡å¤§çš„æ–‡ä»¶ï¼›\n  å¦‚æœæ–‡ä»¶å¤ªå¤§ï¼Œä¹‹åå†å¾€é‡Œé¢è¿½åŠ å‘½ä»¤è®°å½•çš„è¯ï¼Œæ•ˆç‡ä¹Ÿä¼šå˜ä½ï¼›\n  å¦‚æœå‘ç”Ÿå®•æœºï¼ŒAOF ä¸­è®°å½•çš„å‘½ä»¤è¦ä¸€ä¸ªä¸ªè¢«é‡æ–°æ‰§è¡Œï¼Œç”¨äºæ•…éšœæ¢å¤ï¼Œå¦‚æœæ—¥å¿—æ–‡ä»¶å¤ªå¤§ï¼Œæ•´ä¸ªæ¢å¤è¿‡ç¨‹å°±ä¼šéå¸¸ç¼“æ…¢ï¼Œè¿™å°±ä¼šå½±å“åˆ° Redis çš„æ­£å¸¸ä½¿ç”¨ã€‚\n  å› æ­¤ï¼Œæˆ‘ä»¬å¸Œæœ›AOFå¯ä»¥â€œå‹ç¼©ä¸€ä¸‹â€ï¼Œè¿™å°±éœ€è¦ç”¨åˆ°AOFé‡å†™æœºåˆ¶\nç®€å•æ¥è¯´ï¼ŒAOF é‡å†™æœºåˆ¶å°±æ˜¯åœ¨é‡å†™æ—¶ï¼ŒRedis æ ¹æ®æ•°æ®åº“çš„ç°çŠ¶åˆ›å»ºä¸€ä¸ªæ–°çš„ AOF æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¯»å–æ•°æ®åº“ä¸­çš„æ‰€æœ‰é”®å€¼å¯¹ï¼Œç„¶åå¯¹æ¯ä¸€ä¸ªé”®å€¼å¯¹ç”¨ä¸€æ¡å‘½ä»¤è®°å½•å®ƒçš„å†™å…¥\næ¯”å¦‚æˆ‘ä»¬åœ¨ç³»ç»Ÿè¿è¡Œè¿‡ç¨‹ä¸­å¯¹ä¸€ä¸ªcountå€¼è¿›è¡Œäº†å¤šæ¬¡ç´¯åŠ ï¼Œæœ€ç»ˆå€¼ä¸ºnï¼ŒåŸæ¥çš„AOFæ—¥å¿—äº†è®°å½•äº†å…¶ä»0å˜ä¸ºnçš„æ‰€æœ‰è¯­å¥ï¼Œç»è¿‡AOFé‡å†™åï¼Œé’ˆå¯¹è¯¥countå€¼ï¼Œåªéœ€è¦è®°å½•ä¸€æ¡set count nå°±å¯ä»¥äº†ã€‚\nAOFé‡å†™ä¼šé˜»å¡å— å’Œ AOF æ—¥å¿—ç”±ä¸»çº¿ç¨‹å†™å›ä¸åŒï¼Œé‡å†™è¿‡ç¨‹æ˜¯ç”±åå°å­è¿›ç¨‹ bgrewriteaof æ¥å®Œæˆçš„ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºäº†é¿å…é˜»å¡ä¸»çº¿ç¨‹ï¼Œå¯¼è‡´æ•°æ®åº“æ€§èƒ½ä¸‹é™ã€‚\né‡å†™çš„è¿‡ç¨‹ä¸ºï¼šä¸€ä¸ªæ‹·è´ï¼Œä¸¤å¤„å¤åˆ¶\nâ€œä¸€ä¸ªæ‹·è´â€å°±æ˜¯æŒ‡ï¼Œæ¯æ¬¡æ‰§è¡Œé‡å†™æ—¶ï¼Œä¸»çº¿ç¨‹ fork å‡ºåå°çš„ bgrewriteaof å­è¿›ç¨‹ã€‚æ­¤æ—¶ï¼Œfork ä¼šæŠŠä¸»çº¿ç¨‹çš„å†…å­˜æ‹·è´ä¸€ä»½ç»™ bgrewriteaof å­è¿›ç¨‹ï¼Œè¿™é‡Œé¢å°±åŒ…å«äº†æ•°æ®åº“çš„æœ€æ–°æ•°æ®ã€‚ç„¶åï¼Œbgrewriteaof å­è¿›ç¨‹å°±å¯ä»¥åœ¨ä¸å½±å“ä¸»çº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œé€ä¸€æŠŠæ‹·è´çš„æ•°æ®å†™æˆæ“ä½œï¼Œè®°å…¥é‡å†™æ—¥å¿—ã€‚\nä¸¤å¤„å¤åˆ¶æŒ‡ï¼Œå› ä¸ºä¸»çº¿ç¨‹æœªé˜»å¡ï¼Œä»ç„¶å¯ä»¥å¤„ç†æ–°æ¥çš„æ“ä½œã€‚æ­¤æ—¶ï¼Œå¦‚æœæœ‰å†™æ“ä½œï¼Œç¬¬ä¸€å¤„æ—¥å¿—å°±æ˜¯æŒ‡æ­£åœ¨ä½¿ç”¨çš„ AOF æ—¥å¿—ï¼ŒRedis ä¼šæŠŠè¿™ä¸ªæ“ä½œå†™åˆ°å®ƒçš„ç¼“å†²åŒºã€‚è¿™æ ·ä¸€æ¥ï¼Œå³ä½¿å®•æœºäº†ï¼Œè¿™ä¸ª AOF æ—¥å¿—çš„æ“ä½œä»ç„¶æ˜¯é½å…¨çš„ï¼Œå¯ä»¥ç”¨äºæ¢å¤ã€‚è€Œç¬¬äºŒå¤„æ—¥å¿—ï¼Œå°±æ˜¯æŒ‡æ–°çš„ AOF é‡å†™æ—¥å¿—ã€‚è¿™ä¸ªæ“ä½œä¹Ÿä¼šè¢«å†™åˆ°é‡å†™æ—¥å¿—çš„ç¼“å†²åŒºã€‚è¿™æ ·ï¼Œé‡å†™æ—¥å¿—ä¹Ÿä¸ä¼šä¸¢å¤±æœ€æ–°çš„æ“ä½œã€‚ç­‰åˆ°æ‹·è´æ•°æ®çš„æ‰€æœ‰æ“ä½œè®°å½•é‡å†™å®Œæˆåï¼Œé‡å†™æ—¥å¿—è®°å½•çš„è¿™äº›æœ€æ–°æ“ä½œä¹Ÿä¼šå†™å…¥æ–°çš„ AOF æ–‡ä»¶ï¼Œä»¥ä¿è¯æ•°æ®åº“æœ€æ–°çŠ¶æ€çš„è®°å½•ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨æ–°çš„ AOF æ–‡ä»¶æ›¿ä»£æ—§æ–‡ä»¶äº†ã€‚\næ€»ç»“æ¥è¯´ï¼Œæ¯æ¬¡ AOF é‡å†™æ—¶ï¼ŒRedis ä¼šå…ˆæ‰§è¡Œä¸€ä¸ªå†…å­˜æ‹·è´ï¼Œç”¨äºé‡å†™ï¼›ç„¶åï¼Œä½¿ç”¨ä¸¤ä¸ªæ—¥å¿—ä¿è¯åœ¨é‡å†™è¿‡ç¨‹ä¸­ï¼Œæ–°å†™å…¥çš„æ•°æ®ä¸ä¼šä¸¢å¤±ã€‚è€Œä¸”ï¼Œå› ä¸º Redis é‡‡ç”¨é¢å¤–çš„çº¿ç¨‹è¿›è¡Œæ•°æ®é‡å†™ï¼Œæ‰€ä»¥ï¼Œè¿™ä¸ªè¿‡ç¨‹å¹¶ä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹ã€‚\né—®é¢˜2åˆ™   AOF æ—¥å¿—é‡å†™çš„æ—¶å€™ï¼Œæ˜¯ç”± bgrewriteaof å­è¿›ç¨‹æ¥å®Œæˆçš„ï¼Œä¸ç”¨ä¸»çº¿ç¨‹å‚ä¸ï¼Œæˆ‘ä»¬ä»Šå¤©è¯´çš„éé˜»å¡ä¹Ÿæ˜¯æŒ‡å­è¿›ç¨‹çš„æ‰§è¡Œä¸é˜»å¡ä¸»çº¿ç¨‹ã€‚ä½†æ˜¯ï¼Œä½ è§‰å¾—ï¼Œè¿™ä¸ªé‡å†™è¿‡ç¨‹æœ‰æ²¡æœ‰å…¶ä»–æ½œåœ¨çš„é˜»å¡é£é™©å‘¢ï¼Ÿå¦‚æœæœ‰çš„è¯ï¼Œä¼šåœ¨å“ªé‡Œé˜»å¡ï¼Ÿ\n  AOF é‡å†™ä¹Ÿæœ‰ä¸€ä¸ªé‡å†™æ—¥å¿—ï¼Œä¸ºä»€ä¹ˆå®ƒä¸å…±äº«ä½¿ç”¨ AOF æœ¬èº«çš„æ—¥å¿—å‘¢ï¼Ÿ\n  ç­”ï¼š é—®é¢˜1ï¼ŒRedisé‡‡ç”¨forkå­è¿›ç¨‹é‡å†™AOFæ–‡ä»¶æ—¶ï¼Œæ½œåœ¨çš„é˜»å¡é£é™©åŒ…æ‹¬ï¼šforkå­è¿›ç¨‹ å’Œ AOFé‡å†™è¿‡ç¨‹ä¸­çˆ¶è¿›ç¨‹äº§ç”Ÿå†™å…¥çš„åœºæ™¯ï¼Œä¸‹é¢ä¾æ¬¡ä»‹ç»ã€‚\naã€forkå­è¿›ç¨‹ï¼Œforkè¿™ä¸ªç¬é—´ä¸€å®šæ˜¯ä¼šé˜»å¡ä¸»çº¿ç¨‹çš„ï¼ˆæ³¨æ„ï¼Œforkæ—¶å¹¶ä¸ä¼šä¸€æ¬¡æ€§æ‹·è´æ‰€æœ‰å†…å­˜æ•°æ®ç»™å­è¿›ç¨‹ï¼Œè€å¸ˆæ–‡ç« å†™çš„æ˜¯æ‹·è´æ‰€æœ‰å†…å­˜æ•°æ®ç»™å­è¿›ç¨‹ï¼Œæˆ‘ä¸ªäººè®¤ä¸ºæ˜¯æœ‰æ­§ä¹‰çš„ï¼‰ï¼Œforké‡‡ç”¨æ“ä½œç³»ç»Ÿæä¾›çš„å†™å®å¤åˆ¶(Copy On Write)æœºåˆ¶ï¼Œå°±æ˜¯ä¸ºäº†é¿å…ä¸€æ¬¡æ€§æ‹·è´å¤§é‡å†…å­˜æ•°æ®ç»™å­è¿›ç¨‹é€ æˆçš„é•¿æ—¶é—´é˜»å¡é—®é¢˜ï¼Œä½†forkå­è¿›ç¨‹éœ€è¦æ‹·è´è¿›ç¨‹å¿…è¦çš„æ•°æ®ç»“æ„ï¼Œå…¶ä¸­æœ‰ä¸€é¡¹å°±æ˜¯æ‹·è´å†…å­˜é¡µè¡¨ï¼ˆè™šæ‹Ÿå†…å­˜å’Œç‰©ç†å†…å­˜çš„æ˜ å°„ç´¢å¼•è¡¨ï¼‰ï¼Œè¿™ä¸ªæ‹·è´è¿‡ç¨‹ä¼šæ¶ˆè€—å¤§é‡CPUèµ„æºï¼Œæ‹·è´å®Œæˆä¹‹å‰æ•´ä¸ªè¿›ç¨‹æ˜¯ä¼šé˜»å¡çš„ï¼Œé˜»å¡æ—¶é—´å–å†³äºæ•´ä¸ªå®ä¾‹çš„å†…å­˜å¤§å°ï¼Œå®ä¾‹è¶Šå¤§ï¼Œå†…å­˜é¡µè¡¨è¶Šå¤§ï¼Œforké˜»å¡æ—¶é—´è¶Šä¹…ã€‚æ‹·è´å†…å­˜é¡µè¡¨å®Œæˆåï¼Œå­è¿›ç¨‹ä¸çˆ¶è¿›ç¨‹æŒ‡å‘ç›¸åŒçš„å†…å­˜åœ°å€ç©ºé—´ï¼Œä¹Ÿå°±æ˜¯è¯´æ­¤æ—¶è™½ç„¶äº§ç”Ÿäº†å­è¿›ç¨‹ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰ç”³è¯·ä¸çˆ¶è¿›ç¨‹ç›¸åŒçš„å†…å­˜å¤§å°ã€‚é‚£ä»€ä¹ˆæ—¶å€™çˆ¶å­è¿›ç¨‹æ‰ä¼šçœŸæ­£å†…å­˜åˆ†ç¦»å‘¢ï¼Ÿâ€œå†™å®å¤åˆ¶â€é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯åœ¨å†™å‘ç”Ÿæ—¶ï¼Œæ‰çœŸæ­£æ‹·è´å†…å­˜çœŸæ­£çš„æ•°æ®ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œçˆ¶è¿›ç¨‹ä¹Ÿå¯èƒ½ä¼šäº§ç”Ÿé˜»å¡çš„é£é™©ï¼Œå°±æ˜¯ä¸‹é¢ä»‹ç»çš„åœºæ™¯ã€‚\nbã€forkå‡ºçš„å­è¿›ç¨‹æŒ‡å‘ä¸çˆ¶è¿›ç¨‹ç›¸åŒçš„å†…å­˜åœ°å€ç©ºé—´ï¼Œæ­¤æ—¶å­è¿›ç¨‹å°±å¯ä»¥æ‰§è¡ŒAOFé‡å†™ï¼ŒæŠŠå†…å­˜ä¸­çš„æ‰€æœ‰æ•°æ®å†™å…¥åˆ°AOFæ–‡ä»¶ä¸­ã€‚ä½†æ˜¯æ­¤æ—¶çˆ¶è¿›ç¨‹ä¾æ—§æ˜¯ä¼šæœ‰æµé‡å†™å…¥çš„ï¼Œå¦‚æœçˆ¶è¿›ç¨‹æ“ä½œçš„æ˜¯ä¸€ä¸ªå·²ç»å­˜åœ¨çš„keyï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™çˆ¶è¿›ç¨‹å°±ä¼šçœŸæ­£æ‹·è´è¿™ä¸ªkeyå¯¹åº”çš„å†…å­˜æ•°æ®ï¼Œç”³è¯·æ–°çš„å†…å­˜ç©ºé—´ï¼Œè¿™æ ·é€æ¸åœ°ï¼Œçˆ¶å­è¿›ç¨‹å†…å­˜æ•°æ®å¼€å§‹åˆ†ç¦»ï¼Œçˆ¶å­è¿›ç¨‹é€æ¸æ‹¥æœ‰å„è‡ªç‹¬ç«‹çš„å†…å­˜ç©ºé—´ã€‚å› ä¸ºå†…å­˜åˆ†é…æ˜¯ä»¥é¡µä¸ºå•ä½è¿›è¡Œåˆ†é…çš„ï¼Œé»˜è®¤4kï¼Œå¦‚æœçˆ¶è¿›ç¨‹æ­¤æ—¶æ“ä½œçš„æ˜¯ä¸€ä¸ªbigkeyï¼Œé‡æ–°ç”³è¯·å¤§å—å†…å­˜è€—æ—¶ä¼šå˜é•¿ï¼Œå¯èƒ½ä¼šäº§é˜»å¡é£é™©ã€‚å¦å¤–ï¼Œå¦‚æœæ“ä½œç³»ç»Ÿå¼€å¯äº†å†…å­˜å¤§é¡µæœºåˆ¶(Huge Pageï¼Œé¡µé¢å¤§å°2M)ï¼Œé‚£ä¹ˆçˆ¶è¿›ç¨‹ç”³è¯·å†…å­˜æ—¶é˜»å¡çš„æ¦‚ç‡å°†ä¼šå¤§å¤§æé«˜ï¼Œæ‰€ä»¥åœ¨Redisæœºå™¨ä¸Šéœ€è¦å…³é—­Huge Pageæœºåˆ¶ã€‚Redisæ¯æ¬¡forkç”ŸæˆRDBæˆ–AOFé‡å†™å®Œæˆåï¼Œéƒ½å¯ä»¥åœ¨Redis logä¸­çœ‹åˆ°çˆ¶è¿›ç¨‹é‡æ–°ç”³è¯·äº†å¤šå¤§çš„å†…å­˜ç©ºé—´ã€‚\né—®é¢˜2ï¼ŒAOFé‡å†™ä¸å¤ç”¨AOFæœ¬èº«çš„æ—¥å¿—ï¼Œä¸€ä¸ªåŸå› æ˜¯çˆ¶å­è¿›ç¨‹å†™åŒä¸€ä¸ªæ–‡ä»¶å¿…ç„¶ä¼šäº§ç”Ÿç«äº‰é—®é¢˜ï¼Œæ§åˆ¶ç«äº‰å°±æ„å‘³ç€ä¼šå½±å“çˆ¶è¿›ç¨‹çš„æ€§èƒ½ã€‚äºŒæ˜¯å¦‚æœAOFé‡å†™è¿‡ç¨‹ä¸­å¤±è´¥äº†ï¼Œé‚£ä¹ˆåŸæœ¬çš„AOFæ–‡ä»¶ç›¸å½“äºè¢«æ±¡æŸ“äº†ï¼Œæ— æ³•åšæ¢å¤ä½¿ç”¨ã€‚æ‰€ä»¥Redis AOFé‡å†™ä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œé‡å†™å¤±è´¥çš„è¯ï¼Œç›´æ¥åˆ é™¤è¿™ä¸ªæ–‡ä»¶å°±å¥½äº†ï¼Œä¸ä¼šå¯¹åŸå…ˆçš„AOFæ–‡ä»¶äº§ç”Ÿå½±å“ã€‚ç­‰é‡å†™å®Œæˆä¹‹åï¼Œç›´æ¥æ›¿æ¢æ—§æ–‡ä»¶å³å¯ã€‚\n","permalink":"http://yangchnet.github.io/Dessert/posts/cache/%E6%A6%82%E8%A7%88redis%E7%AF%87%E4%BA%8Caof%E6%97%A5%E5%BF%97/","summary":"æå®¢æ—¶é—´ã€ŠRedis æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜ã€‹å­¦ä¹ ç¬”è®°\n  æ¦‚è§ˆRedisç¯‡ä¸€ï¼šå•çº¿ç¨‹æ¨¡å‹ æ¦‚è§ˆRedisç¯‡äºŒï¼šAOFæ—¥å¿— æ¦‚è§ˆRedisç¯‡ä¸‰ï¼šRDBå¿«ç…§ æ¦‚è§ˆRedisç¯‡å››ï¼šä¸»ä» æ¦‚è§ˆRedisç¯‡äº”ï¼šå“¨å…µ æ¦‚è§ˆRedisç¯‡å…­ï¼šåˆ‡ç‰‡é›†ç¾¤  AOF: Append Only File\nAOFæ—¥å¿—çš„WAL æ•°æ®åº“ä¸­çš„WALæ˜¯Write-Ahead Logging, ä¸ºå…ˆå†™æ—¥å¿—åæ‰§è¡Œã€‚è€ŒRedisä¸­çš„WALä¸ºWrite Ahead Log,å…ˆæ‰§è¡Œåå†™æ—¥å¿—ã€‚\nä¸ºäº†é¿å…é¢å¤–çš„å¼€é”€ï¼ŒRedisåœ¨å‘AOFé‡Œé¢è®°å½•æ—¥å¿—æ—¶ï¼Œä¸å›å»å¯¹è¿™äº›å‘½ä»¤è¿›è¡Œè¯­æ³•æ£€æŸ¥ï¼Œå› æ­¤ï¼Œå¦‚æœå…ˆè®°å½•æ—¥å¿—å†æ‰§è¡Œå‘½ä»¤çš„è¯ï¼Œæ—¥å¿—ä¸­æœ‰å¯èƒ½è®°å½•äº†é”™è¯¯çš„å‘½ä»¤ï¼ŒRedisåœ¨ä½¿ç”¨æ—¥å¿—æ¢å¤æ•°æ®æ—¶ï¼Œå°±å¯èƒ½ä¼šå‡ºé”™ã€‚\nAOFæ—¥å¿—ä¸­è®°å½•äº†ä»€ä¹ˆå†…å®¹ æœ‰å¦‚ä¸‹å‘½ä»¤ï¼š\nset testkey testvalue åˆ™AOFæ—¥å¿—å†…å®¹ä¸ºï¼š\n*3 $3 set $7 testkey $9 testvalue å…¶ä¸­â€œ*3â€è¡¨ç¤ºå½“å‰å‘½ä»¤æœ‰3ä¸ªéƒ¨åˆ†ï¼Œæ¯éƒ¨åˆ†éƒ½ç”±â€œ$+æ•°å­—â€å¼€å¤´ï¼Œåé¢ç´§è·Ÿå…·ä½“çš„å‘½ä»¤ã€é”®æˆ–å€¼ã€‚\nAOFçš„æ½œåœ¨é£é™© AOFä½¿ç”¨å…ˆæ‰§è¡Œï¼Œå†å†™æ—¥å¿—çš„æ–¹å¼ï¼Œè¿™æ ·å¯ä»¥é¿å…è®°å½•é”™è¯¯çš„å‘½ä»¤ï¼ŒåŒæ—¶ä¸ä¼šé˜»å¡å½“å‰çš„å†™æ“ä½œã€‚\nä½†è¿™æ ·ä¹Ÿå¸¦æ¥äº†ä¸€äº›æ½œåœ¨é£é™©ï¼š\n åˆšæ‰§è¡Œå®Œä¸€ä¸ªå‘½ä»¤ï¼Œæ²¡æ¥å¾—åŠè®°æ—¥å¿—å°±å®•æœºäº†ï¼Œè¿™ä¸ªå‘½ä»¤å’Œç›¸åº”çš„æ•°æ®å°±æœ‰ä¸¢å¤±çš„é£é™©ã€‚ AOFé¿å…äº†å¯¹å½“å‰å‘½ä»¤çš„é˜»å¡ï¼Œä½†AOFå†™æ—¥å¿—æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œçš„ï¼Œå¯èƒ½ä¼šç»™ä¸‹ä¸€ä¸ªæ“ä½œå¸¦æ¥é˜»å¡é£é™©ã€‚  è¿™å°±éœ€è¦æˆ‘ä»¬å¯¹AOFå†™æ—¥å¿—çš„å®é™…è¿›è¡ŒæŠŠæ§ã€‚\nAOFçš„ä¸‰ç§å†™å›ç­–ç•¥   Alwaysï¼ŒåŒæ­¥å†™å›ï¼šæ¯ä¸ªå†™å‘½ä»¤æ‰§è¡Œå®Œï¼Œç«‹é©¬åŒæ­¥åœ°å°†æ—¥å¿—å†™å›ç£ç›˜ï¼›\n  Everysecï¼Œæ¯ç§’å†™å›ï¼šæ¯ä¸ªå†™å‘½ä»¤æ‰§è¡Œå®Œï¼Œåªæ˜¯å…ˆæŠŠæ—¥å¿—å†™åˆ° AOF æ–‡ä»¶çš„å†…å­˜ç¼“å†²åŒºï¼Œæ¯éš”ä¸€ç§’æŠŠç¼“å†²åŒºä¸­çš„å†…å®¹å†™å…¥ç£ç›˜ï¼›\n  Noï¼Œæ“ä½œç³»ç»Ÿæ§åˆ¶çš„å†™å›ï¼šæ¯ä¸ªå†™å‘½ä»¤æ‰§è¡Œå®Œï¼Œåªæ˜¯å…ˆæŠŠæ—¥å¿—å†™åˆ° AOF æ–‡ä»¶çš„å†…å­˜ç¼“å†²åŒºï¼Œç”±æ“ä½œç³»ç»Ÿå†³å®šä½•æ—¶å°†ç¼“å†²åŒºå†…å®¹å†™å›ç£ç›˜ã€‚\n  é’ˆå¯¹é¿å…ä¸»çº¿ç¨‹é˜»å¡å’Œå‡å°‘æ•°æ®ä¸¢å¤±é—®é¢˜ï¼Œè¿™ä¸‰ç§å†™å›ç­–ç•¥éƒ½æ— æ³•åšåˆ°ä¸¤å…¨å…¶ç¾ã€‚åŸå› å¦‚ä¸‹ï¼š\n â€œåŒæ­¥å†™å›â€å¯ä»¥åšåˆ°åŸºæœ¬ä¸ä¸¢æ•°æ®ï¼Œä½†æ˜¯å®ƒåœ¨æ¯ä¸€ä¸ªå†™å‘½ä»¤åéƒ½æœ‰ä¸€ä¸ªæ…¢é€Ÿçš„è½ç›˜æ“ä½œï¼Œä¸å¯é¿å…åœ°ä¼šå½±å“ä¸»çº¿ç¨‹æ€§èƒ½ï¼› è™½ç„¶â€œæ“ä½œç³»ç»Ÿæ§åˆ¶çš„å†™å›â€åœ¨å†™å®Œç¼“å†²åŒºåï¼Œå°±å¯ä»¥ç»§ç»­æ‰§è¡Œåç»­çš„å‘½ä»¤ï¼Œä½†æ˜¯è½ç›˜çš„æ—¶æœºå·²ç»ä¸åœ¨ Redis æ‰‹ä¸­äº†ï¼Œåªè¦ AOF è®°å½•æ²¡æœ‰å†™å›ç£ç›˜ï¼Œä¸€æ—¦å®•æœºå¯¹åº”çš„æ•°æ®å°±ä¸¢å¤±äº†ï¼› â€œæ¯ç§’å†™å›â€é‡‡ç”¨ä¸€ç§’å†™å›ä¸€æ¬¡çš„é¢‘ç‡ï¼Œé¿å…äº†â€œåŒæ­¥å†™å›â€çš„æ€§èƒ½å¼€é”€ï¼Œè™½ç„¶å‡å°‘äº†å¯¹ç³»ç»Ÿæ€§èƒ½çš„å½±å“ï¼Œä½†æ˜¯å¦‚æœå‘ç”Ÿå®•æœºï¼Œä¸Šä¸€ç§’å†…æœªè½ç›˜çš„å‘½ä»¤æ“ä½œä»ç„¶ä¼šä¸¢å¤±ã€‚æ‰€ä»¥ï¼Œè¿™åªèƒ½ç®—æ˜¯ï¼Œåœ¨é¿å…å½±å“ä¸»çº¿ç¨‹æ€§èƒ½å’Œé¿å…æ•°æ®ä¸¢å¤±ä¸¤è€…é—´å–äº†ä¸ªæŠ˜ä¸­ã€‚  æ€»ç»“ä¸€ä¸‹ï¼š","title":"æ¦‚è§ˆRedisç¯‡äºŒï¼šAOFæ—¥å¿—"},{"content":"1. åˆ†å±‚çš„é•œåƒ åœ¨æˆ‘ä»¬å¯åŠ¨ä¸€ä¸ªå®¹å™¨ä¹‹å‰ï¼Œé€šå¸¸éœ€è¦ä¸‹è½½è¿™ä¸ªå®¹å™¨å¯¹åº”çš„é•œåƒï¼Œä»¥è¿™ä¸ªé•œåƒä¸ºåŸºç¡€å¯åŠ¨å®¹å™¨ã€‚é•œåƒä¸­åŒ…å«äº†å¯¹åº”çš„ç¨‹åºçš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸å…¶æ‰€ä¾èµ–çš„æ–‡ä»¶ï¼Œç¨‹åºåœ¨å¯åŠ¨åçœ‹åˆ°çš„rootfsåªæ˜¯è¿™ä¸ªé•œåƒä¸­å­˜åœ¨çš„æ–‡ä»¶ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¸ºå®¹å™¨ä¸­çš„è¿›ç¨‹æä¾›ä¸€ä¸ªå¹²å‡€çš„æ–‡ä»¶ç³»ç»Ÿã€‚\nåˆ›å»ºä¸€ä¸ªé•œåƒï¼ˆimageï¼‰çš„æœ€ç®€å•æ–¹æ³•æ˜¯ä½¿ç”¨Dockerfileã€‚\nFROMscratchCOPY hello /CMD [\u0026#34;/hello\u0026#34;]scratchæ˜¯dockerä¸ºæˆ‘ä»¬æä¾›çš„ä¸€ä¸ªç©ºé•œåƒï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ­¤åŸºç¡€ä¸Šæ„å»ºä»»ä½•æˆ‘ä»¬æƒ³è¦çš„é•œåƒã€‚\nåœ¨ä¹¦å†™Dockerfileæ—¶ï¼Œæƒ³å¿…ä½ å¬è¯´è¿‡è¿™ä¹ˆä¸€å¥è¯ï¼Œä¸è¦åœ¨Dockerfileä¸­åˆ›å»ºå¤ªå¤šå±‚.\nåœ¨Dockerfileä¸­ï¼Œæ¯ä¸€ä¸ªæŒ‡ä»¤éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„â€œå±‚â€ï¼Œè¿™é‡Œçš„å±‚ï¼ŒæŒ‡çš„æ˜¯UnionFSä¸­çš„ä¸€ä¸ªæ–‡ä»¶ç›®å½•ã€‚å½“æˆ‘ä»¬åˆ›å»ºäº†è¿‡å¤šçš„å±‚ï¼Œä¼šå¯¼è‡´é•œåƒä½“ç§¯å˜å¤§ï¼Œé™¤æ­¤ä¹‹å¤–ï¼ŒUnion FS ä¹Ÿä¼šæœ‰æœ€å¤§å±‚æ•°é™åˆ¶ã€‚\nå› æ­¤å¯¹äºå¦‚ä¸‹çš„Dockerfileæ–‡ä»¶å†™æ³•ï¼Œåº”å°½é‡é¿å…ï¼š\nFROMdebian:stretchRUN apt-get updateRUN apt-get install -y gcc libc6-dev make wgetRUN wget -O redis.tar.gz \u0026#34;http://download.redis.io/releases/redis-5.0.3.tar.gz\u0026#34;RUN mkdir -p /usr/src/redisRUN tar -xzf redis.tar.gz -C /usr/src/redis --strip-components=1RUN make -C /usr/src/redisRUN make -C /usr/src/redis installå¯ä¼˜åŒ–ä¸ºå¦‚ä¸‹å†™æ³•\nFROMdebian:stretchRUN set -x; buildDeps=\u0026#39;gcc libc6-dev make wget\u0026#39; \\  \u0026amp;\u0026amp; apt-get update \\  \u0026amp;\u0026amp; apt-get install -y $buildDeps \\  \u0026amp;\u0026amp; wget -O redis.tar.gz \u0026#34;http://download.redis.io/releases/redis-5.0.3.tar.gz\u0026#34; \\  \u0026amp;\u0026amp; mkdir -p /usr/src/redis \\  \u0026amp;\u0026amp; tar -xzf redis.tar.gz -C /usr/src/redis --strip-components=1 \\  \u0026amp;\u0026amp; make -C /usr/src/redis \\  \u0026amp;\u0026amp; make -C /usr/src/redis install \\  \u0026amp;\u0026amp; rm -rf /var/lib/apt/lists/* \\  \u0026amp;\u0026amp; rm redis.tar.gz \\  \u0026amp;\u0026amp; rm -r /usr/src/redis \\  \u0026amp;\u0026amp; apt-get purge -y --auto-remove $buildDepsè¿™é‡Œçš„åŸç†æœ‰ç‚¹ç±»ä¼¼äºRedisçš„AOFæ—¥å¿—é‡å†™ã€‚\nä¸ºä»€ä¹ˆè¦å°†é•œåƒåˆ†ä¸ºå¾ˆå¤šå±‚ï¼Œè€Œä¸æ˜¯åƒç³»ç»Ÿé•œåƒé‚£æ ·æ‰“åŒ…ä¸ºä¸€ä¸ªISOæ–‡ä»¶ã€‚\nä¸åŒçš„é•œåƒï¼Œå…¶æ‰€éœ€çš„æ–‡ä»¶å­˜åœ¨é‡å¤ï¼Œå¦‚æœå¯¹æ¯ä¸ªé•œåƒéƒ½å•ç‹¬å¤åˆ¶ä¸€ä»½ï¼Œä¼šå¯¼è‡´é•œåƒè¿‡äºè‡ƒè‚¿ï¼Œæµªè´¹ç£ç›˜ç©ºé—´ï¼Œä¹Ÿä¼šå ç”¨å¤§é‡ç½‘ç»œèµ„æºä¸‹è½½é•œåƒæ–‡ä»¶ã€‚\nä¾‹å¦‚æˆ‘ä»¬æœ‰100ä¸ªæœåŠ¡éƒ½éœ€è¦ä¾èµ–äºubuntu18.04ç¯å¢ƒï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦ä¸ºè¿™äº›æœåŠ¡åˆ¶ä½œé•œåƒï¼Œæ˜¾ç„¶ä¸å¯èƒ½çœŸçš„å°†ubuntu18.04çš„æ‰€æœ‰æ–‡ä»¶å¤åˆ¶100ä»½ï¼Œæœ€å¥½çš„åŠæ³•æ˜¯æœºå™¨ä¸Šåªå­˜åœ¨ä¸€ä»½è¿™æ ·çš„æ–‡ä»¶ï¼Œæ¯ä¸ªå®¹å™¨éƒ½æ¥å¤ç”¨å®ƒï¼Œè¿™å°±éœ€è¦ä½¿ç”¨UnionFSã€‚\n2. imageåˆ†å±‚çš„åŸºç¡€ï¼šUnionFS UnionFSç§°ï¼šè”åˆæŒ‚è½½ã€‚å…¶æœ€ä¸»è¦çš„åŠŸèƒ½æ˜¯å°†å¤šä¸ªç›®å½•æŒ‚è½½åœ¨åŒä¸€ä¸ªç›®å½•ä¸‹ã€‚\nå‰é¢è¯´åˆ°ï¼Œå¯¹äº100ä¸ªéƒ½éœ€è¦Ubuntu18.04ç¯å¢ƒçš„æœåŠ¡ï¼Œæœ€å¥½çš„åŠæ³•æ˜¯åœ¨æœºå™¨ä¸Šæä¾›ä¸€ä»½ubuntu18.04ç¯å¢ƒæ–‡ä»¶ï¼Œæ‰€æœ‰çš„æœåŠ¡éƒ½æ¥ä¾èµ–è¿™ä¸€ä»½æ–‡ä»¶ã€‚\nä½†è¿™å°±äº§ç”Ÿäº†å¦ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœæŸä¸€ä¸ªæœåŠ¡éœ€è¦å¯¹ubuntu18.04ä¸­çš„æŸä¸ªæ–‡ä»¶è¿›è¡Œä¿®æ”¹ï¼Œæˆ–æ˜¯åœ¨è¿™ä¹‹ä¸Šäº§ç”Ÿæ–°çš„æ–‡ä»¶ï¼Œé‚£ä¹ˆå…¶ä»–åŒæ ·ä¾èµ–äºè¿™ä¸ªç¯å¢ƒçš„æœåŠ¡å¯èƒ½ä¼šè¢«å½±å“ã€‚\nè¿™å°±éœ€è¦ç”¨åˆ°UnionFSçš„ç‰¹æ€§ã€‚\nç›®å‰dockerä½¿ç”¨çš„UnionFSå®ç°æ˜¯OverlayFS.ä¸‹é¢é€šè¿‡ä¸€ä¸ªå°å®éªŒæ¥æŒæ¡overlayçš„åŸºæœ¬ç‰¹æ€§ï¼š\næ‰§è¡Œä»¥ä¸‹è„šæœ¬\n#!/bin/bash  umount ./merged rm upper lower merged work -r mkdir upper lower merged work echo \u0026#34;I\u0026#39;m from lower!\u0026#34; \u0026gt; lower/in_lower.txt echo \u0026#34;I\u0026#39;m from upper!\u0026#34; \u0026gt; upper/in_upper.txt # `in_both` is in both directories echo \u0026#34;I\u0026#39;m from lower!\u0026#34; \u0026gt; lower/in_both.txt echo \u0026#34;I\u0026#39;m from upper!\u0026#34; \u0026gt; upper/in_both.txt sudo mount -t overlay overlay \\  -o lowerdir=./lower,upperdir=./upper,workdir=./work \\  ./merged OverlayFS çš„ä¸€ä¸ª mount å‘½ä»¤ç‰µæ¶‰åˆ°å››ç±»ç›®å½•ï¼Œåˆ†åˆ«æ˜¯ lowerï¼Œupperï¼Œmerged å’Œ workï¼Œ\n  \u0026ldquo;lower/\u0026quot;ï¼Œä¹Ÿå°±æ˜¯è¢« mount ä¸¤å±‚ç›®å½•ä¸­åº•ä¸‹çš„è¿™å±‚ï¼ˆlowerdirï¼‰ã€‚åœ¨ OverlayFS ä¸­ï¼Œæœ€åº•ä¸‹è¿™ä¸€å±‚é‡Œçš„æ–‡ä»¶æ˜¯ä¸ä¼šè¢«ä¿®æ”¹çš„ï¼Œä½ å¯ä»¥è®¤ä¸ºå®ƒæ˜¯åªè¯»çš„ã€‚OverlayFS æ”¯æŒå¤šä¸ª lowerdirã€‚\n  \u0026ldquo;upper/\u0026quot;ï¼Œå®ƒæ˜¯è¢« mount ä¸¤å±‚ç›®å½•ä¸­ä¸Šé¢çš„è¿™å±‚ ï¼ˆupperdirï¼‰ã€‚åœ¨ OverlayFS ä¸­ï¼Œå¦‚æœæœ‰æ–‡ä»¶çš„åˆ›å»ºï¼Œä¿®æ”¹ï¼Œåˆ é™¤æ“ä½œï¼Œé‚£ä¹ˆéƒ½ä¼šåœ¨è¿™ä¸€å±‚åæ˜ å‡ºæ¥ï¼Œå®ƒæ˜¯å¯è¯»å†™çš„ã€‚\n  \u0026ldquo;merged\u0026rdquo; ï¼Œæ˜¯æŒ‚è½½ç‚¹ï¼ˆmount pointï¼‰ç›®å½•ï¼Œä¹Ÿæ˜¯ç”¨æˆ·çœ‹åˆ°çš„ç›®å½•ï¼Œç”¨æˆ·çš„å®é™…æ–‡ä»¶æ“ä½œåœ¨è¿™é‡Œè¿›è¡Œã€‚\n  \u0026ldquo;work/\u0026quot;ï¼Œæ˜¯ä¸€ä¸ªå­˜æ”¾ä¸´æ—¶æ–‡ä»¶çš„ç›®å½•ï¼ŒOverlayFS ä¸­å¦‚æœæœ‰æ–‡ä»¶ä¿®æ”¹ï¼Œå°±ä¼šåœ¨ä¸­é—´è¿‡ç¨‹ä¸­ä¸´æ—¶å­˜æ”¾æ–‡ä»¶åˆ°è¿™é‡Œã€‚å¹¶æœªè¡¨ç°åœ¨å›¾ä¸­ã€‚\n  å¦‚æœlowerå’Œupperä¸­å­˜åœ¨åŒåæ–‡ä»¶ï¼Œé‚£ä¹ˆä¸ä¼šæ˜¾ç¤ºlowerä¸­çš„æ–‡ä»¶ã€‚\nå¯¹äºä»¥ä¸‹ä¸‰ç§æ–‡ä»¶æ“ä½œï¼š\n  æ–°å»ºæ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶å°†ä¼šå‡ºç°åœ¨upperç›®å½•ä¸­ã€‚\n  åˆ é™¤æ–‡ä»¶ã€‚å¦‚æœæˆ‘ä»¬åˆ é™¤\u0026quot;in_upper.txt\u0026rdquo;ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–‡ä»¶ä¼šåœ¨ upper/ ç›®å½•ä¸­æ¶ˆå¤±ã€‚å¦‚æœåˆ é™¤\u0026quot;in_lower.txt\u0026rdquo;, åœ¨ lower/ ç›®å½•é‡Œçš„\u0026quot;in_lower.txt\u0026quot;æ–‡ä»¶ä¸ä¼šæœ‰å˜åŒ–ï¼Œåªæ˜¯åœ¨ upper/ ç›®å½•ä¸­å¢åŠ äº†ä¸€ä¸ªç‰¹æ®Šæ–‡ä»¶æ¥å‘Šè¯‰ OverlayFSï¼Œ\u0026ldquo;in_lower.txt\u0026rsquo;è¿™ä¸ªæ–‡ä»¶ä¸èƒ½å‡ºç°åœ¨ merged/ é‡Œäº†ï¼Œè¿™å°±è¡¨ç¤ºå®ƒå·²ç»è¢«åˆ é™¤äº†ã€‚\n  ä¿®æ”¹æ–‡ä»¶ã€‚å¦‚æœä¿®æ”¹\u0026quot;in_lower.txt\u0026rdquo;ï¼Œé‚£ä¹ˆå°±ä¼šåœ¨ upper/ ç›®å½•ä¸­æ–°å»ºä¸€ä¸ª\u0026quot;in_lower.txt\u0026quot;æ–‡ä»¶ï¼ŒåŒ…å«æ›´æ–°çš„å†…å®¹ï¼Œè€Œåœ¨ lower/ ä¸­çš„åŸæ¥çš„å®é™…æ–‡ä»¶\u0026quot;in_lower.txt\u0026quot;ä¸ä¼šæ”¹å˜ã€‚\n  æ‰€æœ‰çš„æ›´æ”¹éƒ½ä¸ä¼šåæ˜ åˆ°lowerdirä¸Šï¼Œå› æ­¤å®¹å™¨çš„é•œåƒæ–‡ä»¶ä¸­å„å±‚æ­£å¥½ä½œä¸º OverlayFS çš„ lowerdir çš„ç›®å½•ï¼Œç„¶ååŠ ä¸Šä¸€ä¸ªç©ºçš„ upperdir ä¸€èµ·æŒ‚è½½å¥½åï¼Œå°±ç»„æˆäº†å®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿã€‚\nåŒæ—¶ï¼Œoverlayfsè¿˜æ”¯æŒæŒ‚è½½å¤šä¸ªlowerç›®å½•ï¼Œè¿™æ ·å°±å®ç°äº†é•œåƒçš„å¤šä¸ªå±‚ã€‚\nä»¥ä¸‹æ˜¯ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„å®¹å™¨ä»–çš„UnionFSæŒ‚è½½æƒ…å†µï¼š\n\u0026#34;GraphDriver\u0026#34;: { \u0026#34;Data\u0026#34;: { \u0026#34;LowerDir\u0026#34;: \u0026#34;/var/lib/docker/overlay2/94809845e9decf34968235fe45bc9d66780a6c2f1929e6aeace43c62ae8a8473-init/diff:/var/lib/docker/overlay2/c95ef099ca18c9b33ff36907bb94c28f3c81a9758058b1698ae438fc88552ac7/diff:/var/lib/docker/overlay2/84cc0780b885789c335f30a784fde4355bfc11b4b9c538da0d6be665d0e87f74/diff:/var/lib/docker/overlay2/94ab5f531aa05c31918599de4a947b6af18488a5bd9f62186060aa32a0938677/diff:/var/lib/docker/overlay2/4154cfa0480d3be6d22ecd4b52225798d8c7d2f349602d36a821fd310318f19e/diff\u0026#34;, \u0026#34;MergedDir\u0026#34;: \u0026#34;/var/lib/docker/overlay2/94809845e9decf34968235fe45bc9d66780a6c2f1929e6aeace43c62ae8a8473/merged\u0026#34;, \u0026#34;UpperDir\u0026#34;: \u0026#34;/var/lib/docker/overlay2/94809845e9decf34968235fe45bc9d66780a6c2f1929e6aeace43c62ae8a8473/diff\u0026#34;, \u0026#34;WorkDir\u0026#34;: \u0026#34;/var/lib/docker/overlay2/94809845e9decf34968235fe45bc9d66780a6c2f1929e6aeace43c62ae8a8473/work\u0026#34; }, \u0026#34;Name\u0026#34;: \u0026#34;overlay2\u0026#34; }, 3. é•œåƒçš„ç»„æˆ dockerå¯¹é•œåƒçš„ç®¡ç†æ˜¯æ ¹æ®OCIæ ‡å‡†æ¥çš„ï¼Œæ ¹æ®OCIæ ‡å‡†ï¼Œä¸€ä¸ªimageå¯ä»¥åˆ†ä¸ºä»¥ä¸‹å››ä¸ªéƒ¨åˆ†ï¼š\n Image Index: image indexæ˜¯ä¸ªjsonæ–‡ä»¶ï¼Œç”¨äºä½¿imageèƒ½æ”¯æŒå¤šä¸ªå¹³å°å’Œå¤štagã€‚ Image Manifest: manifestæ˜¯ä¸€ä¸ªjsonæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶åŒ…å«äº†å¯¹filesystem layerså’Œimage configçš„æè¿°ã€‚ Image Config: image configå°±æ˜¯ä¸€ä¸ªjsonæ–‡ä»¶ï¼Œè¿™ä¸ªjsonæ–‡ä»¶åŒ…å«äº†å¯¹è¿™ä¸ªimageçš„æè¿°ã€‚ FileSystem Layer: Filesystem LayeråŒ…å«äº†æ–‡ä»¶ç³»ç»Ÿçš„ä¿¡æ¯ï¼Œå³è¯¥imageåŒ…å«äº†å“ªäº›æ–‡ä»¶/ç›®å½•ï¼Œä»¥åŠå®ƒä»¬çš„å±æ€§å’Œæ•°æ®ã€‚  å®ƒä»¬ä¹‹é—´çš„å…³ç³»å¦‚ä¸‹ï¼š\n3.1 Media Type Media Type, åª’ä½“ç±»å‹ã€‚\nåœ¨OCIæ ‡å‡†ä¸­ï¼Œä¸åŒçš„æ–‡ä»¶å¯¹åº”ä¸åŒçš„media typeã€‚å…¶å¯¹åº”å…³ç³»å¦‚ä¸‹ï¼š\n   Media Type è¯´æ˜     application/vnd.oci.descriptor.v1+json Content Descriptor å†…å®¹æè¿°æ–‡ä»¶   application/vnd.oci.layout.header.v1+json OCI Layout å¸ƒå±€æè¿°æ–‡ä»¶   application/vnd.oci.image.index.v1+json Image Index é«˜å±‚æ¬¡çš„é•œåƒå…ƒä¿¡æ¯æ–‡ä»¶   application/vnd.oci.image.manifest.v1+json Image Manifest é•œåƒå…ƒä¿¡æ¯æ–‡ä»¶   application/vnd.oci.image.config.v1+json Image Config é•œåƒé…ç½®æ–‡ä»¶   application/vnd.oci.image.layer.v1.tar Image Layer é•œåƒå±‚æ–‡ä»¶   application/vnd.oci.image.layer.v1.tar+gzip Image Layer é•œåƒå±‚æ–‡ä»¶gzipå‹ç¼©   application/vnd.oci.image.layer.nondistributable.v1.tar Image Layer éå†…å®¹å¯»å€ç®¡ç†   application/vnd.oci.image.layer.nondistributable.v1.tar+gzip Image Layer, gzipå‹ç¼© éå†…å®¹å¯»å€ç®¡ç†    3.2 FileSystem Layer æ¯ä¸ªfilesystem layeréƒ½åŒ…å«äº†åœ¨ä¸Šä¸€ä¸ªlayerä¸Šçš„æ”¹åŠ¨æƒ…å†µï¼Œä¸»è¦åŒ…å«ä¸‰æ–¹é¢çš„å†…å®¹ï¼š\n  å˜åŒ–ç±»å‹ï¼šæ˜¯å¢åŠ ã€ä¿®æ”¹è¿˜æ˜¯åˆ é™¤äº†æ–‡ä»¶\n  æ–‡ä»¶ç±»å‹ï¼šæ¯ä¸ªå˜åŒ–å‘ç”Ÿåœ¨å“ªç§æ–‡ä»¶ç±»å‹ä¸Š\n  æ–‡ä»¶å±æ€§ï¼šæ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´ã€ç”¨æˆ·IDã€ç»„IDã€RWXæƒé™ç­‰\n  æ ¹æ®æˆ‘ä»¬ä¸Šé¢æ‰€ä»‹ç»çš„UnionFSï¼Œå¾ˆå®¹æ˜“ç†è§£ã€‚\n3.3 Image Config ConfigåŒ…å«äº†å¯¹é•œåƒæ–‡ä»¶çš„æè¿°ï¼Œå®ƒæ˜¯ä¸€ä¸ªjsonæ–‡ä»¶ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š\n{ \u0026#34;created\u0026#34;: \u0026#34;2015-10-31T22:22:56.015925234Z\u0026#34;, \u0026#34;author\u0026#34;: \u0026#34;Alyssa P. Hacker \u0026lt;alyspdev@example.com\u0026gt;\u0026#34;, \u0026#34;architecture\u0026#34;: \u0026#34;amd64\u0026#34;, \u0026#34;os\u0026#34;: \u0026#34;linux\u0026#34;, \u0026#34;config\u0026#34;: { \u0026#34;User\u0026#34;: \u0026#34;alice\u0026#34;, \u0026#34;ExposedPorts\u0026#34;: { \u0026#34;8080/tcp\u0026#34;: {} }, \u0026#34;Env\u0026#34;: [ \u0026#34;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\u0026#34;, \u0026#34;FOO=oci_is_a\u0026#34;, \u0026#34;BAR=well_written_spec\u0026#34; ], ... }, \u0026#34;rootfs\u0026#34;: { \u0026#34;diff_ids\u0026#34;: [ \u0026#34;sha256:c6f988f4874bb0add23a778f753c65efe992244e148a1d2ec2a8b664fb66bbd1\u0026#34;, \u0026#34;sha256:5f70bf18a086007016e948b04aed3b82103a36bea41755b6cddfaf10ace3c6ef\u0026#34; ], \u0026#34;type\u0026#34;: \u0026#34;layers\u0026#34; }, \u0026#34;history\u0026#34;: [ ... ] } å…¶ä¸­å¤§éƒ¨åˆ†æ˜¯å¯é€‰å‚æ•°ï¼Œå¿…é¡»çš„å‚æ•°æœ‰ï¼š\n architecture: CPUæ¶æ„ osï¼š é•œåƒåœ¨ä»€ä¹ˆæ“ä½œç³»ç»Ÿä¸Šè¿è¡Œ rootfsï¼šæŒ‡å®šäº†imageæ‰€åŒ…å«çš„filesystem layersï¼Œtypeçš„å€¼å¿…é¡»æ˜¯layersï¼Œdiff_idsåŒ…å«äº†layerçš„åˆ—è¡¨ï¼ˆé¡ºåºæ’åˆ—ï¼‰ï¼Œæ¯ä¸€ä¸ªsha256å°±æ˜¯æ¯å±‚layerå¯¹åº”taråŒ…çš„sha256ç   typeï¼š typeçš„å€¼å¿…é¡»æ˜¯layers diff_ids: æ¯å±‚layeråŒ…çš„å“ˆå¸Œå€¼çš„åˆ—è¡¨    å…¶ä»–éƒ½æ˜¯å¯é€‰å‚æ•°ï¼Œè§åçŸ¥æ„\n3.4 Image Manifest Image Manifestä¸ºç‰¹å®šæ¶æ„å’Œæ“ä½œç³»ç»Ÿçš„å•ä¸ªå®¹å™¨é•œåƒæä¾›é…ç½®å’Œä¸€ç³»åˆ—çš„layerã€‚\nManifest çš„ä¸‰å¤§ä¸»è¦ç›®æ ‡ï¼š\n  å†…å®¹å¯å¯»å€ï¼ˆé€šè¿‡ hash ç®—æ³•ä¸ºé•œåƒå’Œå®ƒçš„ç»„ä»¶ç”Ÿæˆå”¯ä¸€IDï¼‰\n  æ”¯æŒå¤šç§å¹³å°çš„æ¶æ„é•œåƒï¼ˆç”±ä¸€ä¸ªæ›´ä¸Šå±‚çš„ manifest è¯´æ˜åŒ…å«çš„é•œåƒ manifests å…¶å…·ä½“å¹³å°çš„ç‰ˆæœ¬æƒ…å†µï¼‰\n  èƒ½è¢«è§£ææˆä¸º OCI è¿è¡Œæ—¶è§„èŒƒ\n  ç¤ºä¾‹å¦‚ä¸‹ï¼š\n{ \u0026#34;schemaVersion\u0026#34;: 2, \u0026#34;mediaType\u0026#34;: \u0026#34;application/vnd.oci.image.manifest.v1+json\u0026#34;, \u0026#34;config\u0026#34;: { \u0026#34;mediaType\u0026#34;: \u0026#34;application/vnd.oci.image.config.v1+json\u0026#34;, \u0026#34;size\u0026#34;: 7023, \u0026#34;digest\u0026#34;: \u0026#34;sha256:b5b2b2c507a0944348e0303114d8d93aaaa081732b86451d9bce1f432a537bc7\u0026#34; }, \u0026#34;layers\u0026#34;: [ { \u0026#34;mediaType\u0026#34;: \u0026#34;application/vnd.oci.image.layer.v1.tar+gzip\u0026#34;, \u0026#34;size\u0026#34;: 32654, \u0026#34;digest\u0026#34;: \u0026#34;sha256:9834876dcfb05cb167a5c24953eba58c4ac89b1adf57f28f2f9d09af107ee8f0\u0026#34; }, { \u0026#34;mediaType\u0026#34;: \u0026#34;application/vnd.oci.image.layer.v1.tar+gzip\u0026#34;, \u0026#34;size\u0026#34;: 16724, \u0026#34;digest\u0026#34;: \u0026#34;sha256:3c3a4604a545cdc127456d94e421cd355bca5b528f4a9c1905b15da2eb4a4c6b\u0026#34; }, { \u0026#34;mediaType\u0026#34;: \u0026#34;application/vnd.oci.image.layer.v1.tar+gzip\u0026#34;, \u0026#34;size\u0026#34;: 73109, \u0026#34;digest\u0026#34;: \u0026#34;sha256:ec4b8955958665577945c89419d1af06b5f7636b4ac3da7f12184802ad867736\u0026#34; } ], \u0026#34;annotations\u0026#34;: { \u0026#34;com.example.key1\u0026#34;: \u0026#34;value1\u0026#34;, \u0026#34;com.example.key2\u0026#34;: \u0026#34;value2\u0026#34; } } ä»ä¸Šé¢çš„jsonæ–‡ä»¶ä¸­å¯ä»¥çœ‹å‡ºï¼Œmanifestä¸­åŒ…å«å¯¹configçš„æè¿°ï¼ŒåŒ…æ‹¬å…¶mediaTypeï¼Œ sizeï¼Œdigestç­‰ï¼Œè¿™é‡Œçš„digestå°±æ˜¯configæ–‡ä»¶çš„sha256å€¼ï¼Œå¯ä»¥çœ‹å‡ºmanifestä¸configçš„ä¸€å¯¹ä¸€å¯¹åº”å…³ç³»ã€‚è€Œlayerä¸­åˆ™æŒ‡æ˜äº†è¿™ä¸ªmanifeståŒ…å«å“ªäº›å±‚ï¼Œmanifestä¸layeræ˜¯ä¸€å¯¹å¤šå…³ç³»ã€‚\n3.5 Image Index Image IndexæŒ‡å‘ä¸€ä¸ªç‰¹å®šmanifestsçš„æ›´é«˜å±‚manifestï¼Œç”¨äºæ”¯æŒå¤šå¹³å°ã€‚indexæ˜¯å¯é€‰çš„ã€‚\nç¤ºä¾‹å¦‚ä¸‹ï¼š\n{ \u0026#34;schemaVersion\u0026#34;: 2, \u0026#34;mediaType\u0026#34;: \u0026#34;application/vnd.oci.image.index.v1+json\u0026#34;, \u0026#34;manifests\u0026#34;: [ { \u0026#34;mediaType\u0026#34;: \u0026#34;application/vnd.oci.image.manifest.v1+json\u0026#34;, \u0026#34;size\u0026#34;: 7143, \u0026#34;digest\u0026#34;: \u0026#34;sha256:e692418e4cbaf90ca69d05a66403747baa33ee08806650b51fab815ad7fc331f\u0026#34;, \u0026#34;platform\u0026#34;: { \u0026#34;architecture\u0026#34;: \u0026#34;ppc64le\u0026#34;, \u0026#34;os\u0026#34;: \u0026#34;linux\u0026#34; } }, { \u0026#34;mediaType\u0026#34;: \u0026#34;application/vnd.oci.image.manifest.v1+json\u0026#34;, \u0026#34;size\u0026#34;: 7682, \u0026#34;digest\u0026#34;: \u0026#34;sha256:5b0bcabd1ed22e9fb1310cf6c2dec7cdef19f0ad69efa1f392e94a4333501270\u0026#34;, \u0026#34;platform\u0026#34;: { \u0026#34;architecture\u0026#34;: \u0026#34;amd64\u0026#34;, \u0026#34;os\u0026#34;: \u0026#34;linux\u0026#34; } } ], \u0026#34;annotations\u0026#34;: { \u0026#34;com.example.key1\u0026#34;: \u0026#34;value1\u0026#34;, \u0026#34;com.example.key2\u0026#34;: \u0026#34;value2\u0026#34; } } indexæ–‡ä»¶åŒ…å«äº†å¯¹imageä¸­æ‰€æœ‰manifestçš„æè¿°ï¼Œç›¸å½“äºä¸€ä¸ªmanifeståˆ—è¡¨ï¼ŒåŒ…æ‹¬æ¯ä¸ªmanifestçš„media typeï¼Œæ–‡ä»¶å¤§å°ï¼Œsha256ç ï¼Œæ”¯æŒçš„å¹³å°ä»¥åŠå¹³å°ç‰¹æ®Šçš„é…ç½®ã€‚\næ¯”å¦‚ubuntuæƒ³è®©å®ƒçš„imageæ”¯æŒamd64å’Œarm64å¹³å°ï¼Œäºæ˜¯å®ƒåœ¨ä¸¤ä¸ªå¹³å°ä¸Šéƒ½ç¼–è¯‘å¥½ç›¸åº”çš„åŒ…ï¼Œç„¶åå°†ä¸¤ä¸ªå¹³å°çš„layeréƒ½æ”¾åˆ°è¿™ä¸ªimageçš„filesystem layersé‡Œé¢ï¼Œç„¶åå†™ä¸¤ä¸ªconfigæ–‡ä»¶å’Œä¸¤ä¸ªmanifestæ–‡ä»¶ï¼Œå†åŠ ä¸Šè¿™æ ·ä¸€ä¸ªæè¿°ä¸åŒå¹³å°manifestçš„indexæ–‡ä»¶ï¼Œå°±å¯ä»¥è®©è¿™ä¸ªimageæ”¯æŒä¸¤ä¸ªå¹³å°äº†ï¼Œä¸¤ä¸ªå¹³å°çš„ç”¨æˆ·å¯ä»¥ä½¿ç”¨åŒæ ·çš„å‘½ä»¤å¾—åˆ°è‡ªå·±å¹³å°æƒ³è¦çš„é‚£äº›layerã€‚\n3.6 é•œåƒlayout é•œåƒçš„å¸ƒå±€åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š\n blobsï¼šå†…å®¹å¯»å€çš„å—æ–‡ä»¶ï¼Œç›®å½•å¿…é¡»å­˜åœ¨ï¼Œä½†æ˜¯å¯ä»¥ä¸ºç©º oci-layout: å¿…é¡»å­˜åœ¨çš„jsonå¯¹è±¡ï¼Œå¿…é¡»åŒ…å«imageLayoutVersionå­—æ®µ index.json: å¿…é¡»å­˜åœ¨çš„JSONæ ¼å¼ï¼Œæ–‡ä»¶ä¸­å¿…é¡»åŒ…å«é•œåƒIndexçš„åŸºæœ¬å±æ€§  å¯ä»¥æŸ¥çœ‹hello-worldé•œåƒçš„å†…å®¹ï¼š\n$ yay -S skopeo # å®‰è£…skopeo $ skopeo copy docker://hello-world oci:hello-world # åˆ©ç”¨skopeoä¸‹è½½hello-worldé•œåƒ $ tree -L 3 hello-world hello-world â”œâ”€â”€ blobs â”‚Â â””â”€â”€ sha256 â”‚Â â”œâ”€â”€ 2db29710123e3e53a794f2694094b9b4338aa9ee5c40b930cb8063a1be392c54 â”‚Â â”œâ”€â”€ 75ab15a4973c91d13d02b8346763142ad26095e155ca756c79ee3a4aa792991f â”‚Â â””â”€â”€ 811f3caa888b1ee5310e2135cfd3fe36b42e233fe0d76d9798ebd324621238b9 â”œâ”€â”€ index.json â””â”€â”€ oci-layout index.json\n{ \u0026#34;schemaVersion\u0026#34;: 2, \u0026#34;manifests\u0026#34;: [ { \u0026#34;mediaType\u0026#34;: \u0026#34;application/vnd.oci.image.manifest.v1+json\u0026#34;, \u0026#34;digest\u0026#34;: \u0026#34;sha256:75ab15a4973c91d13d02b8346763142ad26095e155ca756c79ee3a4aa792991f\u0026#34;, \u0026#34;size\u0026#34;: 402 } ] } oci-layout\n{ \u0026#34;imageLayoutVersion\u0026#34;: \u0026#34;1.0.0\u0026#34; } 4. ä»è¿œç¨‹è·å–é•œåƒçš„è¿‡ç¨‹   dockerå‘é€imageçš„åç§°+tagï¼ˆæˆ–è€…digestï¼‰ç»™registryæœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨æ ¹æ®æ”¶åˆ°çš„imageçš„åç§°+tagï¼ˆæˆ–è€…digestï¼‰ï¼Œæ‰¾åˆ°ç›¸åº”imageçš„manifestï¼Œç„¶åå°†manifestè¿”å›ç»™docker\n  dockerå¾—åˆ°manifeståï¼Œè¯»å–é‡Œé¢imageé…ç½®æ–‡ä»¶çš„digest(sha256)ï¼Œè¿™ä¸ªsha256ç å°±æ˜¯imageçš„ID\n  æ ¹æ®IDåœ¨æœ¬åœ°æ‰¾æœ‰æ²¡æœ‰å­˜åœ¨åŒæ ·IDçš„imageï¼Œæœ‰çš„è¯å°±ä¸ç”¨ç»§ç»­ä¸‹è½½äº†\n  å¦‚æœæ²¡æœ‰ï¼Œé‚£ä¹ˆä¼šç»™registryæœåŠ¡å™¨å‘è¯·æ±‚ï¼ˆé‡Œé¢åŒ…å«é…ç½®æ–‡ä»¶çš„sha256å’Œmedia typeï¼‰ï¼Œæ‹¿åˆ°imageçš„é…ç½®æ–‡ä»¶ï¼ˆImage Configï¼‰\n  æ ¹æ®é…ç½®æ–‡ä»¶ä¸­çš„diff_idsï¼ˆæ¯ä¸ªdiffidå¯¹åº”ä¸€ä¸ªlayer taråŒ…çš„sha256ï¼ŒtaråŒ…ç›¸å½“äºlayerçš„åŸå§‹æ ¼å¼ï¼‰ï¼Œåœ¨æœ¬åœ°æ‰¾å¯¹åº”çš„layeræ˜¯å¦å­˜åœ¨\n  å¦‚æœlayerä¸å­˜åœ¨ï¼Œåˆ™æ ¹æ®manifesté‡Œé¢layerçš„sha256å’Œmedia typeå»æœåŠ¡å™¨æ‹¿ç›¸åº”çš„layerï¼ˆç›¸å½“å»æ‹¿å‹ç¼©æ ¼å¼çš„åŒ…ï¼‰ã€‚\n  æ‹¿åˆ°åè¿›è¡Œè§£å‹ï¼Œå¹¶æ£€æŸ¥è§£å‹åtaråŒ…çš„sha256èƒ½å¦å’Œé…ç½®æ–‡ä»¶ï¼ˆImage Configï¼‰ä¸­çš„diff_idå¯¹çš„ä¸Šï¼Œå¯¹ä¸ä¸Šè¯´æ˜æœ‰é—®é¢˜ï¼Œä¸‹è½½å¤±è´¥\n  æ ¹æ®dockeræ‰€ç”¨çš„åå°æ–‡ä»¶ç³»ç»Ÿç±»å‹ï¼Œè§£å‹taråŒ…å¹¶æ”¾åˆ°æŒ‡å®šçš„ç›®å½•\n  ç­‰æ‰€æœ‰çš„layeréƒ½ä¸‹è½½å®Œæˆåï¼Œæ•´ä¸ªimageä¸‹è½½å®Œæˆï¼Œå°±å¯ä»¥ä½¿ç”¨äº†\n  ä¸Šé¢çš„è¿‡ç¨‹æ¶‰åŠåˆ°ä¸¤ä¸ªæ¥å£ï¼š\nGET /v2/\u0026lt;name\u0026gt;/manifests/\u0026lt;reference\u0026gt; å…¶ä¸­ä¸ºé•œåƒåç§°ï¼Œå¯èƒ½åŒ…å«tagæˆ–digestã€‚\nè¿™ä¸ªæ¥å£ç”¨äºè·å–é•œåƒçš„manifestã€‚\nGET /v2/\u0026lt;name\u0026gt;/blobs/\u0026lt;digest\u0026gt; è¿™ä¸ªæ¥å£ç”¨äºè·å–é•œåƒçš„layer\n5. é•œåƒåœ¨æœ¬åœ°çš„å­˜å‚¨  é•œåƒé»˜è®¤åœ¨ç³»ç»Ÿä¸­çš„å­˜å‚¨ä½ç½®åœ¨/var/lib/docker\n  è¿™é‡Œæˆ‘ä»¬å•ç‹¬é€‰æ‹©ä¸€ä¸ªé•œåƒgolang:1.16.6æ¥çœ‹\n 5.1 é•œåƒçš„digest é•œåƒçš„digestå³ä¸ºé•œåƒmanifestæ–‡ä»¶çš„sha256å€¼ï¼Œå½“é•œåƒå†…å®¹å‘ç”Ÿå˜åŒ–ï¼Œå³å…¶ä¸­çš„layerå‘ç”Ÿäº†å˜åŒ–ï¼Œåˆ™å…¶layerçš„sha256å€¼å¿…ç„¶å‘ç”Ÿå˜åŒ–ï¼Œè€Œç›¸åº”çš„åŒ…å«layerå“ˆå¸Œå€¼çš„manifestå¿…ç„¶ä¹Ÿä¼šå‘ç”Ÿå˜åŒ–ï¼Œè¿™æ ·å°±ä¿è¯äº†digestèƒ½å”¯ä¸€å¯¹åº”ä¸€ä¸ªé•œåƒã€‚\n5.2 repositories.json repositories.jsonä¸­è®°å½•äº†å’Œæœ¬åœ°imageç›¸å…³çš„repositoryä¿¡æ¯ï¼Œä¸»è¦æ˜¯nameå’Œimage idçš„å¯¹åº”å…³ç³»ï¼Œå½“imageä»registryä¸Šè¢«pullä¸‹æ¥åï¼Œå°±ä¼šæ›´æ–°è¯¥æ–‡ä»¶ï¼Œå…¶ä½ç½®åœ¨/var/lib/docker/image/overlay2/repositories.json\n$ cat repositories.json | jq { \u0026#34;Repositories\u0026#34;: { \u0026#34;golang\u0026#34;: { \u0026#34;golang:1.16.6\u0026#34;: \u0026#34;sha256:028d102f774acfd5d9a17d60dc321add40bea5cc6f06e0a84fd3aca1bb4c2b12\u0026#34;, \u0026#34;golang@sha256:4544ae57fc735d7e415603d194d9fb09589b8ad7acd4d66e928eabfb1ed85ff1\u0026#34;: \u0026#34;sha256:028d102f774acfd5d9a17d60dc321add40bea5cc6f06e0a84fd3aca1bb4c2b12\u0026#34;, }, ... }, } è®°ä½golang:1.16.6çš„digestä¸º028d102f774acfd5d9a17d60dc321add40bea5cc6f06e0a84fd3aca1bb4c2b12ï¼Œè®°ä½å‰ä¸‰ä¸ªå­—æ¯å°±å¯ä»¥äº†028\n5.3 é…ç½®æ–‡ä»¶ï¼ˆimage configï¼‰ åœ¨ä»æœåŠ¡å™¨è·å–imageæ—¶ï¼Œä¼šå…ˆè·å–manifestï¼Œç„¶åä»manifestä¸­æ‹¿åˆ°configçš„hashï¼Œä»è€Œè·å–configï¼Œä¿å­˜åœ¨/var/lib/docker/image/overlay2/imagedb/content/sha256ï¼Œæ–‡ä»¶åå°±æ˜¯image id\n$ cat 028d102f774acfd5d9a17d60dc321add40bea5cc6f06e0a84fd3aca1bb4c2b12 | jq { ... \u0026#34;rootfs\u0026#34;: { \u0026#34;type\u0026#34;: \u0026#34;layers\u0026#34;, \u0026#34;diff_ids\u0026#34;: [ \u0026#34;sha256:afa3e488a0ee76983343f8aa759e4b7b898db65b715eb90abc81c181388374e3\u0026#34;, \u0026#34;sha256:4b0edb23340c111e75557748161eed3ca159584871569ce7ec9b659e1db201b4\u0026#34;, \u0026#34;sha256:5a9a65095453efb15a9b378a3c1e7699e8004744ecd6dd519bdbabd0ca9d2efc\u0026#34;, \u0026#34;sha256:ad83f0aa5c0abe35b7711f226037a5557292d479c21635b3522e1e5a41e3ce23\u0026#34;, \u0026#34;sha256:d1c59e37fbfc7294184d6fbe4ff8e1690d9119b6233f91af5ad0a4b36e45dff7\u0026#34;, \u0026#34;sha256:e46b2fd4e4eadc0ee107417c66e968f417e0759fd7d625ab6f0537ba02c1c868\u0026#34;, \u0026#34;sha256:9672a02ff8cffb302a4c5cef60f8b36cbbe9709a5ba78b7d0ce56db3219c5e51\u0026#34; ] } } è¿™é‡Œè¦æ³¨æ„çš„æ—¶ï¼Œå¦‚æœimageå­˜åœ¨å¤šä¸ªå±‚ï¼Œå³diff_idsæ•°ç»„é•¿åº¦å¤§äºä¸€ï¼Œåˆ™diff_ids[0]æ˜¯UnionFSæœ€åº•å±‚ï¼Œdiff_ids[-1]æ˜¯UnionFSæœ€é«˜å±‚ã€‚\n5.4 layerçš„diff_idå’Œdigestçš„å¯¹åº”å…³ç³» layerçš„diff_idå­˜åœ¨imageçš„é…ç½®æ–‡ä»¶ä¸­ï¼Œè€Œlayerçš„digestå­˜åœ¨imageçš„manifestä¸­ï¼Œä»–ä»¬çš„å¯¹åº”å…³ç³»è¢«å­˜å‚¨åœ¨äº†/var/lib/docker/image/overlay2/distributionç›®å½•ä¸‹ï¼š\n. â”œâ”€â”€ diffid-by-digest â”‚Â â””â”€â”€ sha256 â””â”€â”€ v2metadata-by-diffid â””â”€â”€ sha256   diffid-by-digestï¼š å­˜æ”¾digeståˆ°diffidçš„å¯¹åº”å…³ç³»\n  v2metadata-by-diffidï¼š å­˜æ”¾diffidåˆ°digestçš„å¯¹åº”å…³ç³»\n  æŸ¥çœ‹mysqlæœ€ä¸Šå±‚layerçš„digest:\n$ cd /var/lib/docker/image/overlay2/distribution/v2metadata-by-diffid/sha256 $ cat 9672a02ff8cffb302a4c5cef60f8b36cbbe9709a5ba78b7d0ce56db3219c5e51 | jq # sha256:967...æ˜¯golang:1.16.6çš„æœ€ä¸Šå±‚layer [ { \u0026#34;Digest\u0026#34;: \u0026#34;sha256:ff36ba4656980ea99a067c8a9b39f210a4da82badccaa2bae27317e711985668\u0026#34;, \u0026#34;SourceRepository\u0026#34;: \u0026#34;docker.io/library/golang\u0026#34;, \u0026#34;HMAC\u0026#34;: \u0026#34;\u0026#34; } ] 5.5 layerå…ƒæ•°æ® ä»image configä¸­æˆ‘ä»¬å¯ä»¥å¾—åˆ°diff_idsï¼Œä»è€Œå¾—åˆ°imageå„ä¸ªå±‚çš„sha256å€¼ï¼Œè¿™æ—¶æˆ‘ä»¬å¯ä»¥åˆ°/var/lib/docker/image/overlay2/layerdb/sha256å»æŸ¥çœ‹è¿™äº›å±‚ï¼Œä¾‹å¦‚golang:1.16.6çš„æœ€åº•å±‚sha256ä¸ºafa3e488a0ee76983343f8aa759e4b7b898db65b715eb90abc81c181388374e3ï¼š\n$ cat /var/lib/docker/image/overlay2/layerdb/sha256/afa3e488a0ee76983343f8aa759e4b7b898db65b715eb90abc81c181388374e3 $ tree . â”œâ”€â”€ cache-id â”œâ”€â”€ diff â”œâ”€â”€ size â””â”€â”€ tar-split.json.gz ä½†åœ¨æŸ¥çœ‹ç¬¬äºŒå±‚çš„æ—¶å€™å‘ç°ï¼š\n$ cd 4b0edb23340c111e75557748161eed3ca159584871569ce7ec9b659e1db201b4 bash: cd: 4b0edb23340c111e75557748161eed3ca159584871569ce7ec9b659e1db201b4: æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½• è¿™æ˜¯å› ä¸ºdockerä½¿ç”¨äº†chainIDçš„æ–¹å¼å»ä¿å­˜è¿™äº›layerï¼Œç®€å•æ¥è¯´å°±æ˜¯chainID=sha256sum(H(chainID), diffid)ï¼Œå› æ­¤golang:1.16.6çš„ç¬¬äºŒå±‚ä¸ºï¼š\n$ echo -n \u0026quot;sha256:afa3e488a0ee76983343f8aa759e4b7b898db65b715eb90abc81c181388374e3 sha256:4b0edb23340c111e75557748161eed3ca159584871569ce7ec9b659e1db201b4\u0026quot; | sha256sum - c21ff68b02e7caf277f5d356e8b323a95e8d3969dd1ab0d9f60e7c8b4a01c874 - è¿™æ—¶å€™æŸ¥çœ‹c21ff68b02e7caf277f5d356e8b323a95e8d3969dd1ab0d9f60e7c8b4a01c874:\n$ cd c21ff68b02e7caf277f5d356e8b323a95e8d3969dd1ab0d9f60e7c8b4a01c874 $ tree . â”œâ”€â”€ cache-id â”œâ”€â”€ diff â”œâ”€â”€ parent â”œâ”€â”€ size â””â”€â”€ tar-split.json.gz ä»¥æ­¤ç±»æ¨ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°ä»»æ„ä¸€å±‚ã€‚\nåœ¨æ¯ä¸€å±‚ä¸­ï¼Œä¸€èˆ¬åŒ…å«5ä¸ªæ–‡ä»¶ï¼š\n cache-idæ˜¯dockerä¸‹è½½layerçš„æ—¶å€™åœ¨æœ¬åœ°ç”Ÿæˆçš„ä¸€ä¸ªéšæœºuuidï¼ŒæŒ‡å‘çœŸæ­£å­˜æ”¾layeræ–‡ä»¶çš„åœ°æ–¹ diffæ–‡ä»¶å­˜æ”¾layerçš„diffid parentæ–‡ä»¶å­˜æ”¾å½“å‰layerçš„çˆ¶layerçš„diffidï¼Œè€Œç”±äºæœ€åº•å±‚layeræ²¡æœ‰parentï¼Œå› æ­¤å®ƒæ²¡æœ‰è¿™ä¸ªæ–‡ä»¶ sizeå½“å‰layerçš„å¤§å°ï¼Œå•ä½æ˜¯å­—èŠ‚ tar-split.json.gzï¼Œlayerå‹ç¼©åŒ…çš„splitæ–‡ä»¶ï¼Œé€šè¿‡è¿™ä¸ªæ–‡ä»¶å¯ä»¥è¿˜åŸlayerçš„taråŒ…  æ‰“å°å‡ºgolang:1.16.6ç¬¬äºŒå±‚çš„cache-id:\n$ cat cache-id 40a11a2b4f594bcccbe2cbb6cd3e6fa4a3c2f8427817f43bbade4331173611d2 5.6 layeræ•°æ® layeræ•°æ®åœ¨/var/lib/docker/overlay2/\né€šè¿‡æˆ‘ä»¬åˆšæ‰æ‰“å°çš„golang:1.16.6ç¬¬äºŒå±‚çš„cache-idï¼Œå¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°golang:1.16.6ç¬¬äºŒå±‚çš„æ–‡ä»¶ï¼š\n$ cd /var/lib/docker/overlay2/40a11a2b4f594bcccbe2cbb6cd3e6fa4a3c2f8427817f43bbade4331173611d2 $ tree . â”œâ”€â”€ committed â”œâ”€â”€ diff â”œâ”€â”€ link â”œâ”€â”€ lower â””â”€â”€ work diffæ–‡ä»¶å¤¹ä¸­å°±æ˜¯è¿™ä¸€å±‚ç›¸å¯¹äºä¸‹å±‚ä¿®æ”¹çš„æ–‡ä»¶ã€‚\n5.7 manifestæ–‡ä»¶ manifesté‡Œé¢åŒ…å«çš„å†…å®¹å°±æ˜¯å¯¹configå’Œlayerçš„sha256 + media typeæè¿°ï¼Œç›®çš„å°±æ˜¯ä¸ºäº†ä¸‹è½½configå’Œlayerï¼Œç­‰imageä¸‹è½½å®Œæˆåï¼Œmanifestçš„ä½¿å‘½å°±å®Œæˆäº†ï¼Œé‡Œé¢çš„ä¿¡æ¯å¯¹äºimageçš„æœ¬åœ°ç®¡ç†æ¥è¯´æ²¡ä»€ä¹ˆç”¨ï¼Œå› æ­¤æœ¬åœ°å¹¶æ²¡ä¸å•ç‹¬å¯¹manifestè¿›è¡Œå­˜å‚¨ã€‚\nReferences https://cloud.tencent.com/developer/article/1769020\nhttps://yeasy.gitbook.io/docker_practice/image/list\nhttps://www.jianshu.com/p/3ba255463047\nhttps://staight.github.io/2019/10/04/%E5%AE%B9%E5%99%A8%E5%AE%9E%E7%8E%B0-overlay2/\nhttps://www.jianshu.com/p/3826859a6d6e\nhttps://time.geekbang.org/column/article/318173\nhttps://jvns.ca/blog/2019/11/18/how-containers-work--overlayfs/\nhttps://vividcode.cc/oci-image-spec-introduction/\nhttps://segmentfault.com/a/1190000009309276\nhttps://github.com/opencontainers/image-spec\nhttps://github.com/containers/skopeo\nhttps://docs.docker.com/registry/spec/api/#pulling-an-image\n","permalink":"http://yangchnet.github.io/Dessert/posts/container/%E6%A6%82%E8%A7%88%E5%AE%B9%E5%99%A8%E7%AF%87%E4%B8%80%E9%95%9C%E5%83%8F/","summary":"1. åˆ†å±‚çš„é•œåƒ åœ¨æˆ‘ä»¬å¯åŠ¨ä¸€ä¸ªå®¹å™¨ä¹‹å‰ï¼Œé€šå¸¸éœ€è¦ä¸‹è½½è¿™ä¸ªå®¹å™¨å¯¹åº”çš„é•œåƒï¼Œä»¥è¿™ä¸ªé•œåƒä¸ºåŸºç¡€å¯åŠ¨å®¹å™¨ã€‚é•œåƒä¸­åŒ…å«äº†å¯¹åº”çš„ç¨‹åºçš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸å…¶æ‰€ä¾èµ–çš„æ–‡ä»¶ï¼Œç¨‹åºåœ¨å¯åŠ¨åçœ‹åˆ°çš„rootfsåªæ˜¯è¿™ä¸ªé•œåƒä¸­å­˜åœ¨çš„æ–‡ä»¶ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¸ºå®¹å™¨ä¸­çš„è¿›ç¨‹æä¾›ä¸€ä¸ªå¹²å‡€çš„æ–‡ä»¶ç³»ç»Ÿã€‚\nåˆ›å»ºä¸€ä¸ªé•œåƒï¼ˆimageï¼‰çš„æœ€ç®€å•æ–¹æ³•æ˜¯ä½¿ç”¨Dockerfileã€‚\nFROMscratchCOPY hello /CMD [\u0026#34;/hello\u0026#34;]scratchæ˜¯dockerä¸ºæˆ‘ä»¬æä¾›çš„ä¸€ä¸ªç©ºé•œåƒï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ­¤åŸºç¡€ä¸Šæ„å»ºä»»ä½•æˆ‘ä»¬æƒ³è¦çš„é•œåƒã€‚\nåœ¨ä¹¦å†™Dockerfileæ—¶ï¼Œæƒ³å¿…ä½ å¬è¯´è¿‡è¿™ä¹ˆä¸€å¥è¯ï¼Œä¸è¦åœ¨Dockerfileä¸­åˆ›å»ºå¤ªå¤šå±‚.\nåœ¨Dockerfileä¸­ï¼Œæ¯ä¸€ä¸ªæŒ‡ä»¤éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„â€œå±‚â€ï¼Œè¿™é‡Œçš„å±‚ï¼ŒæŒ‡çš„æ˜¯UnionFSä¸­çš„ä¸€ä¸ªæ–‡ä»¶ç›®å½•ã€‚å½“æˆ‘ä»¬åˆ›å»ºäº†è¿‡å¤šçš„å±‚ï¼Œä¼šå¯¼è‡´é•œåƒä½“ç§¯å˜å¤§ï¼Œé™¤æ­¤ä¹‹å¤–ï¼ŒUnion FS ä¹Ÿä¼šæœ‰æœ€å¤§å±‚æ•°é™åˆ¶ã€‚\nå› æ­¤å¯¹äºå¦‚ä¸‹çš„Dockerfileæ–‡ä»¶å†™æ³•ï¼Œåº”å°½é‡é¿å…ï¼š\nFROMdebian:stretchRUN apt-get updateRUN apt-get install -y gcc libc6-dev make wgetRUN wget -O redis.tar.gz \u0026#34;http://download.redis.io/releases/redis-5.0.3.tar.gz\u0026#34;RUN mkdir -p /usr/src/redisRUN tar -xzf redis.tar.gz -C /usr/src/redis --strip-components=1RUN make -C /usr/src/redisRUN make -C /usr/src/redis installå¯ä¼˜åŒ–ä¸ºå¦‚ä¸‹å†™æ³•\nFROMdebian:stretchRUN set -x; buildDeps=\u0026#39;gcc libc6-dev make wget\u0026#39; \\  \u0026amp;\u0026amp; apt-get update \\  \u0026amp;\u0026amp; apt-get install -y $buildDeps \\  \u0026amp;\u0026amp; wget -O redis.tar.gz \u0026#34;http://download.redis.io/releases/redis-5.0.3.tar.gz\u0026#34; \\  \u0026amp;\u0026amp; mkdir -p /usr/src/redis \\  \u0026amp;\u0026amp; tar -xzf redis.","title":"æ¦‚è§ˆå®¹å™¨ç¯‡ä¸€ï¼šé•œåƒ"},{"content":" æå®¢æ—¶é—´ã€ŠRedis æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜ã€‹å­¦ä¹ ç¬”è®°\n  æ¦‚è§ˆRedisç¯‡ä¸€ï¼šå•çº¿ç¨‹æ¨¡å‹ æ¦‚è§ˆRedisç¯‡äºŒï¼šAOFæ—¥å¿— æ¦‚è§ˆRedisç¯‡ä¸‰ï¼šRDBå¿«ç…§ æ¦‚è§ˆRedisç¯‡å››ï¼šä¸»ä» æ¦‚è§ˆRedisç¯‡äº”ï¼šå“¨å…µ æ¦‚è§ˆRedisç¯‡å…­ï¼šåˆ‡ç‰‡é›†ç¾¤  Rediså•çº¿ç¨‹æ¨¡å‹ Redis æ˜¯å•çº¿ç¨‹ï¼Œä¸»è¦æ˜¯æŒ‡ Redis çš„ç½‘ç»œ IO å’Œé”®å€¼å¯¹è¯»å†™æ˜¯ç”±ä¸€ä¸ªçº¿ç¨‹æ¥å®Œæˆçš„ï¼Œè¿™ä¹Ÿæ˜¯ Redis å¯¹å¤–æä¾›é”®å€¼å­˜å‚¨æœåŠ¡çš„ä¸»è¦æµç¨‹ã€‚ä½† Redis çš„å…¶ä»–åŠŸèƒ½ï¼Œæ¯”å¦‚æŒä¹…åŒ–ã€å¼‚æ­¥åˆ é™¤ã€é›†ç¾¤æ•°æ®åŒæ­¥ç­‰ï¼Œå…¶å®æ˜¯ç”±é¢å¤–çš„çº¿ç¨‹æ‰§è¡Œçš„ã€‚\nä¸ºä»€ä¹ˆRedisé‡‡ç”¨å•çº¿ç¨‹ é€šå¸¸çš„ç¨‹åºè®¾è®¡éƒ½é‡‡ç”¨å¤šçº¿ç¨‹æ¥æé«˜æ€§èƒ½ï¼Œè·å¾—æ›´å¿«çš„å“åº”é€Ÿåº¦ã€‚\nä½†é‡‡ç”¨å¤šçº¿ç¨‹æ¨¡å‹å°†ä¸å¯é¿å…åœ°é¢å¯¹ä»¥ä¸‹é—®é¢˜ï¼š\n å¤šä¸ªçº¿ç¨‹å¯¹åŒä¸€èµ„æºçš„æ•°æ®ç«äº‰ å› è§£å†³æ•°æ®ç«äº‰è€Œå¯¼è‡´çš„æ€§èƒ½æŸè€— å¢åŠ ç³»ç»Ÿå¤æ‚åº¦ï¼Œé™ä½ç³»ç»Ÿä»£ç çš„æ˜“è°ƒè¯•æ€§å’Œå¯ç»´æŠ¤æ€§  ä¸ºå•¥Rediså•çº¿ç¨‹è¿˜è¿™ä¹ˆå¿« ä¸»è¦æ˜¯ä¸¤ç‚¹ï¼š\n Rediså¤§éƒ¨åˆ†æ“ä½œåœ¨å†…å­˜ä¸Šå®Œæˆï¼Œå¹¶é‡‡ç”¨äº†é«˜æ•ˆçš„æ•°æ®ç»“æ„ Redisé‡‡ç”¨äº†å¤šè·¯å¤ç”¨æœºåˆ¶  ","permalink":"http://yangchnet.github.io/Dessert/posts/cache/%E6%A6%82%E8%A7%88redis%E7%AF%87%E4%B8%80%E5%8D%95%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B/","summary":" æå®¢æ—¶é—´ã€ŠRedis æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜ã€‹å­¦ä¹ ç¬”è®°\n  æ¦‚è§ˆRedisç¯‡ä¸€ï¼šå•çº¿ç¨‹æ¨¡å‹ æ¦‚è§ˆRedisç¯‡äºŒï¼šAOFæ—¥å¿— æ¦‚è§ˆRedisç¯‡ä¸‰ï¼šRDBå¿«ç…§ æ¦‚è§ˆRedisç¯‡å››ï¼šä¸»ä» æ¦‚è§ˆRedisç¯‡äº”ï¼šå“¨å…µ æ¦‚è§ˆRedisç¯‡å…­ï¼šåˆ‡ç‰‡é›†ç¾¤  Rediså•çº¿ç¨‹æ¨¡å‹ Redis æ˜¯å•çº¿ç¨‹ï¼Œä¸»è¦æ˜¯æŒ‡ Redis çš„ç½‘ç»œ IO å’Œé”®å€¼å¯¹è¯»å†™æ˜¯ç”±ä¸€ä¸ªçº¿ç¨‹æ¥å®Œæˆçš„ï¼Œè¿™ä¹Ÿæ˜¯ Redis å¯¹å¤–æä¾›é”®å€¼å­˜å‚¨æœåŠ¡çš„ä¸»è¦æµç¨‹ã€‚ä½† Redis çš„å…¶ä»–åŠŸèƒ½ï¼Œæ¯”å¦‚æŒä¹…åŒ–ã€å¼‚æ­¥åˆ é™¤ã€é›†ç¾¤æ•°æ®åŒæ­¥ç­‰ï¼Œå…¶å®æ˜¯ç”±é¢å¤–çš„çº¿ç¨‹æ‰§è¡Œçš„ã€‚\nä¸ºä»€ä¹ˆRedisé‡‡ç”¨å•çº¿ç¨‹ é€šå¸¸çš„ç¨‹åºè®¾è®¡éƒ½é‡‡ç”¨å¤šçº¿ç¨‹æ¥æé«˜æ€§èƒ½ï¼Œè·å¾—æ›´å¿«çš„å“åº”é€Ÿåº¦ã€‚\nä½†é‡‡ç”¨å¤šçº¿ç¨‹æ¨¡å‹å°†ä¸å¯é¿å…åœ°é¢å¯¹ä»¥ä¸‹é—®é¢˜ï¼š\n å¤šä¸ªçº¿ç¨‹å¯¹åŒä¸€èµ„æºçš„æ•°æ®ç«äº‰ å› è§£å†³æ•°æ®ç«äº‰è€Œå¯¼è‡´çš„æ€§èƒ½æŸè€— å¢åŠ ç³»ç»Ÿå¤æ‚åº¦ï¼Œé™ä½ç³»ç»Ÿä»£ç çš„æ˜“è°ƒè¯•æ€§å’Œå¯ç»´æŠ¤æ€§  ä¸ºå•¥Rediså•çº¿ç¨‹è¿˜è¿™ä¹ˆå¿« ä¸»è¦æ˜¯ä¸¤ç‚¹ï¼š\n Rediså¤§éƒ¨åˆ†æ“ä½œåœ¨å†…å­˜ä¸Šå®Œæˆï¼Œå¹¶é‡‡ç”¨äº†é«˜æ•ˆçš„æ•°æ®ç»“æ„ Redisé‡‡ç”¨äº†å¤šè·¯å¤ç”¨æœºåˆ¶  ","title":"æ¦‚è§ˆRedisç¯‡ä¸€ï¼šå•çº¿ç¨‹æ¨¡å‹"},{"content":"1. ä»€ä¹ˆæ˜¯inotify Inotify APIæä¾›äº†ä¸€ç§ç›‘è§†æ–‡ä»¶ç³»ç»Ÿçš„æœºåˆ¶äº‹ä»¶ã€‚ Inotifyå¯ç”¨äºç›‘è§†å•ä¸ªæ–‡ä»¶æˆ–ç›‘è§†ç›®å½•ã€‚å½“ç›‘è§†ç›®å½•æ—¶ï¼ŒInotifyå°†è¿”å›ç›®å½•æœ¬èº«çš„äº‹ä»¶ï¼Œä»¥åŠå†…éƒ¨çš„æ–‡ä»¶ç›®å½•ã€‚\nç®€å•çš„è¯´ï¼Œå°±æ˜¯inotifyå¯ä»¥ä¸ºä½ ç›‘æ§æ–‡ä»¶ç³»ç»Ÿçš„å˜åŒ–ï¼Œåœ¨å‘ç”Ÿä¸€äº›äº‹ä»¶æ—¶é€šçŸ¥ä½ ã€‚\n2. å®éªŒ éœ€è¦å®‰è£…inotify-toolsåŒ…\n# archç³»ç»Ÿ yay -S inotify-tools inotify-toolsæä¾›äº†ä¸¤ä¸ªå‘½ä»¤ï¼šinotifywaitå’Œinotifywatch\n2.1 inotifywait å…ˆæ¥çœ‹inotifywait,å®ƒè¢«ç”¨æ¥\u0026quot;Wait for a particular event on a file or set of files.\u0026quot;, ä¹Ÿå°±æ˜¯è¯´ç­‰å¾…åœ¨æ–‡ä»¶ä¸Šçš„æŸäº›äº‹ä»¶å‘ç”Ÿã€‚ä½¿ç”¨inotifywait -hæŸ¥çœ‹å…¶æ”¯æŒçš„å‚æ•°ï¼š\n-h show this help info --exclude \u0026lt;pattern\u0026gt; æ’é™¤åŒ¹é…æ‰€ç»™æ­£åˆ™çš„æ‰€æœ‰äº‹ä»¶ --excludei \u0026lt;pattern\u0026gt; ç±»ä¼¼å‰ä¸€ä¸ªå‘½ä»¤ä½†éæ•æ„Ÿ --include \u0026lt;pattern\u0026gt; æ’é™¤é™¤åŒ¹é…æ­£åˆ™ä¹‹å¤–çš„æ‰€æœ‰äº‹ä»¶ --includei \u0026lt;pattern\u0026gt; ç±»ä¼¼å‰ä¸€ä¸ªå‘½ä»¤ä½†éæ•æ„Ÿ -m|--monitor åœ¨timeoutä¹‹å‰ä¿æŒç›‘å¬ï¼Œè‹¥ä¸è®¾ç½®æ­¤æ ‡å¿—ï¼Œinotifywaitå°†åœ¨ä¸€ä¸ªäº‹ä»¶åé€€å‡ºã€‚ -d|--daemon ç±»ä¼¼å‰ä¸€ä¸ªå‘½ä»¤ä½†åœ¨åå°è¿è¡Œï¼Œå°†æ—¥å¿—è¾“å‡ºåˆ°`--outfile`æ‰€æŒ‡å®šçš„æ–‡ä»¶ -P|--no-dereference ä¸è·Ÿè¸ªç¬¦å·é“¾æ¥ -r|--recursive é€’å½’çš„ç›‘å¬ã€ --fromfile \u0026lt;file\u0026gt; Read files to watch from \u0026lt;file\u0026gt; or `-' for stdin. -o|--outfile \u0026lt;file\u0026gt; è¾“å‡ºåˆ°\u0026lt;file\u0026gt;è€Œä¸æ˜¯æ ‡å‡†è¾“å‡º -s|--syslog å‘syslogå‘é€é”™è¯¯è€Œä¸æ˜¯Stderr -q|--quiet åªè¾“å‡ºäº‹ä»¶ -qq å•¥ä¹Ÿä¸è¾“å‡º --format \u0026lt;fmt\u0026gt; ä»¥ç‰¹å®šæ ¼å¼è¾“å‡º --no-newline åœ¨æ ¼å¼åŒ–è¾“å‡ºåä¸æ‰“å°æ¢è¡Œç¬¦ --timefmt \u0026lt;fmt\u0026gt; strftime-compatible format string for use with %T in --format string. -c|--csv ä»¥csvæ ¼å¼è¾“å‡º -t|--timeout \u0026lt;seconds\u0026gt; å½“ç›‘å¬ä¸€ä¸ªäº‹ä»¶æ—¶ï¼Œåœ¨\u0026lt;seconds\u0026gt;ç§’åè¶…æ—¶ -e|--event \u0026lt;event1\u0026gt; ç›‘å¬ç‰¹å®šäº‹ä»¶ï¼Œè‹¥ä¸è®¾ç½®ï¼Œåˆ™ç›‘å¬æ‰€æœ‰äº‹ä»¶ æ”¯æŒçš„eventæœ‰ï¼š\nEvents: access file or directory contents were read modify file or directory contents were written attrib file or directory attributes changed close_write file or directory closed, after being opened in writable mode close_nowrite file or directory closed, after being opened in read-only mode close file or directory closed, regardless of read/write mode open file or directory opened moved_to file or directory moved to watched directory moved_from file or directory moved from watched directory move file or directory moved to or from watched directory move_self A watched file or directory was moved. create file or directory created within watched directory delete file or directory deleted within watched directory delete_self file or directory was deleted unmount file system containing file or directory unmounted åœ¨ç»ˆç«¯1ä¸­ï¼š\nmkdir ~/inotify-demo \u0026amp;\u0026amp; cd inotify-demo # å»ºç«‹æµ‹è¯•æ–‡ä»¶å¤¹ inotifywait -rmc -q . åœ¨ç»ˆç«¯2ä¸­ï¼š\ncd ~/inotify-demo touch aa.txt æ­¤æ—¶åˆ‡æ¢åˆ°ç»ˆç«¯1ï¼Œå¯ä»¥çœ‹åˆ°äº‹ä»¶è¾“å‡ºï¼š\n... ./,CREATE,aa.txt ./,OPEN,aa.txt ./,ATTRIB,aa.txt ./,\u0026#34;CLOSE_WRITE,CLOSE\u0026#34;,aa.txt ./,\u0026#34;OPEN,ISDIR\u0026#34;, ./,\u0026#34;CLOSE_NOWRITE,CLOSE,ISDIR\u0026#34;, ./,OPEN,aa.txt ./,\u0026#34;CLOSE_NOWRITE,CLOSE\u0026#34;,aa.txt æ‰“å¼€æ–‡ä»¶aa.txtï¼Œå†™å…¥ä¸€è¡Œ\ninotify-demo å¯çœ‹åˆ°ç»ˆç«¯1ä¸­ä¹Ÿå·²å°†äº‹ä»¶æ‰“å°å‡ºï¼š\n... ./,CREATE,4913 ./,OPEN,4913 ./,ATTRIB,4913 ./,\u0026#34;CLOSE_WRITE,CLOSE\u0026#34;,4913 ./,DELETE,4913 ./,MOVED_FROM,aa.txt ./,CREATE,aa.txt ./,OPEN,aa.txt ./,MODIFY,aa.txt ./,MODIFY,aa.txt ./,ATTRIB,aa.txt ./,\u0026#34;CLOSE_WRITE,CLOSE\u0026#34;,aa.txt ./,ATTRIB,aa.txt ./,\u0026#34;OPEN,ISDIR\u0026#34;, ./,\u0026#34;CLOSE_NOWRITE,CLOSE,ISDIR\u0026#34;, å°†æ‰€æœ‰çš„äº‹ä»¶éƒ½æ‰“å°å‡ºç•¥æ˜¾æ‚ä¹±ï¼Œè¿™é‡Œæˆ‘ä»¬åªè®©å…¶ç›‘å¬modifyäº‹ä»¶\ninotifywait -rmc -q -e modify . åˆ›å»ºæ–‡ä»¶bb.txt\ntouch bb.txt å¯è§‚å¯Ÿåˆ°ï¼Œæœªæœ‰ä»»ä½•äº‹ä»¶è¢«æ‰“å°ã€‚\nåœ¨bb.txtä¸­å†™å…¥ä¸€è¡Œinotify-demo\nå¯è§‚å¯Ÿåˆ°äº‹ä»¶æ‰“å°ï¼š\n./,MODIFY,bb.txt ./,MODIFY,bb.txt 2.2 inotifywatch inotifywatchè¢«ç”¨äºæ”¶é›†æ–‡ä»¶ç³»ç»Ÿä½¿ç”¨ä¿¡æ¯\nå…¶å‘½ä»¤å‚æ•°å’Œinotifywaitå¤§è‡´ç›¸åŒï¼Œå¯ä½¿ç”¨inotifywatchæŸ¥çœ‹\nå®éªŒï¼š\ncd ~/inotify-demo # åœ¨30ç§’å†…ç›‘å¬crate,modify,deleteä¸‰ä¸ªäº‹ä»¶ï¼Œåœ¨30ç§’ç»“æŸåæ‰“å°ç»Ÿè®¡ä¿¡æ¯ inotifywatch -v -e create -e modify -e delete -t 30 -r . æ¥ä¸‹æ¥30ç§’ï¼Œåˆ›å»ºäº†4ä¸ªæ–‡ä»¶ï¼Œä¿®æ”¹äº†2ä¸ªæ–‡ä»¶ï¼Œåˆ é™¤äº†1ä¸ªæ–‡ä»¶\näº‹ä»¶ç»Ÿè®¡ä¿¡æ¯ä¸º:\nEstablishing watches... Setting up watch(es) on . OK, . is now being watched. Total of 1 watches. Finished establishing watches, now collecting statistics. Will listen for events for 30 seconds. total modify create delete filename 15 4 8 3 ./ TODOï¼šç»Ÿè®¡ä¿¡æ¯ä¸å®é™…æ“ä½œæœ‰æ‰€ä¸ç¬¦ï¼Œç›®å‰ä¸æ¸…æ¥šä¸ºå•¥\n3. ä½¿ç”¨golangè°ƒç”¨inotify  https://github.com/fsnotify/fsnotify\n package main import ( \u0026#34;log\u0026#34; \u0026#34;github.com/fsnotify/fsnotify\u0026#34; ) func main() { watcher, err := fsnotify.NewWatcher() if err != nil { log.Fatal(err) } defer watcher.Close() done := make(chan bool) go func() { for { select { case event, ok := \u0026lt;-watcher.Events: if !ok { return } log.Println(\u0026#34;event:\u0026#34;, event) if event.Op\u0026amp;fsnotify.Write == fsnotify.Write { log.Println(\u0026#34;modified file:\u0026#34;, event.Name) } case err, ok := \u0026lt;-watcher.Errors: if !ok { return } log.Println(\u0026#34;error:\u0026#34;, err) } } }() err = watcher.Add(\u0026#34;/tmp/foo\u0026#34;) if err != nil { log.Fatal(err) } \u0026lt;-done } References https://juejin.cn/post/6988561056364757022\nhttps://www.infoq.cn/article/inotify-linux-file-system-event-monitoring\nhttps://www.cnblogs.com/centos2017/p/7896715.html\n","permalink":"http://yangchnet.github.io/Dessert/posts/linux/inotify/","summary":"1. ä»€ä¹ˆæ˜¯inotify Inotify APIæä¾›äº†ä¸€ç§ç›‘è§†æ–‡ä»¶ç³»ç»Ÿçš„æœºåˆ¶äº‹ä»¶ã€‚ Inotifyå¯ç”¨äºç›‘è§†å•ä¸ªæ–‡ä»¶æˆ–ç›‘è§†ç›®å½•ã€‚å½“ç›‘è§†ç›®å½•æ—¶ï¼ŒInotifyå°†è¿”å›ç›®å½•æœ¬èº«çš„äº‹ä»¶ï¼Œä»¥åŠå†…éƒ¨çš„æ–‡ä»¶ç›®å½•ã€‚\nç®€å•çš„è¯´ï¼Œå°±æ˜¯inotifyå¯ä»¥ä¸ºä½ ç›‘æ§æ–‡ä»¶ç³»ç»Ÿçš„å˜åŒ–ï¼Œåœ¨å‘ç”Ÿä¸€äº›äº‹ä»¶æ—¶é€šçŸ¥ä½ ã€‚\n2. å®éªŒ éœ€è¦å®‰è£…inotify-toolsåŒ…\n# archç³»ç»Ÿ yay -S inotify-tools inotify-toolsæä¾›äº†ä¸¤ä¸ªå‘½ä»¤ï¼šinotifywaitå’Œinotifywatch\n2.1 inotifywait å…ˆæ¥çœ‹inotifywait,å®ƒè¢«ç”¨æ¥\u0026quot;Wait for a particular event on a file or set of files.\u0026quot;, ä¹Ÿå°±æ˜¯è¯´ç­‰å¾…åœ¨æ–‡ä»¶ä¸Šçš„æŸäº›äº‹ä»¶å‘ç”Ÿã€‚ä½¿ç”¨inotifywait -hæŸ¥çœ‹å…¶æ”¯æŒçš„å‚æ•°ï¼š\n-h show this help info --exclude \u0026lt;pattern\u0026gt; æ’é™¤åŒ¹é…æ‰€ç»™æ­£åˆ™çš„æ‰€æœ‰äº‹ä»¶ --excludei \u0026lt;pattern\u0026gt; ç±»ä¼¼å‰ä¸€ä¸ªå‘½ä»¤ä½†éæ•æ„Ÿ --include \u0026lt;pattern\u0026gt; æ’é™¤é™¤åŒ¹é…æ­£åˆ™ä¹‹å¤–çš„æ‰€æœ‰äº‹ä»¶ --includei \u0026lt;pattern\u0026gt; ç±»ä¼¼å‰ä¸€ä¸ªå‘½ä»¤ä½†éæ•æ„Ÿ -m|--monitor åœ¨timeoutä¹‹å‰ä¿æŒç›‘å¬ï¼Œè‹¥ä¸è®¾ç½®æ­¤æ ‡å¿—ï¼Œinotifywaitå°†åœ¨ä¸€ä¸ªäº‹ä»¶åé€€å‡ºã€‚ -d|--daemon ç±»ä¼¼å‰ä¸€ä¸ªå‘½ä»¤ä½†åœ¨åå°è¿è¡Œï¼Œå°†æ—¥å¿—è¾“å‡ºåˆ°`--outfile`æ‰€æŒ‡å®šçš„æ–‡ä»¶ -P|--no-dereference ä¸è·Ÿè¸ªç¬¦å·é“¾æ¥ -r|--recursive é€’å½’çš„ç›‘å¬ã€ --fromfile \u0026lt;file\u0026gt; Read files to watch from \u0026lt;file\u0026gt; or `-' for stdin. -o|--outfile \u0026lt;file\u0026gt; è¾“å‡ºåˆ°\u0026lt;file\u0026gt;è€Œä¸æ˜¯æ ‡å‡†è¾“å‡º -s|--syslog å‘syslogå‘é€é”™è¯¯è€Œä¸æ˜¯Stderr -q|--quiet åªè¾“å‡ºäº‹ä»¶ -qq å•¥ä¹Ÿä¸è¾“å‡º --format \u0026lt;fmt\u0026gt; ä»¥ç‰¹å®šæ ¼å¼è¾“å‡º --no-newline åœ¨æ ¼å¼åŒ–è¾“å‡ºåä¸æ‰“å°æ¢è¡Œç¬¦ --timefmt \u0026lt;fmt\u0026gt; strftime-compatible format string for use with %T in --format string.","title":"inotify"},{"content":" æå®¢æ—¶é—´ã€ŠMySQLå®æˆ˜45è®²ã€‹ç¬”è®°\n MySQLçš„åŸºæœ¬ç»“æ„ å¤§ä½“æ¥è¯´ï¼ŒMySQL å¯ä»¥åˆ†ä¸º Server å±‚å’Œå­˜å‚¨å¼•æ“å±‚ä¸¤éƒ¨åˆ†ã€‚\nServer å±‚åŒ…æ‹¬è¿æ¥å™¨ã€æŸ¥è¯¢ç¼“å­˜ã€åˆ†æå™¨ã€ä¼˜åŒ–å™¨ã€æ‰§è¡Œå™¨ç­‰ï¼Œæ¶µç›– MySQL çš„å¤§å¤šæ•°æ ¸å¿ƒæœåŠ¡åŠŸèƒ½ï¼Œä»¥åŠæ‰€æœ‰çš„å†…ç½®å‡½æ•°ï¼ˆå¦‚æ—¥æœŸã€æ—¶é—´ã€æ•°å­¦å’ŒåŠ å¯†å‡½æ•°ç­‰ï¼‰ï¼Œæ‰€æœ‰è·¨å­˜å‚¨å¼•æ“çš„åŠŸèƒ½éƒ½åœ¨è¿™ä¸€å±‚å®ç°ï¼Œæ¯”å¦‚å­˜å‚¨è¿‡ç¨‹ã€è§¦å‘å™¨ã€è§†å›¾ç­‰ã€‚\nè€Œå­˜å‚¨å¼•æ“å±‚è´Ÿè´£æ•°æ®çš„å­˜å‚¨å’Œæå–ã€‚å…¶æ¶æ„æ¨¡å¼æ˜¯æ’ä»¶å¼çš„ï¼Œæ”¯æŒ InnoDBã€MyISAMã€Memory ç­‰å¤šä¸ªå­˜å‚¨å¼•æ“ã€‚\nç°åœ¨æœ€å¸¸ç”¨çš„å­˜å‚¨å¼•æ“æ˜¯ InnoDBï¼Œå®ƒä» MySQL 5.5.5 ç‰ˆæœ¬å¼€å§‹æˆä¸ºäº†é»˜è®¤å­˜å‚¨å¼•æ“ã€‚\nä»ä¸€æ¡æŸ¥è¯¢è¯­å¥çœ‹å„ä¸ªæ¨¡å—çš„æ‰§è¡Œè¿‡ç¨‹ å¯¹äºå¦‚ä¸‹è¯­å¥ï¼š\nmysql\u0026gt; select * from T where ID=10ï¼› è¿æ¥å™¨ ç¬¬ä¸€æ­¥ï¼Œä½ ä¼šå…ˆè¿æ¥åˆ°è¿™ä¸ªæ•°æ®åº“ä¸Šï¼Œè¿™æ—¶å€™æ¥å¾…ä½ çš„å°±æ˜¯è¿æ¥å™¨ã€‚è¿æ¥å™¨è´Ÿè´£è·Ÿå®¢æˆ·ç«¯å»ºç«‹è¿æ¥ã€è·å–æƒé™ã€ç»´æŒå’Œç®¡ç†è¿æ¥ã€‚è¿æ¥å‘½ä»¤ä¸€èˆ¬æ˜¯è¿™ä¹ˆå†™çš„ï¼š\nmysql -h$ip -P$port -u$user -p è¿™é‡Œè¦æ³¨æ„çš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼šä¸€ä¸ªç”¨æˆ·æˆåŠŸå»ºç«‹è¿æ¥åï¼Œå³ä½¿ä½ ç”¨ç®¡ç†å‘˜è´¦å·å¯¹è¿™ä¸ªç”¨æˆ·çš„æƒé™åšäº†ä¿®æ”¹ï¼Œä¹Ÿä¸ä¼šå½±å“å·²ç»å­˜åœ¨è¿æ¥çš„æƒé™ã€‚ä¿®æ”¹å®Œæˆåï¼Œåªæœ‰å†æ–°å»ºçš„è¿æ¥æ‰ä¼šä½¿ç”¨æ–°çš„æƒé™è®¾ç½®ã€‚\nå› ä¸ºä¸€ä¸ªè¿æ¥çš„æƒé™å®åœ¨ç”¨æˆ·åå¯†ç è®¤è¯é€šè¿‡åï¼Œè¿æ¥å™¨åˆ°æƒé™è¡¨ä¸­æŸ¥å‡ºçš„ï¼Œä¹‹åè¿™ä¸ªè¿æ¥é‡Œé¢çš„æƒé™åˆ¤æ–­é€»è¾‘ï¼Œéƒ½å°†ä¾èµ–äºæ­¤æ—¶è¯»åˆ°çš„æƒé™ã€‚\næŸ¥è¯¢ç¼“å­˜ è¿æ¥å»ºç«‹å®Œæˆåï¼Œä½ å°±å¯ä»¥æ‰§è¡Œ select è¯­å¥äº†ã€‚æ‰§è¡Œé€»è¾‘å°±ä¼šæ¥åˆ°ç¬¬äºŒæ­¥ï¼šæŸ¥è¯¢ç¼“å­˜ã€‚\nä¹‹å‰æ‰§è¡Œè¿‡çš„è¯­å¥åŠå…¶ç»“æœå¯èƒ½ä¼šä»¥ key-value å¯¹çš„å½¢å¼ï¼Œè¢«ç›´æ¥ç¼“å­˜åœ¨å†…å­˜ä¸­ã€‚key æ˜¯æŸ¥è¯¢çš„è¯­å¥ï¼Œvalue æ˜¯æŸ¥è¯¢çš„ç»“æœã€‚å¦‚æœåœ¨ç¼“å­˜ä¸­å¯ä»¥æ‰¾åˆ°æŸ¥è¯¢ç»“æœï¼Œå¯ä»¥ç›´æ¥è¿”å›ç»“æœï¼Œå¦‚æœæ‰¾ä¸åˆ°ï¼Œå°±ä¼šç»§ç»­åé¢çš„æ‰§è¡Œé˜¶æ®µã€‚\nä½†å¤§å¤šæ•°æƒ…å†µä¸‹ç¼“å­˜å¾€å¾€å¼Šå¤§äºåˆ©ï¼Œå› ä¸ºæŸ¥è¯¢ç¼“å­˜çš„å¤±æ•ˆéå¸¸é¢‘ç¹ï¼Œåªè¦æœ‰å¯¹ä¸€ä¸ªè¡¨çš„æ›´æ–°ï¼Œè¿™ä¸ªè¡¨ä¸Šæ‰€æœ‰çš„æŸ¥è¯¢ç¼“å­˜éƒ½ä¼šè¢«æ¸…ç©ºã€‚\nå¯ä»¥å°†query_cache_typeå‚æ•°è®¾ç½®ä¸ºDEMAND,è¿™æ ·å¯¹äºé»˜è®¤çš„SQLæŸ¥è¯¢è¯­å¥éƒ½ä¸ä½¿ç”¨ç¼“å­˜ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒMySQL 8.0 ç‰ˆæœ¬ç›´æ¥å°†æŸ¥è¯¢ç¼“å­˜çš„æ•´å—åŠŸèƒ½åˆ æ‰äº†ï¼Œä¹Ÿå°±æ˜¯è¯´ 8.0 å¼€å§‹å½»åº•æ²¡æœ‰è¿™ä¸ªåŠŸèƒ½äº†ã€‚\nåˆ†æå™¨ å¦‚æœæ²¡æœ‰å‘½ä¸­æŸ¥è¯¢ç¼“å­˜ï¼Œå°±è¦å¼€å§‹çœŸæ­£æ‰§è¡Œè¯­å¥äº†ã€‚é¦–å…ˆï¼ŒMySQL éœ€è¦çŸ¥é“ä½ è¦åšä»€ä¹ˆï¼Œå› æ­¤éœ€è¦å¯¹ SQL è¯­å¥åšè§£æã€‚\nåˆ†æå™¨å…ˆä¼šåšâ€œè¯æ³•åˆ†æâ€ã€‚ä½ è¾“å…¥çš„æ˜¯ç”±å¤šä¸ªå­—ç¬¦ä¸²å’Œç©ºæ ¼ç»„æˆçš„ä¸€æ¡ SQL è¯­å¥ï¼ŒMySQL éœ€è¦è¯†åˆ«å‡ºé‡Œé¢çš„å­—ç¬¦ä¸²åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Œä»£è¡¨ä»€ä¹ˆã€‚\nåšå®Œäº†è¿™äº›è¯†åˆ«ä»¥åï¼Œå°±è¦åšâ€œè¯­æ³•åˆ†æâ€ã€‚æ ¹æ®è¯æ³•åˆ†æçš„ç»“æœï¼Œè¯­æ³•åˆ†æå™¨ä¼šæ ¹æ®è¯­æ³•è§„åˆ™ï¼Œåˆ¤æ–­ä½ è¾“å…¥çš„è¿™ä¸ª SQL è¯­å¥æ˜¯å¦æ»¡è¶³ MySQL è¯­æ³•ã€‚\nä¼˜åŒ–å™¨ ç»è¿‡äº†åˆ†æå™¨ï¼ŒMySQL å°±çŸ¥é“ä½ è¦åšä»€ä¹ˆäº†ã€‚åœ¨å¼€å§‹æ‰§è¡Œä¹‹å‰ï¼Œè¿˜è¦å…ˆç»è¿‡ä¼˜åŒ–å™¨çš„å¤„ç†ã€‚\nä¼˜åŒ–å™¨ä¼šé€‰æ‹©æ‰§è¡Œæ•ˆç‡æœ€é«˜çš„æ–¹æ¡ˆã€‚\nä¼˜åŒ–å™¨é˜¶æ®µå®Œæˆåï¼Œè¿™ä¸ªè¯­å¥çš„æ‰§è¡Œæ–¹æ¡ˆå°±ç¡®å®šä¸‹æ¥äº†ï¼Œç„¶åè¿›å…¥æ‰§è¡Œå™¨é˜¶æ®µã€‚\næ‰§è¡Œå™¨ MySQL é€šè¿‡åˆ†æå™¨çŸ¥é“äº†ä½ è¦åšä»€ä¹ˆï¼Œé€šè¿‡ä¼˜åŒ–å™¨çŸ¥é“äº†è¯¥æ€ä¹ˆåšï¼Œäºæ˜¯å°±è¿›å…¥äº†æ‰§è¡Œå™¨é˜¶æ®µï¼Œå¼€å§‹æ‰§è¡Œè¯­å¥ã€‚\nå¼€å§‹æ‰§è¡Œçš„æ—¶å€™ï¼Œè¦å…ˆåˆ¤æ–­ä¸€ä¸‹ä½ å¯¹è¿™ä¸ªè¡¨ T æœ‰æ²¡æœ‰æ‰§è¡ŒæŸ¥è¯¢çš„æƒé™ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±ä¼šè¿”å›æ²¡æœ‰æƒé™çš„é”™è¯¯ã€‚\nå¦‚æœæœ‰æƒé™ï¼Œå°±æ‰“å¼€è¡¨ç»§ç»­æ‰§è¡Œã€‚æ‰“å¼€è¡¨çš„æ—¶å€™ï¼Œæ‰§è¡Œå™¨å°±ä¼šæ ¹æ®è¡¨çš„å¼•æ“å®šä¹‰ï¼Œå»ä½¿ç”¨è¿™ä¸ªå¼•æ“æä¾›çš„æ¥å£ã€‚\næ‰§è¡Œå™¨çš„æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š\n  è°ƒç”¨ InnoDB å¼•æ“æ¥å£å–è¿™ä¸ªè¡¨çš„ç¬¬ä¸€è¡Œï¼Œåˆ¤æ–­ ID å€¼æ˜¯ä¸æ˜¯ 10ï¼Œå¦‚æœä¸æ˜¯åˆ™è·³è¿‡ï¼Œå¦‚æœæ˜¯åˆ™å°†è¿™è¡Œå­˜åœ¨ç»“æœé›†ä¸­ï¼›\n  è°ƒç”¨å¼•æ“æ¥å£å–â€œä¸‹ä¸€è¡Œâ€ï¼Œé‡å¤ç›¸åŒçš„åˆ¤æ–­é€»è¾‘ï¼Œç›´åˆ°å–åˆ°è¿™ä¸ªè¡¨çš„æœ€åä¸€è¡Œã€‚\n  æ‰§è¡Œå™¨å°†ä¸Šè¿°éå†è¿‡ç¨‹ä¸­æ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„è¡Œç»„æˆçš„è®°å½•é›†ä½œä¸ºç»“æœé›†è¿”å›ç»™å®¢æˆ·ç«¯ã€‚\n  ","permalink":"http://yangchnet.github.io/Dessert/posts/%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%A6%82%E8%A7%88mysql%E7%AF%87mysql%E6%9E%B6%E6%9E%84/","summary":"æå®¢æ—¶é—´ã€ŠMySQLå®æˆ˜45è®²ã€‹ç¬”è®°\n MySQLçš„åŸºæœ¬ç»“æ„ å¤§ä½“æ¥è¯´ï¼ŒMySQL å¯ä»¥åˆ†ä¸º Server å±‚å’Œå­˜å‚¨å¼•æ“å±‚ä¸¤éƒ¨åˆ†ã€‚\nServer å±‚åŒ…æ‹¬è¿æ¥å™¨ã€æŸ¥è¯¢ç¼“å­˜ã€åˆ†æå™¨ã€ä¼˜åŒ–å™¨ã€æ‰§è¡Œå™¨ç­‰ï¼Œæ¶µç›– MySQL çš„å¤§å¤šæ•°æ ¸å¿ƒæœåŠ¡åŠŸèƒ½ï¼Œä»¥åŠæ‰€æœ‰çš„å†…ç½®å‡½æ•°ï¼ˆå¦‚æ—¥æœŸã€æ—¶é—´ã€æ•°å­¦å’ŒåŠ å¯†å‡½æ•°ç­‰ï¼‰ï¼Œæ‰€æœ‰è·¨å­˜å‚¨å¼•æ“çš„åŠŸèƒ½éƒ½åœ¨è¿™ä¸€å±‚å®ç°ï¼Œæ¯”å¦‚å­˜å‚¨è¿‡ç¨‹ã€è§¦å‘å™¨ã€è§†å›¾ç­‰ã€‚\nè€Œå­˜å‚¨å¼•æ“å±‚è´Ÿè´£æ•°æ®çš„å­˜å‚¨å’Œæå–ã€‚å…¶æ¶æ„æ¨¡å¼æ˜¯æ’ä»¶å¼çš„ï¼Œæ”¯æŒ InnoDBã€MyISAMã€Memory ç­‰å¤šä¸ªå­˜å‚¨å¼•æ“ã€‚\nç°åœ¨æœ€å¸¸ç”¨çš„å­˜å‚¨å¼•æ“æ˜¯ InnoDBï¼Œå®ƒä» MySQL 5.5.5 ç‰ˆæœ¬å¼€å§‹æˆä¸ºäº†é»˜è®¤å­˜å‚¨å¼•æ“ã€‚\nä»ä¸€æ¡æŸ¥è¯¢è¯­å¥çœ‹å„ä¸ªæ¨¡å—çš„æ‰§è¡Œè¿‡ç¨‹ å¯¹äºå¦‚ä¸‹è¯­å¥ï¼š\nmysql\u0026gt; select * from T where ID=10ï¼› è¿æ¥å™¨ ç¬¬ä¸€æ­¥ï¼Œä½ ä¼šå…ˆè¿æ¥åˆ°è¿™ä¸ªæ•°æ®åº“ä¸Šï¼Œè¿™æ—¶å€™æ¥å¾…ä½ çš„å°±æ˜¯è¿æ¥å™¨ã€‚è¿æ¥å™¨è´Ÿè´£è·Ÿå®¢æˆ·ç«¯å»ºç«‹è¿æ¥ã€è·å–æƒé™ã€ç»´æŒå’Œç®¡ç†è¿æ¥ã€‚è¿æ¥å‘½ä»¤ä¸€èˆ¬æ˜¯è¿™ä¹ˆå†™çš„ï¼š\nmysql -h$ip -P$port -u$user -p è¿™é‡Œè¦æ³¨æ„çš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼šä¸€ä¸ªç”¨æˆ·æˆåŠŸå»ºç«‹è¿æ¥åï¼Œå³ä½¿ä½ ç”¨ç®¡ç†å‘˜è´¦å·å¯¹è¿™ä¸ªç”¨æˆ·çš„æƒé™åšäº†ä¿®æ”¹ï¼Œä¹Ÿä¸ä¼šå½±å“å·²ç»å­˜åœ¨è¿æ¥çš„æƒé™ã€‚ä¿®æ”¹å®Œæˆåï¼Œåªæœ‰å†æ–°å»ºçš„è¿æ¥æ‰ä¼šä½¿ç”¨æ–°çš„æƒé™è®¾ç½®ã€‚\nå› ä¸ºä¸€ä¸ªè¿æ¥çš„æƒé™å®åœ¨ç”¨æˆ·åå¯†ç è®¤è¯é€šè¿‡åï¼Œè¿æ¥å™¨åˆ°æƒé™è¡¨ä¸­æŸ¥å‡ºçš„ï¼Œä¹‹åè¿™ä¸ªè¿æ¥é‡Œé¢çš„æƒé™åˆ¤æ–­é€»è¾‘ï¼Œéƒ½å°†ä¾èµ–äºæ­¤æ—¶è¯»åˆ°çš„æƒé™ã€‚\næŸ¥è¯¢ç¼“å­˜ è¿æ¥å»ºç«‹å®Œæˆåï¼Œä½ å°±å¯ä»¥æ‰§è¡Œ select è¯­å¥äº†ã€‚æ‰§è¡Œé€»è¾‘å°±ä¼šæ¥åˆ°ç¬¬äºŒæ­¥ï¼šæŸ¥è¯¢ç¼“å­˜ã€‚\nä¹‹å‰æ‰§è¡Œè¿‡çš„è¯­å¥åŠå…¶ç»“æœå¯èƒ½ä¼šä»¥ key-value å¯¹çš„å½¢å¼ï¼Œè¢«ç›´æ¥ç¼“å­˜åœ¨å†…å­˜ä¸­ã€‚key æ˜¯æŸ¥è¯¢çš„è¯­å¥ï¼Œvalue æ˜¯æŸ¥è¯¢çš„ç»“æœã€‚å¦‚æœåœ¨ç¼“å­˜ä¸­å¯ä»¥æ‰¾åˆ°æŸ¥è¯¢ç»“æœï¼Œå¯ä»¥ç›´æ¥è¿”å›ç»“æœï¼Œå¦‚æœæ‰¾ä¸åˆ°ï¼Œå°±ä¼šç»§ç»­åé¢çš„æ‰§è¡Œé˜¶æ®µã€‚\nä½†å¤§å¤šæ•°æƒ…å†µä¸‹ç¼“å­˜å¾€å¾€å¼Šå¤§äºåˆ©ï¼Œå› ä¸ºæŸ¥è¯¢ç¼“å­˜çš„å¤±æ•ˆéå¸¸é¢‘ç¹ï¼Œåªè¦æœ‰å¯¹ä¸€ä¸ªè¡¨çš„æ›´æ–°ï¼Œè¿™ä¸ªè¡¨ä¸Šæ‰€æœ‰çš„æŸ¥è¯¢ç¼“å­˜éƒ½ä¼šè¢«æ¸…ç©ºã€‚\nå¯ä»¥å°†query_cache_typeå‚æ•°è®¾ç½®ä¸ºDEMAND,è¿™æ ·å¯¹äºé»˜è®¤çš„SQLæŸ¥è¯¢è¯­å¥éƒ½ä¸ä½¿ç”¨ç¼“å­˜ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒMySQL 8.0 ç‰ˆæœ¬ç›´æ¥å°†æŸ¥è¯¢ç¼“å­˜çš„æ•´å—åŠŸèƒ½åˆ æ‰äº†ï¼Œä¹Ÿå°±æ˜¯è¯´ 8.0 å¼€å§‹å½»åº•æ²¡æœ‰è¿™ä¸ªåŠŸèƒ½äº†ã€‚\nåˆ†æå™¨ å¦‚æœæ²¡æœ‰å‘½ä¸­æŸ¥è¯¢ç¼“å­˜ï¼Œå°±è¦å¼€å§‹çœŸæ­£æ‰§è¡Œè¯­å¥äº†ã€‚é¦–å…ˆï¼ŒMySQL éœ€è¦çŸ¥é“ä½ è¦åšä»€ä¹ˆï¼Œå› æ­¤éœ€è¦å¯¹ SQL è¯­å¥åšè§£æã€‚\nåˆ†æå™¨å…ˆä¼šåšâ€œè¯æ³•åˆ†æâ€ã€‚ä½ è¾“å…¥çš„æ˜¯ç”±å¤šä¸ªå­—ç¬¦ä¸²å’Œç©ºæ ¼ç»„æˆçš„ä¸€æ¡ SQL è¯­å¥ï¼ŒMySQL éœ€è¦è¯†åˆ«å‡ºé‡Œé¢çš„å­—ç¬¦ä¸²åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Œä»£è¡¨ä»€ä¹ˆã€‚\nåšå®Œäº†è¿™äº›è¯†åˆ«ä»¥åï¼Œå°±è¦åšâ€œè¯­æ³•åˆ†æâ€ã€‚æ ¹æ®è¯æ³•åˆ†æçš„ç»“æœï¼Œè¯­æ³•åˆ†æå™¨ä¼šæ ¹æ®è¯­æ³•è§„åˆ™ï¼Œåˆ¤æ–­ä½ è¾“å…¥çš„è¿™ä¸ª SQL è¯­å¥æ˜¯å¦æ»¡è¶³ MySQL è¯­æ³•ã€‚\nä¼˜åŒ–å™¨ ç»è¿‡äº†åˆ†æå™¨ï¼ŒMySQL å°±çŸ¥é“ä½ è¦åšä»€ä¹ˆäº†ã€‚åœ¨å¼€å§‹æ‰§è¡Œä¹‹å‰ï¼Œè¿˜è¦å…ˆç»è¿‡ä¼˜åŒ–å™¨çš„å¤„ç†ã€‚","title":"æ¦‚è§ˆMySQLç¯‡ã€‡ï¼šMySQLæ¶æ„"},{"content":" æå®¢æ—¶é—´ã€Šæ¶ˆæ¯é˜Ÿåˆ—é«˜æ‰‹è¯¾ã€‹ç¬”è®°\n  æ¦‚è§ˆæ¶ˆæ¯é˜Ÿåˆ—ç¯‡ã€‡ï¼šä¸ºä»€ä¹ˆéœ€è¦æ¶ˆæ¯é˜Ÿåˆ— æ¦‚è§ˆæ¶ˆæ¯é˜Ÿåˆ—ç¯‡ä¸€ï¼šä¸åŒçš„mqçš„æ¶ˆæ¯æ¨¡å‹ æ¦‚è§ˆæ¶ˆæ¯é˜Ÿåˆ—ç¯‡äºŒï¼šå¦‚ä½•ç¡®ä¿æ¶ˆæ¯ä¸ä¸¢å¤± æ¦‚è§ˆæ¶ˆæ¯é˜Ÿåˆ—ç¯‡ä¸‰ï¼šé‡å¤æ¶ˆæ¯çš„å¤„ç†  1. ä¸»é¢˜å’Œé˜Ÿåˆ— æœ€åŸºæœ¬çš„é˜Ÿåˆ—æ¨¡å‹ï¼Œæ˜¯æŒ‰ç…§â€œé˜Ÿåˆ—â€çš„æ•°æ®ç»“æ„æ¥è®¾è®¡çš„ï¼Œå³å…ˆè¿›å…ˆå‡ºã€‚ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ï¼ˆå…¥é˜Ÿï¼‰ï¼Œæ¶ˆè´¹è€…è·å–æ¶ˆæ¯ï¼ˆå‡ºé˜Ÿï¼‰ã€‚\nå½“æœ‰å¤šä¸ªç”Ÿäº§è€…å¾€åŒä¸€ä¸ªé˜Ÿåˆ—ä¸­å‘é€æ¶ˆæ¯ï¼Œåˆ™è¿™ä¸ªé˜Ÿåˆ—ä¸­å¯ä»¥æ¶ˆè´¹åˆ°çš„æ¶ˆæ¯ï¼Œå°±æ˜¯è¿™äº›ç”Ÿäº§è€…ç”Ÿäº§çš„æ‰€æœ‰æ¶ˆæ¯çš„åˆé›†ã€‚æ¶ˆæ¯çš„é¡ºåºå°±æ˜¯è¿™äº›ç”Ÿäº§è€…å‘é€æ¶ˆæ¯çš„è‡ªç„¶é¡ºåºã€‚å¦‚æœæœ‰å¤šä¸ªæ¶ˆè´¹è€…æ¥æ”¶åŒä¸€ä¸ªé˜Ÿåˆ—çš„æ¶ˆæ¯ï¼Œè¿™äº›æ¶ˆè´¹è€…ä¹‹é—´å®é™…ä¸Šæ˜¯ç«äº‰çš„å…³ç³»ï¼Œæ¯ä¸ªæ¶ˆè´¹è€…åªèƒ½æ”¶åˆ°é˜Ÿåˆ—ä¸­çš„ä¸€éƒ¨åˆ†æ¶ˆæ¯ï¼Œä¹Ÿå°±æ˜¯è¯´ä»»ä½•ä¸€æ¡æ¶ˆæ¯åªèƒ½è¢«å…¶ä¸­çš„ä¸€ä¸ªæ¶ˆè´¹è€…æ”¶åˆ°ã€‚\nè¿™æ—¶å€™é—®é¢˜å°±å‡ºç°äº†ï¼Œå¦‚æœä¸€ä»½æ¶ˆæ¯éœ€è¦è¢«å¤šä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œæ¯”å¦‚ï¼Œå¯¹äºä¸€ä¸ªè®¢å•ï¼Œå®ƒéœ€è¦è¢«é£æ§ç³»ç»Ÿã€æ”¯ä»˜ç³»ç»Ÿç­‰ç³»ç»Ÿæ¶ˆè´¹ï¼Œæ˜¾ç„¶ä¸Šè¿°çš„æ¨¡å‹ä¸èƒ½æ»¡è¶³è¿™ä¸ªéœ€æ±‚ã€‚è¿™æ—¶å€™ä¸€ä¸ªå¯è¡Œçš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼šä¸ºæ¯ä¸ªæ¶ˆè´¹è€…åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„é˜Ÿåˆ—ï¼Œè®©ç”Ÿäº§è€…å‘é€å¤šä»½ã€‚\nä½†æ˜¾ç„¶è¿™æ ·ä¼šæµªè´¹è¾ƒå¤šçš„èµ„æºï¼ŒåŒä¸€ä¸ªæ¶ˆæ¯å¤åˆ¶äº†å¤šä»½ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œç”Ÿäº§è€…å¿…é¡»çŸ¥é“æœ‰å¤šå°‘ä¸ªæ¶ˆè´¹è€…ã€‚ä¸ºæ¯ä¸ªæ¶ˆè´¹è€…å•ç‹¬å‘é€ä¸€ä»½æ¶ˆæ¯ï¼Œè¿™å®é™…ä¸Šè¿èƒŒäº†æ¶ˆæ¯é˜Ÿåˆ—â€œè§£è€¦â€è¿™ä¸ªè®¾è®¡åˆè¡·ã€‚\nä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ¼”åŒ–å‡ºâ€œå‘å¸ƒ-è®¢é˜…â€(pub-sub)æ¨¡å‹ã€‚\nåœ¨å‘å¸ƒ-è®¢é˜…æ¨¡å‹ä¸­ï¼Œæ¶ˆæ¯çš„å‘é€æ–¹ç§°ä¸ºå‘å¸ƒè€…ï¼ˆPublisherï¼‰ï¼Œæ¶ˆæ¯çš„æ¥æ”¶æ–¹ç§°ä¸ºè®¢é˜…è€…ï¼ˆSubscriberï¼‰ï¼ŒæœåŠ¡ç«¯å­˜æ”¾æ¶ˆæ¯çš„å®¹å™¨ç§°ä¸ºä¸»é¢˜ï¼ˆTopicï¼‰ã€‚å‘å¸ƒè€…å°†æ¶ˆæ¯å‘é€åˆ°ä¸»é¢˜ä¸­ï¼Œè®¢é˜…è€…åœ¨æ¥æ”¶æ¶ˆæ¯ä¹‹å‰éœ€è¦å…ˆâ€œè®¢é˜…ä¸»é¢˜â€ã€‚â€œè®¢é˜…â€åœ¨è¿™é‡Œæ—¢æ˜¯ä¸€ä¸ªåŠ¨ä½œï¼ŒåŒæ—¶è¿˜å¯ä»¥è®¤ä¸ºæ˜¯ä¸»é¢˜åœ¨æ¶ˆè´¹æ—¶çš„ä¸€ä¸ªé€»è¾‘å‰¯æœ¬ï¼Œæ¯ä»½è®¢é˜…ä¸­ï¼Œè®¢é˜…è€…éƒ½å¯ä»¥æ¥æ”¶åˆ°ä¸»é¢˜çš„æ‰€æœ‰æ¶ˆæ¯ã€‚\nå½“å‘å¸ƒ-è®¢é˜…æ¨¡å‹ä¸­åªæœ‰ä¸€ä¸ªè®¢é˜…è€…æ—¶ï¼Œé‚£å®ƒå’Œé˜Ÿåˆ—æ¨¡å‹å°±åŸºæœ¬ä¸Šæ˜¯ä¸€æ ·çš„äº†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå‘å¸ƒ - è®¢é˜…æ¨¡å‹åœ¨åŠŸèƒ½å±‚é¢ä¸Šæ˜¯å¯ä»¥å…¼å®¹é˜Ÿåˆ—æ¨¡å‹çš„ã€‚\n2. å¸¸è§mqçš„æ¶ˆæ¯æ¨¡å‹ 2.1 RabbitMQçš„æ¶ˆæ¯æ¨¡å‹ RabbitMQæ˜¯å°‘æ•°ä»åšæŒä½¿ç”¨é˜Ÿåˆ—æ¨¡å‹çš„äº§å“ä¹‹ä¸€ã€‚\né‚£ä¹ˆRabbitMQæ˜¯å¦‚ä½•è§£å†³å¤šä¸ªæ¶ˆè´¹è€…çš„é—®é¢˜å‘¢ï¼Ÿ\nRabbitMQæœ‰ä¸€ä¸ªExchangeæ¨¡å—ï¼Œåœ¨ RabbitMQ ä¸­ï¼ŒExchange ä½äºç”Ÿäº§è€…å’Œé˜Ÿåˆ—ä¹‹é—´ï¼Œç”Ÿäº§è€…å¹¶ä¸å…³å¿ƒå°†æ¶ˆæ¯å‘é€ç»™å“ªä¸ªé˜Ÿåˆ—ï¼Œè€Œæ˜¯å°†æ¶ˆæ¯å‘é€ç»™ Exchangeï¼Œç”± Exchange ä¸Šé…ç½®çš„ç­–ç•¥æ¥å†³å®šå°†æ¶ˆæ¯æŠ•é€’åˆ°å“ªäº›é˜Ÿåˆ—ä¸­ã€‚\nåŒä¸€ä»½æ¶ˆæ¯å¦‚æœéœ€è¦è¢«å¤šä¸ªæ¶ˆè´¹è€…æ¥æ¶ˆè´¹ï¼Œéœ€è¦é…ç½® Exchange å°†æ¶ˆæ¯å‘é€åˆ°å¤šä¸ªé˜Ÿåˆ—ï¼Œæ¯ä¸ªé˜Ÿåˆ—ä¸­éƒ½å­˜æ”¾ä¸€ä»½å®Œæ•´çš„æ¶ˆæ¯æ•°æ®ï¼Œå¯ä»¥ä¸ºä¸€ä¸ªæ¶ˆè´¹è€…æä¾›æ¶ˆè´¹æœåŠ¡ã€‚\n2.2 RocketMQçš„æ¶ˆæ¯æ¨¡å‹ RocketMQ ä½¿ç”¨çš„æ¶ˆæ¯æ¨¡å‹æ˜¯æ ‡å‡†çš„å‘å¸ƒ-è®¢é˜…æ¨¡å‹\nä½†æ˜¯ï¼Œåœ¨ RocketMQ ä¹Ÿæœ‰é˜Ÿåˆ—ï¼ˆQueueï¼‰è¿™ä¸ªæ¦‚å¿µï¼Œå¹¶ä¸”é˜Ÿåˆ—åœ¨ RocketMQ ä¸­æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µï¼Œè¦äº†è§£é˜Ÿåˆ—åœ¨RocketMQä¸­çš„ä½œç”¨ï¼Œæˆ‘ä»¬é¦–å…ˆè¦äº†è§£æ¶ˆæ¯ç¡®è®¤æœºåˆ¶åŠå…¶å¸¦æ¥çš„é—®é¢˜\nä¸ºäº†ç¡®ä¿æ¶ˆæ¯ä¸ä¼šåœ¨ä¼ é€’è¿‡ç¨‹ä¸­ç”±äºç½‘ç»œæˆ–æœåŠ¡å™¨æ•…éšœä¸¢å¤±ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ä¸€èˆ¬é‡‡ç”¨â€œè¯·æ±‚-ç¡®è®¤â€æœºåˆ¶æ¥ç¡®è®¤æ¶ˆæ¯çš„æˆåŠŸæ¶ˆè´¹ã€‚æ¶ˆè´¹è€…åœ¨æˆåŠŸæ¶ˆè´¹ä¸€æ¡æ¶ˆæ¯ï¼Œå®Œæˆè‡ªå·±çš„ä¸šåŠ¡é€»è¾‘åï¼Œä¼šå‘é€ç¡®è®¤çµ¦æ¶ˆæ¯é˜Ÿåˆ—ã€‚æ¶ˆæ¯é˜Ÿåˆ—åªæœ‰æ”¶åˆ°ç¡®è®¤åï¼Œæ‰è®¤ä¸ºä¸€æ¡æ¶ˆæ¯è¢«æˆåŠŸæ¶ˆè´¹ã€‚\nè¿™ç§æœºåˆ¶å¾ˆå¥½åœ°ä¿è¯äº†æ¶ˆæ¯ä¼ é€’è¿‡ç¨‹ä¸­çš„å¯é æ€§ï¼Œä½†æ˜¯å…¶å¸¦æ¥å¦ä¸€ä¸ªé—®é¢˜ï¼šåœ¨æŸä¸€æ¡æ¶ˆæ¯è¢«æˆåŠŸæ¶ˆè´¹ä¹‹å‰ï¼Œä¸‹ä¸€æ¡æ¶ˆæ¯æ˜¯ä¸èƒ½è¢«æ¶ˆè´¹çš„ï¼Œå¦åˆ™å°±ä¼šå‡ºç°æ¶ˆæ¯ç©ºæ´ï¼Œè¿èƒŒäº†æœ‰åºæ€§è¿™ä¸ªåŸåˆ™ã€‚\nä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸ªä¸»é¢˜åœ¨ä»»æ„æ—¶åˆ»ï¼Œè‡³å¤šåªèƒ½æœ‰ä¸€ä¸ªæ¶ˆè´¹è€…å®ä¾‹åœ¨è¿›è¡Œæ¶ˆè´¹ï¼Œé‚£å°±æ²¡æ³•é€šè¿‡æ°´å¹³æ‰©å±•æ¶ˆè´¹è€…çš„æ•°é‡æ¥æå‡æ¶ˆè´¹ç«¯æ€»ä½“çš„æ¶ˆè´¹æ€§èƒ½ã€‚\nä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒRocketMQåœ¨ä¸»é¢˜ä¸‹å¢åŠ äº†é˜Ÿåˆ—çš„æ¦‚å¿µï¼Œæ¯ä¸ªä¸»é¢˜åŒ…å«å¤šä¸ªé˜Ÿåˆ—ï¼Œé€šè¿‡å¤šä¸ªé˜Ÿåˆ—æ¥å®ç°å¤šå®ä¾‹å¹¶è¡Œç”Ÿäº§å’Œæ¶ˆè´¹ã€‚\nRocketMQ åªåœ¨é˜Ÿåˆ—ä¸Šä¿è¯æ¶ˆæ¯çš„æœ‰åºæ€§ï¼Œä¸»é¢˜å±‚é¢æ˜¯æ— æ³•ä¿è¯æ¶ˆæ¯çš„ä¸¥æ ¼é¡ºåºçš„ã€‚\nRocketMQ ä¸­ï¼Œè®¢é˜…è€…çš„æ¦‚å¿µæ˜¯é€šè¿‡æ¶ˆè´¹ç»„ï¼ˆConsumer Groupï¼‰æ¥ä½“ç°çš„ã€‚æ¯ä¸ªæ¶ˆè´¹ç»„éƒ½æ¶ˆè´¹ä¸»é¢˜ä¸­ä¸€ä»½å®Œæ•´çš„æ¶ˆæ¯ï¼Œä¸åŒæ¶ˆè´¹ç»„ä¹‹é—´æ¶ˆè´¹è¿›åº¦å½¼æ­¤ä¸å—å½±å“ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ¡æ¶ˆæ¯è¢« Consumer Group1 æ¶ˆè´¹è¿‡ï¼Œä¹Ÿä¼šå†ç»™ Consumer Group2 æ¶ˆè´¹ã€‚\nåŒæ—¶ï¼Œä¸€ä¸ªæ¶ˆè´¹ç»„ä¸­åŒ…å«å¤šä¸ªæ¶ˆè´¹è€…ï¼ŒåŒä¸€ä¸ªç»„å†…çš„æ¶ˆè´¹è€…æ˜¯ç«äº‰æ¶ˆè´¹çš„å…³ç³»ï¼Œæ¯ä¸ªæ¶ˆè´¹è€…è´Ÿè´£æ¶ˆè´¹ç»„å†…çš„ä¸€éƒ¨åˆ†æ¶ˆæ¯ã€‚å¦‚æœä¸€æ¡æ¶ˆæ¯è¢«æ¶ˆè´¹è€… Consumer1 æ¶ˆè´¹äº†ï¼Œé‚£åŒç»„çš„å…¶ä»–æ¶ˆè´¹è€…å°±ä¸ä¼šå†æ”¶åˆ°è¿™æ¡æ¶ˆæ¯ã€‚\nåœ¨ Topic çš„æ¶ˆè´¹è¿‡ç¨‹ä¸­ï¼Œç”±äºæ¶ˆæ¯éœ€è¦è¢«ä¸åŒçš„ç»„è¿›è¡Œå¤šæ¬¡æ¶ˆè´¹ï¼Œæ‰€ä»¥æ¶ˆè´¹å®Œçš„æ¶ˆæ¯å¹¶ä¸ä¼šç«‹å³è¢«åˆ é™¤ï¼Œè¿™å°±éœ€è¦ RocketMQ ä¸ºæ¯ä¸ªæ¶ˆè´¹ç»„åœ¨æ¯ä¸ªé˜Ÿåˆ—ä¸Šç»´æŠ¤ä¸€ä¸ªæ¶ˆè´¹ä½ç½®ï¼ˆConsumer Offsetï¼‰ï¼Œè¿™ä¸ªä½ç½®ä¹‹å‰çš„æ¶ˆæ¯éƒ½è¢«æ¶ˆè´¹è¿‡ï¼Œä¹‹åçš„æ¶ˆæ¯éƒ½æ²¡æœ‰è¢«æ¶ˆè´¹è¿‡ï¼Œæ¯æˆåŠŸæ¶ˆè´¹ä¸€æ¡æ¶ˆæ¯ï¼Œæ¶ˆè´¹ä½ç½®å°±åŠ ä¸€ã€‚\n2.3 Kafkaçš„æ¶ˆæ¯æ¨¡å‹ Kafka çš„æ¶ˆæ¯æ¨¡å‹å’Œ RocketMQ æ˜¯å®Œå…¨ä¸€æ ·çš„ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯ï¼Œåœ¨ Kafka ä¸­ï¼Œé˜Ÿåˆ—è¿™ä¸ªæ¦‚å¿µçš„åç§°ä¸ä¸€æ ·ï¼ŒKafka ä¸­å¯¹åº”çš„åç§°æ˜¯â€œåˆ†åŒºï¼ˆPartitionï¼‰â€ï¼Œå«ä¹‰å’ŒåŠŸèƒ½æ˜¯æ²¡æœ‰ä»»ä½•åŒºåˆ«çš„ã€‚\n","permalink":"http://yangchnet.github.io/Dessert/posts/mq/%E6%A6%82%E8%A7%88%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E7%AF%87%E4%B8%80%E4%B8%8D%E5%90%8C%E7%9A%84mq%E7%9A%84%E6%B6%88%E6%81%AF%E6%A8%A1%E5%9E%8B/","summary":"æå®¢æ—¶é—´ã€Šæ¶ˆæ¯é˜Ÿåˆ—é«˜æ‰‹è¯¾ã€‹ç¬”è®°\n  æ¦‚è§ˆæ¶ˆæ¯é˜Ÿåˆ—ç¯‡ã€‡ï¼šä¸ºä»€ä¹ˆéœ€è¦æ¶ˆæ¯é˜Ÿåˆ— æ¦‚è§ˆæ¶ˆæ¯é˜Ÿåˆ—ç¯‡ä¸€ï¼šä¸åŒçš„mqçš„æ¶ˆæ¯æ¨¡å‹ æ¦‚è§ˆæ¶ˆæ¯é˜Ÿåˆ—ç¯‡äºŒï¼šå¦‚ä½•ç¡®ä¿æ¶ˆæ¯ä¸ä¸¢å¤± æ¦‚è§ˆæ¶ˆæ¯é˜Ÿåˆ—ç¯‡ä¸‰ï¼šé‡å¤æ¶ˆæ¯çš„å¤„ç†  1. ä¸»é¢˜å’Œé˜Ÿåˆ— æœ€åŸºæœ¬çš„é˜Ÿåˆ—æ¨¡å‹ï¼Œæ˜¯æŒ‰ç…§â€œé˜Ÿåˆ—â€çš„æ•°æ®ç»“æ„æ¥è®¾è®¡çš„ï¼Œå³å…ˆè¿›å…ˆå‡ºã€‚ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ï¼ˆå…¥é˜Ÿï¼‰ï¼Œæ¶ˆè´¹è€…è·å–æ¶ˆæ¯ï¼ˆå‡ºé˜Ÿï¼‰ã€‚\nå½“æœ‰å¤šä¸ªç”Ÿäº§è€…å¾€åŒä¸€ä¸ªé˜Ÿåˆ—ä¸­å‘é€æ¶ˆæ¯ï¼Œåˆ™è¿™ä¸ªé˜Ÿåˆ—ä¸­å¯ä»¥æ¶ˆè´¹åˆ°çš„æ¶ˆæ¯ï¼Œå°±æ˜¯è¿™äº›ç”Ÿäº§è€…ç”Ÿäº§çš„æ‰€æœ‰æ¶ˆæ¯çš„åˆé›†ã€‚æ¶ˆæ¯çš„é¡ºåºå°±æ˜¯è¿™äº›ç”Ÿäº§è€…å‘é€æ¶ˆæ¯çš„è‡ªç„¶é¡ºåºã€‚å¦‚æœæœ‰å¤šä¸ªæ¶ˆè´¹è€…æ¥æ”¶åŒä¸€ä¸ªé˜Ÿåˆ—çš„æ¶ˆæ¯ï¼Œè¿™äº›æ¶ˆè´¹è€…ä¹‹é—´å®é™…ä¸Šæ˜¯ç«äº‰çš„å…³ç³»ï¼Œæ¯ä¸ªæ¶ˆè´¹è€…åªèƒ½æ”¶åˆ°é˜Ÿåˆ—ä¸­çš„ä¸€éƒ¨åˆ†æ¶ˆæ¯ï¼Œä¹Ÿå°±æ˜¯è¯´ä»»ä½•ä¸€æ¡æ¶ˆæ¯åªèƒ½è¢«å…¶ä¸­çš„ä¸€ä¸ªæ¶ˆè´¹è€…æ”¶åˆ°ã€‚\nè¿™æ—¶å€™é—®é¢˜å°±å‡ºç°äº†ï¼Œå¦‚æœä¸€ä»½æ¶ˆæ¯éœ€è¦è¢«å¤šä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œæ¯”å¦‚ï¼Œå¯¹äºä¸€ä¸ªè®¢å•ï¼Œå®ƒéœ€è¦è¢«é£æ§ç³»ç»Ÿã€æ”¯ä»˜ç³»ç»Ÿç­‰ç³»ç»Ÿæ¶ˆè´¹ï¼Œæ˜¾ç„¶ä¸Šè¿°çš„æ¨¡å‹ä¸èƒ½æ»¡è¶³è¿™ä¸ªéœ€æ±‚ã€‚è¿™æ—¶å€™ä¸€ä¸ªå¯è¡Œçš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼šä¸ºæ¯ä¸ªæ¶ˆè´¹è€…åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„é˜Ÿåˆ—ï¼Œè®©ç”Ÿäº§è€…å‘é€å¤šä»½ã€‚\nä½†æ˜¾ç„¶è¿™æ ·ä¼šæµªè´¹è¾ƒå¤šçš„èµ„æºï¼ŒåŒä¸€ä¸ªæ¶ˆæ¯å¤åˆ¶äº†å¤šä»½ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œç”Ÿäº§è€…å¿…é¡»çŸ¥é“æœ‰å¤šå°‘ä¸ªæ¶ˆè´¹è€…ã€‚ä¸ºæ¯ä¸ªæ¶ˆè´¹è€…å•ç‹¬å‘é€ä¸€ä»½æ¶ˆæ¯ï¼Œè¿™å®é™…ä¸Šè¿èƒŒäº†æ¶ˆæ¯é˜Ÿåˆ—â€œè§£è€¦â€è¿™ä¸ªè®¾è®¡åˆè¡·ã€‚\nä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ¼”åŒ–å‡ºâ€œå‘å¸ƒ-è®¢é˜…â€(pub-sub)æ¨¡å‹ã€‚\nåœ¨å‘å¸ƒ-è®¢é˜…æ¨¡å‹ä¸­ï¼Œæ¶ˆæ¯çš„å‘é€æ–¹ç§°ä¸ºå‘å¸ƒè€…ï¼ˆPublisherï¼‰ï¼Œæ¶ˆæ¯çš„æ¥æ”¶æ–¹ç§°ä¸ºè®¢é˜…è€…ï¼ˆSubscriberï¼‰ï¼ŒæœåŠ¡ç«¯å­˜æ”¾æ¶ˆæ¯çš„å®¹å™¨ç§°ä¸ºä¸»é¢˜ï¼ˆTopicï¼‰ã€‚å‘å¸ƒè€…å°†æ¶ˆæ¯å‘é€åˆ°ä¸»é¢˜ä¸­ï¼Œè®¢é˜…è€…åœ¨æ¥æ”¶æ¶ˆæ¯ä¹‹å‰éœ€è¦å…ˆâ€œè®¢é˜…ä¸»é¢˜â€ã€‚â€œè®¢é˜…â€åœ¨è¿™é‡Œæ—¢æ˜¯ä¸€ä¸ªåŠ¨ä½œï¼ŒåŒæ—¶è¿˜å¯ä»¥è®¤ä¸ºæ˜¯ä¸»é¢˜åœ¨æ¶ˆè´¹æ—¶çš„ä¸€ä¸ªé€»è¾‘å‰¯æœ¬ï¼Œæ¯ä»½è®¢é˜…ä¸­ï¼Œè®¢é˜…è€…éƒ½å¯ä»¥æ¥æ”¶åˆ°ä¸»é¢˜çš„æ‰€æœ‰æ¶ˆæ¯ã€‚\nå½“å‘å¸ƒ-è®¢é˜…æ¨¡å‹ä¸­åªæœ‰ä¸€ä¸ªè®¢é˜…è€…æ—¶ï¼Œé‚£å®ƒå’Œé˜Ÿåˆ—æ¨¡å‹å°±åŸºæœ¬ä¸Šæ˜¯ä¸€æ ·çš„äº†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå‘å¸ƒ - è®¢é˜…æ¨¡å‹åœ¨åŠŸèƒ½å±‚é¢ä¸Šæ˜¯å¯ä»¥å…¼å®¹é˜Ÿåˆ—æ¨¡å‹çš„ã€‚\n2. å¸¸è§mqçš„æ¶ˆæ¯æ¨¡å‹ 2.1 RabbitMQçš„æ¶ˆæ¯æ¨¡å‹ RabbitMQæ˜¯å°‘æ•°ä»åšæŒä½¿ç”¨é˜Ÿåˆ—æ¨¡å‹çš„äº§å“ä¹‹ä¸€ã€‚\né‚£ä¹ˆRabbitMQæ˜¯å¦‚ä½•è§£å†³å¤šä¸ªæ¶ˆè´¹è€…çš„é—®é¢˜å‘¢ï¼Ÿ\nRabbitMQæœ‰ä¸€ä¸ªExchangeæ¨¡å—ï¼Œåœ¨ RabbitMQ ä¸­ï¼ŒExchange ä½äºç”Ÿäº§è€…å’Œé˜Ÿåˆ—ä¹‹é—´ï¼Œç”Ÿäº§è€…å¹¶ä¸å…³å¿ƒå°†æ¶ˆæ¯å‘é€ç»™å“ªä¸ªé˜Ÿåˆ—ï¼Œè€Œæ˜¯å°†æ¶ˆæ¯å‘é€ç»™ Exchangeï¼Œç”± Exchange ä¸Šé…ç½®çš„ç­–ç•¥æ¥å†³å®šå°†æ¶ˆæ¯æŠ•é€’åˆ°å“ªäº›é˜Ÿåˆ—ä¸­ã€‚\nåŒä¸€ä»½æ¶ˆæ¯å¦‚æœéœ€è¦è¢«å¤šä¸ªæ¶ˆè´¹è€…æ¥æ¶ˆè´¹ï¼Œéœ€è¦é…ç½® Exchange å°†æ¶ˆæ¯å‘é€åˆ°å¤šä¸ªé˜Ÿåˆ—ï¼Œæ¯ä¸ªé˜Ÿåˆ—ä¸­éƒ½å­˜æ”¾ä¸€ä»½å®Œæ•´çš„æ¶ˆæ¯æ•°æ®ï¼Œå¯ä»¥ä¸ºä¸€ä¸ªæ¶ˆè´¹è€…æä¾›æ¶ˆè´¹æœåŠ¡ã€‚\n2.2 RocketMQçš„æ¶ˆæ¯æ¨¡å‹ RocketMQ ä½¿ç”¨çš„æ¶ˆæ¯æ¨¡å‹æ˜¯æ ‡å‡†çš„å‘å¸ƒ-è®¢é˜…æ¨¡å‹\nä½†æ˜¯ï¼Œåœ¨ RocketMQ ä¹Ÿæœ‰é˜Ÿåˆ—ï¼ˆQueueï¼‰è¿™ä¸ªæ¦‚å¿µï¼Œå¹¶ä¸”é˜Ÿåˆ—åœ¨ RocketMQ ä¸­æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µï¼Œè¦äº†è§£é˜Ÿåˆ—åœ¨RocketMQä¸­çš„ä½œç”¨ï¼Œæˆ‘ä»¬é¦–å…ˆè¦äº†è§£æ¶ˆæ¯ç¡®è®¤æœºåˆ¶åŠå…¶å¸¦æ¥çš„é—®é¢˜\nä¸ºäº†ç¡®ä¿æ¶ˆæ¯ä¸ä¼šåœ¨ä¼ é€’è¿‡ç¨‹ä¸­ç”±äºç½‘ç»œæˆ–æœåŠ¡å™¨æ•…éšœä¸¢å¤±ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ä¸€èˆ¬é‡‡ç”¨â€œè¯·æ±‚-ç¡®è®¤â€æœºåˆ¶æ¥ç¡®è®¤æ¶ˆæ¯çš„æˆåŠŸæ¶ˆè´¹ã€‚æ¶ˆè´¹è€…åœ¨æˆåŠŸæ¶ˆè´¹ä¸€æ¡æ¶ˆæ¯ï¼Œå®Œæˆè‡ªå·±çš„ä¸šåŠ¡é€»è¾‘åï¼Œä¼šå‘é€ç¡®è®¤çµ¦æ¶ˆæ¯é˜Ÿåˆ—ã€‚æ¶ˆæ¯é˜Ÿåˆ—åªæœ‰æ”¶åˆ°ç¡®è®¤åï¼Œæ‰è®¤ä¸ºä¸€æ¡æ¶ˆæ¯è¢«æˆåŠŸæ¶ˆè´¹ã€‚\nè¿™ç§æœºåˆ¶å¾ˆå¥½åœ°ä¿è¯äº†æ¶ˆæ¯ä¼ é€’è¿‡ç¨‹ä¸­çš„å¯é æ€§ï¼Œä½†æ˜¯å…¶å¸¦æ¥å¦ä¸€ä¸ªé—®é¢˜ï¼šåœ¨æŸä¸€æ¡æ¶ˆæ¯è¢«æˆåŠŸæ¶ˆè´¹ä¹‹å‰ï¼Œä¸‹ä¸€æ¡æ¶ˆæ¯æ˜¯ä¸èƒ½è¢«æ¶ˆè´¹çš„ï¼Œå¦åˆ™å°±ä¼šå‡ºç°æ¶ˆæ¯ç©ºæ´ï¼Œè¿èƒŒäº†æœ‰åºæ€§è¿™ä¸ªåŸåˆ™ã€‚\nä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸ªä¸»é¢˜åœ¨ä»»æ„æ—¶åˆ»ï¼Œè‡³å¤šåªèƒ½æœ‰ä¸€ä¸ªæ¶ˆè´¹è€…å®ä¾‹åœ¨è¿›è¡Œæ¶ˆè´¹ï¼Œé‚£å°±æ²¡æ³•é€šè¿‡æ°´å¹³æ‰©å±•æ¶ˆè´¹è€…çš„æ•°é‡æ¥æå‡æ¶ˆè´¹ç«¯æ€»ä½“çš„æ¶ˆè´¹æ€§èƒ½ã€‚\nä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒRocketMQåœ¨ä¸»é¢˜ä¸‹å¢åŠ äº†é˜Ÿåˆ—çš„æ¦‚å¿µï¼Œæ¯ä¸ªä¸»é¢˜åŒ…å«å¤šä¸ªé˜Ÿåˆ—ï¼Œé€šè¿‡å¤šä¸ªé˜Ÿåˆ—æ¥å®ç°å¤šå®ä¾‹å¹¶è¡Œç”Ÿäº§å’Œæ¶ˆè´¹ã€‚\nRocketMQ åªåœ¨é˜Ÿåˆ—ä¸Šä¿è¯æ¶ˆæ¯çš„æœ‰åºæ€§ï¼Œä¸»é¢˜å±‚é¢æ˜¯æ— æ³•ä¿è¯æ¶ˆæ¯çš„ä¸¥æ ¼é¡ºåºçš„ã€‚\nRocketMQ ä¸­ï¼Œè®¢é˜…è€…çš„æ¦‚å¿µæ˜¯é€šè¿‡æ¶ˆè´¹ç»„ï¼ˆConsumer Groupï¼‰æ¥ä½“ç°çš„ã€‚æ¯ä¸ªæ¶ˆè´¹ç»„éƒ½æ¶ˆè´¹ä¸»é¢˜ä¸­ä¸€ä»½å®Œæ•´çš„æ¶ˆæ¯ï¼Œä¸åŒæ¶ˆè´¹ç»„ä¹‹é—´æ¶ˆè´¹è¿›åº¦å½¼æ­¤ä¸å—å½±å“ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ¡æ¶ˆæ¯è¢« Consumer Group1 æ¶ˆè´¹è¿‡ï¼Œä¹Ÿä¼šå†ç»™ Consumer Group2 æ¶ˆè´¹ã€‚\nåŒæ—¶ï¼Œä¸€ä¸ªæ¶ˆè´¹ç»„ä¸­åŒ…å«å¤šä¸ªæ¶ˆè´¹è€…ï¼ŒåŒä¸€ä¸ªç»„å†…çš„æ¶ˆè´¹è€…æ˜¯ç«äº‰æ¶ˆè´¹çš„å…³ç³»ï¼Œæ¯ä¸ªæ¶ˆè´¹è€…è´Ÿè´£æ¶ˆè´¹ç»„å†…çš„ä¸€éƒ¨åˆ†æ¶ˆæ¯ã€‚å¦‚æœä¸€æ¡æ¶ˆæ¯è¢«æ¶ˆè´¹è€… Consumer1 æ¶ˆè´¹äº†ï¼Œé‚£åŒç»„çš„å…¶ä»–æ¶ˆè´¹è€…å°±ä¸ä¼šå†æ”¶åˆ°è¿™æ¡æ¶ˆæ¯ã€‚\nåœ¨ Topic çš„æ¶ˆè´¹è¿‡ç¨‹ä¸­ï¼Œç”±äºæ¶ˆæ¯éœ€è¦è¢«ä¸åŒçš„ç»„è¿›è¡Œå¤šæ¬¡æ¶ˆè´¹ï¼Œæ‰€ä»¥æ¶ˆè´¹å®Œçš„æ¶ˆæ¯å¹¶ä¸ä¼šç«‹å³è¢«åˆ é™¤ï¼Œè¿™å°±éœ€è¦ RocketMQ ä¸ºæ¯ä¸ªæ¶ˆè´¹ç»„åœ¨æ¯ä¸ªé˜Ÿåˆ—ä¸Šç»´æŠ¤ä¸€ä¸ªæ¶ˆè´¹ä½ç½®ï¼ˆConsumer Offsetï¼‰ï¼Œè¿™ä¸ªä½ç½®ä¹‹å‰çš„æ¶ˆæ¯éƒ½è¢«æ¶ˆè´¹è¿‡ï¼Œä¹‹åçš„æ¶ˆæ¯éƒ½æ²¡æœ‰è¢«æ¶ˆè´¹è¿‡ï¼Œæ¯æˆåŠŸæ¶ˆè´¹ä¸€æ¡æ¶ˆæ¯ï¼Œæ¶ˆè´¹ä½ç½®å°±åŠ ä¸€ã€‚\n2.3 Kafkaçš„æ¶ˆæ¯æ¨¡å‹ Kafka çš„æ¶ˆæ¯æ¨¡å‹å’Œ RocketMQ æ˜¯å®Œå…¨ä¸€æ ·çš„ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯ï¼Œåœ¨ Kafka ä¸­ï¼Œé˜Ÿåˆ—è¿™ä¸ªæ¦‚å¿µçš„åç§°ä¸ä¸€æ ·ï¼ŒKafka ä¸­å¯¹åº”çš„åç§°æ˜¯â€œåˆ†åŒºï¼ˆPartitionï¼‰â€ï¼Œå«ä¹‰å’ŒåŠŸèƒ½æ˜¯æ²¡æœ‰ä»»ä½•åŒºåˆ«çš„ã€‚","title":"æ¦‚è§ˆæ¶ˆæ¯é˜Ÿåˆ—ç¯‡ä¸€ï¼šä¸åŒçš„mqçš„æ¶ˆæ¯æ¨¡å‹"},{"content":"1. Goæ±‡ç¼–åŸºç¡€  è¿™é‡Œåªä»‹ç»æœ¬æ–‡ä¼šç”¨åˆ°çš„è¯­æ³•\n 4ä¸ªè™šæ‹Ÿå¯„å­˜å™¨   FP: Frame pointerï¼šä¼ªFPå¯„å­˜å™¨å¯¹åº”å‡½æ•°çš„æ ˆå¸§æŒ‡é’ˆï¼Œä¸€èˆ¬ç”¨æ¥è®¿é—®å‡½æ•°çš„å‚æ•°å’Œè¿”å›å€¼ï¼›golangè¯­è¨€ä¸­ï¼Œå‡½æ•°çš„å‚æ•°å’Œè¿”å›å€¼ï¼Œå‡½æ•°ä¸­çš„å±€éƒ¨å˜é‡ï¼Œå‡½æ•°ä¸­è°ƒç”¨å­å‡½æ•°çš„å‚æ•°å’Œè¿”å›å€¼éƒ½æ˜¯å­˜å‚¨åœ¨æ ˆä¸­çš„ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸€æ®µæ ˆå†…å­˜ç§°ä¸ºæ ˆå¸§ï¼ˆframeï¼‰ï¼Œä¼ªFPå¯„å­˜å™¨å¯¹åº”æ ˆå¸§çš„åº•éƒ¨ï¼Œä½†æ˜¯ä¼ªFPåªåŒ…æ‹¬å‡½æ•°çš„å‚æ•°å’Œè¿”å›å€¼è¿™éƒ¨åˆ†å†…å­˜ï¼Œå…¶ä»–éƒ¨åˆ†ç”±ä¼ªSPå¯„å­˜å™¨è¡¨ç¤ºï¼›æ³¨æ„golangä¸­å‡½æ•°çš„è¿”å›å€¼ä¹Ÿæ˜¯é€šè¿‡æ ˆå¸§è¿”å›çš„ï¼Œè¿™ä¹Ÿæ˜¯golangå‡½æ•°å¯ä»¥æœ‰å¤šä¸ªè¿”å›å€¼çš„åŸå› ï¼›\n  PC: Program counterï¼šæŒ‡ä»¤è®¡æ•°å™¨ï¼Œç”¨äºåˆ†æ”¯å’Œè·³è½¬ï¼Œå®ƒæ˜¯æ±‡ç¼–çš„IPå¯„å­˜å™¨çš„åˆ«åï¼›\n  SB: Static base pointerï¼šä¸€èˆ¬ç”¨äºå£°æ˜å‡½æ•°æˆ–è€…å…¨å±€å˜é‡ï¼Œå¯¹åº”ä»£ç åŒºï¼ˆtextï¼‰å†…å­˜æ®µåº•éƒ¨ï¼›å¯è®¤ä¸ºæ˜¯å†…å­˜çš„èµ·æºï¼Œæ‰€ä»¥ç¬¦å·foo(SB)å°±æ˜¯åç§°fooä½œä¸ºå†…å­˜ä¸­çš„ä¸€ä¸ªåœ°å€ã€‚è¿™ç§å½¢å¼è¢«ç”¨äºå‘½åå…¨å±€å‡½æ•°å’Œæ•°æ®ï¼Œå¦‚æœå°†\u0026lt;\u0026gt;æ·»åŠ åˆ°åç§°ä¸­ï¼Œå¦‚foo\u0026lt;\u0026gt;(SB)ï¼Œåˆ™ä»£è¡¨æ­¤æ ‡è¯†ç¬¦åªåœ¨å½“å‰æºæ–‡ä»¶ä¸­å¯è§ã€‚å¯å¯¹åç§°æ·»åŠ åç§»é‡ï¼Œå¦‚foo+4(SB)æŒ‡fooå¼€å¤´ä¹‹åçš„å››ä¸ªå­—èŠ‚ã€‚\n  SP: Stack pointerï¼šæŒ‡å‘å½“å‰æ ˆå¸§çš„å±€éƒ¨å˜é‡çš„å¼€å§‹ä½ç½®ï¼Œä¸€èˆ¬ç”¨æ¥å¼•ç”¨å‡½æ•°çš„å±€éƒ¨å˜é‡ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„æ±‡ç¼–ä¸­ä¹Ÿæœ‰ä¸€ä¸ªSPå¯„å­˜å™¨ï¼Œå®ƒä»¬çš„åŒºåˆ«æ˜¯ï¼š1.ä¼ªSPå¯„å­˜å™¨æŒ‡å‘æ ˆå¸§ï¼ˆä¸åŒ…æ‹¬å‡½æ•°å‚æ•°å’Œè¿”å›å€¼éƒ¨åˆ†ï¼‰çš„åº•éƒ¨ï¼ŒçœŸSPå¯„å­˜å™¨å¯¹åº”æ ˆçš„é¡¶éƒ¨ï¼›æ‰€ä»¥ä¼ªSPå¯„å­˜å™¨ä¸€èˆ¬ç”¨äºå¯»å€å‡½æ•°å±€éƒ¨å˜é‡ï¼ŒçœŸSPå¯„å­˜å™¨ä¸€èˆ¬ç”¨äºè°ƒç”¨å­å‡½æ•°æ—¶ï¼Œå¯»å€å­å‡½æ•°çš„å‚æ•°å’Œè¿”å›å€¼ï¼ˆåé¢ä¼šæœ‰å…·ä½“ç¤ºä¾‹æ¼”ç¤ºï¼‰ï¼›2.å½“éœ€è¦åŒºåˆ†ä¼ªå¯„å­˜å™¨å’ŒçœŸå¯„å­˜å™¨çš„æ—¶å€™åªéœ€è¦è®°ä½ä¸€ç‚¹ï¼šä¼ªå¯„å­˜å™¨ä¸€èˆ¬éœ€è¦ä¸€ä¸ªæ ‡è¯†ç¬¦å’Œåç§»é‡ä¸ºå‰ç¼€ï¼Œå¦‚æœæ²¡æœ‰æ ‡è¯†ç¬¦å‰ç¼€åˆ™æ˜¯çœŸå¯„å­˜å™¨ã€‚æ¯”å¦‚(SP)ã€+8(SP)æ²¡æœ‰æ ‡è¯†ç¬¦å‰ç¼€ä¸ºçœŸSPå¯„å­˜å™¨ï¼Œè€Œa(SP)ã€b+8(SP)æœ‰æ ‡è¯†ç¬¦ä¸ºå‰ç¼€è¡¨ç¤ºä¼ªå¯„å­˜å™¨ï¼›\n  æ‰€æœ‰ç”¨æˆ·å®šä¹‰çš„ç¬¦å·éƒ½ä½œä¸ºåç§»é‡å†™å…¥ä¼ªå¯„å­˜å™¨ FPï¼ˆå‚æ•°å’Œå±€éƒ¨å˜é‡ï¼‰å’Œ SBï¼ˆå…¨å±€å˜é‡ï¼‰\nå¸¸é‡ Goæ±‡ç¼–è¯­è¨€ä¸­å¸¸é‡ä»¥$ç¾å…ƒç¬¦å·ä¸ºå‰ç¼€ã€‚å¸¸é‡çš„ç±»å‹æœ‰æ•´æ•°å¸¸é‡ã€æµ®ç‚¹æ•°å¸¸é‡ã€å­—ç¬¦å¸¸é‡å’Œå­—ç¬¦ä¸²å¸¸é‡ç­‰å‡ ç§ç±»å‹ã€‚\n$1 // åè¿›åˆ¶ $0xf4f8fcff // åå…­è¿›åˆ¶ $1.5 // æµ®ç‚¹æ•° $'a' // å­—ç¬¦ $\u0026quot;abcd\u0026quot; DATAæŒ‡ä»¤ DATAå‘½ä»¤ç”¨äºåˆå§‹åŒ–åŒ…å˜é‡ï¼ŒDATAå‘½ä»¤çš„è¯­æ³•å¦‚ä¸‹ï¼š\nDATA symbol+offset(SB)/width, value å…¶ä¸­symbolä¸ºå˜é‡åœ¨æ±‡ç¼–è¯­è¨€ä¸­å¯¹åº”çš„æ ‡è¯†ç¬¦ï¼Œoffsetæ˜¯ç¬¦å·å¼€å§‹åœ°å€çš„åç§»é‡ï¼Œwidthæ˜¯è¦åˆå§‹åŒ–å†…å­˜çš„å®½åº¦å¤§å°ï¼Œvalueæ˜¯è¦åˆå§‹åŒ–çš„å€¼ã€‚å…¶ä¸­å½“å‰åŒ…ä¸­Goè¯­è¨€å®šä¹‰çš„ç¬¦å·symbolï¼Œåœ¨æ±‡ç¼–ä»£ç ä¸­å¯¹åº”Â·symbolï¼Œå…¶ä¸­Â·ä¸­ç‚¹ç¬¦å·ä¸ºä¸€ä¸ªç‰¹æ®Šçš„unicodeç¬¦å·ï¼›DATAå‘½ä»¤ç¤ºä¾‹å¦‚ä¸‹\nDATA Â·Id+0(SB)/1,$0x37 DATA Â·Id+1(SB)/1,$0x25 è¿™ä¸¤æ¡æŒ‡ä»¤çš„å«ä¹‰æ˜¯å°†å…¨å±€å˜é‡Idèµ‹å€¼ä¸º16è¿›åˆ¶æ•°0x2537ï¼Œä¹Ÿå°±æ˜¯åè¿›åˆ¶çš„9527ï¼› æˆ‘ä»¬ä¹Ÿå¯ä»¥åˆå¹¶æˆä¸€æ¡æŒ‡ä»¤\nGLOBL ç”¨äºå°†ç¬¦å·å¯¼å‡ºï¼Œä¾‹å¦‚å°†å…¨å±€å˜é‡å¯¼å‡ºï¼ˆæ‰€è°“å¯¼å‡ºå°±æ˜¯æŠŠæ±‡ç¼–ä¸­çš„å…¨å±€å˜é‡å¯¼å‡ºåˆ°goä»£ç ä¸­å£°æ˜çš„ç›¸åŒå˜é‡ä¸Šï¼Œå¦åˆ™goä»£ç ä¸­å£°æ˜çš„å˜é‡æ„ŸçŸ¥ä¸åˆ°æ±‡ç¼–ä¸­å˜é‡çš„å€¼çš„å˜åŒ–ï¼‰ï¼Œå…¶è¯­æ³•å¦‚ä¸‹ï¼š\nGLOBL symbol(SB), width å…¶ä¸­symbolå¯¹åº”æ±‡ç¼–ä¸­ç¬¦å·çš„åå­—ï¼Œwidthä¸ºç¬¦å·å¯¹åº”å†…å­˜çš„å¤§å°ï¼›GLOBLå‘½ä»¤ç¤ºä¾‹å¦‚ä¸‹ï¼š GLOBL Â·Id, $8è¿™æ¡æŒ‡ä»¤çš„å«ä¹‰æ˜¯å¯¼å‡ºä¸€ä¸ªå…¨å±€å˜é‡Idï¼Œå…¶å¤§å°æ˜¯8å­—èŠ‚ï¼ˆbyteï¼‰ï¼› ç»“åˆDATAå’ŒGLOBLæŒ‡ä»¤ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆå§‹åŒ–å¹¶å¯¼å‡ºä¸€ä¸ªå…¨å±€å˜é‡.ä¾‹å¦‚ï¼š\nGLOBL Â·Id, $8 DATA Â·Id+0(SB)/8,$0x12345 2. åŸºæœ¬æ•°æ®ç±»å‹ å»ºç«‹å¦‚ä¸‹æ–‡ä»¶ç»“æ„ï¼š\nâ”œâ”€â”€ main.go â”œâ”€â”€ go.mod â””â”€â”€ pkg â”œâ”€â”€ pkg_amd64.s â””â”€â”€ pkg.go int æ–‡ä»¶å†…å®¹å¦‚ä¸‹:\n// pkg/pkg_amd64.s #include \u0026quot;textflag.h\u0026quot; // ä½¿ç”¨NOPTRæ ‡å¿—æ—¶å¿…é¡»å¯¼å…¥æ­¤æ–‡ä»¶ï¼Œæ­¤æ–‡ä»¶ä½ç½®åœ¨ï¼š$GOROOT/src/runtime/textflag.h // var MyInt int = 1234 GLOBL Â·MyInt(SB),NOPTR,$8 // å¯¼å‡ºMyInt,NOPTRè¡¨æ˜ä¸åŒ…å«æŒ‡é’ˆ DATA Â·MyInt+0(SB)/8,$1234 // å®šä¹‰äº†ä¸€ä¸ª8å­—èŠ‚çš„æ•°æ®ï¼Œå€¼ä¸º1234 // pkg/pkg.go  package pkg var MyInt int // main.go  package main import ( \u0026#34;simple-go/pkg\u0026#34; ) func main() { println(MyInt) } è¿è¡Œmain.goå¯å¾—åˆ°MyIntçš„å€¼ä¸º1234\nfloat // pkg/pkg_amd64.s #include \u0026quot;textflag.h\u0026quot; GLOBL Â·MyFloat64(SB),NOPTR,$8 DATA Â·MyFloat64+0(SB)/8,$0.01 // pkg.go  var MyFloat64 float64 string é¦–å…ˆéœ€è¦äº†è§£ä¸€ä¸‹å­—ç¬¦ä¸²çš„å†…éƒ¨æ ‡è¯†\n// $GOROOT/src/runtime/string.go type stringStruct struct { str unsafe.Pointer len int } å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦é¦–å…ˆå®šä¹‰å­—ç¬¦æ•°æ®ï¼Œå†å°†å­—ç¬¦ä¸²çš„stræŒ‡å‘è¿™ä¸ªå­—ç¬¦æ•°æ®\n// pkg/pkg_amd64.s GLOBL NameData\u0026lt;\u0026gt;(SB),NOPTR,$8 DATA NameData\u0026lt;\u0026gt;(SB)/8,$\u0026quot;abc\u0026quot; // å®šä¹‰ä¸€ä¸ªéå¯¼å‡ºçš„æ•°æ®NameData\u0026lt;\u0026gt;(SB),sizeä¸º8å­—èŠ‚ GLOBL Â·MyStr0(SB),NOPTR,$16 DATA Â·MyStr0+0(SB)/8,$NameData\u0026lt;\u0026gt;(SB) // MyStrçš„å‰8ä¸ªå­—èŠ‚å†…å®¹ä¸ºNameData\u0026lt;\u0026gt;(SB) DATA Â·MyStr0+8(SB)/8,$3 // å8ä¸ªå­—èŠ‚ä¸º3,ä»£è¡¨å­—ç¬¦ä¸²é•¿åº¦ // pkg/pkg.go  var MyString string bool // pkg/pkg_amd64.s GLOBL Â·MyBool(SB),NOPTR,$1 DATA Â·MyBool+0(SB)/1,$1 // pkg/pkg.go  var MyBool bool *int // é¦–å…ˆå®šä¹‰ä¸€ä¸ªintå˜é‡ GLOBL IntData\u0026lt;\u0026gt;(SB),NOPTR,$8 DATA IntData\u0026lt;\u0026gt;(SB)/8,$9876 // å°†æŒ‡é’ˆæŒ‡å‘intå˜é‡ GLOBL Â·MyIntPtr(SB),NOPTR,$8 DATA Â·MyIntPtr+0(SB)/8,$IntData\u0026lt;\u0026gt;(SB) var MyIntPtr *int 3. å¤åˆæ•°æ®ç±»å‹ æ•°ç»„ // pkg/pkg_amd64.s // array [2]int = {12, 34} GLOBL Â·MyArray(SB),NOPTR,$16 DATA Â·MyArray+0(SB)/8,$12 DATA Â·MyArray+8(SB)/8,$34 // pkg/pkg.go  var MyArray [2]int åˆ‡ç‰‡ é¦–å…ˆéœ€è¦äº†è§£åˆ‡ç‰‡çš„å†…éƒ¨ç»“æ„\n// $GOROOT/src/runtime/slice.go type slice struct { array unsafe.Pointer len int cap int } åˆ‡ç‰‡æ˜¯æˆªå–æ•°ç»„çš„ä¸€éƒ¨åˆ†å¾—æ¥çš„ï¼Œå› æ­¤è¦å…ˆå®šä¹‰ä¸€ä¸ªæ•°ç»„ï¼Œç„¶åå°†åˆ‡ç‰‡çš„arrayæŒ‡é’ˆæŒ‡å‘è¿™ä¸ªæ•°ç»„çš„æŸä¸ªåç§»\n// pkg/pkg_amd64.s // å®šä¹‰ä¸‰ä¸ªstringä¸´æ—¶å˜é‡ï¼Œä½œä¸ºåˆ‡ç‰‡å…ƒç´  GLOBL str0\u0026lt;\u0026gt;(SB),NOPTR,$40 DATA str0\u0026lt;\u0026gt;(SB)/40,$\u0026quot;Thoughts in the Still of the Night\u0026quot; GLOBL str1\u0026lt;\u0026gt;(SB),NOPTR,$40 DATA str1\u0026lt;\u0026gt;(SB)/40,$\u0026quot;A pool of moonlight before the bed\u0026quot; GLOBL str2\u0026lt;\u0026gt;(SB),NOPTR,$8 DATA str2\u0026lt;\u0026gt;(SB)/8,$\u0026quot;libai\u0026quot; // å®šä¹‰ä¸€ä¸ª[3]stringçš„æ•°ç»„ï¼Œå…ƒç´ å°±æ˜¯ä¸Šé¢çš„ä¸‰ä¸ªstringå˜é‡ GLOBL strarray\u0026lt;\u0026gt;(SB),NOPTR,$48 DATA strarray\u0026lt;\u0026gt;+0(SB)/8,$str0\u0026lt;\u0026gt;(SB) DATA strarray\u0026lt;\u0026gt;+8(SB)/8,$34 DATA strarray\u0026lt;\u0026gt;+16(SB)/8,$str1\u0026lt;\u0026gt;(SB) DATA strarray\u0026lt;\u0026gt;+24(SB)/8,$34 DATA strarray\u0026lt;\u0026gt;+32(SB)/8,$str2\u0026lt;\u0026gt;(SB) DATA strarray\u0026lt;\u0026gt;+40(SB)/8,$5 // var MySlice []string GLOBL Â·MySlice(SB),NOPTR,$24 // ä¸Šé¢[3]stringæ•°ç»„çš„é¦–åœ°å€ç”¨æ¥åˆå§‹åŒ–åˆ‡ç‰‡çš„Dataå­—æ®µ DATA Â·MySlice+0(SB)/8,$strarray\u0026lt;\u0026gt;(SB) DATA Â·MySlice+8(SB)/8,$3 DATA Â·MySlice+16(SB)/8,$4 ä¸Šé¢çš„åˆ‡ç‰‡æ˜¯æˆªå–äº†å…¨éƒ¨çš„æ•°ç»„å…ƒç´ ï¼Œå¦‚æœæƒ³è¦ä»ç¬¬äºŒä¸ªå¼€å§‹æˆªå–ï¼Œå¯å¢åŠ åç§»ï¼š\nDATA Â·MySlice+0(SB)/8,$strarray\u0026lt;\u0026gt;+16(SB) map/chan map/channelç­‰ç±»å‹å¹¶æ²¡æœ‰å…¬å¼€çš„å†…éƒ¨ç»“æ„ï¼Œå®ƒä»¬åªæ˜¯ä¸€ç§æœªçŸ¥ç±»å‹çš„æŒ‡é’ˆï¼Œæ— æ³•ç›´æ¥åˆå§‹åŒ–ã€‚åœ¨æ±‡ç¼–ä»£ç ä¸­æˆ‘ä»¬åªèƒ½ä¸ºç±»ä¼¼å˜é‡å®šä¹‰å¹¶è¿›è¡Œ0å€¼åˆå§‹åŒ–ï¼š\nvar m map[string]int var ch chan int GLOBL Â·m(SB),$8 // var m map[string]int DATA Â·m+0(SB)/8,$0 GLOBL Â·ch(SB),$8 // var ch chan int DATA Â·ch+0(SB)/8,$0 References Golangå­¦ä¹ ç¬”è®°-æ±‡ç¼–\nmapçš„å®ç°åŸç†\nchan\nA Quick Guide to Go\u0026rsquo;s Assembler\nGoè¯­è¨€é«˜çº§ç¼–ç¨‹\n","permalink":"http://yangchnet.github.io/Dessert/posts/golang/go%E6%B1%87%E7%BC%96%E4%B9%8B%E5%AE%9A%E4%B9%89%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/","summary":"1. Goæ±‡ç¼–åŸºç¡€  è¿™é‡Œåªä»‹ç»æœ¬æ–‡ä¼šç”¨åˆ°çš„è¯­æ³•\n 4ä¸ªè™šæ‹Ÿå¯„å­˜å™¨   FP: Frame pointerï¼šä¼ªFPå¯„å­˜å™¨å¯¹åº”å‡½æ•°çš„æ ˆå¸§æŒ‡é’ˆï¼Œä¸€èˆ¬ç”¨æ¥è®¿é—®å‡½æ•°çš„å‚æ•°å’Œè¿”å›å€¼ï¼›golangè¯­è¨€ä¸­ï¼Œå‡½æ•°çš„å‚æ•°å’Œè¿”å›å€¼ï¼Œå‡½æ•°ä¸­çš„å±€éƒ¨å˜é‡ï¼Œå‡½æ•°ä¸­è°ƒç”¨å­å‡½æ•°çš„å‚æ•°å’Œè¿”å›å€¼éƒ½æ˜¯å­˜å‚¨åœ¨æ ˆä¸­çš„ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸€æ®µæ ˆå†…å­˜ç§°ä¸ºæ ˆå¸§ï¼ˆframeï¼‰ï¼Œä¼ªFPå¯„å­˜å™¨å¯¹åº”æ ˆå¸§çš„åº•éƒ¨ï¼Œä½†æ˜¯ä¼ªFPåªåŒ…æ‹¬å‡½æ•°çš„å‚æ•°å’Œè¿”å›å€¼è¿™éƒ¨åˆ†å†…å­˜ï¼Œå…¶ä»–éƒ¨åˆ†ç”±ä¼ªSPå¯„å­˜å™¨è¡¨ç¤ºï¼›æ³¨æ„golangä¸­å‡½æ•°çš„è¿”å›å€¼ä¹Ÿæ˜¯é€šè¿‡æ ˆå¸§è¿”å›çš„ï¼Œè¿™ä¹Ÿæ˜¯golangå‡½æ•°å¯ä»¥æœ‰å¤šä¸ªè¿”å›å€¼çš„åŸå› ï¼›\n  PC: Program counterï¼šæŒ‡ä»¤è®¡æ•°å™¨ï¼Œç”¨äºåˆ†æ”¯å’Œè·³è½¬ï¼Œå®ƒæ˜¯æ±‡ç¼–çš„IPå¯„å­˜å™¨çš„åˆ«åï¼›\n  SB: Static base pointerï¼šä¸€èˆ¬ç”¨äºå£°æ˜å‡½æ•°æˆ–è€…å…¨å±€å˜é‡ï¼Œå¯¹åº”ä»£ç åŒºï¼ˆtextï¼‰å†…å­˜æ®µåº•éƒ¨ï¼›å¯è®¤ä¸ºæ˜¯å†…å­˜çš„èµ·æºï¼Œæ‰€ä»¥ç¬¦å·foo(SB)å°±æ˜¯åç§°fooä½œä¸ºå†…å­˜ä¸­çš„ä¸€ä¸ªåœ°å€ã€‚è¿™ç§å½¢å¼è¢«ç”¨äºå‘½åå…¨å±€å‡½æ•°å’Œæ•°æ®ï¼Œå¦‚æœå°†\u0026lt;\u0026gt;æ·»åŠ åˆ°åç§°ä¸­ï¼Œå¦‚foo\u0026lt;\u0026gt;(SB)ï¼Œåˆ™ä»£è¡¨æ­¤æ ‡è¯†ç¬¦åªåœ¨å½“å‰æºæ–‡ä»¶ä¸­å¯è§ã€‚å¯å¯¹åç§°æ·»åŠ åç§»é‡ï¼Œå¦‚foo+4(SB)æŒ‡fooå¼€å¤´ä¹‹åçš„å››ä¸ªå­—èŠ‚ã€‚\n  SP: Stack pointerï¼šæŒ‡å‘å½“å‰æ ˆå¸§çš„å±€éƒ¨å˜é‡çš„å¼€å§‹ä½ç½®ï¼Œä¸€èˆ¬ç”¨æ¥å¼•ç”¨å‡½æ•°çš„å±€éƒ¨å˜é‡ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„æ±‡ç¼–ä¸­ä¹Ÿæœ‰ä¸€ä¸ªSPå¯„å­˜å™¨ï¼Œå®ƒä»¬çš„åŒºåˆ«æ˜¯ï¼š1.ä¼ªSPå¯„å­˜å™¨æŒ‡å‘æ ˆå¸§ï¼ˆä¸åŒ…æ‹¬å‡½æ•°å‚æ•°å’Œè¿”å›å€¼éƒ¨åˆ†ï¼‰çš„åº•éƒ¨ï¼ŒçœŸSPå¯„å­˜å™¨å¯¹åº”æ ˆçš„é¡¶éƒ¨ï¼›æ‰€ä»¥ä¼ªSPå¯„å­˜å™¨ä¸€èˆ¬ç”¨äºå¯»å€å‡½æ•°å±€éƒ¨å˜é‡ï¼ŒçœŸSPå¯„å­˜å™¨ä¸€èˆ¬ç”¨äºè°ƒç”¨å­å‡½æ•°æ—¶ï¼Œå¯»å€å­å‡½æ•°çš„å‚æ•°å’Œè¿”å›å€¼ï¼ˆåé¢ä¼šæœ‰å…·ä½“ç¤ºä¾‹æ¼”ç¤ºï¼‰ï¼›2.å½“éœ€è¦åŒºåˆ†ä¼ªå¯„å­˜å™¨å’ŒçœŸå¯„å­˜å™¨çš„æ—¶å€™åªéœ€è¦è®°ä½ä¸€ç‚¹ï¼šä¼ªå¯„å­˜å™¨ä¸€èˆ¬éœ€è¦ä¸€ä¸ªæ ‡è¯†ç¬¦å’Œåç§»é‡ä¸ºå‰ç¼€ï¼Œå¦‚æœæ²¡æœ‰æ ‡è¯†ç¬¦å‰ç¼€åˆ™æ˜¯çœŸå¯„å­˜å™¨ã€‚æ¯”å¦‚(SP)ã€+8(SP)æ²¡æœ‰æ ‡è¯†ç¬¦å‰ç¼€ä¸ºçœŸSPå¯„å­˜å™¨ï¼Œè€Œa(SP)ã€b+8(SP)æœ‰æ ‡è¯†ç¬¦ä¸ºå‰ç¼€è¡¨ç¤ºä¼ªå¯„å­˜å™¨ï¼›\n  æ‰€æœ‰ç”¨æˆ·å®šä¹‰çš„ç¬¦å·éƒ½ä½œä¸ºåç§»é‡å†™å…¥ä¼ªå¯„å­˜å™¨ FPï¼ˆå‚æ•°å’Œå±€éƒ¨å˜é‡ï¼‰å’Œ SBï¼ˆå…¨å±€å˜é‡ï¼‰\nå¸¸é‡ Goæ±‡ç¼–è¯­è¨€ä¸­å¸¸é‡ä»¥$ç¾å…ƒç¬¦å·ä¸ºå‰ç¼€ã€‚å¸¸é‡çš„ç±»å‹æœ‰æ•´æ•°å¸¸é‡ã€æµ®ç‚¹æ•°å¸¸é‡ã€å­—ç¬¦å¸¸é‡å’Œå­—ç¬¦ä¸²å¸¸é‡ç­‰å‡ ç§ç±»å‹ã€‚\n$1 // åè¿›åˆ¶ $0xf4f8fcff // åå…­è¿›åˆ¶ $1.5 // æµ®ç‚¹æ•° $'a' // å­—ç¬¦ $\u0026quot;abcd\u0026quot; DATAæŒ‡ä»¤ DATAå‘½ä»¤ç”¨äºåˆå§‹åŒ–åŒ…å˜é‡ï¼ŒDATAå‘½ä»¤çš„è¯­æ³•å¦‚ä¸‹ï¼š\nDATA symbol+offset(SB)/width, value å…¶ä¸­symbolä¸ºå˜é‡åœ¨æ±‡ç¼–è¯­è¨€ä¸­å¯¹åº”çš„æ ‡è¯†ç¬¦ï¼Œoffsetæ˜¯ç¬¦å·å¼€å§‹åœ°å€çš„åç§»é‡ï¼Œwidthæ˜¯è¦åˆå§‹åŒ–å†…å­˜çš„å®½åº¦å¤§å°ï¼Œvalueæ˜¯è¦åˆå§‹åŒ–çš„å€¼ã€‚å…¶ä¸­å½“å‰åŒ…ä¸­Goè¯­è¨€å®šä¹‰çš„ç¬¦å·symbolï¼Œåœ¨æ±‡ç¼–ä»£ç ä¸­å¯¹åº”Â·symbolï¼Œå…¶ä¸­Â·ä¸­ç‚¹ç¬¦å·ä¸ºä¸€ä¸ªç‰¹æ®Šçš„unicodeç¬¦å·ï¼›DATAå‘½ä»¤ç¤ºä¾‹å¦‚ä¸‹\nDATA Â·Id+0(SB)/1,$0x37 DATA Â·Id+1(SB)/1,$0x25 è¿™ä¸¤æ¡æŒ‡ä»¤çš„å«ä¹‰æ˜¯å°†å…¨å±€å˜é‡Idèµ‹å€¼ä¸º16è¿›åˆ¶æ•°0x2537ï¼Œä¹Ÿå°±æ˜¯åè¿›åˆ¶çš„9527ï¼› æˆ‘ä»¬ä¹Ÿå¯ä»¥åˆå¹¶æˆä¸€æ¡æŒ‡ä»¤\nGLOBL ç”¨äºå°†ç¬¦å·å¯¼å‡ºï¼Œä¾‹å¦‚å°†å…¨å±€å˜é‡å¯¼å‡ºï¼ˆæ‰€è°“å¯¼å‡ºå°±æ˜¯æŠŠæ±‡ç¼–ä¸­çš„å…¨å±€å˜é‡å¯¼å‡ºåˆ°goä»£ç ä¸­å£°æ˜çš„ç›¸åŒå˜é‡ä¸Šï¼Œå¦åˆ™goä»£ç ä¸­å£°æ˜çš„å˜é‡æ„ŸçŸ¥ä¸åˆ°æ±‡ç¼–ä¸­å˜é‡çš„å€¼çš„å˜åŒ–ï¼‰ï¼Œå…¶è¯­æ³•å¦‚ä¸‹ï¼š\nGLOBL symbol(SB), width å…¶ä¸­symbolå¯¹åº”æ±‡ç¼–ä¸­ç¬¦å·çš„åå­—ï¼Œwidthä¸ºç¬¦å·å¯¹åº”å†…å­˜çš„å¤§å°ï¼›GLOBLå‘½ä»¤ç¤ºä¾‹å¦‚ä¸‹ï¼š GLOBL Â·Id, $8è¿™æ¡æŒ‡ä»¤çš„å«ä¹‰æ˜¯å¯¼å‡ºä¸€ä¸ªå…¨å±€å˜é‡Idï¼Œå…¶å¤§å°æ˜¯8å­—èŠ‚ï¼ˆbyteï¼‰ï¼› ç»“åˆDATAå’ŒGLOBLæŒ‡ä»¤ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆå§‹åŒ–å¹¶å¯¼å‡ºä¸€ä¸ªå…¨å±€å˜é‡.ä¾‹å¦‚ï¼š\nGLOBL Â·Id, $8 DATA Â·Id+0(SB)/8,$0x12345 2.","title":"Goæ±‡ç¼–ä¹‹å®šä¹‰åŸºæœ¬æ•°æ®ç±»å‹"},{"content":"1. Cgroupæ¦‚è§ˆ cgroupæ˜¯Linuxå†…æ ¸æä¾›çš„ä¸€ç§æŒ‰å±‚æ¬¡ç»„ç»‡è¿›ç¨‹ï¼Œå¹¶å¯¹è¿›ç¨‹èµ„æºæŒ‰å±‚æ¬¡è¿›è¡Œåˆ†é…å’Œé™åˆ¶çš„æœºåˆ¶ã€‚\ncgroup ä¸»è¦ç”±ä¸¤éƒ¨åˆ†ç»„æˆâ€”â€”coreå’Œcontrollerã€‚coreä¸»è¦è´Ÿè´£åˆ†å±‚ç»„ç»‡è¿›ç¨‹ã€‚ controllerè´Ÿè´£ä¸ºå±äºå½“å‰cgroupçš„è¿›ç¨‹åˆ†é…å’Œé™åˆ¶èµ„æº.\nå¤šä¸ªcgroupä»¥æ ‘å½¢ç»“æ„ç»„ç»‡ï¼Œç³»ç»Ÿä¸­æ¯ä¸ªè¿›ç¨‹éƒ½å±äºä¸€ä¸ªcgroupï¼Œä¸€ä¸ªè¿›ç¨‹ä¸­çš„æ‰€æœ‰çº¿ç¨‹éƒ½å±äºåŒä¸€ä¸ªcgroupã€‚\ncontrollerå¯ä»¥åœ¨cgroupä¸Šæœ‰é€‰æ‹©çš„å¼€å¯ï¼Œå¼€å¯åçš„controllerå°†å½±å“è¿™ä¸ªcgroupå†…çš„æ‰€æœ‰è¿›ç¨‹ã€‚\nä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æŒ‚è½½cgroupv2\nmount -t cgroup2 none $MOUNT_POINT # MOUNT_POINT æ˜¯ä»»æ„ä½ æƒ³è¦æŒ‚è½½åˆ°çš„ä½ç½® ç›´æ¥åœ¨$MOUNT_POINTåˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹å³å¯åˆ›å»ºä¸€ä¸ªcgroup\nmkdir $MOUNT_POINT/$GROUP_NAME æ¯ä¸ªcgroupå†…éƒ½æœ‰ä¸€ä¸ªcgroup.procsæ¥å£æ–‡ä»¶ï¼Œå…¶ä¸­é€è¡Œåˆ—å‡ºäº†å±äºå½“å‰cgroupçš„æ‰€æœ‰è¿›ç¨‹çš„PIDã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒPIDå¯èƒ½é‡å¤å‡ºç°ä¸”æ— åºã€‚\nè‹¥æƒ³å°†æŸä¸ªè¿›ç¨‹ç§»åŠ¨åˆ°ä¸€ä¸ªcgroupä¸­ï¼Œåªéœ€å°†å…¶PIDå†™å…¥cgroup.procsæ–‡ä»¶,è¿›ç¨‹ä¸­çš„æ‰€æœ‰çº¿ç¨‹ä¹Ÿä¼šè¿ç§»åˆ°è¯¥cgroupä¸­ã€‚forkå‡ºçš„å­è¿›ç¨‹ä¾ç„¶å±äºè¿™ä¸ªcgroupã€‚\nè‹¥è¦åˆ é™¤ä¸€ä¸ªcgroupï¼Œéœ€è¦æ³¨æ„ä¸€ç‚¹ï¼šè¿™ä¸ªcgroupå†…éœ€è¦æ²¡æœ‰ä»»ä½•å­è¿›ç¨‹ä¸”ä»…ä¸åƒµå°¸è¿›ç¨‹ç›¸å…³è”ï¼Œä¸”æ²¡æœ‰å­cgroup.æ»¡è¶³äº†ä¸Šè¿°æ¡ä»¶åï¼Œå°†å…¶ä½œä¸ºä¸€ä¸ªç©ºç›®å½•åˆ é™¤å³å¯,ä½¿ç”¨rm -rfæ— æ³•å¯¹cgroupç›®å½•è¿›è¡Œåˆ é™¤ã€‚\nrmdir $MOUNT_POINT/$GROUP_NAME /proc/$PID/cgroupä¸­åŒ…å«ä¸€ä¸ªè¿›ç¨‹æ‰€å±çš„cgroupã€‚\n$ cat /proc/self/cgroup # selfè¡¨ç¤ºå½“å‰shellè¿›ç¨‹ 0::/user.slice/user-1000.slice/session-2.scope å¦‚æœè¿›ç¨‹æˆä¸ºåƒµå°¸è¿›ç¨‹å¹¶ä¸”éšååˆ é™¤äº†ä¸ä¹‹å…³è”çš„ cgroupï¼Œåˆ™å°†â€œï¼ˆå·²åˆ é™¤ï¼‰â€é™„åŠ åˆ°è·¯å¾„ä¸­ï¼š\n$ cat /proc/842/cgroup 0::/test-cgroup/test-cgroup-nested (deleted) CgroupV2è¿˜æ”¯æŒçº¿ç¨‹æ¨¡å¼\næ¯ä¸ªéæ ¹ cgroup éƒ½æœ‰ä¸€ä¸ªcgroup.eventsæ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«populatedå­—æ®µï¼ŒæŒ‡ç¤º cgroup çš„å­å±‚æ¬¡ç»“æ„ä¸­æ˜¯å¦æœ‰å®æ—¶è¿›ç¨‹ã€‚ å¦‚æœ cgroup åŠå…¶åä»£ä¸­æ²¡æœ‰å®æ—¶è¿›ç¨‹ï¼Œåˆ™å…¶å€¼ä¸º 0ï¼› å¦åˆ™ä¸º1.\nä¾‹å¦‚ï¼šè€ƒè™‘å¦‚ä¸‹cgroupç»“æ„ï¼Œæ‹¬å·å†…æ•°å­—ä»£è¡¨cgroupå†…è¿›ç¨‹æ•°ï¼š\nA(4) - B(0) - C(1) \\ D(0) åˆ™Aã€B å’Œ C çš„populatedå­—æ®µå°†ä¸º 1ï¼Œè€Œ D ä¸º 0ã€‚åœ¨ C ä¸­çš„ä¸€ä¸ªè¿›ç¨‹é€€å‡ºåï¼ŒB å’Œ C çš„populatedå­—æ®µå°†ç¿»è½¬ä¸ºâ€œ0â€ï¼Œæ–‡ä»¶ä¿®æ”¹äº‹ä»¶å°†åœ¨ä¸¤ä¸ªcgroupçš„cgroup.eventsä¸­å‡ºç°ã€‚\næ¯ä¸ª cgroup éƒ½æœ‰ä¸€ä¸ªâ€œcgroup.controllersâ€æ–‡ä»¶ï¼Œå…¶ä¸­åˆ—å‡ºäº† cgroup å¯å¯ç”¨çš„æ‰€æœ‰æ§åˆ¶å™¨ï¼š\n$ cat cgroup.controllers cpu io memory é»˜è®¤æƒ…å†µä¸‹ä¸å¯ç”¨ä»»ä½•æ§åˆ¶å™¨ã€‚å¯ä»¥é€šè¿‡å†™å…¥cgroup.subtree_controlæ–‡ä»¶æ¥å¯ç”¨å’Œç¦ç”¨æ§åˆ¶å™¨ï¼š\n$ echo \u0026#34;+cpu +memory -io\u0026#34; \u0026gt; cgroup.subtree_control # å¼€å¯cpuã€memory æ§åˆ¶å™¨ï¼Œ å…³é—­ioæ§åˆ¶å™¨ èµ„æºæ˜¯è‡ªä¸Šè€Œä¸‹åˆ†å¸ƒçš„ï¼Œåªæœ‰å½“èµ„æºä»çˆ¶çº§åˆ†å‘ç»™å®ƒæ—¶ï¼Œcgroup æ‰èƒ½è¿›ä¸€æ­¥åˆ†å‘èµ„æºã€‚çˆ¶cgroupå¯ä»¥é™åˆ¶å­cgroupä¸­æ‰€åŒ…å«çš„controllerã€‚åªæœ‰åŒ…å«åœ¨çˆ¶cgroupçš„cgroup.subtree_controlä¸­çš„controlleræ‰èƒ½åˆ†é…çµ¦å­cgroupã€‚\nè¿›ç¨‹åªèƒ½åˆ†é…åˆ°æ ¹cgroupå’Œå¶å­cgroupã€‚\n2. coreæ¥å£æ–‡ä»¶  cgroup.type\n å­˜åœ¨äºéæ ¹cgroupä¸­çš„å¯è¯»å†™å•å€¼æ–‡ä»¶ã€‚æŒ‡ç¤ºå½“å‰cgroupçš„ç±»å‹ã€‚ å…¶å¯èƒ½æ˜¯ä»¥ä¸‹å€¼ï¼š domain: å½“å‰cgroupæ˜¯ä¸€ä¸ªæ­£å¸¸çš„domain cgroup\ndomain threaded: ä¸€ä¸ªçº¿ç¨‹åŸŸ cgroupï¼Œç”¨ä½œçº¿ç¨‹å­æ ‘çš„æ ¹ã€‚\ndomain invalid: å¤„åœ¨éæ³•çŠ¶æ€çš„cgroupï¼Œä¸èƒ½åŒ…å«å®æ—¶è¿›ç¨‹æˆ–controllerï¼Œä½†å…è®¸æˆä¸ºä¸€ä¸ªthreadedcgroup.\nthreaded: ä¸€ä¸ªçº¿ç¨‹åŒ–çš„ cgroupï¼Œå®ƒæ˜¯çº¿ç¨‹åŒ–å­æ ‘çš„æˆå‘˜ã€‚\nå¯ç›´æ¥å‘æ­¤æ–‡ä»¶å†™å…¥threadedä½¿å½“å‰cgroupæˆä¸ºä¸€ä¸ªçº¿ç¨‹cgroup\n cgroup.procs\n æŒ‰è¡Œåˆ—å‡ºå½“å‰cgroupä¸­åŒ…å«çš„è¿›ç¨‹PID. PIDæ— åºï¼Œä¸”å¯èƒ½é‡å¤ã€‚å¯ç›´æ¥å‘æ­¤æ–‡ä»¶å†™å…¥æŸä¸ªPIDä»¥å®ç°å°†è¿›ç¨‹è¿ç§»è¿›å½“å‰cgroupã€‚\n cgroup.threads\n åŒcgroup.procs,ä½†å…¶ä¸­åˆ—å‡ºçš„æ•°å­—ä¸ºçº¿ç¨‹TID\n cgroup.controllers\n åˆ—å‡ºå½“å‰cgroupä¸­å¯ç”¨çš„controller\n cgroup.subtree_control\n æŒ‡å‡ºå­cgroupå¯å¯ç”¨çš„controllerã€‚å¯é€šè¿‡ä»¥ä¸‹å‘½ä»¤å¯ç”¨æˆ–å…³é—­æŸä¸ªcontroller\n$ echo \u0026#34;+cpu +memory -io\u0026#34; \u0026gt; cgroup.subtree_control # å¼€å¯cpuã€memory æ§åˆ¶å™¨ï¼Œ å…³é—­ioæ§åˆ¶å™¨  cgroup.events\n åªè¯»æ–‡ä»¶.populatedæŒ‡ç¤ºcgroupä¸­æ˜¯å¦å­˜åœ¨å­˜æ´»è¿›ç¨‹ï¼ŒfrozenæŒ‡ç¤º cgroupæ˜¯å¦è¢«å†»ç»“\n cgroup.max.descendants\n å…è®¸çš„æœ€å¤§åä»£cgroupæ•°é‡ã€‚\n cgroup.max.depth\n æœ€å¤§cgroupæ ‘æ·±åº¦ã€‚\n cgroup.stat\n åªè¯»æ–‡ä»¶ã€‚\nnr_descendantsï¼š å¯è§åä»£cgroupçš„æ€»æ•° nr_dying_descendants: å¾…æ­»äº¡çš„åä»£ cgroup æ€»æ•°ã€‚ ä¸€ä¸ª cgroup åœ¨è¢«ç”¨æˆ·åˆ é™¤åä¼šæ­»æ‰ã€‚ åœ¨å®Œå…¨é”€æ¯ä¹‹å‰ï¼Œcgroup å°†ä¿æŒåœ¨æ­»äº¡çŠ¶æ€ä¸€æ®µæ—¶é—´ï¼ˆå¯èƒ½å–å†³äºç³»ç»Ÿè´Ÿè½½ï¼‰ã€‚\nè¿›ç¨‹ä¸èƒ½åŠ å…¥å¾…æ­»äº¡çš„cgroup. å¾…æ­»äº¡çš„ cgroup å¯ä»¥æ¶ˆè€—ä¸è¶…è¿‡é™åˆ¶çš„ç³»ç»Ÿèµ„æºï¼Œè¿™äº›èµ„æºåœ¨ cgroup åˆ é™¤æ—¶å¤„äºæ´»åŠ¨çŠ¶æ€ã€‚\n cgroup.freeze\n å­˜åœ¨äºéæ ¹cgroupã€‚å…è®¸çš„å€¼ä¸º1æˆ–0ï¼Œé»˜è®¤ä¸º0.\nå½“å€¼ä¸º1æ—¶ï¼Œä»£è¡¨å†»ç»“è¿™ä¸ªcgroupã€‚å†»ç»“ä¸€ä¸ªcgroupï¼Œå…¶ä¸­çš„æ‰€æœ‰è¿›ç¨‹å°†ä¸å†è¿è¡Œï¼Œç›´åˆ°è¿™ä¸ªcgroupè§£å†»ã€‚å¯¹äºå†»ç»“çš„cgroupï¼Œå…¶å­cgroupä¹Ÿå°†å†»ç»“ã€‚\n cgroup.kill\n åªå†™æ–‡ä»¶ï¼Œå”¯ä¸€å…è®¸å€¼ä¸º1.å‘è¿™ä¸ªæ–‡ä»¶å†™å…¥1å°†å¯¼è‡´è¿™ä¸ªcgroupä»¥åŠæ‰€æœ‰å­cgroupè¢«killã€‚è¿™å°†å¯¼è‡´å½“å‰cgroupä¸­çš„æ‰€æœ‰è¿›ç¨‹éƒ½è¢«SIGKILLä¿¡å·æ€æ­»ã€‚\n3. cpu controller  cpu.stat\n åªè¯»é”®å€¼æ–‡ä»¶ï¼Œåœ¨cpu controllerå¼€å¯æ—¶æ‰ä¼šå‡ºç°ã€‚\nusage_usecï¼šå ç”¨cpuæ€»æ—¶é—´ã€‚\nuser_usecï¼šç”¨æˆ·æ€å ç”¨æ—¶é—´ã€‚\nsystem_usecï¼šå†…æ ¸æ€å ç”¨æ—¶é—´ã€‚\nnr_periodsï¼šå‘¨æœŸè®¡æ•°ã€‚\nnr_throttledï¼šå‘¨æœŸå†…çš„é™åˆ¶è®¡æ•°ã€‚\nthrottled_usecï¼šé™åˆ¶æ‰§è¡Œçš„æ—¶é—´ã€‚\n cpu.weight\n åªå­˜åœ¨äºéæ ¹cgroupï¼Œé»˜è®¤å€¼100. å€¼åŸŸä¸º[1, 10000]\n cpu.weight.nice\n åªå­˜åœ¨äºéæ ¹cgroupï¼Œé»˜è®¤å€¼0, å€¼åŸŸä¸º[-20, 19]\n cpu.max\n å…¶ä¸­åŒ…å«ç©ºæ ¼åˆ†éš”çš„ä¸¤ä¸ªå€¼ï¼Œ$MAX $PERIODï¼Œè¡¨ç¤ºåœ¨æ¯ä¸ª$PERIODæ—¶æœŸå†…ï¼Œå¯æ¶ˆè€—çš„cpuä¸º$MAXï¼Œå½“$MAXä¸ºmaxæ—¶ï¼Œä»£è¡¨æ— é™åˆ¶ã€‚\n cpu.max.burst\n é»˜è®¤å€¼ä¸º0ï¼Œburstå€¼åŸŸä¸º[0, $MAX]\n cpu.pressure\n æ˜¾ç¤ºå½“å‰cgroupçš„cpuä½¿ç”¨å‹åŠ›çŠ¶æ€ã€‚è¯¦æƒ…å‚è§ï¼šDocumentation/accounting/psi.rstã€‚psiæ˜¯å†…æ ¸æ–°åŠ å…¥çš„ä¸€ç§è´Ÿè½½çŠ¶æ€æ£€æµ‹æœºåˆ¶ï¼Œå¯ä»¥ç›®å‰å¯ä»¥é’ˆå¯¹cpuã€memoryã€ioçš„è´Ÿè½½çŠ¶æ€è¿›è¡Œæ£€æµ‹ã€‚é€šè¿‡è®¾ç½®ï¼Œæˆ‘ä»¬å¯ä»¥è®©psiåœ¨ç›¸å…³èµ„æºè´Ÿè½½è¾¾åˆ°ä¸€å®šé˜ˆå€¼çš„æƒ…å†µä¸‹ç»™æˆ‘ä»¬å‘é€ä¸€ä¸ªäº‹ä»¶ã€‚ç”¨æˆ·æ€å¯ä»¥é€šè¿‡å¯¹æ–‡ä»¶äº‹ä»¶çš„ç›‘æ§ï¼Œå®ç°é’ˆå¯¹ç›¸å…³è´Ÿè½½ä½œå‡ºç›¸å…³ç›¸åº”è¡Œä¸ºçš„ç›®çš„ã€‚\n cpu.uclamp.min\n uclampæä¾›äº†ä¸€ç§ç”¨æˆ·ç©ºé—´å¯¹äºtask utilè¿›è¡Œé™åˆ¶çš„æœºåˆ¶ï¼Œé€šè¿‡è¯¥æœºåˆ¶ç”¨æˆ·ç©ºé—´å¯ä»¥å°†task utilé’³åˆ¶åœ¨[util_min, util_max]èŒƒå›´å†…ï¼Œè€Œcpu utilåˆ™ç”±å¤„äºå…¶è¿è¡Œé˜Ÿåˆ—ä¸Šçš„taskçš„uclampå€¼å†³å®š.\nè¿™ä¸ªæ–‡ä»¶è¡¨æ˜äº†å¯¹cpuåˆ©ç”¨ç‡çš„æœ€å°é™åˆ¶ã€‚å…¶æ•°å­—ä¸ºç™¾åˆ†æ¯”æ•°å­—ã€‚\n cpu.uclamp.max\n è®¾ç½®äº†cpuçš„æœ€å¤§åˆ©ç”¨ç‡\n4. memory controller References   æµ…è°ˆ Cgroups V2\n  è¯¦è§£Cgroup V2\n  The Linux Kernel Â· Control Group v2\n  ","permalink":"http://yangchnet.github.io/Dessert/posts/linux/cgroupv2/","summary":"1. Cgroupæ¦‚è§ˆ cgroupæ˜¯Linuxå†…æ ¸æä¾›çš„ä¸€ç§æŒ‰å±‚æ¬¡ç»„ç»‡è¿›ç¨‹ï¼Œå¹¶å¯¹è¿›ç¨‹èµ„æºæŒ‰å±‚æ¬¡è¿›è¡Œåˆ†é…å’Œé™åˆ¶çš„æœºåˆ¶ã€‚\ncgroup ä¸»è¦ç”±ä¸¤éƒ¨åˆ†ç»„æˆâ€”â€”coreå’Œcontrollerã€‚coreä¸»è¦è´Ÿè´£åˆ†å±‚ç»„ç»‡è¿›ç¨‹ã€‚ controllerè´Ÿè´£ä¸ºå±äºå½“å‰cgroupçš„è¿›ç¨‹åˆ†é…å’Œé™åˆ¶èµ„æº.\nå¤šä¸ªcgroupä»¥æ ‘å½¢ç»“æ„ç»„ç»‡ï¼Œç³»ç»Ÿä¸­æ¯ä¸ªè¿›ç¨‹éƒ½å±äºä¸€ä¸ªcgroupï¼Œä¸€ä¸ªè¿›ç¨‹ä¸­çš„æ‰€æœ‰çº¿ç¨‹éƒ½å±äºåŒä¸€ä¸ªcgroupã€‚\ncontrollerå¯ä»¥åœ¨cgroupä¸Šæœ‰é€‰æ‹©çš„å¼€å¯ï¼Œå¼€å¯åçš„controllerå°†å½±å“è¿™ä¸ªcgroupå†…çš„æ‰€æœ‰è¿›ç¨‹ã€‚\nä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æŒ‚è½½cgroupv2\nmount -t cgroup2 none $MOUNT_POINT # MOUNT_POINT æ˜¯ä»»æ„ä½ æƒ³è¦æŒ‚è½½åˆ°çš„ä½ç½® ç›´æ¥åœ¨$MOUNT_POINTåˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹å³å¯åˆ›å»ºä¸€ä¸ªcgroup\nmkdir $MOUNT_POINT/$GROUP_NAME æ¯ä¸ªcgroupå†…éƒ½æœ‰ä¸€ä¸ªcgroup.procsæ¥å£æ–‡ä»¶ï¼Œå…¶ä¸­é€è¡Œåˆ—å‡ºäº†å±äºå½“å‰cgroupçš„æ‰€æœ‰è¿›ç¨‹çš„PIDã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒPIDå¯èƒ½é‡å¤å‡ºç°ä¸”æ— åºã€‚\nè‹¥æƒ³å°†æŸä¸ªè¿›ç¨‹ç§»åŠ¨åˆ°ä¸€ä¸ªcgroupä¸­ï¼Œåªéœ€å°†å…¶PIDå†™å…¥cgroup.procsæ–‡ä»¶,è¿›ç¨‹ä¸­çš„æ‰€æœ‰çº¿ç¨‹ä¹Ÿä¼šè¿ç§»åˆ°è¯¥cgroupä¸­ã€‚forkå‡ºçš„å­è¿›ç¨‹ä¾ç„¶å±äºè¿™ä¸ªcgroupã€‚\nè‹¥è¦åˆ é™¤ä¸€ä¸ªcgroupï¼Œéœ€è¦æ³¨æ„ä¸€ç‚¹ï¼šè¿™ä¸ªcgroupå†…éœ€è¦æ²¡æœ‰ä»»ä½•å­è¿›ç¨‹ä¸”ä»…ä¸åƒµå°¸è¿›ç¨‹ç›¸å…³è”ï¼Œä¸”æ²¡æœ‰å­cgroup.æ»¡è¶³äº†ä¸Šè¿°æ¡ä»¶åï¼Œå°†å…¶ä½œä¸ºä¸€ä¸ªç©ºç›®å½•åˆ é™¤å³å¯,ä½¿ç”¨rm -rfæ— æ³•å¯¹cgroupç›®å½•è¿›è¡Œåˆ é™¤ã€‚\nrmdir $MOUNT_POINT/$GROUP_NAME /proc/$PID/cgroupä¸­åŒ…å«ä¸€ä¸ªè¿›ç¨‹æ‰€å±çš„cgroupã€‚\n$ cat /proc/self/cgroup # selfè¡¨ç¤ºå½“å‰shellè¿›ç¨‹ 0::/user.slice/user-1000.slice/session-2.scope å¦‚æœè¿›ç¨‹æˆä¸ºåƒµå°¸è¿›ç¨‹å¹¶ä¸”éšååˆ é™¤äº†ä¸ä¹‹å…³è”çš„ cgroupï¼Œåˆ™å°†â€œï¼ˆå·²åˆ é™¤ï¼‰â€é™„åŠ åˆ°è·¯å¾„ä¸­ï¼š\n$ cat /proc/842/cgroup 0::/test-cgroup/test-cgroup-nested (deleted) CgroupV2è¿˜æ”¯æŒçº¿ç¨‹æ¨¡å¼\næ¯ä¸ªéæ ¹ cgroup éƒ½æœ‰ä¸€ä¸ªcgroup.eventsæ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«populatedå­—æ®µï¼ŒæŒ‡ç¤º cgroup çš„å­å±‚æ¬¡ç»“æ„ä¸­æ˜¯å¦æœ‰å®æ—¶è¿›ç¨‹ã€‚ å¦‚æœ cgroup åŠå…¶åä»£ä¸­æ²¡æœ‰å®æ—¶è¿›ç¨‹ï¼Œåˆ™å…¶å€¼ä¸º 0ï¼› å¦åˆ™ä¸º1.\nä¾‹å¦‚ï¼šè€ƒè™‘å¦‚ä¸‹cgroupç»“æ„ï¼Œæ‹¬å·å†…æ•°å­—ä»£è¡¨cgroupå†…è¿›ç¨‹æ•°ï¼š\nA(4) - B(0) - C(1) \\ D(0) åˆ™Aã€B å’Œ C çš„populatedå­—æ®µå°†ä¸º 1ï¼Œè€Œ D ä¸º 0ã€‚åœ¨ C ä¸­çš„ä¸€ä¸ªè¿›ç¨‹é€€å‡ºåï¼ŒB å’Œ C çš„populatedå­—æ®µå°†ç¿»è½¬ä¸ºâ€œ0â€ï¼Œæ–‡ä»¶ä¿®æ”¹äº‹ä»¶å°†åœ¨ä¸¤ä¸ªcgroupçš„cgroup.","title":"CgroupV2"},{"content":"1. Linux ä¸­çš„ä¿¡å· ä¿¡å·è¿™ä¸ªæ¦‚å¿µåœ¨å¾ˆæ—©æœŸçš„ Unix ç³»ç»Ÿä¸Šå°±æœ‰ã€‚å®ƒä¸€èˆ¬ä¼šä» 1 å¼€å§‹ç¼–å·ï¼Œé€šå¸¸æ¥è¯´ï¼Œä¿¡å·ç¼–å·æ˜¯ 1 åˆ° 31ï¼Œè¿™ä¸ªç¼–å·åœ¨æ‰€æœ‰çš„ Unix ç³»ç»Ÿä¸Šéƒ½æ˜¯ä¸€æ ·çš„ã€‚\n   å–å€¼ åç§° è§£é‡Š é»˜è®¤åŠ¨ä½œ     1 SIGHUP æŒ‚èµ·    2 SIGINT ä¸­æ–­    3 SIGQUIT é€€å‡º    4 SIGILL éæ³•æŒ‡ä»¤    5 SIGTRAP æ–­ç‚¹æˆ–é™·é˜±æŒ‡ä»¤    6 SIGABRT abortå‘å‡ºçš„ä¿¡å·    7 SIGBUS éæ³•å†…å­˜è®¿é—®    8 SIGFPE æµ®ç‚¹å¼‚å¸¸    9 SIGKILL killä¿¡å· ä¸èƒ½è¢«å¿½ç•¥ã€å¤„ç†å’Œé˜»å¡   10 SIGUSR1 ç”¨æˆ·ä¿¡å·1    11 SIGSEGV æ— æ•ˆå†…å­˜è®¿é—®    12 SIGUSR2 ç”¨æˆ·ä¿¡å·2    13 SIGPIPE ç®¡é“ç ´æŸï¼Œæ²¡æœ‰è¯»ç«¯çš„ç®¡é“å†™æ•°æ®    14 SIGALRM alarmå‘å‡ºçš„ä¿¡å·    15 SIGTERM ç»ˆæ­¢ä¿¡å·    16 SIGSTKFLT æ ˆæº¢å‡º    17 SIGCHLD å­è¿›ç¨‹é€€å‡º é»˜è®¤å¿½ç•¥   18 SIGCONT è¿›ç¨‹ç»§ç»­    19 SIGSTOP è¿›ç¨‹åœæ­¢ ä¸èƒ½è¢«å¿½ç•¥ã€å¤„ç†å’Œé˜»å¡   20 SIGTSTP è¿›ç¨‹åœæ­¢    21 SIGTTIN è¿›ç¨‹åœæ­¢ï¼Œåå°è¿›ç¨‹ä»ç»ˆç«¯è¯»æ•°æ®æ—¶    22 SIGTTOU è¿›ç¨‹åœæ­¢ï¼Œåå°è¿›ç¨‹æƒ³ç»ˆç«¯å†™æ•°æ®æ—¶    23 SIGURG I/Oæœ‰ç´§æ€¥æ•°æ®åˆ°è¾¾å½“å‰è¿›ç¨‹ é»˜è®¤å¿½ç•¥   24 SIGXCPU è¿›ç¨‹çš„CPUæ—¶é—´ç‰‡åˆ°æœŸ    25 SIGXFSZ æ–‡ä»¶å¤§å°çš„è¶…å‡ºä¸Šé™    26 SIGVTALRM è™šæ‹Ÿæ—¶é’Ÿè¶…æ—¶    27 SIGPROF profileæ—¶é’Ÿè¶…æ—¶    28 SIGWINCH çª—å£å¤§å°æ”¹å˜ é»˜è®¤å¿½ç•¥   29 SIGIO I/Oç›¸å…³    30 SIGPWR å…³æœº é»˜è®¤å¿½ç•¥   31 SIGSYS ç³»ç»Ÿè°ƒç”¨å¼‚å¸¸     ç”¨ä¸€å¥è¯æ¥æ¦‚æ‹¬ï¼Œä¿¡å·ï¼ˆSignalï¼‰å…¶å®å°±æ˜¯ Linux è¿›ç¨‹æ”¶åˆ°çš„ä¸€ä¸ªé€šçŸ¥ã€‚è¿™äº›é€šçŸ¥äº§ç”Ÿçš„æºå¤´æœ‰å¾ˆå¤šç§ï¼Œé€šçŸ¥çš„ç±»å‹ä¹Ÿæœ‰å¾ˆå¤šç§ã€‚æ¯”å¦‚ä¸‹é¢è¿™å‡ ä¸ªå…¸å‹çš„åœºæ™¯ï¼š\n å¦‚æœæŒ‰ä¸‹é”®ç›˜â€œCtrl+Câ€ï¼Œå½“å‰è¿è¡Œçš„è¿›ç¨‹å°±ä¼šæ”¶åˆ°ä¸€ä¸ªä¿¡å· SIGINT è€Œé€€å‡ºï¼› å¦‚æœä»£ç å†™å¾—æœ‰é—®é¢˜ï¼Œå¯¼è‡´å†…å­˜è®¿é—®å‡ºé”™äº†ï¼Œå½“å‰çš„è¿›ç¨‹å°±ä¼šæ”¶åˆ°å¦ä¸€ä¸ªä¿¡å· SIGSEGVï¼› ä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤ kill ï¼Œç›´æ¥å‘ä¸€ä¸ªè¿›ç¨‹å‘é€ä¸€ä¸ªä¿¡å·ï¼Œç¼ºçœæƒ…å†µä¸‹ä¸æŒ‡å®šä¿¡å·çš„ç±»å‹ï¼Œé‚£ä¹ˆè¿™ä¸ªä¿¡å·å°±æ˜¯ SIGTERMã€‚ä¹Ÿå¯ä»¥æŒ‡å®šä¿¡å·ç±»å‹ï¼Œæ¯”å¦‚å‘½ä»¤ \u0026ldquo;kill -9 \u0026ldquo;, è¿™é‡Œçš„ 9ï¼Œå°±æ˜¯ç¼–å·ä¸º 9 çš„ä¿¡å·ï¼ŒSIGKILL ä¿¡å·ã€‚  2. Linuxå†…æ ¸å¯¹ä¿¡å·çš„å¤„ç†æ˜¯æ€ä¹ˆæ ·çš„ è¿›ç¨‹åœ¨æ”¶åˆ°ä¿¡å·åï¼Œå°±ä¼šå»åšç›¸åº”çš„å¤„ç†ã€‚å¯¹äºæ¯ä¸€ä¸ªä¿¡å·ï¼Œè¿›ç¨‹å¯¹å®ƒçš„å¤„ç†éƒ½æœ‰ä¸‹é¢ä¸‰ä¸ªé€‰æ‹©ã€‚\n ç¬¬ä¸€ä¸ªé€‰æ‹©æ˜¯å¿½ç•¥ï¼ˆIgnoreï¼‰ï¼Œå°±æ˜¯å¯¹è¿™ä¸ªä¿¡å·ä¸åšä»»ä½•å¤„ç†ï¼Œä½†æ˜¯æœ‰ä¸¤ä¸ªä¿¡å·ä¾‹å¤–ï¼Œå¯¹äº SIGKILL å’Œ SIGSTOP è¿™ä¸ªä¸¤ä¸ªä¿¡å·ï¼Œè¿›ç¨‹æ˜¯ä¸èƒ½å¿½ç•¥çš„ã€‚è¿™æ˜¯å› ä¸ºå®ƒä»¬çš„ä¸»è¦ä½œç”¨æ˜¯ä¸º Linux kernel å’Œè¶…çº§ç”¨æˆ·æä¾›åˆ é™¤ä»»æ„è¿›ç¨‹çš„ç‰¹æƒã€‚ ç¬¬äºŒä¸ªé€‰æ‹©ï¼Œå°±æ˜¯æ•è·ï¼ˆCatchï¼‰ï¼Œè¿™ä¸ªæ˜¯æŒ‡è®©ç”¨æˆ·è¿›ç¨‹å¯ä»¥æ³¨å†Œè‡ªå·±é’ˆå¯¹è¿™ä¸ªä¿¡å·çš„ handlerã€‚å¯¹äºæ•è·ï¼ŒSIGKILL å’Œ SIGSTOP è¿™ä¸¤ä¸ªä¿¡å·ä¹ŸåŒæ ·ä¾‹å¤–ï¼Œè¿™ä¸¤ä¸ªä¿¡å·ä¸èƒ½æœ‰ç”¨æˆ·è‡ªå·±çš„å¤„ç†ä»£ç ï¼Œåªèƒ½æ‰§è¡Œç³»ç»Ÿçš„ç¼ºçœè¡Œä¸ºã€‚ è¿˜æœ‰ä¸€ä¸ªé€‰æ‹©æ˜¯ç¼ºçœè¡Œä¸ºï¼ˆDefaultï¼‰ï¼ŒLinux ä¸ºæ¯ä¸ªä¿¡å·éƒ½å®šä¹‰äº†ä¸€ä¸ªç¼ºçœçš„è¡Œä¸ºï¼Œå¯ä»¥åœ¨ Linux ç³»ç»Ÿä¸­è¿è¡Œ man 7 signalæ¥æŸ¥çœ‹æ¯ä¸ªä¿¡å·çš„ç¼ºçœè¡Œä¸ºã€‚  å¯¹äºå¤§éƒ¨åˆ†çš„ä¿¡å·è€Œè¨€ï¼Œåº”ç”¨ç¨‹åºä¸éœ€è¦æ³¨å†Œè‡ªå·±çš„ handlerï¼Œä½¿ç”¨ç³»ç»Ÿç¼ºçœå®šä¹‰è¡Œä¸ºå°±å¯ä»¥äº†ã€‚\n","permalink":"http://yangchnet.github.io/Dessert/posts/linux/linux%E4%B8%AD%E7%9A%84%E4%BF%A1%E5%8F%B7/","summary":"1. Linux ä¸­çš„ä¿¡å· ä¿¡å·è¿™ä¸ªæ¦‚å¿µåœ¨å¾ˆæ—©æœŸçš„ Unix ç³»ç»Ÿä¸Šå°±æœ‰ã€‚å®ƒä¸€èˆ¬ä¼šä» 1 å¼€å§‹ç¼–å·ï¼Œé€šå¸¸æ¥è¯´ï¼Œä¿¡å·ç¼–å·æ˜¯ 1 åˆ° 31ï¼Œè¿™ä¸ªç¼–å·åœ¨æ‰€æœ‰çš„ Unix ç³»ç»Ÿä¸Šéƒ½æ˜¯ä¸€æ ·çš„ã€‚\n   å–å€¼ åç§° è§£é‡Š é»˜è®¤åŠ¨ä½œ     1 SIGHUP æŒ‚èµ·    2 SIGINT ä¸­æ–­    3 SIGQUIT é€€å‡º    4 SIGILL éæ³•æŒ‡ä»¤    5 SIGTRAP æ–­ç‚¹æˆ–é™·é˜±æŒ‡ä»¤    6 SIGABRT abortå‘å‡ºçš„ä¿¡å·    7 SIGBUS éæ³•å†…å­˜è®¿é—®    8 SIGFPE æµ®ç‚¹å¼‚å¸¸    9 SIGKILL killä¿¡å· ä¸èƒ½è¢«å¿½ç•¥ã€å¤„ç†å’Œé˜»å¡   10 SIGUSR1 ç”¨æˆ·ä¿¡å·1    11 SIGSEGV æ— æ•ˆå†…å­˜è®¿é—®    12 SIGUSR2 ç”¨æˆ·ä¿¡å·2    13 SIGPIPE ç®¡é“ç ´æŸï¼Œæ²¡æœ‰è¯»ç«¯çš„ç®¡é“å†™æ•°æ®    14 SIGALRM alarmå‘å‡ºçš„ä¿¡å·    15 SIGTERM ç»ˆæ­¢ä¿¡å·    16 SIGSTKFLT æ ˆæº¢å‡º    17 SIGCHLD å­è¿›ç¨‹é€€å‡º é»˜è®¤å¿½ç•¥   18 SIGCONT è¿›ç¨‹ç»§ç»­    19 SIGSTOP è¿›ç¨‹åœæ­¢ ä¸èƒ½è¢«å¿½ç•¥ã€å¤„ç†å’Œé˜»å¡   20 SIGTSTP è¿›ç¨‹åœæ­¢    21 SIGTTIN è¿›ç¨‹åœæ­¢ï¼Œåå°è¿›ç¨‹ä»ç»ˆç«¯è¯»æ•°æ®æ—¶    22 SIGTTOU è¿›ç¨‹åœæ­¢ï¼Œåå°è¿›ç¨‹æƒ³ç»ˆç«¯å†™æ•°æ®æ—¶    23 SIGURG I/Oæœ‰ç´§æ€¥æ•°æ®åˆ°è¾¾å½“å‰è¿›ç¨‹ é»˜è®¤å¿½ç•¥   24 SIGXCPU è¿›ç¨‹çš„CPUæ—¶é—´ç‰‡åˆ°æœŸ    25 SIGXFSZ æ–‡ä»¶å¤§å°çš„è¶…å‡ºä¸Šé™    26 SIGVTALRM è™šæ‹Ÿæ—¶é’Ÿè¶…æ—¶    27 SIGPROF profileæ—¶é’Ÿè¶…æ—¶    28 SIGWINCH çª—å£å¤§å°æ”¹å˜ é»˜è®¤å¿½ç•¥   29 SIGIO I/Oç›¸å…³    30 SIGPWR å…³æœº é»˜è®¤å¿½ç•¥   31 SIGSYS ç³»ç»Ÿè°ƒç”¨å¼‚å¸¸     ç”¨ä¸€å¥è¯æ¥æ¦‚æ‹¬ï¼Œä¿¡å·ï¼ˆSignalï¼‰å…¶å®å°±æ˜¯ Linux è¿›ç¨‹æ”¶åˆ°çš„ä¸€ä¸ªé€šçŸ¥ã€‚è¿™äº›é€šçŸ¥äº§ç”Ÿçš„æºå¤´æœ‰å¾ˆå¤šç§ï¼Œé€šçŸ¥çš„ç±»å‹ä¹Ÿæœ‰å¾ˆå¤šç§ã€‚æ¯”å¦‚ä¸‹é¢è¿™å‡ ä¸ªå…¸å‹çš„åœºæ™¯ï¼š","title":"Linuxä¸­çš„ä¿¡å·"},{"content":"proxy è§ï¼šhttps://yangchnet.github.io/Dessert/posts/env/%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AEclash/\nç³»ç»Ÿæ›´æ–° é¦–å…ˆè¦æ¢æº\nsudo pacman-mirrors -i -c China -m rank åœ¨å¼¹å‡ºçš„çª—å£ä¸­é€‰æ‹©ä½ è¦åˆ‡æ¢çš„æºã€‚\nç„¶å\nsudo pacman -Syyu å®‰è£…yayåŒ…ç®¡ç†\nsudo pacman -S yay vim é…ç½® è§ï¼šhttps://yangchnet.github.io/Dessert/posts/linux/vim%E9%85%8D%E7%BD%AE/\nè¾“å…¥æ³•é…ç½® å®‰è£…fcitx5ï¼ˆè¾“å…¥æ³•æ¡†æ¶ï¼‰ yay -S fcitx5-im é…ç½®fcitx5çš„ç¯å¢ƒå˜é‡ï¼š\nvim ~/.pam_environment å†…å®¹ä¸ºï¼š\nGTK_IM_MODULE DEFAULT=fcitx QT_IM_MODULE DEFAULT=fcitx XMODIFIERS DEFAULT=\\@im=fcitx SDL_IM_MODULE DEFAULT=fcitx å®‰è£…fcitx5-rimeï¼ˆè¾“å…¥æ³•å¼•æ“ï¼‰\nyay -S fcitx5-rime å®‰è£…fcitx5-gtk\nyay -S fcitx5-gtk # ä¸è£…çš„è¯ï¼Œéƒ¨åˆ†è½¯ä»¶å¯èƒ½ä¼šå‡ºç°ä¸èƒ½è¾“å…¥ä¸­æ–‡çš„æƒ…å†µ å®‰è£…rime-cloverpinyinï¼ˆè¾“å…¥æ–¹æ¡ˆï¼‰\nyay -S rime-cloverpinyin å¦‚æœå‡ºç°é—®é¢˜å¯èƒ½è¿˜éœ€è¦åšä¸‹é¢è¿™æ­¥ï¼š\nyay -S base-devel åˆ›å»ºå¹¶å†™å…¥rime-cloverpinyinçš„è¾“å…¥æ–¹æ¡ˆï¼š\nvim ~/.local/share/fcitx5/rime/default.custom.yaml å†…å®¹ä¸ºï¼š\npatch: \u0026#34;menu/page_size\u0026#34;: 5 schema_list: - schema: clover  å¯å‚è€ƒï¼šhttps://github.com/fkxxyz/rime-cloverpinyin/wiki/linux\n é…ç½®ä¸»é¢˜ å‚è€ƒï¼šhttps://github.com/hosxy/Fcitx5-Material-Color\nå®‰è£åŒæ‹¼(optional) cd $HOME/.local/share/fcitx5 # rime_dir å®‰è£…plum\ncurl -fsSL https://git.io/rime-install | bash å®‰è£…åŒæ‹¼è¾“å…¥æ³•\nrime_dir=\u0026#34;/home/lc/.local/share/fcitx5/rime\u0026#34; bash ./rime-install emoji rime_dir=\u0026#34;/home/lc/.local/share/fcitx5/rime\u0026#34; bash ./rime-install double-pinyin é…ç½®åŒæ‹¼ï¼š\npatch: \u0026quot;menu/page_size\u0026quot;: 5 schema_list: - schema: double_pinyin_flypy #- schema: clover å‚è€ƒï¼š\n https://help.flypy.com/#/up https://www.bilibili.com/read/cv14690644 https://github.com/rime/home/wiki/CustomizationGuide#%E4%B8%80%E4%BE%8B%E5%AE%9A%E8%A3%BD%E7%B0%A1%E5%8C%96%E5%AD%97%E8%BC%B8%E5%87%BA https://github.com/rime/plum  é…ç½®å‘½ä»¤è¡Œå·¥å…· è§ï¼šhttps://yangchnet.github.io/Dessert/posts/env/zsh%E7%9A%84%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE/\nç¤¾äº¤å·¥å…· å¾®ä¿¡\nyay -S wechat-uos QQ\nyay -S deepin-wine-tim æˆ–\nyay -S linuxqq Virtualbox sudo pacman -S virtualbox sudo pacman -S linux-headers # å®‰è£…å¯¹åº”è‡ªå·±å†…æ ¸ç‰ˆæœ¬çš„ä¸€ä¸ª # linux61-virtualbox-host-modules sudo pacman -S virtualbox-host-dkms sudo modprobe vboxdrv Reference https://zhuanlan.zhihu.com/p/114296129?ivk_sa=1024320u\n","permalink":"http://yangchnet.github.io/Dessert/posts/linux/manjaro%E5%88%9D%E5%A7%8B%E5%8C%96/","summary":"proxy è§ï¼šhttps://yangchnet.github.io/Dessert/posts/env/%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AEclash/\nç³»ç»Ÿæ›´æ–° é¦–å…ˆè¦æ¢æº\nsudo pacman-mirrors -i -c China -m rank åœ¨å¼¹å‡ºçš„çª—å£ä¸­é€‰æ‹©ä½ è¦åˆ‡æ¢çš„æºã€‚\nç„¶å\nsudo pacman -Syyu å®‰è£…yayåŒ…ç®¡ç†\nsudo pacman -S yay vim é…ç½® è§ï¼šhttps://yangchnet.github.io/Dessert/posts/linux/vim%E9%85%8D%E7%BD%AE/\nè¾“å…¥æ³•é…ç½® å®‰è£…fcitx5ï¼ˆè¾“å…¥æ³•æ¡†æ¶ï¼‰ yay -S fcitx5-im é…ç½®fcitx5çš„ç¯å¢ƒå˜é‡ï¼š\nvim ~/.pam_environment å†…å®¹ä¸ºï¼š\nGTK_IM_MODULE DEFAULT=fcitx QT_IM_MODULE DEFAULT=fcitx XMODIFIERS DEFAULT=\\@im=fcitx SDL_IM_MODULE DEFAULT=fcitx å®‰è£…fcitx5-rimeï¼ˆè¾“å…¥æ³•å¼•æ“ï¼‰\nyay -S fcitx5-rime å®‰è£…fcitx5-gtk\nyay -S fcitx5-gtk # ä¸è£…çš„è¯ï¼Œéƒ¨åˆ†è½¯ä»¶å¯èƒ½ä¼šå‡ºç°ä¸èƒ½è¾“å…¥ä¸­æ–‡çš„æƒ…å†µ å®‰è£…rime-cloverpinyinï¼ˆè¾“å…¥æ–¹æ¡ˆï¼‰\nyay -S rime-cloverpinyin å¦‚æœå‡ºç°é—®é¢˜å¯èƒ½è¿˜éœ€è¦åšä¸‹é¢è¿™æ­¥ï¼š\nyay -S base-devel åˆ›å»ºå¹¶å†™å…¥rime-cloverpinyinçš„è¾“å…¥æ–¹æ¡ˆï¼š\nvim ~/.local/share/fcitx5/rime/default.custom.yaml å†…å®¹ä¸ºï¼š\npatch: \u0026#34;menu/page_size\u0026#34;: 5 schema_list: - schema: clover  å¯å‚è€ƒï¼šhttps://github.","title":"manjaroåˆå§‹åŒ–é…ç½®"},{"content":"# ç¼–è¯‘ç¯å¢ƒFROMgolang:alpine as builder # è®¾ç½®goç¯å¢ƒå˜é‡ENV GO111MODULE=on \\  GOPROXY=https://goproxy.cn,direct# å·¥ä½œç›®å½•WORKDIR/app# å°†é¡¹ç›®æ‹·è´åˆ°dockerä¸­COPY . .# æ‹‰å–åŒ…ï¼Œç¼–è¯‘RUN go mod tidy \u0026amp;\u0026amp; CGO_ENABLED=0 GOOS=linux go build -a -ldflags \u0026#39;-extldflags \u0026#34;-static\u0026#34;\u0026#39; -o hello-app .# è¿è¡Œç¯å¢ƒFROMscratch# è®¾ç½®æ—¶åŒºCOPY --from=builder /usr/share/zoneinfo/Asia/Shanghai /usr/share/zoneinfo/Asia/ShanghaiENV TZ Asia/Shanghai# å®‰è£…è¯ä¹¦RUN apt-get -qq update \\  \u0026amp;\u0026amp; apt-get -qq install -y --no-install-recommends ca-certificates curlWORKDIR/app# å°†ç¼–è¯‘å¥½çš„å¯æ‰§è¡Œæ–‡ä»¶ä»ç¼–è¯‘ç¯å¢ƒä¸­æ‹·è´åˆ°è¿è¡Œç¯å¢ƒä¸­COPY --from=builder /app/hello-app .# å¯åŠ¨ENTRYPOINT [\u0026#34;./hello-app\u0026#34;]# ç«¯å£EXPOSE10000","permalink":"http://yangchnet.github.io/Dessert/posts/golang/%E4%B8%80%E4%BB%BD%E5%A5%BD%E7%94%A8%E7%9A%84golang%E5%BA%94%E7%94%A8dockerfile%E6%A8%A1%E6%9D%BF/","summary":"# ç¼–è¯‘ç¯å¢ƒFROMgolang:alpine as builder # è®¾ç½®goç¯å¢ƒå˜é‡ENV GO111MODULE=on \\  GOPROXY=https://goproxy.cn,direct# å·¥ä½œç›®å½•WORKDIR/app# å°†é¡¹ç›®æ‹·è´åˆ°dockerä¸­COPY . .# æ‹‰å–åŒ…ï¼Œç¼–è¯‘RUN go mod tidy \u0026amp;\u0026amp; CGO_ENABLED=0 GOOS=linux go build -a -ldflags \u0026#39;-extldflags \u0026#34;-static\u0026#34;\u0026#39; -o hello-app .# è¿è¡Œç¯å¢ƒFROMscratch# è®¾ç½®æ—¶åŒºCOPY --from=builder /usr/share/zoneinfo/Asia/Shanghai /usr/share/zoneinfo/Asia/ShanghaiENV TZ Asia/Shanghai# å®‰è£…è¯ä¹¦RUN apt-get -qq update \\  \u0026amp;\u0026amp; apt-get -qq install -y --no-install-recommends ca-certificates curlWORKDIR/app# å°†ç¼–è¯‘å¥½çš„å¯æ‰§è¡Œæ–‡ä»¶ä»ç¼–è¯‘ç¯å¢ƒä¸­æ‹·è´åˆ°è¿è¡Œç¯å¢ƒä¸­COPY --from=builder /app/hello-app .# å¯åŠ¨ENTRYPOINT [\u0026#34;./hello-app\u0026#34;]# ç«¯å£EXPOSE10000","title":"ä¸€ä»½å¥½ç”¨çš„golangåº”ç”¨Dockerfileæ¨¡æ¿"},{"content":"1.æ¦‚è¿° Linux æ˜¯å¤šç”¨æˆ·å¤šä»»åŠ¡æ“ä½œç³»ç»Ÿï¼Œæ¢å¥è¯è¯´ï¼ŒLinux ç³»ç»Ÿæ”¯æŒå¤šä¸ªç”¨æˆ·åœ¨åŒä¸€æ—¶é—´å†…ç™»é™†ï¼Œä¸åŒç”¨æˆ·å¯ä»¥æ‰§è¡Œä¸åŒçš„ä»»åŠ¡ï¼Œå¹¶ä¸”äº’ä¸å½±å“ã€‚\nä¾‹å¦‚ï¼ŒæŸå° Linux æœåŠ¡å™¨ä¸Šæœ‰ 4 ä¸ªç”¨æˆ·ï¼Œåˆ†åˆ«æ˜¯ rootã€wwwã€ftp å’Œ mysqlï¼Œåœ¨åŒä¸€æ—¶é—´å†…ï¼Œroot ç”¨æˆ·å¯èƒ½åœ¨æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—ã€ç®¡ç†ç»´æŠ¤ç³»ç»Ÿï¼›www ç”¨æˆ·å¯èƒ½åœ¨ä¿®æ”¹è‡ªå·±çš„ç½‘é¡µç¨‹åºï¼›ftp ç”¨æˆ·å¯èƒ½åœ¨ä¸Šä¼ è½¯ä»¶åˆ°æœåŠ¡å™¨ï¼›mysql ç”¨æˆ·å¯èƒ½åœ¨æ‰§è¡Œè‡ªå·±çš„ SQL æŸ¥è¯¢ï¼Œæ¯ä¸ªç”¨æˆ·äº’ä¸å¹²æ‰°ï¼Œæœ‰æ¡ä¸ç´Šåœ°è¿›è¡Œç€è‡ªå·±çš„å·¥ä½œã€‚ä¸æ­¤åŒæ—¶ï¼Œæ¯ä¸ªç”¨æˆ·ä¹‹é—´ä¸èƒ½è¶Šæƒè®¿é—®ï¼Œæ¯”å¦‚ www ç”¨æˆ·ä¸èƒ½æ‰§è¡Œ mysql ç”¨æˆ·çš„ SQL æŸ¥è¯¢æ“ä½œï¼Œftp ç”¨æˆ·ä¹Ÿä¸èƒ½ä¿®æ”¹ www ç”¨æˆ·çš„ç½‘é¡µç¨‹åºã€‚\nä¸åŒç”¨æˆ·å…·æœ‰ä¸é—®çš„æƒé™ï¼Œæ¯ä¸ªç”¨æˆ·åœ¨æƒé™å…è®¸çš„èŒƒå›´å†…å®Œæˆä¸é—´çš„ä»»åŠ¡ï¼ŒLinux æ­£æ˜¯é€šè¿‡è¿™ç§æƒé™çš„åˆ’åˆ†ä¸ç®¡ç†ï¼Œå®ç°äº†å¤šç”¨æˆ·å¤šä»»åŠ¡çš„è¿è¡Œæœºåˆ¶ã€‚\nå› æ­¤ï¼Œå¦‚æœè¦ä½¿ç”¨ Linux ç³»ç»Ÿçš„èµ„æºï¼Œå°±å¿…é¡»å‘ç³»ç»Ÿç®¡ç†å‘˜ç”³è¯·ä¸€ä¸ªè´¦æˆ·ï¼Œç„¶åé€šè¿‡è¿™ä¸ªè´¦æˆ·è¿›å…¥ç³»ç»Ÿï¼ˆè´¦æˆ·å’Œç”¨æˆ·æ˜¯ä¸€ä¸ªæ¦‚å¿µï¼‰ã€‚é€šè¿‡å»ºç«‹ä¸åŒå±æ€§çš„ç”¨æˆ·ï¼Œä¸€æ–¹é¢å¯ä»¥åˆç†åœ°åˆ©ç”¨å’Œæ§åˆ¶ç³»ç»Ÿèµ„æºï¼Œå¦ä¸€æ–¹é¢ä¹Ÿå¯ä»¥å¸®åŠ©ç”¨æˆ·ç»„ç»‡æ–‡ä»¶ï¼Œæä¾›å¯¹ç”¨æˆ·æ–‡ä»¶çš„å®‰å…¨æ€§ä¿æŠ¤ã€‚\næ¯ä¸ªç”¨æˆ·éƒ½æœ‰å”¯ä¸€çš„ç”¨æˆ·åå’Œå¯†ç ã€‚åœ¨ç™»å½•ç³»ç»Ÿæ—¶ï¼Œåªæœ‰æ­£ç¡®è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼Œæ‰èƒ½è¿›å…¥ç³»ç»Ÿå’Œè‡ªå·±çš„ä¸»ç›®å½•ã€‚\nç”¨æˆ·ç»„æ˜¯å…·æœ‰ç›¸åŒç‰¹å¾ç”¨æˆ·çš„é€»è¾‘é›†åˆã€‚ç®€å•çš„ç†è§£ï¼Œæœ‰æ—¶æˆ‘ä»¬éœ€è¦è®©å¤šä¸ªç”¨æˆ·å…·æœ‰ç›¸åŒçš„æƒé™ï¼Œæ¯”å¦‚æŸ¥çœ‹ã€ä¿®æ”¹æŸä¸€ä¸ªæ–‡ä»¶çš„æƒé™ï¼Œä¸€ç§æ–¹æ³•æ˜¯åˆ†åˆ«å¯¹å¤šä¸ªç”¨æˆ·è¿›è¡Œæ–‡ä»¶è®¿é—®æˆæƒï¼Œå¦‚æœæœ‰ 10 ä¸ªç”¨æˆ·çš„è¯ï¼Œå°±éœ€è¦æˆæƒ 10 æ¬¡ï¼Œé‚£å¦‚æœæœ‰ 100ã€1000 ç”šè‡³æ›´å¤šçš„ç”¨æˆ·å‘¢ï¼Ÿ\næ˜¾ç„¶ï¼Œè¿™ç§æ–¹æ³•ä¸å¤ªåˆç†ã€‚æœ€å¥½çš„æ–¹å¼æ˜¯å»ºç«‹ä¸€ä¸ªç»„ï¼Œè®©è¿™ä¸ªç»„å…·æœ‰æŸ¥çœ‹ã€ä¿®æ”¹æ­¤æ–‡ä»¶çš„æƒé™ï¼Œç„¶åå°†æ‰€æœ‰éœ€è¦è®¿é—®æ­¤æ–‡ä»¶çš„ç”¨æˆ·æ”¾å…¥è¿™ä¸ªç»„ä¸­ã€‚é‚£ä¹ˆï¼Œæ‰€æœ‰ç”¨æˆ·å°±å…·æœ‰äº†å’Œç»„ä¸€æ ·çš„æƒé™ï¼Œè¿™å°±æ˜¯ç”¨æˆ·ç»„ã€‚\nå°†ç”¨æˆ·åˆ†ç»„æ˜¯ Linux ç³»ç»Ÿä¸­å¯¹ç”¨æˆ·è¿›è¡Œç®¡ç†åŠæ§åˆ¶è®¿é—®æƒé™çš„ä¸€ç§æ‰‹æ®µï¼Œé€šè¿‡å®šä¹‰ç”¨æˆ·ç»„ï¼Œå¾ˆå¤šç¨‹åºä¸Šç®€åŒ–äº†å¯¹ç”¨æˆ·çš„ç®¡ç†å·¥ä½œã€‚\n2.ç”¨æˆ·å’Œç”¨æˆ·ç»„çš„å…³ç³» ç”¨æˆ·å’Œç”¨æˆ·ç»„çš„å¯¹åº”å…³ç³»æœ‰ä»¥ä¸‹ 4 ç§ï¼š\nä¸€å¯¹ä¸€ï¼šä¸€ä¸ªç”¨æˆ·å¯ä»¥å­˜åœ¨ä¸€ä¸ªç»„ä¸­ï¼Œæ˜¯ç»„ä¸­çš„å”¯ä¸€æˆå‘˜ï¼› ä¸€å¯¹å¤šï¼šä¸€ä¸ªç”¨æˆ·å¯ä»¥å­˜åœ¨å¤šä¸ªç”¨æˆ·ç»„ä¸­ï¼Œæ­¤ç”¨æˆ·å…·æœ‰è¿™å¤šä¸ªç»„çš„å…±åŒæƒé™ï¼› å¤šå¯¹ä¸€ï¼šå¤šä¸ªç”¨æˆ·å¯ä»¥å­˜åœ¨ä¸€ä¸ªç»„ä¸­ï¼Œè¿™äº›ç”¨æˆ·å…·æœ‰å’Œç»„ç›¸åŒçš„æƒé™ï¼› å¤šå¯¹å¤šï¼šå¤šä¸ªç”¨æˆ·å¯ä»¥å­˜åœ¨å¤šä¸ªç»„ä¸­ï¼Œä¹Ÿå°±æ˜¯ä»¥ä¸Š 3 ç§å…³ç³»çš„æ‰©å±•ã€‚ ç”¨æˆ·å’Œç»„ä¹‹é—´çš„å…³ç³»å¯ç”¨ä¸‹å›¾è¡¨ç¤ºï¼šå›¾ 1 Linuxç”¨æˆ·å’Œç”¨æˆ·ç»„ 3. UIDå’ŒGID(ç”¨æˆ·IDå’Œç»„ID) ç™»é™† Linux ç³»ç»Ÿæ—¶ï¼Œè™½ç„¶è¾“å…¥çš„æ˜¯è‡ªå·±çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œä½†å…¶å® Linux å¹¶ä¸è®¤è¯†ä½ çš„ç”¨æˆ·åç§°ï¼Œå®ƒåªè®¤è¯†ç”¨æˆ·åå¯¹åº”çš„ ID å·ï¼ˆä¹Ÿå°±æ˜¯ä¸€ä¸²æ•°å­—ï¼‰ã€‚Linux ç³»ç»Ÿå°†æ‰€æœ‰ç”¨æˆ·çš„åç§°ä¸ ID çš„å¯¹åº”å…³ç³»éƒ½å­˜å‚¨åœ¨ /etc/passwd æ–‡ä»¶ä¸­ã€‚\nè¯´ç™½äº†ï¼Œç”¨æˆ·åå¹¶æ— å®é™…ä½œç”¨ï¼Œä»…æ˜¯ä¸ºäº†æ–¹ä¾¿ç”¨æˆ·çš„è®°å¿†è€Œå·²ã€‚\nè¦è®ºè¯ \u0026ldquo;Linuxç³»ç»Ÿä¸è®¤è¯†ç”¨æˆ·å\u0026rdquo; ä¹Ÿå¾ˆç®€å•ï¼Œåœ¨å‰é¢ç« èŠ‚ï¼Œæˆ‘ä»¬æ›¾ç»åœ¨ç½‘ç»œä¸Šä¸‹è½½è¿‡ \u0026ldquo;.tar.gz\u0026rdquo; æˆ– \u0026ldquo;.tar.bz2\u0026rdquo; æ ¼å¼çš„æ–‡ä»¶ï¼Œåœ¨è§£å‹ç¼©ä¹‹åçš„æ–‡ä»¶ä¸­ï¼Œä½ ä¼šå‘ç°æ–‡ä»¶æ‹¥æœ‰è€…çš„å±æ€§æ˜¾ç¤ºçš„æ˜¯ä¸€ä¸²æ•°å­—ï¼Œè¿™å¾ˆæ­£å¸¸ï¼Œå°±æ˜¯å› ä¸ºç³»ç»Ÿåªè®¤è¯†ä»£è¡¨ä½ èº«ä»½çš„ IDï¼Œè¿™ä¸²æ•°å­—å°±æ˜¯ç”¨æˆ·çš„ IDï¼ˆUIDï¼‰å·ã€‚\nLinux ç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªç”¨æˆ·çš„ ID ç»†åˆ†ä¸º 2 ç§ï¼Œåˆ†åˆ«æ˜¯ç”¨æˆ· IDï¼ˆUser IDï¼Œç®€ç§° UIDï¼‰å’Œç»„ IDï¼ˆGroup IDï¼Œç®€ç§° GIDï¼‰ï¼Œè¿™ä¸æ–‡ä»¶æœ‰æ‹¥æœ‰è€…å’Œæ‹¥æœ‰ç¾¤ç»„ä¸¤ç§å±æ€§ç›¸å¯¹åº”ï¼ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼‰ã€‚\næ¯ä¸ªæ–‡ä»¶éƒ½æœ‰è‡ªå·±çš„æ‹¥æœ‰è€… ID å’Œç¾¤ç»„ IDï¼Œå½“æ˜¾ç¤ºæ–‡ä»¶å±æ€§æ—¶ï¼Œç³»ç»Ÿä¼šæ ¹æ® /etc/passwd å’Œ /etc/group æ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œåˆ†åˆ«æ‰¾åˆ° UID å’Œ GID å¯¹åº”çš„ç”¨æˆ·åå’Œç¾¤ç»„åï¼Œç„¶åæ˜¾ç¤ºå‡ºæ¥ã€‚\n ä½¿ç”¨catå‘½ä»¤ï¼ŒæŸ¥çœ‹/etc/passwdæ–‡ä»¶ï¼ŒæŸ¥çœ‹å½“å‰ç”¨æˆ·å’Œrootç”¨æˆ·çš„UIDå’ŒGID\n 4. /etc/passwdå†…å®¹è§£é‡Š Linux ç³»ç»Ÿä¸­çš„ /etc/passwd æ–‡ä»¶ï¼Œæ˜¯ç³»ç»Ÿç”¨æˆ·é…ç½®æ–‡ä»¶ï¼Œå­˜å‚¨äº†ç³»ç»Ÿä¸­æ‰€æœ‰ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯ï¼Œå¹¶ä¸”æ‰€æœ‰ç”¨æˆ·éƒ½å¯ä»¥å¯¹æ­¤æ–‡ä»¶æ‰§è¡Œè¯»æ“ä½œã€‚ å¯ä»¥çœ‹åˆ°ï¼Œ/etc/passwd æ–‡ä»¶ä¸­çš„å†…å®¹éå¸¸è§„å¾‹ï¼Œæ¯è¡Œè®°å½•å¯¹åº”ä¸€ä¸ªç”¨æˆ·ã€‚\nä¸ºä»€ä¹ˆLinux ç³»ç»Ÿä¸­é»˜è®¤æ€ä¹ˆä¼šæœ‰è¿™ä¹ˆå¤šçš„ç”¨æˆ·ï¼Ÿ è¿™äº›ç”¨æˆ·ä¸­çš„ç»å¤§å¤šæ•°æ˜¯ç³»ç»Ÿæˆ–æœåŠ¡æ­£å¸¸è¿è¡Œæ‰€å¿…éœ€çš„ç”¨æˆ·ï¼Œè¿™ç§ç”¨æˆ·é€šå¸¸ç§°ä¸ºç³»ç»Ÿç”¨æˆ·æˆ–ä¼ªç”¨æˆ·ã€‚ç³»ç»Ÿç”¨æˆ·æ— æ³•ç”¨æ¥ç™»å½•ç³»ç»Ÿï¼Œä½†ä¹Ÿä¸èƒ½åˆ é™¤ï¼Œå› ä¸ºä¸€æ—¦åˆ é™¤ï¼Œä¾èµ–è¿™äº›ç”¨æˆ·è¿è¡Œçš„æœåŠ¡æˆ–ç¨‹åºå°±ä¸èƒ½æ­£å¸¸æ‰§è¡Œï¼Œä¼šå¯¼è‡´ç³»ç»Ÿé—®é¢˜ã€‚\nä¸ä»…å¦‚æ­¤ï¼Œæ¯è¡Œç”¨æˆ·ä¿¡æ¯éƒ½ä»¥ \u0026ldquo;ï¼š\u0026rdquo; ä½œä¸ºåˆ†éš”ç¬¦ï¼Œåˆ’åˆ†ä¸º 7 ä¸ªå­—æ®µï¼Œæ¯ä¸ªå­—æ®µæ‰€è¡¨ç¤ºçš„å«ä¹‰å¦‚ä¸‹ï¼š ç”¨æˆ·åï¼šå¯†ç ï¼šUIDï¼ˆç”¨æˆ·IDï¼‰ï¼šGIDï¼ˆç»„IDï¼‰ï¼šæè¿°æ€§ä¿¡æ¯ï¼šä¸»ç›®å½•ï¼šé»˜è®¤Shell\næ¥ä¸‹æ¥ï¼Œç»™å¤§å®¶é€ä¸ªä»‹ç»è¿™äº›å­—æ®µã€‚\n1). ç”¨æˆ·å\nç”¨æˆ·åï¼Œå°±æ˜¯ä¸€ä¸²ä»£è¡¨ç”¨æˆ·èº«ä»½çš„å­—ç¬¦ä¸²ã€‚\nå‰é¢è®²è¿‡ï¼Œç”¨æˆ·åä»…æ˜¯ä¸ºäº†æ–¹ä¾¿ç”¨æˆ·è®°å¿†ï¼ŒLinux ç³»ç»Ÿæ˜¯é€šè¿‡ UID æ¥è¯†åˆ«ç”¨æˆ·èº«ä»½ï¼Œåˆ†é…ç”¨æˆ·æƒé™çš„ã€‚/etc/passwd æ–‡ä»¶ä¸­å°±å®šä¹‰äº†ç”¨æˆ·åå’Œ UID ä¹‹é—´çš„å¯¹åº”å…³ç³»ã€‚\n2). å¯†ç  \u0026ldquo;x\u0026rdquo; è¡¨ç¤ºæ­¤ç”¨æˆ·è®¾æœ‰å¯†ç ï¼Œä½†ä¸æ˜¯çœŸæ­£çš„å¯†ç ï¼ŒçœŸæ­£çš„å¯†ç ä¿å­˜åœ¨ /etc/shadow æ–‡ä»¶ä¸­ï¼ˆä¸‹ä¸€èŠ‚åšè¯¦ç»†ä»‹ç»ï¼‰ã€‚\nåœ¨æ—©æœŸçš„ UNIX ä¸­ï¼Œè¿™é‡Œä¿å­˜çš„å°±æ˜¯çœŸæ­£çš„åŠ å¯†å¯†ç ä¸²ï¼Œä½†ç”±äºæ‰€æœ‰ç¨‹åºéƒ½èƒ½è¯»å–æ­¤æ–‡ä»¶ï¼Œéå¸¸å®¹æ˜“é€ æˆç”¨æˆ·æ•°æ®è¢«çªƒå–ã€‚ è™½ç„¶å¯†ç æ˜¯åŠ å¯†çš„ï¼Œä½†æ˜¯é‡‡ç”¨æš´åŠ›ç ´è§£çš„æ–¹å¼ä¹Ÿæ˜¯èƒ½å¤Ÿè¿›è¡Œç ´è§£çš„ã€‚\nå› æ­¤ï¼Œç°åœ¨ Linux ç³»ç»ŸæŠŠçœŸæ­£çš„åŠ å¯†å¯†ç ä¸²æ”¾ç½®åœ¨ /etc/shadow æ–‡ä»¶ä¸­ï¼Œæ­¤æ–‡ä»¶åªæœ‰ root ç”¨æˆ·å¯ä»¥æµè§ˆå’Œæ“ä½œï¼Œè¿™æ ·å°±æœ€å¤§é™åº¦åœ°ä¿è¯äº†å¯†ç çš„å®‰å…¨ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶ \u0026ldquo;x\u0026rdquo; å¹¶ä¸è¡¨ç¤ºçœŸæ­£çš„å¯†ç ï¼Œä½†ä¹Ÿä¸èƒ½åˆ é™¤ï¼Œå¦‚æœåˆ é™¤äº† \u0026ldquo;x\u0026rdquo;ï¼Œé‚£ä¹ˆç³»ç»Ÿä¼šè®¤ä¸ºè¿™ä¸ªç”¨æˆ·æ²¡æœ‰å¯†ç ï¼Œä»è€Œå¯¼è‡´åªè¾“å…¥ç”¨æˆ·åè€Œä¸ç”¨è¾“å…¥å¯†ç å°±å¯ä»¥ç™»é™†ï¼ˆåªèƒ½åœ¨ä½¿ç”¨æ— å¯†ç ç™»å½•ï¼Œè¿œç¨‹æ˜¯ä¸å¯ä»¥çš„ï¼‰ï¼Œé™¤éç‰¹æ®Šæƒ…å†µï¼ˆå¦‚ç ´è§£ç”¨æˆ·å¯†ç ï¼‰ï¼Œè¿™å½“ç„¶æ˜¯ä¸å¯è¡Œçš„ã€‚\n3). UID UIDï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ· IDã€‚æ¯ä¸ªç”¨æˆ·éƒ½æœ‰å”¯ä¸€çš„ä¸€ä¸ª UIDï¼ŒLinux ç³»ç»Ÿé€šè¿‡ UID æ¥è¯†åˆ«ä¸åŒçš„ç”¨æˆ·ã€‚\nå®é™…ä¸Šï¼ŒUID å°±æ˜¯ä¸€ä¸ª 0~65535 ä¹‹é—´çš„æ•°ï¼Œä¸åŒèŒƒå›´çš„æ•°å­—è¡¨ç¤ºä¸åŒçš„ç”¨æˆ·èº«ä»½ï¼Œå…·ä½“å¦‚è¡¨ 1 æ‰€ç¤ºã€‚\n   UIDèŒƒå›´ ç”¨æˆ·èº«ä»½     0 è¶…çº§ç”¨æˆ·ã€‚UID ä¸º 0 å°±ä»£è¡¨è¿™ä¸ªè´¦å·æ˜¯ç®¡ç†å‘˜è´¦å·ã€‚åœ¨ Linux ä¸­ï¼Œå¦‚ä½•æŠŠæ™®é€šç”¨æˆ·å‡çº§æˆç®¡ç†å‘˜å‘¢ï¼Ÿåªéœ€æŠŠå…¶ä»–ç”¨æˆ·çš„ UID ä¿®æ”¹ä¸º 0 å°±å¯ä»¥äº†ï¼Œè¿™ä¸€ç‚¹å’Œ Windows æ˜¯ä¸åŒçš„ã€‚ä¸è¿‡ä¸å»ºè®®å»ºç«‹å¤šä¸ªç®¡ç†å‘˜è´¦å·ã€‚   1-499 ç³»ç»Ÿç”¨æˆ·ï¼ˆä¼ªç”¨æˆ·ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ­¤èŒƒå›´çš„ UID ä¿ç•™ç»™ç³»ç»Ÿä½¿ç”¨ã€‚å…¶ä¸­ï¼Œ1~99 ç”¨äºç³»ç»Ÿè‡ªè¡Œåˆ›å»ºçš„è´¦å·ï¼›100~499 åˆ†é…ç»™æœ‰ç³»ç»Ÿè´¦å·éœ€æ±‚çš„ç”¨æˆ·ã€‚å…¶å®ï¼Œé™¤äº† 0 ä¹‹å¤–ï¼Œå…¶ä»–çš„ UID å¹¶æ— ä¸åŒï¼Œè¿™é‡Œåªæ˜¯é»˜è®¤ 500 ä»¥ä¸‹çš„æ•°å­—ç»™ç³»ç»Ÿä½œä¸ºä¿ç•™è´¦æˆ·ï¼Œåªæ˜¯ä¸€ä¸ªå…¬è®¤çš„ä¹ æƒ¯è€Œå·²ã€‚   500-65535 æ™®é€šç”¨æˆ·ã€‚é€šå¸¸è¿™äº› UID å·²ç»è¶³å¤Ÿç”¨æˆ·ä½¿ç”¨äº†ã€‚ä½†ä¸å¤Ÿç”¨ä¹Ÿæ²¡å…³ç³»ï¼Œ2.6.x å†…æ ¸ä¹‹åçš„ Linux ç³»ç»Ÿå·²ç»å¯ä»¥æ”¯æŒ 232 ä¸ª UID äº†    4). GID å…¨ç§°â€œGroup IDâ€ï¼Œç®€ç§°â€œç»„IDâ€ï¼Œè¡¨ç¤ºç”¨æˆ·åˆå§‹ç»„çš„ç»„ ID å·ã€‚è¿™é‡Œéœ€è¦è§£é‡Šä¸€ä¸‹åˆå§‹ç»„å’Œé™„åŠ ç»„çš„æ¦‚å¿µã€‚\nåˆå§‹ç»„ï¼ŒæŒ‡ç”¨æˆ·ç™»é™†æ—¶å°±æ‹¥æœ‰è¿™ä¸ªç”¨æˆ·ç»„çš„ç›¸å…³æƒé™ã€‚æ¯ä¸ªç”¨æˆ·çš„åˆå§‹ç»„åªèƒ½æœ‰ä¸€ä¸ªï¼Œé€šå¸¸å°±æ˜¯å°†å’Œæ­¤ç”¨æˆ·çš„ç”¨æˆ·åç›¸åŒçš„ç»„åä½œä¸ºè¯¥ç”¨æˆ·çš„åˆå§‹ç»„ã€‚æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬æ‰‹å·¥æ·»åŠ ç”¨æˆ· lampï¼Œåœ¨å»ºç«‹ç”¨æˆ· lamp çš„åŒæ—¶ï¼Œå°±ä¼šå»ºç«‹ lamp ç»„ä½œä¸º lamp ç”¨æˆ·çš„åˆå§‹ç»„ã€‚\né™„åŠ ç»„ï¼ŒæŒ‡ç”¨æˆ·å¯ä»¥åŠ å…¥å¤šä¸ªå…¶ä»–çš„ç”¨æˆ·ç»„ï¼Œå¹¶æ‹¥æœ‰è¿™äº›ç»„çš„æƒé™ã€‚æ¯ä¸ªç”¨æˆ·åªèƒ½æœ‰ä¸€ä¸ªåˆå§‹ç»„ï¼Œé™¤åˆå§‹ç»„å¤–ï¼Œç”¨æˆ·å†åŠ å…¥å…¶ä»–çš„ç”¨æˆ·ç»„ï¼Œè¿™äº›ç”¨æˆ·ç»„å°±æ˜¯è¿™ä¸ªç”¨æˆ·çš„é™„åŠ ç»„ã€‚é™„åŠ ç»„å¯ä»¥æœ‰å¤šä¸ªï¼Œè€Œä¸”ç”¨æˆ·å¯ä»¥æœ‰è¿™äº›é™„åŠ ç»„çš„æƒé™ã€‚\nä¸¾ä¾‹æ¥è¯´ï¼Œåˆšåˆšçš„ lamp ç”¨æˆ·é™¤å±äºåˆå§‹ç»„ lamp å¤–ï¼Œæˆ‘åˆæŠŠå®ƒåŠ å…¥äº† users ç»„ï¼Œé‚£ä¹ˆ lamp ç”¨æˆ·åŒæ—¶å±äº lamp ç»„å’Œ users ç»„ï¼Œå…¶ä¸­ lamp æ˜¯åˆå§‹ç»„ï¼Œusers æ˜¯é™„åŠ ç»„ã€‚\nå½“ç„¶ï¼Œåˆå§‹ç»„å’Œé™„åŠ ç»„çš„èº«ä»½æ˜¯å¯ä»¥ä¿®æ”¹çš„ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨å·¥ä½œä¸­ä¸ä¿®æ”¹åˆå§‹ç»„ï¼Œåªä¿®æ”¹é™„åŠ ç»„ï¼Œå› ä¸ºä¿®æ”¹äº†åˆå§‹ç»„æœ‰æ—¶ä¼šè®©ç®¡ç†å‘˜é€»è¾‘æ··ä¹±ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ /etc/passwd æ–‡ä»¶çš„ç¬¬å››ä¸ªå­—æ®µä¸­çœ‹åˆ°çš„ ID æ˜¯è¿™ä¸ªç”¨æˆ·çš„åˆå§‹ç»„ã€‚\n5). æè¿°æ€§ä¿¡æ¯ è¿™ä¸ªå­—æ®µå¹¶æ²¡æœ‰ä»€ä¹ˆé‡è¦çš„ç”¨é€”ï¼Œåªæ˜¯ç”¨æ¥è§£é‡Šè¿™ä¸ªç”¨æˆ·çš„æ„ä¹‰è€Œå·²ã€‚\n6). ä¸»ç›®å½• ä¹Ÿå°±æ˜¯ç”¨æˆ·ç™»å½•åæœ‰æ“ä½œæƒé™çš„è®¿é—®ç›®å½•ï¼Œé€šå¸¸ç§°ä¸ºç”¨æˆ·çš„ä¸»ç›®å½•ã€‚\nä¾‹å¦‚ï¼Œroot è¶…çº§ç®¡ç†å‘˜è´¦æˆ·çš„ä¸»ç›®å½•ä¸º /rootï¼Œæ™®é€šç”¨æˆ·çš„ä¸»ç›®å½•ä¸º /home/yourIDnameï¼Œå³åœ¨ /home/ ç›®å½•ä¸‹å»ºç«‹å’Œç”¨æˆ·åç›¸åŒçš„ç›®å½•ä½œä¸ºä¸»ç›®å½•ï¼Œå¦‚ lamp ç”¨æˆ·çš„ä¸»ç›®å½•å°±æ˜¯ /home/lamp/ ç›®å½•ã€‚\n7). é»˜è®¤çš„Shell Shell å°±æ˜¯ Linux çš„å‘½ä»¤è§£é‡Šå™¨ï¼Œæ˜¯ç”¨æˆ·å’Œ Linux å†…æ ¸ä¹‹é—´æ²Ÿé€šçš„æ¡¥æ¢ã€‚\næˆ‘ä»¬çŸ¥é“ï¼Œç”¨æˆ·ç™»é™† Linux ç³»ç»Ÿåï¼Œé€šè¿‡ä½¿ç”¨ Linux å‘½ä»¤å®Œæˆæ“ä½œä»»åŠ¡ï¼Œä½†ç³»ç»Ÿåªè®¤è¯†ç±»ä¼¼ 0101 çš„æœºå™¨è¯­è¨€ï¼Œè¿™é‡Œå°±éœ€è¦ä½¿ç”¨å‘½ä»¤è§£é‡Šå™¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒShell å‘½ä»¤è§£é‡Šå™¨çš„åŠŸèƒ½å°±æ˜¯å°†ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤è½¬æ¢æˆç³»ç»Ÿå¯ä»¥è¯†åˆ«çš„æœºå™¨è¯­è¨€ã€‚\né€šå¸¸æƒ…å†µä¸‹ï¼ŒLinux ç³»ç»Ÿé»˜è®¤ä½¿ç”¨çš„å‘½ä»¤è§£é‡Šå™¨æ˜¯ bashï¼ˆ/bin/bashï¼‰ï¼Œå½“ç„¶è¿˜æœ‰å…¶ä»–å‘½ä»¤è§£é‡Šå™¨ï¼Œä¾‹å¦‚ shã€csh ç­‰ã€‚\n5. /etc/shadowå†…å®¹è§£é‡Š /etc/shadow æ–‡ä»¶ï¼Œç”¨äºå­˜å‚¨ Linux ç³»ç»Ÿä¸­ç”¨æˆ·çš„å¯†ç ä¿¡æ¯ï¼Œåˆç§°ä¸ºâ€œå½±å­æ–‡ä»¶â€ã€‚\nå‰é¢ä»‹ç»äº† /etc/passwd æ–‡ä»¶ï¼Œç”±äºè¯¥æ–‡ä»¶å…è®¸æ‰€æœ‰ç”¨æˆ·è¯»å–ï¼Œæ˜“å¯¼è‡´ç”¨æˆ·å¯†ç æ³„éœ²ï¼Œå› æ­¤ Linux ç³»ç»Ÿå°†ç”¨æˆ·çš„å¯†ç ä¿¡æ¯ä» /etc/passwd æ–‡ä»¶ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œå¹¶å•ç‹¬æ”¾åˆ°äº†æ­¤æ–‡ä»¶ä¸­ã€‚\n/etc/shadow æ–‡ä»¶åªæœ‰ root ç”¨æˆ·æ‹¥æœ‰è¯»æƒé™ï¼Œå…¶ä»–ç”¨æˆ·æ²¡æœ‰ä»»ä½•æƒé™ï¼Œè¿™æ ·å°±ä¿è¯äº†ç”¨æˆ·å¯†ç çš„å®‰å…¨æ€§ã€‚ æ³¨æ„ï¼Œå¦‚æœè¿™ä¸ªæ–‡ä»¶çš„æƒé™å‘ç”Ÿäº†æ”¹å˜ï¼Œåˆ™éœ€è¦æ³¨æ„æ˜¯å¦æ˜¯æ¶æ„æ”»å‡»ã€‚\nä»‹ç»æ­¤æ–‡ä»¶ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ‰“å¼€çœ‹çœ‹ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š\n[root@localhost ~]#vim /etc/shadow root: $6$9w5Td6lg $bgpsy3olsq9WwWvS5Sst2W3ZiJpuCGDY.4w4MRk3ob/i85fl38RH15wzVoom ff9isV1 PzdcXmixzhnMVhMxbvO:15775:0:99999:7::: bin:*:15513:0:99999:7::: daemon:*:15513:0:99999:7::: â€¦çœç•¥éƒ¨åˆ†è¾“å‡ºâ€¦ åŒ /etc/passwd æ–‡ä»¶ä¸€æ ·ï¼Œæ–‡ä»¶ä¸­æ¯è¡Œä»£è¡¨ä¸€ä¸ªç”¨æˆ·ï¼ŒåŒæ ·ä½¿ç”¨ \u0026ldquo;:\u0026rdquo; ä½œä¸ºåˆ†éš”ç¬¦ï¼Œä¸åŒä¹‹å¤„åœ¨äºï¼Œæ¯è¡Œç”¨æˆ·ä¿¡æ¯è¢«åˆ’åˆ†ä¸º 9 ä¸ªå­—æ®µã€‚æ¯ä¸ªå­—æ®µçš„å«ä¹‰å¦‚ä¸‹ï¼š ç”¨æˆ·åï¼šåŠ å¯†å¯†ç ï¼šæœ€åä¸€æ¬¡ä¿®æ”¹æ—¶é—´ï¼šæœ€å°ä¿®æ”¹æ—¶é—´é—´éš”ï¼šå¯†ç æœ‰æ•ˆæœŸï¼šå¯†ç éœ€è¦å˜æ›´å‰çš„è­¦å‘Šå¤©æ•°ï¼šå¯†ç è¿‡æœŸåçš„å®½é™æ—¶é—´ï¼šè´¦å·å¤±æ•ˆæ—¶é—´ï¼šä¿ç•™å­—æ®µ\næ¥ä¸‹æ¥ï¼Œç»™å¤§å®¶åˆ†åˆ«ä»‹ç»è¿™ 9 ä¸ªå­—æ®µã€‚\n1). ç”¨æˆ·å åŒ /etc/passwd æ–‡ä»¶çš„ç”¨æˆ·åæœ‰ç›¸åŒçš„å«ä¹‰ã€‚\n2). åŠ å¯†å¯†ç  è¿™é‡Œä¿å­˜çš„æ˜¯çœŸæ­£åŠ å¯†çš„å¯†ç ã€‚ç›®å‰ Linux çš„å¯†ç é‡‡ç”¨çš„æ˜¯ SHA512 æ•£åˆ—åŠ å¯†ç®—æ³•ï¼ŒåŸæ¥é‡‡ç”¨çš„æ˜¯ MD5 æˆ– DES åŠ å¯†ç®—æ³•ã€‚SHA512 æ•£åˆ—åŠ å¯†ç®—æ³•çš„åŠ å¯†ç­‰çº§æ›´é«˜ï¼Œä¹Ÿæ›´åŠ å®‰å…¨ã€‚\næ³¨æ„ï¼Œè¿™ä¸²å¯†ç äº§ç”Ÿçš„ä¹±ç ä¸èƒ½æ‰‹å·¥ä¿®æ”¹ï¼Œå¦‚æœæ‰‹å·¥ä¿®æ”¹ï¼Œç³»ç»Ÿå°†æ— æ³•è¯†åˆ«å¯†ç ï¼Œå¯¼è‡´å¯†ç å¤±æ•ˆã€‚å¾ˆå¤šè½¯ä»¶é€è¿‡è¿™ä¸ªåŠŸèƒ½ï¼Œåœ¨å¯†ç ä¸²å‰åŠ ä¸Š \u0026ldquo;!\u0026quot;ã€\u0026quot;*\u0026rdquo; æˆ– \u0026ldquo;x\u0026rdquo; ä½¿å¯†ç æš‚æ—¶å¤±æ•ˆã€‚\næ‰€æœ‰ä¼ªç”¨æˆ·çš„å¯†ç éƒ½æ˜¯ \u0026ldquo;!!\u0026rdquo; æˆ– \u0026ldquo;*\u0026quot;ï¼Œä»£è¡¨æ²¡æœ‰å¯†ç æ˜¯ä¸èƒ½ç™»å½•çš„ã€‚å½“ç„¶ï¼Œæ–°åˆ›å»ºçš„ç”¨æˆ·å¦‚æœä¸è®¾å®šå¯†ç ï¼Œé‚£ä¹ˆå®ƒçš„å¯†ç é¡¹ä¹Ÿæ˜¯ \u0026ldquo;!!\u0026quot;ï¼Œä»£è¡¨è¿™ä¸ªç”¨æˆ·æ²¡æœ‰å¯†ç ï¼Œä¸èƒ½ç™»å½•ã€‚\n3). æœ€åä¸€æ¬¡ä¿®æ”¹æ—¶é—´ æ­¤å­—æ®µè¡¨ç¤ºæœ€åä¸€æ¬¡ä¿®æ”¹å¯†ç çš„æ—¶é—´ï¼Œå¯æ˜¯ï¼Œä¸ºä»€ä¹ˆ root ç”¨æˆ·æ˜¾ç¤ºçš„æ˜¯ 15775 å‘¢ï¼Ÿ\nè¿™æ˜¯å› ä¸ºï¼ŒLinux è®¡ç®—æ—¥æœŸçš„æ—¶é—´æ˜¯ä»¥ 1970 å¹´ 1 æœˆ 1 æ—¥ä½œä¸º 1 ä¸æ–­ç´¯åŠ å¾—åˆ°çš„æ—¶é—´ï¼Œåˆ° 1971 å¹´ 1 æœˆ 1 æ—¥ï¼Œåˆ™ä¸º 366 å¤©ã€‚è¿™é‡Œæ˜¾ç¤º 15775 å¤©ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ­¤ root è´¦å·åœ¨ 1970 å¹´ 1 æœˆ 1 æ—¥ä¹‹åçš„ç¬¬ 15775 å¤©ä¿®æ”¹çš„ root ç”¨æˆ·å¯†ç ã€‚\né‚£ä¹ˆï¼Œåˆ°åº• 15775 ä»£è¡¨çš„æ˜¯å“ªä¸€å¤©å‘¢ï¼Ÿå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡Œæ¢ç®—ï¼š\n[root@localhost ~]# date -d \u0026#34;1970-01-01 15775 days\u0026#34; 2013å¹´03æœˆ11æ—¥ æ˜ŸæœŸä¸€ 00:00:00 CST å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡ä»¥ä¸Šå‘½ä»¤ï¼Œå³å¯å°†å…¶æ¢ç®—ä¸ºæˆ‘ä»¬ä¹ æƒ¯çš„ç³»ç»Ÿæ—¥æœŸã€‚\n4). æœ€å°ä¿®æ”¹æ—¶é—´é—´éš” æœ€å°ä¿®æ”¹é—´éš”æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥å­—æ®µè§„å®šäº†ä»ç¬¬ 3 å­—æ®µï¼ˆæœ€åä¸€æ¬¡ä¿®æ”¹å¯†ç çš„æ—¥æœŸï¼‰èµ·ï¼Œå¤šé•¿æ—¶é—´ä¹‹å†…ä¸èƒ½ä¿®æ”¹å¯†ç ã€‚å¦‚æœæ˜¯ 0ï¼Œåˆ™å¯†ç å¯ä»¥éšæ—¶ä¿®æ”¹ï¼›å¦‚æœæ˜¯ 10ï¼Œåˆ™ä»£è¡¨å¯†ç ä¿®æ”¹å 10 å¤©ä¹‹å†…ä¸èƒ½å†æ¬¡ä¿®æ”¹å¯†ç ã€‚\næ­¤å­—æ®µæ˜¯ä¸ºäº†é’ˆå¯¹æŸäº›äººé¢‘ç¹æ›´æ”¹è´¦æˆ·å¯†ç è€Œè®¾è®¡çš„ã€‚\n5). å¯†ç æœ‰æ•ˆæœŸ ç»å¸¸å˜æ›´å¯†ç æ˜¯ä¸ªå¥½ä¹ æƒ¯ï¼Œä¸ºäº†å¼ºåˆ¶è¦æ±‚ç”¨æˆ·å˜æ›´å¯†ç ï¼Œè¿™ä¸ªå­—æ®µå¯ä»¥æŒ‡å®šè·ç¦»ç¬¬ 3 å­—æ®µï¼ˆæœ€åä¸€æ¬¡æ›´æ”¹å¯†ç ï¼‰å¤šé•¿æ—¶é—´å†…éœ€è¦å†æ¬¡å˜æ›´å¯†ç ï¼Œå¦åˆ™è¯¥è´¦æˆ·å¯†ç è¿›è¡Œè¿‡æœŸé˜¶æ®µã€‚ è¯¥å­—æ®µçš„é»˜è®¤å€¼ä¸º 99999ï¼Œä¹Ÿå°±æ˜¯ 273 å¹´ï¼Œå¯è®¤ä¸ºæ˜¯æ°¸ä¹…ç”Ÿæ•ˆã€‚å¦‚æœæ”¹ä¸º 90ï¼Œåˆ™è¡¨ç¤ºå¯†ç è¢«ä¿®æ”¹ 90 å¤©ä¹‹åå¿…é¡»å†æ¬¡ä¿®æ”¹ï¼Œå¦åˆ™è¯¥ç”¨æˆ·å³å°†è¿‡æœŸã€‚ç®¡ç†æœåŠ¡å™¨æ—¶ï¼Œé€šè¿‡è¿™ä¸ªå­—æ®µå¼ºåˆ¶ç”¨æˆ·å®šæœŸä¿®æ”¹å¯†ç ã€‚\n6). å¯†ç éœ€è¦å˜æ›´å‰çš„è­¦å‘Šå¤©æ•° ä¸ç¬¬ 5 å­—æ®µç›¸æ¯”è¾ƒï¼Œå½“è´¦æˆ·å¯†ç æœ‰æ•ˆæœŸå¿«åˆ°æ—¶ï¼Œç³»ç»Ÿä¼šå‘å‡ºè­¦å‘Šä¿¡æ¯ç»™æ­¤è´¦æˆ·ï¼Œæé†’ç”¨æˆ· \u0026ldquo;å†è¿‡ n å¤©ä½ çš„å¯†ç å°±è¦è¿‡æœŸäº†ï¼Œè¯·å°½å¿«é‡æ–°è®¾ç½®ä½ çš„å¯†ç ï¼\u0026quot;ã€‚\nè¯¥å­—æ®µçš„é»˜è®¤å€¼æ˜¯ 7ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè·ç¦»å¯†ç æœ‰æ•ˆæœŸçš„ç¬¬ 7 å¤©å¼€å§‹ï¼Œæ¯æ¬¡ç™»å½•ç³»ç»Ÿéƒ½ä¼šå‘è¯¥è´¦æˆ·å‘å‡º \u0026ldquo;ä¿®æ”¹å¯†ç \u0026rdquo; çš„è­¦å‘Šä¿¡æ¯ã€‚\n7). å¯†ç è¿‡æœŸåçš„å®½é™å¤©æ•° ä¹Ÿç§°ä¸ºâ€œå£ä»¤å¤±æ•ˆæ—¥â€ï¼Œç®€å•ç†è§£å°±æ˜¯ï¼Œåœ¨å¯†ç è¿‡æœŸåï¼Œç”¨æˆ·å¦‚æœè¿˜æ˜¯æ²¡æœ‰ä¿®æ”¹å¯†ç ï¼Œåˆ™åœ¨æ­¤å­—æ®µè§„å®šçš„å®½é™å¤©æ•°å†…ï¼Œç”¨æˆ·è¿˜æ˜¯å¯ä»¥ç™»å½•ç³»ç»Ÿçš„ï¼›å¦‚æœè¿‡äº†å®½é™å¤©æ•°ï¼Œç³»ç»Ÿå°†ä¸å†è®©æ­¤è´¦æˆ·ç™»é™†ï¼Œä¹Ÿä¸ä¼šæç¤ºè´¦æˆ·è¿‡æœŸï¼Œæ˜¯å®Œå…¨ç¦ç”¨ã€‚\næ¯”å¦‚è¯´ï¼Œæ­¤å­—æ®µè§„å®šçš„å®½é™å¤©æ•°æ˜¯ 10ï¼Œåˆ™ä»£è¡¨å¯†ç è¿‡æœŸ 10 å¤©åå¤±æ•ˆï¼›å¦‚æœæ˜¯ 0ï¼Œåˆ™ä»£è¡¨å¯†ç è¿‡æœŸåç«‹å³å¤±æ•ˆï¼›å¦‚æœæ˜¯ -1ï¼Œåˆ™ä»£è¡¨å¯†ç æ°¸è¿œä¸ä¼šå¤±æ•ˆã€‚\n8). è´¦å·å¤±æ•ˆæ—¶é—´ åŒç¬¬ 3 ä¸ªå­—æ®µä¸€æ ·ï¼Œä½¿ç”¨è‡ª 1970 å¹´ 1 æœˆ 1 æ—¥ä»¥æ¥çš„æ€»å¤©æ•°ä½œä¸ºè´¦æˆ·çš„å¤±æ•ˆæ—¶é—´ã€‚è¯¥å­—æ®µè¡¨ç¤ºï¼Œè´¦å·åœ¨æ­¤å­—æ®µè§„å®šçš„æ—¶é—´ä¹‹å¤–ï¼Œä¸è®ºä½ çš„å¯†ç æ˜¯å¦è¿‡æœŸï¼Œéƒ½å°†æ— æ³•ä½¿ç”¨ï¼\nè¯¥å­—æ®µé€šå¸¸è¢«ä½¿ç”¨åœ¨å…·æœ‰æ”¶è´¹æœåŠ¡çš„ç³»ç»Ÿä¸­ã€‚\n9). ä¿ç•™ è¿™ä¸ªå­—æ®µç›®å‰æ²¡æœ‰ä½¿ç”¨ï¼Œç­‰å¾…æ–°åŠŸèƒ½çš„åŠ å…¥ã€‚\n6. /etc/groupè§£é‡Š /ect/group æ–‡ä»¶æ˜¯ç”¨æˆ·ç»„é…ç½®æ–‡ä»¶ï¼Œå³ç”¨æˆ·ç»„çš„æ‰€æœ‰ä¿¡æ¯éƒ½å­˜æ”¾åœ¨æ­¤æ–‡ä»¶ä¸­ã€‚\næ­¤æ–‡ä»¶æ˜¯è®°å½•ç»„ IDï¼ˆGIDï¼‰å’Œç»„åç›¸å¯¹åº”çš„æ–‡ä»¶ã€‚å‰é¢è®²è¿‡ï¼Œetc/passwd æ–‡ä»¶ä¸­æ¯è¡Œç”¨æˆ·ä¿¡æ¯çš„ç¬¬å››ä¸ªå­—æ®µè®°å½•çš„æ˜¯ç”¨æˆ·çš„åˆå§‹ç»„ IDï¼Œé‚£ä¹ˆï¼Œæ­¤ GID çš„ç»„ååˆ°åº•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå°±è¦ä» /etc/group æ–‡ä»¶ä¸­æŸ¥æ‰¾ã€‚\n/etc/group æ–‡ä»¶çš„å†…å®¹å¯ä»¥é€šè¿‡ Vim çœ‹åˆ°ï¼š\n[root@localhost ~]#vim /etc/group root:x:0: bin:x:1:bin,daemon daemon:x:2:bin,daemon â€¦çœç•¥éƒ¨åˆ†è¾“å‡ºâ€¦ lamp:x:502: å¯ä»¥çœ‹åˆ°ï¼Œæ­¤æ–‡ä»¶ä¸­æ¯ä¸€è¡Œå„ä»£è¡¨ä¸€ä¸ªç”¨æˆ·ç»„ã€‚åœ¨å‰é¢ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬æ›¾åˆ›å»º lamp ç”¨æˆ·ï¼Œç³»ç»Ÿé»˜è®¤ç”Ÿæˆä¸€ä¸ª lamp ç”¨æˆ·ç»„ï¼Œåœ¨æ­¤å¯ä»¥çœ‹åˆ°ï¼Œæ­¤ç”¨æˆ·ç»„çš„ GID ä¸º 502ï¼Œç›®å‰å®ƒä»…ä½œä¸º lamp ç”¨æˆ·çš„åˆå§‹ç»„ã€‚\nå„ç”¨æˆ·ç»„ä¸­ï¼Œè¿˜æ˜¯ä»¥ \u0026ldquo;ï¼š\u0026rdquo; ä½œä¸ºå­—æ®µä¹‹é—´çš„åˆ†éš”ç¬¦ï¼Œåˆ†ä¸º 4 ä¸ªå­—æ®µï¼Œæ¯ä¸ªå­—æ®µå¯¹åº”çš„å«ä¹‰ä¸ºï¼š ç»„åï¼šå¯†ç ï¼šGIDï¼šè¯¥ç”¨æˆ·ç»„ä¸­çš„ç”¨æˆ·åˆ—è¡¨\næ¥ä¸‹æ¥ï¼Œåˆ†åˆ«ä»‹ç»å„ä¸ªå­—æ®µå…·ä½“çš„å«ä¹‰ã€‚\n1). ç»„å ä¹Ÿå°±æ˜¯æ˜¯ç”¨æˆ·ç»„çš„åç§°ï¼Œæœ‰å­—æ¯æˆ–æ•°å­—æ„æˆã€‚åŒ /etc/passwd ä¸­çš„ç”¨æˆ·åä¸€æ ·ï¼Œç»„åä¹Ÿä¸èƒ½é‡å¤ã€‚\n2). ç»„å¯†ç  å’Œ /etc/passwd æ–‡ä»¶ä¸€æ ·ï¼Œè¿™é‡Œçš„ \u0026ldquo;x\u0026rdquo; ä»…ä»…æ˜¯å¯†ç æ ‡è¯†ï¼ŒçœŸæ­£åŠ å¯†åçš„ç»„å¯†ç é»˜è®¤ä¿å­˜åœ¨ /etc/gshadow æ–‡ä»¶ä¸­ã€‚\nä¸è¿‡ï¼Œç”¨æˆ·è®¾ç½®å¯†ç æ˜¯ä¸ºäº†éªŒè¯ç”¨æˆ·çš„èº«ä»½ï¼Œé‚£ç”¨æˆ·ç»„è®¾ç½®å¯†ç æ˜¯ç”¨æ¥åšä»€ä¹ˆçš„å‘¢ï¼Ÿç”¨æˆ·ç»„å¯†ç ä¸»è¦æ˜¯ç”¨æ¥æŒ‡å®šç»„ç®¡ç†å‘˜çš„ï¼Œç”±äºç³»ç»Ÿä¸­çš„è´¦å·å¯èƒ½ä¼šéå¸¸å¤šï¼Œroot ç”¨æˆ·å¯èƒ½æ²¡æœ‰æ—¶é—´è¿›è¡Œç”¨æˆ·çš„ç»„è°ƒæ•´ï¼Œè¿™æ—¶å¯ä»¥ç»™ç”¨æˆ·ç»„æŒ‡å®šç»„ç®¡ç†å‘˜ï¼Œå¦‚æœæœ‰ç”¨æˆ·éœ€è¦åŠ å…¥æˆ–é€€å‡ºæŸç”¨æˆ·ç»„ï¼Œå¯ä»¥ç”±è¯¥ç»„çš„ç»„ç®¡ç†å‘˜æ›¿ä»£ root è¿›è¡Œç®¡ç†ã€‚ä½†æ˜¯è¿™é¡¹åŠŸèƒ½ç›®å‰å¾ˆå°‘ä½¿ç”¨ï¼Œæˆ‘ä»¬ä¹Ÿå¾ˆå°‘è®¾ç½®ç»„å¯†ç ã€‚å¦‚æœéœ€è¦èµ‹äºˆæŸç”¨æˆ·è°ƒæ•´æŸä¸ªç”¨æˆ·ç»„çš„æƒé™ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ sudo å‘½ä»¤ä»£æ›¿ã€‚\n3). ç»„ID (GID) å°±æ˜¯ç¾¤ç»„çš„ ID å·ï¼ŒLinux ç³»ç»Ÿå°±æ˜¯é€šè¿‡ GID æ¥åŒºåˆ†ç”¨æˆ·ç»„çš„ï¼ŒåŒç”¨æˆ·åä¸€æ ·ï¼Œç»„åä¹Ÿåªæ˜¯ä¸ºäº†ä¾¿äºç®¡ç†å‘˜è®°å¿†ã€‚\nè¿™é‡Œçš„ç»„ GID ä¸ /etc/passwd æ–‡ä»¶ä¸­ç¬¬ 4 ä¸ªå­—æ®µçš„ GID ç›¸å¯¹åº”ï¼Œå®é™…ä¸Šï¼Œ/etc/passwd æ–‡ä»¶ä¸­ä½¿ç”¨ GID å¯¹åº”çš„ç¾¤ç»„åï¼Œå°±æ˜¯é€šè¿‡æ­¤æ–‡ä»¶å¯¹åº”å¾—åˆ°çš„ã€‚\n4). ç»„ä¸­çš„ç”¨æˆ· æ­¤å­—æ®µåˆ—å‡ºæ¯ä¸ªç¾¤ç»„åŒ…å«çš„æ‰€æœ‰ç”¨æˆ·ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœè¯¥ç”¨æˆ·ç»„æ˜¯è¿™ä¸ªç”¨æˆ·çš„åˆå§‹ç»„ï¼Œåˆ™è¯¥ç”¨æˆ·ä¸ä¼šå†™å…¥è¿™ä¸ªå­—æ®µï¼Œå¯ä»¥è¿™ä¹ˆç†è§£ï¼Œè¯¥å­—æ®µæ˜¾ç¤ºçš„ç”¨æˆ·éƒ½æ˜¯è¿™ä¸ªç”¨æˆ·ç»„çš„é™„åŠ ç”¨æˆ·ã€‚\nä¸¾ä¸ªä¾‹å­ï¼Œlamp ç»„çš„ç»„ä¿¡æ¯ä¸º \u0026ldquo;lamp:x:502:\u0026quot;ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œç¬¬å››ä¸ªå­—æ®µæ²¡æœ‰å†™å…¥ lamp ç”¨æˆ·ï¼Œå› ä¸º lamp ç»„æ˜¯ lamp ç”¨æˆ·çš„åˆå§‹ç»„ã€‚å¦‚æœè¦æŸ¥è¯¢è¿™äº›ç”¨æˆ·çš„åˆå§‹ç»„ï¼Œåˆ™éœ€è¦å…ˆåˆ° /etc/passwd æ–‡ä»¶ä¸­æŸ¥çœ‹ GIDï¼ˆç¬¬å››ä¸ªå­—æ®µï¼‰ï¼Œç„¶ååˆ° /etc/group æ–‡ä»¶ä¸­æ¯”å¯¹ç»„åã€‚\næ¯ä¸ªç”¨æˆ·éƒ½å¯ä»¥åŠ å…¥å¤šä¸ªé™„åŠ ç»„ï¼Œä½†æ˜¯åªèƒ½å±äºä¸€ä¸ªåˆå§‹ç»„ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨å®é™…å·¥ä½œä¸­ï¼Œå¦‚æœéœ€è¦æŠŠç”¨æˆ·åŠ å…¥å…¶ä»–ç»„ï¼Œåˆ™éœ€è¦ä»¥é™„åŠ ç»„çš„å½¢å¼æ·»åŠ ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬æƒ³è®© lamp ä¹ŸåŠ å…¥ root è¿™ä¸ªç¾¤ç»„ï¼Œé‚£ä¹ˆåªéœ€è¦åœ¨ç¬¬ä¸€è¡Œçš„æœ€åä¸€ä¸ªå­—æ®µåŠ å…¥ lampï¼Œå³ root:x:0:lamp å°±å¯ä»¥äº†ã€‚\nä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç”¨æˆ·çš„åˆå§‹ç»„å°±æ˜¯åœ¨å»ºç«‹ç”¨æˆ·çš„åŒæ—¶å»ºç«‹çš„å’Œç”¨æˆ·åç›¸åŒçš„ç»„ã€‚\nåˆ°æ­¤ï¼Œæˆ‘ä»¬å·²ç»å­¦ä¹ äº†/etc/passwdã€/etc/shadowã€/etc/groupï¼Œå®ƒä»¬ä¹‹é—´çš„å…³ç³»å¯ä»¥è¿™æ ·ç†è§£ï¼Œå³å…ˆåœ¨ /etc/group æ–‡ä»¶ä¸­æŸ¥è¯¢ç”¨æˆ·ç»„çš„ GID å’Œç»„åï¼›ç„¶ååœ¨ /etc/passwd æ–‡ä»¶ä¸­æŸ¥æ‰¾è¯¥ GID æ˜¯å“ªä¸ªç”¨æˆ·çš„åˆå§‹ç»„ï¼ŒåŒæ—¶æå–è¿™ä¸ªç”¨æˆ·çš„ç”¨æˆ·åå’Œ UIDï¼›æœ€åé€šè¿‡ UID åˆ° /etc/shadow æ–‡ä»¶ä¸­æå–å’Œè¿™ä¸ªç”¨æˆ·ç›¸åŒ¹é…çš„å¯†ç ã€‚\n7. /etc/gshadowè§£é‡Š å‰é¢è®²è¿‡ï¼Œ/etc/passwd æ–‡ä»¶å­˜å‚¨ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ï¼ŒåŒæ—¶è€ƒè™‘åˆ°è´¦æˆ·çš„å®‰å…¨æ€§ï¼Œå°†ç”¨æˆ·çš„å¯†ç ä¿¡æ¯å­˜æ”¾å¦ä¸€ä¸ªæ–‡ä»¶ /etc/shadow ä¸­ã€‚æœ¬èŠ‚è¦å°†çš„ /etc/gshadow æ–‡ä»¶ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œç»„ç”¨æˆ·ä¿¡æ¯å­˜å‚¨åœ¨ /etc/group æ–‡ä»¶ä¸­ï¼Œè€Œå°†ç»„ç”¨æˆ·çš„å¯†ç ä¿¡æ¯å­˜å‚¨åœ¨ /etc/gshadow æ–‡ä»¶ä¸­ã€‚\né¦–å…ˆï¼Œæˆ‘ä»¬å€ŸåŠ© Vim å‘½ä»¤æŸ¥çœ‹ä¸€ä¸‹æ­¤æ–‡ä»¶ä¸­çš„å†…å®¹ï¼š\n[root@localhost ~]#vim /etc/gshadow root::: bin:::bin, daemon daemon:::bin, daemon ...çœç•¥éƒ¨åˆ†è¾“å‡º... lamp:!:: æ–‡ä»¶ä¸­ï¼Œæ¯è¡Œä»£è¡¨ä¸€ä¸ªç»„ç”¨æˆ·çš„å¯†ç ä¿¡æ¯ï¼Œå„è¡Œä¿¡æ¯ç”¨ \u0026ldquo;:\u0026rdquo; ä½œä¸ºåˆ†éš”ç¬¦åˆ†ä¸º 4 ä¸ªå­—æ®µï¼Œæ¯ä¸ªå­—æ®µçš„å«ä¹‰å¦‚ä¸‹ï¼š ç»„åï¼šåŠ å¯†å¯†ç ï¼šç»„ç®¡ç†å‘˜ï¼šç»„é™„åŠ ç”¨æˆ·åˆ—è¡¨\n1). ç»„å åŒ /etc/group æ–‡ä»¶ä¸­çš„ç»„åç›¸å¯¹åº”ã€‚\n2). ç»„å¯†ç  å¯¹äºå¤§å¤šæ•°ç”¨æˆ·æ¥è¯´ï¼Œé€šå¸¸ä¸è®¾ç½®ç»„å¯†ç ï¼Œå› æ­¤è¯¥å­—æ®µå¸¸ä¸ºç©ºï¼Œä½†æœ‰æ—¶ä¸º \u0026ldquo;!\u0026quot;ï¼ŒæŒ‡çš„æ˜¯è¯¥ç¾¤ç»„æ²¡æœ‰ç»„å¯†ç ï¼Œä¹Ÿä¸è®¾æœ‰ç¾¤ç»„ç®¡ç†å‘˜ã€‚\n3). ç»„ç®¡ç†å‘˜ ä»ç³»ç»Ÿç®¡ç†å‘˜çš„è§’åº¦æ¥è¯´ï¼Œè¯¥æ–‡ä»¶æœ€å¤§çš„åŠŸèƒ½å°±æ˜¯åˆ›å»ºç¾¤ç»„ç®¡ç†å‘˜ã€‚é‚£ä¹ˆï¼Œä»€ä¹ˆæ˜¯ç¾¤ç»„ç®¡ç†å‘˜å‘¢ï¼Ÿ\nè€ƒè™‘åˆ° Linux ç³»ç»Ÿä¸­è´¦å·å¤ªå¤šï¼Œè€Œè¶…çº§ç®¡ç†å‘˜ root å¯èƒ½æ¯”è¾ƒå¿™ç¢Œï¼Œå› æ­¤å½“æœ‰ç”¨æˆ·æƒ³è¦åŠ å…¥æŸç¾¤ç»„æ—¶ï¼Œroot æˆ–è®¸ä¸èƒ½åŠæ—¶ä½œå‡ºå›åº”ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœæœ‰ç¾¤ç»„ç®¡ç†å‘˜ï¼Œé‚£ä¹ˆä»–å°±èƒ½å°†ç”¨æˆ·åŠ å…¥è‡ªå·±ç®¡ç†çš„ç¾¤ç»„ä¸­ï¼Œä¹Ÿå°±å…å»éº»çƒ¦ root äº†ã€‚\nä¸è¿‡ï¼Œç”±äºç›®å‰æœ‰ sudo ä¹‹ç±»çš„å·¥å…·ï¼Œå› æ­¤ç¾¤ç»„ç®¡ç†å‘˜çš„è¿™ä¸ªåŠŸèƒ½å·²ç»å¾ˆå°‘ä½¿ç”¨äº†ã€‚\n4). ç»„ä¸­çš„é™„åŠ ç”¨æˆ· è¯¥å­—æ®µæ˜¾ç¤ºè¿™ä¸ªç”¨æˆ·ç»„ä¸­æœ‰å“ªäº›é™„åŠ ç”¨æˆ·ï¼Œå’Œ /etc/group æ–‡ä»¶ä¸­é™„åŠ ç»„æ˜¾ç¤ºå†…å®¹ç›¸åŒã€‚\n8. åˆå§‹ç»„å’Œé™„åŠ ç»„ é€šè¿‡å­¦ä¹ ç”¨æˆ·å’Œç¾¤ç»„æˆ‘ä»¬çŸ¥é“ï¼Œç¾¤ç»„å¯ä»¥è®©å¤šä¸ªç”¨æˆ·å…·æœ‰ç›¸åŒçš„æƒé™ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥è¿™æ ·ç†è§£ï¼Œä¸€ä¸ªç”¨æˆ·å¯ä»¥æ‰€å±å¤šä¸ªç¾¤ç»„ï¼Œå¹¶åŒæ—¶æ‹¥æœ‰è¿™äº›ç¾¤ç»„çš„æƒé™ï¼Œè¿™å°±å¼•å‡ºäº†åˆå§‹ç»„ï¼ˆæœ‰æ—¶ä¹Ÿç§°ä¸»ç»„ï¼‰å’Œé™„åŠ ç»„ã€‚\n/etc/passwd æ–‡ä»¶ä¸­æ¯ä¸ªç”¨æˆ·ä¿¡æ¯åˆ†ä¸º 7 ä¸ªå­—æ®µï¼Œå…¶ä¸­ç¬¬ 4 å­—æ®µï¼ˆGIDï¼‰æŒ‡çš„å°±æ˜¯æ¯ä¸ªç”¨æˆ·æ‰€å±çš„åˆå§‹ç»„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ç”¨æˆ·ä¸€ç™»é™†ç³»ç»Ÿï¼Œç«‹åˆ»å°±ä¼šæ‹¥æœ‰è¿™ä¸ªç¾¤ç»„çš„ç›¸å…³æƒé™ã€‚\nä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ªç”¨æˆ· lampï¼Œå¹¶å°†å…¶åŠ å…¥ users ç¾¤ç»„ä¸­ï¼Œæ‰§è¡Œå‘½ä»¤å¦‚ä¸‹ï¼š\n[root@localhost ~]# useradd lamp \u0026lt;--æ·»åŠ æ–°ç”¨æˆ· [root@localhost ~]# groupadd users \u0026lt;--æ·»åŠ æ–°ç¾¤ç»„ [root@localhost ~]# usermod -G users lamp \u0026lt;--å°†ç”¨æˆ·lampåŠ å…¥ usersç¾¤ç»„ [root@localhost ~]# grep \u0026#34;lamp\u0026#34; /etc/passwd /etc/group /etc/gshadow /etc/passwd:lamp:x:501:501::/home/lamp:/bin/bash /etc/group:users:x:100:lamp /etc/group:lamp:x:501: /etc/gshadow:users:::lamp /etc/gshadow:lamp:!:: useradd å’Œ groupadd åˆ†åˆ«æ˜¯æ·»åŠ ç”¨æˆ·å’Œç¾¤ç»„çš„å‘½ä»¤ï¼Œåç»­ç« èŠ‚ä¼šåšè¯¦ç»†è®²è§£ã€‚\nå¯ä»¥çœ‹åˆ°ï¼Œåœ¨ etc/passwd æ–‡ä»¶ä¸­ï¼Œlamp ç”¨æˆ·æ‰€å±çš„ GIDï¼ˆç¾¤ç»„ IDï¼‰ä¸º 501ï¼Œé€šè¿‡æœç´¢ /etc/group æ–‡ä»¶å¾—çŸ¥ï¼Œå¯¹åº”æ­¤ GID çš„æ˜¯ lamp ç¾¤ç»„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œlamp ç¾¤ç»„æ˜¯ lamp ç”¨æˆ·çš„åˆå§‹ç»„ã€‚\nlamp ç¾¤ç»„æ˜¯æ·»åŠ  lamp ç”¨æˆ·æ—¶é»˜è®¤åˆ›å»ºçš„ç¾¤ç»„ï¼Œåœ¨ root ç®¡ç†å‘˜ä½¿ç”¨ useradd å‘½ä»¤åˆ›å»ºæ–°ç”¨æˆ·æ—¶ï¼Œè‹¥æœªæ˜ç¡®æŒ‡å®šè¯¥å‘½ä»¤æ‰€å±çš„åˆå§‹ç»„ï¼Œuseradd å‘½ä»¤ä¼šé»˜è®¤åˆ›å»ºä¸€ä¸ªåŒç”¨æˆ·åç›¸åŒçš„ç¾¤ç»„ï¼Œä½œä¸ºè¯¥ç”¨æˆ·çš„åˆå§‹ç»„ã€‚\næ­£å› ä¸º lamp ç¾¤ç»„æ˜¯ lamp ç”¨æˆ·çš„åˆå§‹ç»„ï¼Œè¯¥ç”¨æˆ·ä¸€ç™»é™†å°±ä¼šè‡ªåŠ¨è·å–ç›¸åº”æƒé™ï¼Œå› æ­¤ä¸éœ€è¦åœ¨ /etc/group çš„ç¬¬ 4 ä¸ªå­—æ®µé¢å¤–æ ‡æ³¨ã€‚\nä½†æ˜¯ï¼Œé™„åŠ ç»„å°±ä¸ä¸€æ ·äº†ï¼Œä»ä¾‹å­ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬å°† lamp ç”¨æˆ·åŠ å…¥ users ç¾¤ç»„ä¸­ï¼Œç”±äº users è¿™ä¸ªç¾¤ç»„å¹¶ä¸æ˜¯ lamp çš„åˆå§‹ç»„ï¼Œå› æ­¤å¿…é¡»è¦åœ¨ /etc/group è¿™ä¸ªæ–‡ä»¶ä¸­æ‰¾åˆ° users é‚£ä¸€è¡Œï¼Œå°† lamp è¿™ä¸ªç”¨æˆ·åŠ å…¥ç¬¬ 4 æ®µä¸­ï¼ˆç¾¤ç»„åŒ…å«çš„æ‰€æœ‰ç”¨æˆ·ï¼‰ï¼Œè¿™æ · lamp ç”¨æˆ·æ‰ç®—æ˜¯çœŸæ­£åŠ å…¥åˆ° users è¿™ä¸ªç¾¤ç»„ä¸­ã€‚\nåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå› ä¸º lamp ç”¨æˆ·åŒæ—¶å±äº lamp å’Œusers ä¸¤ä¸ªç¾¤ç»„ï¼Œæ‰€åœ¨ï¼Œåœ¨è¯»å–\\å†™å…¥\\è¿è¡Œæ–‡ä»¶æ—¶ï¼Œåªè¦æ˜¯ user å’Œ lamp ç¾¤ç»„æ‹¥æœ‰çš„åŠŸèƒ½ï¼Œlamp ç”¨æˆ·éƒ½æ‹¥æœ‰ã€‚\nä¸€ä¸ªç”¨æˆ·å¯ä»¥æ‰€å±å¤šä¸ªé™„åŠ ç»„ï¼Œä½†åªèƒ½æœ‰ä¸€ä¸ªåˆå§‹ç»„ã€‚é‚£ä¹ˆï¼Œå¦‚ä½•çŸ¥é“æŸç”¨æˆ·æ‰€å±å“ªäº›ç¾¤ç»„å‘¢ï¼Ÿä½¿ç”¨ groups å‘½ä»¤å³å¯ã€‚\nä¾‹å¦‚ï¼Œæˆ‘ä»¬ç°åœ¨ä»¥ lamp ç”¨æˆ·çš„èº«ä»½ç™»å½•ç³»ç»Ÿï¼Œé€šè¿‡æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å³å¯çŸ¥æ™“å½“å‰ç”¨æˆ·æ‰€å±çš„å…¨éƒ¨ç¾¤ç»„ï¼š\n[root@localhost ~]# groups lamp users é€šè¿‡ä»¥ä¸Šè¾“å‡ºä¿¡æ¯å¯ä»¥å¾—çŸ¥ï¼Œlamp ç”¨æˆ·åŒæ—¶å±äº lamp ç¾¤ç»„å’Œ users ç¾¤ç»„ï¼Œè€Œä¸”ï¼Œç¬¬ä¸€ä¸ªå‡ºç°çš„ä¸ºç”¨æˆ·çš„åˆå§‹ç»„ï¼Œåé¢çš„éƒ½æ˜¯é™„åŠ ç»„ï¼Œæ‰€ä»¥ lamp ç”¨æˆ·çš„åˆå§‹ç»„ä¸º lamp ç¾¤ç»„ï¼Œé™„åŠ ç»„ä¸º users ç¾¤ç»„ã€‚\n9. useraddå‘½ä»¤ Linux ç³»ç»Ÿä¸­ï¼Œå¯ä»¥ä½¿ç”¨ useradd å‘½ä»¤æ–°å»ºç”¨æˆ·ï¼Œæ­¤å‘½ä»¤çš„åŸºæœ¬æ ¼å¼å¦‚ä¸‹ï¼š\n[root@localhost ~]#useradd [é€‰é¡¹] ç”¨æˆ·å    é€‰é¡¹ å«ä¹‰     -u UID æ‰‹å·¥æŒ‡å®šç”¨æˆ·çš„ UIDï¼Œæ³¨æ„ UID çš„èŒƒå›´ï¼ˆä¸è¦å°äº 500ï¼‰ã€‚   -d ä¸»ç›®å½• æ‰‹å·¥æŒ‡å®šç”¨æˆ·çš„ä¸»ç›®å½•ã€‚ä¸»ç›®å½•å¿…é¡»å†™ç»å¯¹è·¯å¾„ï¼Œè€Œä¸”å¦‚æœéœ€è¦æ‰‹å·¥æŒ‡å®šä¸»ç›®å½•ï¼Œåˆ™ä¸€å®šè¦æ³¨æ„æƒé™ï¼›   -c ç”¨æˆ·è¯´æ˜ æ‰‹å·¥æŒ‡å®š/etc/passwdæ–‡ä»¶ä¸­å„ç”¨æˆ·ä¿¡æ¯ä¸­ç¬¬ 5 ä¸ªå­—æ®µçš„æè¿°æ€§å†…å®¹ï¼Œå¯éšæ„é…ç½®ï¼›   -g ç»„å æ‰‹å·¥æŒ‡å®šç”¨æˆ·çš„åˆå§‹ç»„ã€‚ä¸€èˆ¬ä»¥å’Œç”¨æˆ·åç›¸åŒçš„ç»„ä½œä¸ºç”¨æˆ·çš„åˆå§‹ç»„ï¼Œåœ¨åˆ›å»ºç”¨æˆ·æ—¶ä¼šé»˜è®¤å»ºç«‹åˆå§‹ç»„ã€‚ä¸€æ—¦æ‰‹åŠ¨æŒ‡å®šï¼Œåˆ™ç³»ç»Ÿå°†ä¸ä¼šåœ¨åˆ›å»ºæ­¤é»˜è®¤çš„åˆå§‹ç»„ç›®å½•ã€‚   -G ç»„å æŒ‡å®šç”¨æˆ·çš„é™„åŠ ç»„ã€‚æˆ‘ä»¬æŠŠç”¨æˆ·åŠ å…¥å…¶ä»–ç»„ï¼Œä¸€èˆ¬éƒ½ä½¿ç”¨é™„åŠ ç»„ï¼›   -s shell æ‰‹å·¥æŒ‡å®šç”¨æˆ·çš„ç™»å½• Shellï¼Œé»˜è®¤æ˜¯ /bin/bashï¼›   -e æ›°æœŸ æŒ‡å®šç”¨æˆ·çš„å¤±æ•ˆæ›°æœŸï¼Œæ ¼å¼ä¸º \u0026ldquo;YYYY-MM-DD\u0026rdquo;ã€‚ä¹Ÿå°±æ˜¯ /etc/shadow æ–‡ä»¶çš„ç¬¬å…«ä¸ªå­—æ®µï¼›   -o å…è®¸åˆ›å»ºçš„ç”¨æˆ·çš„ UID ç›¸åŒã€‚ä¾‹å¦‚ï¼Œæ‰§è¡Œ \u0026ldquo;useradd -u 0 -o usertest\u0026rdquo; å‘½ä»¤å»ºç«‹ç”¨æˆ· usertestï¼Œå®ƒçš„ UID å’Œ root ç”¨æˆ·çš„ UID ç›¸åŒï¼Œéƒ½æ˜¯ 0ï¼›   -m å»ºç«‹ç”¨æˆ·æ—¶å¼ºåˆ¶å»ºç«‹ç”¨æˆ·çš„å®¶ç›®å½•ã€‚åœ¨å»ºç«‹ç³»ç»Ÿç”¨æˆ·æ—¶ï¼Œè¯¥é€‰é¡¹æ˜¯é»˜è®¤çš„ï¼›   -r åˆ›å»ºç³»ç»Ÿç”¨æˆ·ï¼Œä¹Ÿå°±æ˜¯ UID åœ¨ 1~499 ä¹‹é—´ï¼Œä¾›ç³»ç»Ÿç¨‹åºä½¿ç”¨çš„ç”¨æˆ·ã€‚ç”±äºç³»ç»Ÿç”¨æˆ·ä¸»è¦ç”¨äºè¿è¡Œç³»ç»Ÿæ‰€éœ€æœåŠ¡çš„æƒé™é…ç½®ï¼Œå› æ­¤ç³»ç»Ÿç”¨æˆ·çš„åˆ›å»ºé»˜è®¤ä¸ä¼šåˆ›å»ºä¸»ç›®å½•ã€‚    å…¶å®ï¼Œç³»ç»Ÿå·²ç»å¸®æˆ‘ä»¬è§„å®šäº†éå¸¸å¤šçš„é»˜è®¤å€¼ï¼Œåœ¨æ²¡æœ‰ç‰¹æ®Šè¦æ±‚ä¸‹ï¼Œæ— éœ€ä½¿ç”¨ä»»ä½•é€‰é¡¹å³å¯æˆåŠŸåˆ›å»ºç”¨æˆ·ã€‚ä¾‹å¦‚ï¼š\n[root@localhost ~]# useradd lamp æ­¤è¡Œå‘½ä»¤å°±è¡¨ç¤ºåˆ›å»º lamp æ™®é€šç”¨æˆ·ã€‚\n10. passwdå‘½ä»¤ï¼šä¿®æ”¹ç”¨æˆ·å¯†ç  å­¦ä¹  useradd å‘½ä»¤æˆ‘ä»¬çŸ¥é“ï¼Œä½¿ç”¨æ­¤å‘½ä»¤åˆ›å»ºæ–°ç”¨æˆ·æ—¶ï¼Œå¹¶æ²¡æœ‰è®¾å®šç”¨æˆ·å¯†ç ï¼Œå› æ­¤è¿˜æ— æ³•ç”¨æ¥ç™»é™†ç³»ç»Ÿï¼Œæœ¬èŠ‚å°±æ¥å­¦ä¹  passwd å¯†ç é…ç½®å‘½ä»¤ ã€‚\npasswd å‘½ä»¤çš„åŸºæœ¬æ ¼å¼å¦‚ä¸‹ï¼š\n[root@localhost ~]#passwd [é€‰é¡¹] ç”¨æˆ·å é€‰é¡¹ï¼š\n -Sï¼šæŸ¥è¯¢ç”¨æˆ·å¯†ç çš„çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯ /etc/shadow æ–‡ä»¶ä¸­æ­¤ç”¨æˆ·å¯†ç çš„å†…å®¹ã€‚ä»… root ç”¨æˆ·å¯ç”¨ï¼› -lï¼šæš‚æ—¶é”å®šç”¨æˆ·ï¼Œè¯¥é€‰é¡¹ä¼šåœ¨ /etc/shadow æ–‡ä»¶ä¸­æŒ‡å®šç”¨æˆ·çš„åŠ å¯†å¯†ç ä¸²å‰æ·»åŠ  \u0026ldquo;!\u0026quot;ï¼Œä½¿å¯†ç å¤±æ•ˆã€‚ä»… root ç”¨æˆ·å¯ç”¨ï¼› -uï¼šè§£é”ç”¨æˆ·ï¼Œå’Œ -l é€‰é¡¹ç›¸å¯¹åº”ï¼Œä¹Ÿæ˜¯åªèƒ½ root ç”¨æˆ·ä½¿ç”¨ï¼› \u0026ndash;stdinï¼šå¯ä»¥å°†é€šè¿‡ç®¡é“ç¬¦è¾“å‡ºçš„æ•°æ®ä½œä¸ºç”¨æˆ·çš„å¯†ç ã€‚ä¸»è¦åœ¨æ‰¹é‡æ·»åŠ ç”¨æˆ·æ—¶ä½¿ç”¨ï¼› -n å¤©æ•°ï¼šè®¾ç½®è¯¥ç”¨æˆ·ä¿®æ”¹å¯†ç åï¼Œå¤šé•¿æ—¶é—´ä¸èƒ½å†æ¬¡ä¿®æ”¹å¯†ç ï¼Œä¹Ÿå°±æ˜¯ä¿®æ”¹ /etc/shadow æ–‡ä»¶ä¸­å„è¡Œå¯†ç çš„ç¬¬ 4 ä¸ªå­—æ®µï¼› -x å¤©æ•°ï¼šè®¾ç½®è¯¥ç”¨æˆ·çš„å¯†ç æœ‰æ•ˆæœŸï¼Œå¯¹åº” /etc/shadow æ–‡ä»¶ä¸­å„è¡Œå¯†ç çš„ç¬¬ 5 ä¸ªå­—æ®µï¼› -w å¤©æ•°ï¼šè®¾ç½®ç”¨æˆ·å¯†ç è¿‡æœŸå‰çš„è­¦å‘Šå¤©æ•°ï¼Œå¯¹äº /etc/shadow æ–‡ä»¶ä¸­å„è¡Œå¯†ç çš„ç¬¬ 6 ä¸ªå­—æ®µï¼› -i æ—¥æœŸï¼šè®¾ç½®ç”¨æˆ·å¯†ç å¤±æ•ˆæ—¥æœŸï¼Œå¯¹åº” /etc/shadow æ–‡ä»¶ä¸­å„è¡Œå¯†ç çš„ç¬¬ 7 ä¸ªå­—æ®µã€‚ ä¾‹å¦‚ï¼Œæˆ‘ä»¬ä½¿ç”¨ root è´¦æˆ·ä¿®æ”¹ lamp æ™®é€šç”¨æˆ·çš„å¯†ç ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š  [root@localhost ~]#passwd lamp Changing password for user lamp. New password: \u0026lt;==ç›´æ¥è¾“å…¥æ–°çš„å£ä»¤ï¼Œä½†å±å¹•ä¸ä¼šæœ‰ä»»ä½•ååº” BAD PASSWORD: it is WAY too short \u0026lt;==å£ä»¤å¤ªç®€å•æˆ–è¿‡çŸ­çš„é”™è¯¯ï¼è¿™é‡Œåªæ˜¯è­¦å‘Šä¿¡æ¯ï¼Œè¾“å…¥çš„å¯†ç ä¾æ—§èƒ½ç”¨ Retype new password: \u0026lt;==å†æ¬¡éªŒè¯è¾“å…¥çš„å¯†ç ï¼Œå†è¾“å…¥ä¸€æ¬¡å³å¯ passwd: all authentication tokens updated successfully. \u0026lt;==æç¤ºä¿®æ”¹å¯†ç æˆåŠŸ å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ passwd å‘½ä»¤ä¿®æ”¹å½“å‰ç³»ç»Ÿå·²ç™»å½•ç”¨æˆ·çš„å¯†ç ï¼Œä½†è¦æ³¨æ„çš„æ˜¯ï¼Œéœ€çœç•¥æ‰ \u0026ldquo;é€‰é¡¹\u0026rdquo; å’Œ \u0026ldquo;ç”¨æˆ·å\u0026rdquo;ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬ç™»é™† lamp ç”¨æˆ·ï¼Œå¹¶ä½¿ç”¨ passwd å‘½ä»¤ä¿®æ”¹ lamp çš„ç™»é™†å¯†ç ï¼Œæ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š\n[root@localhost ~]#passwd # passwdç›´æ¥å›è½¦ä»£è¡¨ä¿®æ”¹å½“å‰ç”¨æˆ·çš„å¯†ç  Changing password for user vbird2. Changing password for vbird2 (current) UNIX password: \u0026lt;==è¿™é‡Œè¾“å…¥ã€åŸæœ‰çš„æ—§å£ä»¤ã€ New password: \u0026lt;==è¿™é‡Œè¾“å…¥æ–°å£ä»¤ BAD PASSWORD: it is WAY too short \u0026lt;==å£ä»¤æ£€éªŒä¸é€šè¿‡ï¼Œè¯·å†æƒ³ä¸ªæ–°å£ä»¤ New password: \u0026lt;==è¿™é‡Œå†æƒ³ä¸ªæ¥è¾“å…¥å§ Retype new password: \u0026lt;==é€šè¿‡å£ä»¤éªŒè¯ï¼æ‰€ä»¥é‡å¤è¿™ä¸ªå£ä»¤çš„è¾“å…¥ passwd: all authentication tokens updated successfully. \u0026lt;==æˆåŠŸä¿®æ”¹ç”¨æˆ·å¯†ç  æ³¨æ„ï¼Œæ™®é€šç”¨æˆ·åªèƒ½ä½¿ç”¨ passwd å‘½ä»¤ä¿®æ”¹è‡ªå·±çš„å¯†ç ï¼Œè€Œä¸èƒ½ä¿®æ”¹å…¶ä»–ç”¨æˆ·çš„å¯†ç ã€‚\nå¯ä»¥çœ‹åˆ°ï¼Œä¸ä½¿ç”¨ root è´¦æˆ·ä¿®æ”¹æ™®é€šç”¨æˆ·çš„å¯†ç ä¸åŒï¼Œæ™®é€šç”¨æˆ·ä¿®æ”¹è‡ªå·±çš„å¯†ç éœ€è¦å…ˆè¾“å…¥è‡ªå·±çš„æ—§å¯†ç ï¼Œåªæœ‰æ—§å¯†ç è¾“å…¥æ­£ç¡®æ‰èƒ½è¾“å…¥æ–°å¯†ç ã€‚ä¸ä»…å¦‚æ­¤ï¼Œæ­¤ç§ä¿®æ”¹æ–¹å¼å¯¹å¯†ç çš„å¤æ‚åº¦æœ‰ä¸¥æ ¼çš„è¦æ±‚ï¼Œæ–°å¯†ç å¤ªçŸ­ã€å¤ªç®€å•ï¼Œéƒ½ä¼šè¢«ç³»ç»Ÿæ£€æµ‹å‡ºæ¥å¹¶ç¦æ­¢ç”¨æˆ·ä½¿ç”¨ã€‚ å¾ˆå¤šLinux å‘è¡Œç‰ˆä¸ºäº†ç³»ç»Ÿå®‰è£…ï¼Œéƒ½ä½¿ç”¨äº† PAM æ¨¡å—è¿›è¡Œå¯†ç çš„æ£€éªŒï¼Œè®¾ç½®å¯†ç å¤ªçŸ­ã€ä¸ç”¨æˆ·åç›¸åŒã€æ˜¯å¸¸è§å­—ç¬¦ä¸²ç­‰ï¼Œéƒ½ä¼šè¢« PAM æ¨¡å—æ£€æŸ¥å‡ºæ¥ï¼Œä»è€Œç¦æ­¢ç”¨æˆ·ä½¿ç”¨æ­¤ç±»å¯†ç ã€‚\nè€Œä½¿ç”¨ root ç”¨æˆ·ï¼Œæ— è®ºæ˜¯ä¿®æ”¹æ™®é€šç”¨æˆ·çš„å¯†ç ï¼Œè¿˜æ˜¯ä¿®æ”¹è‡ªå·±çš„å¯†ç ï¼Œéƒ½å¯ä»¥ä¸éµå®ˆ PAM æ¨¡å—è®¾å®šçš„è§„åˆ™ï¼Œå°±æ¯”å¦‚æˆ‘åˆšåˆšç»™ lamp ç”¨æˆ·è®¾å®šçš„å¯†ç æ˜¯ \u0026ldquo;123\u0026rdquo;ï¼Œç³»ç»Ÿè™½ç„¶ä¼šæç¤ºå¯†ç è¿‡çŸ­å’Œè¿‡äºç®€å•ï¼Œä½†ä¾ç„¶å¯ä»¥è®¾ç½®æˆåŠŸã€‚å½“ç„¶ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œå°±ç®—æ˜¯ root èº«ä»½ï¼Œåœ¨è®¾å®šå¯†ç æ—¶ä¹Ÿè¦ä¸¥æ ¼éµå®ˆå¯†ç è§„èŒƒï¼Œå› ä¸ºåªæœ‰å¥½çš„å¯†ç è§„èŒƒæ‰æ˜¯æœåŠ¡å™¨å®‰å…¨çš„åŸºç¡€ã€‚\nå®ä¾‹ ã€ä¾‹ 1ã€‘\n# æŸ¥çœ‹ç”¨æˆ·å¯†ç çš„çŠ¶æ€ [root@localhost ~]# passwd -S lamp lamp PS 2013-01-06 0 99999 7 -1 (Password set, SHA512 crypt.) # ä¸Šé¢è¿™è¡Œä»£ç çš„æ„æ€ä¾æ¬¡æ˜¯ï¼šç”¨æˆ·å å¯†ç  è®¾å®šæ—¶é—´(2013*01-06) å¯†ç ä¿®æ”¹é—´éš”æ—¶é—´(0) å¯†ç æœ‰æ•ˆæœŸ(99999) è­¦å‘Šæ—¶é—´(7) å¯†ç ä¸å¤±æ•ˆ(-1)ï¼Œå¯†ç å·²ä½¿ç”¨ \u0026ldquo;-S\u0026quot;é€‰é¡¹ä¼šæ˜¾ç¤ºå‡ºå¯†ç çŠ¶æ€ï¼Œè¿™é‡Œçš„å¯†ç ä¿®æ”¹é—´éš”æ—¶é—´ã€å¯†ç æœ‰æ•ˆæœŸã€è­¦å‘Šæ—¶é—´ã€å¯†ç å®½é™æ—¶é—´å…¶å®åˆ†åˆ«æ˜¯ /etc/shadow æ–‡ä»¶çš„ç¬¬å››ã€äº”ã€å…­ã€ä¸ƒä¸ªå­—æ®µçš„å†…å®¹ã€‚ å½“ç„¶ï¼Œpasswd å‘½ä»¤æ˜¯å¯ä»¥é€šè¿‡å‘½ä»¤é€‰é¡¹ä¿®æ”¹è¿™å‡ ä¸ªå­—æ®µçš„å€¼çš„ï¼Œä¾‹å¦‚ï¼š\n# ä¿®æ”¹ lampçš„å¯†ç ï¼Œä½¿å…¶å…·æœ‰ 60 å¤©å˜æ›´ã€10 å¤©å¯†ç å¤±æ•ˆ [root@localhost ~]# passwd -x 60 -i 10 lamp [root@localhost ~]# passwd -S lamp lamp PS 2013-01-06 0 60 7 10 (Password set, SHA512 crypt.) ã€ä¾‹ 2ã€‘\n# é”å®š lamp ç”¨æˆ· [root@localhost ~]# passwd -l lamp Locking password for user lamp. passwd:Successg # ç”¨\u0026#34;-S\u0026#34;é€‰é¡¹æŸ»çœ‹çŠ¶æ€ï¼Œå¾ˆæ¸…æ¥šåœ°æç¤ºå¯†ç å·²è¢«é”å®š [root@localhost ~]# passwd -S lamp lamp LK 2013-01-06 0 99999 7 -1 (Password locked.) [root@localhost ~]# grep \u0026#34;lamp\u0026#34; /etc/shadow lamp:!! $6$ZTq7o/9o $lj07iZ0bzW.D1zBa9CsY43d04onskUCzjwiFMNt8PX4GXJoHX9zA1S C9.i Yzh9LZA4fEM2lg92hM9w/p6NS50.:15711:0:99999:7::: # å¯ä»¥çœ‹åˆ°ï¼Œé”å®šå…¶å®å°±æ˜¯åœ¨åŠ å¯†å¯†ç ä¹‹å‰åŠ å…¥äº†\u0026#34;!!\u0026#34;ï¼Œè®©å¯†ç å¤±æ•ˆè€Œå·² æš‚æ—¶é”å®š lamp ç”¨æˆ·åï¼Œæ­¤ç”¨æˆ·å°±ä¸èƒ½ç™»å½•ç³»ç»Ÿäº†ã€‚é‚£ä¹ˆï¼Œæ€ä¹ˆè§£é”å‘¢ï¼Ÿä¹Ÿä¸€æ ·ç®€å•ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å³å¯ï¼š\n# è§£é” lamp ç”¨æˆ· [root@localhost ~]# passwd -u lamp Unlocking password for user lamp. passwd:Success [root@localhost ~]# passwd -S lamp lamp PS 2013-01-06 0 99999 7 -1 (Password set, SHA512 crypt.) # å¯ä»¥çœ‹åˆ°ï¼Œé”å®šçŠ¶æ€æ¶ˆå¤± [root@localhost ~]# grep \u0026#34;lamp\u0026#34; /etc/shadow lamp: $6$ZTq7cV9o $lj07iZ0bzW.D1zBa9CsY43d04onskUCzjwiFMNt8PX4GXJoHX9zA1S C9.iYz h9LZA4fEM2lg92hM9w/p6NS50.:15711:0:99999:7::: # å¯†ç å‰é¢çš„ \u0026#34;!!\u0026#34; åˆ é™¤äº† 11. usermodå‘½ä»¤ï¼šä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ å‰é¢ç« èŠ‚ä»‹ç»äº†å¦‚ä½•åˆ©ç”¨ useradd å‘½ä»¤æ·»åŠ ç”¨æˆ·ï¼Œä½†å¦‚æœä¸å°å¿ƒæ·»é”™ç”¨æˆ·ä¿¡æ¯ï¼ŒåæœŸå¦‚ä½•ä¿®æ”¹å‘¢ï¼Ÿ\nåŠæ³•æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯ä½¿ç”¨ Vim æ–‡æœ¬ç¼–è¾‘å™¨æ‰‹åŠ¨ä¿®æ”¹æ¶‰åŠç”¨æˆ·ä¿¡æ¯çš„ç›¸å…³æ–‡ä»¶ï¼ˆ/etc/passwdã€/etc/shadowã€/etc/groupã€/etc/gshadowï¼‰ï¼Œå¦ä¸€ä¸ªæ–¹æ³•å°±æ˜¯ä½¿ç”¨æœ¬èŠ‚ä»‹ç»äº† usermod å‘½ä»¤ï¼Œè¯¥å‘½ä»¤ä¸“é—¨ç”¨äºä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ã€‚ è¿™é‡Œä¸€å®šè¦åˆ†æ¸… useradd å‘½ä»¤å’Œ usermod å‘½ä»¤çš„åŒºåˆ«ï¼Œå‰è€…ç”¨äºæ·»åŠ ç”¨æˆ·ï¼Œå½“ç„¶ï¼Œæ·»åŠ ç”¨æˆ·æ—¶å¯ä»¥å¯¹ç”¨æˆ·ä¿¡æ¯è¿›è¡Œå®šåˆ¶ï¼›åè€…é’ˆå¯¹ä¸å·²å­˜åœ¨çš„ç”¨æˆ·ï¼Œä½¿ç”¨è¯¥å‘½ä»¤å¯ä»¥ä¿®æ”¹å®ƒä»¬çš„ä¿¡æ¯ã€‚\nusermod å‘½ä»¤çš„åŸºæœ¬æ ¼å¼å¦‚ä¸‹ï¼š\n[root@localhost ~]#usermod [é€‰é¡¹] ç”¨æˆ·å é€‰é¡¹ï¼š\n -c ç”¨æˆ·è¯´æ˜ï¼šä¿®æ”¹ç”¨æˆ·çš„è¯´æ˜ä¿¡æ¯ï¼Œå³ä¿®æ”¹ /etc/passwd æ–‡ä»¶ç›®æ ‡ç”¨æˆ·ä¿¡æ¯çš„ç¬¬ 5 ä¸ªå­—æ®µï¼› -d ä¸»ç›®å½•ï¼šä¿®æ”¹ç”¨æˆ·çš„ä¸»ç›®å½•ï¼Œå³ä¿®æ”¹ /etc/passwd æ–‡ä»¶ä¸­ç›®æ ‡ç”¨æˆ·ä¿¡æ¯çš„ç¬¬ 6 ä¸ªå­—æ®µï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸»ç›®å½•å¿…é¡»å†™ç»å¯¹è·¯å¾„ï¼› -e æ—¥æœŸï¼šä¿®æ”¹ç”¨æˆ·çš„å¤±æ•ˆæ›°æœŸï¼Œæ ¼å¼ä¸º \u0026ldquo;YYYY-MM-DD\u0026rdquo;ï¼Œå³ä¿®æ”¹ /etc/shadow æ–‡ä»¶ç›®æ ‡ç”¨æˆ·å¯†ç ä¿¡æ¯çš„ç¬¬ 8 ä¸ªå­—æ®µï¼› -g ç»„åï¼šä¿®æ”¹ç”¨æˆ·çš„åˆå§‹ç»„ï¼Œå³ä¿®æ”¹ /etc/passwd æ–‡ä»¶ç›®æ ‡ç”¨æˆ·ä¿¡æ¯çš„ç¬¬ 4 ä¸ªå­—æ®µï¼ˆGIDï¼‰ï¼› -u UIDï¼šä¿®æ”¹ç”¨æˆ·çš„UIDï¼Œå³ä¿®æ”¹ /etc/passwd æ–‡ä»¶ç›®æ ‡ç”¨æˆ·ä¿¡æ¯çš„ç¬¬ 3 ä¸ªå­—æ®µï¼ˆUIDï¼‰ï¼› -G ç»„åï¼šä¿®æ”¹ç”¨æˆ·çš„é™„åŠ ç»„ï¼Œå…¶å®å°±æ˜¯æŠŠç”¨æˆ·åŠ å…¥å…¶ä»–ç”¨æˆ·ç»„ï¼Œå³ä¿®æ”¹ /etc/group æ–‡ä»¶ï¼› -l ç”¨æˆ·åï¼šä¿®æ”¹ç”¨æˆ·åç§°ï¼› -Lï¼šä¸´æ—¶é”å®šç”¨æˆ·ï¼ˆLockï¼‰ï¼› -Uï¼šè§£é”ç”¨æˆ·ï¼ˆUnlockï¼‰ï¼Œå’Œ -L å¯¹åº”ï¼› -s shellï¼šä¿®æ”¹ç”¨æˆ·çš„ç™»å½• Shellï¼Œé»˜è®¤æ˜¯ /bin/bashã€‚  å¦‚æœä½ ä»”ç»†è§‚å¯Ÿä¼šå‘ç°ï¼Œå…¶å® usermod å‘½ä»¤æä¾›çš„é€‰é¡¹å’Œ useradd å‘½ä»¤çš„é€‰é¡¹ç›¸ä¼¼ï¼Œå› ä¸º usermod å‘½ä»¤å°±æ˜¯ç”¨æ¥è°ƒæ•´ä½¿ç”¨ useradd å‘½ä»¤æ·»åŠ çš„ç”¨æˆ·ä¿¡æ¯çš„ã€‚\nä¸è¿‡ï¼Œç›¸æ¯” useradd å‘½ä»¤ï¼Œusermod å‘½ä»¤è¿˜å¤šå‡ºäº†å‡ ä¸ªé€‰é¡¹ï¼Œå³ -L å’Œ -Uï¼Œä½œç”¨åˆ†åˆ«ä¸ passwd å‘½ä»¤çš„ -l å’Œ-u ç›¸åŒã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„ Linux å‘è¡Œç‰ˆéƒ½åŒ…å«è¿™ä¸ªå‘½ä»¤ï¼Œå› æ­¤ï¼Œä½¿ç”¨å‰å¯ä»¥ä½¿ç”¨ man usermod å‘½ä»¤ç¡®å®šç³»ç»Ÿæ˜¯å¦æ”¯æŒã€‚\n æ­¤å‘½ä»¤å¯¹ç”¨æˆ·çš„ä¸´æ—¶é”å®šï¼ŒåŒ passwd å‘½ä»¤ä¸€æ ·ï¼Œéƒ½æ˜¯åœ¨ /etc/passwd æ–‡ä»¶ç›®æ ‡ç”¨æˆ·çš„åŠ å¯†å¯†ç å­—æ®µå‰æ·»åŠ  \u0026ldquo;!\u0026quot;ï¼Œä½¿å¯†ç å¤±æ•ˆï¼›åä¹‹ï¼Œè§£é”ç”¨æˆ·å°±æ˜¯å°†æ·»åŠ çš„ \u0026ldquo;!\u0026rdquo; å»æ‰ã€‚\n å®ä¾‹ ã€ä¾‹ 1ã€‘\n# é”å®šç”¨æˆ· [root@localhost ~]# usermod -L lamp [root@localhost ~]# grep \u0026#34;lamp\u0026#34; /etc/shadow lamp:!$6$YrPj8g0w$ChRVASybEncU24hkYFqxREH3NnzhAVDJSQLwRwTSbcA2N8UbPD9bBKVQSky xlaMGs/Eg5AQwO.UokOnKqaHFa/:15711:0:99999:7::: # å…¶å®é”å®šå°±æ˜¯åœ¨å¯†ç å­—æ®µå‰åŠ å…¥\u0026#34;!\u0026#34;ï¼Œè¿™æ—¶lampç”¨æˆ·å°±æš‚æ—¶ä¸èƒ½ç™»å½•äº† # è§£é”ç”¨æˆ· [root@localhost ~]# usermod -U lamp [root@localhost ~]# grep \u0026#34;lamp\u0026#34; /etc/shadow lamp:$6$YrPj8g0w$ChRVASybEncU24hkYFqxREH3NnzhAVDJSQLwRwTSbcA2N8UbPD9bBKVQSkyx laMGs/Eg5AQwO.UokOnKqaHFa/:15711:0:99999:7::: # å–æ¶ˆäº†å¯†ç å­—æ®µå‰çš„ \u0026#34;!\u0026#34; ã€ä¾‹ 2ã€‘\n# æŠŠlampç”¨æˆ·åŠ å…¥rootç»„ [root@localhost ~]# usermod -G root lamp [root@localhost ~]# grep \u0026#34;lamp\u0026#34; /etc/group root:x:0:lamp # lampç”¨æˆ·å·²ç»åŠ å…¥äº†rootç»„ lamp:x:501: ã€ä¾‹ 3ã€‘\n# ä¿®æ”¹ç”¨æˆ·è¯´æ˜ [root@localhost ~]# usermod -c \u0026#34;test user\u0026#34; lamp [root@localhost ~]# grep \u0026#34;lamp\u0026#34; /etc/passwd lamp:x:501:501:test user:/home/lamp:/bin/bash # æŸ¥çœ‹ä¸€ä¸‹ï¼Œç”¨æˆ·è¯´æ˜å·²ç»è¢«ä¿®æ”¹äº† 12. chageå‘½ä»¤ï¼šä¿®æ”¹ç”¨æˆ·å¯†ç çŠ¶æ€ é™¤äº† passwd -S å‘½ä»¤å¯ä»¥æŸ¥çœ‹ç”¨æˆ·çš„å¯†ç ä¿¡æ¯å¤–ï¼Œè¿˜å¯ä»¥åˆ©ç”¨ chage å‘½ä»¤ï¼Œå®ƒå¯ä»¥æ˜¾ç¤ºæ›´åŠ è¯¦ç»†çš„ç”¨æˆ·å¯†ç ä¿¡æ¯ï¼Œå¹¶ä¸”å’Œ passwd å‘½ä»¤ä¸€æ ·ï¼Œæä¾›äº†ä¿®æ”¹ç”¨æˆ·å¯†ç ä¿¡æ¯çš„åŠŸèƒ½ã€‚ å¦‚æœä½ è¦ä¿®æ”¹ç”¨æˆ·çš„å¯†ç ä¿¡æ¯ï¼Œæˆ‘ä¸ªäººå»ºè®®ï¼Œè¿˜æ˜¯ç›´æ¥ä¿®æ”¹ /etc/shadow æ–‡ä»¶æ›´åŠ æ–¹ä¾¿ã€‚\né¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹ chage å‘½ä»¤çš„åŸºæœ¬æ ¼å¼ï¼š\n[root@localhost ~]#chage [é€‰é¡¹] ç”¨æˆ·å é€‰é¡¹ï¼š\n -lï¼šåˆ—å‡ºç”¨æˆ·çš„è¯¦ç»†å¯†ç çŠ¶æ€; -d æ—¥æœŸï¼šä¿®æ”¹ /etc/shadow æ–‡ä»¶ä¸­æŒ‡å®šç”¨æˆ·å¯†ç ä¿¡æ¯çš„ç¬¬ 3 ä¸ªå­—æ®µï¼Œä¹Ÿå°±æ˜¯æœ€åä¸€æ¬¡ä¿®æ”¹å¯†ç çš„æ—¥æœŸï¼Œæ ¼å¼ä¸º YYYY-MM-DDï¼› -m å¤©æ•°ï¼šä¿®æ”¹å¯†ç æœ€çŸ­ä¿ç•™çš„å¤©æ•°ï¼Œä¹Ÿå°±æ˜¯ /etc/shadow æ–‡ä»¶ä¸­çš„ç¬¬ 4 ä¸ªå­—æ®µï¼› -M å¤©æ•°ï¼šä¿®æ”¹å¯†ç çš„æœ‰æ•ˆæœŸï¼Œä¹Ÿå°±æ˜¯ /etc/shadow æ–‡ä»¶ä¸­çš„ç¬¬ 5 ä¸ªå­—æ®µï¼› -W å¤©æ•°ï¼šä¿®æ”¹å¯†ç åˆ°æœŸå‰çš„è­¦å‘Šå¤©æ•°ï¼Œä¹Ÿå°±æ˜¯ /etc/shadow æ–‡ä»¶ä¸­çš„ç¬¬ 6 ä¸ªå­—æ®µï¼› -i å¤©æ•°ï¼šä¿®æ”¹å¯†ç è¿‡æœŸåçš„å®½é™å¤©æ•°ï¼Œä¹Ÿå°±æ˜¯ /etc/shadow æ–‡ä»¶ä¸­çš„ç¬¬ 7 ä¸ªå­—æ®µï¼› -E æ—¥æœŸï¼šä¿®æ”¹è´¦å·å¤±æ•ˆæ—¥æœŸï¼Œæ ¼å¼ä¸º YYYY-MM-DDï¼Œä¹Ÿå°±æ˜¯ /etc/shadow æ–‡ä»¶ä¸­çš„ç¬¬ 8 ä¸ªå­—æ®µã€‚  ã€ä¾‹ 1ã€‘\n# æŸ¥çœ‹ä¸€ä¸‹ç”¨æˆ·å¯†ç çŠ¶æ€ [root@localhost ~]# chage -l lamp Last password change:Jan 06, 2013 Password expires:never Password inactive :never Account expires :never Minimum number of days between password change :0 Maximum number of days between password change :99999 Number of days of warning before password expires :7 13. userdelå‘½ä»¤ï¼šåˆ é™¤ç”¨æˆ· userdel å‘½ä»¤åŠŸèƒ½å¾ˆç®€å•ï¼Œå°±æ˜¯åˆ é™¤ç”¨æˆ·çš„ç›¸å…³æ•°æ®ã€‚æ­¤å‘½ä»¤åªæœ‰ root ç”¨æˆ·æ‰èƒ½ä½¿ç”¨ã€‚\né€šè¿‡å‰é¢çš„å­¦ä¹ æˆ‘ä»¬çŸ¥é“ï¼Œç”¨æˆ·çš„ç›¸å…³æ•°æ®åŒ…å«å¦‚ä¸‹å‡ é¡¹ï¼š\nç”¨æˆ·åŸºæœ¬ä¿¡æ¯ï¼šå­˜å‚¨åœ¨ /etc/passwd æ–‡ä»¶ä¸­ï¼› ç”¨æˆ·å¯†ç ä¿¡æ¯ï¼šå­˜å‚¨åœ¨ /etc/shadow æ–‡ä»¶ä¸­ï¼› ç”¨æˆ·ç¾¤ç»„åŸºæœ¬ä¿¡æ¯ï¼šå­˜å‚¨åœ¨ /etc/group æ–‡ä»¶ä¸­ï¼› ç”¨æˆ·ç¾¤ç»„ä¿¡æ¯ä¿¡æ¯ï¼šå­˜å‚¨åœ¨ /etc/gshadow æ–‡ä»¶ä¸­ï¼› ç”¨æˆ·ä¸ªäººæ–‡ä»¶ï¼šä¸»ç›®å½•é»˜è®¤ä½äº /home/ç”¨æˆ·åï¼Œé‚®ç®±ä½äº /var/spool/mail/ç”¨æˆ·åã€‚ å…¶å®ï¼Œuserdel å‘½ä»¤çš„ä½œç”¨å°±æ˜¯ä»ä»¥ä¸Šæ–‡ä»¶ä¸­ï¼Œåˆ é™¤ä¸æŒ‡å®šç”¨æˆ·æœ‰å…³çš„æ•°æ®ä¿¡æ¯ã€‚ userdel å‘½ä»¤çš„è¯­æ³•å¾ˆç®€å•ï¼ŒåŸºæœ¬æ ¼å¼å¦‚ä¸‹ï¼š\n[root@localhost ~]# userdel -r ç”¨æˆ·å  -r é€‰é¡¹è¡¨ç¤ºåœ¨åˆ é™¤ç”¨æˆ·çš„åŒæ—¶åˆ é™¤ç”¨æˆ·çš„å®¶ç›®å½•ã€‚  æ³¨æ„ï¼Œåœ¨åˆ é™¤ç”¨æˆ·çš„åŒæ—¶å¦‚æœä¸åˆ é™¤ç”¨æˆ·çš„å®¶ç›®å½•ï¼Œé‚£ä¹ˆå®¶ç›®å½•å°±ä¼šå˜æˆæ²¡æœ‰å±ä¸»å’Œå±ç»„çš„ç›®å½•ï¼Œä¹Ÿå°±æ˜¯åƒåœ¾æ–‡ä»¶ã€‚\nä¾‹å¦‚ï¼Œåˆ é™¤å‰é¢ç« èŠ‚ä¸­åˆ›å»ºçš„ lamp ç”¨æˆ·ï¼Œåªéœ€æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š\n[root@localhost ~]# userdel -r lamp æ‰‹åŠ¨åˆ é™¤æŒ‡å®šç”¨æˆ·çš„å…·ä½“æ“ä½œå¦‚ä¸‹\n# å»ºç«‹æ–° lamp ç”¨æˆ· [root@localhost ~]# useradd lamp [root@localhost ~]# passwd lamp # ä¸º lamp ç”¨æˆ·è®¾ç½®å¯†ç ï¼Œç”±æ­¤ lamp ç”¨æˆ·æ‰ç®—æ˜¯åˆ›å»ºæˆåŠŸ # ä¸‹é¢å¼€å§‹æ‰‹åŠ¨åˆ é™¤ lamp [root@localhost ~]# vi /etc/passwd lamp:x:501:501::/home/lamp:/bin/bash \u0026lt;--åˆ é™¤æ­¤è¡Œ # ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯æ–‡ä»¶ï¼Œåˆ é™¤lampç”¨æˆ·è¡Œ [root@localhost ~]#vi /etc/shadow lamp:$6$KoOYtcOJ $56Xk9vp3D2vMRBxibNOn.21cVJ9onbW8IHx4WrOx6qBqfGa9U3mjMsGjqYnj L/4t3zt3YxElce2X8rbb12x4a0:15716:0:99999:7::: \u0026lt;--åˆ é™¤æ­¤è¡Œ # ä¿®æ”¹å½±å­æ–‡ä»¶ï¼Œåˆ é™¤lampç”¨æˆ·å¯†ç è¡Œï¼Œæ³¨æ„ï¼Œè¿™ä¸ªæ–‡ä»¶çš„æƒé™æ˜¯000ï¼Œæ‰€ä»¥è¦å¼ºåˆ¶ä¿å­˜ [root@localhost ~]#vi /etc/group lamp:x:501: \u0026lt;--åˆ é™¤æ­¤è¡Œ # ä¿®æ”¹ç»„ä¿¡æ¯æ–‡ä»¶ï¼Œåˆ é™¤lampç¾¤ç»„ä¿¡æ¯ [root@localhost ~]#vi /etc/gshadow lamp:!:: \u0026lt;--åˆ é™¤æ­¤è¡Œ # ä¿®æ”¹ç»„å½±å­æ–‡ä»¶ï¼Œåˆ é™¤lampç¾¤ç»„å¯†ç ä¿¡æ¯ã€‚åŒæ ·æ³¨æ„éœ€è¦å¼ºåˆ¶ä¿å­˜ [root@localhost ~]# rm -rf /var/spod/mail/lamp #åˆ é™¤ç”¨æˆ·é‚®ç®± [root@localhost ~]# rm -rf/home/lamp/ #åˆ é™¤ç”¨æˆ·çš„å®¶ç›®å½• # è‡³æ­¤ï¼Œç”¨æˆ·å½»åº•åˆ é™¤ï¼Œå†æ–°å»ºç”¨æˆ·lampã€‚å¦‚æœå¯ä»¥æ­£å¸¸å»ºç«‹ï¼Œåˆ™è¯´æ˜æˆ‘ä»¬æ‰‹å·¥åˆ é™¤å¹²å‡€äº† [root@localhost ~]# useradd lamp [root@localhost ~]# passwd lamp # é‡æ–°å»ºç«‹åŒåç”¨æˆ·ï¼Œæ²¡æœ‰æŠ¥é”™ï¼Œè¯´æ˜å‰é¢çš„æ‰‹å·¥åˆ é™¤æ˜¯å¯ä»¥å®Œå…¨åˆ é™¤ç”¨æˆ·çš„ 14. idå‘½ä»¤ï¼šæŸ¥çœ‹ç”¨æˆ·çš„UIDå’ŒGID id å‘½ä»¤å¯ä»¥æŸ¥è¯¢ç”¨æˆ·çš„UIDã€GID å’Œé™„åŠ ç»„çš„ä¿¡æ¯ã€‚å‘½ä»¤æ¯”è¾ƒç®€å•ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š\n[root@localhost ~]# id ç”¨æˆ·å ã€ä¾‹ 1ã€‘\n[root@localhost ~]# id lamp uid=501(lamp) gid=501(lamp) groups=501(lamp) # èƒ½çœ‹åˆ°uid(ç”¨æˆ·ID)ã€gid(åˆå§‹ç»„ID), groupsæ˜¯ç”¨æˆ·æ‰€åœ¨ç»„ï¼Œè¿™é‡Œæ—¢å¯ä»¥çœ‹åˆ°åˆå§‹ç»„ï¼Œå¦‚æœæœ‰é™„åŠ ç»„ï¼Œåˆ™ä¹Ÿèƒ½çœ‹åˆ°é™„åŠ ç»„ ã€ä¾‹ 2ã€‘ [root@localhost ~]# usermod -G root lamp # æŠŠç”¨æˆ·åŠ å…¥rootç»„ [root@localhost ~]# id lamp uid=501(lamp) gid=501(lamp) groups=501(lamp),0(root) # å¤§å®¶å‘ç°rootç»„ä¸­åŠ å…¥äº†lampç”¨æˆ·çš„é™„åŠ ç»„ä¿¡æ¯ 15. suå‘½ä»¤ï¼šç”¨æˆ·é—´åˆ‡æ¢ su æ˜¯æœ€ç®€å•çš„ç”¨æˆ·åˆ‡æ¢å‘½ä»¤ï¼Œé€šè¿‡è¯¥å‘½ä»¤å¯ä»¥å®ç°ä»»ä½•èº«ä»½çš„åˆ‡æ¢ï¼ŒåŒ…æ‹¬ä»æ™®é€šç”¨æˆ·åˆ‡æ¢ä¸º root ç”¨æˆ·ã€ä» root ç”¨æˆ·åˆ‡æ¢ä¸ºæ™®é€šç”¨æˆ·ä»¥åŠæ™®é€šç”¨æˆ·ä¹‹é—´çš„åˆ‡æ¢ã€‚ æ™®é€šç”¨æˆ·ä¹‹é—´åˆ‡æ¢ä»¥åŠæ™®é€šç”¨æˆ·åˆ‡æ¢è‡³ root ç”¨æˆ·ï¼Œéƒ½éœ€è¦çŸ¥æ™“å¯¹æ–¹çš„å¯†ç ï¼Œåªæœ‰æ­£ç¡®è¾“å…¥å¯†ç ï¼Œæ‰èƒ½å®ç°åˆ‡æ¢ï¼›ä» root ç”¨æˆ·åˆ‡æ¢è‡³å…¶ä»–ç”¨æˆ·ï¼Œæ— éœ€çŸ¥æ™“å¯¹æ–¹å¯†ç ï¼Œç›´æ¥å¯åˆ‡æ¢æˆåŠŸã€‚\nsu å‘½ä»¤çš„åŸºæœ¬æ ¼å¼å¦‚ä¸‹ï¼š\n[root@localhost ~]# su [é€‰é¡¹] ç”¨æˆ·å é€‰é¡¹ï¼š\n -ï¼šå½“å‰ç”¨æˆ·ä¸ä»…åˆ‡æ¢ä¸ºæŒ‡å®šç”¨æˆ·çš„èº«ä»½ï¼ŒåŒæ—¶æ‰€ç”¨çš„å·¥ä½œç¯å¢ƒä¹Ÿåˆ‡æ¢ä¸ºæ­¤ç”¨æˆ·çš„ç¯å¢ƒï¼ˆåŒ…æ‹¬ PATH å˜é‡ã€MAIL å˜é‡ç­‰ï¼‰ï¼Œä½¿ç”¨ - é€‰é¡¹å¯çœç•¥ç”¨æˆ·åï¼Œé»˜è®¤ä¼šåˆ‡æ¢ä¸º root ç”¨æˆ·ã€‚ -lï¼šåŒ - çš„ä½¿ç”¨ç±»ä¼¼ï¼Œä¹Ÿå°±æ˜¯åœ¨åˆ‡æ¢ç”¨æˆ·èº«ä»½çš„åŒæ—¶ï¼Œå®Œæ•´åˆ‡æ¢å·¥ä½œç¯å¢ƒï¼Œä½†åé¢éœ€è¦æ·»åŠ æ¬²åˆ‡æ¢çš„ä½¿ç”¨è€…è´¦å·ã€‚ -pï¼šè¡¨ç¤ºåˆ‡æ¢ä¸ºæŒ‡å®šç”¨æˆ·çš„èº«ä»½ï¼Œä½†ä¸æ”¹å˜å½“å‰çš„å·¥ä½œç¯å¢ƒï¼ˆä¸ä½¿ç”¨åˆ‡æ¢ç”¨æˆ·çš„é…ç½®æ–‡ä»¶ï¼‰ã€‚ -mï¼šå’Œ -p ä¸€æ ·ï¼› -c å‘½ä»¤ï¼šä»…åˆ‡æ¢ç”¨æˆ·æ‰§è¡Œä¸€æ¬¡å‘½ä»¤ï¼Œæ‰§è¡Œåè‡ªåŠ¨åˆ‡æ¢å›æ¥ï¼Œè¯¥é€‰é¡¹åé€šå¸¸ä¼šå¸¦æœ‰è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚  ã€ä¾‹ 1ã€‘\n[lamp@localhost ~]$ su -root å¯†ç ï¼š \u0026lt;-- è¾“å…¥ root ç”¨æˆ·çš„å¯†ç  # \u0026#34;-\u0026#34;ä»£è¡¨è¿å¸¦ç¯å¢ƒå˜é‡ä¸€èµ·åˆ‡æ¢ï¼Œä¸èƒ½çœç•¥ 16. groupaddå‘½ä»¤ï¼šæ·»åŠ ç”¨æˆ·ç»„ æ·»åŠ ç”¨æˆ·ç»„çš„å‘½ä»¤æ˜¯ groupaddï¼Œå‘½ä»¤æ ¼å¼å¦‚ä¸‹:\n[root@localhost ~]# groupadd [é€‰é¡¹] ç»„å é€‰é¡¹ï¼š\n -g GIDï¼šæŒ‡å®šç»„ IDï¼› -rï¼šåˆ›å»ºç³»ç»Ÿç¾¤ç»„ã€‚ ä½¿ç”¨ groupadd å‘½ä»¤åˆ›å»ºæ–°ç¾¤ç»„éå¸¸ç®€å•ï¼Œä¾‹å¦‚ï¼š  [root@localhost ~]# groupadd group1 # æ·»åŠ group1ç»„ [root@localhost ~]# grep \u0026#34;group1\u0026#34; /etc/group /etc/group:group1:x:502: /etc/gshadow:group1:!:: 17. groupmodå‘½ä»¤ï¼šä¿®æ”¹ç”¨æˆ·ç»„ groupmod å‘½ä»¤ç”¨äºä¿®æ”¹ç”¨æˆ·ç»„çš„ç›¸å…³ä¿¡æ¯ï¼Œå‘½ä»¤æ ¼å¼å¦‚ä¸‹ï¼š\n[root@localhost ~]# groupmod [é€‰ç°] ç»„å é€‰é¡¹ï¼š\n -g GIDï¼šä¿®æ”¹ç»„ IDï¼› -n æ–°ç»„åï¼šä¿®æ”¹ç»„åï¼›  ä¾‹å­ï¼š\n[root@localhost ~]# groupmod -n testgrp group1 # æŠŠç»„ågroup1ä¿®æ”¹ä¸ºtestgrp [root@localhost ~]# grep \u0026#34;testgrp\u0026#34; /etc/group testgrp:x:502: # æ³¨æ„GIDè¿˜æ˜¯502ï¼Œä½†æ˜¯ç»„åå·²ç»æ”¹å˜ ä¸è¿‡å¤§å®¶è¿˜æ˜¯è¦æ³¨æ„ï¼Œç”¨æˆ·åä¸è¦éšæ„ä¿®æ”¹ï¼Œç»„åå’Œ GID ä¹Ÿä¸è¦éšæ„ä¿®æ”¹ï¼Œå› ä¸ºéå¸¸å®¹æ˜“å¯¼è‡´ç®¡ç†å‘˜é€»è¾‘æ··ä¹±ã€‚å¦‚æœéè¦ä¿®æ”¹ç”¨æˆ·åæˆ–ç»„åï¼Œåˆ™å»ºè®®å¤§å®¶å…ˆåˆ é™¤æ—§çš„ï¼Œå†å»ºç«‹æ–°çš„ã€‚\n18. groupdelå‘½ä»¤ï¼šåˆªé™¤ç”¨æˆ·ç»„ groupdel å‘½ä»¤ç”¨äºåˆ é™¤ç”¨æˆ·ç»„ï¼ˆç¾¤ç»„ï¼‰ï¼Œæ­¤å‘½ä»¤åŸºæœ¬æ ¼å¼ä¸ºï¼š\n[root@localhost ~]#groupdel ç»„å é€šè¿‡å‰é¢çš„å­¦ä¹ ä¸éš¾çŒœæµ‹å‡ºï¼Œä½¿ç”¨ groupdel å‘½ä»¤åˆ é™¤ç¾¤ç»„ï¼Œå…¶å®å°±æ˜¯åˆ é™¤ /etc/gourp æ–‡ä»¶å’Œ /etc/gshadow æ–‡ä»¶ä¸­æœ‰å…³ç›®æ ‡ç¾¤ç»„çš„æ•°æ®ä¿¡æ¯ã€‚\nä¾‹å¦‚ï¼Œåˆ é™¤å‰é¢ç« èŠ‚ä¸­ç”¨ groupadd å‘½ä»¤åˆ›å»ºçš„ç¾¤ç»„ group1ï¼Œæ‰§è¡Œå‘½ä»¤å¦‚ä¸‹ï¼š\n[root@localhost ~]#grep \u0026#34;testgrp\u0026#34; /etc/group /etc/gshadow /etc/group:testgrp:x:1002: /etc/gshadow:testgrp:!:: [root@localhost ~]#groupdel testgrp [root@localhost ~]#grep \u0026#34;testgrp\u0026#34; /etc/group /etc/gshadow [root@localhost ~]# æ³¨æ„ï¼Œä¸èƒ½ä½¿ç”¨ groupdel å‘½ä»¤éšæ„åˆ é™¤ç¾¤ç»„ã€‚æ­¤å‘½ä»¤ä»…é€‚ç”¨äºåˆ é™¤é‚£äº› \u0026ldquo;ä¸æ˜¯ä»»ä½•ç”¨æˆ·åˆå§‹ç»„\u0026rdquo; çš„ç¾¤ç»„ï¼Œæ¢å¥è¯è¯´ï¼Œå¦‚æœæœ‰ç¾¤ç»„è¿˜æ˜¯æŸç”¨æˆ·çš„åˆå§‹ç¾¤ç»„ï¼Œåˆ™æ— æ³•ä½¿ç”¨ groupdel å‘½ä»¤æˆåŠŸåˆ é™¤ã€‚ä¾‹å¦‚ï¼š\n[root@localhost ~]# useradd temp # è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå¯ä»¥çœ‹åˆ° temp ç”¨æˆ·å»ºç«‹çš„åŒæ—¶ï¼Œè¿˜åˆ›å»ºäº† temp ç¾¤ç»„ï¼Œä¸”å°†å…¶ä½œä¸º tempç”¨æˆ·çš„åˆå§‹ç»„ï¼ˆç»„IDéƒ½æ˜¯ 505ï¼‰ [root@localhost ~]# grep \u0026#34;temp\u0026#34; /etc/passwd /etc/group /etc/gshadow /etc/passwd:temp:x:505:505::/home/temp:/bin/bash /etc/group:temp:x:505: /etc/gshadow:temp:!:: # ä¸‹é¢å°è¯•åˆ é™¤ temp ç¾¤ç»„ [root@localhost ~]# groupdel temp groupdel:cannot remove the primary group of user \u0026#39;temp\u0026#39; å¯ä»¥çœ‹åˆ°ï¼Œgroupdel å‘½ä»¤åˆ é™¤ temp ç¾¤ç»„å¤±è´¥ï¼Œä¸”æç¤ºâ€œä¸èƒ½åˆ é™¤ temp ç”¨æˆ·çš„åˆå§‹ç»„â€ã€‚å¦‚æœä¸€å®šè¦åˆ é™¤ temp ç¾¤ç»„ï¼Œè¦ä¹ˆä¿®æ”¹ temp ç”¨æˆ·çš„ GIDï¼Œä¹Ÿå°±æ˜¯å°†å…¶åˆå§‹ç»„æ”¹ä¸ºå…¶ä»–ç¾¤ç»„ï¼Œè¦ä¹ˆå…ˆåˆ é™¤ temp ç”¨æˆ·ã€‚\nåˆ‡è®°ï¼Œè™½ç„¶æˆ‘ä»¬å·²ç»å­¦äº†å¦‚ä½•æ‰‹åŠ¨åˆ é™¤ç¾¤ç»„æ•°æ®ï¼Œä½†èƒ¡ä¹±åœ°åˆ é™¤ç¾¤ç»„å¯èƒ½ä¼šç»™å…¶ä»–ç”¨æˆ·é€ æˆä¸å°çš„éº»çƒ¦ï¼Œå› æ­¤æ›´æ”¹æ–‡ä»¶æ•°æ®è¦æ ¼å¤–æ…é‡ã€‚\n19. gpasswdå‘½ä»¤ï¼šæŠŠç”¨æˆ·æ·»åŠ è¿›ç»„æˆ–ä»ç»„ä¸­åˆ é™¤ ä¸ºäº†é¿å…ç³»ç»Ÿç®¡ç†å‘˜ï¼ˆrootï¼‰å¤ªå¿™ç¢Œï¼Œæ— æ³•åŠæ—¶ç®¡ç†ç¾¤ç»„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ gpasswd å‘½ä»¤ç»™ç¾¤ç»„è®¾ç½®ä¸€ä¸ªç¾¤ç»„ç®¡ç†å‘˜ï¼Œä»£æ›¿ root å®Œæˆå°†ç”¨æˆ·åŠ å…¥ æˆ–ç§»å‡ºç¾¤ç»„çš„æ“ä½œã€‚\ngpasswd å‘½ä»¤çš„åŸºæœ¬æ ¼å¼å¦‚ä¸‹ï¼š\n[root@localhost ~]# gpasswd é€‰é¡¹ ç»„å é€‰é¡¹ï¼š\n é€‰é¡¹ä¸ºç©ºæ—¶ï¼Œè¡¨ç¤ºç»™ç¾¤ç»„è®¾ç½®å¯†ç ï¼Œä»… root ç”¨æˆ·å¯ç”¨ã€‚ -A user1,\u0026hellip; å°†ç¾¤ç»„çš„æ§åˆ¶æƒäº¤ç»™ user1,\u0026hellip; ç­‰ç”¨æˆ·ç®¡ç†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè®¾ç½® user1,\u0026hellip; ç­‰ç”¨æˆ·ä¸ºç¾¤ç»„çš„ç®¡ç†å‘˜ï¼Œä»… root ç”¨æˆ·å¯ç”¨ã€‚ -M user1,\u0026hellip; å°† user1,\u0026hellip; åŠ å…¥åˆ°æ­¤ç¾¤ç»„ä¸­ï¼Œä»… root ç”¨æˆ·å¯ç”¨ã€‚ -r ç§»é™¤ç¾¤ç»„çš„å¯†ç ï¼Œä»… root ç”¨æˆ·å¯ç”¨ã€‚ -R è®©ç¾¤ç»„çš„å¯†ç å¤±æ•ˆï¼Œä»… root ç”¨æˆ·å¯ç”¨ã€‚ -a user å°† user ç”¨æˆ·åŠ å…¥åˆ°ç¾¤ç»„ä¸­ã€‚ -d user å°† user ç”¨æˆ·ä»ç¾¤ç»„ä¸­ç§»é™¤ã€‚ ã€ä¾‹ 1ã€‘  # åˆ›å»ºæ–°ç¾¤ç»„ group1ï¼Œå¹¶å°†ç¾¤ç»„äº¤ç»™ lamp ç®¡ç† [root@localhost ~]# groupadd group1 \u0026lt;-- åˆ›å»ºç¾¤ç»„ [root@localhost ~]# gpasswd group1 \u0026lt;-- è®¾ç½®å¯†ç å§ï¼ Changing the password for group group1 New Password: Re-enter new password: [root@localhost ~]# gpasswd -A lamp group1 \u0026lt;==åŠ å…¥ç¾¤ç»„ç®¡ç†å‘˜ä¸º lamp [root@localhost ~]# grep \u0026#34;group1\u0026#34; /etc/group /etc/gshadow /etc/group:group1:x:506: /etc/gshadow:group1:$1$I5ukIY1.$o5fmW.cOsc8.K.FHAFLWg0:lamp: å¯ä»¥çœ‹åˆ°ï¼Œæ­¤æ—¶ lamp ç”¨æˆ·å³ä¸º group1 ç¾¤ç»„çš„ç®¡ç†å‘˜ã€‚\nã€ä¾‹ 2ã€‘\n# ä»¥lampç”¨æˆ·ç™»é™†ç³»ç»Ÿï¼Œå¹¶å°†ç”¨æˆ· lamp å’Œ lamp1 åŠ å…¥group1ç¾¤ç»„ã€‚ [lamp@localhost ~]#gpasswd -a lamp group1 [lamp@localhost ~]#gpasswd -a lamp1 group1 [lamp@localhost ~]#grep \u0026#34;group1\u0026#34; /etc/group group1:x:506:lamp,lamp1 20. newgrpå‘½ä»¤ï¼šåˆ‡æ¢ç”¨æˆ·çš„æœ‰æ•ˆç»„ æˆ‘ä»¬çŸ¥é“ï¼Œæ¯ä¸ªç”¨æˆ·å¯ä»¥å±äºä¸€ä¸ªåˆå§‹ç»„ï¼ˆç”¨æˆ·æ˜¯è¿™ä¸ªç»„çš„åˆå§‹ç”¨æˆ·ï¼‰ï¼Œä¹Ÿå¯ä»¥å±äºå¤šä¸ªé™„åŠ ç»„ï¼ˆç”¨æˆ·æ˜¯è¿™ä¸ªç»„çš„é™„åŠ ç”¨æˆ·ï¼‰ã€‚æ—¢ç„¶ç”¨æˆ·å¯ä»¥å±äºè¿™ä¹ˆå¤šç”¨æˆ·ç»„ï¼Œé‚£ä¹ˆç”¨æˆ·åœ¨åˆ›å»ºæ–‡ä»¶åï¼Œé»˜è®¤ç”Ÿæ•ˆçš„ç»„èº«ä»½æ˜¯å“ªä¸ªå‘¢ï¼Ÿ\nå½“ç„¶æ˜¯åˆå§‹ç”¨æˆ·ç»„çš„ç»„èº«ä»½ç”Ÿæ•ˆï¼Œå› ä¸ºåˆå§‹ç»„æ˜¯ç”¨æˆ·ä¸€æ—¦ç™»é™†å°±è·å¾—çš„ç»„èº«ä»½ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç”¨æˆ·çš„æœ‰æ•ˆç»„é»˜è®¤æ˜¯åˆå§‹ç»„ï¼Œå› æ­¤æ‰€åˆ›å»ºæ–‡ä»¶çš„å±ç»„æ˜¯ç”¨æˆ·çš„åˆå§‹ç»„ã€‚é‚£ä¹ˆï¼Œæ—¢ç„¶ç”¨æˆ·å±äºå¤šä¸ªç”¨æˆ·ç»„ï¼Œèƒ½ä¸èƒ½æ”¹å˜ç”¨æˆ·çš„åˆå§‹ç»„å‘¢ï¼Ÿä½¿ç”¨å‘½ä»¤ newgrp å°±å¯ä»¥ã€‚\nnewgrp å‘½ä»¤å¯ä»¥ä»ç”¨æˆ·çš„é™„åŠ ç»„ä¸­é€‰æ‹©ä¸€ä¸ªç¾¤ç»„ï¼Œä½œä¸ºç”¨æˆ·æ–°çš„åˆå§‹ç»„ã€‚æ­¤å‘½ä»¤çš„åŸºæœ¬æ ¼å¼å¦‚ä¸‹ï¼š\n[root@localhost ~]# newgrp ç»„å ä¸‹é¢ï¼Œæˆ‘ä»¬é€šè¿‡å®ä¾‹ï¼Œè®²è§£æ­¤å‘½ä»¤çš„å…·ä½“ç”¨æ³•å’ŒåŠŸèƒ½ï¼š\né¦–å…ˆï¼Œå»ºç«‹ 3 ä¸ªç”¨æˆ·ç»„ group1ã€group2 å’Œ group3ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š\n[root@localhost ~]# groupadd group1 [root@localhost ~]# groupadd group2 [root@localhost ~]# groupadd group3 åˆ›å»ºä¸€ä¸ªç”¨æˆ· user1ï¼ŒåŒæ—¶æŒ‡å®š user1 çš„åˆå§‹ç»„ä¸º group1ï¼Œé™„åŠ ç»„ä¸º group2 å’Œ group3ï¼Œæ‰§è¡Œå‘½ä»¤å¦‚ä¸‹ï¼š\n[root@localhost ~]# useradd -g group1 -G group2,group3 user1 # ç”±äºæŒ‡å®šäº†åˆå§‹ç»„ï¼Œå› æ­¤ä¸ä¼šåœ¨åˆ›å»º user1 é»˜è®¤ç¾¤ç»„ [root@localhost ~]# more /etc/group | grep user1 group2:x:501:user1 group3:x:502:user1 å¯¹ç”¨æˆ· user1 è®¾ç½®å¯†ç ï¼Œæ‰§è¡Œå‘½ä»¤å¦‚ä¸‹ï¼š\n[root@localhost ~]# passwd user1 Changing password for user user1. New password: Retype new password: passwd: all authentication tokens updated successfully. åˆ‡æ¢è‡³ user1 ç”¨æˆ·ï¼Œé€šè¿‡ newgrp åˆ‡æ¢ç”¨æˆ·ç»„è¿›è¡Œä¸‹åˆ—æ“ä½œï¼Œè¯»è€…å¯ä»ä¸­ä½“ä¼šå‡º newgrp å‘½ä»¤çš„ä½œç”¨ã€‚\n# åˆ‡æ¢è‡³ user1 ç”¨æˆ· [root@localhost ~]# su - user1 [root@localhost ~]# whoami user1 # ä½¿ç”¨ newgrp å‘½ä»¤ä¸€è¾¹åˆ‡æ¢ user1 çš„åˆå§‹ç»„ï¼Œä¸€è¾¹åˆ›å»ºæ–‡ä»¶ [root@localhost ~]# mkdir user1_doc [root@localhost ~]# newgrp group2 [root@localhost ~]# mkdir user2_doc [root@localhost ~]# newgrp group3 [root@localhost ~]# mkdir user3_doc # æŸ¥çœ‹å„æ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯ [root@localhost ~]# ll total 12 drwxr-xr-x 2 user1 group1 4096 Oct 24 01:18 user1_doc drwxr-xr-x 2 user1 group2 4096 Oct 24 01:18 user2_doc drwxr-xr-x 2 user1 group3 4096 Oct 24 01:19 user3_doc å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡ä½¿ç”¨ newgrp å‘½ä»¤åˆ‡æ¢ç”¨æˆ·çš„åˆå§‹ç»„ï¼Œæ‰€åˆ›å»ºçš„æ–‡ä»¶å„è‡ªå±äºä¸åŒçš„ç¾¤ç»„ï¼Œè¿™å°±æ˜¯ newgrp æ‰€å‘æŒ¥çš„ä½œç”¨ï¼Œå³é€šè¿‡åˆ‡æ¢é™„åŠ ç»„æˆä¸ºæ–°çš„åˆå§‹ç»„ï¼Œä»è€Œè®©ç”¨æˆ·è·å¾—ä½¿ç”¨å„ä¸ªé™„åŠ ç»„çš„æƒé™ã€‚\n","permalink":"http://yangchnet.github.io/Dessert/posts/linux/linux%E4%B8%8B%E7%9A%84%E7%94%A8%E6%88%B7%E5%92%8C%E7%94%A8%E6%88%B7%E7%BB%84%E7%AE%A1%E7%90%86/","summary":"1.æ¦‚è¿° Linux æ˜¯å¤šç”¨æˆ·å¤šä»»åŠ¡æ“ä½œç³»ç»Ÿï¼Œæ¢å¥è¯è¯´ï¼ŒLinux ç³»ç»Ÿæ”¯æŒå¤šä¸ªç”¨æˆ·åœ¨åŒä¸€æ—¶é—´å†…ç™»é™†ï¼Œä¸åŒç”¨æˆ·å¯ä»¥æ‰§è¡Œä¸åŒçš„ä»»åŠ¡ï¼Œå¹¶ä¸”äº’ä¸å½±å“ã€‚\nä¾‹å¦‚ï¼ŒæŸå° Linux æœåŠ¡å™¨ä¸Šæœ‰ 4 ä¸ªç”¨æˆ·ï¼Œåˆ†åˆ«æ˜¯ rootã€wwwã€ftp å’Œ mysqlï¼Œåœ¨åŒä¸€æ—¶é—´å†…ï¼Œroot ç”¨æˆ·å¯èƒ½åœ¨æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—ã€ç®¡ç†ç»´æŠ¤ç³»ç»Ÿï¼›www ç”¨æˆ·å¯èƒ½åœ¨ä¿®æ”¹è‡ªå·±çš„ç½‘é¡µç¨‹åºï¼›ftp ç”¨æˆ·å¯èƒ½åœ¨ä¸Šä¼ è½¯ä»¶åˆ°æœåŠ¡å™¨ï¼›mysql ç”¨æˆ·å¯èƒ½åœ¨æ‰§è¡Œè‡ªå·±çš„ SQL æŸ¥è¯¢ï¼Œæ¯ä¸ªç”¨æˆ·äº’ä¸å¹²æ‰°ï¼Œæœ‰æ¡ä¸ç´Šåœ°è¿›è¡Œç€è‡ªå·±çš„å·¥ä½œã€‚ä¸æ­¤åŒæ—¶ï¼Œæ¯ä¸ªç”¨æˆ·ä¹‹é—´ä¸èƒ½è¶Šæƒè®¿é—®ï¼Œæ¯”å¦‚ www ç”¨æˆ·ä¸èƒ½æ‰§è¡Œ mysql ç”¨æˆ·çš„ SQL æŸ¥è¯¢æ“ä½œï¼Œftp ç”¨æˆ·ä¹Ÿä¸èƒ½ä¿®æ”¹ www ç”¨æˆ·çš„ç½‘é¡µç¨‹åºã€‚\nä¸åŒç”¨æˆ·å…·æœ‰ä¸é—®çš„æƒé™ï¼Œæ¯ä¸ªç”¨æˆ·åœ¨æƒé™å…è®¸çš„èŒƒå›´å†…å®Œæˆä¸é—´çš„ä»»åŠ¡ï¼ŒLinux æ­£æ˜¯é€šè¿‡è¿™ç§æƒé™çš„åˆ’åˆ†ä¸ç®¡ç†ï¼Œå®ç°äº†å¤šç”¨æˆ·å¤šä»»åŠ¡çš„è¿è¡Œæœºåˆ¶ã€‚\nå› æ­¤ï¼Œå¦‚æœè¦ä½¿ç”¨ Linux ç³»ç»Ÿçš„èµ„æºï¼Œå°±å¿…é¡»å‘ç³»ç»Ÿç®¡ç†å‘˜ç”³è¯·ä¸€ä¸ªè´¦æˆ·ï¼Œç„¶åé€šè¿‡è¿™ä¸ªè´¦æˆ·è¿›å…¥ç³»ç»Ÿï¼ˆè´¦æˆ·å’Œç”¨æˆ·æ˜¯ä¸€ä¸ªæ¦‚å¿µï¼‰ã€‚é€šè¿‡å»ºç«‹ä¸åŒå±æ€§çš„ç”¨æˆ·ï¼Œä¸€æ–¹é¢å¯ä»¥åˆç†åœ°åˆ©ç”¨å’Œæ§åˆ¶ç³»ç»Ÿèµ„æºï¼Œå¦ä¸€æ–¹é¢ä¹Ÿå¯ä»¥å¸®åŠ©ç”¨æˆ·ç»„ç»‡æ–‡ä»¶ï¼Œæä¾›å¯¹ç”¨æˆ·æ–‡ä»¶çš„å®‰å…¨æ€§ä¿æŠ¤ã€‚\næ¯ä¸ªç”¨æˆ·éƒ½æœ‰å”¯ä¸€çš„ç”¨æˆ·åå’Œå¯†ç ã€‚åœ¨ç™»å½•ç³»ç»Ÿæ—¶ï¼Œåªæœ‰æ­£ç¡®è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼Œæ‰èƒ½è¿›å…¥ç³»ç»Ÿå’Œè‡ªå·±çš„ä¸»ç›®å½•ã€‚\nç”¨æˆ·ç»„æ˜¯å…·æœ‰ç›¸åŒç‰¹å¾ç”¨æˆ·çš„é€»è¾‘é›†åˆã€‚ç®€å•çš„ç†è§£ï¼Œæœ‰æ—¶æˆ‘ä»¬éœ€è¦è®©å¤šä¸ªç”¨æˆ·å…·æœ‰ç›¸åŒçš„æƒé™ï¼Œæ¯”å¦‚æŸ¥çœ‹ã€ä¿®æ”¹æŸä¸€ä¸ªæ–‡ä»¶çš„æƒé™ï¼Œä¸€ç§æ–¹æ³•æ˜¯åˆ†åˆ«å¯¹å¤šä¸ªç”¨æˆ·è¿›è¡Œæ–‡ä»¶è®¿é—®æˆæƒï¼Œå¦‚æœæœ‰ 10 ä¸ªç”¨æˆ·çš„è¯ï¼Œå°±éœ€è¦æˆæƒ 10 æ¬¡ï¼Œé‚£å¦‚æœæœ‰ 100ã€1000 ç”šè‡³æ›´å¤šçš„ç”¨æˆ·å‘¢ï¼Ÿ\næ˜¾ç„¶ï¼Œè¿™ç§æ–¹æ³•ä¸å¤ªåˆç†ã€‚æœ€å¥½çš„æ–¹å¼æ˜¯å»ºç«‹ä¸€ä¸ªç»„ï¼Œè®©è¿™ä¸ªç»„å…·æœ‰æŸ¥çœ‹ã€ä¿®æ”¹æ­¤æ–‡ä»¶çš„æƒé™ï¼Œç„¶åå°†æ‰€æœ‰éœ€è¦è®¿é—®æ­¤æ–‡ä»¶çš„ç”¨æˆ·æ”¾å…¥è¿™ä¸ªç»„ä¸­ã€‚é‚£ä¹ˆï¼Œæ‰€æœ‰ç”¨æˆ·å°±å…·æœ‰äº†å’Œç»„ä¸€æ ·çš„æƒé™ï¼Œè¿™å°±æ˜¯ç”¨æˆ·ç»„ã€‚\nå°†ç”¨æˆ·åˆ†ç»„æ˜¯ Linux ç³»ç»Ÿä¸­å¯¹ç”¨æˆ·è¿›è¡Œç®¡ç†åŠæ§åˆ¶è®¿é—®æƒé™çš„ä¸€ç§æ‰‹æ®µï¼Œé€šè¿‡å®šä¹‰ç”¨æˆ·ç»„ï¼Œå¾ˆå¤šç¨‹åºä¸Šç®€åŒ–äº†å¯¹ç”¨æˆ·çš„ç®¡ç†å·¥ä½œã€‚\n2.ç”¨æˆ·å’Œç”¨æˆ·ç»„çš„å…³ç³» ç”¨æˆ·å’Œç”¨æˆ·ç»„çš„å¯¹åº”å…³ç³»æœ‰ä»¥ä¸‹ 4 ç§ï¼š\nä¸€å¯¹ä¸€ï¼šä¸€ä¸ªç”¨æˆ·å¯ä»¥å­˜åœ¨ä¸€ä¸ªç»„ä¸­ï¼Œæ˜¯ç»„ä¸­çš„å”¯ä¸€æˆå‘˜ï¼› ä¸€å¯¹å¤šï¼šä¸€ä¸ªç”¨æˆ·å¯ä»¥å­˜åœ¨å¤šä¸ªç”¨æˆ·ç»„ä¸­ï¼Œæ­¤ç”¨æˆ·å…·æœ‰è¿™å¤šä¸ªç»„çš„å…±åŒæƒé™ï¼› å¤šå¯¹ä¸€ï¼šå¤šä¸ªç”¨æˆ·å¯ä»¥å­˜åœ¨ä¸€ä¸ªç»„ä¸­ï¼Œè¿™äº›ç”¨æˆ·å…·æœ‰å’Œç»„ç›¸åŒçš„æƒé™ï¼› å¤šå¯¹å¤šï¼šå¤šä¸ªç”¨æˆ·å¯ä»¥å­˜åœ¨å¤šä¸ªç»„ä¸­ï¼Œä¹Ÿå°±æ˜¯ä»¥ä¸Š 3 ç§å…³ç³»çš„æ‰©å±•ã€‚ ç”¨æˆ·å’Œç»„ä¹‹é—´çš„å…³ç³»å¯ç”¨ä¸‹å›¾è¡¨ç¤ºï¼šå›¾ 1 Linuxç”¨æˆ·å’Œç”¨æˆ·ç»„ 3. UIDå’ŒGID(ç”¨æˆ·IDå’Œç»„ID) ç™»é™† Linux ç³»ç»Ÿæ—¶ï¼Œè™½ç„¶è¾“å…¥çš„æ˜¯è‡ªå·±çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œä½†å…¶å® Linux å¹¶ä¸è®¤è¯†ä½ çš„ç”¨æˆ·åç§°ï¼Œå®ƒåªè®¤è¯†ç”¨æˆ·åå¯¹åº”çš„ ID å·ï¼ˆä¹Ÿå°±æ˜¯ä¸€ä¸²æ•°å­—ï¼‰ã€‚Linux ç³»ç»Ÿå°†æ‰€æœ‰ç”¨æˆ·çš„åç§°ä¸ ID çš„å¯¹åº”å…³ç³»éƒ½å­˜å‚¨åœ¨ /etc/passwd æ–‡ä»¶ä¸­ã€‚","title":"Linuxä¸‹çš„ç”¨æˆ·å’Œç”¨æˆ·ç»„ç®¡ç†"},{"content":" æå®¢æ—¶é—´ã€ŠMySQLå®æˆ˜45è®²ã€‹ç¬”è®°\n MySQLä¸­çš„éš”ç¦»çº§åˆ« è§æœ¬åœ°äº‹åŠ¡çš„éš”ç¦»\näº‹åŠ¡éš”ç¦»çš„å®ç° äº‹åŠ¡ä¹‹é—´çš„éš”ç¦»æ˜¯å¦‚ä½•å®ç°çš„?\nåœ¨ MySQL ä¸­ï¼Œå®é™…ä¸Šæ¯æ¡è®°å½•åœ¨æ›´æ–°çš„æ—¶å€™éƒ½ä¼šåŒæ—¶è®°å½•ä¸€æ¡å›æ»šæ“ä½œã€‚è®°å½•ä¸Šçš„æœ€æ–°å€¼ï¼Œé€šè¿‡å›æ»šæ“ä½œï¼Œéƒ½å¯ä»¥å¾—åˆ°å‰ä¸€ä¸ªçŠ¶æ€çš„å€¼ã€‚\nå‡è®¾ä¸€ä¸ªå€¼ä» 1 è¢«æŒ‰é¡ºåºæ”¹æˆäº† 2ã€3ã€4ï¼Œåœ¨å›æ»šæ—¥å¿—é‡Œé¢å°±ä¼šæœ‰ç±»ä¼¼ä¸‹é¢çš„è®°å½•ã€‚\nå½“å‰å€¼æ˜¯ 4ï¼Œä½†æ˜¯åœ¨æŸ¥è¯¢è¿™æ¡è®°å½•çš„æ—¶å€™ï¼Œä¸åŒæ—¶åˆ»å¯åŠ¨çš„äº‹åŠ¡ä¼šæœ‰ä¸åŒçš„ read-viewã€‚å¦‚å›¾ä¸­çœ‹åˆ°çš„ï¼Œåœ¨è§†å›¾ Aã€Bã€C é‡Œé¢ï¼Œè¿™ä¸€ä¸ªè®°å½•çš„å€¼åˆ†åˆ«æ˜¯ 1ã€2ã€4ï¼ŒåŒä¸€æ¡è®°å½•åœ¨ç³»ç»Ÿä¸­å¯ä»¥å­˜åœ¨å¤šä¸ªç‰ˆæœ¬ï¼Œå°±æ˜¯æ•°æ®åº“çš„å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMVCCï¼‰ã€‚å¯¹äº read-view Aï¼Œè¦å¾—åˆ° 1ï¼Œå°±å¿…é¡»å°†å½“å‰å€¼ä¾æ¬¡æ‰§è¡Œå›¾ä¸­æ‰€æœ‰çš„å›æ»šæ“ä½œå¾—åˆ°ã€‚\nä½†è¿™ç§å›æ»šæ—¥å¿—ä¸èƒ½ä¸€ç›´ä¿ç•™ï¼Œå½“ç³»ç»Ÿåˆ¤æ–­ï¼Œæ²¡æœ‰äº‹åŠ¡å†éœ€è¦ç”¨åˆ°è¿™äº›å›æ»šæ—¥å¿—æ—¶ï¼Œå›æ»šæ—¥å¿—ä¼šè¢«åˆ é™¤ï¼Œä¹Ÿå³å½“ç³»ç»Ÿä¸­æ²¡æœ‰æ¯”è¿™ä¸ªå›æ»šæ—¥å¿—æ›´æ—©çš„read-viewæ—¶ã€‚\nå¦‚ä½•å°½é‡é¿å…é•¿äº‹åŠ¡ ä¸ºä»€ä¹ˆè¦é¿å…é•¿äº‹åŠ¡ï¼Ÿ\né•¿äº‹åŠ¡æ„å‘³ç€ç³»ç»Ÿé‡Œé¢ä¼šå­˜åœ¨å¾ˆè€çš„äº‹åŠ¡è§†å›¾ã€‚ç”±äºè¿™äº›äº‹åŠ¡éšæ—¶å¯èƒ½è®¿é—®æ•°æ®åº“é‡Œé¢çš„ä»»ä½•æ•°æ®ï¼Œæ‰€ä»¥è¿™ä¸ªäº‹åŠ¡æäº¤ä¹‹å‰ï¼Œæ•°æ®åº“é‡Œé¢å®ƒå¯èƒ½ç”¨åˆ°çš„å›æ»šè®°å½•éƒ½å¿…é¡»ä¿ç•™ï¼Œè¿™å°±ä¼šå¯¼è‡´å¤§é‡å ç”¨å­˜å‚¨ç©ºé—´ã€‚\nåœ¨ MySQL 5.5 åŠä»¥å‰çš„ç‰ˆæœ¬ï¼Œå›æ»šæ—¥å¿—æ˜¯è·Ÿæ•°æ®å­—å…¸ä¸€èµ·æ”¾åœ¨ ibdata æ–‡ä»¶é‡Œçš„ï¼Œå³ä½¿é•¿äº‹åŠ¡æœ€ç»ˆæäº¤ï¼Œå›æ»šæ®µè¢«æ¸…ç†ï¼Œæ–‡ä»¶ä¹Ÿä¸ä¼šå˜å°ã€‚\né™¤äº†å¯¹å›æ»šæ®µçš„å½±å“ï¼Œé•¿äº‹åŠ¡è¿˜å ç”¨é”èµ„æºï¼Œä¹Ÿå¯èƒ½æ‹–å®æ•´ä¸ªåº“ã€‚\nå¦‚ä½•é¿å…é•¿äº‹åŠ¡ï¼Ÿ\nMySQL çš„äº‹åŠ¡å¯åŠ¨æ–¹å¼æœ‰ä»¥ä¸‹å‡ ç§ï¼š\n  æ˜¾å¼å¯åŠ¨äº‹åŠ¡è¯­å¥ï¼Œ begin æˆ– start transactionã€‚é…å¥—çš„æäº¤è¯­å¥æ˜¯ commitï¼Œå›æ»šè¯­å¥æ˜¯ rollbackã€‚\n  set autocommit=0ï¼Œè¿™ä¸ªå‘½ä»¤ä¼šå°†è¿™ä¸ªçº¿ç¨‹çš„è‡ªåŠ¨æäº¤å…³æ‰ã€‚æ„å‘³ç€å¦‚æœä½ åªæ‰§è¡Œä¸€ä¸ª select è¯­å¥ï¼Œè¿™ä¸ªäº‹åŠ¡å°±å¯åŠ¨äº†ï¼Œè€Œä¸”å¹¶ä¸ä¼šè‡ªåŠ¨æäº¤ã€‚è¿™ä¸ªäº‹åŠ¡æŒç»­å­˜åœ¨ç›´åˆ°ä½ ä¸»åŠ¨æ‰§è¡Œ commit æˆ– rollback è¯­å¥ï¼Œæˆ–è€…æ–­å¼€è¿æ¥ã€‚\n  å› æ­¤ï¼Œå»ºè®®æ€»æ˜¯ä½¿ç”¨ set autocommit=1, é€šè¿‡æ˜¾å¼è¯­å¥çš„æ–¹å¼æ¥å¯åŠ¨äº‹åŠ¡ã€‚\nä½†è¿™æ ·ä¼šå¤šä¸€æ¬¡â€œäº¤äº’â€ï¼Œé’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œä½¿ç”¨commit work and chain è¯­æ³•ã€‚\nåœ¨ autocommit ä¸º 1 çš„æƒ…å†µä¸‹ï¼Œç”¨ begin æ˜¾å¼å¯åŠ¨çš„äº‹åŠ¡ï¼Œå¦‚æœæ‰§è¡Œ commit åˆ™æäº¤äº‹åŠ¡ã€‚å¦‚æœæ‰§è¡Œ commit work and chainï¼Œåˆ™æ˜¯æäº¤äº‹åŠ¡å¹¶è‡ªåŠ¨å¯åŠ¨ä¸‹ä¸€ä¸ªäº‹åŠ¡ï¼Œè¿™æ ·ä¹Ÿçœå»äº†å†æ¬¡æ‰§è¡Œ begin è¯­å¥çš„å¼€é”€ã€‚åŒæ—¶å¸¦æ¥çš„å¥½å¤„æ˜¯ä»ç¨‹åºå¼€å‘çš„è§’åº¦æ˜ç¡®åœ°çŸ¥é“æ¯ä¸ªè¯­å¥æ˜¯å¦å¤„äºäº‹åŠ¡ä¸­ã€‚\nå¯ä»¥åœ¨ information_schema åº“çš„ innodb_trx è¿™ä¸ªè¡¨ä¸­æŸ¥è¯¢é•¿äº‹åŠ¡ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªè¯­å¥ï¼Œç”¨äºæŸ¥æ‰¾æŒç»­æ—¶é—´è¶…è¿‡ 60s çš„äº‹åŠ¡ã€‚\nselect * from information_schema.innodb_trx where TIME_TO_SEC(timediff(now(),trx_started))\u0026gt;60 MVCC åœ¨ MySQL é‡Œï¼Œæœ‰ä¸¤ä¸ªâ€œè§†å›¾â€çš„æ¦‚å¿µï¼š\n  ä¸€ä¸ªæ˜¯ viewã€‚å®ƒæ˜¯ä¸€ä¸ªç”¨æŸ¥è¯¢è¯­å¥å®šä¹‰çš„è™šæ‹Ÿè¡¨ï¼Œåœ¨è°ƒç”¨çš„æ—¶å€™æ‰§è¡ŒæŸ¥è¯¢è¯­å¥å¹¶ç”Ÿæˆç»“æœã€‚åˆ›å»ºè§†å›¾çš„è¯­æ³•æ˜¯ create view â€¦ ï¼Œè€Œå®ƒçš„æŸ¥è¯¢æ–¹æ³•ä¸è¡¨ä¸€æ ·ã€‚\n  å¦ä¸€ä¸ªæ˜¯ InnoDB åœ¨å®ç° MVCC æ—¶ç”¨åˆ°çš„ä¸€è‡´æ€§è¯»è§†å›¾ï¼Œå³ consistent read viewï¼Œç”¨äºæ”¯æŒ RCï¼ˆRead Committedï¼Œè¯»æäº¤ï¼‰å’Œ RRï¼ˆRepeatable Readï¼Œå¯é‡å¤è¯»ï¼‰éš”ç¦»çº§åˆ«çš„å®ç°ã€‚\n  å®ƒæ²¡æœ‰ç‰©ç†ç»“æ„ï¼Œä½œç”¨æ˜¯äº‹åŠ¡æ‰§è¡ŒæœŸé—´ç”¨æ¥å®šä¹‰â€œæˆ‘èƒ½çœ‹åˆ°ä»€ä¹ˆæ•°æ®â€ã€‚\nåœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œäº‹åŠ¡åœ¨å¯åŠ¨çš„æ—¶å€™å°±â€œæ‹äº†ä¸ªå¿«ç…§â€ã€‚\nInnoDB é‡Œé¢æ¯ä¸ªäº‹åŠ¡æœ‰ä¸€ä¸ªå”¯ä¸€çš„äº‹åŠ¡ IDï¼Œå«ä½œ transaction idã€‚å®ƒæ˜¯åœ¨äº‹åŠ¡å¼€å§‹çš„æ—¶å€™å‘ InnoDB çš„äº‹åŠ¡ç³»ç»Ÿç”³è¯·çš„ï¼Œæ˜¯æŒ‰ç”³è¯·é¡ºåºä¸¥æ ¼é€’å¢çš„ã€‚è€Œæ¯è¡Œæ•°æ®ä¹Ÿéƒ½æ˜¯æœ‰å¤šä¸ªç‰ˆæœ¬çš„ã€‚\næ¯æ¬¡äº‹åŠ¡æ›´æ–°æ•°æ®çš„æ—¶å€™ï¼Œéƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„æ•°æ®ç‰ˆæœ¬ï¼Œå¹¶ä¸”æŠŠ transaction id èµ‹å€¼ç»™è¿™ä¸ªæ•°æ®ç‰ˆæœ¬çš„äº‹åŠ¡ IDï¼Œè®°ä¸º row trx_idã€‚åŒæ—¶ï¼Œæ—§çš„æ•°æ®ç‰ˆæœ¬è¦ä¿ç•™ï¼Œå¹¶ä¸”åœ¨æ–°çš„æ•°æ®ç‰ˆæœ¬ä¸­ï¼Œèƒ½å¤Ÿæœ‰ä¿¡æ¯å¯ä»¥ç›´æ¥æ‹¿åˆ°å®ƒã€‚\nä¹Ÿå°±æ˜¯è¯´ï¼Œæ•°æ®è¡¨ä¸­çš„ä¸€è¡Œè®°å½•ï¼Œå…¶å®å¯èƒ½æœ‰å¤šä¸ªç‰ˆæœ¬ (row)ï¼Œæ¯ä¸ªç‰ˆæœ¬æœ‰è‡ªå·±çš„ row trx_idã€‚å¦‚å›¾ 2 æ‰€ç¤ºï¼Œå°±æ˜¯ä¸€ä¸ªè®°å½•è¢«å¤šä¸ªäº‹åŠ¡è¿ç»­æ›´æ–°åçš„çŠ¶æ€ã€‚\nå¦‚å›¾æ‰€ç¤ºï¼Œå°±æ˜¯ä¸€ä¸ªè®°å½•è¢«å¤šä¸ªäº‹åŠ¡è¿ç»­æ›´æ–°åçš„çŠ¶æ€ã€‚\nå›¾ä¸­çš„ä¸‰ä¸ªè™šçº¿ç®­å¤´ï¼Œå°±æ˜¯ undo logï¼›è€Œ V1ã€V2ã€V3 å¹¶ä¸æ˜¯ç‰©ç†ä¸ŠçœŸå®å­˜åœ¨çš„ï¼Œè€Œæ˜¯æ¯æ¬¡éœ€è¦çš„æ—¶å€™æ ¹æ®å½“å‰ç‰ˆæœ¬å’Œ undo log è®¡ç®—å‡ºæ¥çš„ã€‚æ¯”å¦‚ï¼Œéœ€è¦ V2 çš„æ—¶å€™ï¼Œå°±æ˜¯é€šè¿‡ V4 ä¾æ¬¡æ‰§è¡Œ U3ã€U2 ç®—å‡ºæ¥ã€‚\næŒ‰ç…§å¯é‡å¤è¯»çš„å®šä¹‰ï¼Œä¸€ä¸ªäº‹åŠ¡å¯åŠ¨çš„æ—¶å€™ï¼Œèƒ½å¤Ÿçœ‹åˆ°æ‰€æœ‰å·²ç»æäº¤çš„äº‹åŠ¡ç»“æœã€‚ä½†æ˜¯ä¹‹åï¼Œè¿™ä¸ªäº‹åŠ¡æ‰§è¡ŒæœŸé—´ï¼Œå…¶ä»–äº‹åŠ¡çš„æ›´æ–°å¯¹å®ƒä¸å¯è§ã€‚è¿™æ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿ\nInnoDB ä¸ºæ¯ä¸ªäº‹åŠ¡æ„é€ äº†ä¸€ä¸ªæ•°ç»„ï¼Œç”¨æ¥ä¿å­˜è¿™ä¸ªäº‹åŠ¡å¯åŠ¨ç¬é—´ï¼Œå½“å‰æ­£åœ¨â€œæ´»è·ƒâ€çš„æ‰€æœ‰äº‹åŠ¡ IDã€‚â€œæ´»è·ƒâ€æŒ‡çš„å°±æ˜¯ï¼Œå¯åŠ¨äº†ä½†è¿˜æ²¡æäº¤ã€‚\næ•°ç»„é‡Œé¢äº‹åŠ¡ ID çš„æœ€å°å€¼è®°ä¸ºä½æ°´ä½ï¼Œå½“å‰ç³»ç»Ÿé‡Œé¢å·²ç»åˆ›å»ºè¿‡çš„äº‹åŠ¡ ID çš„æœ€å¤§å€¼åŠ  1 è®°ä¸ºé«˜æ°´ä½ã€‚\nè¿™ä¸ªè§†å›¾æ•°ç»„å’Œé«˜æ°´ä½ï¼Œå°±ç»„æˆäº†å½“å‰äº‹åŠ¡çš„ä¸€è‡´æ€§è§†å›¾ï¼ˆread-viewï¼‰ã€‚\nè€Œæ•°æ®ç‰ˆæœ¬çš„å¯è§æ€§è§„åˆ™ï¼Œå°±æ˜¯åŸºäºæ•°æ®çš„ row trx_id å’Œè¿™ä¸ªä¸€è‡´æ€§è§†å›¾çš„å¯¹æ¯”ç»“æœå¾—åˆ°çš„ã€‚\nè¿™ä¸ªè§†å›¾æ•°ç»„æŠŠæ‰€æœ‰çš„ row trx_id åˆ†æˆäº†å‡ ç§ä¸åŒçš„æƒ…å†µã€‚\nè¿™æ ·ï¼Œå¯¹äºå½“å‰äº‹åŠ¡çš„å¯åŠ¨ç¬é—´æ¥è¯´ï¼Œä¸€ä¸ªæ•°æ®ç‰ˆæœ¬çš„ row trx_idï¼Œæœ‰ä»¥ä¸‹å‡ ç§å¯èƒ½ï¼š\n å¦‚æœè½åœ¨ç»¿è‰²éƒ¨åˆ†ï¼Œè¡¨ç¤ºè¿™ä¸ªç‰ˆæœ¬æ˜¯å·²æäº¤çš„äº‹åŠ¡æˆ–è€…æ˜¯å½“å‰äº‹åŠ¡è‡ªå·±ç”Ÿæˆçš„ï¼Œè¿™ä¸ªæ•°æ®æ˜¯å¯è§çš„ï¼› å¦‚æœè½åœ¨çº¢è‰²éƒ¨åˆ†ï¼Œè¡¨ç¤ºè¿™ä¸ªç‰ˆæœ¬æ˜¯ç”±å°†æ¥å¯åŠ¨çš„äº‹åŠ¡ç”Ÿæˆçš„ï¼Œæ˜¯è‚¯å®šä¸å¯è§çš„ï¼› å¦‚æœè½åœ¨é»„è‰²éƒ¨åˆ†ï¼Œé‚£å°±åŒ…æ‹¬ä¸¤ç§æƒ…å†µ  a. è‹¥ row trx_id åœ¨æ•°ç»„ä¸­ï¼Œè¡¨ç¤ºè¿™ä¸ªç‰ˆæœ¬æ˜¯ç”±è¿˜æ²¡æäº¤çš„äº‹åŠ¡ç”Ÿæˆçš„ï¼Œä¸å¯è§ï¼› b. è‹¥ row trx_id ä¸åœ¨æ•°ç»„ä¸­ï¼Œè¡¨ç¤ºè¿™ä¸ªç‰ˆæœ¬æ˜¯å·²ç»æäº¤äº†çš„äº‹åŠ¡ç”Ÿæˆçš„ï¼Œå¯è§ã€‚    ä¸€ä¸ªæ•°æ®ç‰ˆæœ¬ï¼Œå¯¹äºä¸€ä¸ªäº‹åŠ¡è§†å›¾æ¥è¯´ï¼Œé™¤äº†è‡ªå·±çš„æ›´æ–°æ€»æ˜¯å¯è§ä»¥å¤–ï¼Œæœ‰ä¸‰ç§æƒ…å†µï¼š\n ç‰ˆæœ¬æœªæäº¤ï¼Œä¸å¯è§ï¼› ç‰ˆæœ¬å·²æäº¤ï¼Œä½†æ˜¯æ˜¯åœ¨è§†å›¾åˆ›å»ºåæäº¤çš„ï¼Œä¸å¯è§ï¼› ç‰ˆæœ¬å·²æäº¤ï¼Œè€Œä¸”æ˜¯åœ¨è§†å›¾åˆ›å»ºå‰æäº¤çš„ï¼Œå¯è§ã€‚  æ›´æ–°æ“ä½œ\nå¯¹äºæ›´æ–°æ“ä½œæ¥è¯´ï¼Œå…¶æ˜¾ç„¶ä¸å¯èƒ½åœ¨å†å²æ•°æ®ä¸Šæ›´æ–°ï¼Œå¦åˆ™å¯èƒ½ä¼šé€ æˆæŸä¸ªæ›´æ–°ä¸¢å¤±ï¼Œè€Œå¿…é¡»åœ¨å½“å‰ç‰ˆæœ¬ä¸Šè¿›è¡Œæ›´æ–°ã€‚æ›´æ–°æ•°æ®éƒ½æ˜¯å…ˆè¯»åå†™çš„ï¼Œè€Œè¿™ä¸ªè¯»ï¼Œåªèƒ½è¯»å½“å‰çš„å€¼ï¼Œç§°ä¸ºâ€œå½“å‰è¯»â€ï¼ˆcurrent readï¼‰\nå¦‚ä¸Šå›¾ä¸­ï¼Œäº‹åŠ¡Bçš„æ›´æ–°ç»“æœä¸ºï¼ˆ1, 3ï¼‰ã€‚\né™¤äº† update è¯­å¥å¤–ï¼Œselect è¯­å¥å¦‚æœåŠ é”ï¼Œä¹Ÿæ˜¯å½“å‰è¯»ã€‚\nMySQlä¸­æœ‰å“ªäº›é”ï¼Œåˆ†åˆ«æœ‰ä»€ä¹ˆä½œç”¨ å…¨å±€é” é¡¾åæ€ä¹‰ï¼Œå…¨å±€é”å°±æ˜¯å¯¹æ•´ä¸ªæ•°æ®åº“å®ä¾‹åŠ é”ã€‚MySQL æä¾›äº†ä¸€ä¸ªåŠ å…¨å±€è¯»é”çš„æ–¹æ³•ï¼Œå‘½ä»¤æ˜¯ Flush tables with read lock (FTWRL)ã€‚å½“ä½ éœ€è¦è®©æ•´ä¸ªåº“å¤„äºåªè¯»çŠ¶æ€çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªå‘½ä»¤ï¼Œä¹‹åå…¶ä»–çº¿ç¨‹çš„ä»¥ä¸‹è¯­å¥ä¼šè¢«é˜»å¡ï¼šæ•°æ®æ›´æ–°è¯­å¥ï¼ˆæ•°æ®çš„å¢åˆ æ”¹ï¼‰ã€æ•°æ®å®šä¹‰è¯­å¥ï¼ˆåŒ…æ‹¬å»ºè¡¨ã€ä¿®æ”¹è¡¨ç»“æ„ç­‰ï¼‰å’Œæ›´æ–°ç±»äº‹åŠ¡çš„æäº¤è¯­å¥ã€‚\nå…¨å±€é”çš„å…¸å‹ä½¿ç”¨åœºæ™¯æ˜¯ï¼Œåšå…¨åº“é€»è¾‘å¤‡ä»½ã€‚ä¹Ÿå°±æ˜¯æŠŠæ•´åº“æ¯ä¸ªè¡¨éƒ½ select å‡ºæ¥å­˜æˆæ–‡æœ¬ã€‚\nä½¿ç”¨å…¨å±€é”å­˜åœ¨çš„é—®é¢˜ ä»¥å‰æœ‰ä¸€ç§åšæ³•ï¼Œæ˜¯é€šè¿‡ FTWRL ç¡®ä¿ä¸ä¼šæœ‰å…¶ä»–çº¿ç¨‹å¯¹æ•°æ®åº“åšæ›´æ–°ï¼Œç„¶åå¯¹æ•´ä¸ªåº“åšå¤‡ä»½ã€‚æ³¨æ„ï¼Œåœ¨å¤‡ä»½è¿‡ç¨‹ä¸­æ•´ä¸ªåº“å®Œå…¨å¤„äºåªè¯»çŠ¶æ€ã€‚\nä½†æ˜¯è®©æ•´åº“éƒ½åªè¯»ï¼Œå¬ä¸Šå»å°±å¾ˆå±é™©ï¼š\n å¦‚æœä½ åœ¨ä¸»åº“ä¸Šå¤‡ä»½ï¼Œé‚£ä¹ˆåœ¨å¤‡ä»½æœŸé—´éƒ½ä¸èƒ½æ‰§è¡Œæ›´æ–°ï¼Œä¸šåŠ¡åŸºæœ¬ä¸Šå°±å¾—åœæ‘†ï¼› å¦‚æœä½ åœ¨ä»åº“ä¸Šå¤‡ä»½ï¼Œé‚£ä¹ˆå¤‡ä»½æœŸé—´ä»åº“ä¸èƒ½æ‰§è¡Œä¸»åº“åŒæ­¥è¿‡æ¥çš„ binlogï¼Œä¼šå¯¼è‡´ä¸»ä»å»¶è¿Ÿã€‚  å› æ­¤åŠ å…¨å±€é”å¯èƒ½ä¸æ˜¯å¤ªå¥½ã€‚\nå…¨å±€å¤‡ä»½ å¤‡ä»½æ—¶æˆ‘ä»¬éœ€è¦æ‹¿åˆ°ä¸€ä¸ªä¸€è‡´æ€§è§†å›¾ï¼Œä¿è¯åœ¨å¤‡ä»½æœŸé—´è¯»å–åˆ°çš„æ•°æ®ä¸å‘ç”Ÿå˜åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹å¼€å¯ä¸€ä¸ªäº‹åŠ¡ã€‚\nå®˜æ–¹è‡ªå¸¦çš„é€»è¾‘å¤‡ä»½å·¥å…·æ˜¯ mysqldumpã€‚å½“ mysqldump ä½¿ç”¨å‚æ•°â€“single-transaction çš„æ—¶å€™ï¼Œå¯¼æ•°æ®ä¹‹å‰å°±ä¼šå¯åŠ¨ä¸€ä¸ªäº‹åŠ¡ï¼Œæ¥ç¡®ä¿æ‹¿åˆ°ä¸€è‡´æ€§è§†å›¾ã€‚è€Œç”±äº MVCC çš„æ”¯æŒï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­æ•°æ®æ˜¯å¯ä»¥æ­£å¸¸æ›´æ–°çš„ã€‚\næœ‰äº†è¿™ä¸ªåŠŸèƒ½ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦ FTWRL å‘¢ï¼Ÿä¸€è‡´æ€§è¯»æ˜¯å¥½ï¼Œä½†å‰ææ˜¯å¼•æ“è¦æ”¯æŒè¿™ä¸ªéš”ç¦»çº§åˆ«ã€‚æ¯”å¦‚ï¼Œå¯¹äº MyISAM è¿™ç§ä¸æ”¯æŒäº‹åŠ¡çš„å¼•æ“ï¼Œå¦‚æœå¤‡ä»½è¿‡ç¨‹ä¸­æœ‰æ›´æ–°ï¼Œæ€»æ˜¯åªèƒ½å–åˆ°æœ€æ–°çš„æ•°æ®ï¼Œé‚£ä¹ˆå°±ç ´åäº†å¤‡ä»½çš„ä¸€è‡´æ€§ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨ FTWRL å‘½ä»¤äº†ã€‚\næ‰€ä»¥ï¼Œsingle-transaction æ–¹æ³•åªé€‚ç”¨äºæ‰€æœ‰çš„è¡¨ä½¿ç”¨äº‹åŠ¡å¼•æ“çš„åº“ã€‚å¦‚æœæœ‰çš„è¡¨ä½¿ç”¨äº†ä¸æ”¯æŒäº‹åŠ¡çš„å¼•æ“ï¼Œé‚£ä¹ˆå¤‡ä»½å°±åªèƒ½é€šè¿‡ FTWRL æ–¹æ³•ã€‚è¿™å¾€å¾€æ˜¯ DBA è¦æ±‚ä¸šåŠ¡å¼€å‘äººå‘˜ä½¿ç”¨ InnoDB æ›¿ä»£ MyISAM çš„åŸå› ä¹‹ä¸€ã€‚\nè¡¨çº§é” MySQL é‡Œé¢è¡¨çº§åˆ«çš„é”æœ‰ä¸¤ç§ï¼šä¸€ç§æ˜¯è¡¨é”ï¼Œä¸€ç§æ˜¯å…ƒæ•°æ®é”ï¼ˆmeta data lockï¼ŒMDLï¼‰ã€‚\nè¡¨é”çš„è¯­æ³•æ˜¯ lock tables â€¦ read/writeã€‚ä¸ FTWRL ç±»ä¼¼ï¼Œå¯ä»¥ç”¨ unlock tables ä¸»åŠ¨é‡Šæ”¾é”ï¼Œä¹Ÿå¯ä»¥åœ¨å®¢æˆ·ç«¯æ–­å¼€çš„æ—¶å€™è‡ªåŠ¨é‡Šæ”¾ã€‚éœ€è¦æ³¨æ„ï¼Œlock tables è¯­æ³•é™¤äº†ä¼šé™åˆ¶åˆ«çš„çº¿ç¨‹çš„è¯»å†™å¤–ï¼Œä¹Ÿé™å®šäº†æœ¬çº¿ç¨‹æ¥ä¸‹æ¥çš„æ“ä½œå¯¹è±¡ã€‚\nä¸¾ä¸ªä¾‹å­, å¦‚æœåœ¨æŸä¸ªçº¿ç¨‹ A ä¸­æ‰§è¡Œ lock tables t1 read, t2 write; è¿™ä¸ªè¯­å¥ï¼Œåˆ™å…¶ä»–çº¿ç¨‹å†™ t1ã€è¯»å†™ t2 çš„è¯­å¥éƒ½ä¼šè¢«é˜»å¡ã€‚åŒæ—¶ï¼Œçº¿ç¨‹ A åœ¨æ‰§è¡Œ unlock tables ä¹‹å‰ï¼Œä¹Ÿåªèƒ½æ‰§è¡Œè¯» t1ã€è¯»å†™ t2 çš„æ“ä½œã€‚è¿å†™ t1 éƒ½ä¸å…è®¸ï¼Œè‡ªç„¶ä¹Ÿä¸èƒ½è®¿é—®å…¶ä»–è¡¨ã€‚\nå¦ä¸€ç±»è¡¨çº§çš„é”æ˜¯ MDLï¼ˆmetadata lockï¼‰ã€‚MDL ä¸éœ€è¦æ˜¾å¼ä½¿ç”¨ï¼Œåœ¨è®¿é—®ä¸€ä¸ªè¡¨çš„æ—¶å€™ä¼šè¢«è‡ªåŠ¨åŠ ä¸Šã€‚MDL çš„ä½œç”¨æ˜¯ï¼Œä¿è¯è¯»å†™çš„æ­£ç¡®æ€§ã€‚ä½ å¯ä»¥æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœä¸€ä¸ªæŸ¥è¯¢æ­£åœ¨éå†ä¸€ä¸ªè¡¨ä¸­çš„æ•°æ®ï¼Œè€Œæ‰§è¡ŒæœŸé—´å¦ä¸€ä¸ªçº¿ç¨‹å¯¹è¿™ä¸ªè¡¨ç»“æ„åšå˜æ›´ï¼Œåˆ äº†ä¸€åˆ—ï¼Œé‚£ä¹ˆæŸ¥è¯¢çº¿ç¨‹æ‹¿åˆ°çš„ç»“æœè·Ÿè¡¨ç»“æ„å¯¹ä¸ä¸Šï¼Œè‚¯å®šæ˜¯ä¸è¡Œçš„ã€‚\nå› æ­¤ï¼Œåœ¨ MySQL 5.5 ç‰ˆæœ¬ä¸­å¼•å…¥äº† MDLï¼Œå½“å¯¹ä¸€ä¸ªè¡¨åšå¢åˆ æ”¹æŸ¥æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDL è¯»é”ï¼›å½“è¦å¯¹è¡¨åšç»“æ„å˜æ›´æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDL å†™é”ã€‚\n è¯»é”ä¹‹é—´ä¸äº’æ–¥ï¼Œå› æ­¤ä½ å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶å¯¹ä¸€å¼ è¡¨å¢åˆ æ”¹æŸ¥ã€‚ è¯»å†™é”ä¹‹é—´ã€å†™é”ä¹‹é—´æ˜¯äº’æ–¥çš„ï¼Œç”¨æ¥ä¿è¯å˜æ›´è¡¨ç»“æ„æ“ä½œçš„å®‰å…¨æ€§ã€‚å› æ­¤ï¼Œå¦‚æœæœ‰ä¸¤ä¸ªçº¿ç¨‹è¦åŒæ—¶ç»™ä¸€ä¸ªè¡¨åŠ å­—æ®µï¼Œå…¶ä¸­ä¸€ä¸ªè¦ç­‰å¦ä¸€ä¸ªæ‰§è¡Œå®Œæ‰èƒ½å¼€å§‹æ‰§è¡Œã€‚  è¡Œé” MySQL çš„è¡Œé”æ˜¯åœ¨å¼•æ“å±‚ç”±å„ä¸ªå¼•æ“è‡ªå·±å®ç°çš„ã€‚ä½†å¹¶ä¸æ˜¯æ‰€æœ‰çš„å¼•æ“éƒ½æ”¯æŒè¡Œé”ï¼Œæ¯”å¦‚ MyISAM å¼•æ“å°±ä¸æ”¯æŒè¡Œé”ã€‚ä¸æ”¯æŒè¡Œé”æ„å‘³ç€å¹¶å‘æ§åˆ¶åªèƒ½ä½¿ç”¨è¡¨é”ï¼Œå¯¹äºè¿™ç§å¼•æ“çš„è¡¨ï¼ŒåŒä¸€å¼ è¡¨ä¸Šä»»ä½•æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªæ›´æ–°åœ¨æ‰§è¡Œï¼Œè¿™å°±ä¼šå½±å“åˆ°ä¸šåŠ¡å¹¶å‘åº¦ã€‚InnoDB æ˜¯æ”¯æŒè¡Œé”çš„ï¼Œè¿™ä¹Ÿæ˜¯ MyISAM è¢« InnoDB æ›¿ä»£çš„é‡è¦åŸå› ä¹‹ä¸€ã€‚\né¡¾åæ€ä¹‰ï¼Œè¡Œé”å°±æ˜¯é’ˆå¯¹æ•°æ®è¡¨ä¸­è¡Œè®°å½•çš„é”ã€‚è¿™å¾ˆå¥½ç†è§£ï¼Œæ¯”å¦‚äº‹åŠ¡ A æ›´æ–°äº†ä¸€è¡Œï¼Œè€Œè¿™æ—¶å€™äº‹åŠ¡ B ä¹Ÿè¦æ›´æ–°åŒä¸€è¡Œï¼Œåˆ™å¿…é¡»ç­‰äº‹åŠ¡ A çš„æ“ä½œå®Œæˆåæ‰èƒ½è¿›è¡Œæ›´æ–°ã€‚\nä¸¤é˜¶æ®µé” åœ¨ InnoDB äº‹åŠ¡ä¸­ï¼Œè¡Œé”æ˜¯åœ¨éœ€è¦çš„æ—¶å€™æ‰åŠ ä¸Šçš„ï¼Œä½†å¹¶ä¸æ˜¯ä¸éœ€è¦äº†å°±ç«‹åˆ»é‡Šæ”¾ï¼Œè€Œæ˜¯è¦ç­‰åˆ°äº‹åŠ¡ç»“æŸæ—¶æ‰é‡Šæ”¾ã€‚è¿™ä¸ªå°±æ˜¯ä¸¤é˜¶æ®µé”åè®®ã€‚\n å› æ­¤ï¼Œå¦‚æœä½ çš„äº‹åŠ¡ä¸­éœ€è¦é”å¤šä¸ªè¡Œï¼Œè¦æŠŠæœ€å¯èƒ½é€ æˆé”å†²çªã€æœ€å¯èƒ½å½±å“å¹¶å‘åº¦çš„é”å°½é‡å¾€åæ”¾ã€‚\n æ­»é”å’Œæ­»é”æ£€æµ‹ æ­»é”ç°è±¡ å½“å¹¶å‘ç³»ç»Ÿä¸­ä¸åŒçº¿ç¨‹å‡ºç°å¾ªç¯èµ„æºä¾èµ–ï¼Œæ¶‰åŠçš„çº¿ç¨‹éƒ½åœ¨ç­‰å¾…åˆ«çš„çº¿ç¨‹é‡Šæ”¾èµ„æºæ—¶ï¼Œå°±ä¼šå¯¼è‡´è¿™å‡ ä¸ªçº¿ç¨‹éƒ½è¿›å…¥æ— é™ç­‰å¾…çš„çŠ¶æ€ï¼Œç§°ä¸ºæ­»é”ã€‚\nè¿™æ—¶å€™ï¼Œäº‹åŠ¡ A åœ¨ç­‰å¾…äº‹åŠ¡ B é‡Šæ”¾ id=2 çš„è¡Œé”ï¼Œè€Œäº‹åŠ¡ B åœ¨ç­‰å¾…äº‹åŠ¡ A é‡Šæ”¾ id=1 çš„è¡Œé”ã€‚ äº‹åŠ¡ A å’Œäº‹åŠ¡ B åœ¨äº’ç›¸ç­‰å¾…å¯¹æ–¹çš„èµ„æºé‡Šæ”¾ï¼Œå°±æ˜¯è¿›å…¥äº†æ­»é”çŠ¶æ€ã€‚\næ­»é”çš„å¤„ç† å½“å‡ºç°æ­»é”ä»¥åï¼Œæœ‰ä¸¤ç§ç­–ç•¥ï¼š\n  ä¸€ç§ç­–ç•¥æ˜¯ï¼Œç›´æ¥è¿›å…¥ç­‰å¾…ï¼Œç›´åˆ°è¶…æ—¶ã€‚è¿™ä¸ªè¶…æ—¶æ—¶é—´å¯ä»¥é€šè¿‡å‚æ•° innodb_lock_wait_timeout æ¥è®¾ç½®ã€‚\n  å¦ä¸€ç§ç­–ç•¥æ˜¯ï¼Œå‘èµ·æ­»é”æ£€æµ‹ï¼Œå‘ç°æ­»é”åï¼Œä¸»åŠ¨å›æ»šæ­»é”é“¾æ¡ä¸­çš„æŸä¸€ä¸ªäº‹åŠ¡ï¼Œè®©å…¶ä»–äº‹åŠ¡å¾—ä»¥ç»§ç»­æ‰§è¡Œã€‚å°†å‚æ•° innodb_deadlock_detect è®¾ç½®ä¸º onï¼Œè¡¨ç¤ºå¼€å¯è¿™ä¸ªé€»è¾‘ã€‚\n  åœ¨ InnoDB ä¸­ï¼Œinnodb_lock_wait_timeout çš„é»˜è®¤å€¼æ˜¯ 50sï¼Œæ„å‘³ç€å¦‚æœé‡‡ç”¨ç¬¬ä¸€ä¸ªç­–ç•¥ï¼Œå½“å‡ºç°æ­»é”ä»¥åï¼Œç¬¬ä¸€ä¸ªè¢«é”ä½çš„çº¿ç¨‹è¦è¿‡ 50s æ‰ä¼šè¶…æ—¶é€€å‡ºï¼Œç„¶åå…¶ä»–çº¿ç¨‹æ‰æœ‰å¯èƒ½ç»§ç»­æ‰§è¡Œã€‚å¯¹äºåœ¨çº¿æœåŠ¡æ¥è¯´ï¼Œè¿™ä¸ªç­‰å¾…æ—¶é—´å¾€å¾€æ˜¯æ— æ³•æ¥å—çš„ã€‚\nä½†æ˜¯ï¼Œæˆ‘ä»¬åˆä¸å¯èƒ½ç›´æ¥æŠŠè¿™ä¸ªæ—¶é—´è®¾ç½®æˆä¸€ä¸ªå¾ˆå°çš„å€¼ï¼Œæ¯”å¦‚ 1sã€‚è¿™æ ·å½“å‡ºç°æ­»é”çš„æ—¶å€™ï¼Œç¡®å®å¾ˆå¿«å°±å¯ä»¥è§£å¼€ï¼Œä½†å¦‚æœä¸æ˜¯æ­»é”ï¼Œè€Œæ˜¯ç®€å•çš„é”ç­‰å¾…å‘¢ï¼Ÿæ‰€ä»¥ï¼Œè¶…æ—¶æ—¶é—´è®¾ç½®å¤ªçŸ­çš„è¯ï¼Œä¼šå‡ºç°å¾ˆå¤šè¯¯ä¼¤ã€‚\næ‰€ä»¥ï¼Œæ­£å¸¸æƒ…å†µä¸‹æˆ‘ä»¬è¿˜æ˜¯è¦é‡‡ç”¨ç¬¬äºŒç§ç­–ç•¥ï¼Œå³ï¼šä¸»åŠ¨æ­»é”æ£€æµ‹ï¼Œè€Œä¸” innodb_deadlock_detect çš„é»˜è®¤å€¼æœ¬èº«å°±æ˜¯ onã€‚ä¸»åŠ¨æ­»é”æ£€æµ‹åœ¨å‘ç”Ÿæ­»é”çš„æ—¶å€™ï¼Œæ˜¯èƒ½å¤Ÿå¿«é€Ÿå‘ç°å¹¶è¿›è¡Œå¤„ç†çš„ï¼Œä½†æ˜¯å®ƒä¹Ÿæ˜¯æœ‰é¢å¤–è´Ÿæ‹…çš„ã€‚\næ¯ä¸ªæ–°æ¥çš„è¢«å µä½çš„çº¿ç¨‹ï¼Œéƒ½è¦åˆ¤æ–­ä¼šä¸ä¼šç”±äºè‡ªå·±çš„åŠ å…¥å¯¼è‡´äº†æ­»é”ï¼Œè¿™æ˜¯ä¸€ä¸ªæ—¶é—´å¤æ‚åº¦æ˜¯ O(n) çš„æ“ä½œã€‚å‡è®¾æœ‰ 1000 ä¸ªå¹¶å‘çº¿ç¨‹è¦åŒæ—¶æ›´æ–°åŒä¸€è¡Œï¼Œé‚£ä¹ˆæ­»é”æ£€æµ‹æ“ä½œå°±æ˜¯ 100 ä¸‡è¿™ä¸ªé‡çº§çš„ã€‚è™½ç„¶æœ€ç»ˆæ£€æµ‹çš„ç»“æœæ˜¯æ²¡æœ‰æ­»é”ï¼Œä½†æ˜¯è¿™æœŸé—´è¦æ¶ˆè€—å¤§é‡çš„ CPU èµ„æºã€‚å› æ­¤ï¼Œä½ å°±ä¼šçœ‹åˆ° CPU åˆ©ç”¨ç‡å¾ˆé«˜ï¼Œä½†æ˜¯æ¯ç§’å´æ‰§è¡Œä¸äº†å‡ ä¸ªäº‹åŠ¡ã€‚\né’ˆå¯¹æ­»é”æ£€æµ‹é€ æˆçš„æ€§èƒ½æŸè€—ï¼Œå¯ä»¥é€‰æ‹©ç›´æ¥å…³é—­æ­»é”æ£€æµ‹ï¼Œä½†è¿™å¿…ç„¶å¸¦æ¥ä¸€å®šçš„é£é™©ï¼›æˆ–è€…æˆ‘ä»¬å¯ä»¥é€‰æ‹©æ§åˆ¶å¹¶å‘åº¦ï¼Œå¦‚æœåŒä¸€è¡Œæ¯æ¬¡æœ€å¤šåªæœ‰10ä¸ªçº¿ç¨‹åœ¨æ›´æ–°ï¼Œé‚£ä¹ˆæ­»é”æ£€æµ‹çš„æˆæœ¬å¾ˆä½ï¼Œå°±ä¸ä¼šå‡ºç°æ­»é”æ£€æµ‹å ç”¨å¤ªå¤šèµ„æºçš„é—®é¢˜ï¼Œä½†è¿™ç§æ–¹å¼ä¹Ÿå¾ˆä¸å¥½æ§åˆ¶ã€‚\n","permalink":"http://yangchnet.github.io/Dessert/posts/%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%A6%82%E8%A7%88mysql%E7%AF%87%E4%B8%89%E9%94%81/","summary":"æå®¢æ—¶é—´ã€ŠMySQLå®æˆ˜45è®²ã€‹ç¬”è®°\n MySQLä¸­çš„éš”ç¦»çº§åˆ« è§æœ¬åœ°äº‹åŠ¡çš„éš”ç¦»\näº‹åŠ¡éš”ç¦»çš„å®ç° äº‹åŠ¡ä¹‹é—´çš„éš”ç¦»æ˜¯å¦‚ä½•å®ç°çš„?\nåœ¨ MySQL ä¸­ï¼Œå®é™…ä¸Šæ¯æ¡è®°å½•åœ¨æ›´æ–°çš„æ—¶å€™éƒ½ä¼šåŒæ—¶è®°å½•ä¸€æ¡å›æ»šæ“ä½œã€‚è®°å½•ä¸Šçš„æœ€æ–°å€¼ï¼Œé€šè¿‡å›æ»šæ“ä½œï¼Œéƒ½å¯ä»¥å¾—åˆ°å‰ä¸€ä¸ªçŠ¶æ€çš„å€¼ã€‚\nå‡è®¾ä¸€ä¸ªå€¼ä» 1 è¢«æŒ‰é¡ºåºæ”¹æˆäº† 2ã€3ã€4ï¼Œåœ¨å›æ»šæ—¥å¿—é‡Œé¢å°±ä¼šæœ‰ç±»ä¼¼ä¸‹é¢çš„è®°å½•ã€‚\nå½“å‰å€¼æ˜¯ 4ï¼Œä½†æ˜¯åœ¨æŸ¥è¯¢è¿™æ¡è®°å½•çš„æ—¶å€™ï¼Œä¸åŒæ—¶åˆ»å¯åŠ¨çš„äº‹åŠ¡ä¼šæœ‰ä¸åŒçš„ read-viewã€‚å¦‚å›¾ä¸­çœ‹åˆ°çš„ï¼Œåœ¨è§†å›¾ Aã€Bã€C é‡Œé¢ï¼Œè¿™ä¸€ä¸ªè®°å½•çš„å€¼åˆ†åˆ«æ˜¯ 1ã€2ã€4ï¼ŒåŒä¸€æ¡è®°å½•åœ¨ç³»ç»Ÿä¸­å¯ä»¥å­˜åœ¨å¤šä¸ªç‰ˆæœ¬ï¼Œå°±æ˜¯æ•°æ®åº“çš„å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMVCCï¼‰ã€‚å¯¹äº read-view Aï¼Œè¦å¾—åˆ° 1ï¼Œå°±å¿…é¡»å°†å½“å‰å€¼ä¾æ¬¡æ‰§è¡Œå›¾ä¸­æ‰€æœ‰çš„å›æ»šæ“ä½œå¾—åˆ°ã€‚\nä½†è¿™ç§å›æ»šæ—¥å¿—ä¸èƒ½ä¸€ç›´ä¿ç•™ï¼Œå½“ç³»ç»Ÿåˆ¤æ–­ï¼Œæ²¡æœ‰äº‹åŠ¡å†éœ€è¦ç”¨åˆ°è¿™äº›å›æ»šæ—¥å¿—æ—¶ï¼Œå›æ»šæ—¥å¿—ä¼šè¢«åˆ é™¤ï¼Œä¹Ÿå³å½“ç³»ç»Ÿä¸­æ²¡æœ‰æ¯”è¿™ä¸ªå›æ»šæ—¥å¿—æ›´æ—©çš„read-viewæ—¶ã€‚\nå¦‚ä½•å°½é‡é¿å…é•¿äº‹åŠ¡ ä¸ºä»€ä¹ˆè¦é¿å…é•¿äº‹åŠ¡ï¼Ÿ\né•¿äº‹åŠ¡æ„å‘³ç€ç³»ç»Ÿé‡Œé¢ä¼šå­˜åœ¨å¾ˆè€çš„äº‹åŠ¡è§†å›¾ã€‚ç”±äºè¿™äº›äº‹åŠ¡éšæ—¶å¯èƒ½è®¿é—®æ•°æ®åº“é‡Œé¢çš„ä»»ä½•æ•°æ®ï¼Œæ‰€ä»¥è¿™ä¸ªäº‹åŠ¡æäº¤ä¹‹å‰ï¼Œæ•°æ®åº“é‡Œé¢å®ƒå¯èƒ½ç”¨åˆ°çš„å›æ»šè®°å½•éƒ½å¿…é¡»ä¿ç•™ï¼Œè¿™å°±ä¼šå¯¼è‡´å¤§é‡å ç”¨å­˜å‚¨ç©ºé—´ã€‚\nåœ¨ MySQL 5.5 åŠä»¥å‰çš„ç‰ˆæœ¬ï¼Œå›æ»šæ—¥å¿—æ˜¯è·Ÿæ•°æ®å­—å…¸ä¸€èµ·æ”¾åœ¨ ibdata æ–‡ä»¶é‡Œçš„ï¼Œå³ä½¿é•¿äº‹åŠ¡æœ€ç»ˆæäº¤ï¼Œå›æ»šæ®µè¢«æ¸…ç†ï¼Œæ–‡ä»¶ä¹Ÿä¸ä¼šå˜å°ã€‚\né™¤äº†å¯¹å›æ»šæ®µçš„å½±å“ï¼Œé•¿äº‹åŠ¡è¿˜å ç”¨é”èµ„æºï¼Œä¹Ÿå¯èƒ½æ‹–å®æ•´ä¸ªåº“ã€‚\nå¦‚ä½•é¿å…é•¿äº‹åŠ¡ï¼Ÿ\nMySQL çš„äº‹åŠ¡å¯åŠ¨æ–¹å¼æœ‰ä»¥ä¸‹å‡ ç§ï¼š\n  æ˜¾å¼å¯åŠ¨äº‹åŠ¡è¯­å¥ï¼Œ begin æˆ– start transactionã€‚é…å¥—çš„æäº¤è¯­å¥æ˜¯ commitï¼Œå›æ»šè¯­å¥æ˜¯ rollbackã€‚\n  set autocommit=0ï¼Œè¿™ä¸ªå‘½ä»¤ä¼šå°†è¿™ä¸ªçº¿ç¨‹çš„è‡ªåŠ¨æäº¤å…³æ‰ã€‚æ„å‘³ç€å¦‚æœä½ åªæ‰§è¡Œä¸€ä¸ª select è¯­å¥ï¼Œè¿™ä¸ªäº‹åŠ¡å°±å¯åŠ¨äº†ï¼Œè€Œä¸”å¹¶ä¸ä¼šè‡ªåŠ¨æäº¤ã€‚è¿™ä¸ªäº‹åŠ¡æŒç»­å­˜åœ¨ç›´åˆ°ä½ ä¸»åŠ¨æ‰§è¡Œ commit æˆ– rollback è¯­å¥ï¼Œæˆ–è€…æ–­å¼€è¿æ¥ã€‚\n  å› æ­¤ï¼Œå»ºè®®æ€»æ˜¯ä½¿ç”¨ set autocommit=1, é€šè¿‡æ˜¾å¼è¯­å¥çš„æ–¹å¼æ¥å¯åŠ¨äº‹åŠ¡ã€‚\nä½†è¿™æ ·ä¼šå¤šä¸€æ¬¡â€œäº¤äº’â€ï¼Œé’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œä½¿ç”¨commit work and chain è¯­æ³•ã€‚\nåœ¨ autocommit ä¸º 1 çš„æƒ…å†µä¸‹ï¼Œç”¨ begin æ˜¾å¼å¯åŠ¨çš„äº‹åŠ¡ï¼Œå¦‚æœæ‰§è¡Œ commit åˆ™æäº¤äº‹åŠ¡ã€‚å¦‚æœæ‰§è¡Œ commit work and chainï¼Œåˆ™æ˜¯æäº¤äº‹åŠ¡å¹¶è‡ªåŠ¨å¯åŠ¨ä¸‹ä¸€ä¸ªäº‹åŠ¡ï¼Œè¿™æ ·ä¹Ÿçœå»äº†å†æ¬¡æ‰§è¡Œ begin è¯­å¥çš„å¼€é”€ã€‚åŒæ—¶å¸¦æ¥çš„å¥½å¤„æ˜¯ä»ç¨‹åºå¼€å‘çš„è§’åº¦æ˜ç¡®åœ°çŸ¥é“æ¯ä¸ªè¯­å¥æ˜¯å¦å¤„äºäº‹åŠ¡ä¸­ã€‚","title":"æ¦‚è§ˆMySQLç¯‡ä¸‰ï¼šé”ã€äº‹åŠ¡å’Œéš”ç¦»"},{"content":" æå®¢æ—¶é—´ã€ŠMySQLå®æˆ˜45è®²ã€‹ç¬”è®°\n ä»€ä¹ˆæ˜¯change bufferï¼Œæœ‰ä»€ä¹ˆä½œç”¨ å½“éœ€è¦æ›´æ–°ä¸€ä¸ªæ•°æ®é¡µæ—¶ï¼Œå¦‚æœæ•°æ®é¡µåœ¨å†…å­˜ä¸­å°±ç›´æ¥æ›´æ–°ï¼Œè€Œå¦‚æœè¿™ä¸ªæ•°æ®é¡µè¿˜æ²¡æœ‰åœ¨å†…å­˜ä¸­çš„è¯ï¼Œåœ¨ä¸å½±å“æ•°æ®ä¸€è‡´æ€§çš„å‰æä¸‹ï¼ŒInnoDB ä¼šå°†è¿™äº›æ›´æ–°æ“ä½œç¼“å­˜åœ¨ change buffer ä¸­ï¼Œè¿™æ ·å°±ä¸éœ€è¦ä»ç£ç›˜ä¸­è¯»å…¥è¿™ä¸ªæ•°æ®é¡µäº†ã€‚åœ¨ä¸‹æ¬¡æŸ¥è¯¢éœ€è¦è®¿é—®è¿™ä¸ªæ•°æ®é¡µçš„æ—¶å€™ï¼Œå°†æ•°æ®é¡µè¯»å…¥å†…å­˜ï¼Œç„¶åæ‰§è¡Œ change buffer ä¸­ä¸è¿™ä¸ªé¡µæœ‰å…³çš„æ“ä½œã€‚é€šè¿‡è¿™ç§æ–¹å¼å°±èƒ½ä¿è¯è¿™ä¸ªæ•°æ®é€»è¾‘çš„æ­£ç¡®æ€§ã€‚è¿™ä¸ªæ“ä½œç§°ä¸ºmerge.\nè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œchange bufferçœ‹èµ·æ¥åƒæ˜¯å†…å­˜ç¼“å­˜ä¸€ç±»çš„ä¸œè¥¿ï¼Œä½†æ˜¯change bufferæ˜¯å¯ä»¥æŒä¹…åŒ–çš„æ•°æ®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œchange bufferåœ¨å†…å­˜ä¸­æœ‰æ‹·è´ï¼Œä¹Ÿä¼šè¢«å†™å…¥åˆ°ç£ç›˜ä¸Šã€‚\nå¦‚æœå°†change bufferä¹Ÿå­˜åœ¨ç£ç›˜ä¸Šï¼Œè€Œæ•°æ®ä¹Ÿæ˜¯å­˜å‚¨åœ¨ç£ç›˜ä¸Šï¼Œé‚£ä¹ˆchange bufferç›¸æ¯”ç›´æ¥è¯»å–ç£ç›˜æ•°æ®å¿«åœ¨å“ªé‡Œå‘¢ï¼Ÿ\nä»ç£ç›˜è¯»å–ä¸€æ¡è®°å½•ï¼Œæ˜¯éšæœºè¯»å†™ï¼Œè€Œå†™change bufferï¼Œæ˜¯é¡ºåºè¯»å†™ã€‚è¿™äºŒè€…çš„é€Ÿåº¦å­˜åœ¨è¾ƒå¤§å·®å¼‚ã€‚éšæœºè¯»å†™ç”±äºå­˜åœ¨ç£å¤´ç§»é“ç­‰ç‰©ç†æ“ä½œï¼Œå› æ­¤æ¯”è¾ƒæ…¢ï¼Œä½†é¡ºåºè¯»å†™æ¯”è¾ƒå¿«é€Ÿã€‚\nchange bufferçš„é™åˆ¶ change bufferåªæ˜¯æš‚æ—¶çš„å°†æ›´æ–°æ“ä½œä¿å­˜ä¸‹æ¥ï¼Œè€Œå¹¶æ²¡æœ‰å»è¯»å–çœŸæ­£çš„æ•°æ®ã€‚è€ƒè™‘ä»¥ä¸‹æƒ…å†µï¼Œè¡¨ä¸­è¦æ±‚æŸä¸€å­—æ®µä¸ºå”¯ä¸€çš„ï¼Œè€Œåœ¨æ›´æ–°æ—¶ä¸å°å¿ƒæ’å…¥äº†ä¸€ä¸ªä¸åŸæœ‰æŸæ•°æ®é‡å¤çš„æ¡ç›®ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸è¢«å…è®¸çš„ã€‚\nå› æ­¤ï¼Œå½“è¡¨ä¸­å­˜åœ¨å”¯ä¸€ç´¢å¼•ã€å”¯ä¸€å€¼ç­‰é™åˆ¶ï¼Œè¿™æ—¶å€™å°±ä¸èƒ½ç”¨change bufferäº†ã€‚åªæœ‰æ™®é€šç´¢å¼•å’Œä¸å­˜åœ¨å€¼å”¯ä¸€æ€§çº¦æŸçš„åˆ—ï¼Œæ‰å¯ä»¥ç”¨change bufferã€‚\nchange bufferç”¨çš„æ˜¯buffer poolä¸­çš„å†…å­˜ï¼Œå› æ­¤ä¸èƒ½æ— é™å¢å¤§ã€‚change buffer çš„å¤§å°ï¼Œå¯ä»¥é€šè¿‡å‚æ•° innodb_change_buffer_max_size æ¥åŠ¨æ€è®¾ç½®ã€‚è¿™ä¸ªå‚æ•°è®¾ç½®ä¸º 50 çš„æ—¶å€™ï¼Œè¡¨ç¤º change buffer çš„å¤§å°æœ€å¤šåªèƒ½å ç”¨ buffer pool çš„ 50%ã€‚\nchange bufferçš„ä½¿ç”¨åœºæ™¯ merge çš„æ—¶å€™æ˜¯çœŸæ­£è¿›è¡Œæ•°æ®æ›´æ–°çš„æ—¶åˆ»ï¼Œè€Œ change buffer çš„ä¸»è¦ç›®çš„å°±æ˜¯å°†è®°å½•çš„å˜æ›´åŠ¨ä½œç¼“å­˜ä¸‹æ¥ï¼Œæ‰€ä»¥åœ¨ä¸€ä¸ªæ•°æ®é¡µåš merge ä¹‹å‰ï¼Œchange buffer è®°å½•çš„å˜æ›´è¶Šå¤šï¼ˆä¹Ÿå°±æ˜¯è¿™ä¸ªé¡µé¢ä¸Šè¦æ›´æ–°çš„æ¬¡æ•°è¶Šå¤šï¼‰ï¼Œæ”¶ç›Šå°±è¶Šå¤§ã€‚\nå› æ­¤ï¼Œå¯¹äºå†™å¤šè¯»å°‘çš„ä¸šåŠ¡æ¥è¯´ï¼Œé¡µé¢åœ¨å†™å®Œä»¥åé©¬ä¸Šè¢«è®¿é—®åˆ°çš„æ¦‚ç‡æ¯”è¾ƒå°ï¼Œæ­¤æ—¶ change buffer çš„ä½¿ç”¨æ•ˆæœæœ€å¥½ã€‚è¿™ç§ä¸šåŠ¡æ¨¡å‹å¸¸è§çš„å°±æ˜¯è´¦å•ç±»ã€æ—¥å¿—ç±»çš„ç³»ç»Ÿã€‚\nåè¿‡æ¥ï¼Œå‡è®¾ä¸€ä¸ªä¸šåŠ¡çš„æ›´æ–°æ¨¡å¼æ˜¯å†™å…¥ä¹‹åé©¬ä¸Šä¼šåšæŸ¥è¯¢ï¼Œé‚£ä¹ˆå³ä½¿æ»¡è¶³äº†æ¡ä»¶ï¼Œå°†æ›´æ–°å…ˆè®°å½•åœ¨ change bufferï¼Œä½†ä¹‹åç”±äºé©¬ä¸Šè¦è®¿é—®è¿™ä¸ªæ•°æ®é¡µï¼Œä¼šç«‹å³è§¦å‘ merge è¿‡ç¨‹ã€‚è¿™æ ·éšæœºè®¿é—® IO çš„æ¬¡æ•°ä¸ä¼šå‡å°‘ï¼Œåè€Œå¢åŠ äº† change buffer çš„ç»´æŠ¤ä»£ä»·ã€‚æ‰€ä»¥ï¼Œå¯¹äºè¿™ç§ä¸šåŠ¡æ¨¡å¼æ¥è¯´ï¼Œchange buffer åè€Œèµ·åˆ°äº†å‰¯ä½œç”¨ã€‚\nä»€ä¹ˆæ˜¯redo logï¼Œ æœ‰ä»€ä¹ˆä½œç”¨ åœ¨MySQLä¸­ï¼Œå¦‚æœæ¯ä¸€æ¬¡çš„æ›´æ–°æ“ä½œéƒ½éœ€è¦å†™è¿›ç£ç›˜ï¼Œç„¶åç£ç›˜ä¹Ÿè¦æ‰¾åˆ°å¯¹åº”çš„é‚£æ¡è®°å½•ï¼Œç„¶åå†æ›´æ–°ï¼Œæ•´ä¸ªè¿‡ç¨‹ IO æˆæœ¬ã€æŸ¥æ‰¾æˆæœ¬éƒ½å¾ˆé«˜ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç±»ä¼¼â€œç¼“å­˜â€çš„æ€è·¯æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚\nWAL:Write-Ahead Loggingï¼Œå…ˆå†™æ—¥å¿—ï¼Œå†å†™ç£ç›˜ã€‚æ³¨æ„è¿™é‡Œä¸æ˜¯Write ahead logging(åœ¨è®°æ—¥å¿—ä¹‹å‰å†™)ï¼Œè€Œæ˜¯Write-Ahead Loggingï¼šåœ¨å†™ä¹‹å‰è®°æ—¥å¿—ã€‚\nå…·ä½“è¯´æ¥ï¼Œå½“æœ‰ä¸€æ¡è®°å½•éœ€è¦æ›´æ–°çš„æ—¶å€™ï¼ŒInnoDB å¼•æ“å°±ä¼šå…ˆæŠŠè®°å½•å†™åˆ° redo log é‡Œé¢ï¼Œå¹¶æ›´æ–°å†…å­˜ï¼Œè¿™ä¸ªæ—¶å€™æ›´æ–°å°±ç®—å®Œæˆäº†ï¼ˆWALï¼‰ã€‚åŒæ—¶ï¼ŒInnoDB å¼•æ“ä¼šåœ¨é€‚å½“çš„æ—¶å€™(ç³»ç»Ÿæ¯”è¾ƒç©ºé—²çš„æ—¶å€™æˆ–å…¶ä»–æƒ…å†µ)ï¼Œå°†è¿™ä¸ªæ“ä½œè®°å½•æ›´æ–°åˆ°ç£ç›˜é‡Œé¢.\nä½†redo logå¹¶ä¸æ˜¯æ— é™å¤§çš„ï¼Œå¦‚æœå½“å‰ç³»ç»Ÿæ¯”è¾ƒç¹å¿™ï¼Œredo logå¾ˆå¿«å°±è¢«å†™æ»¡ï¼Œé‚£ä¹ˆè¿™æ—¶å€™ç³»ç»Ÿåªèƒ½å…ˆæš‚åœå¤„ç†è¯·æ±‚ï¼Œè½¬è€ŒæŠŠredo logä¸­çš„å†…å®¹åˆ·åˆ°ç£ç›˜ä¸Šã€‚redo logçš„ç»“æ„ç±»ä¼¼å¾ªç¯é˜Ÿåˆ—ã€‚\nredo logå¹¶ä¸æ˜¯åœ¨å†…å­˜é‡Œï¼Œè€Œæ˜¯å­˜å‚¨åœ¨ç£ç›˜ä¸Šï¼Œå…¶æé«˜è¯»å†™é€Ÿåº¦çš„å…³é”®åœ¨äºå°†åŸæ¥æŸ¥è¯¢æ•°æ®çš„éšæœºè¯»å†™è½¬åŒ–ä¸ºé¡ºåºè¯»å†™ï¼Œå› æ­¤é€Ÿåº¦å¿«çš„å¤šã€‚\nredo logä¸ºMySQLæä¾›äº†crash-safeçš„èƒ½åŠ›ï¼Œå½“ç³»ç»Ÿçªç„¶å®•æœºï¼Œæ•°æ®åº“ä¸­çš„æ›´æ–°ä¸ä¼šä¸¢å¤±ï¼Œå¯ä»¥å®Œæ•´çš„æ¢å¤ã€‚\nä»€ä¹ˆæ˜¯binlogï¼Œæœ‰ä»€ä¹ˆä½œç”¨ redo logæ˜¯InnoDBå¼•æ“ç‰¹æœ‰çš„æ—¥å¿—ç³»ç»Ÿï¼Œè€Œbinlogæ‰æ˜¯MySQLçš„â€œäº²å„¿å­â€ã€‚\nbinlogæ˜¯è®°å½•æ‰€æœ‰æ•°æ®åº“è¡¨ç»“æ„å˜æ›´ä»¥åŠè¡¨æ•°æ®ä¿®æ”¹çš„äºŒè¿›åˆ¶æ—¥å¿—ï¼Œä¸ä¼šè®°å½•SELECTå’ŒSHOWè¿™ç±»æ“ä½œã€‚\nbinlogæ—¥å¿—æ˜¯ä»¥äº‹ä»¶å½¢å¼è®°å½•ï¼Œè¿˜åŒ…å«è¯­å¥æ‰€æ‰§è¡Œçš„æ¶ˆè€—æ—¶é—´ã€‚\nbinlogå¯¹æ•°æ®è¿›è¡Œâ€œå­˜æ¡£â€ï¼Œä»è€Œå¯é€šè¿‡binlogå¯¹æ•°æ®è¿›è¡Œæ¢å¤ï¼ŒåŒæ—¶é€šè¿‡binlogè¿˜å¯è¿›è¡Œä¸»ä»å¤‡ä»½ã€å¤åˆ¶ç­‰ã€‚\nä¸ºä»€ä¹ˆMySQLæœ‰ä¸¤ä¸ªæ—¥å¿—ç³»ç»Ÿï¼Œæœ‰ä»€ä¹ˆå·®åˆ«å—ï¼Œèƒ½ä¸èƒ½åªç”¨å…¶ä¸­ä¸€ä¸ª MySQLåˆ†ä¸ºserverå±‚å’Œå¼•æ“å±‚ï¼Œè€Œå¼•æ“å±‚æ˜¯å¯è¢«æ›¿æ¢çš„ã€‚MySQLè‡ªå¸¦çš„å¼•æ“å«MyISAMï¼Œä½†æ˜¯ MyISAM æ²¡æœ‰ crash-safe çš„èƒ½åŠ›ï¼Œbinlog æ—¥å¿—åªèƒ½ç”¨äºå½’æ¡£. InnoDBæ˜¯å¦ä¸€å®¶å…¬å¸ä»¥æ’ä»¶å½¢å¼å¼•å…¥MySQLçš„ï¼Œè€Œredo logå°±æ˜¯InnoDBç”¨æ¥å®ç°crash-safeçš„æ—¥å¿—ç³»ç»Ÿã€‚\nè¿™ä¸¤ç§æ—¥å¿—æœ‰ä»¥ä¸‹ä¸‰ç‚¹ä¸åŒï¼š\n  redo log æ˜¯ InnoDB å¼•æ“ç‰¹æœ‰çš„ï¼›binlog æ˜¯ MySQL çš„ Server å±‚å®ç°çš„ï¼Œæ‰€æœ‰å¼•æ“éƒ½å¯ä»¥ä½¿ç”¨ã€‚\n  redo log æ˜¯ç‰©ç†æ—¥å¿—ï¼Œè®°å½•çš„æ˜¯â€œåœ¨æŸä¸ªæ•°æ®é¡µä¸Šåšäº†ä»€ä¹ˆä¿®æ”¹â€ï¼›binlog æ˜¯é€»è¾‘æ—¥å¿—ï¼Œè®°å½•çš„æ˜¯è¿™ä¸ªè¯­å¥çš„åŸå§‹é€»è¾‘ï¼Œæ¯”å¦‚â€œç»™ ID=2 è¿™ä¸€è¡Œçš„ c å­—æ®µåŠ  1 â€ã€‚\n  redo log æ˜¯å¾ªç¯å†™çš„ï¼Œç©ºé—´å›ºå®šä¼šç”¨å®Œï¼›binlog æ˜¯å¯ä»¥è¿½åŠ å†™å…¥çš„ã€‚â€œè¿½åŠ å†™â€æ˜¯æŒ‡ binlog æ–‡ä»¶å†™åˆ°ä¸€å®šå¤§å°åä¼šåˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªï¼Œå¹¶ä¸ä¼šè¦†ç›–ä»¥å‰çš„æ—¥å¿—ã€‚\n  èƒ½ä¸èƒ½åªä½¿ç”¨å…¶ä¸­æŸä¸€ä¸ªæ—¥å¿—ï¼Ÿç­”æ›°ï¼šæœ€å¥½ä¸è¦.\n åªä½¿ç”¨binlogï¼Œåˆ™MySQLä¸èƒ½åšåˆ°crash-safeï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœæ•°æ®åº“å®•æœºï¼Œé‚£ä¹ˆå¯èƒ½ä¼šé€ æˆæ•°æ®çš„ä¸¢å¤±ã€‚ åªä½¿ç”¨redo logï¼Œåˆ™MySQLä¸èƒ½åšåˆ°æ•°æ®å­˜æ¡£ï¼Œæ— æ³•è¿›è¡Œæ•°æ®æ¢å¤ï¼Œä¸»ä»å¤‡ä»½ç­‰æ“ä½œã€‚  å› æ­¤ï¼Œbinlogå’Œredo logç¼ºä¸€ä¸å¯ï¼Œredo logè™½ç„¶æ˜¯â€œåå¨˜å…»çš„â€ï¼Œä½†æ˜¯å¯¹MySQLæœ‰å¾ˆå¤§çš„ä½œç”¨ã€‚\nä»€ä¹ˆæ˜¯ä¸¤é˜¶æ®µæäº¤ï¼Œä¸ºä»€ä¹ˆéœ€è¦ä¸¤é˜¶æ®µæäº¤ ä¸€ä¸ªæ›´æ–°è¯­å¥çš„æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š\n  æ‰§è¡Œå™¨å…ˆæ‰¾å¼•æ“å– ID=2 è¿™ä¸€è¡Œã€‚ID æ˜¯ä¸»é”®ï¼Œå¼•æ“ç›´æ¥ç”¨æ ‘æœç´¢æ‰¾åˆ°è¿™ä¸€è¡Œã€‚å¦‚æœ ID=2 è¿™ä¸€è¡Œæ‰€åœ¨çš„æ•°æ®é¡µæœ¬æ¥å°±åœ¨å†…å­˜ä¸­ï¼Œå°±ç›´æ¥è¿”å›ç»™æ‰§è¡Œå™¨ï¼›å¦åˆ™ï¼Œéœ€è¦å…ˆä»ç£ç›˜è¯»å…¥å†…å­˜ï¼Œç„¶åå†è¿”å›ã€‚\n  æ‰§è¡Œå™¨æ‹¿åˆ°å¼•æ“ç»™çš„è¡Œæ•°æ®ï¼ŒæŠŠè¿™ä¸ªå€¼åŠ ä¸Š 1ï¼Œæ¯”å¦‚åŸæ¥æ˜¯ Nï¼Œç°åœ¨å°±æ˜¯ N+1ï¼Œå¾—åˆ°æ–°çš„ä¸€è¡Œæ•°æ®ï¼Œå†è°ƒç”¨å¼•æ“æ¥å£å†™å…¥è¿™è¡Œæ–°æ•°æ®ã€‚\n  å¼•æ“å°†è¿™è¡Œæ–°æ•°æ®æ›´æ–°åˆ°å†…å­˜ä¸­ï¼ŒåŒæ—¶å°†è¿™ä¸ªæ›´æ–°æ“ä½œè®°å½•åˆ° redo log é‡Œé¢ï¼Œæ­¤æ—¶ redo log å¤„äº prepare çŠ¶æ€ã€‚ç„¶åå‘ŠçŸ¥æ‰§è¡Œå™¨æ‰§è¡Œå®Œæˆäº†ï¼Œéšæ—¶å¯ä»¥æäº¤äº‹åŠ¡ã€‚\n  æ‰§è¡Œå™¨ç”Ÿæˆè¿™ä¸ªæ“ä½œçš„ binlogï¼Œå¹¶æŠŠ binlog å†™å…¥ç£ç›˜ã€‚\n  æ‰§è¡Œå™¨è°ƒç”¨å¼•æ“çš„æäº¤äº‹åŠ¡æ¥å£ï¼Œå¼•æ“æŠŠåˆšåˆšå†™å…¥çš„ redo log æ”¹æˆæäº¤ï¼ˆcommitï¼‰çŠ¶æ€ï¼Œæ›´æ–°å®Œæˆã€‚\n  åœ¨ä¸Šé¢æ­¥éª¤çš„åä¸‰éƒ¨ä¸­ï¼Œæˆ‘ä»¬å…ˆæ˜¯å°†æ›´æ–°æ“ä½œè®°å½•åˆ°redo logä¸­ï¼Œä½†å¹¶ä¸æäº¤äº‹åŠ¡ï¼Œå†å†™å…¥binlogï¼Œæœ€åå†æŠŠåˆšæ‰å†™å…¥çš„redo logæäº¤ã€‚è¿™ä¸ªæ­¥éª¤ç§°ä¸ºä¸¤é˜¶æ®µæäº¤\nä¸ºä»€ä¹ˆè¦ä½¿ç”¨ä¸¤é˜¶æ®µæäº¤ï¼Ÿç­”æ›°ï¼šä¸ºäº†ä½¿ä¸¤ä»½æ—¥å¿—ä¹‹é—´çš„é€»è¾‘ä¸€è‡´ã€‚\nä¸ºäº†è¯´æ˜è¿™ä¸ªé—®é¢˜ã€‚å¯¹äºå¦‚ä¸‹è¯­å¥ï¼šupdate a = 1 where a = 0, è€ƒè™‘ä¸‹é¢ä¸¤ç§æƒ…å†µ:\n å…ˆæäº¤redo logï¼Œå†æäº¤binlogã€‚  å¦‚æœåœ¨redo logæäº¤å®Œæˆåæ•°æ®åº“å®•æœºï¼Œç³»ç»Ÿæ¢å¤åredo logå°†æ•°æ®æ¢å¤, è¿™ä¸€è¡Œå·²ç»æˆåŠŸçš„è¢«ä¿®æ”¹ä¸º1ï¼Œä½†binlogä¸­å¹¶æ²¡æœ‰è¿™æ¡æ•°æ®ï¼Œå¦‚æœè¿™æ—¶å€™ç”¨binlogæ¥æ¢å¤ä¸´æ—¶åº“çš„è¯ï¼Œç”±äºè¿™ä¸ªè¯­å¥çš„binlogä¸¢å¤±ï¼Œå› æ­¤åˆšæ‰çš„æ”¹åŠ¨å¹¶ä¸ä¼šåº”ç”¨åˆ°ä¸´æ—¶åº“ä¸Šï¼Œä¸´æ—¶åº“ä¸åŸåº“çš„å€¼ä¸åŒï¼Œé€ æˆäº†æ•°æ®ä¸ä¸€è‡´ã€‚\nå…ˆå†™binlogå†å†™redo log  å¦‚æœå†™å®Œbinlogä¹‹åç³»ç»Ÿå´©æºƒï¼Œè¿™æ—¶å€™binlogå·²ç»è®°å½•äº†ä¿®æ”¹æ•°æ®çš„é€»è¾‘ã€‚ä½†å´©æºƒæ¢å¤åç”±äºredo logä¸­æ²¡æœ‰è¿™æ¡æ›´æ–°ï¼Œå› æ­¤æ”¹åŠ¨å¹¶ä¸ä¼šåº”ç”¨åˆ°æ•°æ®è¡¨ä¸Š,è¿™ä¸€è¡Œä¾ç„¶æ˜¯0.å¦‚æœè¿™æ—¶ç”¨binlogæ¥æ¢å¤æ•°æ®æˆ–ä¸»ä»å¤åˆ¶ï¼Œé‚£ä¹ˆbinlogçš„è®°å½•ä¸­å¤šäº†ä¸€ä¸ªäº‹åŠ¡å‡ºæ¥ï¼Œæ¢å¤å‡ºæ¥çš„è¡Œä¸º1,é€ æˆäº†æ•°æ®ä¸ä¸€è‡´ã€‚\nå¯¹äºä¸¤é˜¶æ®µæäº¤ï¼Œå®ƒæ˜¯å¦‚ä½•ä¿è¯æ•°æ®ä¸€è‡´æ€§çš„å‘¢ï¼Ÿ\nå¯¹äºä¸¤é˜¶æ®µæäº¤ï¼šâ‘ redo log prepare ----\u0026gt; â‘¡å†™binlog ----\u0026gt; â‘¢redo log commit\nå¦‚æœåœ¨â‘¡ä¹‹å‰å´©æºƒï¼Œé‡å¯æ¢å¤åå‘ç°æ²¡æœ‰commitï¼Œå›æ»šï¼Œäº‹åŠ¡ä¸æˆåŠŸã€‚å¤‡ä»½æ¢å¤æ—¶ï¼Œæ²¡æœ‰binlogï¼Œæ•°æ®ä¸€è‡´ã€‚\nå¦‚æœåœ¨â‘¢ä¹‹å‰å´©æºƒï¼Œé‡å¯æ¢å¤åè™½ç„¶æ²¡æœ‰commitï¼Œä½†prepareå’Œbinlogéƒ½å®Œæˆï¼Œå°†è‡ªåŠ¨commitã€‚å¤‡ä»½æ¢å¤æ—¶ï¼Œbinlogå®Œæ•´ï¼Œæ•°æ®ä¸€è‡´ã€‚\nbinlogçš„å†™å…¥æœºåˆ¶ binlogçš„å†™å…¥é€»è¾‘æ¯”è¾ƒç®€å•ï¼šäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå…ˆæŠŠæ—¥å¿—å†™é“binlog cacheï¼Œäº‹åŠ¡æäº¤åï¼Œå†æŠŠbinlog cacheå†™åˆ°binlogæ–‡ä»¶ä¸­ã€‚\nä½†ï¼Œä¸€ä¸ªäº‹åŠ¡çš„ binlog æ˜¯ä¸èƒ½è¢«æ‹†å¼€çš„ï¼Œå› æ­¤ä¸è®ºè¿™ä¸ªäº‹åŠ¡å¤šå¤§ï¼Œä¹Ÿè¦ç¡®ä¿ä¸€æ¬¡æ€§å†™å…¥ã€‚è¿™å°±æ¶‰åŠåˆ°äº† binlog cache çš„ä¿å­˜é—®é¢˜ã€‚\nç³»ç»Ÿç»™ binlog cache åˆ†é…äº†ä¸€ç‰‡å†…å­˜ï¼Œæ¯ä¸ªçº¿ç¨‹ä¸€ä¸ªï¼Œå‚æ•° binlog_cache_size ç”¨äºæ§åˆ¶å•ä¸ªçº¿ç¨‹å†… binlog cache æ‰€å å†…å­˜çš„å¤§å°ã€‚å¦‚æœè¶…è¿‡äº†è¿™ä¸ªå‚æ•°è§„å®šçš„å¤§å°ï¼Œå°±è¦æš‚å­˜åˆ°ç£ç›˜ã€‚\näº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œæ‰§è¡Œå™¨æŠŠ binlog cache é‡Œçš„å®Œæ•´äº‹åŠ¡å†™å…¥åˆ° binlog ä¸­ï¼Œå¹¶æ¸…ç©º binlog cacheã€‚çŠ¶æ€å¦‚å›¾æ‰€ç¤ºã€‚\nå¯ä»¥çœ‹åˆ°ï¼Œæ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·± binlog cacheï¼Œä½†æ˜¯å…±ç”¨åŒä¸€ä»½ binlog æ–‡ä»¶ã€‚\n å›¾ä¸­çš„ writeï¼ŒæŒ‡çš„å°±æ˜¯æŒ‡æŠŠæ—¥å¿—å†™å…¥åˆ°æ–‡ä»¶ç³»ç»Ÿçš„ page cacheï¼Œå¹¶æ²¡æœ‰æŠŠæ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œæ‰€ä»¥é€Ÿåº¦æ¯”è¾ƒå¿«ã€‚ å›¾ä¸­çš„ fsyncï¼Œæ‰æ˜¯å°†æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜çš„æ“ä½œã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è®¤ä¸º fsync æ‰å ç£ç›˜çš„ IOPSã€‚  write å’Œ fsync çš„æ—¶æœºï¼Œæ˜¯ç”±å‚æ•° sync_binlog æ§åˆ¶çš„ï¼š\n sync_binlog=0 çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½åª writeï¼Œä¸ fsyncï¼› sync_binlog=1 çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½ä¼šæ‰§è¡Œ fsyncï¼› sync_binlog=N(N\u0026gt;1) çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½ writeï¼Œä½†ç´¯ç§¯ N ä¸ªäº‹åŠ¡åæ‰ fsyncã€‚  å› æ­¤ï¼Œåœ¨å‡ºç° IO ç“¶é¢ˆçš„åœºæ™¯é‡Œï¼Œå°† sync_binlog è®¾ç½®æˆä¸€ä¸ªæ¯”è¾ƒå¤§çš„å€¼ï¼Œå¯ä»¥æå‡æ€§èƒ½ã€‚åœ¨å®é™…çš„ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œè€ƒè™‘åˆ°ä¸¢å¤±æ—¥å¿—é‡çš„å¯æ§æ€§ï¼Œä¸€èˆ¬ä¸å»ºè®®å°†è¿™ä¸ªå‚æ•°è®¾æˆ 0ï¼Œæ¯”è¾ƒå¸¸è§çš„æ˜¯å°†å…¶è®¾ç½®ä¸º 100~1000 ä¸­çš„æŸä¸ªæ•°å€¼ã€‚\nä½†æ˜¯ï¼Œå°† sync_binlog è®¾ç½®ä¸º Nï¼Œå¯¹åº”çš„é£é™©æ˜¯ï¼šå¦‚æœä¸»æœºå‘ç”Ÿå¼‚å¸¸é‡å¯ï¼Œä¼šä¸¢å¤±æœ€è¿‘ N ä¸ªäº‹åŠ¡çš„ binlog æ—¥å¿—ã€‚\nredo logçš„å†™å…¥æœºåˆ¶ redo log buffer åœ¨ä¸€ä¸ªäº‹åŠ¡çš„æ›´æ–°è¿‡ç¨‹ä¸­ï¼Œæ—¥å¿—æ˜¯è¦å†™å¤šæ¬¡çš„ã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸ªäº‹åŠ¡ï¼š\nbegin; insert into t1 ... insert into t2 ... commit; è¿™ä¸ªäº‹åŠ¡è¦å¾€ä¸¤ä¸ªè¡¨ä¸­æ’å…¥è®°å½•ï¼Œæ’å…¥æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼Œç”Ÿæˆçš„æ—¥å¿—éƒ½å¾—å…ˆä¿å­˜èµ·æ¥ï¼Œä½†åˆä¸èƒ½åœ¨è¿˜æ²¡ commit çš„æ—¶å€™å°±ç›´æ¥å†™åˆ° redo log æ–‡ä»¶é‡Œã€‚\næ‰€ä»¥ï¼Œredo log buffer å°±æ˜¯ä¸€å—å†…å­˜ï¼Œç”¨æ¥å…ˆå­˜ redo æ—¥å¿—çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ‰§è¡Œç¬¬ä¸€ä¸ª insert çš„æ—¶å€™ï¼Œæ•°æ®çš„å†…å­˜è¢«ä¿®æ”¹äº†ï¼Œredo log buffer ä¹Ÿå†™å…¥äº†æ—¥å¿—ã€‚\nä½†æ˜¯ï¼ŒçœŸæ­£æŠŠæ—¥å¿—å†™åˆ° redo log æ–‡ä»¶ï¼ˆæ–‡ä»¶åæ˜¯ ib_logfile+ æ•°å­—ï¼‰ï¼Œæ˜¯åœ¨æ‰§è¡Œ commit è¯­å¥çš„æ—¶å€™åšçš„ã€‚\nä½†redo log buffer é‡Œé¢çš„å†…å®¹ï¼Œä¸æ˜¯æ¯æ¬¡ç”Ÿæˆåéƒ½è¦ç›´æ¥æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚\nå¦‚æœäº‹åŠ¡æ‰§è¡ŒæœŸé—´ MySQL å‘ç”Ÿå¼‚å¸¸é‡å¯ï¼Œé‚£è¿™éƒ¨åˆ†æ—¥å¿—å°±ä¸¢äº†ã€‚ç”±äºäº‹åŠ¡å¹¶æ²¡æœ‰æäº¤ï¼Œæ‰€ä»¥è¿™æ—¶æ—¥å¿—ä¸¢äº†ä¹Ÿä¸ä¼šæœ‰æŸå¤±ã€‚\nredo logçš„ä¸‰ç§çŠ¶æ€  å­˜åœ¨ redo log buffer ä¸­ï¼Œç‰©ç†ä¸Šæ˜¯åœ¨ MySQL è¿›ç¨‹å†…å­˜ä¸­ï¼Œå°±æ˜¯å›¾ä¸­çš„çº¢è‰²éƒ¨åˆ†ï¼› å†™åˆ°ç£ç›˜ (write)ï¼Œä½†æ˜¯æ²¡æœ‰æŒä¹…åŒ–ï¼ˆfsyncï¼‰ï¼Œç‰©ç†ä¸Šæ˜¯åœ¨æ–‡ä»¶ç³»ç»Ÿçš„ page cache é‡Œé¢ï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­çš„é»„è‰²éƒ¨åˆ†ï¼› æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œå¯¹åº”çš„æ˜¯ hard diskï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­çš„ç»¿è‰²éƒ¨åˆ†ã€‚  æ—¥å¿—å†™åˆ° redo log buffer æ˜¯å¾ˆå¿«çš„ï¼Œwirte åˆ° page cache ä¹Ÿå·®ä¸å¤šï¼Œä½†æ˜¯æŒä¹…åŒ–åˆ°ç£ç›˜çš„é€Ÿåº¦å°±æ…¢å¤šäº†ã€‚\nredo log çš„å†™å…¥ç­–ç•¥ ä¸ºäº†æ§åˆ¶ redo log çš„å†™å…¥ç­–ç•¥ï¼ŒInnoDB æä¾›äº† innodb_flush_log_at_trx_commit å‚æ•°ï¼Œå®ƒæœ‰ä¸‰ç§å¯èƒ½å–å€¼ï¼š\n è®¾ç½®ä¸º 0 çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶éƒ½åªæ˜¯æŠŠ redo log ç•™åœ¨ redo log buffer ä¸­ ; è®¾ç½®ä¸º 1 çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶éƒ½å°† redo log ç›´æ¥æŒä¹…åŒ–åˆ°ç£ç›˜ï¼› è®¾ç½®ä¸º 2 çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶éƒ½åªæ˜¯æŠŠ redo log å†™åˆ° page cacheã€‚  redo logçš„å†™å…¥æ—¶æœº InnoDB æœ‰ä¸€ä¸ªåå°çº¿ç¨‹ï¼Œæ¯éš” 1 ç§’ï¼Œå°±ä¼šæŠŠ redo log buffer ä¸­çš„æ—¥å¿—ï¼Œè°ƒç”¨ write å†™åˆ°æ–‡ä»¶ç³»ç»Ÿçš„ page cacheï¼Œç„¶åè°ƒç”¨ fsync æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚\næ³¨æ„ï¼Œäº‹åŠ¡æ‰§è¡Œä¸­é—´è¿‡ç¨‹çš„ redo log ä¹Ÿæ˜¯ç›´æ¥å†™åœ¨ redo log buffer ä¸­çš„ï¼Œè¿™äº› redo log ä¹Ÿä¼šè¢«åå°çº¿ç¨‹ä¸€èµ·æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚\nä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªæ²¡æœ‰æäº¤çš„äº‹åŠ¡çš„ redo logï¼Œä¹Ÿæ˜¯å¯èƒ½å·²ç»æŒä¹…åŒ–åˆ°ç£ç›˜çš„ã€‚\nå®é™…ä¸Šï¼Œé™¤äº†åå°çº¿ç¨‹æ¯ç§’ä¸€æ¬¡çš„è½®è¯¢æ“ä½œå¤–ï¼Œè¿˜æœ‰ä¸¤ç§åœºæ™¯ä¼šè®©ä¸€ä¸ªæ²¡æœ‰æäº¤çš„äº‹åŠ¡çš„ redo log å†™å…¥åˆ°ç£ç›˜ä¸­ã€‚\n  ä¸€ç§æ˜¯ï¼Œredo log buffer å ç”¨çš„ç©ºé—´å³å°†è¾¾åˆ° innodb_log_buffer_size ä¸€åŠçš„æ—¶å€™ï¼Œåå°çº¿ç¨‹ä¼šä¸»åŠ¨å†™ç›˜ã€‚æ³¨æ„ï¼Œç”±äºè¿™ä¸ªäº‹åŠ¡å¹¶æ²¡æœ‰æäº¤ï¼Œæ‰€ä»¥è¿™ä¸ªå†™ç›˜åŠ¨ä½œåªæ˜¯ writeï¼Œè€Œæ²¡æœ‰è°ƒç”¨ fsyncï¼Œä¹Ÿå°±æ˜¯åªç•™åœ¨äº†æ–‡ä»¶ç³»ç»Ÿçš„ page cacheã€‚\n  å¦ä¸€ç§æ˜¯ï¼Œå¹¶è¡Œçš„äº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œé¡ºå¸¦å°†è¿™ä¸ªäº‹åŠ¡çš„ redo log buffer æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚å‡è®¾ä¸€ä¸ªäº‹åŠ¡ A æ‰§è¡Œåˆ°ä¸€åŠï¼Œå·²ç»å†™äº†ä¸€äº› redo log åˆ° buffer ä¸­ï¼Œè¿™æ—¶å€™æœ‰å¦å¤–ä¸€ä¸ªçº¿ç¨‹çš„äº‹åŠ¡ B æäº¤ï¼Œå¦‚æœ innodb_flush_log_at_trx_commit è®¾ç½®çš„æ˜¯ 1ï¼Œé‚£ä¹ˆæŒ‰ç…§è¿™ä¸ªå‚æ•°çš„é€»è¾‘ï¼Œäº‹åŠ¡ B è¦æŠŠ redo log buffer é‡Œçš„æ—¥å¿—å…¨éƒ¨æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚è¿™æ—¶å€™ï¼Œå°±ä¼šå¸¦ä¸Šäº‹åŠ¡ A åœ¨ redo log buffer é‡Œçš„æ—¥å¿—ä¸€èµ·æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚\n  åŒ1é…ç½® æŒ‡çš„å°±æ˜¯ sync_binlog å’Œ innodb_flush_log_at_trx_commit éƒ½è®¾ç½®æˆ 1ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªäº‹åŠ¡å®Œæ•´æäº¤å‰ï¼Œéœ€è¦ç­‰å¾…ä¸¤æ¬¡åˆ·ç›˜ï¼Œä¸€æ¬¡æ˜¯ redo logï¼ˆprepare é˜¶æ®µï¼‰ï¼Œä¸€æ¬¡æ˜¯ binlogã€‚\nä½†äº‹åŠ¡æäº¤æ—¶ä½¿ç”¨çš„æ˜¯ä¸¤é˜¶æ®µæäº¤ï¼Œredo logé™¤äº†prepareé˜¶æ®µå¤–è¿˜éœ€è¦commité˜¶æ®µï¼Œä¸ºä»€ä¹ˆè¿™é‡Œåªéœ€è¦åœ¨prepareé˜¶æ®µè¿›è¡Œä¸€æ¬¡fsyncå‘¢ã€‚\nå¦‚æœæŠŠ innodb_flush_log_at_trx_commit è®¾ç½®æˆ 1ï¼Œé‚£ä¹ˆ redo log åœ¨ prepare é˜¶æ®µå°±è¦æŒä¹…åŒ–ä¸€æ¬¡ï¼Œå› ä¸ºæœ‰ä¸€ä¸ªå´©æºƒæ¢å¤é€»è¾‘æ˜¯è¦ä¾èµ–äº prepare çš„ redo logï¼Œå†åŠ ä¸Š binlog æ¥æ¢å¤çš„ã€‚\næ¯ç§’ä¸€æ¬¡åå°è½®è¯¢åˆ·ç›˜ï¼Œå†åŠ ä¸Šå´©æºƒæ¢å¤è¿™ä¸ªé€»è¾‘ï¼ŒInnoDB å°±è®¤ä¸º redo log åœ¨ commit çš„æ—¶å€™å°±ä¸éœ€è¦ fsync äº†ï¼Œåªä¼š write åˆ°æ–‡ä»¶ç³»ç»Ÿçš„ page cache ä¸­å°±å¤Ÿäº†ã€‚\nç»„æäº¤ group commit LSN: æ—¥å¿—é€»è¾‘åºåˆ—å·ï¼ˆlog sequence numberï¼ŒLSNï¼‰ã€‚LSN æ˜¯å•è°ƒé€’å¢çš„ï¼Œç”¨æ¥å¯¹åº” redo log çš„ä¸€ä¸ªä¸ªå†™å…¥ç‚¹ã€‚æ¯æ¬¡å†™å…¥é•¿åº¦ä¸º length çš„ redo logï¼Œ LSN çš„å€¼å°±ä¼šåŠ ä¸Š lengthã€‚LSN ä¹Ÿä¼šå†™åˆ° InnoDB çš„æ•°æ®é¡µä¸­ï¼Œæ¥ç¡®ä¿æ•°æ®é¡µä¸ä¼šè¢«å¤šæ¬¡æ‰§è¡Œé‡å¤çš„ redo log.\nå¦‚å›¾æ‰€ç¤ºï¼Œæ˜¯ä¸‰ä¸ªå¹¶å‘äº‹åŠ¡ (trx1, trx2, trx3) åœ¨ prepare é˜¶æ®µï¼Œéƒ½å†™å®Œ redo log bufferï¼ŒæŒä¹…åŒ–åˆ°ç£ç›˜çš„è¿‡ç¨‹ï¼Œå¯¹åº”çš„ LSN åˆ†åˆ«æ˜¯ 50ã€120 å’Œ 160ã€‚\nä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œ trx1 æ˜¯ç¬¬ä¸€ä¸ªåˆ°è¾¾çš„ï¼Œä¼šè¢«é€‰ä¸ºè¿™ç»„çš„ leaderï¼›ç­‰ trx1 è¦å¼€å§‹å†™ç›˜çš„æ—¶å€™ï¼Œè¿™ä¸ªç»„é‡Œé¢å·²ç»æœ‰äº†ä¸‰ä¸ªäº‹åŠ¡ï¼Œè¿™æ—¶å€™ LSN ä¹Ÿå˜æˆäº† 160ï¼›trx1 å»å†™ç›˜çš„æ—¶å€™ï¼Œå¸¦çš„å°±æ˜¯ LSN=160ï¼Œå› æ­¤ç­‰ trx1 è¿”å›æ—¶ï¼Œæ‰€æœ‰ LSN å°äºç­‰äº 160 çš„ redo logï¼Œéƒ½å·²ç»è¢«æŒä¹…åŒ–åˆ°ç£ç›˜ï¼›è¿™æ—¶å€™ trx2 å’Œ trx3 å°±å¯ä»¥ç›´æ¥è¿”å›äº†ã€‚æ‰€ä»¥ï¼Œä¸€æ¬¡ç»„æäº¤é‡Œé¢ï¼Œç»„å‘˜è¶Šå¤šï¼ŒèŠ‚çº¦ç£ç›˜ IOPS çš„æ•ˆæœè¶Šå¥½ã€‚ä½†å¦‚æœåªæœ‰å•çº¿ç¨‹å‹æµ‹ï¼Œé‚£å°±åªèƒ½è€è€å®å®åœ°ä¸€ä¸ªäº‹åŠ¡å¯¹åº”ä¸€æ¬¡æŒä¹…åŒ–æ“ä½œäº†ã€‚\nLSN: æ—¥å¿—é€»è¾‘åºåˆ—å·ï¼ˆlog sequence numberï¼ŒLSNï¼‰ã€‚LSN æ˜¯å•è°ƒé€’å¢çš„ï¼Œç”¨æ¥å¯¹åº” redo log çš„ä¸€ä¸ªä¸ªå†™å…¥ç‚¹ã€‚æ¯æ¬¡å†™å…¥é•¿åº¦ä¸º length çš„ redo logï¼Œ LSN çš„å€¼å°±ä¼šåŠ ä¸Š lengthã€‚LSN ä¹Ÿä¼šå†™åˆ° InnoDB çš„æ•°æ®é¡µä¸­ï¼Œæ¥ç¡®ä¿æ•°æ®é¡µä¸ä¼šè¢«å¤šæ¬¡æ‰§è¡Œé‡å¤çš„ redo log.\nå¦‚å›¾æ‰€ç¤ºï¼Œæ˜¯ä¸‰ä¸ªå¹¶å‘äº‹åŠ¡ (trx1, trx2, trx3) åœ¨ prepare é˜¶æ®µï¼Œéƒ½å†™å®Œ redo log bufferï¼ŒæŒä¹…åŒ–åˆ°ç£ç›˜çš„è¿‡ç¨‹ï¼Œå¯¹åº”çš„ LSN åˆ†åˆ«æ˜¯ 50ã€120 å’Œ 160ã€‚\nä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œ\n trx1 æ˜¯ç¬¬ä¸€ä¸ªåˆ°è¾¾çš„ï¼Œä¼šè¢«é€‰ä¸ºè¿™ç»„çš„ leaderï¼› ç­‰ trx1 è¦å¼€å§‹å†™ç›˜çš„æ—¶å€™ï¼Œè¿™ä¸ªç»„é‡Œé¢å·²ç»æœ‰äº†ä¸‰ä¸ªäº‹åŠ¡ï¼Œè¿™æ—¶å€™ LSN ä¹Ÿå˜æˆäº† 160ï¼› trx1 å»å†™ç›˜çš„æ—¶å€™ï¼Œå¸¦çš„å°±æ˜¯ LSN=160ï¼Œå› æ­¤ç­‰ trx1 è¿”å›æ—¶ï¼Œæ‰€æœ‰ LSN å°äºç­‰äº 160 çš„ redo logï¼Œéƒ½å·²ç»è¢«æŒä¹…åŒ–åˆ°ç£ç›˜ï¼›è¿™æ—¶å€™ trx2 å’Œ trx3 å°±å¯ä»¥ç›´æ¥è¿”å›äº†ã€‚ æ‰€ä»¥ï¼Œä¸€æ¬¡ç»„æäº¤é‡Œé¢ï¼Œç»„å‘˜è¶Šå¤šï¼ŒèŠ‚çº¦ç£ç›˜ IOPS çš„æ•ˆæœè¶Šå¥½ã€‚  ä½†å¦‚æœåªæœ‰å•çº¿ç¨‹å‹æµ‹ï¼Œé‚£å°±åªèƒ½è€è€å®å®åœ°ä¸€ä¸ªäº‹åŠ¡å¯¹åº”ä¸€æ¬¡æŒä¹…åŒ–æ“ä½œäº†ã€‚\nå› æ­¤å¯èƒ½ä¼šå­˜åœ¨è¿™ç§ç°è±¡ï¼šä» MySQL çœ‹åˆ°çš„ TPS æ˜¯æ¯ç§’ä¸¤ä¸‡çš„è¯ï¼Œä¹Ÿå³æ¯ç§’ä¼šå†™å››ä¸‡æ¬¡ç£ç›˜ã€‚ä½†ç”¨å·¥å…·æµ‹è¯•å‡ºæ¥ï¼Œç£ç›˜èƒ½åŠ›ä¸¤ä¸‡å·¦å³ï¼Œæ€ä¹ˆèƒ½å®ç°ä¸¤ä¸‡çš„ TPSï¼Ÿäº†è§£äº†ç»„æäº¤åæˆ‘ä»¬å°±ä¼šçŸ¥é“ï¼Œè¿™æ˜¯ç”¨ç»„æäº¤å®Œæˆçš„ã€‚\nåœ¨å¹¶å‘æ›´æ–°åœºæ™¯ä¸‹ï¼Œç¬¬ä¸€ä¸ªäº‹åŠ¡å†™å®Œ redo log buffer ä»¥åï¼Œæ¥ä¸‹æ¥è¿™ä¸ª fsync è¶Šæ™šè°ƒç”¨ï¼Œç»„å‘˜å¯èƒ½è¶Šå¤šï¼ŒèŠ‚çº¦ IOPS çš„æ•ˆæœå°±è¶Šå¥½ã€‚\nMySQL å¯¹ç»„æäº¤çš„ä¼˜åŒ– å‰é¢æˆ‘ä»¬çŸ¥é“ï¼Œæ—¥å¿—æäº¤ä¸ºä¸¤é˜¶æ®µæäº¤ï¼Œâ‘ redo log prepare ----\u0026gt; â‘¡å†™binlog ----\u0026gt; â‘¢redo log commitã€‚ä½†å®é™…ä¸Šå†™bin logæ˜¯åˆ†ä¸ºä¸¤æ­¥çš„ï¼š\n å…ˆæŠŠ binlog ä» binlog cache ä¸­å†™åˆ°ç£ç›˜ä¸Šçš„ binlog æ–‡ä»¶ï¼› è°ƒç”¨ fsync æŒä¹…åŒ–ã€‚  MySQL ä¸ºäº†è®©ç»„æäº¤çš„æ•ˆæœæ›´å¥½ï¼ŒæŠŠ redo log åš fsync çš„æ—¶é—´æ‹–åˆ°äº†æ­¥éª¤ 1 ä¹‹åã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸¤é˜¶æ®µæäº¤å˜æˆäº†è¿™æ ·ï¼š è¿™ä¹ˆä¸€æ¥ï¼Œbinlog ä¹Ÿå¯ä»¥ç»„æäº¤äº†ã€‚åœ¨æ‰§è¡Œå›¾ä¸­ç¬¬ 4 æ­¥æŠŠ binlog fsync åˆ°ç£ç›˜æ—¶ï¼Œå¦‚æœæœ‰å¤šä¸ªäº‹åŠ¡çš„ binlog å·²ç»å†™å®Œäº†ï¼Œä¹Ÿæ˜¯ä¸€èµ·æŒä¹…åŒ–çš„ï¼Œè¿™æ ·ä¹Ÿå¯ä»¥å‡å°‘ IOPS çš„æ¶ˆè€—ã€‚\nä¸è¿‡é€šå¸¸æƒ…å†µä¸‹ç¬¬ 3 æ­¥æ‰§è¡Œå¾—ä¼šå¾ˆå¿«ï¼Œæ‰€ä»¥ binlog çš„ write å’Œ fsync é—´çš„é—´éš”æ—¶é—´çŸ­ï¼Œå¯¼è‡´èƒ½é›†åˆåˆ°ä¸€èµ·æŒä¹…åŒ–çš„ binlog æ¯”è¾ƒå°‘ï¼Œå› æ­¤ binlog çš„ç»„æäº¤çš„æ•ˆæœé€šå¸¸ä¸å¦‚ redo log çš„æ•ˆæœé‚£ä¹ˆå¥½ã€‚\nå¦‚æœä½ æƒ³æå‡ binlog ç»„æäº¤çš„æ•ˆæœï¼Œå¯ä»¥é€šè¿‡è®¾ç½® binlog_group_commit_sync_delay å’Œ binlog_group_commit_sync_no_delay_count æ¥å®ç°ã€‚binlog_group_commit_sync_delay å‚æ•°ï¼Œè¡¨ç¤ºå»¶è¿Ÿå¤šå°‘å¾®ç§’åæ‰è°ƒç”¨ fsync;binlog_group_commit_sync_no_delay_count å‚æ•°ï¼Œè¡¨ç¤ºç´¯ç§¯å¤šå°‘æ¬¡ä»¥åæ‰è°ƒç”¨ fsyncã€‚\nè¿™ä¸¤ä¸ªæ¡ä»¶æ˜¯æˆ–çš„å…³ç³»ï¼Œä¹Ÿå°±æ˜¯è¯´åªè¦æœ‰ä¸€ä¸ªæ»¡è¶³æ¡ä»¶å°±ä¼šè°ƒç”¨ fsyncã€‚æ‰€ä»¥ï¼Œå½“ binlog_group_commit_sync_delay è®¾ç½®ä¸º 0 çš„æ—¶å€™ï¼Œbinlog_group_commit_sync_no_delay_count ä¹Ÿæ— æ•ˆäº†ã€‚\nåˆ†æåˆ°è¿™é‡Œå¯ä»¥å¾—çŸ¥ï¼ŒWALæœºåˆ¶çš„å¿«é€Ÿä¸»è¦å¾—ç›Šäºä¸¤æ–¹é¢ï¼š\n redo log å’Œ binlog éƒ½æ˜¯é¡ºåºå†™ï¼Œç£ç›˜çš„é¡ºåºå†™æ¯”éšæœºå†™é€Ÿåº¦è¦å¿«ï¼› ç»„æäº¤æœºåˆ¶ï¼Œå¯ä»¥å¤§å¹…åº¦é™ä½ç£ç›˜çš„ IOPS æ¶ˆè€—ã€‚  ","permalink":"http://yangchnet.github.io/Dessert/posts/%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%A6%82%E8%A7%88mysql%E7%AF%87%E4%BA%8C%E6%8C%81%E4%B9%85%E5%8C%96/","summary":"æå®¢æ—¶é—´ã€ŠMySQLå®æˆ˜45è®²ã€‹ç¬”è®°\n ä»€ä¹ˆæ˜¯change bufferï¼Œæœ‰ä»€ä¹ˆä½œç”¨ å½“éœ€è¦æ›´æ–°ä¸€ä¸ªæ•°æ®é¡µæ—¶ï¼Œå¦‚æœæ•°æ®é¡µåœ¨å†…å­˜ä¸­å°±ç›´æ¥æ›´æ–°ï¼Œè€Œå¦‚æœè¿™ä¸ªæ•°æ®é¡µè¿˜æ²¡æœ‰åœ¨å†…å­˜ä¸­çš„è¯ï¼Œåœ¨ä¸å½±å“æ•°æ®ä¸€è‡´æ€§çš„å‰æä¸‹ï¼ŒInnoDB ä¼šå°†è¿™äº›æ›´æ–°æ“ä½œç¼“å­˜åœ¨ change buffer ä¸­ï¼Œè¿™æ ·å°±ä¸éœ€è¦ä»ç£ç›˜ä¸­è¯»å…¥è¿™ä¸ªæ•°æ®é¡µäº†ã€‚åœ¨ä¸‹æ¬¡æŸ¥è¯¢éœ€è¦è®¿é—®è¿™ä¸ªæ•°æ®é¡µçš„æ—¶å€™ï¼Œå°†æ•°æ®é¡µè¯»å…¥å†…å­˜ï¼Œç„¶åæ‰§è¡Œ change buffer ä¸­ä¸è¿™ä¸ªé¡µæœ‰å…³çš„æ“ä½œã€‚é€šè¿‡è¿™ç§æ–¹å¼å°±èƒ½ä¿è¯è¿™ä¸ªæ•°æ®é€»è¾‘çš„æ­£ç¡®æ€§ã€‚è¿™ä¸ªæ“ä½œç§°ä¸ºmerge.\nè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œchange bufferçœ‹èµ·æ¥åƒæ˜¯å†…å­˜ç¼“å­˜ä¸€ç±»çš„ä¸œè¥¿ï¼Œä½†æ˜¯change bufferæ˜¯å¯ä»¥æŒä¹…åŒ–çš„æ•°æ®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œchange bufferåœ¨å†…å­˜ä¸­æœ‰æ‹·è´ï¼Œä¹Ÿä¼šè¢«å†™å…¥åˆ°ç£ç›˜ä¸Šã€‚\nå¦‚æœå°†change bufferä¹Ÿå­˜åœ¨ç£ç›˜ä¸Šï¼Œè€Œæ•°æ®ä¹Ÿæ˜¯å­˜å‚¨åœ¨ç£ç›˜ä¸Šï¼Œé‚£ä¹ˆchange bufferç›¸æ¯”ç›´æ¥è¯»å–ç£ç›˜æ•°æ®å¿«åœ¨å“ªé‡Œå‘¢ï¼Ÿ\nä»ç£ç›˜è¯»å–ä¸€æ¡è®°å½•ï¼Œæ˜¯éšæœºè¯»å†™ï¼Œè€Œå†™change bufferï¼Œæ˜¯é¡ºåºè¯»å†™ã€‚è¿™äºŒè€…çš„é€Ÿåº¦å­˜åœ¨è¾ƒå¤§å·®å¼‚ã€‚éšæœºè¯»å†™ç”±äºå­˜åœ¨ç£å¤´ç§»é“ç­‰ç‰©ç†æ“ä½œï¼Œå› æ­¤æ¯”è¾ƒæ…¢ï¼Œä½†é¡ºåºè¯»å†™æ¯”è¾ƒå¿«é€Ÿã€‚\nchange bufferçš„é™åˆ¶ change bufferåªæ˜¯æš‚æ—¶çš„å°†æ›´æ–°æ“ä½œä¿å­˜ä¸‹æ¥ï¼Œè€Œå¹¶æ²¡æœ‰å»è¯»å–çœŸæ­£çš„æ•°æ®ã€‚è€ƒè™‘ä»¥ä¸‹æƒ…å†µï¼Œè¡¨ä¸­è¦æ±‚æŸä¸€å­—æ®µä¸ºå”¯ä¸€çš„ï¼Œè€Œåœ¨æ›´æ–°æ—¶ä¸å°å¿ƒæ’å…¥äº†ä¸€ä¸ªä¸åŸæœ‰æŸæ•°æ®é‡å¤çš„æ¡ç›®ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸è¢«å…è®¸çš„ã€‚\nå› æ­¤ï¼Œå½“è¡¨ä¸­å­˜åœ¨å”¯ä¸€ç´¢å¼•ã€å”¯ä¸€å€¼ç­‰é™åˆ¶ï¼Œè¿™æ—¶å€™å°±ä¸èƒ½ç”¨change bufferäº†ã€‚åªæœ‰æ™®é€šç´¢å¼•å’Œä¸å­˜åœ¨å€¼å”¯ä¸€æ€§çº¦æŸçš„åˆ—ï¼Œæ‰å¯ä»¥ç”¨change bufferã€‚\nchange bufferç”¨çš„æ˜¯buffer poolä¸­çš„å†…å­˜ï¼Œå› æ­¤ä¸èƒ½æ— é™å¢å¤§ã€‚change buffer çš„å¤§å°ï¼Œå¯ä»¥é€šè¿‡å‚æ•° innodb_change_buffer_max_size æ¥åŠ¨æ€è®¾ç½®ã€‚è¿™ä¸ªå‚æ•°è®¾ç½®ä¸º 50 çš„æ—¶å€™ï¼Œè¡¨ç¤º change buffer çš„å¤§å°æœ€å¤šåªèƒ½å ç”¨ buffer pool çš„ 50%ã€‚\nchange bufferçš„ä½¿ç”¨åœºæ™¯ merge çš„æ—¶å€™æ˜¯çœŸæ­£è¿›è¡Œæ•°æ®æ›´æ–°çš„æ—¶åˆ»ï¼Œè€Œ change buffer çš„ä¸»è¦ç›®çš„å°±æ˜¯å°†è®°å½•çš„å˜æ›´åŠ¨ä½œç¼“å­˜ä¸‹æ¥ï¼Œæ‰€ä»¥åœ¨ä¸€ä¸ªæ•°æ®é¡µåš merge ä¹‹å‰ï¼Œchange buffer è®°å½•çš„å˜æ›´è¶Šå¤šï¼ˆä¹Ÿå°±æ˜¯è¿™ä¸ªé¡µé¢ä¸Šè¦æ›´æ–°çš„æ¬¡æ•°è¶Šå¤šï¼‰ï¼Œæ”¶ç›Šå°±è¶Šå¤§ã€‚\nå› æ­¤ï¼Œå¯¹äºå†™å¤šè¯»å°‘çš„ä¸šåŠ¡æ¥è¯´ï¼Œé¡µé¢åœ¨å†™å®Œä»¥åé©¬ä¸Šè¢«è®¿é—®åˆ°çš„æ¦‚ç‡æ¯”è¾ƒå°ï¼Œæ­¤æ—¶ change buffer çš„ä½¿ç”¨æ•ˆæœæœ€å¥½ã€‚è¿™ç§ä¸šåŠ¡æ¨¡å‹å¸¸è§çš„å°±æ˜¯è´¦å•ç±»ã€æ—¥å¿—ç±»çš„ç³»ç»Ÿã€‚\nåè¿‡æ¥ï¼Œå‡è®¾ä¸€ä¸ªä¸šåŠ¡çš„æ›´æ–°æ¨¡å¼æ˜¯å†™å…¥ä¹‹åé©¬ä¸Šä¼šåšæŸ¥è¯¢ï¼Œé‚£ä¹ˆå³ä½¿æ»¡è¶³äº†æ¡ä»¶ï¼Œå°†æ›´æ–°å…ˆè®°å½•åœ¨ change bufferï¼Œä½†ä¹‹åç”±äºé©¬ä¸Šè¦è®¿é—®è¿™ä¸ªæ•°æ®é¡µï¼Œä¼šç«‹å³è§¦å‘ merge è¿‡ç¨‹ã€‚è¿™æ ·éšæœºè®¿é—® IO çš„æ¬¡æ•°ä¸ä¼šå‡å°‘ï¼Œåè€Œå¢åŠ äº† change buffer çš„ç»´æŠ¤ä»£ä»·ã€‚æ‰€ä»¥ï¼Œå¯¹äºè¿™ç§ä¸šåŠ¡æ¨¡å¼æ¥è¯´ï¼Œchange buffer åè€Œèµ·åˆ°äº†å‰¯ä½œç”¨ã€‚","title":"æ¦‚è§ˆMySQLç¯‡äºŒï¼šæŒä¹…åŒ–"},{"content":" æå®¢æ—¶é—´ã€ŠMySQLå®æˆ˜45è®²ã€‹ç¬”è®°\n ä¸»å¤‡çš„åŸºæœ¬åŸç† åœ¨çŠ¶æ€ 1 ä¸­ï¼Œå®¢æˆ·ç«¯çš„è¯»å†™éƒ½ç›´æ¥è®¿é—®èŠ‚ç‚¹ Aï¼Œè€ŒèŠ‚ç‚¹ B æ˜¯ A çš„å¤‡åº“ï¼Œåªæ˜¯å°† A çš„æ›´æ–°éƒ½åŒæ­¥è¿‡æ¥ï¼Œåˆ°æœ¬åœ°æ‰§è¡Œã€‚è¿™æ ·å¯ä»¥ä¿æŒèŠ‚ç‚¹ B å’Œ A çš„æ•°æ®æ˜¯ç›¸åŒçš„ã€‚\nå½“éœ€è¦åˆ‡æ¢çš„æ—¶å€™ï¼Œå°±åˆ‡æˆçŠ¶æ€ 2ã€‚è¿™æ—¶å€™å®¢æˆ·ç«¯è¯»å†™è®¿é—®çš„éƒ½æ˜¯èŠ‚ç‚¹ Bï¼Œè€ŒèŠ‚ç‚¹ A æ˜¯ B çš„å¤‡åº“ã€‚\né‚£ä¹ˆä»çŠ¶æ€1åˆ‡æ¢åˆ°çŠ¶æ€2çš„å†…éƒ¨æµç¨‹æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ\nå¤‡åº“ B è·Ÿä¸»åº“ A ä¹‹é—´ç»´æŒäº†ä¸€ä¸ªé•¿è¿æ¥ã€‚ä¸»åº“ A å†…éƒ¨æœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œä¸“é—¨ç”¨äºæœåŠ¡å¤‡åº“ B çš„è¿™ä¸ªé•¿è¿æ¥ã€‚ä¸€ä¸ªäº‹åŠ¡æ—¥å¿—åŒæ­¥çš„å®Œæ•´è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š\n åœ¨å¤‡åº“ B ä¸Šé€šè¿‡ change master å‘½ä»¤ï¼Œè®¾ç½®ä¸»åº“ A çš„ IPã€ç«¯å£ã€ç”¨æˆ·åã€å¯†ç ï¼Œä»¥åŠè¦ä»å“ªä¸ªä½ç½®å¼€å§‹è¯·æ±‚ binlogï¼Œè¿™ä¸ªä½ç½®åŒ…å«æ–‡ä»¶åå’Œæ—¥å¿—åç§»é‡ã€‚ åœ¨å¤‡åº“ B ä¸Šæ‰§è¡Œ start slave å‘½ä»¤ï¼Œè¿™æ—¶å€™å¤‡åº“ä¼šå¯åŠ¨ä¸¤ä¸ªçº¿ç¨‹ï¼Œå°±æ˜¯å›¾ä¸­çš„ io_thread å’Œ sql_threadã€‚å…¶ä¸­ io_thread è´Ÿè´£ä¸ä¸»åº“å»ºç«‹è¿æ¥ã€‚ ä¸»åº“ A æ ¡éªŒå®Œç”¨æˆ·åã€å¯†ç åï¼Œå¼€å§‹æŒ‰ç…§å¤‡åº“ B ä¼ è¿‡æ¥çš„ä½ç½®ï¼Œä»æœ¬åœ°è¯»å– binlogï¼Œå‘ç»™ Bã€‚ å¤‡åº“ B æ‹¿åˆ° binlog åï¼Œå†™åˆ°æœ¬åœ°æ–‡ä»¶ï¼Œç§°ä¸ºä¸­è½¬æ—¥å¿—ï¼ˆrelay logï¼‰ã€‚ sql_thread è¯»å–ä¸­è½¬æ—¥å¿—ï¼Œè§£æå‡ºæ—¥å¿—é‡Œçš„å‘½ä»¤ï¼Œå¹¶æ‰§è¡Œã€‚  binlog çš„ä¸‰ç§æ ¼å¼å¯¹æ¯” ä¸»å¤‡å¤åˆ¶ä¾èµ–äºbin logï¼Œé‚£ä¹ˆbin logä¸­æ˜¯ä»€ä¹ˆå†…å®¹ã€‚\nbin logçš„ä¸‰ç§æ ¼å¼ï¼š\n statement row mixed  å¯¹äºä¸‹è¡¨ï¼š\nmysql\u0026gt; CREATE TABLE `t` ( `id` int(11) NOT NULL, `a` int(11) DEFAULT NULL, `t_modified` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP, PRIMARY KEY (`id`), KEY `a` (`a`), KEY `t_modified`(`t_modified`) ) ENGINE=InnoDB; insert into t values(1,1,\u0026#39;2018-11-13\u0026#39;); insert into t values(2,2,\u0026#39;2018-11-12\u0026#39;); insert into t values(3,3,\u0026#39;2018-11-11\u0026#39;); insert into t values(4,4,\u0026#39;2018-11-10\u0026#39;); insert into t values(5,5,\u0026#39;2018-11-09\u0026#39;); å¦‚æœè¦åœ¨è¡¨ä¸­åˆ é™¤ä¸€è¡Œæ•°æ®çš„è¯ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ª delete è¯­å¥çš„ binlog æ˜¯æ€ä¹ˆè®°å½•çš„ï¼š\nmysql\u0026gt; delete from t /*comment*/ where a\u0026gt;=4 and t_modified\u0026lt;=\u0026#39;2018-11-10\u0026#39; limit 1; å½“binlog_format=statementæ—¶ï¼Œbinlog é‡Œé¢è®°å½•çš„å°±æ˜¯ SQL è¯­å¥çš„åŸæ–‡\nmysql\u0026gt; show binlog events in \u0026#39;binlog.000002\u0026#39;; +---------------+-----+----------------+-----------+-------------+------------------------------------------------------------------------------------------+ | Log_name | Pos | Event_type | Server_id | End_log_pos | Info | +---------------+-----+----------------+-----------+-------------+------------------------------------------------------------------------------------------+ | binlog.000002 | 4 | Format_desc | 1 | 126 | Server ver: 8.0.28, Binlog ver: 4 | | binlog.000002 | 126 | Previous_gtids | 1 | 157 | | | binlog.000002 | 157 | Anonymous_Gtid | 1 | 236 | SET @@SESSION.GTID_NEXT= \u0026#39;ANONYMOUS\u0026#39; | | binlog.000002 | 236 | Query | 1 | 332 | BEGIN | | binlog.000002 | 332 | Query | 1 | 496 | use `test_db`; delete from t /*comment*/ where a\u0026gt;=4 and t_modified\u0026lt;=\u0026#39;2018-11-10\u0026#39; limit 1 | | binlog.000002 | 496 | Xid | 1 | 527 | COMMIT /* xid=12 */ | +---------------+-----+----------------+-----------+-------------+------------------------------------------------------------------------------------------+  å½“ä½¿ç”¨steaementæ ¼å¼æ—¥å¿—æ—¶ï¼Œå¯èƒ½ä¼šå­˜åœ¨ä¸»å¤‡æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µï¼Œä¾‹å¦‚ï¼š\n å¦‚æœ delete è¯­å¥ä½¿ç”¨çš„æ˜¯ç´¢å¼• aï¼Œé‚£ä¹ˆä¼šæ ¹æ®ç´¢å¼• a æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´åˆ é™¤çš„æ˜¯ a=4 è¿™ä¸€è¡Œï¼› ä½†å¦‚æœä½¿ç”¨çš„æ˜¯ç´¢å¼• t_modifiedï¼Œé‚£ä¹ˆåˆ é™¤çš„å°±æ˜¯ t_modified=\u0026lsquo;2018-11-09â€™ä¹Ÿå°±æ˜¯ a=5 è¿™ä¸€è¡Œã€‚  ç”±äº statement æ ¼å¼ä¸‹ï¼Œè®°å½•åˆ° binlog é‡Œçš„æ˜¯è¯­å¥åŸæ–‡ï¼Œå› æ­¤å¯èƒ½ä¼šå‡ºç°è¿™æ ·ä¸€ç§æƒ…å†µï¼šåœ¨ä¸»åº“æ‰§è¡Œè¿™æ¡ SQL è¯­å¥çš„æ—¶å€™ï¼Œç”¨çš„æ˜¯ç´¢å¼• aï¼›è€Œåœ¨å¤‡åº“æ‰§è¡Œè¿™æ¡ SQL è¯­å¥çš„æ—¶å€™ï¼Œå´ä½¿ç”¨äº†ç´¢å¼• t_modifiedã€‚å› æ­¤ï¼ŒMySQL è®¤ä¸ºè¿™æ ·å†™æ˜¯æœ‰é£é™©çš„ã€‚\nå½“binlog_format=â€˜rowâ€™æ—¶ï¼š\nmysql\u0026gt; show binlog events in \u0026#39;binlog.000002\u0026#39;; +---------------+-----+----------------+-----------+-------------+--------------------------------------+ | Log_name | Pos | Event_type | Server_id | End_log_pos | Info | +---------------+-----+----------------+-----------+-------------+--------------------------------------+ | binlog.000002 | 4 | Format_desc | 1 | 126 | Server ver: 8.0.28, Binlog ver: 4 | | binlog.000002 | 126 | Previous_gtids | 1 | 157 | | | binlog.000002 | 157 | Anonymous_Gtid | 1 | 236 | SET @@SESSION.GTID_NEXT= \u0026#39;ANONYMOUS\u0026#39; | | binlog.000002 | 236 | Query | 1 | 322 | BEGIN | | binlog.000002 | 322 | Table_map | 1 | 375 | table_id: 88 (test_db.t) | | binlog.000002 | 375 | Delete_rows | 1 | 423 | table_id: 88 flags: STMT_END_F | | binlog.000002 | 423 | Xid | 1 | 454 | COMMIT /* xid=8 */ | +---------------+-----+----------------+-----------+-------------+--------------------------------------+ ä¸ statement æ ¼å¼çš„ binlog ç›¸æ¯”ï¼Œå‰åçš„ BEGIN å’Œ COMMIT æ˜¯ä¸€æ ·çš„ã€‚ä½†æ˜¯ï¼Œrow æ ¼å¼çš„ binlog é‡Œæ²¡æœ‰äº† SQL è¯­å¥çš„åŸæ–‡ï¼Œè€Œæ˜¯æ›¿æ¢æˆäº†ä¸¤ä¸ª eventï¼šTable_map å’Œ Delete_rowsã€‚\n Table_map eventï¼Œç”¨äºè¯´æ˜æ¥ä¸‹æ¥è¦æ“ä½œçš„è¡¨æ˜¯ test åº“çš„è¡¨ t; Delete_rows eventï¼Œç”¨äºå®šä¹‰åˆ é™¤çš„è¡Œä¸ºã€‚  ä½†è¿™é‡Œæˆ‘ä»¬çœ‹ä¸åˆ°è¯¦ç»†ä¿¡æ¯ï¼Œéœ€è¦å€ŸåŠ©mysqlbinlogå·¥å…·ã€‚ç”¨ä¸‹é¢è¿™ä¸ªå‘½ä»¤è§£æå’ŒæŸ¥çœ‹ binlog ä¸­çš„å†…å®¹ã€‚\nmysqlbinlog -vv data/master.000001 --start-position=8900; # The proper term is pseudo_replica_mode, but we use this compatibility alias # to make the statement usable on server versions 8.0.24 and older. /*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=1*/; /*!50003 SET @OLD_COMPLETION_TYPE=@@COMPLETION_TYPE,COMPLETION_TYPE=0*/; DELIMITER /*!*/; # at 126 #220615 6:51:35 server id 1 end_log_pos 126 CRC32 0xc895f13c Start: binlog v 4, server v 8.0.28 created 220615 6:51:35 at startup # Warning: this binlog is either in use or was not closed properly. ROLLBACK/*!*/; BINLOG ' d4GpYg8BAAAAegAAAH4AAAABAAQAOC4wLjI4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA AAAAAAAAAAAAAAAAAAB3galiEwANAAgAAAAABAAEAAAAYgAEGggAAAAICAgCAAAACgoKKioAEjQA CigAATzxlcg= '/*!*/; # at 157 #220615 6:52:14 server id 1 end_log_pos 236 CRC32 0x245f18b1 Anonymous_GTID last_committed=0 sequence_number=1 rbr_only=yes original_committed_timestamp=1655275934841953immediate_commit_timestamp=1655275934841953 transaction_length=297 /*!50718 SET TRANSACTION ISOLATION LEVEL READ COMMITTED*//*!*/; # original_commit_timestamp=1655275934841953 (2022-06-15 06:52:14.841953 UTC) # immediate_commit_timestamp=1655275934841953 (2022-06-15 06:52:14.841953 UTC) /*!80001 SET @@session.original_commit_timestamp=1655275934841953*//*!*/; /*!80014 SET @@session.original_server_version=80028*//*!*/; /*!80014 SET @@session.immediate_server_version=80028*//*!*/; SET @@SESSION.GTID_NEXT= 'ANONYMOUS'/*!*/; # at 236 #220615 6:52:14 server id 1 end_log_pos 322 CRC32 0xfa351183 Query thread_id=8 exec_time=0 error_code=0 SET TIMESTAMP=1655275934/*!*/; SET @@session.pseudo_thread_id=8/*!*/; SET @@session.foreign_key_checks=1, @@session.sql_auto_is_null=0, @@session.unique_checks=1, @@session.autocommit=1/*!*/; SET @@session.sql_mode=1168113696/*!*/; SET @@session.auto_increment_increment=1, @@session.auto_increment_offset=1/*!*/; /*!\\C latin1 *//*!*/; SET @@session.character_set_client=8,@@session.collation_connection=8,@@session.collation_server=255/*!*/; SET @@session.time_zone='SYSTEM'/*!*/; SET @@session.lc_time_names=0/*!*/; SET @@session.collation_database=DEFAULT/*!*/; /*!80011 SET @@session.default_collation_for_utf8mb4=255*//*!*/; BEGIN /*!*/; # at 322 #220615 6:52:14 server id 1 end_log_pos 375 CRC32 0xe571a47d Table_map: `test_db`.`t` mapped to number 88 # at 375 #220615 6:52:14 server id 1 end_log_pos 423 CRC32 0xafba99da Delete_rows: table id 88 flags: STMT_END_F BINLOG ' noGpYhMBAAAANQAAAHcBAAAAAFgAAAAAAAEAB3Rlc3RfZGIAAXQAAwMDEQEAAgEBAH2kceU= noGpYiABAAAAMAAAAKcBAAAAAFgAAAAAAAEAAgAD/wAEAAAABAAAAFvmH4Dambqv '/*!*/; ### DELETE FROM `test_db`.`t` ### WHERE ### @1=4 /* INT meta=0 nullable=0 is_null=0 */ ### @2=4 /* INT meta=0 nullable=1 is_null=0 */ ### @3=1541808000 /* TIMESTAMP(0) meta=0 nullable=0 is_null=0 */ # at 423 #220615 6:52:14 server id 1 end_log_pos 454 CRC32 0x7e73732f Xid = 8 COMMIT/*!*/; SET @@SESSION.GTID_NEXT= 'AUTOMATIC' /* added by mysqlbinlog */ /*!*/; DELIMITER ; # End of log file /*!50003 SET COMPLETION_TYPE=@OLD_COMPLETION_TYPE*/; /*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=0*/; ä»ä¸Šæ–‡æ—¥å¿—ä¸­å¯ä»¥çœ‹å‡ºï¼š\n server id 1ï¼Œè¡¨ç¤ºè¿™ä¸ªäº‹åŠ¡æ˜¯åœ¨ server_id=1 çš„è¿™ä¸ªåº“ä¸Šæ‰§è¡Œçš„ã€‚ æ¯ä¸ª event éƒ½æœ‰ CRC32 çš„å€¼ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘æŠŠå‚æ•° binlog_checksum è®¾ç½®æˆäº† CRC32ã€‚ Table_map event è·Ÿåœ¨statementç±»å‹æ—¥å¿—ä¸­çœ‹åˆ°çš„ç›¸åŒï¼Œæ˜¾ç¤ºäº†æ¥ä¸‹æ¥è¦æ‰“å¼€çš„è¡¨ï¼Œmap åˆ°æ•°å­— 226ã€‚ç°åœ¨æˆ‘ä»¬è¿™æ¡ SQL è¯­å¥åªæ“ä½œäº†ä¸€å¼ è¡¨ï¼Œå¦‚æœè¦æ“ä½œå¤šå¼ è¡¨å‘¢ï¼Ÿæ¯ä¸ªè¡¨éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„ Table_map eventã€éƒ½ä¼š map åˆ°ä¸€ä¸ªå•ç‹¬çš„æ•°å­—ï¼Œç”¨äºåŒºåˆ†å¯¹ä¸åŒè¡¨çš„æ“ä½œã€‚ åœ¨ mysqlbinlog çš„å‘½ä»¤ä¸­ï¼Œä½¿ç”¨äº† -vv å‚æ•°æ˜¯ä¸ºäº†æŠŠå†…å®¹éƒ½è§£æå‡ºæ¥ï¼Œæ‰€ä»¥ä»ç»“æœé‡Œé¢å¯ä»¥çœ‹åˆ°å„ä¸ªå­—æ®µçš„å€¼ï¼ˆæ¯”å¦‚ï¼Œ@1=4ã€ @2=4 è¿™äº›å€¼ï¼‰ã€‚ binlog_row_image çš„é»˜è®¤é…ç½®æ˜¯ FULLï¼Œå› æ­¤ Delete_event é‡Œé¢ï¼ŒåŒ…å«äº†åˆ æ‰çš„è¡Œçš„æ‰€æœ‰å­—æ®µçš„å€¼ã€‚å¦‚æœæŠŠ binlog_row_image è®¾ç½®ä¸º MINIMALï¼Œåˆ™åªä¼šè®°å½•å¿…è¦çš„ä¿¡æ¯ï¼Œåœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œå°±æ˜¯åªä¼šè®°å½• id=4 è¿™ä¸ªä¿¡æ¯ã€‚ æœ€åçš„ Xid eventï¼Œç”¨äºè¡¨ç¤ºäº‹åŠ¡è¢«æ­£ç¡®åœ°æäº¤äº†ã€‚  å½“ binlog_format ä½¿ç”¨ row æ ¼å¼çš„æ—¶å€™ï¼Œbinlog é‡Œé¢è®°å½•äº†çœŸå®åˆ é™¤è¡Œçš„ä¸»é”® idï¼Œè¿™æ · binlog ä¼ åˆ°å¤‡åº“å»çš„æ—¶å€™ï¼Œå°±è‚¯å®šä¼šåˆ é™¤ id=4 çš„è¡Œï¼Œä¸ä¼šæœ‰ä¸»å¤‡åˆ é™¤ä¸åŒè¡Œçš„é—®é¢˜ã€‚\nä¸ºä»€ä¹ˆä¼šæœ‰ mixed æ ¼å¼çš„ binlogï¼Ÿ  å› ä¸ºæœ‰äº› statement æ ¼å¼çš„ binlog å¯èƒ½ä¼šå¯¼è‡´ä¸»å¤‡ä¸ä¸€è‡´ï¼Œæ‰€ä»¥è¦ä½¿ç”¨ row æ ¼å¼ã€‚ ä½† row æ ¼å¼çš„ç¼ºç‚¹æ˜¯ï¼Œå¾ˆå ç©ºé—´ã€‚æ¯”å¦‚ä½ ç”¨ä¸€ä¸ª delete è¯­å¥åˆ æ‰ 10 ä¸‡è¡Œæ•°æ®ï¼Œç”¨ statement çš„è¯å°±æ˜¯ä¸€ä¸ª SQL è¯­å¥è¢«è®°å½•åˆ° binlog ä¸­ï¼Œå ç”¨å‡ åä¸ªå­—èŠ‚çš„ç©ºé—´ã€‚ä½†å¦‚æœç”¨ row æ ¼å¼çš„ binlogï¼Œå°±è¦æŠŠè¿™ 10 ä¸‡æ¡è®°å½•éƒ½å†™åˆ° binlog ä¸­ã€‚è¿™æ ·åšï¼Œä¸ä»…ä¼šå ç”¨æ›´å¤§çš„ç©ºé—´ï¼ŒåŒæ—¶å†™ binlog ä¹Ÿè¦è€—è´¹ IO èµ„æºï¼Œå½±å“æ‰§è¡Œé€Ÿåº¦ã€‚ æ‰€ä»¥ï¼ŒMySQL å°±å–äº†ä¸ªæŠ˜ä¸­æ–¹æ¡ˆï¼Œä¹Ÿå°±æ˜¯æœ‰äº† mixed æ ¼å¼çš„ binlogã€‚mixed æ ¼å¼çš„æ„æ€æ˜¯ï¼ŒMySQL è‡ªå·±ä¼šåˆ¤æ–­è¿™æ¡ SQL è¯­å¥æ˜¯å¦å¯èƒ½å¼•èµ·ä¸»å¤‡ä¸ä¸€è‡´ï¼Œå¦‚æœæœ‰å¯èƒ½ï¼Œå°±ç”¨ row æ ¼å¼ï¼Œå¦åˆ™å°±ç”¨ statement æ ¼å¼ã€‚  ä¹Ÿå°±æ˜¯è¯´ï¼Œmixed æ ¼å¼å¯ä»¥åˆ©ç”¨ statment æ ¼å¼çš„ä¼˜ç‚¹ï¼ŒåŒæ—¶åˆé¿å…äº†æ•°æ®ä¸ä¸€è‡´çš„é£é™©ã€‚\nå› æ­¤ï¼Œå¦‚æœä½ çš„çº¿ä¸Š MySQL è®¾ç½®çš„ binlog æ ¼å¼æ˜¯ statement çš„è¯ï¼Œé‚£åŸºæœ¬ä¸Šå°±å¯ä»¥è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªä¸åˆç†çš„è®¾ç½®ã€‚ä½ è‡³å°‘åº”è¯¥æŠŠ binlog çš„æ ¼å¼è®¾ç½®ä¸º mixedã€‚\nä½†ç°åœ¨è¶Šæ¥è¶Šå¤šçš„åœºæ™¯è¦æ±‚æŠŠ MySQL çš„ binlog æ ¼å¼è®¾ç½®æˆ rowã€‚è¿™ä¹ˆåšçš„ç†ç”±æœ‰å¾ˆå¤šï¼Œä¸€ä¸ªæœ€ç›´æ¥çš„å¥½å¤„ï¼šæ¢å¤æ•°æ®ã€‚\n  ä»rowæ ¼å¼çš„æ—¥å¿—å¯ä»¥çœ‹å‡ºï¼Œbinlogä¼šæŠŠåˆ æ‰çš„æ•´è¡Œä¿¡æ¯éƒ½ä¿å­˜ä¸‹æ¥ï¼Œæ‰€ä»¥ï¼Œå¦‚æœä½ åœ¨æ‰§è¡Œå®Œä¸€æ¡ delete è¯­å¥ä»¥åï¼Œå‘ç°åˆ é”™æ•°æ®äº†ï¼Œå¯ä»¥ç›´æ¥æŠŠ binlog ä¸­è®°å½•çš„ delete è¯­å¥è½¬æˆ insertï¼ŒæŠŠè¢«é”™åˆ çš„æ•°æ®æ’å…¥å›å»å°±å¯ä»¥æ¢å¤äº†ã€‚\n  å¦‚æœä½ æ˜¯æ‰§è¡Œé”™äº† insert è¯­å¥å‘¢ï¼Ÿé‚£å°±æ›´ç›´æ¥äº†ã€‚row æ ¼å¼ä¸‹ï¼Œinsert è¯­å¥çš„ binlog é‡Œä¼šè®°å½•æ‰€æœ‰çš„å­—æ®µä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯å¯ä»¥ç”¨æ¥ç²¾ç¡®å®šä½åˆšåˆšè¢«æ’å…¥çš„é‚£ä¸€è¡Œã€‚è¿™æ—¶ï¼Œä½ ç›´æ¥æŠŠ insert è¯­å¥è½¬æˆ delete è¯­å¥ï¼Œåˆ é™¤æ‰è¿™è¢«è¯¯æ’å…¥çš„ä¸€è¡Œæ•°æ®å°±å¯ä»¥äº†ã€‚\n  å¦‚æœæ‰§è¡Œçš„æ˜¯ update è¯­å¥çš„è¯ï¼Œbinlog é‡Œé¢ä¼šè®°å½•ä¿®æ”¹å‰æ•´è¡Œçš„æ•°æ®å’Œä¿®æ”¹åçš„æ•´è¡Œæ•°æ®ã€‚æ‰€ä»¥ï¼Œå¦‚æœä½ è¯¯æ‰§è¡Œäº† update è¯­å¥çš„è¯ï¼Œåªéœ€è¦æŠŠè¿™ä¸ª event å‰åçš„ä¸¤è¡Œä¿¡æ¯å¯¹è°ƒä¸€ä¸‹ï¼Œå†å»æ•°æ®åº“é‡Œé¢æ‰§è¡Œï¼Œå°±èƒ½æ¢å¤è¿™ä¸ªæ›´æ–°æ“ä½œäº†ã€‚\n  å¾ªç¯å¤åˆ¶é—®é¢˜ ç°åœ¨å¯ä»¥çŸ¥é“ï¼Œbinlog çš„ç‰¹æ€§ç¡®ä¿äº†åœ¨å¤‡åº“æ‰§è¡Œç›¸åŒçš„ binlogï¼Œå¯ä»¥å¾—åˆ°ä¸ä¸»åº“ç›¸åŒçš„çŠ¶æ€ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥è®¤ä¸ºå›¾1ä¸­æ‰€ç¤ºçš„M-Sç»“æ„ä¸­Aã€Bä¸¤ä¸ªèŠ‚ç‚¹çš„å†…å®¹æ˜¯ä¸€è‡´çš„ã€‚\nä½†å®é™…ç”Ÿäº§ä¸Šä½¿ç”¨æ¯”è¾ƒå¤šçš„æ˜¯åŒ M ç»“æ„ï¼Œä¹Ÿå°±æ˜¯ä¸‹å›¾æ‰€ç¤ºçš„ä¸»å¤‡åˆ‡æ¢æµç¨‹ã€‚\nå¯¹æ¯”ä¸Šå›¾å’Œå›¾ 1ï¼Œä½ å¯ä»¥å‘ç°ï¼ŒåŒ M ç»“æ„å’Œ M-S ç»“æ„ï¼Œå…¶å®åŒºåˆ«åªæ˜¯å¤šäº†ä¸€æ¡çº¿ï¼Œå³ï¼šèŠ‚ç‚¹ A å’Œ B ä¹‹é—´æ€»æ˜¯äº’ä¸ºä¸»å¤‡å…³ç³»ã€‚è¿™æ ·åœ¨åˆ‡æ¢çš„æ—¶å€™å°±ä¸ç”¨å†ä¿®æ”¹ä¸»å¤‡å…³ç³»ã€‚\nä½†æ˜¯ï¼ŒåŒ M ç»“æ„è¿˜æœ‰ä¸€ä¸ªé—®é¢˜éœ€è¦è§£å†³ã€‚\nä¸šåŠ¡é€»è¾‘åœ¨èŠ‚ç‚¹ A ä¸Šæ›´æ–°äº†ä¸€æ¡è¯­å¥ï¼Œç„¶åå†æŠŠç”Ÿæˆçš„ binlog å‘ç»™èŠ‚ç‚¹ Bï¼ŒèŠ‚ç‚¹ B æ‰§è¡Œå®Œè¿™æ¡æ›´æ–°è¯­å¥åä¹Ÿä¼šç”Ÿæˆ binlogã€‚ï¼ˆæˆ‘å»ºè®®ä½ æŠŠå‚æ•° log_slave_updates è®¾ç½®ä¸º onï¼Œè¡¨ç¤ºå¤‡åº“æ‰§è¡Œ relay log åç”Ÿæˆ binlogï¼‰ã€‚\né‚£ä¹ˆï¼Œå¦‚æœèŠ‚ç‚¹ A åŒæ—¶æ˜¯èŠ‚ç‚¹ B çš„å¤‡åº“ï¼Œç›¸å½“äºåˆæŠŠèŠ‚ç‚¹ B æ–°ç”Ÿæˆçš„ binlog æ‹¿è¿‡æ¥æ‰§è¡Œäº†ä¸€æ¬¡ï¼Œç„¶åèŠ‚ç‚¹ A å’Œ B é—´ï¼Œä¼šä¸æ–­åœ°å¾ªç¯æ‰§è¡Œè¿™ä¸ªæ›´æ–°è¯­å¥ï¼Œä¹Ÿå°±æ˜¯å¾ªç¯å¤åˆ¶äº†ã€‚è¿™ä¸ªè¦æ€ä¹ˆè§£å†³å‘¢ï¼Ÿ\nä»rowæ ¼å¼çš„æ—¥å¿—ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒMySQL åœ¨ binlog ä¸­è®°å½•äº†è¿™ä¸ªå‘½ä»¤ç¬¬ä¸€æ¬¡æ‰§è¡Œæ—¶æ‰€åœ¨å®ä¾‹çš„ server idã€‚å› æ­¤ï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„é€»è¾‘ï¼Œæ¥è§£å†³ä¸¤ä¸ªèŠ‚ç‚¹é—´çš„å¾ªç¯å¤åˆ¶çš„é—®é¢˜ï¼š\n è§„å®šä¸¤ä¸ªåº“çš„ server id å¿…é¡»ä¸åŒï¼Œå¦‚æœç›¸åŒï¼Œåˆ™å®ƒä»¬ä¹‹é—´ä¸èƒ½è®¾å®šä¸ºä¸»å¤‡å…³ç³»ï¼› ä¸€ä¸ªå¤‡åº“æ¥åˆ° binlog å¹¶åœ¨é‡æ”¾çš„è¿‡ç¨‹ä¸­ï¼Œç”Ÿæˆä¸åŸ binlog çš„ server id ç›¸åŒçš„æ–°çš„ binlogï¼› æ¯ä¸ªåº“åœ¨æ”¶åˆ°ä»è‡ªå·±çš„ä¸»åº“å‘è¿‡æ¥çš„æ—¥å¿—åï¼Œå…ˆåˆ¤æ–­ server idï¼Œå¦‚æœè·Ÿè‡ªå·±çš„ç›¸åŒï¼Œè¡¨ç¤ºè¿™ä¸ªæ—¥å¿—æ˜¯è‡ªå·±ç”Ÿæˆçš„ï¼Œå°±ç›´æ¥ä¸¢å¼ƒè¿™ä¸ªæ—¥å¿—ã€‚  æŒ‰ç…§è¿™ä¸ªé€»è¾‘ï¼Œå¦‚æœæˆ‘ä»¬è®¾ç½®äº†åŒ M ç»“æ„ï¼Œæ—¥å¿—çš„æ‰§è¡Œæµå°±ä¼šå˜æˆè¿™æ ·ï¼š\n ä»èŠ‚ç‚¹ A æ›´æ–°çš„äº‹åŠ¡ï¼Œbinlog é‡Œé¢è®°çš„éƒ½æ˜¯ A çš„ server idï¼› ä¼ åˆ°èŠ‚ç‚¹ B æ‰§è¡Œä¸€æ¬¡ä»¥åï¼ŒèŠ‚ç‚¹ B ç”Ÿæˆçš„ binlog çš„ server id ä¹Ÿæ˜¯ A çš„ server idï¼› å†ä¼ å›ç»™èŠ‚ç‚¹ Aï¼ŒA åˆ¤æ–­åˆ°è¿™ä¸ª server id ä¸è‡ªå·±çš„ç›¸åŒï¼Œå°±ä¸ä¼šå†å¤„ç†è¿™ä¸ªæ—¥å¿—ã€‚æ‰€ä»¥ï¼Œæ­»å¾ªç¯åœ¨è¿™é‡Œå°±æ–­æ‰äº†ã€‚  ","permalink":"http://yangchnet.github.io/Dessert/posts/%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%A6%82%E8%A7%88mysql%E7%AF%87%E5%9B%9B%E4%B8%BB%E5%A4%87%E4%B8%8E%E9%AB%98%E5%8F%AF%E7%94%A8/","summary":"æå®¢æ—¶é—´ã€ŠMySQLå®æˆ˜45è®²ã€‹ç¬”è®°\n ä¸»å¤‡çš„åŸºæœ¬åŸç† åœ¨çŠ¶æ€ 1 ä¸­ï¼Œå®¢æˆ·ç«¯çš„è¯»å†™éƒ½ç›´æ¥è®¿é—®èŠ‚ç‚¹ Aï¼Œè€ŒèŠ‚ç‚¹ B æ˜¯ A çš„å¤‡åº“ï¼Œåªæ˜¯å°† A çš„æ›´æ–°éƒ½åŒæ­¥è¿‡æ¥ï¼Œåˆ°æœ¬åœ°æ‰§è¡Œã€‚è¿™æ ·å¯ä»¥ä¿æŒèŠ‚ç‚¹ B å’Œ A çš„æ•°æ®æ˜¯ç›¸åŒçš„ã€‚\nå½“éœ€è¦åˆ‡æ¢çš„æ—¶å€™ï¼Œå°±åˆ‡æˆçŠ¶æ€ 2ã€‚è¿™æ—¶å€™å®¢æˆ·ç«¯è¯»å†™è®¿é—®çš„éƒ½æ˜¯èŠ‚ç‚¹ Bï¼Œè€ŒèŠ‚ç‚¹ A æ˜¯ B çš„å¤‡åº“ã€‚\né‚£ä¹ˆä»çŠ¶æ€1åˆ‡æ¢åˆ°çŠ¶æ€2çš„å†…éƒ¨æµç¨‹æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ\nå¤‡åº“ B è·Ÿä¸»åº“ A ä¹‹é—´ç»´æŒäº†ä¸€ä¸ªé•¿è¿æ¥ã€‚ä¸»åº“ A å†…éƒ¨æœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œä¸“é—¨ç”¨äºæœåŠ¡å¤‡åº“ B çš„è¿™ä¸ªé•¿è¿æ¥ã€‚ä¸€ä¸ªäº‹åŠ¡æ—¥å¿—åŒæ­¥çš„å®Œæ•´è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š\n åœ¨å¤‡åº“ B ä¸Šé€šè¿‡ change master å‘½ä»¤ï¼Œè®¾ç½®ä¸»åº“ A çš„ IPã€ç«¯å£ã€ç”¨æˆ·åã€å¯†ç ï¼Œä»¥åŠè¦ä»å“ªä¸ªä½ç½®å¼€å§‹è¯·æ±‚ binlogï¼Œè¿™ä¸ªä½ç½®åŒ…å«æ–‡ä»¶åå’Œæ—¥å¿—åç§»é‡ã€‚ åœ¨å¤‡åº“ B ä¸Šæ‰§è¡Œ start slave å‘½ä»¤ï¼Œè¿™æ—¶å€™å¤‡åº“ä¼šå¯åŠ¨ä¸¤ä¸ªçº¿ç¨‹ï¼Œå°±æ˜¯å›¾ä¸­çš„ io_thread å’Œ sql_threadã€‚å…¶ä¸­ io_thread è´Ÿè´£ä¸ä¸»åº“å»ºç«‹è¿æ¥ã€‚ ä¸»åº“ A æ ¡éªŒå®Œç”¨æˆ·åã€å¯†ç åï¼Œå¼€å§‹æŒ‰ç…§å¤‡åº“ B ä¼ è¿‡æ¥çš„ä½ç½®ï¼Œä»æœ¬åœ°è¯»å– binlogï¼Œå‘ç»™ Bã€‚ å¤‡åº“ B æ‹¿åˆ° binlog åï¼Œå†™åˆ°æœ¬åœ°æ–‡ä»¶ï¼Œç§°ä¸ºä¸­è½¬æ—¥å¿—ï¼ˆrelay logï¼‰ã€‚ sql_thread è¯»å–ä¸­è½¬æ—¥å¿—ï¼Œè§£æå‡ºæ—¥å¿—é‡Œçš„å‘½ä»¤ï¼Œå¹¶æ‰§è¡Œã€‚  binlog çš„ä¸‰ç§æ ¼å¼å¯¹æ¯” ä¸»å¤‡å¤åˆ¶ä¾èµ–äºbin logï¼Œé‚£ä¹ˆbin logä¸­æ˜¯ä»€ä¹ˆå†…å®¹ã€‚","title":"æ¦‚è§ˆMySQLç¯‡å››ï¼šä¸»å¤‡ä¸é«˜å¯ç”¨"},{"content":" æå®¢æ—¶é—´ã€ŠMySQLå®æˆ˜45è®²ã€‹ç¬”è®°\n ç´¢å¼•æ˜¯ä»€ä¹ˆï¼Œä¸ºä½•å­˜åœ¨ï¼Œä»¥ä»€ä¹ˆæ ·çš„ç»“æ„ç»„ç»‡æˆ–å­˜å‚¨ç´¢å¼•? ç®€å•æ¥è¯´ï¼Œç´¢å¼•æ˜¯ä¸€ä¸ªç›®å½•ï¼Œç”¨æ¥å¯¹æ•°æ®è¿›è¡Œå¿«é€Ÿçš„æŸ¥æ‰¾ã€‚å°±åƒä¸€æœ¬åšåšçš„å­—å…¸ï¼Œæƒ³è¦æŸ¥è¯¢æŸä¸ªå­—æˆ–è€…è¯è¯­ï¼Œæˆ‘ä»¬å›ºç„¶å¯ä»¥ä¸€é¡µé¡µç¿»é˜…æ•´æœ¬è¯å…¸ï¼Œä½†æ›´å¥½çš„æ–¹å¼æ˜¯é€šè¿‡æ‹¼éŸ³ç´¢å¼•æˆ–è€…ç¬”ç”»ç´¢å¼•åˆ°è¿™æ¡è®°å½•ã€‚\nç´¢å¼•å¯ä»¥æœ‰æ•ˆå‡å°æŸ¥è¯¢çš„èµ„æºæ¶ˆè€—ï¼Œä½†ç´¢å¼•ä¸æ˜¯æ¯«æ— ä»£ä»·çš„ï¼Œå¤§é‡çš„åˆ›å»ºç´¢å¼•ä¼šé€ æˆå­˜å‚¨ç©ºé—´çš„æŸè€—ï¼Œæˆ‘ä»¬è¦æ ¹æ®ä¸šåŠ¡éœ€æ±‚ï¼Œæœ‰ç›®çš„çš„åˆ›å»ºå¯¹ä¸šåŠ¡æœ‰å¸®åŠ©çš„ç´¢å¼•ã€‚\nåœ¨MySQLçš„InnoDBå¼•æ“ä¸­ï¼Œç´¢å¼•æ˜¯ä»¥B+æ ‘çš„å½¢å¼å­˜åœ¨çš„ã€‚B+æ ‘çš„èŠ‚ç‚¹å­˜å‚¨åœ¨ç‰©ç†é¡µä¸Šã€‚\næ ¹æ®å¶å­èŠ‚ç‚¹çš„å†…å®¹ï¼Œç´¢å¼•ç±»å‹åˆ†ä¸ºä¸»é”®ç´¢å¼•å’Œéä¸»é”®ç´¢å¼•ã€‚\nä¸»é”®ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜çš„æ˜¯æ•´è¡Œæ•°æ®ã€‚åœ¨ InnoDB é‡Œï¼Œä¸»é”®ç´¢å¼•ä¹Ÿè¢«ç§°ä¸ºèšç°‡ç´¢å¼•ï¼ˆclustered indexï¼‰ã€‚\néä¸»é”®ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å†…å®¹æ˜¯ä¸»é”®çš„å€¼ã€‚åœ¨ InnoDB é‡Œï¼Œéä¸»é”®ç´¢å¼•ä¹Ÿè¢«ç§°ä¸ºäºŒçº§ç´¢å¼•ï¼ˆsecondary indexï¼‰ã€‚\nä¸ºä»€ä¹ˆæ›´æ¨èä½¿ç”¨è‡ªå¢ä¸»é”®? è‡ªå¢ä¸»é”®æ˜¯æŒ‡è‡ªå¢åˆ—ä¸Šå®šä¹‰çš„ä¸»é”®ï¼Œåœ¨å»ºè¡¨è¯­å¥ä¸­ä¸€èˆ¬æ˜¯è¿™ä¹ˆå®šä¹‰çš„ï¼š\nNOT NULL PRIMARY KEY AUTO_INCREMENTã€‚ B+æ ‘å¤©ç„¶å°±æ˜¯æœ‰åºçš„ï¼Œå½“æˆ‘ä»¬æƒ³åœ¨ä¸Šå›¾ä¸­æ’å…¥ä¸€ä¸ªID=400çš„è®°å½•ï¼Œé‚£ä¹ˆå¯èƒ½éœ€è¦è¿›è¡Œé¡µåˆ†è£‚æ“ä½œï¼Œè¿™å°±éœ€è¦æŒªåŠ¨åé¢çš„æ•°æ®ã€‚ä½†å¦‚æœæƒ³æ’å…¥ä¸€ä¸ªID=700çš„å€¼ï¼Œåªéœ€è¦åœ¨æœ€åé™„åŠ ä¸€æ¡è®°å½•å°±å¯ä»¥ï¼Œä¸éœ€è¦å¯¹å‰é¢çš„å€¼å°±è¡Œæ“ä½œã€‚\nè‡ªå¢ä¸»é”®çš„æ’å…¥æ•°æ®æ¨¡å¼ï¼Œæ­£ç¬¦åˆäº†æˆ‘ä»¬å‰é¢æåˆ°çš„é€’å¢æ’å…¥çš„åœºæ™¯ã€‚æ¯æ¬¡æ’å…¥ä¸€æ¡æ–°è®°å½•ï¼Œéƒ½æ˜¯è¿½åŠ æ“ä½œï¼Œéƒ½ä¸æ¶‰åŠåˆ°æŒªåŠ¨å…¶ä»–è®°å½•ï¼Œä¹Ÿä¸ä¼šè§¦å‘å¶å­èŠ‚ç‚¹çš„åˆ†è£‚ã€‚\né™¤äº†æ€§èƒ½å¤–ï¼Œé¡µåˆ†è£‚æ“ä½œè¿˜å½±å“æ•°æ®é¡µçš„åˆ©ç”¨ç‡ã€‚åŸæœ¬æ”¾åœ¨ä¸€ä¸ªé¡µçš„æ•°æ®ï¼Œç°åœ¨åˆ†åˆ°ä¸¤ä¸ªé¡µä¸­ï¼Œæ•´ä½“ç©ºé—´åˆ©ç”¨ç‡é™ä½å¤§çº¦ 50%ã€‚\nä½¿ç”¨ç´¢å¼•æŸ¥è¯¢çš„è¿‡ç¨‹æ˜¯æ€ä¹ˆæ ·çš„ï¼Œä»€ä¹ˆå«å›è¡¨ã€è¦†ç›–ç´¢å¼•ï¼Ÿ å¯¹äºå¦‚ä¸‹è¡¨ï¼š\nmysql\u0026gt; create table T ( ID int primary key, k int NOT NULL DEFAULT 0, s varchar(16) NOT NULL DEFAULT \u0026#39;\u0026#39;, index k(k)) engine=InnoDB; insert into T values(100,1, \u0026#39;aa\u0026#39;),(200,2,\u0026#39;bb\u0026#39;),(300,3,\u0026#39;cc\u0026#39;),(500,5,\u0026#39;ee\u0026#39;),(600,6,\u0026#39;ff\u0026#39;),(700,7,\u0026#39;gg\u0026#39;); å½“æ‰§è¡Œselect * from T where k between 3 and 5æ—¶ï¼Œè¿‡ç¨‹å¦‚ä¸‹ï¼š\n åœ¨ k ç´¢å¼•æ ‘ä¸Šæ‰¾åˆ° k=3 çš„è®°å½•ï¼Œå–å¾— ID = 300ï¼› å†åˆ° ID ç´¢å¼•æ ‘æŸ¥åˆ° ID=300 å¯¹åº”çš„ R3ï¼› åœ¨ k ç´¢å¼•æ ‘å–ä¸‹ä¸€ä¸ªå€¼ k=5ï¼Œå–å¾— ID=500ï¼› å†å›åˆ° ID ç´¢å¼•æ ‘æŸ¥åˆ° ID=500 å¯¹åº”çš„ R4ï¼› åœ¨ k ç´¢å¼•æ ‘å–ä¸‹ä¸€ä¸ªå€¼ k=6ï¼Œä¸æ»¡è¶³æ¡ä»¶ï¼Œå¾ªç¯ç»“æŸã€‚  å¯ä»¥çœ‹åˆ°ï¼ŒMySQLå…ˆåœ¨kç´¢å¼•æ ‘ä¸ŠæŸ¥æ‰¾æ»¡è¶³æ¡ä»¶çš„è®°å½•ï¼Œæ‹¿åˆ°ä¸»é”®ï¼Œç„¶åå†åˆ°ä¸»é”®ç´¢å¼•æ ‘ä¸Šå»å–æ•´æ¡è®°å½•ã€‚è¿™ä¸ªç”¨ä¸»é”®å»ä¸»é”®ç´¢å¼•ä¸Šå–æ•°æ®çš„æ“ä½œå°±å«åšå›è¡¨ã€‚\nå›è¡¨çš„è¿‡ç¨‹é‡æ–°è®¿é—®äº†ä¸»é”®ç´¢å¼•ï¼Œæœ‰æ²¡æœ‰ä»€ä¹ˆåŠæ³•å¯ä»¥é¿å…å›è¡¨ï¼Ÿ\nå¦‚æœå°†ä¸Šé¢çš„æŸ¥è¯¢è¯­å¥æ”¹æˆselect ID from T where k between 3 and 5ï¼Œè¿™æ—¶æˆ‘ä»¬æŸ¥è¯¢kç´¢å¼•æ ‘çš„æ—¶å€™ï¼Œç”±äºIDå·²ç»åœ¨ké”®ç´¢å¼•ä¸Šå­˜åœ¨äº†ï¼Œå› æ­¤å°±ä¸éœ€è¦å†è¿›è¡Œå›è¡¨æ“ä½œã€‚ç´¢å¼•è¦†ç›–äº†æˆ‘ä»¬çš„æŸ¥è¯¢éœ€æ±‚ï¼Œç§°ä¸ºè¦†ç›–ç´¢å¼•ã€‚\nä»€ä¹ˆå«æœ€å·¦å‰ç¼€ï¼Œç´¢å¼•ä¸‹æ¨ å¯¹äºä¸€ä¸ªè®°å½•å±…æ°‘èº«ä»½ä¿¡æ¯çš„è¡¨ï¼Œå…¶ï¼ˆname, ageï¼‰ç´¢å¼•å¦‚ä¸‹ï¼š å½“æˆ‘ä»¬æƒ³è¦åœ¨è¿™å¼ è¡¨ä¸ŠæŸ¥è¯¢name=å¼ ä¸‰çš„è®°å½•æ—¶ï¼Œå¯ä»¥é€šè¿‡ç´¢å¼•å¿«é€Ÿå®šä½åˆ°ID4ï¼Œç„¶åç»§ç»­å¾€åæŸ¥æ‰¾ã€‚ç±»ä¼¼çš„ï¼Œå½“æˆ‘ä»¬æƒ³è¦æŸ¥æ‰¾name like å¼ %çš„è®°å½•æ—¶ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨è¿™ä¸ªç´¢å¼•å¿«é€Ÿå®šä½åˆ°æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€ä¸ªè®°å½•ID3.\nå¯ä»¥çœ‹åˆ°ï¼Œä¸åªæ˜¯ç´¢å¼•çš„å…¨éƒ¨å®šä¹‰ï¼Œåªè¦æ»¡è¶³æœ€å·¦å‰ç¼€ï¼Œå°±å¯ä»¥åˆ©ç”¨ç´¢å¼•æ¥åŠ é€Ÿæ£€ç´¢ã€‚è¿™ä¸ªæœ€å·¦å‰ç¼€å¯ä»¥æ˜¯è”åˆç´¢å¼•çš„æœ€å·¦ N ä¸ªå­—æ®µï¼Œä¹Ÿå¯ä»¥æ˜¯å­—ç¬¦ä¸²ç´¢å¼•çš„æœ€å·¦ M ä¸ªå­—ç¬¦ã€‚\nå¯¹äºå¦‚ä¸‹è¯­å¥ï¼š\nmysql\u0026gt; select * from tuser where name like \u0026#39;å¼ %\u0026#39; and age=10 and ismale=1; åœ¨MySQL5.6ä¹‹å‰ï¼Œåœ¨ï¼ˆnameï¼Œ ageï¼‰ç´¢å¼•ä¸Šæ‰¾åˆ°ç¬¦åˆname like 'å¼ %'çš„è®°å½•åï¼Œä»ç„¶éœ€è¦æ ¹æ®ç´¢å¼•ä¸Šå­˜å‚¨çš„ä¸»é”®å»ä¸»ç´¢å¼•ä¸Šå›è¡¨ï¼Œå¾…å°†æ•´è¡Œæ•°æ®å…¨éƒ¨å–å‡ºåå†è¿›è¡Œåˆ¤æ–­ã€‚\nä½†ä»”ç»†è§‚å¯Ÿå¯ä»¥å‘ç°ï¼Œï¼ˆnameï¼Œ ageï¼‰è”åˆç´¢å¼•ä¸Šå·²ç»å­˜åœ¨ageå­—æ®µï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºage=10è¿™ä¸ªæ¡ä»¶åˆ¤æ–­ï¼Œæˆ‘ä»¬å®Œå…¨ä¸éœ€è¦è¿›è¡Œå›è¡¨ï¼Œåªç”¨å½“å‰ç´¢å¼•ä¸Šçš„æ•°æ®å°±å¯ä»¥è¿›è¡Œåˆ¤æ–­ã€‚è¿™å«åšç´¢å¼•ä¸‹æ¨\næ‰«æè¡Œæ•°æ˜¯å¦‚ä½•åˆ¤æ–­çš„ï¼Ÿ å½“ä¸€ä¸ªè¯­å¥è¢«åˆ†æå®Œæ¯•åï¼Œä¼šç”±ä¼˜åŒ–å™¨æ¥é€‰æ‹©ç´¢å¼•ï¼Œç›®çš„æ˜¯æ‰¾å‡ºä¸€ä¸ªæœ€ä¼˜çš„æ‰§è¡Œæ–¹æ¡ˆï¼Œå¹¶ç”¨æœ€å°çš„ä»£ä»·å»æ‰§è¡Œè¯­å¥ã€‚å…¶ä¸­ï¼Œæ‰«æè¡Œæ•°æ˜¯ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„åˆ¤æ–­æ ‡å‡†ã€‚\nMySQL åœ¨çœŸæ­£å¼€å§‹æ‰§è¡Œè¯­å¥ä¹‹å‰ï¼Œå¹¶ä¸èƒ½ç²¾ç¡®åœ°çŸ¥é“æ»¡è¶³è¿™ä¸ªæ¡ä»¶çš„è®°å½•æœ‰å¤šå°‘æ¡ï¼Œè€Œåªèƒ½æ ¹æ®ç»Ÿè®¡ä¿¡æ¯æ¥ä¼°ç®—è®°å½•æ•°ã€‚\nè¿™ä¸ªç»Ÿè®¡ä¿¡æ¯å°±æ˜¯ç´¢å¼•çš„â€œåŒºåˆ†åº¦â€ã€‚æ˜¾ç„¶ï¼Œä¸€ä¸ªç´¢å¼•ä¸Šä¸åŒçš„å€¼è¶Šå¤šï¼Œè¿™ä¸ªç´¢å¼•çš„åŒºåˆ†åº¦å°±è¶Šå¥½ã€‚è€Œä¸€ä¸ªç´¢å¼•ä¸Šä¸åŒçš„å€¼çš„ä¸ªæ•°ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œåŸºæ•°â€ï¼ˆcardinalityï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªåŸºæ•°è¶Šå¤§ï¼Œç´¢å¼•çš„åŒºåˆ†åº¦è¶Šå¥½ã€‚\nå¯ä»¥ä½¿ç”¨show indexæ–¹æ³•ï¼ŒæŸ¥çœ‹ç´¢å¼•çš„åŸºæ•°ã€‚ä½†ï¼ŒåŸºæ•°å¯èƒ½ä¼šä¸å‡†ç¡®ã€‚\nMySQLé‡‡ç”¨é‡‡æ ·çš„ç»Ÿè®¡çš„æ–¹æ³•å¾—åˆ°ç´¢å¼•çš„åŸºæ•°ã€‚\nä¸ºä»€ä¹ˆè¦é‡‡æ ·ç»Ÿè®¡å‘¢ï¼Ÿå› ä¸ºæŠŠæ•´å¼ è¡¨å–å‡ºæ¥ä¸€è¡Œè¡Œç»Ÿè®¡ï¼Œè™½ç„¶å¯ä»¥å¾—åˆ°ç²¾ç¡®çš„ç»“æœï¼Œä½†æ˜¯ä»£ä»·å¤ªé«˜äº†ï¼Œæ‰€ä»¥åªèƒ½é€‰æ‹©â€œé‡‡æ ·ç»Ÿè®¡â€ã€‚\né‡‡æ ·ç»Ÿè®¡çš„æ—¶å€™ï¼ŒInnoDB é»˜è®¤ä¼šé€‰æ‹© N ä¸ªæ•°æ®é¡µï¼Œç»Ÿè®¡è¿™äº›é¡µé¢ä¸Šçš„ä¸åŒå€¼ï¼Œå¾—åˆ°ä¸€ä¸ªå¹³å‡å€¼ï¼Œç„¶åä¹˜ä»¥è¿™ä¸ªç´¢å¼•çš„é¡µé¢æ•°ï¼Œå°±å¾—åˆ°äº†è¿™ä¸ªç´¢å¼•çš„åŸºæ•°ã€‚\nè€Œæ•°æ®è¡¨æ˜¯ä¼šæŒç»­æ›´æ–°çš„ï¼Œç´¢å¼•ç»Ÿè®¡ä¿¡æ¯ä¹Ÿä¸ä¼šå›ºå®šä¸å˜ã€‚æ‰€ä»¥ï¼Œå½“å˜æ›´çš„æ•°æ®è¡Œæ•°è¶…è¿‡ 1/M çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨è§¦å‘é‡æ–°åšä¸€æ¬¡ç´¢å¼•ç»Ÿè®¡ã€‚\nåœ¨ MySQL ä¸­ï¼Œæœ‰ä¸¤ç§å­˜å‚¨ç´¢å¼•ç»Ÿè®¡çš„æ–¹å¼ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®å‚æ•°innodb_stats_persistent çš„å€¼æ¥é€‰æ‹©ï¼š\n è®¾ç½®ä¸º on çš„æ—¶å€™ï¼Œè¡¨ç¤ºç»Ÿè®¡ä¿¡æ¯ä¼šæŒä¹…åŒ–å­˜å‚¨ã€‚è¿™æ—¶ï¼Œé»˜è®¤çš„ N æ˜¯ 20ï¼ŒM æ˜¯ 10ã€‚ è®¾ç½®ä¸º off çš„æ—¶å€™ï¼Œè¡¨ç¤ºç»Ÿè®¡ä¿¡æ¯åªå­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚è¿™æ—¶ï¼Œé»˜è®¤çš„ N æ˜¯ 8ï¼ŒM æ˜¯ 16ã€‚  ç”±äºæ˜¯é‡‡æ ·ç»Ÿè®¡ï¼Œæ‰€ä»¥ä¸ç®¡ N æ˜¯ 20 è¿˜æ˜¯ 8ï¼Œè¿™ä¸ªåŸºæ•°éƒ½æ˜¯å¾ˆå®¹æ˜“ä¸å‡†çš„ã€‚\nå¦‚ä½•ä¿®æ­£ç´¢å¼•ç»Ÿè®¡ä¿¡æ¯ï¼Ÿ\nanalyze table \u0026lt;table_name\u0026gt;; å¯¹äºå­—ç¬¦ä¸²ç´¢å¼•ï¼Œæœ‰å“ªäº›ä¼˜åŒ–æ–¹å¼ å¯¹äºé‚®ç®±ç­‰å­—æ®µï¼Œå¯ä»¥ä½¿ç”¨å‰ç¼€ç´¢å¼•ã€‚ä½†ä½¿ç”¨å‰ç¼€ç´¢å¼•å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šå³ä½¿å‰ç¼€ç´¢å¼•ä¸­å·²ç»åŒ…å«äº†æŸ¥è¯¢æ‰€éœ€è¦çš„å…¨éƒ¨ä¿¡æ¯ï¼Œä½†MySQLä»ç„¶è¦è¿›è¡Œå›è¡¨ï¼Œå› ä¸ºç³»ç»Ÿå¹¶ä¸ç¡®å®šå‰ç¼€ç´¢å¼•çš„å®šä¹‰æ˜¯å¦æˆªæ–­äº†å®Œæ•´ä¿¡æ¯ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½¿ç”¨å‰ç¼€ç´¢å¼•å°±ç”¨ä¸ä¸Šè¦†ç›–ç´¢å¼•å¯¹æŸ¥è¯¢æ€§èƒ½çš„ä¼˜åŒ–äº†.\nå¯¹äºèº«ä»½è¯å·è¿™ç§ç±»å‹ï¼Œå¯ä»¥ä½¿ç”¨å€’åºå­˜å‚¨ï¼Œè¿™æ ·å¯ä»¥æ›´å¥½çš„ä½¿ç”¨å‰ç¼€ç´¢å¼•ã€‚\nè¿˜å¯ä»¥ä½¿ç”¨hashå­—æ®µï¼Œåœ¨è¡¨ä¸Šå†åˆ›å»ºä¸€ä¸ªæ•´æ•°å­—æ®µï¼Œæ¥ä¿å­˜å­—æ®µçš„æ ¡éªŒç ï¼ŒåŒæ—¶åœ¨è¿™ä¸ªå­—æ®µä¸Šåˆ›å»ºç´¢å¼•ã€‚\n","permalink":"http://yangchnet.github.io/Dessert/posts/%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%A6%82%E8%A7%88mysql%E7%AF%87%E4%B8%80%E7%B4%A2%E5%BC%95/","summary":"æå®¢æ—¶é—´ã€ŠMySQLå®æˆ˜45è®²ã€‹ç¬”è®°\n ç´¢å¼•æ˜¯ä»€ä¹ˆï¼Œä¸ºä½•å­˜åœ¨ï¼Œä»¥ä»€ä¹ˆæ ·çš„ç»“æ„ç»„ç»‡æˆ–å­˜å‚¨ç´¢å¼•? ç®€å•æ¥è¯´ï¼Œç´¢å¼•æ˜¯ä¸€ä¸ªç›®å½•ï¼Œç”¨æ¥å¯¹æ•°æ®è¿›è¡Œå¿«é€Ÿçš„æŸ¥æ‰¾ã€‚å°±åƒä¸€æœ¬åšåšçš„å­—å…¸ï¼Œæƒ³è¦æŸ¥è¯¢æŸä¸ªå­—æˆ–è€…è¯è¯­ï¼Œæˆ‘ä»¬å›ºç„¶å¯ä»¥ä¸€é¡µé¡µç¿»é˜…æ•´æœ¬è¯å…¸ï¼Œä½†æ›´å¥½çš„æ–¹å¼æ˜¯é€šè¿‡æ‹¼éŸ³ç´¢å¼•æˆ–è€…ç¬”ç”»ç´¢å¼•åˆ°è¿™æ¡è®°å½•ã€‚\nç´¢å¼•å¯ä»¥æœ‰æ•ˆå‡å°æŸ¥è¯¢çš„èµ„æºæ¶ˆè€—ï¼Œä½†ç´¢å¼•ä¸æ˜¯æ¯«æ— ä»£ä»·çš„ï¼Œå¤§é‡çš„åˆ›å»ºç´¢å¼•ä¼šé€ æˆå­˜å‚¨ç©ºé—´çš„æŸè€—ï¼Œæˆ‘ä»¬è¦æ ¹æ®ä¸šåŠ¡éœ€æ±‚ï¼Œæœ‰ç›®çš„çš„åˆ›å»ºå¯¹ä¸šåŠ¡æœ‰å¸®åŠ©çš„ç´¢å¼•ã€‚\nåœ¨MySQLçš„InnoDBå¼•æ“ä¸­ï¼Œç´¢å¼•æ˜¯ä»¥B+æ ‘çš„å½¢å¼å­˜åœ¨çš„ã€‚B+æ ‘çš„èŠ‚ç‚¹å­˜å‚¨åœ¨ç‰©ç†é¡µä¸Šã€‚\næ ¹æ®å¶å­èŠ‚ç‚¹çš„å†…å®¹ï¼Œç´¢å¼•ç±»å‹åˆ†ä¸ºä¸»é”®ç´¢å¼•å’Œéä¸»é”®ç´¢å¼•ã€‚\nä¸»é”®ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜çš„æ˜¯æ•´è¡Œæ•°æ®ã€‚åœ¨ InnoDB é‡Œï¼Œä¸»é”®ç´¢å¼•ä¹Ÿè¢«ç§°ä¸ºèšç°‡ç´¢å¼•ï¼ˆclustered indexï¼‰ã€‚\néä¸»é”®ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å†…å®¹æ˜¯ä¸»é”®çš„å€¼ã€‚åœ¨ InnoDB é‡Œï¼Œéä¸»é”®ç´¢å¼•ä¹Ÿè¢«ç§°ä¸ºäºŒçº§ç´¢å¼•ï¼ˆsecondary indexï¼‰ã€‚\nä¸ºä»€ä¹ˆæ›´æ¨èä½¿ç”¨è‡ªå¢ä¸»é”®? è‡ªå¢ä¸»é”®æ˜¯æŒ‡è‡ªå¢åˆ—ä¸Šå®šä¹‰çš„ä¸»é”®ï¼Œåœ¨å»ºè¡¨è¯­å¥ä¸­ä¸€èˆ¬æ˜¯è¿™ä¹ˆå®šä¹‰çš„ï¼š\nNOT NULL PRIMARY KEY AUTO_INCREMENTã€‚ B+æ ‘å¤©ç„¶å°±æ˜¯æœ‰åºçš„ï¼Œå½“æˆ‘ä»¬æƒ³åœ¨ä¸Šå›¾ä¸­æ’å…¥ä¸€ä¸ªID=400çš„è®°å½•ï¼Œé‚£ä¹ˆå¯èƒ½éœ€è¦è¿›è¡Œé¡µåˆ†è£‚æ“ä½œï¼Œè¿™å°±éœ€è¦æŒªåŠ¨åé¢çš„æ•°æ®ã€‚ä½†å¦‚æœæƒ³æ’å…¥ä¸€ä¸ªID=700çš„å€¼ï¼Œåªéœ€è¦åœ¨æœ€åé™„åŠ ä¸€æ¡è®°å½•å°±å¯ä»¥ï¼Œä¸éœ€è¦å¯¹å‰é¢çš„å€¼å°±è¡Œæ“ä½œã€‚\nè‡ªå¢ä¸»é”®çš„æ’å…¥æ•°æ®æ¨¡å¼ï¼Œæ­£ç¬¦åˆäº†æˆ‘ä»¬å‰é¢æåˆ°çš„é€’å¢æ’å…¥çš„åœºæ™¯ã€‚æ¯æ¬¡æ’å…¥ä¸€æ¡æ–°è®°å½•ï¼Œéƒ½æ˜¯è¿½åŠ æ“ä½œï¼Œéƒ½ä¸æ¶‰åŠåˆ°æŒªåŠ¨å…¶ä»–è®°å½•ï¼Œä¹Ÿä¸ä¼šè§¦å‘å¶å­èŠ‚ç‚¹çš„åˆ†è£‚ã€‚\né™¤äº†æ€§èƒ½å¤–ï¼Œé¡µåˆ†è£‚æ“ä½œè¿˜å½±å“æ•°æ®é¡µçš„åˆ©ç”¨ç‡ã€‚åŸæœ¬æ”¾åœ¨ä¸€ä¸ªé¡µçš„æ•°æ®ï¼Œç°åœ¨åˆ†åˆ°ä¸¤ä¸ªé¡µä¸­ï¼Œæ•´ä½“ç©ºé—´åˆ©ç”¨ç‡é™ä½å¤§çº¦ 50%ã€‚\nä½¿ç”¨ç´¢å¼•æŸ¥è¯¢çš„è¿‡ç¨‹æ˜¯æ€ä¹ˆæ ·çš„ï¼Œä»€ä¹ˆå«å›è¡¨ã€è¦†ç›–ç´¢å¼•ï¼Ÿ å¯¹äºå¦‚ä¸‹è¡¨ï¼š\nmysql\u0026gt; create table T ( ID int primary key, k int NOT NULL DEFAULT 0, s varchar(16) NOT NULL DEFAULT \u0026#39;\u0026#39;, index k(k)) engine=InnoDB; insert into T values(100,1, \u0026#39;aa\u0026#39;),(200,2,\u0026#39;bb\u0026#39;),(300,3,\u0026#39;cc\u0026#39;),(500,5,\u0026#39;ee\u0026#39;),(600,6,\u0026#39;ff\u0026#39;),(700,7,\u0026#39;gg\u0026#39;); å½“æ‰§è¡Œselect * from T where k between 3 and 5æ—¶ï¼Œè¿‡ç¨‹å¦‚ä¸‹ï¼š\n åœ¨ k ç´¢å¼•æ ‘ä¸Šæ‰¾åˆ° k=3 çš„è®°å½•ï¼Œå–å¾— ID = 300ï¼› å†åˆ° ID ç´¢å¼•æ ‘æŸ¥åˆ° ID=300 å¯¹åº”çš„ R3ï¼› åœ¨ k ç´¢å¼•æ ‘å–ä¸‹ä¸€ä¸ªå€¼ k=5ï¼Œå–å¾— ID=500ï¼› å†å›åˆ° ID ç´¢å¼•æ ‘æŸ¥åˆ° ID=500 å¯¹åº”çš„ R4ï¼› åœ¨ k ç´¢å¼•æ ‘å–ä¸‹ä¸€ä¸ªå€¼ k=6ï¼Œä¸æ»¡è¶³æ¡ä»¶ï¼Œå¾ªç¯ç»“æŸã€‚  å¯ä»¥çœ‹åˆ°ï¼ŒMySQLå…ˆåœ¨kç´¢å¼•æ ‘ä¸ŠæŸ¥æ‰¾æ»¡è¶³æ¡ä»¶çš„è®°å½•ï¼Œæ‹¿åˆ°ä¸»é”®ï¼Œç„¶åå†åˆ°ä¸»é”®ç´¢å¼•æ ‘ä¸Šå»å–æ•´æ¡è®°å½•ã€‚è¿™ä¸ªç”¨ä¸»é”®å»ä¸»é”®ç´¢å¼•ä¸Šå–æ•°æ®çš„æ“ä½œå°±å«åšå›è¡¨ã€‚","title":"æ¦‚è§ˆMySQLç¯‡ä¸€ï¼šç´¢å¼•"},{"content":" å¤§çº¦2021å¹´8æœˆä»½ï¼Œgoç¤¾åŒºå¯¹åˆ‡ç‰‡å®¹é‡å¢é•¿çš„æ–¹å¼è¿›è¡Œäº†ä¸€æ¬¡è°ƒæ•´ã€‚å…·ä½“è®¨è®ºå¯è§ï¼šhttps://groups.google.com/g/golang-nuts/c/UaVlMQ8Nz3o\n 1. ä¹‹å‰çš„å¢é•¿è§„åˆ™ å…ˆçœ‹æºç \n runtime/slice.go\n func growslice(et *_type, old slice, cap int) slice { // çœç•¥éƒ¨åˆ†æ¡ä»¶æ£€æŸ¥  // ...  newcap := old.cap doublecap := newcap + newcap if cap \u0026gt; doublecap { newcap = cap } else { if old.cap \u0026lt; 1024 { newcap = doublecap } else { // Check 0 \u0026lt; newcap to detect overflow \t// and prevent an infinite loop. \tfor 0 \u0026lt; newcap \u0026amp;\u0026amp; newcap \u0026lt; cap { newcap += newcap / 4 } // Set newcap to the requested cap when \t// the newcap calculation overflowed. \tif newcap \u0026lt;= 0 { newcap = cap } } } // å¯¹åˆ‡ç‰‡è¿›è¡Œå†…å­˜å¯¹é½ï¼Œå¯èƒ½ä¼šè°ƒæ•´åˆ‡ç‰‡å®¹é‡å¤§å°  // ...  return slice{p, old.len, newcap} } ä»ä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œå½“cap \u0026lt; 1024æ—¶ï¼Œåˆ‡ç‰‡å®¹é‡å¢é•¿2å€ï¼Œå½“cap \u0026gt; 1024æ—¶å¢é•¿1.25å€ï¼Œå½“ç„¶ï¼Œåœ¨ç»è¿‡å†…å­˜å¯¹é½ç­‰æ“ä½œåï¼Œåˆ‡ç‰‡çš„é•¿åº¦å¯èƒ½ä¸ä¼šä¸¥æ ¼ç­‰äºåŸæ¥çš„2å€æˆ–1.25å€ã€‚\nå­˜åœ¨çš„é—®é¢˜ï¼š\n not monotonically increasing ï¼ˆä¸å¹³æ»‘ï¼‰  x1 := make([]int, 897) x2 := make([]int, 1024) y := make([]int, 100) println(cap(append(x1, y...))) // 2048 println(cap(append(x2, y...))) // 1280 å¯¹äºappend(x1, y...), è¿›è¡Œgrowsliceï¼Œä¼ å…¥çš„capä¸ºæ‰€éœ€çš„æœ€å°å®¹é‡ï¼Œä¸ºï¼šcap(x1) + cap(y) = 997ã€‚ æ­¤æ—¶newcapä¸º897, doublecapä¸º897Ã—2 = 1794ã€‚ç”±äºold.cap = 897 \u0026lt; 1024, æ‰€ä»¥newcap = doublecapï¼Œä¸º1794,å†ç»è¿‡å†…å­˜å¯¹é½åï¼Œæœ€ç»ˆçš„å®¹é‡ä¸º2048.\nå¯¹äºappend(x2, y...), è¿›è¡Œgrowsliceï¼Œä¼ å…¥çš„capä¸º1124,æ­¤æ—¶newcapä¸º1024, doublecapä¸º1024Ã—2 = 2048. ç”±äºcap \u0026lt; doublecapä¸”newcap\u0026lt; cap,å› æ­¤newcap += newcap / 4 = 1280.ç»è¿‡å†…å­˜å¯¹é½åï¼Œä»ä¸º1280.ã€‚\nè¿™æ ·å°±äº§ç”Ÿäº†ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨ä¸€å®šæ¡ä»¶ä¸‹ï¼Œå¦‚æœcap(A) \u0026lt; cap(B), ä½†äºŒè€…éƒ½appendä¸€ä¸ªç›¸åŒé•¿åº¦çš„Cåï¼Œåè€Œcap(A) \u0026gt; cap(B)ã€‚\nnot symmetrical ï¼ˆä¸å¯¹ç§°ï¼‰  x := make([]int, 98) y := make([]int, 666) println(cap(append(x, y...))) // 768 println(cap(append(y, x...))) // 1360 2. è°ƒæ•´ä¹‹å æºç ï¼š\nfunc growslice(et *_type, old slice, cap int) slice { // çœç•¥éƒ¨åˆ†æ¡ä»¶æ£€æŸ¥  // ...  newcap := old.cap doublecap := newcap + newcap if cap \u0026gt; doublecap { newcap = cap } else { const threshold = 256 if old.cap \u0026lt; threshold { newcap = doublecap } else { // Check 0 \u0026lt; newcap to detect overflow \t// and prevent an infinite loop. \tfor 0 \u0026lt; newcap \u0026amp;\u0026amp; newcap \u0026lt; cap { // Transition from growing 2x for small slices \t// to growing 1.25x for large slices. This formula \t// gives a smooth-ish transition between the two. \tnewcap += (newcap + 3*threshold) / 4 } // Set newcap to the requested cap when \t// the newcap calculation overflowed. \tif newcap \u0026lt;= 0 { newcap = cap } } } // å¯¹åˆ‡ç‰‡è¿›è¡Œå†…å­˜å¯¹é½ï¼Œå¯èƒ½ä¼šè°ƒæ•´åˆ‡ç‰‡å®¹é‡å¤§å°  // ...  return slice{p, old.len, newcap} } è¿›è¡Œçš„è°ƒæ•´ï¼š\n å¢åŠ äº†threshold = 256 å¢é•¿ç­–ç•¥ä¸åŒçš„é˜ˆå€¼ä»1024å˜ä¸º256 å½“åˆ‡ç‰‡å®¹é‡å¤§äºé˜ˆå€¼æ—¶ï¼Œå¢é•¿ç­–ç•¥å˜åŒ–  åŸæ¥çš„é—®é¢˜ï¼š\n å¢é•¿ä¸å¹³æ»‘  x1 := make([]int, 897) x2 := make([]int, 1024) y := make([]int, 100) println(cap(append(x1, y...))) // 1360 println(cap(append(x2, y...))) // 1536 å¢é•¿ä¸å¯¹ç§°  x := make([]int, 98) y := make([]int, 666) println(cap(append(x, y...))) // 768 println(cap(append(y, x...))) // 1024 å¢é•¿ä¸å¹³æ»‘çš„é—®é¢˜å¾—åˆ°äº†è¾ƒå¥½çš„è§£å†³ï¼ŒåŒæ—¶ä¸å¯¹ç§°çš„é—®é¢˜ä¹Ÿå¾—åˆ°äº†ç¼“è§£ã€‚\n","permalink":"http://yangchnet.github.io/Dessert/posts/golang/%E5%88%87%E7%89%87append%E8%A7%84%E5%88%99/","summary":"å¤§çº¦2021å¹´8æœˆä»½ï¼Œgoç¤¾åŒºå¯¹åˆ‡ç‰‡å®¹é‡å¢é•¿çš„æ–¹å¼è¿›è¡Œäº†ä¸€æ¬¡è°ƒæ•´ã€‚å…·ä½“è®¨è®ºå¯è§ï¼šhttps://groups.google.com/g/golang-nuts/c/UaVlMQ8Nz3o\n 1. ä¹‹å‰çš„å¢é•¿è§„åˆ™ å…ˆçœ‹æºç \n runtime/slice.go\n func growslice(et *_type, old slice, cap int) slice { // çœç•¥éƒ¨åˆ†æ¡ä»¶æ£€æŸ¥  // ...  newcap := old.cap doublecap := newcap + newcap if cap \u0026gt; doublecap { newcap = cap } else { if old.cap \u0026lt; 1024 { newcap = doublecap } else { // Check 0 \u0026lt; newcap to detect overflow \t// and prevent an infinite loop. \tfor 0 \u0026lt; newcap \u0026amp;\u0026amp; newcap \u0026lt; cap { newcap += newcap / 4 } // Set newcap to the requested cap when \t// the newcap calculation overflowed.","title":"åˆ‡ç‰‡appendè§„åˆ™"},{"content":"åå°„æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼š\ntype Type interface { // è¿”å›å…·ä½“ç±»å‹åœ¨å†…å­˜åˆ†é…æ—¶çš„å­—èŠ‚åˆ†é…æ–¹å¼ \tAlign() int // è¿”å›å…·ä½“ç±»å‹åœ¨ç»“æ„ä½“ä¸­ä½œä¸ºä¸€ä¸ªå­—æ®µæ˜¯å†…å­˜å¯¹é½æ–¹å¼ \tFieldAlign() int // è¿”å›å…·ä½“ç±»å‹çš„ç¬¬xä¸ªæ–¹æ³• \tMethod(int) Method // æ ¹æ®å‡½æ•°åè¿”å›å…·ä½“ç±»å‹çš„æ–¹æ³• \tMethodByName(string) (Method, bool) // è¿”å›ç±»å‹çš„æ–¹æ³•ä¸ªæ•° \tNumMethod() int // è¿”å›ç±»å‹çš„åå­— \tName() string // è¿”å›ç±»å‹çš„åŒ…å \tPkgPath() string // è¿”å›ç±»å‹æ‰€å å†…å­˜å­—èŠ‚å¤§å° \tSize() uintptr // è¿”å›ç±»å‹çš„ç®€å•æè¿°ï¼Œå¦‚ï¼šmain.User \tString() string // è¿”å›è¿™ä¸ªç±»å‹çš„Kind \tKind() Kind // æ£€æŸ¥ç±»å‹æ˜¯å¦å®ç°äº†æŸä¸ªæ¥å£ \t//stringer := reflect.TypeOf((*fmt.Stringer)(nil)).Elem() \t//fmt.Println(reflect.ValueOf(u).Type().Implements(stringer)) \tImplements(u Type) bool // æ£€æŸ¥ç±»å‹æ˜¯å¦å¯ä»¥è¢«èµ‹å€¼ç»™æŸä¸ªç±»å‹ \tAssignableTo(u Type) bool // æ£€æŸ¥ç±»å‹æ˜¯å¦å¯ä»¥è½¬æ¢åˆ°ç±»å‹u \tConvertibleTo(u Type) bool // æ£€æŸ¥ç±»å‹æ˜¯å¦å¯æ¯”è¾ƒ \tComparable() bool // è¿”å›Int, Uint, Float, or Complex kinds.çš„å­—èŠ‚å¤§å° \tBits() int // è¿”å›ä¸€ä¸ªé€šé“ç±»å‹çš„æ–¹å‘ \tChanDir() ChanDir // åˆ¤æ–­ä¸€ä¸ªå‡½æ•°ç±»å‹çš„æœ€åä¸€ä¸ªå‚æ•°æ˜¯å¦æ˜¯\u0026#34;...\u0026#34;å‚æ•° \tIsVariadic() bool // è¿”å›Array, Chan, Map, Ptr, or Sliceç±»å‹çš„å…ƒç´ çš„ç±»å‹ \tElem() Type // è¿”å›ç»“æ„ä½“çš„ç¬¬iä¸ªå­—æ®µçš„è¯¦ç»†ä¿¡æ¯ \tField(i int) StructField // è¿”å›ç»“æ„ä½“å†…çš„åµŒå¥—ç»“æ„ä½“ \tFieldByIndex(index []int) StructField // æ ¹æ®åå­—è¿”å›ç»“æ„ä½“å†…çš„æŸä¸ªå­—æ®µ \tFieldByName(name string) (StructField, bool) // æ ¹æ®matchå‡½æ•°çš„è¿”å›å€¼è¿”å›ç»“æ„ä½“å†…æŸä¸ªå­—æ®µ \tFieldByNameFunc(match func(string) bool) (StructField, bool) // è¿”å›å‡½æ•°çš„ç¬¬iä¸ªå‚æ•°ç±»å‹ \tIn(i int) Type // è¿”å›mapçš„é”®çš„ç±»å‹ \tKey() Type // è¿”å›æ•°ç»„çš„é•¿åº¦ \tLen() int // è¿”å›ç»“æ„ä½“çš„å­—æ®µä¸ªæ•° \tNumField() int // è¿”å›å‚æ•°çš„å…¥å‚ä¸ªæ•° \tNumIn() int // è¿”å›å‡½æ•°çš„è¿”å›å€¼ä¸ªæ•° \tNumOut() int // è¿”å›å‡½æ•°ç¬¬iä¸ªè¿”å›å€¼çš„ç±»å‹ \tOut(i int) Type common() *rtype uncommon() *uncommonType } ä»æ¥å£å®šä¹‰ä¸­æˆ‘ä»¬å¯ä»¥çŸ¥é“:\nå¯¹äºæ‰€æœ‰çš„ç±»å‹ï¼š\n å­—èŠ‚å¯¹é½æ–¹å¼  å…·ä½“ç±»å‹åœ¨å†…å­˜åˆ†é…æ—¶çš„å­—èŠ‚åˆ†é…æ–¹å¼ è¿”å›å…·ä½“ç±»å‹åœ¨ç»“æ„ä½“ä¸­ä½œä¸ºä¸€ä¸ªå­—æ®µæ˜¯å†…å­˜å¯¹é½æ–¹å¼   æ–¹æ³•  å…·ä½“ç±»å‹çš„ç¬¬xä¸ªæ–¹æ³• æ ¹æ®å‡½æ•°åè·å–å…·ä½“ç±»å‹çš„æ–¹æ³• æ£€æŸ¥ç±»å‹æ˜¯å¦å®ç°äº†æŸä¸ªæ¥å£   åŸºæœ¬ä¿¡æ¯  æ–¹æ³•ä¸ªæ•° ç±»å‹å ç±»å‹åŒ…å ç±»å‹æ‰€å å­—èŠ‚å¤§å° ç±»å‹çš„ç®€å•æè¿°ï¼ˆå¦‚main.Userï¼‰   è·å–ç±»å‹çš„Kind  å…³äºç±»å‹è½¬æ¢ï¼š\n æ£€æŸ¥ç±»å‹æ˜¯å¦å®ç°äº†æŸä¸ªæ¥å£ æ£€æŸ¥ç±»å‹æ˜¯å¦å¯ä»¥è¢«èµ‹å€¼ç»™æŸä¸ªç±»å‹ æ£€æŸ¥ç±»å‹æ˜¯å¦å¯ä»¥è½¬æ¢åˆ°ç±»å‹u  å¯¹äºé€šé“:\n è·å–é€šé“çš„æ–¹å‘ è·å–é€šé“å†…å…ƒç´ çš„ç±»å‹  å¯¹äºå‡½æ•°ï¼š\n æ£€æŸ¥å…¶æœ€åä¸€ä¸ªå‚æ•°æ˜¯å¦æ˜¯...Typeç±»å‹ è·å–å‡½æ•°çš„å…¥å‚ã€è¿”å›å‡½æ•°çš„è¿”å›å€¼ä¸ªæ•° æ ¹æ®ä¸‹æ ‡è·å–å‡½æ•°å…¥å‚ã€è¿”å›å€¼çš„ç±»å‹  å¯¹äºç»“æ„ä½“ï¼š\n è·å–ç»“æ„ä½“çš„ç¬¬iä¸ªå­—æ®µçš„è¯¦ç»†ä¿¡æ¯ è·å–ç»“æ„ä½“å†…çš„åµŒå¥—ç»“æ„ä½“ æ ¹æ®åå­—è·å–ç»“æ„ä½“å†…çš„æŸä¸ªå­—æ®µ æ ¹æ®matchå‡½æ•°çš„è¿”å›å€¼è·å–ç»“æ„ä½“å†…æŸä¸ªå­—æ®µ  å¯¹äºmap:\n è·å–mapçš„é”®çš„ç±»å‹  å¯¹äºArray:\n è·å–Arrayçš„é•¿åº¦  å…¶ä»–:\n æ£€æŸ¥ç±»å‹æ˜¯å¦å¯æ¯”è¾ƒ  ","permalink":"http://yangchnet.github.io/Dessert/posts/golang/%E7%90%86%E8%A7%A3%E5%8F%8D%E5%B0%84%E4%B9%8B%E4%B8%80%E4%B8%AAreflect.type%E5%8F%AF%E4%BB%A5%E5%81%9A%E4%BB%80%E4%B9%88/","summary":"åå°„æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼š\ntype Type interface { // è¿”å›å…·ä½“ç±»å‹åœ¨å†…å­˜åˆ†é…æ—¶çš„å­—èŠ‚åˆ†é…æ–¹å¼ \tAlign() int // è¿”å›å…·ä½“ç±»å‹åœ¨ç»“æ„ä½“ä¸­ä½œä¸ºä¸€ä¸ªå­—æ®µæ˜¯å†…å­˜å¯¹é½æ–¹å¼ \tFieldAlign() int // è¿”å›å…·ä½“ç±»å‹çš„ç¬¬xä¸ªæ–¹æ³• \tMethod(int) Method // æ ¹æ®å‡½æ•°åè¿”å›å…·ä½“ç±»å‹çš„æ–¹æ³• \tMethodByName(string) (Method, bool) // è¿”å›ç±»å‹çš„æ–¹æ³•ä¸ªæ•° \tNumMethod() int // è¿”å›ç±»å‹çš„åå­— \tName() string // è¿”å›ç±»å‹çš„åŒ…å \tPkgPath() string // è¿”å›ç±»å‹æ‰€å å†…å­˜å­—èŠ‚å¤§å° \tSize() uintptr // è¿”å›ç±»å‹çš„ç®€å•æè¿°ï¼Œå¦‚ï¼šmain.User \tString() string // è¿”å›è¿™ä¸ªç±»å‹çš„Kind \tKind() Kind // æ£€æŸ¥ç±»å‹æ˜¯å¦å®ç°äº†æŸä¸ªæ¥å£ \t//stringer := reflect.TypeOf((*fmt.Stringer)(nil)).Elem() \t//fmt.Println(reflect.ValueOf(u).Type().Implements(stringer)) \tImplements(u Type) bool // æ£€æŸ¥ç±»å‹æ˜¯å¦å¯ä»¥è¢«èµ‹å€¼ç»™æŸä¸ªç±»å‹ \tAssignableTo(u Type) bool // æ£€æŸ¥ç±»å‹æ˜¯å¦å¯ä»¥è½¬æ¢åˆ°ç±»å‹u \tConvertibleTo(u Type) bool // æ£€æŸ¥ç±»å‹æ˜¯å¦å¯æ¯”è¾ƒ \tComparable() bool // è¿”å›Int, Uint, Float, or Complex kinds.","title":"ç†è§£åå°„ä¹‹ï¼šä¸€ä¸ªreflect.Typeå¯ä»¥åšä»€ä¹ˆ"},{"content":" rangeå¾ªç¯æ—¶ï¼Œä½¿ç”¨çš„æ˜¯è¢«è¿­ä»£çš„å…ƒç´ çš„å‰¯æœ¬  type T struct { n int } func main() { ts := [2]T{} for i, t := range ts { switch i { case 0: t.n = 3 // è¢«è®¿é—®çš„æ˜¯tsçš„å‰¯æœ¬  ts[1].n = 9 case 1: fmt.Print(t.n, \u0026#34; \u0026#34;) } } fmt.Print(ts) } è¾“å‡ºï¼š0 {{0} {9}} range å¾ªç¯è¯­å¥ä½¿ç”¨çš„ä¸´æ—¶å˜é‡  func main() { h := make([]*int, 3) u := []int{1, 2, 3} for i, v := range u { h[i] = \u0026amp;v } for i := range h { fmt.Println(*h[i]) } } è¾“å‡ºï¼š 3 3 3 ","permalink":"http://yangchnet.github.io/Dessert/posts/golang/for...range%E8%A6%81%E7%82%B9/","summary":"rangeå¾ªç¯æ—¶ï¼Œä½¿ç”¨çš„æ˜¯è¢«è¿­ä»£çš„å…ƒç´ çš„å‰¯æœ¬  type T struct { n int } func main() { ts := [2]T{} for i, t := range ts { switch i { case 0: t.n = 3 // è¢«è®¿é—®çš„æ˜¯tsçš„å‰¯æœ¬  ts[1].n = 9 case 1: fmt.Print(t.n, \u0026#34; \u0026#34;) } } fmt.Print(ts) } è¾“å‡ºï¼š0 {{0} {9}} range å¾ªç¯è¯­å¥ä½¿ç”¨çš„ä¸´æ—¶å˜é‡  func main() { h := make([]*int, 3) u := []int{1, 2, 3} for i, v := range u { h[i] = \u0026amp;v } for i := range h { fmt.","title":"for...rangeè¦ç‚¹"},{"content":"1. Goä¸­å¯¹æŒ‡é’ˆçš„é™åˆ¶  Go çš„æŒ‡é’ˆä¸èƒ½è¿›è¡Œæ•°å­¦è¿ç®—ã€‚ ä¸åŒç±»å‹çš„æŒ‡é’ˆä¸èƒ½ç›¸äº’è½¬æ¢ã€‚ ä¸åŒç±»å‹çš„æŒ‡é’ˆä¸èƒ½ä½¿ç”¨ == æˆ– != æ¯”è¾ƒã€‚åªæœ‰åœ¨ä¸¤ä¸ªæŒ‡é’ˆç±»å‹ç›¸åŒæˆ–è€…å¯ä»¥ç›¸äº’è½¬æ¢çš„æƒ…å†µä¸‹ï¼Œæ‰å¯ä»¥å¯¹ä¸¤è€…è¿›è¡Œæ¯”è¾ƒã€‚å¦å¤–ï¼ŒæŒ‡é’ˆå¯ä»¥é€šè¿‡ == å’Œ != ç›´æ¥å’Œ nil ä½œæ¯”è¾ƒã€‚ ä¸åŒç±»å‹çš„æŒ‡é’ˆå˜é‡ä¸èƒ½ç›¸äº’èµ‹å€¼ã€‚  ä½¿ç”¨unsafeåŒ…ï¼Œå¯ä»¥ä¸€å®šç¨‹åº¦ä¸Šæ‰“ç ´è¿™äº›é™åˆ¶ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆè¦æ‰“ç ´è¿™äº›é™åˆ¶ã€‚è¯·çœ‹ä¸‹æ–‡ã€‚\n2. unsafe.Pointer unsafe.Pointerçš„å®šä¹‰\ntype ArbitraryType int type Pointer *ArbitraryType unsafe åŒ…æä¾›äº† 2 ç‚¹é‡è¦çš„èƒ½åŠ›ï¼š\n ä»»ä½•ç±»å‹çš„æŒ‡é’ˆå’Œ unsafe.Pointer å¯ä»¥ç›¸äº’è½¬æ¢ã€‚ uintptr ç±»å‹å’Œ unsafe.Pointer å¯ä»¥ç›¸äº’è½¬æ¢ã€‚  pointer ä¸èƒ½ç›´æ¥è¿›è¡Œæ•°å­¦è¿ç®—ï¼Œä½†å¯ä»¥æŠŠå®ƒè½¬æ¢æˆ uintptrï¼Œå¯¹ uintptr ç±»å‹è¿›è¡Œæ•°å­¦è¿ç®—ï¼Œå†è½¬æ¢æˆ pointer ç±»å‹ã€‚åˆ©ç”¨è¿™ä¸¤ä¸ªå¯¹è±¡çš„ç›¸äº’è½¬æ¢ï¼Œå°±å¯ä»¥æ‰“ç ´ä¸Šè¿°4ä¸ªé™åˆ¶ã€‚\n// uintptr æ˜¯ä¸€ä¸ªæ•´æ•°ç±»å‹ï¼Œå®ƒè¶³å¤Ÿå¤§ï¼Œå¯ä»¥å­˜å‚¨ type uintptr uintptr è¿˜æœ‰ä¸€ç‚¹è¦æ³¨æ„çš„æ˜¯ï¼Œuintptr å¹¶æ²¡æœ‰æŒ‡é’ˆçš„è¯­ä¹‰ï¼Œæ„æ€å°±æ˜¯ uintptr æ‰€æŒ‡å‘çš„å¯¹è±¡ä¼šè¢« gc æ— æƒ…åœ°å›æ”¶.è€Œ unsafe.Pointer æœ‰æŒ‡é’ˆè¯­ä¹‰ï¼Œå¯ä»¥ä¿æŠ¤å®ƒæ‰€æŒ‡å‘çš„å¯¹è±¡åœ¨â€œæœ‰ç”¨â€çš„æ—¶å€™ä¸ä¼šè¢«åƒåœ¾å›æ”¶ã€‚\n3. åˆ©ç”¨unsafeè·å–sliceå’Œmapçš„é•¿åº¦ sliceå’Œmapçš„é•¿åº¦éƒ½å­˜å‚¨åœ¨å…¶å†…éƒ¨å˜é‡ä¸­ï¼Œå› æ­¤æˆ‘ä»¬å…ˆæ¥çœ‹è¿™ä¸¤ä¸ªç»“æ„ä½“å®šä¹‰ï¼š\n// runtime/slice.go type slice struct { array unsafe.Pointer // å…ƒç´ æŒ‡é’ˆ  len int // é•¿åº¦  cap int // å®¹é‡ } è°ƒç”¨ make å‡½æ•°æ–°å»ºä¸€ä¸ª sliceï¼Œåº•å±‚è°ƒç”¨çš„æ˜¯ makeslice å‡½æ•°ï¼Œè¿”å›çš„æ˜¯ slice ç»“æ„ä½“ï¼š\nfunc makeslice(et *_type, len, cap int) slice å› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡ unsafe.Pointer å’Œ uintptr è¿›è¡Œè½¬æ¢ï¼Œå¾—åˆ° slice çš„å­—æ®µå€¼ã€‚\nfunc main() { s := make([]int, 9, 20) // Len: \u0026amp;s =\u0026gt; pointer =\u0026gt; uintptr =\u0026gt; pointer =\u0026gt; *int =\u0026gt; int \tvar Len = *(*int)(unsafe.Pointer(uintptr(unsafe.Pointer(\u0026amp;s)) + uintptr(8))) fmt.Println(Len, len(s)) // 9 9  // Cap: \u0026amp;s =\u0026gt; pointer =\u0026gt; uintptr =\u0026gt; pointer =\u0026gt; *int =\u0026gt; int \tvar Cap = *(*int)(unsafe.Pointer(uintptr(unsafe.Pointer(\u0026amp;s)) + uintptr(16))) fmt.Println(Cap, cap(s)) // 20 20 } æ€»ä½“æ€è·¯æ˜¯ï¼Œå…ˆå¯¹ç»“æ„ä½“å–æŒ‡é’ˆï¼Œå†è½¬æ¢æˆunsafe.Pointerï¼Œå†è½¬æ¢æˆuintptr,ç„¶ååšåŠ æ³•ä½¿æŒ‡é’ˆåç§»ï¼Œç„¶åé‡æ–°è½¬æ¢ä¸ºunsafe.Pointer,å†è½¬æ¢æˆï¼ˆ*intï¼‰ç±»å‹ï¼Œæœ€åå–å¼•ç”¨ï¼Œå¾—åˆ°å€¼ã€‚å¯ä»¥çœ‹å‡ºï¼Œå…¶ä¸­çš„é‡ç‚¹åœ¨äºè®¡ç®—åç§»é‡ã€‚\nå¯¹äºmap\ntype hmap struct { count int flags uint8 B uint8 noverflow uint16 hash0 uint32 buckets unsafe.Pointer oldbuckets unsafe.Pointer nevacuate uintptr extra *mapextra } å’Œ slice ä¸åŒçš„æ˜¯ï¼Œmakemap å‡½æ•°è¿”å›çš„æ˜¯ hmap çš„æŒ‡é’ˆï¼Œæ³¨æ„æ˜¯æŒ‡é’ˆï¼š\nfunc makemap(t *maptype, hint int64, h *hmap, bucket unsafe.Pointer) *hmap æˆ‘ä»¬ä¾ç„¶èƒ½é€šè¿‡ unsafe.Pointer å’Œ uintptr è¿›è¡Œè½¬æ¢ï¼Œå¾—åˆ° hamp å­—æ®µçš„å€¼ï¼Œåªä¸è¿‡ï¼Œç°åœ¨ count å˜æˆäºŒçº§æŒ‡é’ˆäº†ï¼š\nfunc main() { mp := make(map[string]int) mp[\u0026#34;q\u0026#34;] = 100 mp[\u0026#34;s\u0026#34;] = 18 // \u0026amp;mp =\u0026gt; pointer =\u0026gt; **int =\u0026gt; int \tcount := **(**int)(unsafe.Pointer(\u0026amp;mp)) fmt.Println(count, len(mp)) // 2 2 } 4. ä¿®æ”¹ç§æœ‰æˆå‘˜ æ€»ä½“æ€è·¯æ˜¯ï¼šé€šè¿‡ offset å‡½æ•°è·å–ç»“æ„ä½“æˆå‘˜çš„åç§»é‡ï¼Œè¿›è€Œè·å–æˆå‘˜çš„åœ°å€ï¼Œè¯»å†™è¯¥åœ°å€çš„å†…å­˜ï¼Œå°±å¯ä»¥è¾¾åˆ°æ”¹å˜æˆå‘˜å€¼çš„ç›®çš„ã€‚\nè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼šç»“æ„ä½“ä¼šè¢«åˆ†é…ä¸€å—è¿ç»­çš„å†…å­˜ï¼Œç»“æ„ä½“çš„åœ°å€ä¹Ÿä»£è¡¨äº†ç¬¬ä¸€ä¸ªæˆå‘˜çš„åœ°å€ã€‚\npackage main import ( \u0026#34;fmt\u0026#34; \u0026#34;unsafe\u0026#34; ) type Programmer struct { name string language string } func main() { p := Programmer{\u0026#34;a\u0026#34;, \u0026#34;go\u0026#34;} fmt.Println(p) name := (*string)(unsafe.Pointer(\u0026amp;p)) *name = \u0026#34;b\u0026#34; lang := (*string)(unsafe.Pointer(uintptr(unsafe.Pointer(\u0026amp;p)) + unsafe.Offsetof(p.language))) // lang := (*string)(unsafe.Pointer(uintptr(unsafe.Pointer(\u0026amp;p)) + unsafe.Sizeof(string(\u0026#34;\u0026#34;)))) \t*lang = \u0026#34;Golang\u0026#34; fmt.Println(p) } 5. å­—ç¬¦ä¸²å’Œbyteåˆ‡ç‰‡çš„é›¶æ‹·è´è½¬æ¢ stringå’Œbyteåˆ‡ç‰‡çš„å†…éƒ¨ç»“æ„å¦‚ä¸‹ï¼š\ntype StringHeader struct { Data uintptr Len int } type SliceHeader struct { Data uintptr Len int Cap int } è½¬æ¢ï¼š\nfunc string2bytes(s string) []byte { return *(*[]byte)(unsafe.Pointer(\u0026amp;s)) } func bytes2string(b []byte) string{ return *(*string)(unsafe.Pointer(\u0026amp;b)) } ä½†è¿™æ ·è½¬æ¢ä¼šå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå­—ç¬¦ä¸²è¢«è½¬æ¢ä¸ºåˆ‡ç‰‡åï¼Œåˆ‡ç‰‡çš„capæ— æ³•å‡†ç¡®å¾—å‡ºã€‚\nReferences https://golang.design/go-questions/stdlib/unsafe/zero-conv/\n","permalink":"http://yangchnet.github.io/Dessert/posts/golang/%E6%A0%87%E5%87%86%E5%BA%93%E4%B9%8Bunsafe/","summary":"1. Goä¸­å¯¹æŒ‡é’ˆçš„é™åˆ¶  Go çš„æŒ‡é’ˆä¸èƒ½è¿›è¡Œæ•°å­¦è¿ç®—ã€‚ ä¸åŒç±»å‹çš„æŒ‡é’ˆä¸èƒ½ç›¸äº’è½¬æ¢ã€‚ ä¸åŒç±»å‹çš„æŒ‡é’ˆä¸èƒ½ä½¿ç”¨ == æˆ– != æ¯”è¾ƒã€‚åªæœ‰åœ¨ä¸¤ä¸ªæŒ‡é’ˆç±»å‹ç›¸åŒæˆ–è€…å¯ä»¥ç›¸äº’è½¬æ¢çš„æƒ…å†µä¸‹ï¼Œæ‰å¯ä»¥å¯¹ä¸¤è€…è¿›è¡Œæ¯”è¾ƒã€‚å¦å¤–ï¼ŒæŒ‡é’ˆå¯ä»¥é€šè¿‡ == å’Œ != ç›´æ¥å’Œ nil ä½œæ¯”è¾ƒã€‚ ä¸åŒç±»å‹çš„æŒ‡é’ˆå˜é‡ä¸èƒ½ç›¸äº’èµ‹å€¼ã€‚  ä½¿ç”¨unsafeåŒ…ï¼Œå¯ä»¥ä¸€å®šç¨‹åº¦ä¸Šæ‰“ç ´è¿™äº›é™åˆ¶ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆè¦æ‰“ç ´è¿™äº›é™åˆ¶ã€‚è¯·çœ‹ä¸‹æ–‡ã€‚\n2. unsafe.Pointer unsafe.Pointerçš„å®šä¹‰\ntype ArbitraryType int type Pointer *ArbitraryType unsafe åŒ…æä¾›äº† 2 ç‚¹é‡è¦çš„èƒ½åŠ›ï¼š\n ä»»ä½•ç±»å‹çš„æŒ‡é’ˆå’Œ unsafe.Pointer å¯ä»¥ç›¸äº’è½¬æ¢ã€‚ uintptr ç±»å‹å’Œ unsafe.Pointer å¯ä»¥ç›¸äº’è½¬æ¢ã€‚  pointer ä¸èƒ½ç›´æ¥è¿›è¡Œæ•°å­¦è¿ç®—ï¼Œä½†å¯ä»¥æŠŠå®ƒè½¬æ¢æˆ uintptrï¼Œå¯¹ uintptr ç±»å‹è¿›è¡Œæ•°å­¦è¿ç®—ï¼Œå†è½¬æ¢æˆ pointer ç±»å‹ã€‚åˆ©ç”¨è¿™ä¸¤ä¸ªå¯¹è±¡çš„ç›¸äº’è½¬æ¢ï¼Œå°±å¯ä»¥æ‰“ç ´ä¸Šè¿°4ä¸ªé™åˆ¶ã€‚\n// uintptr æ˜¯ä¸€ä¸ªæ•´æ•°ç±»å‹ï¼Œå®ƒè¶³å¤Ÿå¤§ï¼Œå¯ä»¥å­˜å‚¨ type uintptr uintptr è¿˜æœ‰ä¸€ç‚¹è¦æ³¨æ„çš„æ˜¯ï¼Œuintptr å¹¶æ²¡æœ‰æŒ‡é’ˆçš„è¯­ä¹‰ï¼Œæ„æ€å°±æ˜¯ uintptr æ‰€æŒ‡å‘çš„å¯¹è±¡ä¼šè¢« gc æ— æƒ…åœ°å›æ”¶.è€Œ unsafe.Pointer æœ‰æŒ‡é’ˆè¯­ä¹‰ï¼Œå¯ä»¥ä¿æŠ¤å®ƒæ‰€æŒ‡å‘çš„å¯¹è±¡åœ¨â€œæœ‰ç”¨â€çš„æ—¶å€™ä¸ä¼šè¢«åƒåœ¾å›æ”¶ã€‚\n3. åˆ©ç”¨unsafeè·å–sliceå’Œmapçš„é•¿åº¦ sliceå’Œmapçš„é•¿åº¦éƒ½å­˜å‚¨åœ¨å…¶å†…éƒ¨å˜é‡ä¸­ï¼Œå› æ­¤æˆ‘ä»¬å…ˆæ¥çœ‹è¿™ä¸¤ä¸ªç»“æ„ä½“å®šä¹‰ï¼š\n// runtime/slice.go type slice struct { array unsafe.","title":"æ ‡å‡†åº“ä¹‹unsafe"},{"content":"1. ç®€ä»‹ golangci-lint æ˜¯å¯¹golangè¿›è¡Œé™æ€ä»£ç æ£€æŸ¥çš„å·¥å…·ã€‚å…¶å…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š\n é€Ÿåº¦éå¸¸å¿«ï¼šgolangci-lint æ˜¯åŸºäº gometalinter å¼€å‘çš„ï¼Œä½†æ˜¯å¹³å‡é€Ÿåº¦è¦æ¯” gometalinter å¿« 5 å€ã€‚golangci-lint é€Ÿåº¦å¿«çš„åŸå› æœ‰ä¸‰ä¸ªï¼šå¯ä»¥å¹¶è¡Œæ£€æŸ¥ä»£ç ï¼›å¯ä»¥å¤ç”¨ go build ç¼“å­˜ï¼›ä¼šç¼“å­˜åˆ†æç»“æœã€‚ å¯é…ç½®ï¼šæ”¯æŒ YAML æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼Œè®©æ£€æŸ¥æ›´çµæ´»ï¼Œæ›´å¯æ§ã€‚ IDE é›†æˆï¼šå¯ä»¥é›†æˆè¿›å¤šä¸ªä¸»æµçš„ IDEï¼Œä¾‹å¦‚ VS Codeã€GNU Emacsã€Sublime Textã€Goland ç­‰ã€‚ linter èšåˆå™¨ï¼š1.41.1 ç‰ˆæœ¬çš„ golangci-lint é›†æˆäº† 76 ä¸ª linterï¼Œä¸éœ€è¦å†å•ç‹¬å®‰è£…è¿™ 76 ä¸ª linterã€‚å¹¶ä¸” golangci-lint è¿˜æ”¯æŒè‡ªå®šä¹‰ linterã€‚ æœ€å°çš„è¯¯æŠ¥æ•°ï¼šgolangci-lint è°ƒæ•´äº†æ‰€é›†æˆ linter çš„é»˜è®¤è®¾ç½®ï¼Œå¤§å¹…åº¦å‡å°‘äº†è¯¯æŠ¥ã€‚ è‰¯å¥½çš„è¾“å‡ºï¼šè¾“å‡ºçš„ç»“æœå¸¦æœ‰é¢œè‰²ã€ä»£ç è¡Œå·å’Œ linter æ ‡è¯†ï¼Œæ˜“äºæŸ¥çœ‹å’Œå®šä½ã€‚  2. å®‰è£… # å®‰è£… go get github.com/golangci/golangci-lint/cmd/golangci-lint@v1.41.1 # æ£€æŸ¥æ˜¯å¦å®‰è£…æˆåŠŸ golangci-lint version # è¾“å‡º golangci-lint ç‰ˆæœ¬å·ï¼Œè¯´æ˜å®‰è£…æˆåŠŸ golangci-lint has version v1.44.0 built from (unknown, mod sum: \u0026#34;h1:YJPouGNQEdK+x2KsCpWMIBy0q6MSuxHjkWMxJMNj/DU=\u0026#34;) on (unknown) 3. åŸºæœ¬ä½¿ç”¨ å¯¹é¡¹ç›®åšé™æ€æ£€æŸ¥ï¼Œéå¸¸ç®€å•, åœ¨é¡¹ç›®è·Ÿç›®å½•ï¼š\ngolangci-lint run ç­‰åŒäº\ngolangci-lint run ./... æŒ‡å®šæ£€æŸ¥ç›®å½•ï¼š\ngolangci-lint run dir1 dir2/... dir3/file1.go è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œgolangci-lintä¸ä¼šé€’å½’æ£€æŸ¥ç›®å½•ä¸‹çš„å­ç›®å½•ï¼Œè¦æƒ³é€’å½’æ£€æŸ¥ï¼Œå¯ä½¿ç”¨dir/...\n4. linter golangci-linté¢„å®šä¹‰äº†ä¸€äº›æ£€æŸ¥è§„åˆ™, ç§°ä¸ºlinter\ngolangci-lint help linters Enabled by default linters: deadcode: Finds unused code [fast: false, auto-fix: false] errcheck: Errcheck is a program for checking for unchecked errors in go programs. These unchecked errors can be critical bugs in some cases [fast: false, auto-fix: false] gosimple (megacheck): Linter for Go source code that specializes in simplifying a code [fast: false, auto-fix: false] govet (vet, vetshadow): Vet examines Go source code and reports suspicious constructs, such as Printf calls whose arguments do not align with the format string [fast: false, auto-fix: false] ineffassign: Detects when assignments to existing variables are not used [fast: true, auto-fix: false] staticcheck (megacheck): Staticcheck is a go vet on steroids, applying a ton of static analysis checks [fast: false, auto-fix: false] structcheck: Finds unused struct fields [fast: false, auto-fix: false] ... ä½ å¯ä»¥é€‰æ‹©åªä½¿ç”¨æŸäº›linter(ä½¿ç”¨-E/--enable)æˆ–ä¸ä½¿ç”¨æŸäº›linter(ä½¿ç”¨-D/--disable)\nä½ è¿˜å¯ä»¥å¯¹è¿™äº›linterè¿›è¡Œæ›´ç»†ç²’åº¦çš„é…ç½®ï¼Œä¾‹å¦‚ï¼š\nlinters-settings: bidichk: # The following configurations check for all mentioned invisible unicode runes. # All runes are enabled by default. left-to-right-embedding: false right-to-left-embedding: false pop-directional-formatting: false left-to-right-override: false right-to-left-override: false left-to-right-isolate: false right-to-left-isolate: false first-strong-isolate: false pop-directional-isolate: false è®¿é—®https://golangci-lint.run/usage/linters/#errorlintæŸ¥çœ‹æ›´å¤šç¤ºä¾‹\n5. é…ç½® é…ç½®æ–‡ä»¶çš„ä¼˜å…ˆçº§ä½äºå‘½ä»¤è¡Œé…ç½®ï¼Œä½¿ç”¨æ–‡ä»¶é…ç½®åå†æ¬¡åœ¨å‘½ä»¤è¡Œä¸­æŒ‡å®šé…ç½®ï¼Œåˆ™å‘½ä»¤è¡Œä¸­æŒ‡å®šçš„é…ç½®å°†è¦†ç›–æ–‡ä»¶ä¸­çš„é…ç½®ã€‚\né…ç½®æ–‡ä»¶åç§°ï¼š\n .golangci.yml .golangci.yaml .golangci.toml .golangci.json  å¯ç”¨çš„è®¾ç½®å¦‚ä¸‹ï¼š\n# Options for analysis running. run: # See the dedicated \u0026#34;run\u0026#34; documentation section. option: value # output configuration options output: # See the dedicated \u0026#34;output\u0026#34; documentation section. option: value # All available settings of specific linters. linters-settings: # See the dedicated \u0026#34;linters-settings\u0026#34; documentation section. option: value linters: # See the dedicated \u0026#34;linters\u0026#34; documentation section. option: value issues: # See the dedicated \u0026#34;issues\u0026#34; documentation section. option: value severity: # See the dedicated \u0026#34;severity\u0026#34; documentation section. option: value å…·ä½“è®¾ç½®å¯æŸ¥çœ‹æ–‡æ¡£https://golangci-lint.run/usage/configuration\n6. å¯¹æŸäº›ä»£ç å¿½ç•¥æ£€æŸ¥  å¿½ç•¥æŸä¸€è¡Œçš„æ£€æŸ¥  var bad_name int //nolint å¿½ç•¥æŸä¸€è¡ŒæŒ‡å®š linter çš„æ£€æŸ¥ï¼Œå¯ä»¥æŒ‡å®šå¤šä¸ª linterï¼Œç”¨é€—å· , éš”å¼€  var bad_name int //nolint:golint,unused å¿½ç•¥æŸä¸ªä»£ç å—çš„æ£€æŸ¥  //nolint func allIssuesInThisFunctionAreExcluded() *string { // ... } //nolint:govet var ( a int b int ) å¿½ç•¥æŸä¸ªæ–‡ä»¶çš„æŒ‡å®šlinteræ£€æŸ¥ åœ¨ package xx ä¸Šé¢ä¸€è¡Œæ·»åŠ //nolintæ³¨é‡Šã€‚  //nolint:unparam package pkg ... åœ¨ä½¿ç”¨ nolint çš„è¿‡ç¨‹ä¸­ï¼Œæœ‰ 3 ä¸ªåœ°æ–¹éœ€è¦ä½ æ³¨æ„ã€‚\né¦–å…ˆï¼Œå¦‚æœå¯ç”¨äº† nolintlintï¼Œä½ å°±éœ€è¦åœ¨//nolintåé¢æ·»åŠ  nolint çš„åŸå› // xxxxã€‚\nå…¶æ¬¡ï¼Œä½ ä½¿ç”¨çš„åº”è¯¥æ˜¯//nolintè€Œä¸æ˜¯// nolintã€‚å› ä¸ºæ ¹æ® Go çš„è§„èŒƒï¼Œéœ€è¦ç¨‹åºè¯»å–çš„æ³¨é‡Š // åé¢ä¸åº”è¯¥æœ‰ç©ºæ ¼ã€‚\næœ€åï¼Œå¦‚æœè¦å¿½ç•¥æ‰€æœ‰ linterï¼Œå¯ä»¥ç”¨//nolintï¼›å¦‚æœè¦å¿½ç•¥æŸä¸ªæŒ‡å®šçš„ linterï¼Œå¯ä»¥ç”¨//nolint:,ã€‚\nReferences  https://golangci-lint.run/ https://time.geekbang.org/column/article/390401  ","permalink":"http://yangchnet.github.io/Dessert/posts/golang/%E9%9D%99%E6%80%81%E4%BB%A3%E7%A0%81%E6%A3%80%E6%9F%A5-golangci-lint/","summary":"1. ç®€ä»‹ golangci-lint æ˜¯å¯¹golangè¿›è¡Œé™æ€ä»£ç æ£€æŸ¥çš„å·¥å…·ã€‚å…¶å…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š\n é€Ÿåº¦éå¸¸å¿«ï¼šgolangci-lint æ˜¯åŸºäº gometalinter å¼€å‘çš„ï¼Œä½†æ˜¯å¹³å‡é€Ÿåº¦è¦æ¯” gometalinter å¿« 5 å€ã€‚golangci-lint é€Ÿåº¦å¿«çš„åŸå› æœ‰ä¸‰ä¸ªï¼šå¯ä»¥å¹¶è¡Œæ£€æŸ¥ä»£ç ï¼›å¯ä»¥å¤ç”¨ go build ç¼“å­˜ï¼›ä¼šç¼“å­˜åˆ†æç»“æœã€‚ å¯é…ç½®ï¼šæ”¯æŒ YAML æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼Œè®©æ£€æŸ¥æ›´çµæ´»ï¼Œæ›´å¯æ§ã€‚ IDE é›†æˆï¼šå¯ä»¥é›†æˆè¿›å¤šä¸ªä¸»æµçš„ IDEï¼Œä¾‹å¦‚ VS Codeã€GNU Emacsã€Sublime Textã€Goland ç­‰ã€‚ linter èšåˆå™¨ï¼š1.41.1 ç‰ˆæœ¬çš„ golangci-lint é›†æˆäº† 76 ä¸ª linterï¼Œä¸éœ€è¦å†å•ç‹¬å®‰è£…è¿™ 76 ä¸ª linterã€‚å¹¶ä¸” golangci-lint è¿˜æ”¯æŒè‡ªå®šä¹‰ linterã€‚ æœ€å°çš„è¯¯æŠ¥æ•°ï¼šgolangci-lint è°ƒæ•´äº†æ‰€é›†æˆ linter çš„é»˜è®¤è®¾ç½®ï¼Œå¤§å¹…åº¦å‡å°‘äº†è¯¯æŠ¥ã€‚ è‰¯å¥½çš„è¾“å‡ºï¼šè¾“å‡ºçš„ç»“æœå¸¦æœ‰é¢œè‰²ã€ä»£ç è¡Œå·å’Œ linter æ ‡è¯†ï¼Œæ˜“äºæŸ¥çœ‹å’Œå®šä½ã€‚  2. å®‰è£… # å®‰è£… go get github.com/golangci/golangci-lint/cmd/golangci-lint@v1.41.1 # æ£€æŸ¥æ˜¯å¦å®‰è£…æˆåŠŸ golangci-lint version # è¾“å‡º golangci-lint ç‰ˆæœ¬å·ï¼Œè¯´æ˜å®‰è£…æˆåŠŸ golangci-lint has version v1.44.0 built from (unknown, mod sum: \u0026#34;h1:YJPouGNQEdK+x2KsCpWMIBy0q6MSuxHjkWMxJMNj/DU=\u0026#34;) on (unknown) 3.","title":"é™æ€ä»£ç æ£€æŸ¥: golangci-lint"},{"content":"1. nil channel   æ¥æ”¶ æ¥æ”¶goroutineé˜»å¡\n  å‘é€ å‘é€ä¸ªgoroutineé˜»å¡\n  2. å‘æ— ç¼“å†²channelå‘é€æ¶ˆæ¯   æ¥å—é˜Ÿåˆ—æœ‰goroutine æ¥æ”¶ç«¯å°†æ”¶åˆ°æ¶ˆæ¯\n  æ¥æ”¶é˜Ÿåˆ—æ— goroutine å‘é€goroutineå°†é˜»å¡\n  å·²æœ‰å‘é€goroutineé˜»å¡ å‘é€goroutineå°†é˜»å¡\n  3. ä»æ— ç¼“å†²channelæ¥æ”¶æ¶ˆæ¯   æ— å‘é€goroutine æ¥æ”¶ç«¯é˜»å¡\n  æœ‰å‘é€goroutine æ”¶åˆ°æ¶ˆæ¯\n  4. å‘æœ‰ç¼“å†²channelå‘é€æ¶ˆæ¯   é˜Ÿåˆ—æœªæ»¡ æ­£å¸¸å‘é€\n  é˜Ÿåˆ—å·²æ»¡ å‘é€ç«¯é˜»å¡\n  5. ä»æœ‰ç¼“å†²channelæ¥æ”¶æ¶ˆæ¯   é˜Ÿåˆ—ä¸­æœ‰æ¶ˆæ¯ æ­£å¸¸æ¥æ”¶\n  é˜Ÿåˆ—ä¸­æ— æ¶ˆæ¯ æ¥æ”¶ç«¯é˜»å¡\n  6. å¯¹close channelçš„æ“ä½œ   å‘closed channelå‘é€ panic\n  ä»æ— ç¼“å†²closed channelæ¥æ”¶ æ¥æ”¶åˆ°å¯¹åº”ç±»å‹0å€¼\n  ä»æœ‰ç¼“å†²closed channelæ¥æ”¶\n è‹¥channelä¸­ä»æœ‰æ¶ˆæ¯ï¼Œåˆ™ä»å¯æ¥æ”¶åˆ°æ¶ˆæ¯ channelå·²ç©º, æ¥æ”¶åˆ°å¯¹åº”ç±»å‹é›¶å€¼    7. å…³é—­channel   å…³é—­nll channel panic\n  å…³é—­ä¸€ä¸ªå·²ç»å…³é—­çš„channel panic\n  ","permalink":"http://yangchnet.github.io/Dessert/posts/golang/channel%E7%9A%84%E8%A1%8C%E4%B8%BA/","summary":"1. nil channel   æ¥æ”¶ æ¥æ”¶goroutineé˜»å¡\n  å‘é€ å‘é€ä¸ªgoroutineé˜»å¡\n  2. å‘æ— ç¼“å†²channelå‘é€æ¶ˆæ¯   æ¥å—é˜Ÿåˆ—æœ‰goroutine æ¥æ”¶ç«¯å°†æ”¶åˆ°æ¶ˆæ¯\n  æ¥æ”¶é˜Ÿåˆ—æ— goroutine å‘é€goroutineå°†é˜»å¡\n  å·²æœ‰å‘é€goroutineé˜»å¡ å‘é€goroutineå°†é˜»å¡\n  3. ä»æ— ç¼“å†²channelæ¥æ”¶æ¶ˆæ¯   æ— å‘é€goroutine æ¥æ”¶ç«¯é˜»å¡\n  æœ‰å‘é€goroutine æ”¶åˆ°æ¶ˆæ¯\n  4. å‘æœ‰ç¼“å†²channelå‘é€æ¶ˆæ¯   é˜Ÿåˆ—æœªæ»¡ æ­£å¸¸å‘é€\n  é˜Ÿåˆ—å·²æ»¡ å‘é€ç«¯é˜»å¡\n  5. ä»æœ‰ç¼“å†²channelæ¥æ”¶æ¶ˆæ¯   é˜Ÿåˆ—ä¸­æœ‰æ¶ˆæ¯ æ­£å¸¸æ¥æ”¶\n  é˜Ÿåˆ—ä¸­æ— æ¶ˆæ¯ æ¥æ”¶ç«¯é˜»å¡\n  6. å¯¹close channelçš„æ“ä½œ   å‘closed channelå‘é€ panic","title":"channelçš„è¡Œä¸º"},{"content":"1. å®‰è£…æ’ä»¶ç³»ç»Ÿ  ä½¿ç”¨çš„æ˜¯vim-plug\n curl -fLo ~/.vim/autoload/plug.vim --create-dirs \\  https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim 2. å®‰è£…æ’ä»¶ æ‰“å¼€~/.vimrc, åœ¨å…¶ä¸­å†™å…¥ï¼š\n\u0026quot; Specify a directory for plugins \u0026quot; - For Neovim: stdpath('data') . '/plugged' \u0026quot; - Avoid using standard Vim directory names like 'plugin' call plug#begin('~/.vim/plugged') \u0026quot; Make sure you use single quotes \u0026quot; Shorthand notation; fetches https://github.com/junegunn/vim-easy-align Plug 'junegunn/vim-easy-align' \u0026quot; Any valid git URL is allowed Plug 'https://github.com/junegunn/vim-github-dashboard.git' \u0026quot; Multiple Plug commands can be written in a single line using | separators Plug 'SirVer/ultisnips' | Plug 'honza/vim-snippets' \u0026quot; On-demand loading Plug 'scrooloose/nerdtree', { 'on': 'NERDTreeToggle' } Plug 'tpope/vim-fireplace', { 'for': 'clojure' } \u0026quot; Using a non-default branch Plug 'rdnetto/YCM-Generator', { 'branch': 'stable' } \u0026quot; Using a tagged release; wildcard allowed (requires git 1.9.2 or above) Plug 'fatih/vim-go', { 'tag': '*' } \u0026quot; Plugin options Plug 'nsf/gocode', { 'tag': 'v.20150303', 'rtp': 'vim' } \u0026quot; Plugin outside ~/.vim/plugged with post-update hook Plug 'junegunn/fzf', { 'dir': '~/.fzf', 'do': './install --all' } \u0026quot; Unmanaged plugin (manually installed and updated) Plug '~/my-prototype-plugin' \u0026quot; auto complete Plug 'Valloric/YouCompleteMe' \u0026quot; auto complete ()[]{} Plug 'tmsvg/pear-tree' Plug 'preservim/nerdtree' Plug 'vim-airline/vim-airline' Plug 'vim-airline/vim-airline-themes' Plug 'preservim/tagbar' \u0026quot; Initialize plugin system call plug#end() :colorscheme atom-dark \u0026quot; è®¾ç½®è¡Œå· set nu \u0026quot; è®¾ç½®tab set ts=4 %retab! \u0026quot; è®¾ç½®YouCompleteMeä¸éœ€è¦é¢„è§ˆ set completeopt-=preview if !isdirectory(\u0026amp;undodir) call mkdir(\u0026amp;undodir, 'p', 0700) endif set nobackup set undodir=~/.vim/undodir \u0026quot; è®¾ç½®ctrl+næ‰“å¼€ç›®å½• map \u0026lt;C-n\u0026gt; :NERDTreeToggle\u0026lt;CR\u0026gt; \u0026quot; è®¾ç½®F8æ‰“å¼€tag bar nmap \u0026lt;F8\u0026gt; :TagbarToggle\u0026lt;CR\u0026gt; \u0026quot; è®¾ç½®æœç´¢é«˜äº® set hlsearch \u0026quot; åœæ­¢æœç´¢é«˜äº®çš„é”®æ˜  nnoremap \u0026lt;silent\u0026gt; \u0026lt;BS\u0026gt; \u0026lt;BS\u0026gt;:nohlsearch\u0026lt;CR\u0026gt; set backspace=2 ç„¶ååœ¨å‘½ä»¤æ¨¡å¼ä¸‹æ‰§è¡Œï¼šPlugInstall\nç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œä¸€äº›æ’ä»¶å°†ä¼šè¢«å®‰è£…åˆ°vimä¸Š\n3. ä½¿ç”¨ä¸»é¢˜  è¿™é‡Œé€‰æ‹©molokaiä¸»é¢˜\n ä¸‹è½½ä¸»é¢˜æ–‡ä»¶\ngit clone https://github.com/tomasr/molokai.git cd molokai \u0026amp;\u0026amp; mv colors/molokai.vim ~/.vim/colors/ ä½¿ç”¨ä¸»é¢˜\nåœ¨~/.vimrcæ–‡ä»¶ä¸­å†™å…¥ï¼š\n:colorscheme molokai é‡æ–°è¿›å…¥vimï¼Œä¸»é¢˜å·²ç»ç”Ÿæ•ˆ\n4. è‡ªåŠ¨è¡¥å…¨  è¿™é‡Œä½¿ç”¨çš„æ˜¯YouCompleteMe åœ¨vim plugä¸­æ·»åŠ æ’ä»¶\n Plug 'Valloric/YouCompleteMe' vimè¿è¡Œ:PlugInstall\næ·»åŠ å®Œæˆåè¿˜éœ€è¦æ‰‹åŠ¨ç¼–è¯‘\ncd ~/.vim/plugged/YouCompleteMe \u0026amp;\u0026amp; python3 install.py --all --verbose --allä»£è¡¨è¦å®‰è£…æ‰€æœ‰è¯­è¨€çš„è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½ï¼Œå¦‚æœä½ åªéœ€è¦æŸä¸ªè¯­è¨€çš„(å¦‚Cè¯­è¨€)ï¼Œå¯ä»¥ä½¿ç”¨--clangå‚æ•°ä»£æ›¿--all\nä½¿ç”¨YouCompleteMeæ—¶ä¼šè·³å‡ºå‡½æ•°æ–‡æ¡£ï¼Œå¯ä»¥è®¾ç½®ä¸æ˜¾ç¤ºï¼š\nset completeopt-=preview 5. å…¶ä»–é…ç½®  æ‹¬å·è‡ªåŠ¨è¡¥å…¨  Plug 'tmsvg/pear-tree' æ˜¾ç¤ºè¡Œå·  set nu tabæ›¿æ¢ä¸º4ä¸ªç©ºæ ¼  set ts=4 %retab! ","permalink":"http://yangchnet.github.io/Dessert/posts/tool/vim%E9%85%8D%E7%BD%AE/","summary":"1. å®‰è£…æ’ä»¶ç³»ç»Ÿ  ä½¿ç”¨çš„æ˜¯vim-plug\n curl -fLo ~/.vim/autoload/plug.vim --create-dirs \\  https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim 2. å®‰è£…æ’ä»¶ æ‰“å¼€~/.vimrc, åœ¨å…¶ä¸­å†™å…¥ï¼š\n\u0026quot; Specify a directory for plugins \u0026quot; - For Neovim: stdpath('data') . '/plugged' \u0026quot; - Avoid using standard Vim directory names like 'plugin' call plug#begin('~/.vim/plugged') \u0026quot; Make sure you use single quotes \u0026quot; Shorthand notation; fetches https://github.com/junegunn/vim-easy-align Plug 'junegunn/vim-easy-align' \u0026quot; Any valid git URL is allowed Plug 'https://github.com/junegunn/vim-github-dashboard.git' \u0026quot; Multiple Plug commands can be written in a single line using | separators Plug 'SirVer/ultisnips' | Plug 'honza/vim-snippets' \u0026quot; On-demand loading Plug 'scrooloose/nerdtree', { 'on': 'NERDTreeToggle' } Plug 'tpope/vim-fireplace', { 'for': 'clojure' } \u0026quot; Using a non-default branch Plug 'rdnetto/YCM-Generator', { 'branch': 'stable' } \u0026quot; Using a tagged release; wildcard allowed (requires git 1.","title":"vimé…ç½®"},{"content":"1. ç”¨ä¾‹å›¾ ç”¨ä¾‹å›¾ä¸»è¦ç”¨äºå®šä¹‰ç³»ç»Ÿçš„åŠŸèƒ½éœ€æ±‚ï¼Œå®ƒæè¿°äº†ç³»ç»Ÿçš„å‚ä¸è€…ä¸ç³»ç»Ÿæä¾›çš„ç”¨ä¾‹ä¹‹é—´çš„å…³ç³»ï¼Œç”¨ä¾‹å›¾ä»…ä»å‚ä¸è€…ä½¿ç”¨ç³»ç»Ÿçš„è§’åº¦æè¿°ç³»ç»Ÿä¸­çš„ä¿¡æ¯ã€‚\nå›¾ä¾‹\nç¤ºä¾‹\n2. æ—¶åºå›¾ï¼ˆé¡ºåºå›¾ï¼‰ é¡ºåºå›¾æè¿°äº†å¯¹è±¡ä»¥åŠå¯¹è±¡ä¹‹é—´ä¼ é€’çš„æ¶ˆæ¯ï¼Œå¼ºè°ƒå¯¹è±¡ä¹‹é—´çš„äº¤äº’æ˜¯æŒ‰ç…§æ—¶é—´çš„å…ˆåé¡ºåºå‘ç”Ÿçš„ï¼Œè¿™äº›ç‰¹å®šé¡ºåºå‘ç”Ÿçš„äº¤äº’åºåˆ—ä»å¼€å§‹åˆ°ç»“æŸéœ€è¦ä¸€å®šçš„æ—¶é—´ã€‚åœ¨é¡ºåºå›¾ä¸­ä¸»è¦åŒ…æ‹¬äº†ä»¥ä¸‹ 4 ç§å…ƒç´ ã€‚ â— å¯¹è±¡ â— ç”Ÿå‘½çº¿ â— æ¿€æ´» â— æ¶ˆæ¯\nå›¾ä¾‹\nç¤ºä¾‹\n3. åä½œå›¾ åä½œå›¾ä¸é¡ºåºå›¾ä¸€æ ·ï¼Œä¹Ÿæ˜¯ç”¨äºæè¿°ç³»ç»Ÿä¸­å„å¯¹è±¡çš„äº¤äº’å…³ç³»å¹¶å±•ç°å¯¹è±¡é—´çš„æ¶ˆæ¯ä¼ é€’ï¼Œä½†ä¸¤è€…ä¾§é‡ç‚¹ä¸åŒï¼Œé¡ºåºå›¾ç€é‡äºæè¿°äº¤äº’çš„æ—¶é—´é¡ºåºï¼Œè€Œåä½œå›¾ç€é‡äºæè¿°åä½œå¯¹è±¡é—´çš„äº¤äº’å’Œè¿æ¥ã€‚è¿˜å¯ä»¥ä»å¦ä¸€ä¸ªè§’åº¦æ¥çœ‹ä¸¤ç§å›¾çš„å®šä¹‰ï¼Œé¡ºåºå›¾æ˜¯æŒ‰ç…§æ—¶é—´çš„é¡ºåºå¸ƒå›¾ï¼Œè€Œåä½œå›¾æ˜¯æŒ‰ç…§ç©ºé—´æ¥å¸ƒå›¾ã€‚\nå›¾ä¾‹\nç¤ºä¾‹\né¡ºåºå›¾ä¸åä½œå›¾çš„å…³ç³»\né¡ºåºå›¾å’Œåä½œå›¾åœ¨è¯­ä¹‰ä¸Šæ˜¯ç­‰ä»·çš„ï¼Œå®ƒä»¬ä¹‹é—´å¯ä»¥è¿›è¡Œäº’ç›¸è½¬æ¢ã€‚ ä¾‹å¦‚ä¸Šé¢çš„åä½œå›¾å¯ä»¥ç­‰ä»·è½¬åŒ–ä¸ºé¡ºåºå›¾ï¼š\n4. ç±»å›¾ ç±»å›¾æè¿°äº†ç±»å’Œç±»é—´å…³ç³»ï¼Œå®ƒä»é™æ€è§’åº¦æ¥è¡¨ç¤ºä¸€ä¸ªç³»ç»Ÿï¼Œå› æ­¤ç±»å›¾å±äºä¸€ç§é™æ€å›¾ã€‚ç±»å›¾æ˜¯ UML å»ºæ¨¡ä¸­æœ€åŸºæœ¬å’Œæœ€é‡è¦çš„ä¸€ç±»å›¾ã€‚\nå›¾ä¾‹\nç¤ºä¾‹\n5. å¯¹è±¡å›¾ å¯¹è±¡å›¾æ˜¯ç±»å›¾çš„å®ä¾‹ï¼Œå‡ ä¹ä½¿ç”¨ä¸ç±»å›¾å®Œå…¨ç›¸åŒçš„æ ‡è¯†ã€‚å®ƒä»¬çš„ä¸åŒç‚¹åœ¨äºå¯¹è±¡å›¾æ˜¾ç¤ºç±»çš„å¤šä¸ªå¯¹è±¡å®ä¾‹ï¼Œè€Œä¸æ˜¯å®é™…çš„ç±»ã€‚ä¸€ä¸ªå¯¹è±¡å›¾æ˜¯ç±»å›¾çš„ä¸€ä¸ªå®ä¾‹ã€‚ç”±äºå¯¹è±¡å­˜åœ¨ç”Ÿå‘½å‘¨æœŸï¼Œå› æ­¤å¯¹è±¡å›¾ä¹Ÿæ˜¯æœ‰ç”Ÿå‘½å‘¨æœŸçš„ï¼Œå®ƒåªèƒ½åœ¨ç³»ç»ŸæŸä¸€æ—¶é—´æ®µå­˜åœ¨ã€‚\nç¤ºä¾‹ 6. åŒ…å›¾ åˆ›å»ºåŒ…å›¾çš„ä¸»è¦ä½œç”¨æ˜¯ï¼š\n æè¿°éœ€æ±‚çš„é«˜é˜¶æ¦‚è¿°ã€‚ æè¿°è®¾è®¡çš„é«˜é˜¶æ¦‚è¿°ã€‚ åœ¨é€»è¾‘ä¸ŠæŠŠä¸€ä¸ªå¤æ‚çš„å›¾æ¨¡å—åŒ–ã€‚ ç»„ç»‡æºä»£ç ã€‚ å¯¹æ¡†æ¶è¿›è¡Œå»ºæ¨¡ã€‚  å›¾ä¾‹\nç¤ºä¾‹\n7. çŠ¶æ€å›¾ çŠ¶æ€å›¾ä¸»è¦ç”¨æ¥æè¿°ä¸€ä¸ªç‰¹å®šå¯¹è±¡çš„æ‰€æœ‰å¯èƒ½çŠ¶æ€ä»¥åŠç”±äºå„ç§äº‹ä»¶çš„å‘ç”Ÿè€Œå¼•èµ·çŠ¶æ€ä¹‹é—´çš„è½¬ç§»ã€‚é€šè¿‡çŠ¶æ€å›¾å¯ä»¥çŸ¥é“ä¸€ä¸ªå¯¹è±¡ã€å­ç³»ç»Ÿã€ç³»ç»Ÿçš„å„ç§çŠ¶æ€åŠå…¶æ”¶åˆ°çš„æ¶ˆæ¯å¯¹å…¶çŠ¶æ€çš„å½±å“ã€‚é€šå¸¸åˆ›å»ºä¸€ä¸ª UML çŠ¶æ€å›¾æ˜¯ä¸ºäº†ä»¥ä¸‹çš„ç ”ç©¶ç›®çš„ï¼šç ”ç©¶ç±»ã€è§’è‰²ã€å­ç³»ç»Ÿæˆ–æ„ä»¶çš„å¤æ‚è¡Œä¸ºã€‚\nçŠ¶æ€å›¾ä¸»è¦ç”±èµ·ç‚¹ã€ç»ˆç‚¹å’ŒçŠ¶æ€ç»„æˆï¼Œå„çŠ¶æ€ç”±è½¬ç§»è¿æ¥åœ¨ä¸€èµ·ã€‚çŠ¶æ€æ˜¯å¯¹è±¡æ‰§è¡ŒæŸé¡¹æ´»åŠ¨æˆ–ç­‰å¾…æŸä¸ªäº‹ä»¶æ—¶çš„æ¡ä»¶ã€‚è½¬æ¢æ˜¯ä¸¤ä¸ªçŠ¶æ€ä¹‹é—´çš„å…³ç³»ï¼Œå®ƒç”±æŸä¸ªäº‹ä»¶è§¦å‘ï¼Œç„¶åæ‰§è¡Œç‰¹å®šçš„æ“ä½œæˆ–è¯„ä¼°å¹¶å¯¼è‡´ç‰¹å®šçš„ç»“æŸçŠ¶æ€ã€‚\nçŠ¶æ€å›¾é€‚åˆäºæè¿°è·¨è¶Šå¤šä¸ªç”¨ä¾‹çš„å•ä¸ªå¯¹è±¡çš„è¡Œä¸ºï¼Œè€Œä¸é€‚åˆæè¿°å¤šä¸ªå¯¹è±¡ä¹‹é—´çš„è¡Œä¸ºåä½œã€‚ä¸ºæ­¤ï¼Œå¸¸å¸¸å°†çŠ¶æ€å›¾ä¸å…¶ä»–æŠ€æœ¯ç»„åˆä½¿ç”¨ã€‚\nå›¾ä¾‹\nç¤ºä¾‹\n8. æ´»åŠ¨å›¾ æ´»åŠ¨å›¾æ˜¯ç”¨æ¥æè¿°è¾¾åˆ°ä¸€ä¸ªç›®æ ‡æ‰€å®æ–½ä¸€ç³»åˆ—æ´»åŠ¨çš„è¿‡ç¨‹ï¼Œæè¿°äº†ç³»ç»Ÿçš„åŠ¨æ€ç‰¹å¾ã€‚æ´»åŠ¨å›¾ç±»ä¼¼ç»“æ„åŒ–ç¨‹åºè¯¾ç¨‹ä¸­çš„æµç¨‹å›¾ï¼Œä¸åŒä¹‹å¤„åœ¨äºå®ƒæ”¯æŒå¹¶è¡Œæ´»åŠ¨ã€‚æ´»åŠ¨å›¾å’ŒçŠ¶æ€å›¾çš„ä¸»è¦åŒºåˆ«åœ¨äºçŠ¶æ€å›¾ä¾§é‡ä»è¡Œä¸ºçš„ç»“æœæ¥æè¿°ï¼Œä»¥çŠ¶æ€ä¸ºä¸­å¿ƒï¼›æ´»åŠ¨å›¾ä¾§é‡ä»è¡Œä¸ºçš„åŠ¨ä½œæ¥æè¿°ï¼Œä»¥æ´»åŠ¨ä¸ºä¸­å¿ƒã€‚æ´»åŠ¨å›¾ç”¨æ¥ä¸ºä¸€ä¸ªè¿‡ç¨‹ä¸­çš„æ´»åŠ¨åºåˆ—å»ºæ¨¡ï¼Œè€ŒçŠ¶æ€å›¾ç”¨æ¥ä¸ºå¯¹è±¡ç”Ÿå‘½æœŸä¸­çš„å„ç¦»æ•£çŠ¶æ€å»ºæ¨¡ã€‚\nå›¾ä¾‹\nç¤ºä¾‹\n9. æ„ä»¶å›¾ æ„ä»¶æ˜¯ç³»ç»Ÿçš„æ¨¡å—åŒ–éƒ¨åˆ†ï¼Œå®ƒå°è£…äº†è‡ªå·±çš„å†…å®¹ï¼Œä¸”å®ƒçš„å£°æ˜åœ¨å…¶ç¯å¢ƒä¸­æ˜¯å¯ä»¥æ›¿æ¢çš„ï¼›æ„ä»¶åˆ©ç”¨æä¾›æ¥å£å’Œè¯·æ±‚æ¥å£å®šä¹‰è‡ªèº«çš„è¡Œä¸ºï¼Œå®ƒèµ·ç±»å‹çš„ä½œç”¨ã€‚\nå›¾ä¾‹\nç¤ºä¾‹\n10. éƒ¨ç½²å›¾ éƒ¨ç½²å›¾æè¿°äº†æ•´ä¸ªç³»ç»Ÿçš„è½¯ç¡¬ä»¶çš„å®é™…é…ç½®ï¼Œå®ƒè¡¨ç¤ºäº†ç³»ç»Ÿåœ¨è¿è¡ŒæœŸé—´çš„ä½“ç³»ç»“æ„ã€ç¡¬ä»¶å…ƒç´ ï¼ˆèŠ‚ç‚¹ï¼‰çš„æ„é€ å’Œè½¯ä»¶å…ƒç´ æ˜¯å¦‚ä½•è¢«æ˜ å°„åœ¨é‚£äº›èŠ‚ç‚¹ä¹‹ä¸Šçš„ã€‚\néƒ¨ç½²å›¾å¯ä»¥å¸®åŠ©ç³»ç»Ÿçš„æœ‰å…³äººå‘˜äº†è§£ç³»ç»Ÿä¸­å„ä¸ªæ„ä»¶éƒ¨ç½²åœ¨ä»€ä¹ˆç¡¬ä»¶ä¸Šï¼Œä»¥åŠè¿™äº›ç¡¬ä»¶ä¹‹é—´çš„äº¤äº’å…³ç³»ã€‚\nå›¾ä¾‹ ç¤ºä¾‹\nReferences ã€Šé¢å‘å¯¹è±¡æŠ€æœ¯åŠUMLæ•™ç¨‹ã€‹ æç£Šï¼Œç‹å…»å»·ä¸»ç¼–\n","permalink":"http://yangchnet.github.io/Dessert/posts/%E6%9D%82%E8%AE%B0/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1uml%E5%9B%BE/","summary":"1. ç”¨ä¾‹å›¾ ç”¨ä¾‹å›¾ä¸»è¦ç”¨äºå®šä¹‰ç³»ç»Ÿçš„åŠŸèƒ½éœ€æ±‚ï¼Œå®ƒæè¿°äº†ç³»ç»Ÿçš„å‚ä¸è€…ä¸ç³»ç»Ÿæä¾›çš„ç”¨ä¾‹ä¹‹é—´çš„å…³ç³»ï¼Œç”¨ä¾‹å›¾ä»…ä»å‚ä¸è€…ä½¿ç”¨ç³»ç»Ÿçš„è§’åº¦æè¿°ç³»ç»Ÿä¸­çš„ä¿¡æ¯ã€‚\nå›¾ä¾‹\nç¤ºä¾‹\n2. æ—¶åºå›¾ï¼ˆé¡ºåºå›¾ï¼‰ é¡ºåºå›¾æè¿°äº†å¯¹è±¡ä»¥åŠå¯¹è±¡ä¹‹é—´ä¼ é€’çš„æ¶ˆæ¯ï¼Œå¼ºè°ƒå¯¹è±¡ä¹‹é—´çš„äº¤äº’æ˜¯æŒ‰ç…§æ—¶é—´çš„å…ˆåé¡ºåºå‘ç”Ÿçš„ï¼Œè¿™äº›ç‰¹å®šé¡ºåºå‘ç”Ÿçš„äº¤äº’åºåˆ—ä»å¼€å§‹åˆ°ç»“æŸéœ€è¦ä¸€å®šçš„æ—¶é—´ã€‚åœ¨é¡ºåºå›¾ä¸­ä¸»è¦åŒ…æ‹¬äº†ä»¥ä¸‹ 4 ç§å…ƒç´ ã€‚ â— å¯¹è±¡ â— ç”Ÿå‘½çº¿ â— æ¿€æ´» â— æ¶ˆæ¯\nå›¾ä¾‹\nç¤ºä¾‹\n3. åä½œå›¾ åä½œå›¾ä¸é¡ºåºå›¾ä¸€æ ·ï¼Œä¹Ÿæ˜¯ç”¨äºæè¿°ç³»ç»Ÿä¸­å„å¯¹è±¡çš„äº¤äº’å…³ç³»å¹¶å±•ç°å¯¹è±¡é—´çš„æ¶ˆæ¯ä¼ é€’ï¼Œä½†ä¸¤è€…ä¾§é‡ç‚¹ä¸åŒï¼Œé¡ºåºå›¾ç€é‡äºæè¿°äº¤äº’çš„æ—¶é—´é¡ºåºï¼Œè€Œåä½œå›¾ç€é‡äºæè¿°åä½œå¯¹è±¡é—´çš„äº¤äº’å’Œè¿æ¥ã€‚è¿˜å¯ä»¥ä»å¦ä¸€ä¸ªè§’åº¦æ¥çœ‹ä¸¤ç§å›¾çš„å®šä¹‰ï¼Œé¡ºåºå›¾æ˜¯æŒ‰ç…§æ—¶é—´çš„é¡ºåºå¸ƒå›¾ï¼Œè€Œåä½œå›¾æ˜¯æŒ‰ç…§ç©ºé—´æ¥å¸ƒå›¾ã€‚\nå›¾ä¾‹\nç¤ºä¾‹\né¡ºåºå›¾ä¸åä½œå›¾çš„å…³ç³»\né¡ºåºå›¾å’Œåä½œå›¾åœ¨è¯­ä¹‰ä¸Šæ˜¯ç­‰ä»·çš„ï¼Œå®ƒä»¬ä¹‹é—´å¯ä»¥è¿›è¡Œäº’ç›¸è½¬æ¢ã€‚ ä¾‹å¦‚ä¸Šé¢çš„åä½œå›¾å¯ä»¥ç­‰ä»·è½¬åŒ–ä¸ºé¡ºåºå›¾ï¼š\n4. ç±»å›¾ ç±»å›¾æè¿°äº†ç±»å’Œç±»é—´å…³ç³»ï¼Œå®ƒä»é™æ€è§’åº¦æ¥è¡¨ç¤ºä¸€ä¸ªç³»ç»Ÿï¼Œå› æ­¤ç±»å›¾å±äºä¸€ç§é™æ€å›¾ã€‚ç±»å›¾æ˜¯ UML å»ºæ¨¡ä¸­æœ€åŸºæœ¬å’Œæœ€é‡è¦çš„ä¸€ç±»å›¾ã€‚\nå›¾ä¾‹\nç¤ºä¾‹\n5. å¯¹è±¡å›¾ å¯¹è±¡å›¾æ˜¯ç±»å›¾çš„å®ä¾‹ï¼Œå‡ ä¹ä½¿ç”¨ä¸ç±»å›¾å®Œå…¨ç›¸åŒçš„æ ‡è¯†ã€‚å®ƒä»¬çš„ä¸åŒç‚¹åœ¨äºå¯¹è±¡å›¾æ˜¾ç¤ºç±»çš„å¤šä¸ªå¯¹è±¡å®ä¾‹ï¼Œè€Œä¸æ˜¯å®é™…çš„ç±»ã€‚ä¸€ä¸ªå¯¹è±¡å›¾æ˜¯ç±»å›¾çš„ä¸€ä¸ªå®ä¾‹ã€‚ç”±äºå¯¹è±¡å­˜åœ¨ç”Ÿå‘½å‘¨æœŸï¼Œå› æ­¤å¯¹è±¡å›¾ä¹Ÿæ˜¯æœ‰ç”Ÿå‘½å‘¨æœŸçš„ï¼Œå®ƒåªèƒ½åœ¨ç³»ç»ŸæŸä¸€æ—¶é—´æ®µå­˜åœ¨ã€‚\nç¤ºä¾‹ 6. åŒ…å›¾ åˆ›å»ºåŒ…å›¾çš„ä¸»è¦ä½œç”¨æ˜¯ï¼š\n æè¿°éœ€æ±‚çš„é«˜é˜¶æ¦‚è¿°ã€‚ æè¿°è®¾è®¡çš„é«˜é˜¶æ¦‚è¿°ã€‚ åœ¨é€»è¾‘ä¸ŠæŠŠä¸€ä¸ªå¤æ‚çš„å›¾æ¨¡å—åŒ–ã€‚ ç»„ç»‡æºä»£ç ã€‚ å¯¹æ¡†æ¶è¿›è¡Œå»ºæ¨¡ã€‚  å›¾ä¾‹\nç¤ºä¾‹\n7. çŠ¶æ€å›¾ çŠ¶æ€å›¾ä¸»è¦ç”¨æ¥æè¿°ä¸€ä¸ªç‰¹å®šå¯¹è±¡çš„æ‰€æœ‰å¯èƒ½çŠ¶æ€ä»¥åŠç”±äºå„ç§äº‹ä»¶çš„å‘ç”Ÿè€Œå¼•èµ·çŠ¶æ€ä¹‹é—´çš„è½¬ç§»ã€‚é€šè¿‡çŠ¶æ€å›¾å¯ä»¥çŸ¥é“ä¸€ä¸ªå¯¹è±¡ã€å­ç³»ç»Ÿã€ç³»ç»Ÿçš„å„ç§çŠ¶æ€åŠå…¶æ”¶åˆ°çš„æ¶ˆæ¯å¯¹å…¶çŠ¶æ€çš„å½±å“ã€‚é€šå¸¸åˆ›å»ºä¸€ä¸ª UML çŠ¶æ€å›¾æ˜¯ä¸ºäº†ä»¥ä¸‹çš„ç ”ç©¶ç›®çš„ï¼šç ”ç©¶ç±»ã€è§’è‰²ã€å­ç³»ç»Ÿæˆ–æ„ä»¶çš„å¤æ‚è¡Œä¸ºã€‚\nçŠ¶æ€å›¾ä¸»è¦ç”±èµ·ç‚¹ã€ç»ˆç‚¹å’ŒçŠ¶æ€ç»„æˆï¼Œå„çŠ¶æ€ç”±è½¬ç§»è¿æ¥åœ¨ä¸€èµ·ã€‚çŠ¶æ€æ˜¯å¯¹è±¡æ‰§è¡ŒæŸé¡¹æ´»åŠ¨æˆ–ç­‰å¾…æŸä¸ªäº‹ä»¶æ—¶çš„æ¡ä»¶ã€‚è½¬æ¢æ˜¯ä¸¤ä¸ªçŠ¶æ€ä¹‹é—´çš„å…³ç³»ï¼Œå®ƒç”±æŸä¸ªäº‹ä»¶è§¦å‘ï¼Œç„¶åæ‰§è¡Œç‰¹å®šçš„æ“ä½œæˆ–è¯„ä¼°å¹¶å¯¼è‡´ç‰¹å®šçš„ç»“æŸçŠ¶æ€ã€‚\nçŠ¶æ€å›¾é€‚åˆäºæè¿°è·¨è¶Šå¤šä¸ªç”¨ä¾‹çš„å•ä¸ªå¯¹è±¡çš„è¡Œä¸ºï¼Œè€Œä¸é€‚åˆæè¿°å¤šä¸ªå¯¹è±¡ä¹‹é—´çš„è¡Œä¸ºåä½œã€‚ä¸ºæ­¤ï¼Œå¸¸å¸¸å°†çŠ¶æ€å›¾ä¸å…¶ä»–æŠ€æœ¯ç»„åˆä½¿ç”¨ã€‚\nå›¾ä¾‹\nç¤ºä¾‹\n8. æ´»åŠ¨å›¾ æ´»åŠ¨å›¾æ˜¯ç”¨æ¥æè¿°è¾¾åˆ°ä¸€ä¸ªç›®æ ‡æ‰€å®æ–½ä¸€ç³»åˆ—æ´»åŠ¨çš„è¿‡ç¨‹ï¼Œæè¿°äº†ç³»ç»Ÿçš„åŠ¨æ€ç‰¹å¾ã€‚æ´»åŠ¨å›¾ç±»ä¼¼ç»“æ„åŒ–ç¨‹åºè¯¾ç¨‹ä¸­çš„æµç¨‹å›¾ï¼Œä¸åŒä¹‹å¤„åœ¨äºå®ƒæ”¯æŒå¹¶è¡Œæ´»åŠ¨ã€‚æ´»åŠ¨å›¾å’ŒçŠ¶æ€å›¾çš„ä¸»è¦åŒºåˆ«åœ¨äºçŠ¶æ€å›¾ä¾§é‡ä»è¡Œä¸ºçš„ç»“æœæ¥æè¿°ï¼Œä»¥çŠ¶æ€ä¸ºä¸­å¿ƒï¼›æ´»åŠ¨å›¾ä¾§é‡ä»è¡Œä¸ºçš„åŠ¨ä½œæ¥æè¿°ï¼Œä»¥æ´»åŠ¨ä¸ºä¸­å¿ƒã€‚æ´»åŠ¨å›¾ç”¨æ¥ä¸ºä¸€ä¸ªè¿‡ç¨‹ä¸­çš„æ´»åŠ¨åºåˆ—å»ºæ¨¡ï¼Œè€ŒçŠ¶æ€å›¾ç”¨æ¥ä¸ºå¯¹è±¡ç”Ÿå‘½æœŸä¸­çš„å„ç¦»æ•£çŠ¶æ€å»ºæ¨¡ã€‚\nå›¾ä¾‹\nç¤ºä¾‹\n9. æ„ä»¶å›¾ æ„ä»¶æ˜¯ç³»ç»Ÿçš„æ¨¡å—åŒ–éƒ¨åˆ†ï¼Œå®ƒå°è£…äº†è‡ªå·±çš„å†…å®¹ï¼Œä¸”å®ƒçš„å£°æ˜åœ¨å…¶ç¯å¢ƒä¸­æ˜¯å¯ä»¥æ›¿æ¢çš„ï¼›æ„ä»¶åˆ©ç”¨æä¾›æ¥å£å’Œè¯·æ±‚æ¥å£å®šä¹‰è‡ªèº«çš„è¡Œä¸ºï¼Œå®ƒèµ·ç±»å‹çš„ä½œç”¨ã€‚\nå›¾ä¾‹\nç¤ºä¾‹","title":"é¢å‘å¯¹è±¡UMLå›¾"},{"content":" é€›GitHubçš„æ—¶å€™æ— æ„ä¸­å‘ç°å¾®è½¯æœ‰ä¸€ä¸ªWeb-Dev-For-Beginnersçš„åº“ï¼Œç„¶åéšæ‰‹æœäº†ä¸€ä¸‹ï¼Œå‘ç°è¿˜æœ‰å¾ˆå¤šç±»ä¼¼çš„ï¼Œè¿™é‡Œçºªå½•ä¸€ä¸‹å…¶ä¸­æ¯”è¾ƒå¥½çš„ï¼Œæœ‰å¤‡æ— æ‚£ã€‚\n  å¯ä»¥Googleæœç´¢Beginners site:github.com/microsoftæŸ¥çœ‹ç›¸å…³çš„ä¿¡æ¯\n 1. Web-Dev-For-Beginners webå¼€å‘è¯¾ç¨‹ï¼Œä¸€å…±12å‘¨ï¼Œ24èŠ‚è¯¾ï¼Œæ¯èŠ‚è¯¾éƒ½åŒ…æ‹¬è¯¾å‰å’Œè¯¾åæµ‹éªŒã€å®Œæˆè¯¾ç¨‹çš„ä¹¦é¢è¯´æ˜ã€è§£å†³æ–¹æ¡ˆã€ä½œä¸šç­‰ã€‚æºæ–‡ä»¶ä¸ºè‹±æ–‡ç‰ˆï¼Œä½†æ¯ä¸ªç« èŠ‚éƒ½é…å¤‡æœ‰ä¸åŒè¯­è¨€çš„ç¿»è¯‘ç‰ˆã€‚åŒæ—¶ä¹Ÿæä¾›pdfç‰ˆæœ¬ä¸‹è½½ã€‚\né¡¹ç›®åœ°å€ï¼šhttps://github.com/microsoft/Web-Dev-For-Beginners\n2. ML-For-Beginners æœºå™¨å­¦ä¹ è¯¾ç¨‹ï¼Œ12å‘¨ï¼Œ26èŠ‚è¯¾ã€‚ä¸»è¦ä½¿ç”¨sklearnåº“ã€‚\né¡¹ç›®åœ°å€ï¼šhttps://github.com/microsoft/Data-Science-For-Beginners\n3. Data-Science-For-Beginners æ•°æ®ç§‘å­¦è¯¾ç¨‹ï¼Œ10å‘¨ï¼Œ20èŠ‚è¯¾ã€‚æ¯èŠ‚è¯¾åŒ…æ‹¬è¯¾å‰å’Œè¯¾åæµ‹éªŒã€å®Œæˆè¯¾ç¨‹çš„ä¹¦é¢è¯´æ˜ã€è§£å†³æ–¹æ¡ˆå’Œä½œä¸šã€‚\né¡¹ç›®åœ°å€ï¼šhttps://github.com/microsoft/Data-Science-For-Beginners\n4. IoT-For-Beginners ç‰©è”ç½‘å¼€å‘è¯¾ç¨‹ï¼Œ12å‘¨ï¼Œ24èŠ‚è¯¾ã€‚æ¯èŠ‚è¯¾éƒ½åŒ…æ‹¬è¯¾å‰å’Œè¯¾åæµ‹éªŒã€å®Œæˆè¯¾ç¨‹çš„ä¹¦é¢è¯´æ˜ã€è§£å†³æ–¹æ¡ˆã€ä½œä¸šç­‰ã€‚\né¡¹ç›®åœ°å€ï¼šhttps://github.com/microsoft/IoT-For-Beginners\n5. beginners-intro-javascript-node nodejsè¯¾ç¨‹\né¡¹ç›®åœ°å€ï¼šhttps://github.com/microsoft/beginners-intro-javascript-node\n6. beginners-series-rust rustè¯¾ç¨‹ã€‚è¿™ä¸ªé¡¹ç›®æ„Ÿè§‰è¿˜ä¸æ˜¯å¤ªå®Œå–„ï¼Œä½†ä¾ç„¶å¯ä»¥ä½œä¸ºå‚è€ƒã€‚\né¡¹ç›®åœ°å€ï¼šhttps://github.com/microsoft/beginners-series-rust\n7. beginners-django djangoè¯¾ç¨‹ã€‚è¿™ä¸ªé¡¹ç›®å°±å‰å®³äº†ï¼Œå•¥ä¹Ÿæ²¡æœ‰ï¼Œä¸è¿‡åˆ›å»ºæ—¶é—´è¿˜çŸ­ï¼Œå…ˆæ’ä¸ªçœ¼ã€‚\né¡¹ç›®åœ°å€ï¼šhttps://github.com/microsoft/beginners-django\n","permalink":"http://yangchnet.github.io/Dessert/posts/%E6%9D%82%E8%AE%B0/tutorial-for-beginner/","summary":"é€›GitHubçš„æ—¶å€™æ— æ„ä¸­å‘ç°å¾®è½¯æœ‰ä¸€ä¸ªWeb-Dev-For-Beginnersçš„åº“ï¼Œç„¶åéšæ‰‹æœäº†ä¸€ä¸‹ï¼Œå‘ç°è¿˜æœ‰å¾ˆå¤šç±»ä¼¼çš„ï¼Œè¿™é‡Œçºªå½•ä¸€ä¸‹å…¶ä¸­æ¯”è¾ƒå¥½çš„ï¼Œæœ‰å¤‡æ— æ‚£ã€‚\n  å¯ä»¥Googleæœç´¢Beginners site:github.com/microsoftæŸ¥çœ‹ç›¸å…³çš„ä¿¡æ¯\n 1. Web-Dev-For-Beginners webå¼€å‘è¯¾ç¨‹ï¼Œä¸€å…±12å‘¨ï¼Œ24èŠ‚è¯¾ï¼Œæ¯èŠ‚è¯¾éƒ½åŒ…æ‹¬è¯¾å‰å’Œè¯¾åæµ‹éªŒã€å®Œæˆè¯¾ç¨‹çš„ä¹¦é¢è¯´æ˜ã€è§£å†³æ–¹æ¡ˆã€ä½œä¸šç­‰ã€‚æºæ–‡ä»¶ä¸ºè‹±æ–‡ç‰ˆï¼Œä½†æ¯ä¸ªç« èŠ‚éƒ½é…å¤‡æœ‰ä¸åŒè¯­è¨€çš„ç¿»è¯‘ç‰ˆã€‚åŒæ—¶ä¹Ÿæä¾›pdfç‰ˆæœ¬ä¸‹è½½ã€‚\né¡¹ç›®åœ°å€ï¼šhttps://github.com/microsoft/Web-Dev-For-Beginners\n2. ML-For-Beginners æœºå™¨å­¦ä¹ è¯¾ç¨‹ï¼Œ12å‘¨ï¼Œ26èŠ‚è¯¾ã€‚ä¸»è¦ä½¿ç”¨sklearnåº“ã€‚\né¡¹ç›®åœ°å€ï¼šhttps://github.com/microsoft/Data-Science-For-Beginners\n3. Data-Science-For-Beginners æ•°æ®ç§‘å­¦è¯¾ç¨‹ï¼Œ10å‘¨ï¼Œ20èŠ‚è¯¾ã€‚æ¯èŠ‚è¯¾åŒ…æ‹¬è¯¾å‰å’Œè¯¾åæµ‹éªŒã€å®Œæˆè¯¾ç¨‹çš„ä¹¦é¢è¯´æ˜ã€è§£å†³æ–¹æ¡ˆå’Œä½œä¸šã€‚\né¡¹ç›®åœ°å€ï¼šhttps://github.com/microsoft/Data-Science-For-Beginners\n4. IoT-For-Beginners ç‰©è”ç½‘å¼€å‘è¯¾ç¨‹ï¼Œ12å‘¨ï¼Œ24èŠ‚è¯¾ã€‚æ¯èŠ‚è¯¾éƒ½åŒ…æ‹¬è¯¾å‰å’Œè¯¾åæµ‹éªŒã€å®Œæˆè¯¾ç¨‹çš„ä¹¦é¢è¯´æ˜ã€è§£å†³æ–¹æ¡ˆã€ä½œä¸šç­‰ã€‚\né¡¹ç›®åœ°å€ï¼šhttps://github.com/microsoft/IoT-For-Beginners\n5. beginners-intro-javascript-node nodejsè¯¾ç¨‹\né¡¹ç›®åœ°å€ï¼šhttps://github.com/microsoft/beginners-intro-javascript-node\n6. beginners-series-rust rustè¯¾ç¨‹ã€‚è¿™ä¸ªé¡¹ç›®æ„Ÿè§‰è¿˜ä¸æ˜¯å¤ªå®Œå–„ï¼Œä½†ä¾ç„¶å¯ä»¥ä½œä¸ºå‚è€ƒã€‚\né¡¹ç›®åœ°å€ï¼šhttps://github.com/microsoft/beginners-series-rust\n7. beginners-django djangoè¯¾ç¨‹ã€‚è¿™ä¸ªé¡¹ç›®å°±å‰å®³äº†ï¼Œå•¥ä¹Ÿæ²¡æœ‰ï¼Œä¸è¿‡åˆ›å»ºæ—¶é—´è¿˜çŸ­ï¼Œå…ˆæ’ä¸ªçœ¼ã€‚\né¡¹ç›®åœ°å€ï¼šhttps://github.com/microsoft/beginners-django","title":"Tutorial for Beginner"},{"content":"1. site site: æœç´¢æŒ‡å®šç«™ç‚¹\nç”¨æ³•:\nsite:[example.com] ç¤ºä¾‹:\ngolang site:github.com 2. source source: åœ¨è°·æ­Œæ–°é—»ä¸­æŒ‡å®šæ¥æº\nç”¨æ³•:\nsource:[sourcesite] ç¤ºä¾‹:\nCOVID source:yahoo 3. intext intext: æŸ¥è¯¢çš„å†…å®¹å¿…é¡»å‡ºç°åœ¨æ­£æ–‡ä¸­\nç”¨æ³•:\nintext:[somewords] ç¤ºä¾‹:\nintext:xiaomi 4. allintext allintext: æŸ¥è¯¢çš„æ¯ä¸ªå•è¯éƒ½å¿…é¡»åŒ…å«åœ¨é¡µé¢ä¸­\nç”¨æ³•:\nallintext:[somewords] ç¤ºä¾‹:\nallintext:Quantum Network Coding 5. intitle intitle: æ ‡é¢˜ä¸­åŒ…å«è¦æŸ¥è¯¢çš„å†…å®¹\nç”¨æ³•:\nintitle:[somewords] ç¤ºä¾‹:\nintitle:Quantum 6. allintitle allintitle: ç±»ä¼¼allintext\n7. url url:ç»“æœçš„urlä¸­å¿…é¡»åŒ…å«æŸäº›å†…å®¹\nç”¨æ³•:\nurl:[somewords] ç¤ºä¾‹:\nurl:airpods 8. allinurl allinurl: ç»“æœçš„urlå¿…é¡»åŒ…å«æ‰€æœ‰æŸ¥è¯¢å†…å®¹\n9. filetype filetype: æŸ¥è¯¢çš„ç»“æœæ»¡è¶³æŸç§æ–‡ä»¶ç±»å‹\nç”¨æ³•:\nfiletype:[filetype] ç¤ºä¾‹:\ngolang filetype:pdf 10. related related: æŸ¥æ‰¾æœ‰å…³å†…å®¹\nç”¨æ³•:\nrelated:[somewords] ç¤ºä¾‹:\nrelated:[airpods] 11. AROUND(X) AROUND(X): å°†ç»“æœé™åˆ¶ä¸º:åŒ…å«å½¼æ­¤ç›¸å·®Xä¸ªå•è¯çš„æœç´¢è¯çš„é¡µé¢ã€‚\nç”¨æ³•:\nAROUND(X) [somewords] ç¤ºä¾‹:\ngolang AROUND(10) best 12. å¼•å·\u0026quot;\u0026quot; \u0026ldquo;\u0026quot;: å°†æœç´¢è¯åŒ…å«åœ¨å¼•å·ä¸­å°†å¯åŠ¨å¯¹è¯¥çŸ­è¯­çš„å®Œå…¨åŒ¹é…æœç´¢ï¼Œç¡®ä¿å¼•å·ä¸­çš„å†…å®¹å¿…é¡»åœ¨é¡µé¢ä¸Š\nç”¨æ³•:\n\u0026quot;[somewords]\u0026quot; ç¤ºä¾‹:\n\u0026quot;Quantum Network Coding\u0026quot; 13. AND AND: æœç´¢å¹¶é›†\nç”¨æ³•:\n[x] AND [y] ç¤ºä¾‹:\ngolang AND tutorial 14. -(æ¨ªçº¿) -: å·®é›†æ“ä½œ\nç”¨æ³•:\n[x] -[y] ç¤ºä¾‹:\ngolang tutorial -site:youtube.com golang -tutorial 15. *(æ˜Ÿå·) *:é€šé…\nç”¨æ³•:\n[somewords] * [somewords] ç¤ºä¾‹:\nwsl * tutorial 16. () æ‹¬å· (): å°†æœ¯è¯­æˆ–æœç´¢è¿ç®—ç¬¦ç»„åˆåœ¨ä¸€èµ·å¸®åŠ©æ„å»ºæœç´¢æŒ‡ä»¤\nç”¨æ³•:\n[somewords] ([somewords]) ç¤ºä¾‹:\ngolang site:github.com (pr OR commit) 17. OR(æˆ–|ç«–çº¿) OR/|: æˆ–\nç”¨æ³•:\n[x] OR [y] [x] | [y] ç¤ºä¾‹:\ngolang (user OR org) golang (user | org) 18. $/â‚¬ (ç¾å…ƒç¬¦æˆ–è‹±é•‘ç¬¦) $/â‚¬: æœç´¢å•†å“çš„ä»·æ ¼\nç”¨æ³•:\n[merchandise] [price]$ ç¤ºä¾‹:\nmac pro 2000$ 19. Year..Year Year..Year: åœ¨ä¸¤å¹´ä¹‹é—´æ”¾ç½®ä¸¤ä¸ªç‚¹ä¼šä¸ºè¯¥å¹´ä»½èŒƒå›´å†…çš„ç»“æœåˆ›å»ºä¸€ä¸ª Google æœç´¢å‘½ä»¤\nç”¨æ³•:\n[somewords] [Year]..[Year] ç¤ºä¾‹:\nmac 2019..2021 20. info info: æŸ¥è¯¢ç½‘ç«™çš„ç›¸å…³ä¿¡æ¯\nç”¨æ³•:\ninfo:[site] ç¤ºä¾‹:\ninfo:google.com 21. link link: æŸ¥è¯¢æ˜¾ç¤ºæŒ‡å‘é‚£ä¸ªçš„é¡µé¢\nç”¨æ³•:\nlink:[site] ç¤ºä¾‹:\nlink:golang.dev 22. movie movie: æŸ¥è¯¢ç”µå½±\nç”¨æ³•:\nmovie:[movie name or other information about it] ç¤ºä¾‹:\nmovie:Titanic 23. insubject insubject: æŸ¥è¯¢ä¸»é¢˜\nç”¨æ³•:\ninsubject:[subject] ç¤ºä¾‹:\nsite:github.com insubject:Linux 24. define define: æŸ¥è¯¢æœ¯è¯­å®šä¹‰\nç”¨æ³•:\ndefine:[somewords] ç¤ºä¾‹:\ndefine:(Quantum Network) 25. cache cache: æŸ¥è¯¢Googleç¼“å­˜çš„ç½‘é¡µç‰ˆæœ¬ï¼Œè€Œä¸æ˜¯ç½‘é¡µçš„å½“å‰ç‰ˆæœ¬\nç”¨æ³•:\ncache:[site] ç¤ºä¾‹:\ncache:juejin.cn 26. author author: å¦‚æœåœ¨æŸ¥è¯¢ä¸­åŒ…å«author:ï¼ŒGoogleå°†ç½‘ä¸Šè®ºå›ç»“æœé™åˆ¶ä¸ºåŒ…å«æŒ‡å®šçš„ä½œè€…çš„æ–°é—»ç»„æ–‡ç« ã€‚ç”¨äºç½‘ä¸Šè®ºå›æŸ¥è¯¢\nç”¨æ³•:\nauthor:[author] ç¤ºä¾‹:\n children author:doe@someaddress.com References http://www.googleguide.com/advanced_operators_reference.html\n","permalink":"http://yangchnet.github.io/Dessert/posts/%E6%9D%82%E8%AE%B0/google%E6%90%9C%E7%B4%A2%E6%8C%87%E4%BB%A4/","summary":"1. site site: æœç´¢æŒ‡å®šç«™ç‚¹\nç”¨æ³•:\nsite:[example.com] ç¤ºä¾‹:\ngolang site:github.com 2. source source: åœ¨è°·æ­Œæ–°é—»ä¸­æŒ‡å®šæ¥æº\nç”¨æ³•:\nsource:[sourcesite] ç¤ºä¾‹:\nCOVID source:yahoo 3. intext intext: æŸ¥è¯¢çš„å†…å®¹å¿…é¡»å‡ºç°åœ¨æ­£æ–‡ä¸­\nç”¨æ³•:\nintext:[somewords] ç¤ºä¾‹:\nintext:xiaomi 4. allintext allintext: æŸ¥è¯¢çš„æ¯ä¸ªå•è¯éƒ½å¿…é¡»åŒ…å«åœ¨é¡µé¢ä¸­\nç”¨æ³•:\nallintext:[somewords] ç¤ºä¾‹:\nallintext:Quantum Network Coding 5. intitle intitle: æ ‡é¢˜ä¸­åŒ…å«è¦æŸ¥è¯¢çš„å†…å®¹\nç”¨æ³•:\nintitle:[somewords] ç¤ºä¾‹:\nintitle:Quantum 6. allintitle allintitle: ç±»ä¼¼allintext\n7. url url:ç»“æœçš„urlä¸­å¿…é¡»åŒ…å«æŸäº›å†…å®¹\nç”¨æ³•:\nurl:[somewords] ç¤ºä¾‹:\nurl:airpods 8. allinurl allinurl: ç»“æœçš„urlå¿…é¡»åŒ…å«æ‰€æœ‰æŸ¥è¯¢å†…å®¹\n9. filetype filetype: æŸ¥è¯¢çš„ç»“æœæ»¡è¶³æŸç§æ–‡ä»¶ç±»å‹\nç”¨æ³•:\nfiletype:[filetype] ç¤ºä¾‹:\ngolang filetype:pdf 10. related related: æŸ¥æ‰¾æœ‰å…³å†…å®¹","title":"Googleæœç´¢æŒ‡ä»¤"},{"content":"1. install curl https://getcroc.schollz.com | bash æˆ–\ngo install github.com/schollz/croc/v9@latest 2. basic usage sender:\n$ croc send [file(s)-or-folder] Sending \u0026#39;file-or-folder\u0026#39; (X MB) Code is: code-phrase receiver:\ncroc code-phrase 3. comment å¯ç”¨äºæ›¿ä»£ftpä¸Šä¼ æ–‡ä»¶ï¼Œç”¨äºä¸åŒä¸»æœºä¹‹é—´æ–‡ä»¶å…±äº«ï¼Œç±»ä¼¼â€œç©ºæŠ•â€çš„æ•ˆæœ\n","permalink":"http://yangchnet.github.io/Dessert/posts/tool/croc-%E8%B7%A8%E7%BD%91%E7%BB%9C%E8%B7%A8%E7%B3%BB%E7%BB%9F%E7%9A%84%E7%A9%BA%E6%8A%95/","summary":"1. install curl https://getcroc.schollz.com | bash æˆ–\ngo install github.com/schollz/croc/v9@latest 2. basic usage sender:\n$ croc send [file(s)-or-folder] Sending \u0026#39;file-or-folder\u0026#39; (X MB) Code is: code-phrase receiver:\ncroc code-phrase 3. comment å¯ç”¨äºæ›¿ä»£ftpä¸Šä¼ æ–‡ä»¶ï¼Œç”¨äºä¸åŒä¸»æœºä¹‹é—´æ–‡ä»¶å…±äº«ï¼Œç±»ä¼¼â€œç©ºæŠ•â€çš„æ•ˆæœ","title":"croc: è·¨ç½‘ç»œã€è·¨ç³»ç»Ÿçš„ç©ºæŠ•"},{"content":"install z # Download to latest to home dir wget https://raw.githubusercontent.com/rupa/z/master/z.sh -O ~/z.sh # Add to .bashrc echo . /path/to/z.sh \u0026gt;\u0026gt; ~/.bashrc # Add to .zshrc echo . /path/to/z.sh \u0026gt;\u0026gt; ~/.zshrc ","permalink":"http://yangchnet.github.io/Dessert/posts/tool/z/","summary":"install z # Download to latest to home dir wget https://raw.githubusercontent.com/rupa/z/master/z.sh -O ~/z.sh # Add to .bashrc echo . /path/to/z.sh \u0026gt;\u0026gt; ~/.bashrc # Add to .zshrc echo . /path/to/z.sh \u0026gt;\u0026gt; ~/.zshrc ","title":"z"},{"content":" è¿™æ˜¯ä¸€ç¯‡ç†è®ºæ€§è¾ƒå¼ºçš„æ–‡ç« \n 1. HTTP/1çš„ä¸è¶³ä¸é¢ä¸´çš„é—®é¢˜  æ­¤éƒ¨åˆ†å†…å®¹æ¥è‡ªï¼šhttps://segmentfault.com/a/1190000013519925\n 1.1 HTTP/1æ¦‚è¿° 1.2 é˜Ÿå¤´é˜»å¡ æµè§ˆå™¨å¾ˆå°‘åªä»ä¸€ä¸ªåŸŸåè·å–ä¸€ä»½èµ„æºã€‚å¤§å¤šæ•°æ—¶å€™ï¼Œå®ƒå¸Œæœ›èƒ½åŒæ—¶è·å–è®¸å¤šèµ„æºã€‚è®¾æƒ³è¿™æ ·ä¸€ä¸ªç½‘ç«™ï¼Œå®ƒæŠŠæ‰€æœ‰å›¾ç‰‡æ”¾åœ¨å•ä¸ªç‰¹å®šåŸŸåä¸‹ã€‚HTTP/1 å¹¶æœªæä¾›æœºåˆ¶æ¥åŒæ—¶è¯·æ±‚è¿™äº›èµ„æºã€‚å¦‚æœä»…ä»…ä½¿ç”¨ä¸€ä¸ªè¿æ¥ï¼Œå®ƒéœ€è¦å‘èµ·è¯·æ±‚ã€ç­‰å¾…å“åº”ï¼Œä¹‹åæ‰èƒ½å‘èµ·ä¸‹ä¸€ä¸ªè¯·æ±‚ã€‚è¿™æ˜¾ç„¶ä¼šåœ¨åŠ è½½é¡µé¢æ—¶é€ æˆè¾ƒå¤§çš„å»¶è¿Ÿï¼Œé™ä½äº†ç”¨æˆ·ä½“éªŒã€‚\nh1 æœ‰ä¸ªç‰¹æ€§å« ç®¡é“åŒ–(pipelining)ï¼Œå…è®¸ä¸€æ¬¡å‘é€ä¸€ç»„è¿ç»­çš„è¯·æ±‚ï¼Œè€Œä¸ç”¨ç­‰å¾…åº”ç­”è¿”å›ã€‚è¿™æ ·å¯ä»¥é¿å…è¿æ¥å»¶è¿Ÿã€‚ä½†æ˜¯è¯¥ç‰¹æ€§åªèƒ½æŒ‰ç…§å‘é€é¡ºåºä¾æ¬¡æ¥æ”¶å“åº”ã€‚è€Œä¸”ï¼Œç®¡é“åŒ–å¤‡å—äº’æ“ä½œæ€§å’Œéƒ¨ç½²çš„å„ç§é—®é¢˜çš„å›°æ‰°ï¼ŒåŸºæœ¬æ²¡æœ‰å®ç”¨ä»·å€¼ã€‚\nåœ¨è¯·æ±‚åº”ç­”è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå‡ºç°ä»»ä½•çŠ¶å†µï¼Œå‰©ä¸‹æ‰€æœ‰çš„å·¥ä½œéƒ½ä¼šè¢«é˜»å¡åœ¨é‚£æ¬¡è¯·æ±‚åº”ç­”ä¹‹åã€‚è¿™å°±æ˜¯é˜Ÿå¤´é˜»å¡ï¼ˆHead-of-line blockingæˆ–ç¼©å†™ä¸ºHOL blockingï¼‰ï¼Œå®ƒä¼šé˜»ç¢ç½‘ç»œä¼ è¾“å’Œ Web é¡µé¢æ¸²æŸ“ï¼Œç›´è‡³å¤±å»å“åº”ã€‚\nä¸ºäº†é˜²æ­¢è¿™ç§é—®é¢˜ï¼Œç°ä»£æµè§ˆå™¨ä¼šé’ˆå¯¹å•ä¸ªåŸŸåå¼€å¯ 6 ä¸ªè¿æ¥ï¼Œé€šè¿‡å„ä¸ªè¿æ¥åˆ†åˆ«å‘é€è¯·æ±‚ã€‚å®ƒå®ç°äº†æŸç§ç¨‹åº¦ä¸Šçš„å¹¶è¡Œï¼Œä½†æ˜¯æ¯ä¸ªè¿æ¥ä»ä¼šå—åˆ° é˜Ÿå¤´é˜»å¡ çš„å½±å“ã€‚å¦å¤–ï¼Œè¿™ä¹Ÿæ²¡æœ‰é«˜æ•ˆåˆ©ç”¨æœ‰é™çš„è®¾å¤‡èµ„æºã€‚\n1.3 TCPå¤ç”¨ ä¼ è¾“æ§åˆ¶åè®®(TCP) çš„è®¾è®¡æ€è·¯æ˜¯ï¼šå¯¹å‡è®¾æƒ…å†µå¾ˆä¿å®ˆï¼Œå¹¶èƒ½å¤Ÿå…¬å¹³å¯¹å¾…åŒä¸€ç½‘ç»œçš„ä¸åŒæµé‡çš„åº”ç”¨ã€‚å®ƒçš„é¿å…æ‹¥å¡æœºåˆ¶è¢«è®¾è®¡æˆå³ä½¿åœ¨æœ€å·®çš„ç½‘ç»œçŠ¶å†µä¸‹ä»èƒ½èµ·ä½œç”¨ï¼Œå¹¶ä¸”å¦‚æœæœ‰éœ€æ±‚å†²çªä¹Ÿä¿è¯ç›¸å¯¹å…¬å¹³ã€‚è¿™æ˜¯å®ƒå–å¾—æˆåŠŸçš„åŸå› ä¹‹ä¸€ã€‚\nå®ƒçš„æˆåŠŸå¹¶ä¸æ˜¯å› ä¸ºä¼ è¾“æ•°æ®æœ€å¿«ï¼Œè€Œæ˜¯å› ä¸ºå®ƒæ˜¯æœ€å¯é çš„åè®®ä¹‹ä¸€ï¼Œæ¶‰åŠçš„æ ¸å¿ƒæ¦‚å¿µå°±æ˜¯ æ‹¥å¡çª—å£(congestion window) ã€‚æ‹¥å¡çª—å£æ˜¯æŒ‡ï¼Œåœ¨æ¥æ”¶æ–¹ç¡®è®¤æ•°æ®åŒ…ä¹‹å‰ï¼Œå‘é€æ–¹å¯ä»¥å‘å‡ºçš„ TCP åŒ…çš„æ•°é‡ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœæ‹¥å¡çª—å£æŒ‡å®šä¸º 1ï¼Œé‚£ä¹ˆå‘é€æ–¹å‘å‡º 1 ä¸ªæ•°æ®åŒ…ä¹‹åï¼Œåªæœ‰æ¥æ”¶æ–¹ç¡®è®¤äº†é‚£ä¸ªåŒ…ï¼Œæ‰èƒ½å‘é€ä¸‹ä¸€ä¸ªã€‚\nä¸€èˆ¬æ¥è®²ï¼Œæ¯æ¬¡å‘é€ä¸€ä¸ªæ•°æ®åŒ…å¹¶ä¸æ˜¯éå¸¸ä½æ•ˆã€‚TCP æœ‰ä¸ªæ¦‚å¿µå« æ…¢å¯åŠ¨(Slow Start)ï¼Œ å®ƒç”¨æ¥æ¢ç´¢å½“å‰è¿æ¥å¯¹åº”æ‹¥å¡çª—å£çš„åˆé€‚å¤§å°ã€‚æ…¢å¯åŠ¨çš„è®¾è®¡ç›®æ ‡æ˜¯ä¸ºäº†è®©æ–°è¿æ¥ææ¸…æ¥šå½“å‰ç½‘ç»œçŠ¶å†µï¼Œé¿å…ç»™å·²ç»æ‹¥å µçš„ç½‘ç»œç»§ç»­æ·»ä¹±ã€‚å®ƒå…è®¸å‘é€è€…åœ¨æ”¶åˆ°æ¯ä¸ªç¡®è®¤å›å¤åé¢å¤–å‘é€ 1 ä¸ªæœªç¡®è®¤åŒ…ã€‚è¿™æ„å‘³ç€æ–°è¿æ¥åœ¨æ”¶åˆ° 1 ä¸ªç¡®è®¤å›å¤ä¹‹åï¼Œå¯ä»¥å‘é€ 2 ä¸ªæ•°æ®åŒ…; åœ¨æ”¶åˆ° 2 ä¸ªç¡®è®¤å›å¤ä¹‹åï¼Œå¯ä»¥å‘ 4 ä¸ªï¼›ä»¥æ­¤ç±»æ¨ã€‚è¿™ç§å‡ ä½•çº§æ•°å¢é•¿å¾ˆå¿«å°±ä¼šåˆ°è¾¾åè®®è§„å®šçš„å‘åŒ…æ•°ä¸Šé™ï¼Œè¿™æ—¶å€™è¿æ¥å°†è¿›å…¥æ‹¥å¡é¿å…é˜¶æ®µ è¿™ç§æœºåˆ¶éœ€è¦å‡ æ¬¡å¾€è¿”æ•°æ®è¯·æ±‚æ‰èƒ½å¾—çŸ¥æœ€ä½³æ‹¥å¡çª—å£å¤§å°ã€‚ä½†åœ¨è§£å†³æ€§èƒ½é—®é¢˜æ—¶ï¼Œå°±è¿™ åŒºåŒºå‡ æ¬¡æ•°æ®å¾€è¿”ä¹Ÿæ˜¯éå¸¸å®è´µçš„æ—¶é—´(æˆæœ¬)ã€‚ç°ä»£æ“ä½œç³»ç»Ÿä¸€èˆ¬ä¼šå– 4~10 ä¸ªæ•°æ®åŒ…ä½œä¸ºåˆå§‹æ‹¥å¡çª—å£å¤§å°ã€‚å¦‚æœä½ æŠŠä¸€ä¸ªæ•°æ®åŒ…è®¾ç½®ä¸ºæœ€å¤§å€¼ä¸‹é™ 1460 å­—èŠ‚(ä¹Ÿå°±æ˜¯ æœ€å¤§æœ‰æ•ˆè´Ÿè½½)ï¼Œé‚£ä¹ˆåªèƒ½å…ˆå‘é€ 5840 å­—èŠ‚(å‡å®šæ‹¥å¡çª—å£ä¸º 4)ï¼Œç„¶åå°±éœ€è¦ç­‰å¾…æ¥æ”¶ç¡®è®¤å›å¤ã€‚\nå¦‚ä»Šçš„ Web é¡µé¢å¹³å‡å¤§å°çº¦ 2MBï¼ŒåŒ…æ‹¬ HTML å’Œæ‰€æœ‰ä¾èµ–çš„èµ„æºã€‚åœ¨ç†æƒ³æƒ…å†µä¸‹ï¼Œ è¿™éœ€è¦å¤§çº¦ 9 æ¬¡å¾€è¿”è¯·æ±‚æ¥ä¼ è¾“å®Œæ•´ä¸ªé¡µé¢ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæµè§ˆå™¨ä¸€èˆ¬ä¼šé’ˆå¯¹åŒä¸€ä¸ªåŸŸåå¼€å¯ 6 ä¸ªå¹¶å‘è¿æ¥ï¼Œè¿™æ„å‘³ç€æ‹¥å¡çª—å£æ³¢åŠ¨ä¹Ÿä¼šå¹¶è¡Œå‘ç”Ÿ 6 æ¬¡ã€‚TCP åè®®ä¿è¯é‚£äº›è¿æ¥éƒ½èƒ½æ­£å¸¸å·¥ä½œï¼Œ ä½†æ˜¯ä¸èƒ½ä¿è¯å®ƒä»¬çš„æ€§èƒ½æ˜¯æœ€ä¼˜çš„ã€‚\n1.4 æ¶ˆæ¯é¦–éƒ¨ è™½ç„¶ h1 æä¾›äº†å‹ç¼©è¢«è¯·æ±‚å†…å®¹çš„æœºåˆ¶ï¼Œä½†æ˜¯æ¶ˆæ¯é¦–éƒ¨å´æ— æ³•å‹ç¼©ã€‚æ¶ˆæ¯é¦–éƒ¨å¯ä¸èƒ½å¿½ç•¥ï¼Œ å°½ç®¡å®ƒæ¯”å“åº”èµ„æºå°å¾ˆå¤šï¼Œä½†å®ƒå¯èƒ½å æ®è¯·æ±‚çš„ç»å¤§éƒ¨åˆ†(æœ‰æ—¶å€™å¯èƒ½æ˜¯å…¨éƒ¨)ã€‚å¦‚æœç®— ä¸Š cookieï¼Œæœ‰ä¸ªå‡ åƒå­—èŠ‚å°±å¾ˆæ­£å¸¸äº†ã€‚\næ® HTTP å†å²å­˜æ¡£è®°å½•ï¼Œ2016 å¹´æœ«ï¼Œè¯·æ±‚é¦–éƒ¨ä¸€èˆ¬é›†ä¸­åœ¨ 460 å­—èŠ‚å·¦å³ã€‚å¯¹äºåŒ…å« 140 ä¸ª èµ„æºçš„æ™®é€šWeb é¡µé¢ï¼Œæ„å‘³ç€å®ƒåœ¨å‘èµ·çš„æ‰€æœ‰è¯·æ±‚ä¸­å¤§çº¦å  63KBã€‚\næƒ³æƒ³ä¹‹å‰å…³äº TCP æ‹¥å¡çª—å£ç®¡ç†çš„è®¨è®ºï¼Œå‘é€è¯¥é¡µé¢ç›¸å…³çš„æ‰€æœ‰è¯·æ±‚å¯èƒ½éœ€è¦ 3~4 è½®å¾€è¿”ï¼Œå› æ­¤ç½‘ç»œå»¶è¿Ÿçš„æŸè€—ä¼šè¢«è¿…é€Ÿæ”¾å¤§ã€‚æ­¤å¤–ï¼Œä¸Šè¡Œå¸¦å®½é€šå¸¸ä¼šå—åˆ°ç½‘ç»œé™åˆ¶ï¼Œå°¤å…¶æ˜¯åœ¨ç§»åŠ¨ç½‘ç»œç¯å¢ƒä¸­ï¼Œäºæ˜¯æ‹¥å¡çª—å£æœºåˆ¶æ ¹æœ¬æ¥ä¸åŠèµ·ä½œç”¨ï¼Œå¯¼è‡´æ›´å¤šçš„è¯·æ±‚å’Œå“åº”ã€‚\næ¶ˆæ¯é¦–éƒ¨å‹ç¼©çš„ç¼ºå¤±ä¹Ÿå®¹æ˜“å¯¼è‡´å®¢æˆ·ç«¯åˆ°è¾¾å¸¦å®½ä¸Šé™ï¼Œå¯¹äºä½å¸¦å®½æˆ–é«˜æ‹¥å µçš„é“¾è·¯å°¤å…¶å¦‚æ­¤ã€‚ä½“è‚²é¦†æ•ˆåº”(Stadium Effect) å°±æ˜¯ä¸€ä¸ªç»å…¸ä¾‹å­ã€‚å¦‚æœæˆåƒä¸Šä¸‡äººåŒä¸€æ—¶é—´å‡ºç°åœ¨åŒä¸€åœ°ç‚¹(ä¾‹å¦‚é‡å¤§ä½“è‚²èµ›äº‹)ï¼Œä¼šè¿…é€Ÿè€—å°½æ— çº¿èœ‚çªç½‘ç»œå¸¦å®½ã€‚è¿™æ—¶å€™ï¼Œå¦‚æœèƒ½å‹ç¼©è¯·æ±‚é¦–éƒ¨ï¼ŒæŠŠè¯·æ±‚å˜å¾—æ›´å°ï¼Œå°±èƒ½å¤Ÿç¼“è§£å¸¦å®½å‹åŠ›ï¼Œé™ä½ç³»ç»Ÿçš„æ€»è´Ÿè½½ã€‚\n1.5 ä¼˜å…ˆçº§è®¾ç½®å—é™ å¦‚æœæµè§ˆå™¨é’ˆå¯¹æŒ‡å®šåŸŸåå¼€å¯äº†å¤šä¸ª socket(æ¯ä¸ªéƒ½ä¼šå—é˜Ÿå¤´é˜»å¡é—®é¢˜çš„å›°æ‰°)ï¼Œå¼€å§‹è¯·æ±‚èµ„æºï¼Œè¿™æ—¶å€™æµè§ˆå™¨èƒ½æŒ‡å®šä¼˜å…ˆçº§çš„æ–¹å¼æ˜¯æœ‰é™çš„ï¼šè¦ä¹ˆå‘èµ·è¯·æ±‚ï¼Œè¦ä¹ˆä¸å‘èµ·ã€‚\nç„¶è€Œ Web é¡µé¢ä¸ŠæŸäº›èµ„æºä¼šæ¯”å¦ä¸€äº›æ›´é‡è¦ï¼Œè¿™å¿…ç„¶ä¼šåŠ é‡èµ„æºçš„ æ’é˜Ÿæ•ˆåº”ã€‚è¿™æ˜¯å› ä¸ºæµè§ˆå™¨ä¸ºäº†å…ˆè¯·æ±‚ä¼˜å…ˆçº§é«˜çš„èµ„æºï¼Œä¼šæ¨è¿Ÿè¯·æ±‚å…¶ä»–èµ„æºã€‚\nä½†æ˜¯ä¼˜å…ˆçº§é«˜çš„èµ„æºè·å–ä¹‹åï¼Œåœ¨å¤„ç†çš„è¿‡ç¨‹ä¸­ï¼Œæµè§ˆå™¨å¹¶ä¸ä¼šå‘èµ·æ–°çš„èµ„æºè¯·æ±‚ï¼Œæ‰€ä»¥æœåŠ¡å™¨æ— æ³•åˆ©ç”¨è¿™æ®µæ—¶é—´å‘é€ä¼˜å…ˆçº§ä½çš„èµ„æºï¼Œæ€»çš„é¡µé¢ä¸‹è½½æ—¶é—´å› æ­¤å»¶é•¿äº†ã€‚è¿˜ä¼šå‡ºç°è¿™æ ·çš„æƒ…å†µï¼šä¸€ä¸ªé«˜ä¼˜å…ˆçº§èµ„æºè¢«æµè§ˆå™¨å‘ç°ï¼Œä½†æ˜¯å—åˆ¶äºæµè§ˆå™¨å¤„ç†çš„æ–¹å¼ï¼Œå®ƒè¢«æ’åœ¨äº†ä¸€ä¸ªæ­£åœ¨è·å–çš„ä½ä¼˜å…ˆçº§èµ„æºä¹‹åã€‚\n  ä»¥ä¸‹å†…å®¹æ¥è‡ªï¼šRFC7540\n 2. HTTP/2æ¦‚è¿° HTTP/2 ä¸º HTTP è¯­ä¹‰æä¾›äº†ä¼˜åŒ–çš„ä¼ è¾“ã€‚HTTP/2 æ”¯æŒ HTTP/1.1 çš„æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½ï¼Œä½†æ—¨åœ¨é€šè¿‡å¤šç§æ–¹å¼æé«˜æ•ˆç‡ã€‚\nHTTP/2 ä¸­çš„åŸºæœ¬åè®®å•å…ƒæ˜¯å¸§ã€‚æ¯ç§å¸§ç±»å‹éƒ½æœ‰ä¸åŒçš„ç”¨é€”ã€‚ä¾‹å¦‚ï¼ŒHEADERSå’ŒDATAå¸§æ„æˆäº† HTTP è¯·æ±‚å’Œå“åº”çš„åŸºç¡€ï¼›å…¶ä»–å¸§ç±»å‹å¦‚SETTINGSã€WINDOW_UPDATEå’ŒPUSH_PROMISEç”¨äºæ”¯æŒå…¶ä»– HTTP/2 åŠŸèƒ½ã€‚\nè¯·æ±‚çš„å¤ç”¨æ˜¯é€šè¿‡è®©æ¯ä¸ª HTTP è¯·æ±‚/å“åº”äº¤æ¢ä¸å…¶è‡ªå·±çš„æµç›¸å…³è”æ¥å®ç°çš„ã€‚æµåœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå½¼æ­¤ç‹¬ç«‹ï¼Œå› æ­¤é˜»å¡æˆ–åœæ»çš„è¯·æ±‚æˆ–å“åº”ä¸ä¼šé˜»æ­¢å…¶ä»–æµçš„è¿›å±•ã€‚\næµæ§åˆ¶å’Œä¼˜å…ˆçº§ç¡®ä¿å¯ä»¥æœ‰æ•ˆåœ°ä½¿ç”¨å¤šè·¯å¤ç”¨æµã€‚æµé‡æ§åˆ¶æœ‰åŠ©äºç¡®ä¿ä»…ä¼ è¾“æ¥æ”¶å™¨å¯ä»¥ä½¿ç”¨çš„æ•°æ®ã€‚ä¼˜å…ˆçº§ç¡®ä¿å¯ä»¥å°†æœ‰é™çš„èµ„æºé¦–å…ˆç”¨äºæœ€é‡è¦çš„æµã€‚\nHTTP/2 æ·»åŠ äº†ä¸€ç§æ–°çš„äº¤äº’æ¨¡å¼ï¼ŒæœåŠ¡å™¨å¯ä»¥é€šè¿‡è¿™ç§æ¨¡å¼å°†å“åº”æ¨é€åˆ°å®¢æˆ·ç«¯ã€‚æœåŠ¡å™¨æ¨é€å…è®¸æœåŠ¡å™¨æ¨æµ‹æ€§åœ°å°†æ•°æ®å‘é€åˆ°æœåŠ¡å™¨é¢„æœŸå®¢æˆ·ç«¯éœ€è¦çš„å®¢æˆ·ç«¯ï¼Œæƒè¡¡ä¸€äº›ç½‘ç»œä½¿ç”¨ä¸æ½œåœ¨çš„å»¶è¿Ÿå¢ç›Šã€‚æœåŠ¡å™¨é€šè¿‡åˆæˆä¸€ä¸ªè¯·æ±‚æ¥åšåˆ°è¿™ä¸€ç‚¹ï¼Œå®ƒä½œä¸ºä¸€ä¸ªPUSH_PROMISEå¸§å‘é€ã€‚ç„¶åï¼ŒæœåŠ¡å™¨èƒ½å¤Ÿåœ¨å•ç‹¬çš„æµä¸Šå‘é€å¯¹åˆæˆè¯·æ±‚çš„å“åº”ã€‚\nç”±äºè¿æ¥ä¸­ä½¿ç”¨çš„ HTTP æ ‡å¤´å­—æ®µå¯èƒ½åŒ…å«å¤§é‡å†—ä½™æ•°æ®ï¼Œå› æ­¤åŒ…å«å®ƒä»¬çš„å¸§ä¼šè¢«å‹ç¼©ã€‚è¿™å¯¹å¸¸è§æƒ…å†µä¸‹çš„è¯·æ±‚å¤§å°å…·æœ‰ç‰¹åˆ«æœ‰åˆ©çš„å½±å“ï¼Œå…è®¸å°†è®¸å¤šè¯·æ±‚å‹ç¼©ä¸ºä¸€ä¸ªæ•°æ®åŒ…ã€‚\n3. HTTP/2å¸§ 3.1 å¸§æ ¼å¼ æ‰€æœ‰å¸§éƒ½ä»¥å›ºå®šçš„ 9 ä¸ªå…«ä½å­—èŠ‚æ ‡å¤´å¼€å§‹ï¼Œåè·Ÿå¯å˜é•¿åº¦çš„æœ‰æ•ˆè½½è·ã€‚\n +-----------------------------------------------+ | é•¿åº¦ (24) | +---------------+---------------+---------------+ | ç±»å‹ (8) | æ——å¸œ (8) | +-+-------------+---------------+-------------------------------+ |R| æµæ ‡è¯†ç¬¦ (31) | +=+=============================================================+ | å¸§æœ‰æ•ˆè½½è· (0...) ... +---------------------------------------------------------------+ å¸§å¤´çš„å­—æ®µå®šä¹‰ä¸ºï¼š\n  é•¿åº¦ï¼š ä»¥æ— ç¬¦å· 24 ä½æ•´æ•°è¡¨ç¤ºçš„å¸§æœ‰æ•ˆè½½è·çš„é•¿åº¦ã€‚é™¤éæ¥æ”¶æ–¹ä¸ºSETTINGS_MAX_FRAME_SIZEè®¾ç½®äº†æ›´å¤§çš„å€¼ï¼Œå¦åˆ™ä¸å¾—å‘é€å¤§äº $2^14$ (16,384) çš„å€¼ã€‚ è¯¥å€¼ä¸­ä¸åŒ…æ‹¬å¸§å¤´çš„ 9 ä¸ªå…«ä½å­—èŠ‚ã€‚\n  ç±»å‹ï¼š å¸§çš„ 8 ä½ç±»å‹ã€‚å¸§ç±»å‹å†³å®šäº†å¸§çš„æ ¼å¼å’Œè¯­ä¹‰ã€‚å®ç°å¿…é¡»å¿½ç•¥å¹¶ä¸¢å¼ƒä»»ä½•ç±»å‹æœªçŸ¥çš„å¸§ã€‚\n  æ ‡å¿—ï¼š ä¸ºç‰¹å®šäºå¸§ç±»å‹çš„å¸ƒå°”æ ‡å¿—ä¿ç•™çš„ 8 ä½å­—æ®µã€‚\n  æ ‡å¿—è¢«åˆ†é…ç‰¹å®šäºæŒ‡ç¤ºçš„å¸§ç±»å‹çš„è¯­ä¹‰ã€‚å¯¹äºç‰¹å®šå¸§ç±»å‹æ²¡æœ‰å®šä¹‰è¯­ä¹‰çš„æ ‡å¿—å¿…é¡»è¢«å¿½ç•¥å¹¶ä¸”åœ¨å‘é€æ—¶å¿…é¡»ä¿æŒæœªè®¾ç½® (0x0)ã€‚\n  å›å¤ï¼š ä¿ç•™çš„ 1 ä½å­—æ®µã€‚è¯¥ä½çš„è¯­ä¹‰æœªå®šä¹‰ï¼Œå¹¶ä¸”è¯¥ä½åœ¨å‘é€æ—¶å¿…é¡»ä¿æŒæœªè®¾ç½® (0x0)ï¼Œåœ¨æ¥æ”¶æ—¶å¿…é¡»è¢«å¿½ç•¥ã€‚\n  æµæ ‡è¯†ç¬¦ï¼š è¡¨ç¤ºä¸ºæ— ç¬¦å· 31 ä½æ•´æ•°çš„æµæ ‡è¯†ç¬¦ï¼ˆå‚è§ç¬¬ 5.1.1 èŠ‚ï¼‰ã€‚å€¼ 0x0 ä¿ç•™ç”¨äºä¸æ•´ä¸ªè¿æ¥ç›¸å…³è”çš„å¸§ï¼Œè€Œä¸æ˜¯å•ä¸ªæµã€‚\n  å¸§æœ‰æ•ˆè½½è·çš„ç»“æ„å’Œå†…å®¹å®Œå…¨å–å†³äºå¸§ç±»å‹\n3.2 å¸§å¤§å° å¸§æœ‰æ•ˆè½½è·çš„å¤§å°å—æ¥æ”¶å™¨åœ¨SETTINGS_MAX_FRAME_SIZEè®¾ç½®ä¸­é€šå‘Šçš„æœ€å¤§å¤§å°çš„é™åˆ¶ã€‚æ­¤è®¾ç½®å¯ä»¥å…·æœ‰ $2^14$ (16,384) å’Œ $2^24 -1$ (16,777,215) ä¸ªå…«ä½å­—èŠ‚ä¹‹é—´çš„ä»»ä½•å€¼ï¼ŒåŒ…æ‹¬ä¸¤ä¸ªå­—èŠ‚ã€‚\næ‰€æœ‰å®ç°éƒ½å¿…é¡»èƒ½å¤Ÿæ¥æ”¶å’Œæœ€å°‘å¤„ç†é•¿è¾¾ $2^14$ ä¸ªå…«ä½å­—èŠ‚çš„å¸§ï¼ŒåŠ ä¸Š 9 ä¸ªå…«ä½å­—èŠ‚çš„å¸§å¤´ã€‚æè¿°å¸§å¤§å°æ—¶ä¸åŒ…æ‹¬å¸§å¤´çš„å¤§å°ã€‚\næ³¨æ„ï¼šæŸäº›å¸§ç±»å‹ï¼Œä¾‹å¦‚ PINGï¼Œå¯¹å…è®¸çš„æœ‰æ•ˆè½½è·æ•°æ®é‡æ–½åŠ äº†é¢å¤–çš„é™åˆ¶ã€‚\nå¦‚æœå¸§è¶…è¿‡SETTINGS_MAX_FRAME_SIZE ä¸­å®šä¹‰çš„å¤§å°ï¼Œè¶…è¿‡ä¸ºå¸§ç±»å‹å®šä¹‰çš„ä»»ä½•é™åˆ¶ï¼Œæˆ–è€…å¤ªå°è€Œæ— æ³•åŒ…å«å¼ºåˆ¶æ€§å¸§æ•°æ®ï¼Œåˆ™ç«¯ç‚¹å¿…é¡»å‘é€é”™è¯¯ä»£ç FRAME_SIZE_ERRORã€‚å¸§ä¸­å¯èƒ½æ”¹å˜æ•´ä¸ªè¿æ¥çŠ¶æ€çš„å¸§å¤§å°é”™è¯¯å¿…é¡»è¢«è§†ä¸ºè¿æ¥é”™è¯¯ï¼›è¿™åŒ…æ‹¬ä»»ä½•å¸¦æœ‰æ ‡é¢˜å—ï¼ˆå³HEADERSã€PUSH_PROMISEå’ŒCONTINUATIONï¼‰ã€SETTINGS çš„å¸§ï¼Œä»¥åŠä»»ä½•æµæ ‡è¯†ç¬¦ä¸º 0 çš„å¸§ã€‚\nç«¯ç‚¹æ²¡æœ‰ä¹‰åŠ¡ä½¿ç”¨å¸§ä¸­çš„æ‰€æœ‰å¯ç”¨ç©ºé—´ã€‚å¯ä»¥é€šè¿‡ä½¿ç”¨å°äºå…è®¸çš„æœ€å¤§å°ºå¯¸çš„å¸§æ¥æé«˜å“åº”èƒ½åŠ›ã€‚å‘é€å¤§å¸§å¯èƒ½ä¼šå¯¼è‡´å‘é€æ—¶é—´æ•æ„Ÿå¸§ï¼ˆä¾‹å¦‚RST_STREAMã€WINDOW_UPDATEæˆ–PRIORITYï¼‰çš„å»¶è¿Ÿï¼Œå¦‚æœè¢«å¤§å¸§çš„ä¼ è¾“é˜»å¡ï¼Œåˆ™å¯èƒ½ä¼šå½±å“æ€§èƒ½\n3.3 å¤´å‹ç¼©å’Œè§£å‹ å°±åƒåœ¨ HTTP/1 ä¸­ä¸€æ ·ï¼ŒHTTP/2 ä¸­çš„æ ‡å¤´å­—æ®µæ˜¯ä¸€ä¸ªå…·æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå…³è”å€¼çš„åç§°ã€‚æ ‡å¤´å­—æ®µç”¨äº HTTP è¯·æ±‚å’Œå“åº”æ¶ˆæ¯ä»¥åŠæœåŠ¡å™¨æ¨é€æ“ä½œã€‚\næ ‡é¢˜åˆ—è¡¨æ˜¯é›¶ä¸ªæˆ–å¤šä¸ªæ ‡é¢˜å­—æ®µçš„é›†åˆã€‚å½“é€šè¿‡è¿æ¥ä¼ è¾“æ—¶ï¼Œæ ‡å¤´åˆ—è¡¨ä½¿ç”¨HTTP æ ‡å¤´å‹ç¼© [COMPRESSION]åºåˆ—åŒ–ä¸ºæ ‡å¤´å—ã€‚ç„¶åå°†åºåˆ—åŒ–çš„å¤´å—åˆ†æˆä¸€ä¸ªæˆ–å¤šä¸ªå…«ä½å­—èŠ‚åºåˆ—ï¼Œç§°ä¸ºå¤´å—ç‰‡æ®µï¼Œå¹¶åœ¨ HEADERSã€PUSH_PROMISEæˆ– CONTINUATIONå¸§çš„æœ‰æ•ˆè½½è·å†…ä¼ è¾“ã€‚\nè¯¥Cookieå¤´å­—æ®µ [COOKIE]æ˜¯ç”±HTTPæ˜ å°„ç‰¹æ®Šå¤„ç†ã€‚\næ¥æ”¶ç«¯ç‚¹é€šè¿‡è¿æ¥å…¶ç‰‡æ®µæ¥é‡æ–°ç»„è£…å¤´å—ï¼Œç„¶åè§£å‹ç¼©å—ä»¥é‡å»ºå¤´åˆ—è¡¨ã€‚\nä¸€ä¸ªå®Œæ•´çš„å¤´å—åŒ…æ‹¬ï¼š\n è®¾ç½®äº† END_HEADERS æ ‡å¿—çš„å•ä¸ªHEADERSæˆ–PUSH_PROMISEå¸§ï¼Œæˆ– æ¸…é™¤äº† END_HEADERS æ ‡å¿—çš„HEADERSæˆ–PUSH_PROMISEå¸§å’Œä¸€ä¸ªæˆ–å¤šä¸ªCONTINUATIONå¸§ï¼Œå…¶ä¸­æœ€åä¸€ä¸ªCONTINUATIONå¸§è®¾ç½®äº† END_HEADERS æ ‡å¿—ã€‚  æ ‡å¤´å‹ç¼©æ˜¯æœ‰çŠ¶æ€çš„ã€‚æ•´ä¸ªè¿æ¥ä½¿ç”¨ä¸€ä¸ªå‹ç¼©ä¸Šä¸‹æ–‡å’Œä¸€ä¸ªè§£å‹ç¼©ä¸Šä¸‹æ–‡ã€‚å¤´å—ä¸­çš„è§£ç é”™è¯¯å¿…é¡»è¢«è§†ä¸ºCOMPRESSION_ERRORç±»å‹çš„è¿æ¥é”™è¯¯ã€‚\næ¯ä¸ªæ ‡é¢˜å—éƒ½ä½œä¸ºä¸€ä¸ªç¦»æ•£å•å…ƒè¿›è¡Œå¤„ç†ã€‚å¤´å—å¿…é¡»ä½œä¸ºè¿ç»­çš„å¸§åºåˆ—ä¼ è¾“ï¼Œæ²¡æœ‰ä»»ä½•å…¶ä»–ç±»å‹çš„äº¤é”™å¸§æˆ–æ¥è‡ªä»»ä½•å…¶ä»–æµã€‚HEADERSæˆ–CONTINUATIONå¸§åºåˆ—ä¸­çš„æœ€åä¸€å¸§è®¾ç½®äº† END_HEADERS æ ‡å¿—ã€‚PUSH_PROMISEæˆ–CONTINUATIONå¸§åºåˆ—ä¸­çš„æœ€åä¸€å¸§è®¾ç½®äº† END_HEADERS æ ‡å¿—ã€‚è¿™å…è®¸æ ‡é¢˜å—åœ¨é€»è¾‘ä¸Šç­‰åŒäºå•ä¸ªå¸§ã€‚\næ ‡å¤´å—ç‰‡æ®µåªèƒ½ä½œä¸ºHEADERSã€PUSH_PROMISEæˆ–CONTINUATIONå¸§çš„æœ‰æ•ˆè½½è·å‘é€ï¼Œå› ä¸ºè¿™äº›å¸§æºå¸¦çš„æ•°æ®å¯ä»¥ä¿®æ”¹æ¥æ”¶å™¨ç»´æŠ¤çš„å‹ç¼©ä¸Šä¸‹æ–‡ã€‚æ¥æ”¶HEADERSã€PUSH_PROMISEæˆ–CONTINUATIONå¸§çš„ç«¯ç‚¹éœ€è¦é‡æ–°ç»„è£…å¤´å—å¹¶æ‰§è¡Œè§£å‹ç¼©ï¼Œå³ä½¿è¿™äº›å¸§å°†è¢«ä¸¢å¼ƒã€‚å¦‚æœæ¥æ”¶æ–¹æ²¡æœ‰è§£å‹ç¼©å¤´å—ï¼Œåˆ™æ¥æ”¶æ–¹å¿…é¡»ä»¥COMPRESSION_ERRORç±»å‹çš„è¿æ¥é”™è¯¯ç»ˆæ­¢è¿æ¥ã€‚\n4. æµå’Œå¤ç”¨ â€œæµâ€æ˜¯åœ¨ HTTP/2 è¿æ¥å†…åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´äº¤æ¢çš„ç‹¬ç«‹çš„åŒå‘å¸§åºåˆ—ã€‚æµæœ‰å‡ ä¸ªé‡è¦çš„ç‰¹å¾ï¼š\n å•ä¸ª HTTP/2 è¿æ¥å¯ä»¥åŒ…å«å¤šä¸ªå¹¶å‘æ‰“å¼€çš„æµï¼Œå…¶ä¸­ä»»ä¸€ç«¯ç‚¹äº¤é”™æ¥è‡ªå¤šä¸ªæµçš„å¸§ã€‚ æµå¯ä»¥å•æ–¹é¢å»ºç«‹å’Œä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ç”±å®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨å…±äº«ã€‚ æµå¯ä»¥è¢«ä»»ä¸€ç«¯ç‚¹å…³é—­ã€‚ åœ¨æµä¸Šå‘é€å¸§çš„é¡ºåºå¾ˆé‡è¦ã€‚æ¥æ”¶è€…æŒ‰ç…§æ¥æ”¶åˆ°çš„é¡ºåºå¤„ç†å¸§ã€‚ç‰¹åˆ«æ˜¯ï¼ŒHEADERSå’ŒDATAå¸§çš„é¡ºåºåœ¨è¯­ä¹‰ä¸Šå¾ˆé‡è¦ã€‚ æµç”±ä¸€ä¸ªæ•´æ•°æ ‡è¯†ã€‚æµæ ‡è¯†ç¬¦ç”±å‘èµ·æµçš„ç«¯ç‚¹åˆ†é…ç»™æµã€‚  4.1 æµçŠ¶æ€ æµçš„ç”Ÿå‘½å‘¨æœŸå¦‚å›¾æ‰€ç¤º:\n +--------+ é€PP | | æ¥æ”¶PP ,--------| é—²ç½®|--------ã€‚ / | | \\ v + -------- + v +----------+ | +----------+ | | | å‘é€ H / | | ,------| ä¿ç•™ | | æ¥æ”¶ H | ä¿ç•™|------ã€‚ | | (æœ¬åœ°) | | | ï¼ˆè¿œç¨‹ï¼‰ | | | + ---------- + v + ---------- + | | | +--------+ | | | | æ¥æ”¶ EN | | å‘é€ EN | | | é€H | ,-------| æ‰“å¼€|-------ã€‚| æ¥æ”¶ H | | | / | | \\ | | | vv + -------- + vv | | +----------+ | +----------+ | | | ä¸€åŠ| | | ä¸€åŠ| | | | å…³é—­ | | å‘é€ R / | å…³é—­ | | | | ï¼ˆè¿œç¨‹ï¼‰ | | æ¥æ”¶ R | (æœ¬åœ°) | | | +----------+ | +----------+ | | | | | | | | å‘é€ ES / | æ¥æ”¶ EN / | | | | å‘é€ R / v å‘é€ R / | | | | æ¥æ”¶ R +--------+ æ¥æ”¶ R | | | å‘é€ R /`-----------\u0026gt;| |\u0026lt;-----------' å‘é€ R / | | æ¥æ”¶ R | å…³é—­ | æ¥æ”¶ R | `-----------------------\u0026gt;| |\u0026lt;----------------------' +--------+ å‘é€ï¼šç«¯ç‚¹å‘é€æ­¤å¸§ recvï¼šç«¯ç‚¹æ¥æ”¶æ­¤å¸§ Hï¼šHEADERS æ¡†æ¶ï¼ˆå¸¦æœ‰éšå«çš„ CONTINUATIONï¼‰ PPï¼šPUSH_PROMISE æ¡†æ¶ï¼ˆå¸¦æœ‰éšå«çš„ CONTINUATIONï¼‰ ESï¼šEND_STREAM æ ‡å¿— Rï¼šRST_STREAM å¸§ è¯·æ³¨æ„ï¼Œæ­¤å›¾ä»…æ˜¾ç¤ºäº†æµçŠ¶æ€è½¬æ¢ä»¥åŠå½±å“è¿™äº›è½¬æ¢çš„å¸§å’Œæ ‡å¿—ã€‚åœ¨è¿™æ–¹é¢ï¼ŒCONTINUATIONå¸§ä¸ä¼šå¯¼è‡´çŠ¶æ€è½¬æ¢ï¼›å®ƒä»¬å®é™…ä¸Šæ˜¯å®ƒä»¬éµå¾ªçš„HEADERSæˆ–PUSH_PROMISE çš„ä¸€éƒ¨åˆ†ã€‚å‡ºäºçŠ¶æ€è½¬æ¢çš„ç›®çš„ï¼ŒEND_STREAM æ ‡å¿—ä½œä¸ºå•ç‹¬çš„äº‹ä»¶å¤„ç†åˆ°æ‰¿è½½å®ƒçš„å¸§ï¼›è®¾ç½®äº† END_STREAM æ ‡å¿—çš„HEADERSå¸§ä¼šå¯¼è‡´ä¸¤ä¸ªçŠ¶æ€è½¬æ¢ã€‚\nä¸¤ä¸ªç«¯ç‚¹éƒ½å¯¹æµçš„çŠ¶æ€æœ‰ä¸»è§‚çœ‹æ³•ï¼Œå½“å¸§åœ¨ä¼ è¾“æ—¶å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚ç«¯ç‚¹ä¸åè°ƒæµçš„åˆ›å»ºï¼›å®ƒä»¬ç”±ä»»ä¸€ç«¯ç‚¹å•æ–¹é¢åˆ›å»ºã€‚çŠ¶æ€ä¸åŒ¹é…çš„è´Ÿé¢å½±å“ä»…é™äºå‘é€RST_STREAMåçš„â€œå…³é—­â€çŠ¶æ€ï¼Œåœ¨å…³é—­åçš„ä¸€æ®µæ—¶é—´å†…å¯èƒ½ä¼šæ”¶åˆ°å¸§ã€‚\næµå…·æœ‰ä»¥ä¸‹çŠ¶æ€ï¼š\n idle reserved(local) reserved(remote) open half-closed(local) half-open(remote) closed  4.1.1 æµæ ‡è¯†ç¬¦ æµç”±ä¸€ä¸ªæ— ç¬¦å·çš„ 31 ä½æ•´æ•°æ ‡è¯†ã€‚å®¢æˆ·ç«¯å‘èµ·çš„æµå¿…é¡»ä½¿ç”¨å¥‡æ•°æµæ ‡è¯†ç¬¦ï¼›é‚£äº›ç”±æœåŠ¡å™¨å‘èµ·çš„å¿…é¡»ä½¿ç”¨å¶æ•°æµæ ‡è¯†ç¬¦ã€‚é›¶ (0x0) çš„æµæ ‡è¯†ç¬¦ç”¨äºè¿æ¥æ§åˆ¶æ¶ˆæ¯ï¼›é›¶çš„æµæ ‡è¯†ç¬¦ä¸èƒ½ç”¨äºå»ºç«‹æ–°çš„æµã€‚\nå‡çº§åˆ° HTTP/2ï¼ˆå‚è§ç¬¬ 3.2 èŠ‚ï¼‰çš„HTTP/1.1 è¯·æ±‚å°†ä½¿ç”¨æµæ ‡è¯†ç¬¦ 1 (0x1) è¿›è¡Œå“åº”ã€‚å‡çº§å®Œæˆåï¼Œæµ 0x1 å¯¹å®¢æˆ·ç«¯æ¥è¯´æ˜¯â€œåŠå…³é—­ï¼ˆæœ¬åœ°ï¼‰â€ã€‚å› æ­¤ï¼Œä» HTTP/1.1 å‡çº§çš„å®¢æˆ·ç«¯ä¸èƒ½é€‰æ‹©æµ 0x1 ä½œä¸ºæ–°çš„æµæ ‡è¯†ç¬¦ã€‚\næ–°å»ºç«‹çš„æµçš„æ ‡è¯†ç¬¦åœ¨æ•°å­—ä¸Šå¿…é¡»å¤§äºå‘èµ·ç«¯ç‚¹å·²æ‰“å¼€æˆ–ä¿ç•™çš„æ‰€æœ‰æµã€‚è¿™æ§åˆ¶ä½¿ç”¨HEADERSå¸§æ‰“å¼€çš„æµå’Œä½¿ç”¨PUSH_PROMISEä¿ç•™çš„æµã€‚æ¥æ”¶åˆ°æ„å¤–æµæ ‡è¯†ç¬¦çš„ç«¯ç‚¹å¿…é¡»å“åº”ç±»å‹ä¸ºPROTOCOL_ERRORçš„è¿æ¥é”™è¯¯ï¼ˆç¬¬ 5.4.1 èŠ‚ï¼‰ã€‚\næ–°æµæ ‡è¯†ç¬¦çš„ç¬¬ä¸€æ¬¡ä½¿ç”¨ä¼šéšå¼å…³é—­æ‰€æœ‰å¤„äºâ€œç©ºé—²â€çŠ¶æ€çš„æµï¼Œè¿™äº›æµå¯èƒ½å·²ç”±å…·æœ‰è¾ƒä½å€¼çš„æµæ ‡è¯†ç¬¦çš„å¯¹ç­‰æ–¹å¯åŠ¨ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå®¢æˆ·ç«¯åœ¨æµ 7 ä¸Šå‘é€HEADERSå¸§ï¼Œä½†ä»æœªåœ¨æµ 5 ä¸Šå‘é€è¿‡å¸§ï¼Œåˆ™å½“å‘é€æˆ–æ¥æ”¶æµ 7 çš„ç¬¬ä¸€ä¸ªå¸§æ—¶ï¼Œæµ 5 å°†è½¬æ¢ä¸ºâ€œå…³é—­â€çŠ¶æ€ã€‚\næµæ ‡è¯†ç¬¦ä¸èƒ½é‡å¤ä½¿ç”¨ã€‚é•¿æœŸè¿æ¥å¯èƒ½å¯¼è‡´ç«¯ç‚¹è€—å°½æµæ ‡è¯†ç¬¦çš„å¯ç”¨èŒƒå›´ã€‚æ— æ³•å»ºç«‹æ–°æµæ ‡è¯†ç¬¦çš„å®¢æˆ·ç«¯å¯ä»¥ä¸ºæ–°æµå»ºç«‹æ–°è¿æ¥ã€‚æ— æ³•å»ºç«‹æ–°æµæ ‡è¯†ç¬¦çš„æœåŠ¡å™¨å¯ä»¥å‘é€GOAWAYå¸§ï¼Œä»¥ä¾¿å®¢æˆ·ç«¯è¢«è¿«ä¸ºæ–°æµæ‰“å¼€æ–°è¿æ¥ã€‚\n4.1.2 æµå¹¶å‘ å¯¹ç­‰æ–¹å¯ä»¥ä½¿ç”¨SETTINGSå¸§å†…çš„SETTINGS_MAX_CONCURRENT_STREAMSå‚æ•°ï¼ˆå‚è§ç¬¬ 6.5.2 èŠ‚ï¼‰é™åˆ¶å¹¶å‘æ´»åŠ¨æµçš„æ•°é‡ã€‚æœ€å¤§å¹¶å‘æµè®¾ç½®ç‰¹å®šäºæ¯ä¸ªç«¯ç‚¹ï¼Œå¹¶ä¸”ä»…é€‚ç”¨äºæ¥æ”¶è®¾ç½®çš„å¯¹ç­‰æ–¹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®¢æˆ·ç«¯æŒ‡å®šæœåŠ¡å™¨å¯ä»¥å¯åŠ¨çš„æœ€å¤§å¹¶å‘æµæ•°ï¼ŒæœåŠ¡å™¨æŒ‡å®šå®¢æˆ·ç«¯å¯ä»¥å¯åŠ¨çš„æœ€å¤§å¹¶å‘æµæ•°ã€‚\nå¤„äºâ€œæ‰“å¼€â€çŠ¶æ€æˆ–å¤„äºâ€œåŠå…³é—­â€çŠ¶æ€ä¹‹ä¸€çš„æµè®¡å…¥å…è®¸ç«¯ç‚¹æ‰“å¼€çš„æœ€å¤§æµæ•°ã€‚å¤„äºè¿™ä¸‰ç§çŠ¶æ€ä¸­çš„ä»»ä½•ä¸€ç§çŠ¶æ€çš„æµéƒ½è®¡å…¥SETTINGS_MAX_CONCURRENT_STREAMSè®¾ç½®ä¸­å…¬å¸ƒçš„é™åˆ¶ã€‚å¤„äºä»»ä¸€â€œä¿ç•™â€çŠ¶æ€çš„æµä¸è®¡å…¥æµé™åˆ¶ã€‚\nç«¯ç‚¹ä¸å¾—è¶…è¿‡å…¶å¯¹ç­‰æ–¹è®¾ç½®çš„é™åˆ¶ã€‚æ”¶åˆ°HEADERSå¸§å¯¼è‡´è¶…å‡ºå…¶é€šå‘Šçš„å¹¶å‘æµé™åˆ¶çš„ç«¯ç‚¹å¿…é¡»å°†æ­¤è§†ä¸ºPROTOCOL_ERRORæˆ–REFUSED_STREAMç±»å‹çš„æµé”™è¯¯ï¼ˆç¬¬ 5.4.2 èŠ‚ï¼‰ã€‚é”™è¯¯ä»£ç çš„é€‰æ‹©å†³å®šäº†ç«¯ç‚¹æ˜¯å¦å¸Œæœ›å¯ç”¨è‡ªåŠ¨é‡è¯•ï¼ˆè¯¦ç»†ä¿¡æ¯è¯·å‚è§ç¬¬ 8.1.4 èŠ‚ï¼‰ã€‚\nå¸Œæœ›å°†SETTINGS_MAX_CONCURRENT_STREAMSçš„å€¼å‡å°‘åˆ°ä½äºå½“å‰æ‰“å¼€æµæ•°çš„å€¼çš„ç«¯ç‚¹å¯ä»¥å…³é—­è¶…è¿‡æ–°å€¼çš„æµæˆ–å…è®¸æµå®Œæˆ\n4.2 æµé‡æ§åˆ¶ ä½¿ç”¨æµè¿›è¡Œå¤šè·¯å¤ç”¨ä¼šå¼•å…¥å¯¹ TCP è¿æ¥ä½¿ç”¨çš„äº‰ç”¨ï¼Œä»è€Œå¯¼è‡´æµè¢«é˜»å¡ã€‚æµé‡æ§åˆ¶æ–¹æ¡ˆç¡®ä¿åŒä¸€è¿æ¥ä¸Šçš„æµä¸ä¼šç›¸äº’ç ´åæ€§åœ°å¹²æ‰°ã€‚æµæ§åˆ¶ç”¨äºå•ä¸ªæµå’Œæ•´ä¸ªè¿æ¥ã€‚\nHTTP/2 é€šè¿‡ä½¿ç”¨ WINDOW_UPDATE å¸§æä¾›æµé‡æ§åˆ¶\n4.2.1 æµé‡æ§åˆ¶åŸç† HTTP/2 æµæ§åˆ¶æ—¨åœ¨å…è®¸ä½¿ç”¨å„ç§æµæ§åˆ¶ç®—æ³•è€Œæ— éœ€æ›´æ”¹åè®®ã€‚HTTP/2 ä¸­çš„æµé‡æ§åˆ¶å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š\n æµæ§åˆ¶ç‰¹å®šäºè¿æ¥ã€‚ä¸¤ç§ç±»å‹çš„æµé‡æ§åˆ¶éƒ½åœ¨å•è·³çš„ç«¯ç‚¹ä¹‹é—´ï¼Œè€Œä¸æ˜¯åœ¨æ•´ä¸ªç«¯åˆ°ç«¯è·¯å¾„ä¸Šã€‚ æµé‡æ§åˆ¶åŸºäºWINDOW_UPDATEå¸§ã€‚æ¥æ”¶å™¨é€šå‘Šä»–ä»¬å‡†å¤‡åœ¨ä¸€ä¸ªæµä¸Šå’Œæ•´ä¸ªè¿æ¥ä¸Šæ¥æ”¶å¤šå°‘ä¸ªå…«ä½å­—èŠ‚ã€‚è¿™æ˜¯ä¸€ä¸ªåŸºäºä¿¡ç”¨çš„è®¡åˆ’ã€‚ æµé‡æ§åˆ¶æ˜¯å®šå‘çš„ï¼Œç”±æ¥æ”¶å™¨æä¾›æ•´ä½“æ§åˆ¶ã€‚æ¥æ”¶è€…å¯ä»¥é€‰æ‹©ä¸ºæ¯ä¸ªæµå’Œæ•´ä¸ªè¿æ¥è®¾ç½®å®ƒæ‰€éœ€çš„ä»»ä½•çª—å£å¤§å°ã€‚å‘é€æ–¹å¿…é¡»éµå®ˆæ¥æ”¶æ–¹æ–½åŠ çš„æµé‡æ§åˆ¶é™åˆ¶ã€‚å®¢æˆ·ç«¯ã€æœåŠ¡å™¨å’Œä¸­ä»‹éƒ½ç‹¬ç«‹åœ°å°†å…¶æµé‡æ§åˆ¶çª—å£ä½œä¸ºæ¥æ”¶æ–¹è¿›è¡Œé€šå‘Šï¼Œå¹¶åœ¨å‘é€æ—¶éµå®ˆå…¶å¯¹ç­‰æ–¹è®¾ç½®çš„æµé‡æ§åˆ¶é™åˆ¶ã€‚ å¯¹äºæ–°æµå’Œæ•´ä¸ªè¿æ¥ï¼Œæµæ§åˆ¶çª—å£çš„åˆå§‹å€¼æ˜¯ 65,535 ä¸ªå…«ä½å­—èŠ‚ã€‚ å¸§ç±»å‹å†³å®šæµæ§åˆ¶æ˜¯å¦é€‚ç”¨äºå¸§ã€‚åœ¨æœ¬æ–‡æ¡£ä¸­æŒ‡å®šçš„å¸§ä¸­ï¼Œåªæœ‰DATAå¸§å—åˆ°æµæ§ï¼›æ‰€æœ‰å…¶ä»–å¸§ç±»å‹ä¸å ç”¨å¹¿å‘Šæµæ§åˆ¶çª—å£ä¸­çš„ç©ºé—´ã€‚è¿™ç¡®ä¿é‡è¦çš„æ§åˆ¶å¸§ä¸ä¼šè¢«æµé‡æ§åˆ¶é˜»å¡ã€‚ æ— æ³•ç¦ç”¨æµé‡æ§åˆ¶ã€‚ HTTP/2 åªå®šä¹‰äº†WINDOW_UPDATEå¸§çš„æ ¼å¼å’Œè¯­ä¹‰ï¼ˆç¬¬ 6.9 èŠ‚ï¼‰ã€‚æœ¬æ–‡æ¡£æ²¡æœ‰è§„å®šæ¥æ”¶æ–¹å¦‚ä½•å†³å®šä½•æ—¶å‘é€è¯¥å¸§æˆ–å‘é€çš„å€¼ï¼Œä¹Ÿæ²¡æœ‰è§„å®šå‘é€æ–¹é€‰æ‹©å¦‚ä½•å‘é€æ•°æ®åŒ…ã€‚å®ç°èƒ½å¤Ÿé€‰æ‹©ä»»ä½•é€‚åˆä»–ä»¬éœ€è¦çš„ç®—æ³•ã€‚  å®ç°è¿˜è´Ÿè´£ç®¡ç†å¦‚ä½•æ ¹æ®ä¼˜å…ˆçº§å‘é€è¯·æ±‚å’Œå“åº”ï¼Œé€‰æ‹©å¦‚ä½•é¿å…è¯·æ±‚çš„é˜Ÿå¤´é˜»å¡ï¼Œä»¥åŠç®¡ç†æ–°æµçš„åˆ›å»ºã€‚è¿™äº›çš„ç®—æ³•é€‰æ‹©å¯ä»¥ä¸ä»»ä½•æµé‡æ§åˆ¶ç®—æ³•äº¤äº’\n4.2.2 æµä¼˜å…ˆçº§ å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡åœ¨æ‰“å¼€æµçš„ HEADERS å¸§ä¸­åŒ…å«ä¼˜å…ˆçº§ä¿¡æ¯æ¥ä¸ºæ–°æµåˆ†é…ä¼˜å…ˆçº§ã€‚åœ¨ä»»ä½•å…¶ä»–æ—¶é—´ï¼ŒPRIORITY å¸§å¯ç”¨äºæ›´æ”¹æµçš„ä¼˜å…ˆçº§ã€‚\nä¼˜å…ˆçº§çš„ç›®çš„æ˜¯å…è®¸ç«¯ç‚¹åœ¨ç®¡ç†å¹¶å‘æµæ—¶è¡¨è¾¾å®ƒå¸Œæœ›å…¶å¯¹ç­‰æ–¹å¦‚ä½•åˆ†é…èµ„æºã€‚æœ€é‡è¦çš„æ˜¯ï¼Œå½“å‘é€å®¹é‡æœ‰é™æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä¼˜å…ˆçº§æ¥é€‰æ‹©ä¼ è¾“å¸§çš„æµã€‚\næµå¯ä»¥é€šè¿‡å°†å®ƒä»¬æ ‡è®°ä¸ºä¾èµ–äºå…¶ä»–æµçš„å®Œæˆæ¥ç¡®å®šä¼˜å…ˆçº§ã€‚æ¯ä¸ªä¾èµ–é¡¹éƒ½åˆ†é…äº†ä¸€ä¸ªç›¸å¯¹æƒé‡ï¼Œè¯¥æ•°å­—ç”¨äºç¡®å®šåˆ†é…ç»™ä¾èµ–äºåŒä¸€æµçš„æµçš„å¯ç”¨èµ„æºçš„ç›¸å¯¹æ¯”ä¾‹ã€‚\næ˜¾å¼è®¾ç½®æµçš„ä¼˜å…ˆçº§è¢«è¾“å…¥åˆ°ä¼˜å…ˆçº§å¤„ç†è¿‡ç¨‹ä¸­ã€‚å®ƒä¸ä¿è¯æµç›¸å¯¹äºä»»ä½•å…¶ä»–æµçš„ä»»ä½•ç‰¹å®šå¤„ç†æˆ–ä¼ è¾“é¡ºåºã€‚ç«¯ç‚¹ä¸èƒ½å¼ºåˆ¶å¯¹ç­‰æ–¹ä½¿ç”¨ä¼˜å…ˆçº§ä»¥ç‰¹å®šé¡ºåºå¤„ç†å¹¶å‘æµã€‚å› æ­¤ï¼Œè¡¨è¾¾ä¼˜å…ˆçº§åªæ˜¯ä¸€ä¸ªå»ºè®®ã€‚\nå¯ä»¥ä»æ¶ˆæ¯ä¸­çœç•¥ä¼˜å…ˆçº§ä¿¡æ¯ã€‚åœ¨æä¾›ä»»ä½•æ˜¾å¼å€¼ä¹‹å‰ä½¿ç”¨é»˜è®¤å€¼\n5. æœåŠ¡å™¨æ¨é€ HTTP/2 å…è®¸æœåŠ¡å™¨é¢„å…ˆå‘å®¢æˆ·ç«¯å‘é€ï¼ˆæˆ–â€œæ¨é€â€ï¼‰å“åº”ï¼ˆè¿åŒç›¸åº”çš„â€œæ‰¿è¯ºâ€è¯·æ±‚ï¼‰ä¸å…ˆå‰å®¢æˆ·ç«¯å‘èµ·çš„è¯·æ±‚ç›¸å…³è”ã€‚å½“æœåŠ¡å™¨çŸ¥é“å®¢æˆ·ç«¯éœ€è¦è¿™äº›å“åº”å¯ç”¨æ‰èƒ½å®Œå…¨å¤„ç†å¯¹åŸå§‹è¯·æ±‚çš„å“åº”æ—¶ï¼Œè¿™ä¼šå¾ˆæœ‰ç”¨ã€‚\nå®¢æˆ·ç«¯å¯ä»¥è¯·æ±‚ç¦ç”¨æœåŠ¡å™¨æ¨é€ï¼Œå°½ç®¡è¿™æ˜¯ä¸ºæ¯ä¸ªè·ƒç‚¹ç‹¬ç«‹åå•†çš„ã€‚è¯¥SETTINGS_ENABLE_PUSHè®¾ç½®å¯ä»¥è®¾ç½®ä¸º0ï¼Œè¡¨æ˜æœåŠ¡å™¨æ¨é€è¢«ç¦ç”¨ã€‚\næ‰¿è¯ºçš„è¯·æ±‚å¿…é¡»æ˜¯å¯ç¼“å­˜çš„ï¼Œå¿…é¡»æ˜¯å®‰å…¨çš„ï¼Œå¹¶ä¸”ä¸å¾—åŒ…å«è¯·æ±‚æ­£æ–‡ã€‚æ”¶åˆ°ä¸å¯ç¼“å­˜ã€æœªçŸ¥å®‰å…¨æˆ–æŒ‡ç¤ºè¯·æ±‚æ­£æ–‡å­˜åœ¨çš„æ‰¿è¯ºè¯·æ±‚çš„å®¢æˆ·ç«¯å¿…é¡»ä½¿ç”¨PROTOCOL_ERRORç±»å‹çš„æµé”™è¯¯é‡ç½®æ‰¿è¯ºæµã€‚è¯·æ³¨æ„ï¼Œå¦‚æœå®¢æˆ·ç«¯ä¸è®¤ä¸ºæ–°å®šä¹‰çš„æ–¹æ³•æ˜¯å®‰å…¨çš„ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´æ‰¿è¯ºçš„æµè¢«é‡ç½®ã€‚\nå¦‚æœå®¢æˆ·ç«¯å®ç°äº† HTTP ç¼“å­˜ï¼Œåˆ™å¯ç¼“å­˜çš„æ¨é€å“åº”å¯ä»¥ç”±å®¢æˆ·ç«¯å­˜å‚¨ã€‚æ¨é€çš„å“åº”è¢«è®¤ä¸ºåœ¨æºæœåŠ¡å™¨ä¸ŠæˆåŠŸéªŒè¯ï¼ˆä¾‹å¦‚ï¼Œå¦‚æœå­˜åœ¨â€œæ— ç¼“å­˜â€ç¼“å­˜å“åº”æŒ‡ä»¤ï¼Œè€Œç”±æ‰¿è¯ºçš„æµ ID æ ‡è¯†çš„æµä»å¤„äºæ‰“å¼€çŠ¶æ€ã€‚\nä¸å¯ç¼“å­˜çš„æ¨é€å“åº”ä¸å¾—ç”±ä»»ä½• HTTP ç¼“å­˜å­˜å‚¨ã€‚å®ƒä»¬å¯ä»¥å•ç‹¬æä¾›ç»™åº”ç”¨ç¨‹åºã€‚\næœåŠ¡å™¨å¿…é¡»åœ¨:authorityä¼ªæ ‡å¤´å­—æ®µä¸­åŒ…å«ä¸€ä¸ªæœåŠ¡å™¨å¯¹å…¶å…·æœ‰æƒå¨æ€§çš„å€¼ã€‚å®¢æˆ·ç«¯å¿…é¡»å°†æœåŠ¡å™¨ä¸å…·æœ‰æƒå¨æ€§çš„PUSH_PROMISEè§†ä¸ºPROTOCOL_ERRORç±»å‹çš„æµé”™è¯¯ã€‚\nä¸­ä»‹å¯ä»¥æ¥æ”¶æ¥è‡ªæœåŠ¡å™¨çš„æ¨é€å¹¶é€‰æ‹©ä¸å°†å®ƒä»¬è½¬å‘åˆ°å®¢æˆ·ç«¯ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚ä½•ä½¿ç”¨æ¨é€çš„ä¿¡æ¯å–å†³äºè¯¥ä¸­ä»‹ã€‚åŒæ ·ï¼Œä¸­ä»‹å¯èƒ½ä¼šé€‰æ‹©å‘å®¢æˆ·ç«¯è¿›è¡Œé¢å¤–çš„æ¨é€ï¼Œè€Œæ— éœ€æœåŠ¡å™¨é‡‡å–ä»»ä½•è¡ŒåŠ¨ã€‚\nå®¢æˆ·ç«¯æ— æ³•æ¨é€ã€‚å› æ­¤ï¼ŒæœåŠ¡å™¨å¿…é¡»å°†PUSH_PROMISEå¸§çš„æ¥æ”¶è§†ä¸ºPROTOCOL_ERRORç±»å‹çš„è¿æ¥é”™è¯¯ã€‚å®¢æˆ·ç«¯å¿…é¡»é€šè¿‡å°†æ¶ˆæ¯è§†ä¸ºPROTOCOL_ERRORç±»å‹çš„è¿æ¥é”™è¯¯æ¥æ‹’ç»å°†SETTINGS_ENABLE_PUSHè®¾ç½®æ›´æ”¹ä¸º0 ä»¥å¤–çš„å€¼çš„ä»»ä½•å°è¯•ã€‚\n5.1 æ¨é€è¯·æ±‚ æœåŠ¡å™¨æ¨é€åœ¨è¯­ä¹‰ä¸Šç­‰åŒäºæœåŠ¡å™¨å“åº”è¯·æ±‚ï¼›ä½†æ˜¯ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯¥è¯·æ±‚ä¹Ÿç”±æœåŠ¡å™¨å‘é€ï¼Œä½œä¸ºPUSH_PROMISEå¸§ã€‚\næ‰€è¿°PUSH_PROMISEå¸§åŒ…æ‹¬åŒ…å«äº†ä¸€å¥—å®Œæ•´çš„è¯·æ±‚æŠ¥å¤´å­—æ®µçš„è¯¥æœåŠ¡å™¨çš„å±æ€§å¯¹æ‰€è¿°è¯·æ±‚çš„é¦–æ ‡å—ã€‚æ— æ³•æ¨é€å¯¹åŒ…å«è¯·æ±‚æ­£æ–‡çš„è¯·æ±‚çš„å“åº”ã€‚\næ¨é€çš„å“åº”æ€»æ˜¯ä¸æ¥è‡ªå®¢æˆ·ç«¯çš„æ˜¾å¼è¯·æ±‚ç›¸å…³è”ã€‚æœåŠ¡å™¨å‘é€çš„PUSH_PROMISEå¸§åœ¨è¯¥æ˜¾å¼è¯·æ±‚çš„æµä¸Šå‘é€ã€‚æ‰€è¿°PUSH_PROMISEæ¡†æ¶è¿˜åŒ…æ‹¬ä¸€ä¸ªæ‰¿è¯ºæµæ ‡è¯†ç¬¦ï¼Œä»æ‰€è¿°æœåŠ¡å™¨ä¸­å¯ç”¨çš„æµæ ‡è¯†ç¬¦é€‰æ‹©ã€‚\nPUSH_PROMISEå’Œä»»ä½•åç»­CONTINUATIONå¸§ä¸­çš„å¤´å­—æ®µå¿…é¡»æ˜¯ä¸€ç»„æœ‰æ•ˆä¸”å®Œæ•´çš„è¯·æ±‚å¤´å­—æ®µã€‚æœåŠ¡å™¨å¿…é¡»åœ¨:methodä¼ªæ ‡å¤´å­—æ®µä¸­åŒ…å«ä¸€ä¸ªå®‰å…¨ä¸”å¯ç¼“å­˜çš„æ–¹æ³•ã€‚å¦‚æœå®¢æˆ·ç«¯æ”¶åˆ°ä¸åŒ…å«å®Œæ•´æœ‰æ•ˆçš„å¤´å­—æ®µé›†çš„PUSH_PROMISEæˆ–:methodä¼ªå¤´å­—æ®µæ ‡è¯†äº†ä¸å®‰å…¨çš„æ–¹æ³•ï¼Œåˆ™å®ƒå¿…é¡»ä»¥PROTOCOL_ERRORç±»å‹çš„æµé”™è¯¯è¿›è¡Œå“åº”.\næœåŠ¡å™¨åº”è¯¥åœ¨å‘é€ä»»ä½•å¼•ç”¨æ‰¿è¯ºå“åº”çš„å¸§ä¹‹å‰å‘é€PUSH_PROMISEå¸§ã€‚è¿™é¿å…äº†å®¢æˆ·ç«¯åœ¨æ¥æ”¶ä»»ä½•PUSH_PROMISEå¸§ä¹‹å‰å‘å‡ºè¯·æ±‚çš„ç«äº‰ã€‚\nä¾‹å¦‚ï¼Œå¦‚æœæœåŠ¡å™¨æ”¶åˆ°å¯¹åŒ…å«å¤šä¸ªå›¾åƒæ–‡ä»¶çš„åµŒå…¥é“¾æ¥çš„æ–‡æ¡£çš„è¯·æ±‚ï¼Œå¹¶ä¸”æœåŠ¡å™¨é€‰æ‹©å°†è¿™äº›é™„åŠ å›¾åƒæ¨é€åˆ°å®¢æˆ·ç«¯ï¼Œåˆ™åœ¨åŒ…å«å›¾åƒé“¾æ¥çš„DATAå¸§ä¹‹å‰å‘é€PUSH_PROMISEå¸§å¯ç¡®ä¿å®¢æˆ·ç«¯èƒ½å¤Ÿåœ¨å‘ç°åµŒå…¥é“¾æ¥ä¹‹å‰æŸ¥çœ‹èµ„æºå°†è¢«æ¨é€ã€‚ç±»ä¼¼åœ°ï¼Œå¦‚æœæœåŠ¡å™¨æ¨é€æ ‡å¤´å—å¼•ç”¨çš„å“åº”ï¼ˆä¾‹å¦‚ï¼Œåœ¨ Link æ ‡å¤´å­—æ®µä¸­ï¼‰ï¼Œåˆ™åœ¨å‘é€æ ‡å¤´å—ä¹‹å‰å‘é€PUSH_PROMISEå¯ç¡®ä¿å®¢æˆ·ç«¯ä¸ä¼šè¯·æ±‚è¿™äº›èµ„æºã€‚\nPUSH_PROMISEå¸§ä¸å¾—ç”±å®¢æˆ·ç«¯å‘é€ã€‚\nPUSH_PROMISEå¸§å¯ä»¥ç”±æœåŠ¡å™¨å‘é€ä»¥å“åº”ä»»ä½•å®¢æˆ·ç«¯å¯åŠ¨çš„æµï¼Œä½†è¯¥æµå¿…é¡»å¤„äºç›¸å¯¹äºæœåŠ¡å™¨çš„â€œæ‰“å¼€â€æˆ–â€œåŠå…³é—­ï¼ˆè¿œç¨‹ï¼‰â€çŠ¶æ€ã€‚PUSH_PROMISEå¸§ä¸ç»„æˆå“åº”çš„å¸§ç©¿æ’åœ¨ä¸€èµ·ï¼Œä½†å®ƒä»¬ä¸èƒ½ä¸ç»„æˆå•ä¸ªæ ‡å¤´å—çš„HEADERSå’ŒCONTINUATIONå¸§ç©¿æ’åœ¨ä¸€èµ·ã€‚\nå‘é€PUSH_PROMISEå¸§ä¼šåˆ›å»ºä¸€ä¸ªæ–°æµï¼Œå¹¶å°†æµç½®äºæœåŠ¡å™¨çš„â€œä¿ç•™ï¼ˆæœ¬åœ°ï¼‰â€çŠ¶æ€å’Œå®¢æˆ·ç«¯çš„â€œä¿ç•™ï¼ˆè¿œç¨‹ï¼‰â€çŠ¶æ€\n5.2 æ¨é€å“åº” å‘é€PUSH_PROMISEå¸§åï¼ŒæœåŠ¡å™¨å¯ä»¥å¼€å§‹å°†æ¨é€çš„å“åº”ä½œä¸ºå“åº”ä¼ é€åˆ°ä½¿ç”¨æ‰¿è¯ºæµæ ‡è¯†ç¬¦çš„æœåŠ¡å™¨å¯åŠ¨çš„æµä¸Šã€‚æœåŠ¡å™¨ä½¿ç”¨æ­¤æµä¼ è¾“ HTTP å“åº”ï¼Œä½¿ç”¨ä¸ç¬¬ 8.1 èŠ‚ä¸­å®šä¹‰çš„ç›¸åŒçš„å¸§åºåˆ—ã€‚åœ¨å‘é€åˆå§‹HEADERSå¸§åï¼Œæ­¤æµå¯¹å®¢æˆ·ç«¯å˜ä¸ºâ€œåŠå…³é—­â€ ã€‚\nä¸€æ—¦å®¢æˆ·ç«¯æ”¶åˆ°ä¸€ä¸ªPUSH_PROMISEå¸§å¹¶é€‰æ‹©æ¥å—æ¨é€çš„å“åº”ï¼Œå®¢æˆ·ç«¯ä¸åº”è¯¥åœ¨æ‰¿è¯ºçš„æµå…³é—­ä¹‹å‰å‘å‡ºä»»ä½•å¯¹æ‰¿è¯ºçš„å“åº”çš„è¯·æ±‚ã€‚\nå¦‚æœå®¢æˆ·ç«¯å‡ºäºä»»ä½•åŸå› ç¡®å®šå®ƒä¸å¸Œæœ›æ¥æ”¶æ¥è‡ªæœåŠ¡å™¨çš„æ¨é€å“åº”ï¼Œæˆ–è€…å¦‚æœæœåŠ¡å™¨å¼€å§‹å‘é€æ‰¿è¯ºçš„å“åº”æ—¶é—´è¿‡é•¿ï¼Œåˆ™å®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨CANCELæˆ–REFUSED_STREAMå‘é€RST_STREAMå¸§ä»£ç å¹¶å¼•ç”¨æ¨é€æµçš„æ ‡è¯†ç¬¦ã€‚\nå®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨SETTINGS_MAX_CONCURRENT_STREAMSè®¾ç½®æ¥é™åˆ¶æœåŠ¡å™¨å¯ä»¥åŒæ—¶æ¨é€çš„å“åº”æ•°é‡ã€‚å°†SETTINGS_MAX_CONCURRENT_STREAMSå€¼è®¾ä¸ºé›¶ä¼šé€šè¿‡é˜»æ­¢æœåŠ¡å™¨åˆ›å»ºå¿…è¦çš„æµæ¥ç¦ç”¨æœåŠ¡å™¨æ¨é€ã€‚è¿™ä¸ä¼šç¦æ­¢æœåŠ¡å™¨å‘é€PUSH_PROMISEå¸§ï¼›å®¢æˆ·ç«¯éœ€è¦é‡ç½®ä»»ä½•ä¸éœ€è¦çš„æ‰¿è¯ºæµã€‚\næ¥æ”¶æ¨é€å“åº”çš„å®¢æˆ·ç«¯å¿…é¡»éªŒè¯æœåŠ¡å™¨æ˜¯å¦å…·æœ‰æƒå¨æ€§æˆ–ä¸ºç›¸åº”è¯·æ±‚é…ç½®äº†æä¾›æ¨é€å“åº”çš„ä»£ç†ã€‚ä¾‹å¦‚ï¼Œåªä¸ºexample.com DNS-ID æˆ– Common Nameæä¾›è¯ä¹¦çš„æœåŠ¡å™¨ä¸å…è®¸æ¨é€å¯¹https://www.example.org/docçš„å“åº”ã€‚\nPUSH_PROMISEæµçš„å“åº”ä»¥HEADERSå¸§å¼€å§‹ï¼Œå®ƒç«‹å³å°†æµç½®äºæœåŠ¡å™¨çš„â€œåŠå…³é—­ï¼ˆè¿œç¨‹ï¼‰â€çŠ¶æ€å’Œå®¢æˆ·ç«¯çš„â€œåŠå…³é—­ï¼ˆæœ¬åœ°ï¼‰â€çŠ¶æ€ï¼Œå¹¶ä»¥å¸§ç»“æŸè½´æ‰¿ END_STREAMï¼Œå®ƒå°†æµç½®äºâ€œå…³é—­â€çŠ¶æ€ã€‚\næ³¨æ„ï¼šå®¢æˆ·ç«¯æ°¸è¿œä¸ä¼šä¸ºæœåŠ¡å™¨æ¨é€å‘é€å¸¦æœ‰ END_STREAM æ ‡å¿—çš„å¸§ã€‚\nReference [1] HTTP/1çš„ç¼ºç‚¹æ€»ç»“\n[2] RFC7540 (HTTP/2) [3] HTTP/2\n","permalink":"http://yangchnet.github.io/Dessert/posts/net/http2/","summary":"è¿™æ˜¯ä¸€ç¯‡ç†è®ºæ€§è¾ƒå¼ºçš„æ–‡ç« \n 1. HTTP/1çš„ä¸è¶³ä¸é¢ä¸´çš„é—®é¢˜  æ­¤éƒ¨åˆ†å†…å®¹æ¥è‡ªï¼šhttps://segmentfault.com/a/1190000013519925\n 1.1 HTTP/1æ¦‚è¿° 1.2 é˜Ÿå¤´é˜»å¡ æµè§ˆå™¨å¾ˆå°‘åªä»ä¸€ä¸ªåŸŸåè·å–ä¸€ä»½èµ„æºã€‚å¤§å¤šæ•°æ—¶å€™ï¼Œå®ƒå¸Œæœ›èƒ½åŒæ—¶è·å–è®¸å¤šèµ„æºã€‚è®¾æƒ³è¿™æ ·ä¸€ä¸ªç½‘ç«™ï¼Œå®ƒæŠŠæ‰€æœ‰å›¾ç‰‡æ”¾åœ¨å•ä¸ªç‰¹å®šåŸŸåä¸‹ã€‚HTTP/1 å¹¶æœªæä¾›æœºåˆ¶æ¥åŒæ—¶è¯·æ±‚è¿™äº›èµ„æºã€‚å¦‚æœä»…ä»…ä½¿ç”¨ä¸€ä¸ªè¿æ¥ï¼Œå®ƒéœ€è¦å‘èµ·è¯·æ±‚ã€ç­‰å¾…å“åº”ï¼Œä¹‹åæ‰èƒ½å‘èµ·ä¸‹ä¸€ä¸ªè¯·æ±‚ã€‚è¿™æ˜¾ç„¶ä¼šåœ¨åŠ è½½é¡µé¢æ—¶é€ æˆè¾ƒå¤§çš„å»¶è¿Ÿï¼Œé™ä½äº†ç”¨æˆ·ä½“éªŒã€‚\nh1 æœ‰ä¸ªç‰¹æ€§å« ç®¡é“åŒ–(pipelining)ï¼Œå…è®¸ä¸€æ¬¡å‘é€ä¸€ç»„è¿ç»­çš„è¯·æ±‚ï¼Œè€Œä¸ç”¨ç­‰å¾…åº”ç­”è¿”å›ã€‚è¿™æ ·å¯ä»¥é¿å…è¿æ¥å»¶è¿Ÿã€‚ä½†æ˜¯è¯¥ç‰¹æ€§åªèƒ½æŒ‰ç…§å‘é€é¡ºåºä¾æ¬¡æ¥æ”¶å“åº”ã€‚è€Œä¸”ï¼Œç®¡é“åŒ–å¤‡å—äº’æ“ä½œæ€§å’Œéƒ¨ç½²çš„å„ç§é—®é¢˜çš„å›°æ‰°ï¼ŒåŸºæœ¬æ²¡æœ‰å®ç”¨ä»·å€¼ã€‚\nåœ¨è¯·æ±‚åº”ç­”è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå‡ºç°ä»»ä½•çŠ¶å†µï¼Œå‰©ä¸‹æ‰€æœ‰çš„å·¥ä½œéƒ½ä¼šè¢«é˜»å¡åœ¨é‚£æ¬¡è¯·æ±‚åº”ç­”ä¹‹åã€‚è¿™å°±æ˜¯é˜Ÿå¤´é˜»å¡ï¼ˆHead-of-line blockingæˆ–ç¼©å†™ä¸ºHOL blockingï¼‰ï¼Œå®ƒä¼šé˜»ç¢ç½‘ç»œä¼ è¾“å’Œ Web é¡µé¢æ¸²æŸ“ï¼Œç›´è‡³å¤±å»å“åº”ã€‚\nä¸ºäº†é˜²æ­¢è¿™ç§é—®é¢˜ï¼Œç°ä»£æµè§ˆå™¨ä¼šé’ˆå¯¹å•ä¸ªåŸŸåå¼€å¯ 6 ä¸ªè¿æ¥ï¼Œé€šè¿‡å„ä¸ªè¿æ¥åˆ†åˆ«å‘é€è¯·æ±‚ã€‚å®ƒå®ç°äº†æŸç§ç¨‹åº¦ä¸Šçš„å¹¶è¡Œï¼Œä½†æ˜¯æ¯ä¸ªè¿æ¥ä»ä¼šå—åˆ° é˜Ÿå¤´é˜»å¡ çš„å½±å“ã€‚å¦å¤–ï¼Œè¿™ä¹Ÿæ²¡æœ‰é«˜æ•ˆåˆ©ç”¨æœ‰é™çš„è®¾å¤‡èµ„æºã€‚\n1.3 TCPå¤ç”¨ ä¼ è¾“æ§åˆ¶åè®®(TCP) çš„è®¾è®¡æ€è·¯æ˜¯ï¼šå¯¹å‡è®¾æƒ…å†µå¾ˆä¿å®ˆï¼Œå¹¶èƒ½å¤Ÿå…¬å¹³å¯¹å¾…åŒä¸€ç½‘ç»œçš„ä¸åŒæµé‡çš„åº”ç”¨ã€‚å®ƒçš„é¿å…æ‹¥å¡æœºåˆ¶è¢«è®¾è®¡æˆå³ä½¿åœ¨æœ€å·®çš„ç½‘ç»œçŠ¶å†µä¸‹ä»èƒ½èµ·ä½œç”¨ï¼Œå¹¶ä¸”å¦‚æœæœ‰éœ€æ±‚å†²çªä¹Ÿä¿è¯ç›¸å¯¹å…¬å¹³ã€‚è¿™æ˜¯å®ƒå–å¾—æˆåŠŸçš„åŸå› ä¹‹ä¸€ã€‚\nå®ƒçš„æˆåŠŸå¹¶ä¸æ˜¯å› ä¸ºä¼ è¾“æ•°æ®æœ€å¿«ï¼Œè€Œæ˜¯å› ä¸ºå®ƒæ˜¯æœ€å¯é çš„åè®®ä¹‹ä¸€ï¼Œæ¶‰åŠçš„æ ¸å¿ƒæ¦‚å¿µå°±æ˜¯ æ‹¥å¡çª—å£(congestion window) ã€‚æ‹¥å¡çª—å£æ˜¯æŒ‡ï¼Œåœ¨æ¥æ”¶æ–¹ç¡®è®¤æ•°æ®åŒ…ä¹‹å‰ï¼Œå‘é€æ–¹å¯ä»¥å‘å‡ºçš„ TCP åŒ…çš„æ•°é‡ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœæ‹¥å¡çª—å£æŒ‡å®šä¸º 1ï¼Œé‚£ä¹ˆå‘é€æ–¹å‘å‡º 1 ä¸ªæ•°æ®åŒ…ä¹‹åï¼Œåªæœ‰æ¥æ”¶æ–¹ç¡®è®¤äº†é‚£ä¸ªåŒ…ï¼Œæ‰èƒ½å‘é€ä¸‹ä¸€ä¸ªã€‚\nä¸€èˆ¬æ¥è®²ï¼Œæ¯æ¬¡å‘é€ä¸€ä¸ªæ•°æ®åŒ…å¹¶ä¸æ˜¯éå¸¸ä½æ•ˆã€‚TCP æœ‰ä¸ªæ¦‚å¿µå« æ…¢å¯åŠ¨(Slow Start)ï¼Œ å®ƒç”¨æ¥æ¢ç´¢å½“å‰è¿æ¥å¯¹åº”æ‹¥å¡çª—å£çš„åˆé€‚å¤§å°ã€‚æ…¢å¯åŠ¨çš„è®¾è®¡ç›®æ ‡æ˜¯ä¸ºäº†è®©æ–°è¿æ¥ææ¸…æ¥šå½“å‰ç½‘ç»œçŠ¶å†µï¼Œé¿å…ç»™å·²ç»æ‹¥å µçš„ç½‘ç»œç»§ç»­æ·»ä¹±ã€‚å®ƒå…è®¸å‘é€è€…åœ¨æ”¶åˆ°æ¯ä¸ªç¡®è®¤å›å¤åé¢å¤–å‘é€ 1 ä¸ªæœªç¡®è®¤åŒ…ã€‚è¿™æ„å‘³ç€æ–°è¿æ¥åœ¨æ”¶åˆ° 1 ä¸ªç¡®è®¤å›å¤ä¹‹åï¼Œå¯ä»¥å‘é€ 2 ä¸ªæ•°æ®åŒ…; åœ¨æ”¶åˆ° 2 ä¸ªç¡®è®¤å›å¤ä¹‹åï¼Œå¯ä»¥å‘ 4 ä¸ªï¼›ä»¥æ­¤ç±»æ¨ã€‚è¿™ç§å‡ ä½•çº§æ•°å¢é•¿å¾ˆå¿«å°±ä¼šåˆ°è¾¾åè®®è§„å®šçš„å‘åŒ…æ•°ä¸Šé™ï¼Œè¿™æ—¶å€™è¿æ¥å°†è¿›å…¥æ‹¥å¡é¿å…é˜¶æ®µ è¿™ç§æœºåˆ¶éœ€è¦å‡ æ¬¡å¾€è¿”æ•°æ®è¯·æ±‚æ‰èƒ½å¾—çŸ¥æœ€ä½³æ‹¥å¡çª—å£å¤§å°ã€‚ä½†åœ¨è§£å†³æ€§èƒ½é—®é¢˜æ—¶ï¼Œå°±è¿™ åŒºåŒºå‡ æ¬¡æ•°æ®å¾€è¿”ä¹Ÿæ˜¯éå¸¸å®è´µçš„æ—¶é—´(æˆæœ¬)ã€‚ç°ä»£æ“ä½œç³»ç»Ÿä¸€èˆ¬ä¼šå– 4~10 ä¸ªæ•°æ®åŒ…ä½œä¸ºåˆå§‹æ‹¥å¡çª—å£å¤§å°ã€‚å¦‚æœä½ æŠŠä¸€ä¸ªæ•°æ®åŒ…è®¾ç½®ä¸ºæœ€å¤§å€¼ä¸‹é™ 1460 å­—èŠ‚(ä¹Ÿå°±æ˜¯ æœ€å¤§æœ‰æ•ˆè´Ÿè½½)ï¼Œé‚£ä¹ˆåªèƒ½å…ˆå‘é€ 5840 å­—èŠ‚(å‡å®šæ‹¥å¡çª—å£ä¸º 4)ï¼Œç„¶åå°±éœ€è¦ç­‰å¾…æ¥æ”¶ç¡®è®¤å›å¤ã€‚\nå¦‚ä»Šçš„ Web é¡µé¢å¹³å‡å¤§å°çº¦ 2MBï¼ŒåŒ…æ‹¬ HTML å’Œæ‰€æœ‰ä¾èµ–çš„èµ„æºã€‚åœ¨ç†æƒ³æƒ…å†µä¸‹ï¼Œ è¿™éœ€è¦å¤§çº¦ 9 æ¬¡å¾€è¿”è¯·æ±‚æ¥ä¼ è¾“å®Œæ•´ä¸ªé¡µé¢ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæµè§ˆå™¨ä¸€èˆ¬ä¼šé’ˆå¯¹åŒä¸€ä¸ªåŸŸåå¼€å¯ 6 ä¸ªå¹¶å‘è¿æ¥ï¼Œè¿™æ„å‘³ç€æ‹¥å¡çª—å£æ³¢åŠ¨ä¹Ÿä¼šå¹¶è¡Œå‘ç”Ÿ 6 æ¬¡ã€‚TCP åè®®ä¿è¯é‚£äº›è¿æ¥éƒ½èƒ½æ­£å¸¸å·¥ä½œï¼Œ ä½†æ˜¯ä¸èƒ½ä¿è¯å®ƒä»¬çš„æ€§èƒ½æ˜¯æœ€ä¼˜çš„ã€‚","title":"HTTP2ç®€ä»‹"},{"content":"1. äº’ä¿¡æ¯é‡ ä¿¡æ¯ç†µï¼ˆé¦™å†œç†µï¼‰ $$ H(A) = - \\sum_{x\\in X}p(x)\\log p(x) $$ ä¿¡æ¯ç†µåº¦é‡äº†ä¿¡æ¯é‡çš„å¤šå°‘ã€‚å¦‚è‹±è¯­æœ‰26ä¸ªå­—æ¯ï¼ŒåŠ å…¥æ¯ä¸ªå­—æ¯åœ¨æ–‡ç« ä¸­å‡ºç°æ¬¡æ•°ç›¸åŒçš„è¯ï¼Œæ¯ä¸ªå­—æ¯çš„ä¿¡æ¯é‡ä¸º: $$ I_e = -\\log_2{\\frac{1}{26}}=4.7 $$ è‹¥æœ‰ä¸€ä¸ªå­—æ¯å‡ºç°æ¬¡æ•°ä¸ºæ€»æ¬¡æ•°çš„ä¸€åŠï¼Œåˆ™å…¶ä¿¡æ¯ç†µä¸ºï¼š $$ I_e = -\\log_2{\\frac{1}{2}} = 1 $$ ä»¥ä¸Šä¾‹å­è¯´æ˜ï¼ŒæŸä¸€ä¸ªä¿¡æ¯å‡ºç°æ¬¡æ•°è¶Šå¤šï¼Œå…¶ä¿¡æ¯é‡å°±è¶Šå°‘ã€‚ç›´è§‚çš„è¯´ï¼ŒæŸä¸€ç¯‡æ–‡ç« ä¸­ï¼Œâ€œçš„â€ï¼Œâ€œæˆ‘â€ç­‰è¯è¯­å¯èƒ½å‡ºç°æ¬¡æ•°æœ€å¤šï¼Œä½†å…¶èƒ½ä¸ºæˆ‘ä»¬å¸¦æ¥çš„ä¿¡æ¯å¯èƒ½å¹¶ä¸æ˜¯é‚£ä¹ˆå¤šã€‚\nç»å…¸äº’ä¿¡æ¯é‡ å‡å®šæˆ‘ä»¬åœ¨ä¸€ç³»åˆ—çš„ä¸åŒæ—¶åˆ»$(t_1, t_2, \\dots, t_N)$å¯¹ä¸€ä¸ªç»™å®šçš„ç³»ç»Ÿè¿›è¡Œè¿ç»­æµ‹é‡ï¼ŒæŠŠæ¯æ¬¡æµ‹é‡ç»“æœè®°ä¸º$x_1, x_2,\\dots, x_N$ï¼Œæ¯ä¸ªæµ‹é‡åºåˆ—çš„ç»“æœéƒ½æœ‰ä¸åŒçš„æ¦‚ç‡è¾“å‡ºï¼Œå°†ä¹‹è®°ä¸º$p(x_1), p(x_2), \\dots, p(x_N)$.\nåˆ™å…³è”å°±æ„å‘³ç€å¯¹äºä»»æ„çš„$1\\le n \\le N$ï¼Œè¿™äº›æ¦‚ç‡åˆ†å¸ƒä¸ä¼šä»¥ä¹˜ç§¯çš„å½¢å¼å‡ºç°ï¼Œå³$p(x_1, x_2, \\dots, x_n)*p(x_n+1, x_n+2, \\dots, x_N)$ã€‚ç”¨é€šä¿—æ˜“æ‡‚çš„è¯æ¥è¯´ï¼Œå°±æ˜¯è¿™äº›æ¦‚ç‡åˆ†å¸ƒä¸æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚\nç®€å•èµ·è§ï¼Œæˆ‘ä»¬å°†æ‰€æœ‰æµ‹é‡åˆ†ä¸ºä¸¤ç»„Aå’ŒBï¼Œè¿™æ ·Aå’ŒBä¹‹é—´çš„äº’ä¿¡æ¯é‡å°±å®šä¹‰ä¸ºï¼š $$ I(A:B) = H(A)+H(B) - H(A,B), where\\ H(A) = - \\sum_{x\\in X}p(x)\\log p(x) $$\nåˆï¼Œæ ¹æ®è´å¶æ–¯å®šç†$H(A|B)=H(A,B)-H(B)$ï¼Œç»å…¸äº’ä¿¡æ¯é‡è¿˜æœ‰ä¸€ä¸ªç­‰ä»·çš„è¡¨è¾¾æ–¹å¼ï¼š $$ C(A:B)=H(A)-H(A|B) $$ å…¶ä¸­$H(A|B)$è¡¨ç¤ºåœ¨çŸ¥é“Bä½“ç³»æµ‹é‡ç»“æœæƒ…å†µä¸‹Aä½“ç³»çš„æ¡ä»¶ç†µã€‚å› æ­¤ï¼Œç»å…¸äº’ä¿¡æ¯é‡åº¦é‡äº†åœ¨å¯¹Bæµ‹é‡æ—¶æ‰€èƒ½æå–çš„Açš„ä¿¡æ¯é‡ã€‚\n2. é‡å­äº’ä¿¡æ¯é‡ å°†ç»å…¸äº’ä¿¡æ¯é‡çš„ç†è®ºæ¨å¹¿åˆ°é‡å­ç³»ç»Ÿï¼Œè¿™æ ·å°±èƒ½å¾—åˆ°é‡å­äº’ä¿¡æ¯é‡çš„æ¦‚å¿µï¼Œè€ƒè™‘ä¸€ä¸ªä¸¤ä½“çš„é‡å­æ€$\\rho_{AB}$ï¼Œé‡å­äº’ä¿¡æ¯é‡å®šä¹‰ä¸ºï¼š $$ I(\\rho_{AB})=S(\\rho_{A})+S(\\rho_{B})-S(\\rho_{AB}) $$ å…¶ä¸­$S(\\rho)=-tr\\rho\\log(\\rho)$ä¸ºå†¯Â·è¯ºä¼Šæ›¼ç†µï¼Œï¼ˆ$tr$æŒ‡æ±‚è¿¹ï¼Œå³æ±‚çŸ©é˜µå¯¹è§’çº¿å…ƒç´ ä¹‹å’Œï¼‰,$\\rho_A$å’Œ$\\rho_B$åˆ†åˆ«ä¸º$\\rho_{AB}$çš„çº¦åŒ–å¯†åº¦çŸ©é˜µã€‚\nä¸¤ä½“ç³»ç»Ÿçš„æ€»å…³è”ä¸ºå…¶é‡å­äº’ä¿¡æ¯é‡\n3. é‡å­å…³è” å¯¹äºç»å…¸äº’ä¿¡æ¯é‡è¡¨è¾¾å½¢å¼çš„é‡å­æ¨å¹¿ï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥ä¸€å¥—å®Œå¤‡çš„æµ‹é‡åŸºåº•${\\Pi_j}$ï¼ˆä¸ä¸€å®šæ˜¯æ­£äº¤åŸºåº•ï¼‰æ¥å¯¹Bä½“ç³»è¿›è¡Œæµ‹é‡ï¼Œå¯¹äºæ¯æ¬¡çš„æµ‹é‡ç»“æœ$j$ï¼Œå…¶æ¦‚ç‡ä¸º$p_j=tr_{AB}(\\rho_{AB}\\Pi_j)$ï¼ŒAçš„æ€å°†åç¼©åˆ°$\\rho_{A}^{j}=\\frac{tr_{B}(\\Pi_{j}\\rho_{AB}\\Pi_j)}{p_j}$ï¼Œåœ¨å¯¹æ‰€æœ‰çš„æµ‹é‡åŸºè¿›è¡Œä¼˜åŒ–æ—¶ï¼Œé‡å­ä½“ç³»çš„ç»å…¸å…³è”å°±å¯å®šä¹‰ä¸ºï¼š $$ C(\\rho_{AB})=S(\\rho_A)-\\min\\limits_{{\\Pi_j}}\\sum_{j}p_j S(\\rho_{A}^{j}) $$\n å…³è”åˆ†ä¸ºç»å…¸å…³è”å’Œé‡å­å…³è”ã€‚\nå¯¹äºä¸¤ä½“é‡å­æ€$\\rho_{AB}$ï¼Œå…¶ç»å…¸å…³è”æ€ï¼Œåˆç§°ç»å…¸-ç»å…¸ï¼ˆå…³è”ï¼‰æ€å®šä¹‰å¦‚ä¸‹ï¼š\nå­˜åœ¨ç³»ç»Ÿ$A$å’Œ$B$ä¸Šçš„å†¯Â·è¯ºä¼Šæ›¼æµ‹é‡ï¼ˆç§©ä¸º1çš„æ­£äº¤æŠ•å½±æµ‹é‡ï¼‰$\\Pi_{i}^{A}$, $\\Pi_{j}^{B}$ï¼Œä½¿å¾—è¯¥æµ‹é‡ä¸æ‰°åŠ¨$\\rho_{AB}$ï¼Œå³ $$ \\rho_{AB}=\\sum_{ij}(\\Pi_{i}^{a}\\otimes\\Pi_{j}^{b})\\rho_{AB}(\\Pi_{i}^{a}\\otimes\\Pi_{j}^{b}) $$ ç®€å•æ¥è¯´å°±æ˜¯æ‰¾ä¸åˆ°ä¸€ä¸ªæµ‹é‡åŸºï¼Œåœ¨å¯¹ä¸¤ä½“é‡å­æ€å…¶ä¸­ä¸€ä¸ªç³»ç»Ÿè¿›è¡Œæµ‹é‡æ—¶ä¼šå¯¹å¦ä¸€ä¸ªç³»ç»Ÿé€ æˆæ‰°åŠ¨ï¼Œè¿™ç§çŠ¶æ€æˆä¸ºç»å…¸å…³è”æ€ã€‚ è‹¥å¯¹å¦ä¸€ä¸ªç³»ç»Ÿé€ æˆäº†æ‰°åŠ¨ï¼Œåˆ™ä¸ºé‡å­å…³è”æ€ã€‚\n4. é‡å­å¤±å ç”±äºå¯¹ä¸¤ä¸ªé‡å­å…³è”åœ¨ä¸€èµ·çš„ä½“ç³»ç§ä¸€ä¸ªè¿›è¡Œæµ‹é‡ï¼Œå°†ä¸å¯é¿å…åœ°å¯¼è‡´å¯¹å¦ä¸€ä¸ªä½“ç³»çš„æ‰°åŠ¨ï¼Œå› æ­¤ç»å…¸äº’ä¿¡æ¯é‡ä¸¤ç§ç­‰ä»·çš„è¡¨è¾¾å½¢å¼åœ¨é‡å­ä¸–ç•Œä¸­ä¸€èˆ¬æ˜¯ä¸ä¸€è‡´çš„ï¼Œå®ƒä»¬ä¹‹é—´çš„å·®å€¼ä¸ºï¼š $$ Q(\\rho_{AB})=I(\\rho_{AB})-C(\\rho_{AB}) $$\nè¿™å°±æ˜¯ é‡å­å¤±å\né‡å­å¤±ååŒ…å«é‡å­ä½“ç³»ä¸­çš„é‡å­çº ç¼ å’Œéçº ç¼ çš„é‡å­å…³è”ï¼Œå®ƒåº¦é‡äº†é‡å­ä½“ç³»ä¸­æ€»çš„éç»å…¸å…³è”ã€‚\né‡å­å¤±åå­˜åœ¨ä»¥ä¸‹æ€§è´¨ï¼š\n  å¯¹äºçº¯æ€ï¼Œé‡å­å¤±åç­‰äºé‡å­çº ç¼ ï¼›å¯¹äºæ··åˆæ€ï¼Œå®ƒä»¬ä¸€èˆ¬ä¸ç›¸ç­‰ã€‚\n  ä¸€èˆ¬æ¥è¯´ï¼Œé‡å­å¤±åä¸æ˜¯å¯¹ç§°çš„ï¼Œè¿™æ˜¯ç”±äºæ¡ä»¶ç†µçš„å®šä¹‰ä¾èµ–äºæµ‹é‡ä½œç”¨åœ¨å“ªä¸€ä¸ªç³»ç»Ÿä¸Šï¼Œå³ $$ D_A(\\rho_{AB})\\ne D_B(\\rho_{AB}) $$ æ­¤å¤„$D_A(\\rho_{AB})$ã€$D_B(\\rho_{AB})$åˆ†åˆ«è¡¨ç¤ºå¯¹Aï¼ŒBç³»ç»Ÿåšå†¯Â·è¯ºä¼Šæ›¼æµ‹é‡å¾—åˆ°çš„é‡å­å¤±åã€‚å½“ç„¶ä¹Ÿå¯ä»¥åŸºäºåŒè¾¹æµ‹é‡ï¼Œä»è€Œå¾—åˆ°å¯¹ç§°åŒ–çš„é‡å­å¤±åã€‚\n  $0\\le D(\\rho_{AB}) \\le I(\\rho_{AB})$ã€‚è¿›ä¸€æ­¥ï¼Œ$D(\\rho_{AB}) \\le S(\\rho_A)$ï¼Œä½†$D(\\rho_{AB}) \\le S(\\rho_B)$ä¸ä¸€å®šæˆç«‹ã€‚\n  é‡å­å¤±ååœ¨å±€éƒ¨é…‰æ“ä½œä¸‹ä¿æŒä¸å˜ï¼Œå³é‡å­æ€$\\rho_{AB}$å’Œ$(U^{A}\\otimes U^{B})\\rho_{AB}(U^{A}\\otimes U^{B})^\\dagger$å…·æœ‰ç›¸åŒçš„é‡å­å¤±åã€‚æ­¤å¤„$U^{A}$å’Œ$U^{B}$åˆ†åˆ«æ˜¯ç³»ç»Ÿ$A$ã€$B$ä¸Šçš„é…‰ç®—å­ã€‚\n  åœ¨ä¸€å®šçš„æ„ä¹‰ä¸‹ï¼Œå‡ ä¹æ‰€æœ‰çš„æ€éƒ½å…·æœ‰éé›¶çš„é‡å­å¤±åã€‚$D(\\rho_{AB})=0$å½“ä¸”ä»…å½“è¿™ä¸ªæ€æ˜¯ç»å…¸-é‡å­æ€ã€‚\n  å¯¹äºæ²¡æœ‰é‡å­å…³è”ä½†æœ‰ç»å…¸å…³è”çš„é‡å­æ€ï¼Œå¯ä»¥é€šè¿‡å±€åŸŸæ“ä½œäº§ç”Ÿé‡å­å…³è”ã€‚äº‹å®ä¸Šï¼Œæ‰€æœ‰çš„éçº ç¼ é‡å­å…³è”éƒ½å¯ç”±å±€åŸŸæ“ä½œåœ¨ç»å…¸æ€ä¸Šäº§ç”Ÿã€‚\n  æ‰€æœ‰çš„çº ç¼ æ€éƒ½å…·æœ‰éé›¶çš„é‡å­å¤±åï¼Œä½†æ˜¯éƒ¨åˆ†å¯åˆ†æ€çš„é‡å­å¤±åä¹Ÿéé›¶ã€‚ä¸€ä¸ªå¾ˆç®€å•çš„ä¾‹å­æ˜¯\n$$ \\rho_{AB}=\\frac{1}{2}(\\ket{0}\\bra{0}\\otimes\\ket{+}\\bra{+}+\\ket{+}\\bra{+}\\otimes\\ket{1}\\bra{1}), where\\ \\ket{+}=\\frac{1}{\\sqrt{2}}(\\ket{0}+\\bra{1}) $$\n  é€šå¸¸æƒ…å†µä¸‹ï¼Œé‡å­å¤±ååœ¨å™ªå£°ç¯å¢ƒä¸­çš„æ¼”åŒ–è¦æ¯”é‡å­çº ç¼ æ›´å¹³ç¨³ã€æ›´æŒä¹…ï¼Œé‡å­å¤±åä¸€èˆ¬ä¸ä¼šåƒé‡å­çº ç¼ é‚£æ ·å‡ºç°çªç„¶æ¶ˆå¤±çš„ç°è±¡ã€‚\n  5. çº ç¼ ã€ç»å…¸å…³è”ã€éç»å…¸å…³è” çº ç¼  å‡è®¾ä¸€ä¸ªå¤åˆç³»ç»Ÿæ˜¯ç”±ä¸¤ä¸ªä¸ç›¸äº’ä½œç”¨çš„å­ç³»ç»ŸAã€Bç»„æˆï¼Œè¿™ä¸¤ä¸ªå­ç³»ç»ŸAã€Bçš„å¸Œå°”ä¼¯ç‰¹ç©ºé—´åˆ†åˆ«ä¸º$H_A$, $H_B$, åˆ™å¤åˆç³»ç»Ÿçš„å¸Œå°”ä¼¯ç‰¹ç©ºé—´$H_{AB}$ä¸ºå¼ é‡ç§¯ $$ H_{AB}=H_A\\otimes H_B $$ è®¾å®šå­ç³»ç»ŸAã€Bçš„é‡å­æ€åˆ†åˆ«ä¸º$|\\alpha\\rangle_A$, $|\\beta\\rangle_B$,å‡è®¾ç¬¦åˆç³»ç»Ÿçš„é‡å­æ€$|\\psi\\rangle_{AB}$ä¸èƒ½å†™ä¸ºå¼ é‡ç§¯$|\\alpha\\rangle_A\\otimes|\\beta\\rangle_B$,åˆ™ç§°è¿™å¤åˆç³»ç»Ÿä¸ºå­ç³»ç»ŸAã€Bçš„çº ç¼ ç³»ç»Ÿï¼Œä¸¤ä¸ªå­ç³»ç»ŸAã€Bç›¸äº’çº ç¼ ã€‚\nç»å…¸å…³è” ç”¨å¯†åº¦ç®—ç¬¦æè¿°çš„ä¸¤é‡å­å¤åˆç³»ç»Ÿè‹¥å¯æè¿°ä¸ºï¼š $$ \\rho_{AB} = \\sum_{i,j}p_{ij}|i\\rangle \\langle j|^{A}\\otimes |j\\rangle \\langle j| $$ å…¶ä¸­ï¼Œ$|i\\rangle^A$æ˜¯å¸Œå°”ä¼¯ç‰¹ç©ºé—´$H_A$ä¸Šçš„æ­£äº¤æ€ï¼Œ$|j\\rangle^B$æ˜¯å¸Œå°”ä¼¯ç‰¹ç©ºé—´$H_B$ä¸Šçš„æ­£äº¤æ€, åˆ™å¯ä»¥è¯´è¿™ä¸¤ä¸ªé‡å­ä¹‹é—´å…·æœ‰ç»å…¸å…³è”\néç»å…¸å…³è” å¦‚æœ$|i\\rangle^A$ï¼Œ$|j\\rangle^B$ä¸æ˜¯$H_A$,$H_B$ä¸Šçš„æ­£äº¤æ€ï¼Œåˆ™$AB$æ˜¯éç»å…¸å…³è”.\nä»¥ä¸Šä¸‰ä¸ªå®šä¹‰å¯ä»¥è¯´æ˜ï¼Œæ··åˆæ€å¯èƒ½å…·æœ‰ä¸€äº›ä¸çº ç¼ æ€ä¸åŒçš„éç»å…¸ç›¸å…³ï¼Œå› ä¸ºè¿™ç§çŠ¶æ€æ˜¯å¯åˆ†çš„\n","permalink":"http://yangchnet.github.io/Dessert/posts/quantum/%E9%87%8F%E5%AD%90%E5%85%B3%E8%81%94/","summary":"1. äº’ä¿¡æ¯é‡ ä¿¡æ¯ç†µï¼ˆé¦™å†œç†µï¼‰ $$ H(A) = - \\sum_{x\\in X}p(x)\\log p(x) $$ ä¿¡æ¯ç†µåº¦é‡äº†ä¿¡æ¯é‡çš„å¤šå°‘ã€‚å¦‚è‹±è¯­æœ‰26ä¸ªå­—æ¯ï¼ŒåŠ å…¥æ¯ä¸ªå­—æ¯åœ¨æ–‡ç« ä¸­å‡ºç°æ¬¡æ•°ç›¸åŒçš„è¯ï¼Œæ¯ä¸ªå­—æ¯çš„ä¿¡æ¯é‡ä¸º: $$ I_e = -\\log_2{\\frac{1}{26}}=4.7 $$ è‹¥æœ‰ä¸€ä¸ªå­—æ¯å‡ºç°æ¬¡æ•°ä¸ºæ€»æ¬¡æ•°çš„ä¸€åŠï¼Œåˆ™å…¶ä¿¡æ¯ç†µä¸ºï¼š $$ I_e = -\\log_2{\\frac{1}{2}} = 1 $$ ä»¥ä¸Šä¾‹å­è¯´æ˜ï¼ŒæŸä¸€ä¸ªä¿¡æ¯å‡ºç°æ¬¡æ•°è¶Šå¤šï¼Œå…¶ä¿¡æ¯é‡å°±è¶Šå°‘ã€‚ç›´è§‚çš„è¯´ï¼ŒæŸä¸€ç¯‡æ–‡ç« ä¸­ï¼Œâ€œçš„â€ï¼Œâ€œæˆ‘â€ç­‰è¯è¯­å¯èƒ½å‡ºç°æ¬¡æ•°æœ€å¤šï¼Œä½†å…¶èƒ½ä¸ºæˆ‘ä»¬å¸¦æ¥çš„ä¿¡æ¯å¯èƒ½å¹¶ä¸æ˜¯é‚£ä¹ˆå¤šã€‚\nç»å…¸äº’ä¿¡æ¯é‡ å‡å®šæˆ‘ä»¬åœ¨ä¸€ç³»åˆ—çš„ä¸åŒæ—¶åˆ»$(t_1, t_2, \\dots, t_N)$å¯¹ä¸€ä¸ªç»™å®šçš„ç³»ç»Ÿè¿›è¡Œè¿ç»­æµ‹é‡ï¼ŒæŠŠæ¯æ¬¡æµ‹é‡ç»“æœè®°ä¸º$x_1, x_2,\\dots, x_N$ï¼Œæ¯ä¸ªæµ‹é‡åºåˆ—çš„ç»“æœéƒ½æœ‰ä¸åŒçš„æ¦‚ç‡è¾“å‡ºï¼Œå°†ä¹‹è®°ä¸º$p(x_1), p(x_2), \\dots, p(x_N)$.\nåˆ™å…³è”å°±æ„å‘³ç€å¯¹äºä»»æ„çš„$1\\le n \\le N$ï¼Œè¿™äº›æ¦‚ç‡åˆ†å¸ƒä¸ä¼šä»¥ä¹˜ç§¯çš„å½¢å¼å‡ºç°ï¼Œå³$p(x_1, x_2, \\dots, x_n)*p(x_n+1, x_n+2, \\dots, x_N)$ã€‚ç”¨é€šä¿—æ˜“æ‡‚çš„è¯æ¥è¯´ï¼Œå°±æ˜¯è¿™äº›æ¦‚ç‡åˆ†å¸ƒä¸æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚\nç®€å•èµ·è§ï¼Œæˆ‘ä»¬å°†æ‰€æœ‰æµ‹é‡åˆ†ä¸ºä¸¤ç»„Aå’ŒBï¼Œè¿™æ ·Aå’ŒBä¹‹é—´çš„äº’ä¿¡æ¯é‡å°±å®šä¹‰ä¸ºï¼š $$ I(A:B) = H(A)+H(B) - H(A,B), where\\ H(A) = - \\sum_{x\\in X}p(x)\\log p(x) $$\nåˆï¼Œæ ¹æ®è´å¶æ–¯å®šç†$H(A|B)=H(A,B)-H(B)$ï¼Œç»å…¸äº’ä¿¡æ¯é‡è¿˜æœ‰ä¸€ä¸ªç­‰ä»·çš„è¡¨è¾¾æ–¹å¼ï¼š $$ C(A:B)=H(A)-H(A|B) $$ å…¶ä¸­$H(A|B)$è¡¨ç¤ºåœ¨çŸ¥é“Bä½“ç³»æµ‹é‡ç»“æœæƒ…å†µä¸‹Aä½“ç³»çš„æ¡ä»¶ç†µã€‚å› æ­¤ï¼Œç»å…¸äº’ä¿¡æ¯é‡åº¦é‡äº†åœ¨å¯¹Bæµ‹é‡æ—¶æ‰€èƒ½æå–çš„Açš„ä¿¡æ¯é‡ã€‚\n2. é‡å­äº’ä¿¡æ¯é‡ å°†ç»å…¸äº’ä¿¡æ¯é‡çš„ç†è®ºæ¨å¹¿åˆ°é‡å­ç³»ç»Ÿï¼Œè¿™æ ·å°±èƒ½å¾—åˆ°é‡å­äº’ä¿¡æ¯é‡çš„æ¦‚å¿µï¼Œè€ƒè™‘ä¸€ä¸ªä¸¤ä½“çš„é‡å­æ€$\\rho_{AB}$ï¼Œé‡å­äº’ä¿¡æ¯é‡å®šä¹‰ä¸ºï¼š $$ I(\\rho_{AB})=S(\\rho_{A})+S(\\rho_{B})-S(\\rho_{AB}) $$ å…¶ä¸­$S(\\rho)=-tr\\rho\\log(\\rho)$ä¸ºå†¯Â·è¯ºä¼Šæ›¼ç†µï¼Œï¼ˆ$tr$æŒ‡æ±‚è¿¹ï¼Œå³æ±‚çŸ©é˜µå¯¹è§’çº¿å…ƒç´ ä¹‹å’Œï¼‰,$\\rho_A$å’Œ$\\rho_B$åˆ†åˆ«ä¸º$\\rho_{AB}$çš„çº¦åŒ–å¯†åº¦çŸ©é˜µã€‚","title":"é‡å­å…³è”ä¸é‡å­å¤±å"},{"content":"0. å‰è®° ä½œä¸ºä¸€ä¸ªæŠ€æœ¯äººå‘˜, ä¸€ä¸ªç¬”è®°è½¯ä»¶å¯¹äºæˆ‘ä»¬æ¥è¯´å¿…ä¸å¯å°‘ï¼Œæ¯ä¸ªäººå¯¹ç¬”è®°è½¯ä»¶çš„éœ€æ±‚åˆå„ä¸ç›¸åŒã€‚å¯¹äºæˆ‘æ¥è¯´ï¼Œæˆ‘å¸Œæœ›ä¸€ä¸ªäº‘ç¬”è®°çš„åŠŸèƒ½åŒ…æ‹¬ï¼šmarkdownæ”¯æŒã€latexå…¬å¼ç¼–è¾‘ã€å¾ˆå¥½çš„ç‰ˆæœ¬æ§åˆ¶ã€å¯ä»¥æ–¹ä¾¿çš„åˆ†äº«ã€å¯ä»¥æ–¹ä¾¿çš„å¯¼å‡º/å¯¼å…¥ã€ä»£ç å—æ”¯æŒã€å›¾ç‰‡æ’å…¥ç­‰ã€‚\næˆ‘ç”¨è¿‡å¾ˆå¤šäº‘ç¬”è®°è½¯ä»¶ï¼Œå°è±¡ç¬”è®°ã€ä¸ºçŸ¥ç¬”è®°ã€æœ‰é“äº‘ã€Notionã€OneNoteç­‰ï¼Œè¿™äº›å¸‚é¢ä¸Šå¸¸è§çš„äº‘ç¬”è®°è½¯ä»¶å‡æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ä½ ç”¨äº†ä¸€æ®µæ—¶é—´åï¼Œå‘ç°è‡ªå·±è¢«é™åˆ¶åœ¨é‡Œé¢äº†ï¼Œä½ æ— æ³•å¯¹ä½ çš„ç¬”è®°è¿›è¡Œå¯¼å‡ºï¼Œæ›´æ¢ä¸€ä¸ªä½ è§‰å¾—æ›´å¥½çš„ç¬”è®°è½¯ä»¶ã€‚è¿™å¯¹æˆ‘æ¥è¯´æ˜¯ä¸å¯æ¥å—çš„ï¼Œæˆ‘å¸Œæœ›æˆ‘çš„ç¬”è®°å¯ä»¥æ»¡è¶³ä¸‰ä¸ªè¦æ±‚ï¼š\n å¥½ç”¨ï¼Œèƒ½å¤Ÿæ”¯æŒmarkdowné€šç”¨æ ¼å¼ æ•°æ®å®Œå…¨å—æˆ‘æ§åˆ¶ï¼Œæˆ‘å¯ä»¥ä»»æ„ç§»åŠ¨ã€å¤ç”¨ç­‰ æ•°æ®è¦èƒ½å®‰å…¨çš„å­˜å‚¨åœ¨äº‘ç«¯ï¼Œæœ‰å¤‡ä»½  å› æ­¤ï¼Œæˆ‘åæ¥åˆä½¿ç”¨äº†jupyter notebookï¼Œç”¨è¿‡jupyterçš„åŒå­¦çŸ¥é“ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸Šé¢ç¼–è¾‘ä»£ç ï¼Œmarkdownå’Œlatexä¹Ÿè¢«å¾ˆå¥½çš„æ”¯æŒï¼Œè€Œåˆç”±äºjupyterçš„æºæ–‡ä»¶æ˜¯æ–‡æœ¬æ–‡ä»¶ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥æ–¹ä¾¿çš„ä½¿ç”¨gitå¯¹å…¶è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ï¼Œè¿™ç§æ–¹å¼å¯ä»¥è¯´æ»¡è¶³äº†æˆ‘çš„ç»å¤§éƒ¨åˆ†éœ€è¦ï¼Œæ˜¯ä¸€ç§éå¸¸niceçš„ç¬”è®°æ–¹å¼ã€‚\nä½†ä»Šå¤©æˆ‘ä»¬è¦è¯´çš„æ˜¯å¦ä¸€ç§éå¸¸çº¯ç²¹çš„æ–¹å¼ï¼ŒåªæŠŠç¬”è®°æºæ–‡ä»¶å­˜å‚¨ä¸ºmarkdownï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥ç”¨ä»»ä½•ç¼–è¾‘å™¨ä¹¦å†™ï¼Œç„¶åç”¨gitè¿›è¡Œç‰ˆæœ¬æ§åˆ¶ï¼Œç”¨Github Pagesè¿›è¡Œå±•ç¤ºä¸åˆ†äº«ï¼Œå…·ä½“è¿‡ç¨‹å¦‚ä¸‹ã€‚\n1. hugoçš„ä½¿ç”¨  ä¸ºä»€ä¹ˆè¦ç”¨hugoï¼Ÿé¦–å…ˆæˆ‘ä»¬éœ€è¦ä¸€ç§åˆ†äº«å±•ç¤ºç¬”è®°çš„æ–¹å¼ï¼Œå°†å…¶ç¼–è¯‘ä¸ºé™æ€ç½‘ç«™æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚é™¤äº†hugoï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨hexoç­‰ç±»ä¼¼çš„é™æ€ç½‘ç«™ç¼–è¯‘å·¥å…·ã€‚\n 1.1 å®‰è£…hugo åˆ°GitHubä¸Šhugoçš„releaseé¡µé¢ä¸‹è½½ä½ çš„ç³»ç»Ÿéœ€è¦çš„ç‰ˆæœ¬ï¼Œæ¯”å¦‚æˆ‘çš„ç³»ç»Ÿä¸º64ä½Linuxï¼Œé‚£ä¹ˆæˆ‘éœ€è¦ä¸‹è½½hugo_*.**.*_Linux-64bit.tar.gzï¼ˆä¸­é—´çš„æ˜Ÿå·ä¸ºç‰ˆæœ¬å·ï¼Œè¿™é‡Œä»£è¡¨ä½ å¯ä»¥ä»»æ„é€‰æ‹©ï¼‰ã€‚\nå°†å…¶ä¸‹è½½åˆ°æœ¬åœ°ä¹‹åï¼Œè§£å‹å®‰è£…ã€‚\ntar -zxvf hugo_0.89.2_Linux-64bit.tar.gz sudo mv hugo /usr/local/bin å®‰è£…å®Œæˆ\n1.2 å¼€å§‹ hugoçš„ä½¿ç”¨ç‚’é¸¡ç®€å•ï¼Œä½ åªéœ€è¦ä½¿ç”¨\nhugo new site MySite # ä½ å¯ä»¥å–ä¸€ä¸ªå¥½å¬çš„åå­— å³å¯æ–°å»ºä¸€ä¸ªåä¸ºMySiteçš„ç½‘ç«™\n1.2 ä¸ºä½ çš„ç½‘ç«™é€‰æ‹©ä¸€ä¸ªtheme è¿›å…¥åˆ°æˆ‘ä»¬åˆšæ‰å»ºç«‹çš„ç½‘ç«™ç›®å½•\ncd Mysite/ ä»GitHubå¯¼å…¥ä½ æƒ³åº”ç”¨çš„ä¸»é¢˜\ngit submodule add git@github.com:adityatelange/hugo-PaperMod.git themes/PaperMod --depth=1 å¾…ä¸‹è½½å®Œæˆåï¼Œè¿˜éœ€è¦ä¿®æ”¹ä½ çš„é…ç½®æ–‡ä»¶\nbaseURL = \u0026#34;http://your-user-name.github.io/Mysite/\u0026#34; # ä½¿ç”¨ä½ è‡ªå·±çš„ç”¨æˆ·å languageCode = \u0026#34;en-us\u0026#34; title = \u0026#34;My New Hugo Site\u0026#34; theme = \u0026#34;PaperMod\u0026#34; 1.3 ä¸ºä½ çš„ç½‘ç«™æ·»åŠ ä¸€äº›å†…å®¹ hugoä½¿ç”¨æˆ‘ä»¬ä¸Šä¼ çš„mdæ–‡ä»¶æ¥è‡ªåŠ¨ç”Ÿæˆé™æ€ç½‘é¡µï¼Œè€Œæˆ‘ä»¬ä¸Šä¼ çš„mdæ–‡ä»¶çš„ä½ç½®åœ¨MySite/content/posts/*, æˆ‘ä»¬å¯ä»¥ç›´æ¥å¤åˆ¶å·²ç»ç¼–è¾‘å¥½çš„mdæ–‡ä»¶åˆ°è¿™ä¸ªç›®å½•ï¼Œæˆ–è€…ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š\nhugo new posts/first/my-first-post.md éœ€è¦æ³¨æ„çš„ä¸€ç‚¹ï¼šä¸ºäº†è®©hugoçŸ¥é“æ›´å¤šçš„ä¿¡æ¯ï¼Œæˆ‘ä»¬ä¸Šä¼ çš„mdæ–‡ä»¶ä¸€èˆ¬ä¼šæœ‰ä¸€ä¸ª\u0026quot;standand header\u0026quot;, å¦‚ä¸‹ï¼š\n--- title: \u0026quot;My First Post\u0026quot; date: 2019-03-26T08:47:11+01:00 draft: true --- è¿™é‡Œçš„å¤´éƒ¨å¹¶ä¸æ˜¯ä¸€æˆä¸å˜çš„ï¼Œä½ å¯ä»¥æ ¹æ®éœ€è¦è‡ªè¡Œé…ç½®ã€‚\n æˆ‘ä»¬æ‰€æœ‰çš„ç¬”è®°æºæ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯markdownæ–‡ä»¶ï¼Œéƒ½å­˜å‚¨åœ¨postæ–‡ä»¶å¤¹é‡Œï¼Œä½ å¯ä»¥åœ¨é‡Œé¢åˆ›å»ºä¸åŒåˆ†ç±»çš„æ–‡ä»¶å¤¹\n 1.4 å¼€å§‹è®©ä½ çš„ç½‘ç«™æœåŠ¡ ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è®©ä½ çš„ç½‘ç«™å¼€å§‹æœåŠ¡å§ï¼\nhugo server -D æ³¨æ„ï¼Œè¿™ä¸ªå‘½ä»¤åªä¼šè®©ä½ çš„hugoæœåŠ¡å™¨ç›‘å¬æœ¬åœ°è®¿é—®ï¼Œä¹Ÿå°±æ˜¯127.0.0.1 å¦‚æœä½ æƒ³è¦ä½ çš„hugoæœåŠ¡å™¨ä¸ºæ•´ä¸ªç½‘ç»œæœåŠ¡ï¼Œå¯ä»¥è¿™æ ·ï¼š\nhugo server --bind=\u0026#39;0.0.0.0\u0026#39; è¿™æ ·ï¼Œä½ çš„ç½‘ç«™å°±å¯ä»¥å…¨ç½‘è®¿é—®äº†ã€‚\n å®Œæˆä¸Šé¢çš„å·¥ä½œåï¼Œæˆ‘ä»¬å°±æœ‰äº†è‡ªå·±æœ¬åœ°çš„ç¬”è®°ï¼Œä½ å¯ä»¥æ‰“å¼€postæ–‡ä»¶å¤¹ï¼Œä½¿ç”¨ä»»ä½•ä½ å–œæ¬¢çš„ç¼–è¾‘å™¨ï¼Œvscodeã€sublimeã€Typoraã€notepadã€ç”šè‡³æ˜¯è®°äº‹æœ¬ï¼Œæ¥ä¹¦å†™ä½ çš„ç¬”è®°ï¼Œåªéœ€è¦æŒ‰ç…§markdownçš„æ ¼å¼æ¥è¿›è¡Œç¼–è¾‘ï¼Œä½ å°±å¯ä»¥é€šè¿‡è°ƒæ•´hugoçš„themeå¾—åˆ°è®¸å¤šæˆªç„¶ä¸åŒçš„æ¼‚äº®çš„é¡µé¢ã€‚\n 2. ä½¿ç”¨gitè¿›è¡Œç‰ˆæœ¬æ§åˆ¶ 2.1 åˆ›å»ºgithubä»“åº“ æ‰“å¼€ä½ çš„GitHubè´¦å·ï¼Œåˆ›å»ºä¸€ä¸ªä»“åº“ï¼Œä¸è¦å‹¾é€‰Readme.mdæˆ–LICENSEç­‰ï¼Œè¿™æ ·å°±å¾—åˆ°äº†ä¸€ä¸ªç©ºçš„GitHubä»“åº“ã€‚\n2.2 æäº¤æœ¬åœ°æ›´æ”¹ æäº¤æ‰€æœ‰æ›´æ”¹\ngit add . git commit -m \u0026quot;init commit\u0026quot; é“¾æ¥åˆ°GitHubè¿œç¨‹ä»“åº“\ngit remote add origin git@github.com:your_name/your_repo.git æ¨é€åˆ°github\ngit push 3. åˆ†äº«ä½ çš„äº‘ç¬”è®° æˆ‘ä»¬å°†ç¬”è®°ä»¥hugoé¡¹ç›®çš„å½¢å¼åˆ†äº«åˆ°äº†GitHubï¼Œä½†æ˜¯è¿™å¹¶ä¸æ˜¯æœ€ç»ˆçš„å½¢å¼ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡Github Action + Github Pagesçš„æ–¹å¼ï¼Œæ¥å®ç°äº‘ç¬”è®°çš„è‡ªåŠ¨å‘å¸ƒã€è‡ªåŠ¨æ›´æ–°ã€‚\nåœ¨GitHubä¸Šæ‰“å¼€ä½ çš„ä»“åº“ï¼Œé€‰æ‹©Actioné€‰é¡¹å¡ é€‰æ‹©set up a workflow yourself ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\nname: github pages on: push: branches: - master  # Set a branch to deploy pull_request: jobs: deploy: runs-on: ubuntu-18.04 steps: - uses: actions/checkout@v2 with: submodules: true # Fetch Hugo themes (true OR recursive) fetch-depth: 0 # Fetch all history for .GitInfo and .Lastmod - name: Setup Hugo uses: peaceiris/actions-hugo@v2 with: hugo-version: \u0026#39;0.81.0\u0026#39; # ä½¿ç”¨ä½ çš„ç‰ˆæœ¬ # extended: true - name: Build run: hugo --minify - name: Deploy uses: peaceiris/actions-gh-pages@v3 if: github.ref == \u0026#39;refs/heads/master\u0026#39; with: github_token: ${{ secrets.GITHUB_TOKEN }} publish_dir: ./public è¿™ä¸ªæ–‡ä»¶ä¸­æœ‰ä¸¤å¤„éœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼Œä¸€ä¸ªæ˜¯åˆ†æ”¯åè¦ä¸ä½ çš„åˆ†æ”¯åä¸€è‡´ï¼ŒäºŒæ˜¯hugoç‰ˆæœ¬å·è¦å°½é‡ä¸æœ¬åœ°ä¸€è‡´\næäº¤æ›´æ”¹ æäº¤ä¹‹åï¼Œå†æ¬¡æ‰“å¼€GitHub Actionï¼Œä½ ä¼šå‘ç°GitHubåœ¨ä¸ºä½ è‡ªåŠ¨éƒ¨ç½²hugoç½‘ç«™\nç°åœ¨æ‰¾åˆ°GitHub Pages è®¿é—®è¿™ä¸ªåœ°å€ï¼Œä¸å‡ºæ„å¤–çš„è¯ï¼Œä½ çš„ç½‘ç«™å·²ç»ä¸Šçº¿äº†ã€‚\n","permalink":"http://yangchnet.github.io/Dessert/posts/env/%E4%BD%93%E9%AA%8C%E8%BF%87%E7%9A%84%E6%9C%80%E5%A5%BD%E7%9A%84%E4%BA%91%E7%AC%94%E8%AE%B0%E6%96%B9%E5%BC%8F/","summary":"0. å‰è®° ä½œä¸ºä¸€ä¸ªæŠ€æœ¯äººå‘˜, ä¸€ä¸ªç¬”è®°è½¯ä»¶å¯¹äºæˆ‘ä»¬æ¥è¯´å¿…ä¸å¯å°‘ï¼Œæ¯ä¸ªäººå¯¹ç¬”è®°è½¯ä»¶çš„éœ€æ±‚åˆå„ä¸ç›¸åŒã€‚å¯¹äºæˆ‘æ¥è¯´ï¼Œæˆ‘å¸Œæœ›ä¸€ä¸ªäº‘ç¬”è®°çš„åŠŸèƒ½åŒ…æ‹¬ï¼šmarkdownæ”¯æŒã€latexå…¬å¼ç¼–è¾‘ã€å¾ˆå¥½çš„ç‰ˆæœ¬æ§åˆ¶ã€å¯ä»¥æ–¹ä¾¿çš„åˆ†äº«ã€å¯ä»¥æ–¹ä¾¿çš„å¯¼å‡º/å¯¼å…¥ã€ä»£ç å—æ”¯æŒã€å›¾ç‰‡æ’å…¥ç­‰ã€‚\næˆ‘ç”¨è¿‡å¾ˆå¤šäº‘ç¬”è®°è½¯ä»¶ï¼Œå°è±¡ç¬”è®°ã€ä¸ºçŸ¥ç¬”è®°ã€æœ‰é“äº‘ã€Notionã€OneNoteç­‰ï¼Œè¿™äº›å¸‚é¢ä¸Šå¸¸è§çš„äº‘ç¬”è®°è½¯ä»¶å‡æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ä½ ç”¨äº†ä¸€æ®µæ—¶é—´åï¼Œå‘ç°è‡ªå·±è¢«é™åˆ¶åœ¨é‡Œé¢äº†ï¼Œä½ æ— æ³•å¯¹ä½ çš„ç¬”è®°è¿›è¡Œå¯¼å‡ºï¼Œæ›´æ¢ä¸€ä¸ªä½ è§‰å¾—æ›´å¥½çš„ç¬”è®°è½¯ä»¶ã€‚è¿™å¯¹æˆ‘æ¥è¯´æ˜¯ä¸å¯æ¥å—çš„ï¼Œæˆ‘å¸Œæœ›æˆ‘çš„ç¬”è®°å¯ä»¥æ»¡è¶³ä¸‰ä¸ªè¦æ±‚ï¼š\n å¥½ç”¨ï¼Œèƒ½å¤Ÿæ”¯æŒmarkdowné€šç”¨æ ¼å¼ æ•°æ®å®Œå…¨å—æˆ‘æ§åˆ¶ï¼Œæˆ‘å¯ä»¥ä»»æ„ç§»åŠ¨ã€å¤ç”¨ç­‰ æ•°æ®è¦èƒ½å®‰å…¨çš„å­˜å‚¨åœ¨äº‘ç«¯ï¼Œæœ‰å¤‡ä»½  å› æ­¤ï¼Œæˆ‘åæ¥åˆä½¿ç”¨äº†jupyter notebookï¼Œç”¨è¿‡jupyterçš„åŒå­¦çŸ¥é“ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸Šé¢ç¼–è¾‘ä»£ç ï¼Œmarkdownå’Œlatexä¹Ÿè¢«å¾ˆå¥½çš„æ”¯æŒï¼Œè€Œåˆç”±äºjupyterçš„æºæ–‡ä»¶æ˜¯æ–‡æœ¬æ–‡ä»¶ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥æ–¹ä¾¿çš„ä½¿ç”¨gitå¯¹å…¶è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ï¼Œè¿™ç§æ–¹å¼å¯ä»¥è¯´æ»¡è¶³äº†æˆ‘çš„ç»å¤§éƒ¨åˆ†éœ€è¦ï¼Œæ˜¯ä¸€ç§éå¸¸niceçš„ç¬”è®°æ–¹å¼ã€‚\nä½†ä»Šå¤©æˆ‘ä»¬è¦è¯´çš„æ˜¯å¦ä¸€ç§éå¸¸çº¯ç²¹çš„æ–¹å¼ï¼ŒåªæŠŠç¬”è®°æºæ–‡ä»¶å­˜å‚¨ä¸ºmarkdownï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥ç”¨ä»»ä½•ç¼–è¾‘å™¨ä¹¦å†™ï¼Œç„¶åç”¨gitè¿›è¡Œç‰ˆæœ¬æ§åˆ¶ï¼Œç”¨Github Pagesè¿›è¡Œå±•ç¤ºä¸åˆ†äº«ï¼Œå…·ä½“è¿‡ç¨‹å¦‚ä¸‹ã€‚\n1. hugoçš„ä½¿ç”¨  ä¸ºä»€ä¹ˆè¦ç”¨hugoï¼Ÿé¦–å…ˆæˆ‘ä»¬éœ€è¦ä¸€ç§åˆ†äº«å±•ç¤ºç¬”è®°çš„æ–¹å¼ï¼Œå°†å…¶ç¼–è¯‘ä¸ºé™æ€ç½‘ç«™æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚é™¤äº†hugoï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨hexoç­‰ç±»ä¼¼çš„é™æ€ç½‘ç«™ç¼–è¯‘å·¥å…·ã€‚\n 1.1 å®‰è£…hugo åˆ°GitHubä¸Šhugoçš„releaseé¡µé¢ä¸‹è½½ä½ çš„ç³»ç»Ÿéœ€è¦çš„ç‰ˆæœ¬ï¼Œæ¯”å¦‚æˆ‘çš„ç³»ç»Ÿä¸º64ä½Linuxï¼Œé‚£ä¹ˆæˆ‘éœ€è¦ä¸‹è½½hugo_*.**.*_Linux-64bit.tar.gzï¼ˆä¸­é—´çš„æ˜Ÿå·ä¸ºç‰ˆæœ¬å·ï¼Œè¿™é‡Œä»£è¡¨ä½ å¯ä»¥ä»»æ„é€‰æ‹©ï¼‰ã€‚\nå°†å…¶ä¸‹è½½åˆ°æœ¬åœ°ä¹‹åï¼Œè§£å‹å®‰è£…ã€‚\ntar -zxvf hugo_0.89.2_Linux-64bit.tar.gz sudo mv hugo /usr/local/bin å®‰è£…å®Œæˆ\n1.2 å¼€å§‹ hugoçš„ä½¿ç”¨ç‚’é¸¡ç®€å•ï¼Œä½ åªéœ€è¦ä½¿ç”¨\nhugo new site MySite # ä½ å¯ä»¥å–ä¸€ä¸ªå¥½å¬çš„åå­— å³å¯æ–°å»ºä¸€ä¸ªåä¸ºMySiteçš„ç½‘ç«™\n1.2 ä¸ºä½ çš„ç½‘ç«™é€‰æ‹©ä¸€ä¸ªtheme è¿›å…¥åˆ°æˆ‘ä»¬åˆšæ‰å»ºç«‹çš„ç½‘ç«™ç›®å½•\ncd Mysite/ ä»GitHubå¯¼å…¥ä½ æƒ³åº”ç”¨çš„ä¸»é¢˜\ngit submodule add git@github.com:adityatelange/hugo-PaperMod.git themes/PaperMod --depth=1 å¾…ä¸‹è½½å®Œæˆåï¼Œè¿˜éœ€è¦ä¿®æ”¹ä½ çš„é…ç½®æ–‡ä»¶\nbaseURL = \u0026#34;http://your-user-name.github.io/Mysite/\u0026#34; # ä½¿ç”¨ä½ è‡ªå·±çš„ç”¨æˆ·å languageCode = \u0026#34;en-us\u0026#34; title = \u0026#34;My New Hugo Site\u0026#34; theme = \u0026#34;PaperMod\u0026#34; 1.","title":"ä½“éªŒè¿‡çš„æœ€å¥½çš„äº‘ç¬”è®°æ–¹å¼"},{"content":" æ‘˜æŠ„è‡ªï¼šæå®¢æ—¶é—´ã€Šå‘¨å¿—æ˜çš„è½¯ä»¶æ¶æ„è¯¾ã€‹\n 1. æ•°æ®åº“ä¸­çš„ä¸‰ç§é”   å†™é”ï¼ˆWrite Lockï¼Œä¹Ÿå«åšæ’ä»–é” eXclusive Lockï¼Œç®€å†™ä¸º X-Lockï¼‰ï¼šåªæœ‰æŒæœ‰å†™é”çš„äº‹åŠ¡æ‰èƒ½å¯¹æ•°æ®è¿›è¡Œå†™å…¥æ“ä½œï¼Œæ•°æ®åŠ æŒç€å†™é”æ—¶ï¼Œå…¶ä»–äº‹åŠ¡ä¸èƒ½å†™å…¥æ•°æ®ï¼Œä¹Ÿä¸èƒ½æ–½åŠ è¯»é”ã€‚\n  è¯»é”ï¼ˆRead Lockï¼Œä¹Ÿå«åšå…±äº«é” Shared Lockï¼Œç®€å†™ä¸º S-Lockï¼‰ï¼šå¤šä¸ªäº‹åŠ¡å¯ä»¥å¯¹åŒä¸€ä¸ªæ•°æ®æ·»åŠ å¤šä¸ªè¯»é”ï¼Œæ•°æ®è¢«åŠ ä¸Šè¯»é”åå°±ä¸èƒ½å†è¢«åŠ ä¸Šå†™é”ï¼Œæ‰€ä»¥å…¶ä»–äº‹åŠ¡ä¸èƒ½å¯¹è¯¥æ•°æ®è¿›è¡Œå†™å…¥ï¼Œä½†ä»ç„¶å¯ä»¥è¯»å–ã€‚å¯¹äºæŒæœ‰è¯»é”çš„äº‹åŠ¡ï¼Œå¦‚æœè¯¥æ•°æ®åªæœ‰ä¸€ä¸ªäº‹åŠ¡åŠ äº†è¯»é”ï¼Œé‚£å¯ä»¥ç›´æ¥å°†å…¶å‡çº§ä¸ºå†™é”ï¼Œç„¶åå†™å…¥æ•°æ®ã€‚\n  èŒƒå›´é”ï¼ˆRange Lockï¼‰ï¼šå¯¹äºæŸä¸ªèŒƒå›´ç›´æ¥åŠ æ’ä»–é”ï¼Œåœ¨è¿™ä¸ªèŒƒå›´å†…çš„æ•°æ®ä¸èƒ½è¢«è¯»å–ï¼Œä¹Ÿä¸èƒ½è¢«å†™å…¥ã€‚å¦‚ä¸‹è¯­å¥æ˜¯å…¸å‹çš„åŠ èŒƒå›´é”çš„ä¾‹å­ï¼š\n  SELECT * FROM books WHERE price \u0026lt; 100 FOR UPDATE; 2. æœ¬åœ°äº‹åŠ¡çš„å››ç§éš”ç¦»çº§åˆ«  ä»¥ä¸‹éš”ç¦»çº§åˆ«ä»é«˜åˆ°ä½\n å¯ä¸²è¡ŒåŒ–  é¡¾åæ€ä¹‰æ˜¯å¯¹äºåŒä¸€è¡Œè®°å½•ï¼Œâ€œå†™â€ä¼šåŠ â€œå†™é”â€ï¼Œâ€œè¯»â€ä¼šåŠ â€œè¯»é”â€ã€‚å½“å‡ºç°è¯»å†™é”å†²çªçš„æ—¶å€™ï¼Œåè®¿é—®çš„äº‹åŠ¡å¿…é¡»ç­‰å‰ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œå®Œæˆï¼Œæ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚\n ä¸²è¡ŒåŒ–è®¿é—®æä¾›äº†å¼ºåº¦æœ€é«˜çš„éš”ç¦»æ€§ã€‚å¯ä¸²è¡ŒåŒ–æ¯”è¾ƒç¬¦åˆæ™®é€šç¨‹åºå‘˜å¯¹æ•°æ®ç«äº‰åŠ é”çš„ç†è§£ï¼Œå¦‚æœä¸è€ƒè™‘æ€§èƒ½ä¼˜åŒ–çš„è¯ï¼Œå¯¹äº‹åŠ¡æ‰€æœ‰è¯»ã€å†™çš„æ•°æ®å…¨éƒ½åŠ ä¸Šè¯»é”ã€å†™é”å’ŒèŒƒå›´é”å³å¯ï¼ˆè¿™ç§å¯ä¸²è¡ŒåŒ–çš„å®ç°æ–¹æ¡ˆç§°ä¸º Two-Phase Lockï¼‰ã€‚\nä½†æ•°æ®åº“æ˜¾ç„¶ä¸å¯èƒ½ä¸è€ƒè™‘æ€§èƒ½ï¼Œå¹¶å‘æ§åˆ¶ç†è®ºï¼ˆConcurrency Controlï¼‰å†³å®šäº†éš”ç¦»ç¨‹åº¦ä¸å¹¶å‘èƒ½åŠ›æ˜¯ç›¸äº’æŠµè§¦çš„ï¼Œéš”ç¦»ç¨‹åº¦è¶Šé«˜ï¼Œå¹¶å‘è®¿é—®æ—¶çš„ååé‡å°±è¶Šä½ã€‚ç°ä»£æ•°æ®åº“ä¸€å®šä¼šæä¾›é™¤å¯ä¸²è¡ŒåŒ–ä»¥å¤–çš„å…¶ä»–éš”ç¦»çº§åˆ«ä¾›ç”¨æˆ·ä½¿ç”¨ï¼Œè®©ç”¨æˆ·è°ƒèŠ‚éš”ç¦»çº§åˆ«çš„é€‰é¡¹ï¼Œè¿™æ ·åšçš„æ ¹æœ¬ç›®çš„æ˜¯è®©ç”¨æˆ·å¯ä»¥è°ƒèŠ‚æ•°æ®åº“çš„åŠ é”æ–¹å¼ï¼Œå–å¾—éš”ç¦»æ€§ä¸ååé‡ä¹‹é—´çš„å¹³è¡¡ã€‚\nå¯é‡å¤è¯»  ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­çœ‹åˆ°çš„æ•°æ®ï¼Œæ€»æ˜¯è·Ÿè¿™ä¸ªäº‹åŠ¡åœ¨å¯åŠ¨æ—¶çœ‹åˆ°çš„æ•°æ®æ˜¯ä¸€è‡´çš„ã€‚å½“ç„¶åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œæœªæäº¤å˜æ›´å¯¹å…¶ä»–äº‹åŠ¡ä¹Ÿæ˜¯ä¸å¯è§çš„ã€‚\n å¯ä¸²è¡ŒåŒ–çš„ä¸‹ä¸€ä¸ªéš”ç¦»çº§åˆ«æ˜¯å¯é‡å¤è¯»ï¼ˆRepeatable Readï¼‰ã€‚å¯é‡å¤è¯»çš„æ„æ€å°±æ˜¯å¯¹äº‹åŠ¡æ‰€æ¶‰åŠåˆ°çš„æ•°æ®åŠ è¯»é”å’Œå†™é”ï¼Œå¹¶ä¸”ä¸€ç›´æŒç»­åˆ°äº‹åŠ¡ç»“æŸï¼Œä½†ä¸å†åŠ èŒƒå›´é”ã€‚\nå¯é‡å¤è¯»æ¯”å¯ä¸²è¡ŒåŒ–å¼±åŒ–çš„åœ°æ–¹åœ¨äºå¹»è¯»é—®é¢˜ï¼ˆPhantom Readsï¼‰ï¼Œå®ƒæ˜¯æŒ‡åœ¨äº‹åŠ¡æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¸¤ä¸ªå®Œå…¨ç›¸åŒçš„èŒƒå›´æŸ¥è¯¢å¾—åˆ°äº†ä¸åŒçš„ç»“æœé›†ã€‚æ¯”å¦‚ç°åœ¨å‡†å¤‡ç»Ÿè®¡ä¸€ä¸‹ä¹¦åº—ä¸­å”®ä»·å°äº 100 å…ƒçš„ä¹¦æœ‰å¤šå°‘æœ¬ï¼Œå°±å¯ä»¥æ‰§è¡Œä»¥ä¸‹ç¬¬ä¸€æ¡ SQL è¯­å¥ï¼š\nSELECT count(1) FROM books WHERE price \u0026lt; 100 /* æ—¶é—´é¡ºåºï¼š1ï¼Œäº‹åŠ¡ï¼š T1 */ INSERT INTO books(name,price) VALUES (\u0026#39;æ·±å…¥ç†è§£Javaè™šæ‹Ÿæœº\u0026#39;,90) /* æ—¶é—´é¡ºåºï¼š2ï¼Œäº‹åŠ¡ï¼š T2 */ SELECT count(1) FROM books WHERE price \u0026lt; 100 /* æ—¶é—´é¡ºåºï¼š3ï¼Œäº‹åŠ¡ï¼š T1 */ å¯é‡å¤è¯»çº§åˆ«å¯¹äº‹åŠ¡æ¶‰åŠåˆ°çš„æ•°æ®åŠ è¯»é”å’Œå†™é”ï¼Œä½†ä¸å†åŠ èŒƒå›´é”ã€‚è¿™é‡Œäº‹åŠ¡T1ä¸­æ¶‰åŠçš„æ•°æ®æ˜¯åŸæ¥æ•°æ®åº“ä¸­å·²ç»å­˜åœ¨çš„æ•°æ®ï¼Œä½†æ–°æ’å…¥çš„æ¡ç›®æ˜¾ç„¶ä¸åœ¨è¿™ä¸ªèŒƒå›´å†…ã€‚å› æ­¤åœ¨äº‹åŠ¡T1å†æ¬¡æ‰§è¡Œè¯»çš„æ—¶å€™å°±ä¼šä¸ç¬¬ä¸€æ¬¡è¯»çš„ç»“æœä¸åŒã€‚åŸå› å°±æ˜¯ï¼Œå¯é‡å¤è¯»æ²¡æœ‰èŒƒå›´é”æ¥ç¦æ­¢åœ¨è¯¥èŒƒå›´å†…æ’å…¥æ–°çš„æ•°æ®ã€‚\nè¿™å°±æ˜¯ä¸€ä¸ªäº‹åŠ¡é­åˆ°å…¶ä»–äº‹åŠ¡å½±å“ï¼Œéš”ç¦»æ€§è¢«ç ´åçš„è¡¨ç°ã€‚\nè¿™é‡Œçš„ä»‹ç»å®é™…ä¸Šæ˜¯ä»¥ ARIES ç†è®ºä½œä¸ºè®¨è®ºç›®æ ‡çš„ï¼Œè€Œå…·ä½“çš„æ•°æ®åº“å¹¶ä¸ä¸€å®šè¦å®Œå…¨éµç…§ç€è¿™ä¸ªç†è®ºå»å®ç°ã€‚å› æ­¤åœ¨åŒæ ·çš„éš”ç¦»çº§åˆ«ä¸‹å¯èƒ½ä¼šå‡ºç°ä¸è¿™é‡Œä¸åŒçš„è¡Œä¸ºã€‚\nè¯»å·²æäº¤  ä¸€ä¸ªäº‹åŠ¡æäº¤åï¼Œå®ƒåšçš„å˜æ›´æ‰ä¼šè¢«å…¶ä»–äº‹åŠ¡çœ‹åˆ°\n å¯é‡å¤è¯»çš„ä¸‹ä¸€ä¸ªéš”ç¦»çº§åˆ«æ˜¯è¯»å·²æäº¤ï¼ˆRead Committedï¼‰ã€‚è¯»å·²æäº¤å¯¹äº‹åŠ¡æ¶‰åŠåˆ°çš„æ•°æ®åŠ çš„å†™é”ï¼Œä¼šä¸€ç›´æŒç»­åˆ°äº‹åŠ¡ç»“æŸï¼Œä½†åŠ çš„è¯»é”åœ¨æŸ¥è¯¢æ“ä½œå®Œæˆåå°±é©¬ä¸Šä¼šé‡Šæ”¾ã€‚\nè¯»å·²æäº¤æ¯”å¯é‡å¤è¯»å¼±åŒ–çš„åœ°æ–¹åœ¨äºä¸å¯é‡å¤è¯»é—®é¢˜ï¼ˆNon-Repeatable Readsï¼‰ï¼Œå®ƒæ˜¯æŒ‡åœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¯¹åŒä¸€è¡Œæ•°æ®çš„ä¸¤æ¬¡æŸ¥è¯¢å¾—åˆ°äº†ä¸åŒçš„ç»“æœã€‚\næ¯”å¦‚è¯´ï¼Œç°åœ¨æˆ‘è¦è·å–ä¹¦åº—ä¸­ã€Šæ·±å…¥ç†è§£ Java è™šæ‹Ÿæœºã€‹è¿™æœ¬ä¹¦çš„å”®ä»·ï¼ŒåŒæ ·è®©ç¨‹åºæ‰§è¡Œäº†ä¸¤æ¡ SQL è¯­å¥ã€‚è€Œåœ¨è¿™ä¸¤æ¡è¯­å¥æ‰§è¡Œä¹‹é—´ï¼Œæ°å¥½æœ‰å¦å¤–ä¸€ä¸ªäº‹åŠ¡ä¿®æ”¹äº†è¿™æœ¬ä¹¦çš„ä»·æ ¼ï¼Œä» 90 å…ƒè°ƒæ•´åˆ°äº† 110 å…ƒï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\nSELECT * FROM books WHERE id = 1; /* æ—¶é—´é¡ºåºï¼š1ï¼Œäº‹åŠ¡ï¼š T1 */ UPDATE books SET price = 110 WHERE ID = 1; COMMIT; /* æ—¶é—´é¡ºåºï¼š2ï¼Œäº‹åŠ¡ï¼š T2 */ SELECT * FROM books WHERE id = 1; COMMIT; /* æ—¶é—´é¡ºåºï¼š3ï¼Œäº‹åŠ¡ï¼š T1 */ åœ¨äº‹åŠ¡T1æ‰§è¡Œå®Œç¬¬ä¸€ä¸ªæŸ¥è¯¢è¯­å¥åï¼Œè¯»é”è¢«é‡Šæ”¾ï¼Œè¿™æ—¶äº‹åŠ¡T2æ‰§è¡Œäº†updateè¯­å¥ï¼Œæ›´æ–°äº†ä¹¦çš„ä»·æ ¼ï¼Œç„¶åäº‹åŠ¡T1å†æ¬¡å»æŸ¥è¯¢ï¼Œè¿™æ ·ä¸¤æ¬¡æŸ¥è¯¢å°±å¾—åˆ°äº†ä¸åŒçš„å€¼ã€‚è¯»å·²æäº¤çš„éš”ç¦»çº§åˆ«ç¼ºä¹è´¯ç©¿æ•´ä¸ªäº‹åŠ¡å‘¨æœŸçš„è¯»é”ï¼Œæ— æ³•ç¦æ­¢è¯»å–è¿‡çš„æ•°æ®å‘ç”Ÿå˜åŒ–ã€‚\nä¸è¿‡ï¼Œå‡å¦‚éš”ç¦»çº§åˆ«æ˜¯å¯é‡å¤è¯»çš„è¯ï¼Œç”±äºæ•°æ®å·²è¢«äº‹åŠ¡ T1 æ–½åŠ äº†è¯»é”ï¼Œå¹¶ä¸”è¯»å–åä¸ä¼šé©¬ä¸Šé‡Šæ”¾ï¼Œæ‰€ä»¥äº‹åŠ¡ T2 æ— æ³•è·å–åˆ°å†™é”ï¼Œæ›´æ–°å°±ä¼šè¢«é˜»å¡ï¼Œç›´è‡³äº‹åŠ¡ T1 è¢«æäº¤æˆ–å›æ»šåæ‰èƒ½æäº¤ã€‚\nè¯»æœªæäº¤  ä¸€ä¸ªäº‹åŠ¡è¿˜æ²¡æäº¤æ—¶ï¼Œå®ƒåšçš„å˜æ›´å°±èƒ½è¢«åˆ«çš„äº‹åŠ¡çœ‹åˆ°ã€‚\n è¯»å·²æäº¤çš„ä¸‹ä¸€ä¸ªçº§åˆ«æ˜¯è¯»æœªæäº¤ï¼ˆRead Uncommittedï¼‰ã€‚è¯»æœªæäº¤å¯¹äº‹åŠ¡æ¶‰åŠåˆ°çš„æ•°æ®åªåŠ å†™é”ï¼Œè¿™ä¼šä¸€ç›´æŒç»­åˆ°äº‹åŠ¡ç»“æŸï¼Œä½†å®Œå…¨ä¸åŠ è¯»é”ã€‚\nè¯»æœªæäº¤æ¯”è¯»å·²æäº¤å¼±åŒ–çš„åœ°æ–¹åœ¨äºè„è¯»é—®é¢˜ï¼ˆDirty Readsï¼‰ï¼Œå®ƒæ˜¯æŒ‡åœ¨äº‹åŠ¡æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¸€ä¸ªäº‹åŠ¡è¯»å–åˆ°äº†å¦ä¸€ä¸ªäº‹åŠ¡æœªæäº¤çš„æ•°æ®ã€‚\næ¯”å¦‚è¯´ï¼Œæˆ‘è§‰å¾—ã€Šæ·±å…¥ç†è§£ Java è™šæ‹Ÿæœºã€‹ä» 90 å…ƒæ¶¨ä»·åˆ° 110 å…ƒæ˜¯æŸå®³æ¶ˆè´¹è€…åˆ©ç›Šçš„è¡Œä¸ºï¼Œåˆæ‰§è¡Œäº†ä¸€æ¡æ›´æ–°è¯­å¥ï¼ŒæŠŠä»·æ ¼æ”¹å›äº† 90 å…ƒã€‚è€Œåœ¨æˆ‘æäº¤äº‹åŠ¡ä¹‹å‰ï¼ŒåŒäº‹è¿‡æ¥å‘Šè¯‰æˆ‘ï¼Œè¿™å¹¶ä¸æ˜¯éšä¾¿æ¶¨ä»·çš„ï¼Œè€Œæ˜¯å°åˆ·æˆæœ¬ä¸Šå‡å¯¼è‡´çš„ï¼ŒæŒ‰ 90 å…ƒå–è¦äºæœ¬ï¼Œäºæ˜¯æˆ‘éšå³å›æ»šäº†äº‹åŠ¡ã€‚é‚£ä¹ˆåœ¨è¿™ä¸ªåœºæ™¯ä¸‹ï¼Œç¨‹åºæ‰§è¡Œçš„ SQL è¯­å¥æ˜¯è¿™æ ·çš„ï¼š\nSELECT * FROM books WHERE id = 1; /* æ—¶é—´é¡ºåºï¼š1ï¼Œäº‹åŠ¡ï¼š T1 */ /* æ³¨æ„æ²¡æœ‰COMMIT */ UPDATE books SET price = 90 WHERE ID = 1; /* æ—¶é—´é¡ºåºï¼š2ï¼Œäº‹åŠ¡ï¼š T2 */ /* è¿™æ¡SELECTæ¨¡æ‹Ÿè´­ä¹¦çš„æ“ä½œçš„é€»è¾‘ */ SELECT * FROM books WHERE id = 1; /* æ—¶é—´é¡ºåºï¼š3ï¼Œäº‹åŠ¡ï¼š T1 */ ROLLBACK; /* æ—¶é—´é¡ºåºï¼š4ï¼Œäº‹åŠ¡ï¼š T2 */ ä¸è¿‡ï¼Œåœ¨æˆ‘ä¿®æ”¹å®Œä»·æ ¼ä¹‹åï¼Œäº‹åŠ¡ T1 å·²ç»æŒ‰ 90 å…ƒçš„ä»·æ ¼å–å‡ºäº†å‡ æœ¬ã€‚å‡ºç°è¿™ä¸ªé—®é¢˜çš„åŸå› å°±åœ¨äºï¼Œè¯»æœªæäº¤åœ¨æ•°æ®ä¸Šå®Œå…¨ä¸åŠ è¯»é”ï¼Œè¿™åè€Œä»¤å®ƒèƒ½è¯»åˆ°å…¶ä»–äº‹åŠ¡åŠ äº†å†™é”çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯æˆ‘å‰é¢æ‰€è¯´çš„ï¼Œäº‹åŠ¡ T1 ä¸­ä¸¤æ¡æŸ¥è¯¢è¯­å¥å¾—åˆ°çš„ç»“æœå¹¶ä¸ç›¸åŒã€‚\nè¿™é‡Œï¼Œä½ å¯èƒ½ä¼šæœ‰ç‚¹ç–‘é—®ï¼Œâ€œä¸ºä»€ä¹ˆå®Œå…¨ä¸åŠ è¯»é”ï¼Œåè€Œä»¤å®ƒèƒ½è¯»åˆ°å…¶ä»–äº‹åŠ¡åŠ äº†å†™é”çš„æ•°æ®â€ï¼Œè¿™å¥è¯ä¸­çš„â€œåè€Œâ€ä»£è¡¨çš„æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿä¸ç†è§£ä¹Ÿæ²¡å…³ç³»ï¼Œæˆ‘ä»¬å†æ¥é‡æ–°è¯»ä¸€éå†™é”çš„å®šä¹‰ï¼šå†™é”ç¦æ­¢å…¶ä»–äº‹åŠ¡æ–½åŠ è¯»é”ï¼Œè€Œä¸æ˜¯ç¦æ­¢äº‹åŠ¡è¯»å–æ•°æ®ã€‚\næ‰€ä»¥è¯´ï¼Œå¦‚æœäº‹åŠ¡ T1 è¯»å–æ•°æ®æ—¶ï¼Œæ ¹æœ¬å°±ä¸ç”¨å»åŠ è¯»é”çš„è¯ï¼Œå°±ä¼šå¯¼è‡´äº‹åŠ¡ T2 æœªæäº¤çš„æ•°æ®ä¹Ÿèƒ½é©¬ä¸Šå°±è¢«äº‹åŠ¡ T1 æ‰€è¯»åˆ°ã€‚è¿™åŒæ ·æ˜¯ä¸€ä¸ªäº‹åŠ¡é­åˆ°å…¶ä»–äº‹åŠ¡å½±å“ï¼Œéš”ç¦»æ€§è¢«ç ´åçš„è¡¨ç°ã€‚\né‚£ä¹ˆï¼Œè¿™é‡Œæˆ‘ä»¬å‡è®¾éš”ç¦»çº§åˆ«æ˜¯è¯»å·²æäº¤çš„è¯ï¼Œç”±äºäº‹åŠ¡ T2 æŒæœ‰æ•°æ®çš„å†™é”ï¼Œæ‰€ä»¥äº‹åŠ¡ T1 çš„ç¬¬äºŒæ¬¡æŸ¥è¯¢å°±æ— æ³•è·å¾—è¯»é”ã€‚è€Œè¯»å·²æäº¤çº§åˆ«æ˜¯è¦æ±‚å…ˆåŠ è¯»é”åè¯»æ•°æ®çš„ï¼Œæ‰€ä»¥ T1 ä¸­çš„æŸ¥è¯¢å°±ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°äº‹åŠ¡ T2 è¢«æäº¤æˆ–è€…å›æ»šåæ‰èƒ½å¾—åˆ°ç»“æœã€‚\næ€»ç»“  å¯ä¸²è¡ŒåŒ–ï¼š æ‰€æœ‰è¯»å†™æ•°æ®éƒ½åŠ ä¸Šè¯»é”ã€å†™é”ï¼ŒèŒƒå›´é”ã€‚ å¯é‡å¤è¯»ï¼š å¯¹äº‹åŠ¡æ¶‰åŠåˆ°çš„æ•°æ®åŠ è¯»é”å’Œå†™é”ï¼Œä½†ä¸åŠ èŒƒå›´é”ã€‚ï¼ˆå¹»è¯»é—®é¢˜ï¼‰ è¯»å·²æäº¤ï¼š å¯¹äº‹åŠ¡æ¶‰åŠåˆ°çš„æ•°æ®åŠ çš„å†™é”æŒç»­åˆ°äº‹åŠ¡ç»“æŸï¼Œä½†è¯»é”åœ¨æŸ¥è¯¢å®Œæˆåé©¬ä¸Šé‡Šæ”¾ã€‚ï¼ˆä¸å¯é‡å¤è¯»é—®é¢˜ï¼‰ è¯»æœªæäº¤ï¼š å¯¹äº‹åŠ¡æ¶‰åŠåˆ°çš„æ•°æ®åŠ å†™é”ï¼Œå®Œå…¨ä¸åŠ è¯»é”ã€‚ï¼ˆè„è¯»é—®é¢˜ï¼‰  References ã€Šå‘¨å¿—æ˜çš„è½¯ä»¶æ¶æ„è¯¾ã€‹\nMySQL45è®²\n","permalink":"http://yangchnet.github.io/Dessert/posts/%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%9C%AC%E5%9C%B0%E4%BA%8B%E5%8A%A1%E7%9A%84%E9%9A%94%E7%A6%BB/","summary":"æ‘˜æŠ„è‡ªï¼šæå®¢æ—¶é—´ã€Šå‘¨å¿—æ˜çš„è½¯ä»¶æ¶æ„è¯¾ã€‹\n 1. æ•°æ®åº“ä¸­çš„ä¸‰ç§é”   å†™é”ï¼ˆWrite Lockï¼Œä¹Ÿå«åšæ’ä»–é” eXclusive Lockï¼Œç®€å†™ä¸º X-Lockï¼‰ï¼šåªæœ‰æŒæœ‰å†™é”çš„äº‹åŠ¡æ‰èƒ½å¯¹æ•°æ®è¿›è¡Œå†™å…¥æ“ä½œï¼Œæ•°æ®åŠ æŒç€å†™é”æ—¶ï¼Œå…¶ä»–äº‹åŠ¡ä¸èƒ½å†™å…¥æ•°æ®ï¼Œä¹Ÿä¸èƒ½æ–½åŠ è¯»é”ã€‚\n  è¯»é”ï¼ˆRead Lockï¼Œä¹Ÿå«åšå…±äº«é” Shared Lockï¼Œç®€å†™ä¸º S-Lockï¼‰ï¼šå¤šä¸ªäº‹åŠ¡å¯ä»¥å¯¹åŒä¸€ä¸ªæ•°æ®æ·»åŠ å¤šä¸ªè¯»é”ï¼Œæ•°æ®è¢«åŠ ä¸Šè¯»é”åå°±ä¸èƒ½å†è¢«åŠ ä¸Šå†™é”ï¼Œæ‰€ä»¥å…¶ä»–äº‹åŠ¡ä¸èƒ½å¯¹è¯¥æ•°æ®è¿›è¡Œå†™å…¥ï¼Œä½†ä»ç„¶å¯ä»¥è¯»å–ã€‚å¯¹äºæŒæœ‰è¯»é”çš„äº‹åŠ¡ï¼Œå¦‚æœè¯¥æ•°æ®åªæœ‰ä¸€ä¸ªäº‹åŠ¡åŠ äº†è¯»é”ï¼Œé‚£å¯ä»¥ç›´æ¥å°†å…¶å‡çº§ä¸ºå†™é”ï¼Œç„¶åå†™å…¥æ•°æ®ã€‚\n  èŒƒå›´é”ï¼ˆRange Lockï¼‰ï¼šå¯¹äºæŸä¸ªèŒƒå›´ç›´æ¥åŠ æ’ä»–é”ï¼Œåœ¨è¿™ä¸ªèŒƒå›´å†…çš„æ•°æ®ä¸èƒ½è¢«è¯»å–ï¼Œä¹Ÿä¸èƒ½è¢«å†™å…¥ã€‚å¦‚ä¸‹è¯­å¥æ˜¯å…¸å‹çš„åŠ èŒƒå›´é”çš„ä¾‹å­ï¼š\n  SELECT * FROM books WHERE price \u0026lt; 100 FOR UPDATE; 2. æœ¬åœ°äº‹åŠ¡çš„å››ç§éš”ç¦»çº§åˆ«  ä»¥ä¸‹éš”ç¦»çº§åˆ«ä»é«˜åˆ°ä½\n å¯ä¸²è¡ŒåŒ–  é¡¾åæ€ä¹‰æ˜¯å¯¹äºåŒä¸€è¡Œè®°å½•ï¼Œâ€œå†™â€ä¼šåŠ â€œå†™é”â€ï¼Œâ€œè¯»â€ä¼šåŠ â€œè¯»é”â€ã€‚å½“å‡ºç°è¯»å†™é”å†²çªçš„æ—¶å€™ï¼Œåè®¿é—®çš„äº‹åŠ¡å¿…é¡»ç­‰å‰ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œå®Œæˆï¼Œæ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚\n ä¸²è¡ŒåŒ–è®¿é—®æä¾›äº†å¼ºåº¦æœ€é«˜çš„éš”ç¦»æ€§ã€‚å¯ä¸²è¡ŒåŒ–æ¯”è¾ƒç¬¦åˆæ™®é€šç¨‹åºå‘˜å¯¹æ•°æ®ç«äº‰åŠ é”çš„ç†è§£ï¼Œå¦‚æœä¸è€ƒè™‘æ€§èƒ½ä¼˜åŒ–çš„è¯ï¼Œå¯¹äº‹åŠ¡æ‰€æœ‰è¯»ã€å†™çš„æ•°æ®å…¨éƒ½åŠ ä¸Šè¯»é”ã€å†™é”å’ŒèŒƒå›´é”å³å¯ï¼ˆè¿™ç§å¯ä¸²è¡ŒåŒ–çš„å®ç°æ–¹æ¡ˆç§°ä¸º Two-Phase Lockï¼‰ã€‚\nä½†æ•°æ®åº“æ˜¾ç„¶ä¸å¯èƒ½ä¸è€ƒè™‘æ€§èƒ½ï¼Œå¹¶å‘æ§åˆ¶ç†è®ºï¼ˆConcurrency Controlï¼‰å†³å®šäº†éš”ç¦»ç¨‹åº¦ä¸å¹¶å‘èƒ½åŠ›æ˜¯ç›¸äº’æŠµè§¦çš„ï¼Œéš”ç¦»ç¨‹åº¦è¶Šé«˜ï¼Œå¹¶å‘è®¿é—®æ—¶çš„ååé‡å°±è¶Šä½ã€‚ç°ä»£æ•°æ®åº“ä¸€å®šä¼šæä¾›é™¤å¯ä¸²è¡ŒåŒ–ä»¥å¤–çš„å…¶ä»–éš”ç¦»çº§åˆ«ä¾›ç”¨æˆ·ä½¿ç”¨ï¼Œè®©ç”¨æˆ·è°ƒèŠ‚éš”ç¦»çº§åˆ«çš„é€‰é¡¹ï¼Œè¿™æ ·åšçš„æ ¹æœ¬ç›®çš„æ˜¯è®©ç”¨æˆ·å¯ä»¥è°ƒèŠ‚æ•°æ®åº“çš„åŠ é”æ–¹å¼ï¼Œå–å¾—éš”ç¦»æ€§ä¸ååé‡ä¹‹é—´çš„å¹³è¡¡ã€‚\nå¯é‡å¤è¯»  ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­çœ‹åˆ°çš„æ•°æ®ï¼Œæ€»æ˜¯è·Ÿè¿™ä¸ªäº‹åŠ¡åœ¨å¯åŠ¨æ—¶çœ‹åˆ°çš„æ•°æ®æ˜¯ä¸€è‡´çš„ã€‚å½“ç„¶åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œæœªæäº¤å˜æ›´å¯¹å…¶ä»–äº‹åŠ¡ä¹Ÿæ˜¯ä¸å¯è§çš„ã€‚\n å¯ä¸²è¡ŒåŒ–çš„ä¸‹ä¸€ä¸ªéš”ç¦»çº§åˆ«æ˜¯å¯é‡å¤è¯»ï¼ˆRepeatable Readï¼‰ã€‚å¯é‡å¤è¯»çš„æ„æ€å°±æ˜¯å¯¹äº‹åŠ¡æ‰€æ¶‰åŠåˆ°çš„æ•°æ®åŠ è¯»é”å’Œå†™é”ï¼Œå¹¶ä¸”ä¸€ç›´æŒç»­åˆ°äº‹åŠ¡ç»“æŸï¼Œä½†ä¸å†åŠ èŒƒå›´é”ã€‚\nå¯é‡å¤è¯»æ¯”å¯ä¸²è¡ŒåŒ–å¼±åŒ–çš„åœ°æ–¹åœ¨äºå¹»è¯»é—®é¢˜ï¼ˆPhantom Readsï¼‰ï¼Œå®ƒæ˜¯æŒ‡åœ¨äº‹åŠ¡æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¸¤ä¸ªå®Œå…¨ç›¸åŒçš„èŒƒå›´æŸ¥è¯¢å¾—åˆ°äº†ä¸åŒçš„ç»“æœé›†ã€‚æ¯”å¦‚ç°åœ¨å‡†å¤‡ç»Ÿè®¡ä¸€ä¸‹ä¹¦åº—ä¸­å”®ä»·å°äº 100 å…ƒçš„ä¹¦æœ‰å¤šå°‘æœ¬ï¼Œå°±å¯ä»¥æ‰§è¡Œä»¥ä¸‹ç¬¬ä¸€æ¡ SQL è¯­å¥ï¼š\nSELECT count(1) FROM books WHERE price \u0026lt; 100 /* æ—¶é—´é¡ºåºï¼š1ï¼Œäº‹åŠ¡ï¼š T1 */ INSERT INTO books(name,price) VALUES (\u0026#39;æ·±å…¥ç†è§£Javaè™šæ‹Ÿæœº\u0026#39;,90) /* æ—¶é—´é¡ºåºï¼š2ï¼Œäº‹åŠ¡ï¼š T2 */ SELECT count(1) FROM books WHERE price \u0026lt; 100 /* æ—¶é—´é¡ºåºï¼š3ï¼Œäº‹åŠ¡ï¼š T1 */ å¯é‡å¤è¯»çº§åˆ«å¯¹äº‹åŠ¡æ¶‰åŠåˆ°çš„æ•°æ®åŠ è¯»é”å’Œå†™é”ï¼Œä½†ä¸å†åŠ èŒƒå›´é”ã€‚è¿™é‡Œäº‹åŠ¡T1ä¸­æ¶‰åŠçš„æ•°æ®æ˜¯åŸæ¥æ•°æ®åº“ä¸­å·²ç»å­˜åœ¨çš„æ•°æ®ï¼Œä½†æ–°æ’å…¥çš„æ¡ç›®æ˜¾ç„¶ä¸åœ¨è¿™ä¸ªèŒƒå›´å†…ã€‚å› æ­¤åœ¨äº‹åŠ¡T1å†æ¬¡æ‰§è¡Œè¯»çš„æ—¶å€™å°±ä¼šä¸ç¬¬ä¸€æ¬¡è¯»çš„ç»“æœä¸åŒã€‚åŸå› å°±æ˜¯ï¼Œå¯é‡å¤è¯»æ²¡æœ‰èŒƒå›´é”æ¥ç¦æ­¢åœ¨è¯¥èŒƒå›´å†…æ’å…¥æ–°çš„æ•°æ®ã€‚","title":"æœ¬åœ°äº‹åŠ¡çš„éš”ç¦»"},{"content":" ç¿»è¯‘è‡ªï¼šTCMalloc : Thread-Caching Mallocï¼ˆæ€§èƒ½æµ‹è¯•éƒ¨åˆ†æ²¡æœ‰ç¿»è¯‘ï¼‰\n åŠ¨æœº åœ¨æˆ‘æµ‹è¯•è¿‡çš„æ‰€æœ‰malloc(åŠ¨æ€å†…å­˜åˆ†é…å™¨)ä¸­ï¼ŒTCMallocæ¯”glibc 2.3 malloc(ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„åº“ç§°ä½œptmalloc2)ä»¥åŠå…¶ä»–å†…å­˜åˆ†é…å™¨éƒ½è¦å¿«ã€‚å¯¹äºå°å†…å­˜å¯¹è±¡æ¥è¯´ï¼Œåœ¨IntelÂ® PentiumÂ® 4 Processor 2.80 GHzCPUä¸Šptmalloc2æ‰§è¡Œä¸€æ¬¡å†…å­˜åˆ†é…/å›æ”¶æ“ä½œéœ€è¦å¤§çº¦300nsï¼Œè€ŒTCMallocå®Œæˆç›¸åŒçš„æ“ä½œåªéœ€è¦50nsã€‚æ˜¾ç„¶å¯¹äºå†…å­˜åˆ†é…æ“ä½œæ¥è¯´ï¼Œé€Ÿåº¦ååˆ†é‡è¦ï¼Œå› ä¸ºå¦‚æœå†…å­˜åˆ†é…ä¸å¤ŸåŠæ—¶ï¼Œå¼€å‘äººå‘˜å°±å€¾å‘äºåœ¨mallocä¸Šç¼–å†™ä»–ä»¬è‡ªå·±çš„ç©ºé—²åˆ—è¡¨ï¼Œè¿™ä¼šé€ æˆé¢å¤–çš„å¤æ‚æ€§ä»¥åŠæ›´å¤šçš„å†…å­˜å ç”¨ï¼Œé™¤éå¼€å‘äººå‘˜éå¸¸å°å¿ƒçš„ä¼°ç®—ç©ºé—²åˆ—è¡¨çš„å¤§å°å¹¶æ¸…ç†å…¶ä¸­çš„ç©ºé—²å¯¹è±¡ã€‚\nTCMallocä¹Ÿé™ä½äº†å¤šçº¿ç¨‹åº”ç”¨ä¸­çš„é”å†²çªã€‚å¯¹äºå°å†…å­˜å¯¹è±¡æ¥è¯´å‡ ä¹ä¸å­˜åœ¨å†²çªã€‚å¯¹äºå¤§å†…å­˜å¯¹è±¡æ¥è¯´ï¼ŒTCMallocå°è¯•ä½¿ç”¨ç»†ç²’åº¦å’Œé«˜æ•ˆçš„è‡ªæ—‹é”ã€‚ptmalloc2ä¹Ÿå°è¯•é€šè¿‡ä¸€äº›æ–¹æ³•é™ä½é”å†²çªï¼Œå…¶ä¸ºæ¯ä¸ªçº¿ç¨‹åˆ†é…ä¸€ä¸ªarenaç©ºé—´ï¼Œä½†ptmalloc2å¯¹äºarenaç©ºé—´çš„ä½¿ç”¨å­˜åœ¨ä¸€ä¸ªå¤§é—®é¢˜ï¼šåœ¨ptmalloc2ä¸­å†…å­˜å°†ä¸å¯èƒ½ä»ä¸€ä¸ªarenaç©ºé—´è½¬ç§»åˆ°å¦ä¸€ä¸ªarenaç©ºé—´ï¼Œä¹Ÿå³å†…å­˜ä¸å¯ä»¥åœ¨çº¿ç¨‹ä¹‹é—´è¿›è¡ŒäºŒæ¬¡åˆ†é…ã€‚è¿™ä¼šå¯¼è‡´å·¨å¤§çš„å†…å­˜æµªè´¹ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªGoogleåº”ç”¨ä¸­ï¼Œé˜¶æ®µä¸€ä¸ºå…¶æ•°æ®ç»“æ„åˆ†é…äº†å¤§çº¦300MBã€‚å½“å…¶ç¬¬ä¸€é˜¶æ®µç»“æŸåï¼Œé˜¶æ®µäºŒå°†åœ¨ç›¸åŒçš„åœ°å€ç©ºé—´ä¸Šå¼€å§‹ã€‚å¦‚æœé˜¶æ®µäºŒåˆ†é…äº†ä¸€ä¸ªä¸é˜¶æ®µä¸€ä¸åŒçš„arenaç©ºé—´ï¼Œé‚£ä¹ˆé˜¶æ®µäºŒçš„è®¡ç®—å°†ä¸ä¼šé‡å¤ä½¿ç”¨é˜¶æ®µä¸€ç•™ä¸‹çš„ä»»ä½•å†…å­˜ç©ºé—´ï¼Œè€Œæ˜¯é‡æ–°åˆ†é…å¦ä¸€ä¸ª300MBå†…å­˜ç©ºé—´ã€‚è¿™ç§å†…å­˜çš„â€œblowupâ€é—®é¢˜åŒæ ·å‡ºç°åœ¨å…¶ä»–åº”ç”¨ä¸­ã€‚\nTCMollocçš„å¦ä¸€ä¸ªä¼˜ç‚¹æ˜¯é’ˆå¯¹å°å†…å­˜å¯¹è±¡çš„ç©ºé—´çš„æœ‰æ•ˆåˆ©ç”¨ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥å°†8N byteså¤§å°çš„å¯¹è±¡åˆ†é…åˆ°8N*1.01bytesçš„ç©ºé—´ä¸Šï¼Œå³åªéœ€è¦1%çš„ç©ºé—´å¼€é”€ã€‚ptmalloc2å¯¹æ¯ä¸€ä¸ªå¯¹è±¡åˆ†é…ä¸€ä¸ª4bytesçš„å¤´ï¼Œï¼ˆæˆ‘è®¤ä¸ºï¼‰è¿™ç§æ–¹å¼å°†æœ¬æ¥åªéœ€è¦8N byteså¤§å°å¯¹è±¡å˜æˆäº†éœ€è¦16N bytes\nç”¨æ³• è¦æƒ³ä½¿ç”¨TCMallocï¼Œåªè¦ä½¿ç”¨-l tcmallocæ ‡å¿—å°†tcmallocé“¾æ¥åˆ°ä½ çš„åº”ç”¨ã€‚\nä½ ä¹Ÿå¯ä»¥åœ¨ä¸æ˜¯ä½ ç¼–è¯‘çš„åº”ç”¨ä¸­ä½¿ç”¨tcmallocï¼Œé€šè¿‡ä½¿ç”¨LD_PRELOADç¯å¢ƒå˜é‡\nLD_PRELOAD=\u0026#34;/usr/lib/libtcmalloc.so\u0026#34; ä½†æˆ‘ä»¬ä¸æ¨èåœ¨éå¿…è¦çš„æƒ…å†µä¸‹ä½¿ç”¨è¿™ç§æ–¹å¼ã€‚\nTCMallocä¹ŸåŒ…æ‹¬ä¸€ä¸ªå †æ£€æŸ¥å™¨å’Œä¸€ä¸ªå †åˆ†æå™¨ã€‚\nå¦‚æœä½ åªæƒ³è¦é“¾æ¥ä¸€ä¸ªæ²¡æœ‰å †æ£€æŸ¥å™¨å’Œåˆ†æå™¨çš„TCMallocç‰ˆæœ¬ï¼ˆå¯èƒ½æƒ³è¦å‡å°äºŒè¿›åˆ¶åŒ…çš„å¤§å°ï¼‰ï¼Œä½ å¯ä»¥é“¾æ¥libtcmalloc_minimal\næ¦‚è§ˆ TCMallocä¸ºæ¯ä¸ªçº¿ç¨‹åˆ†é…ä¸€ä¸ªæœ¬åœ°çº¿ç¨‹ç¼“å­˜thread-local cacheã€‚å°çš„å†…å­˜åˆ†é…å°†ç›´æ¥è¢«æœ¬åœ°çº¿ç¨‹ç¼“å­˜æ»¡è¶³ã€‚å¯¹è±¡æŒ‰éœ€ä»ä¸­é—´éƒ¨ä»¶central data structureç§»åŠ¨åˆ°æœ¬åœ°çº¿ç¨‹ç¼“å­˜ã€‚å®šæœŸçš„åƒåœ¾æ”¶é›†è¢«ç”¨æ¥æŠŠå†…å­˜ä»æœ¬åœ°çº¿ç¨‹ç¼“å­˜æ”¾å›ä¸­é—´éƒ¨ä»¶central data structureã€‚\nTCMallocå¯¹äºå¤§å°\u0026lt;=32Kçš„ï¼ˆå°ï¼‰å¯¹è±¡çš„å¤„ç†æ–¹å¼ä¸å¤§å¯¹è±¡ä¸åŒã€‚å¤§å¯¹è±¡ç”±é¡¶å±‚å †ç®¡ç†å™¨central heapä½¿ç”¨é¡µçº§çš„åˆ†é…å™¨ç›´æ¥åˆ†é…ã€‚ï¼ˆä¸€ä¸ªé¡µé¢æ˜¯ä¸€ä¸ª4Kå¯¹é½çš„å†…å­˜åŒºåŸŸï¼‰ï¼ŒåŒæ—¶ï¼Œå¤§å¯¹è±¡æ€»æ˜¯é¡µå¯¹é½å¹¶ä¸”å æ®æ•´æ•°ä¸ªé¡µé¢ã€‚\né¡µé¢å¯è¢«ä¸€ç³»åˆ—çš„å°å¯¹è±¡ç“œåˆ†ä¸ºå¤§å°ç›¸åŒçš„åŒºåŸŸã€‚ä¾‹å¦‚ï¼šä¸€ä¸ª4Kçš„å†…å­˜å°†è¢«32ä¸ªå¯¹è±¡åˆ†å‰²ä¸ºæ¯ä¸ª128bytesçš„å†…å­˜åºåˆ—ã€‚\nå°å¯¹è±¡çš„åˆ†é… æ¯ä¸ªå°å¯¹è±¡éƒ½å¯¹åº”äº170ä¸ªå¯åˆ†é…å†…å­˜å¤§å°size-classesä¸­çš„ä¸€ç§ï¼Œä¾‹å¦‚ï¼Œå¤§å°èŒƒå›´åœ¨961-1024bytesçš„å¯¹è±¡å°†å æ®1024bytesã€‚è¿™äº›å†…å­˜å¤§å°çº§åˆ«è¢«ä¸åŒå¤§å°çš„é—´è·åˆ†éš”å¼€ï¼Œå…¶ä¸­è¾ƒå°å°ºå¯¸ä¸º8bytesï¼Œå¤§å°ºå¯¸ä¸º16bytesï¼Œæ›´å¤§çš„æ˜¯32bytesï¼Œä»¥æ­¤ç±»æ¨ã€‚æœ€å¤§çš„ç©ºé—´æ˜¯256bytesï¼ˆå¯¹äºsize-classesï¼‰å¤§äºç­‰äº2kã€‚\næœ¬åœ°çº¿ç¨‹ç¼“å­˜thread-local cacheæŒæœ‰ä¸åŒsize-classçš„ç©ºé—²é“¾è¡¨ã€‚\nå½“åˆ†é…ä¸€ä¸ªå°å¯¹è±¡æ—¶ï¼š\n å°†å…¶å¤§å°æ˜ å°„åˆ°ç›¸åº”çš„size-class ä¸ºå½“å‰çº¿ç¨‹åœ¨å…¶thread-local cacheçš„ï¼ˆå†…å­˜ï¼‰ç©ºé—²é“¾è¡¨ä¸­å¯»æ‰¾å¯¹åº”size-classé“¾è¡¨ å¦‚æœç©ºé—²é“¾è¡¨éç©ºï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†é“¾è¡¨çš„ç¬¬ä¸€ä¸ªå¯¹è±¡ç§»å‡ºå¹¶è¿”å›ä¹‹ï¼Œå½“æ‰§è¡Œè¿™ç§å¿«é€Ÿè·¯å¾„æ—¶ï¼ŒTCMallocä¸éœ€è¦ä»»ä½•é”ï¼Œå› ä¸ºåŠ é”è§£é”è¿™ä¸€å¯¹æ“ä½œåœ¨2.8GHzçš„æœºå™¨ä¸Šå¤§çº¦éœ€è¦100nsï¼Œè¿™ä½¿å¾—å†…å­˜åˆ†é…é€Ÿåº¦æ˜æ˜¾åŠ å¿«ã€‚  å¦‚æœç©ºé—²é“¾è¡¨ä¸ºç©ºï¼š\n ä»central free list(central data structure)è·å–ä¸€ç³»åˆ—å¯¹åº”å¤§å°çš„å†…å­˜ã€‚ï¼ˆcentral data structureè¢«æ‰€æœ‰çº¿ç¨‹å…±äº«ï¼‰ å°†è·å–åˆ°çš„å†…å­˜æ”¾å…¥thread-local cacheçš„ç©ºé—²é“¾è¡¨ã€‚ è¿”å›å…¶ä¸­ä¸€ä¸ªæ–°è·å–çš„å†…å­˜å¯¹è±¡ç»™åº”ç”¨  å¦‚æœcentral free listä¹Ÿä¸ºç©ºï¼š\n ä»central page allocator(central heap)åˆ†é…ä¸€ç³»åˆ—é¡µé¢ å°†è¿™äº›é¡µé¢åˆ†å‰²ä¸ºå¯¹åº”size-classå¤§å°çš„å†…å­˜å¯¹è±¡ å°†è¿™äº›æ–°çš„å†…å­˜å¯¹è±¡æ”¾å…¥central free list åƒä¹‹å‰æ‰€è¯´å°†å†…å­˜å¯¹è±¡æ”¾å…¥thread-local free list  å¤§å†…å­˜çš„åˆ†é… å¤§å¯¹è±¡è¢«å¯¹é½åˆ°é¡µå¤§å°ï¼ˆ4Kï¼‰,å¹¶ä¸”è¢«central page heapç®¡ç†ã€‚central page heapåŒæ ·æ˜¯ä¸€ä¸ªç©ºé—²åˆ—è¡¨æ•°ç»„ã€‚å½“æ•°ç»„ä¸‹æ ‡iå°äº256æ—¶ï¼Œç¬¬kä¸ªæ•°ç»„å…ƒç´ æ˜¯ä¸€ä¸ªæ¯ä¸ªèŠ‚ç‚¹åŒ…å«kä¸ªé¡µçš„ç©ºé—²åˆ—è¡¨ï¼Œè€Œç¬¬256ä¸ªæ•°ç»„å…ƒç´ ä¸­ï¼Œé“¾è¡¨çš„èŠ‚ç‚¹é•¿åº¦å¤§äº256é¡µ\nä¸€æ¬¡åˆ†é…kä¸ªé¡µé¢çš„éœ€æ±‚å°†è¢«ç¬¬kä¸ªç©ºé—²åˆ—è¡¨æ»¡è¶³ã€‚å¦‚æœè¿™ä¸ªç©ºé—²åˆ—è¡¨ä¸ºç©ºï¼Œé‚£ä¹ˆå°†åœ¨ä¸‹ä¸€ä¸ªç©ºé—²åˆ—è¡¨ä¸­å¯»æ‰¾ï¼Œä»¥æ­¤ç±»æ¨ã€‚å¦‚æœæœ‰éœ€è¦çš„è¯ï¼Œæˆ‘ä»¬å°†åœ¨æœ€åä¸€ä¸ªç©ºé—²åˆ—è¡¨ä¸­è·å¾—å†…å­˜å¯¹è±¡ã€‚å¦‚æœè¿™ä»ç„¶å¤±è´¥ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç›´æ¥ä»æ“ä½œç³»ç»Ÿä¸­è·å–å†…å­˜ã€‚\nå¦‚æœä¸€æ¬¡è¦æ±‚kä¸ªé¡µçš„è¯·æ±‚è¢«é•¿åº¦å¤§äºkçš„ç©ºé—²é“¾è¡¨æ»¡è¶³ï¼Œé‚£ä¹ˆå‰©ä¸‹çš„å†…å­˜å°†è¢«æ’å…¥åˆ°central page heapåˆé€‚çš„ç©ºé—²é“¾è¡¨ä¸­.\nè·¨åº¦ï¼ˆspanï¼‰ TCMallocç®¡ç†çš„å †ä¸­æœ‰ä¸€ç³»åˆ—çš„é¡µã€‚ä¸€ç³»åˆ—è¿ç»­çš„é¡µç”±spanå¯¹è±¡è¡¨ç¤ºã€‚spanå¯ä»¥è¢«åˆ†é…æˆ–é‡Šæ”¾ã€‚å¦‚æœè¢«é‡Šæ”¾ï¼Œé‚£ä¹ˆspanæ˜¯é¡µå †é“¾è¡¨ä¸­çš„ä¸€é¡¹ã€‚å¦‚æœè¢«åˆ†é…ï¼Œé‚£ä¹ˆä»–æ˜¯è¢«åº”ç”¨æ‰€æŒæœ‰çš„ä¸€ä¸ªå¤§å†…å­˜å¯¹è±¡ï¼Œæˆ–æ˜¯å·²è¢«åˆ†å‰²ä¸ºä¸€ä¸ªä¸ªå°å†…å­˜å¯¹è±¡ã€‚å¦‚æœå…¶è¢«åˆ†å‰²ä¸ºå°å†…å­˜å¯¹è±¡ï¼Œé‚£ä¹ˆå®ƒçš„size-classå°†è¢«è®°å½•ä¸‹æ¥ã€‚\nå¯ä»¥ç”¨ä»¥é¡µå·ä½œä¸ºä¸‹æ ‡çš„central arrayæ¥è¡¨æ˜é¡µå±äºå“ªä¸ªspanã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸‹å›¾ä¸­ï¼Œspana å æ®äº†ä¸¤ä¸ªé¡µï¼Œsapnbå æ®äº†1ä¸ªé¡µ, sapncå æ®äº†5ä¸ªé¡µ,sapndå æ®äº†3ä¸ªé¡µã€‚\nä¸€ä¸ª32ä½åœ°å€ç©ºé—´å¯è¢«åˆ†ä¸º2çš„20æ¬¡æ–¹ä¸ª4Kå¤§å°çš„é¡µï¼Œæ‰€ä»¥ä¸€ä¸ªcentral arrayæŒæœ‰4MBç©ºé—²çœ‹èµ·æ¥æ˜¯åˆç†çš„ã€‚åœ¨64ä½æœºå™¨ä¸Šï¼Œæˆ‘ä»¬ä½¿ç”¨3çº§åŸºæ•°æ ‘è€Œä¸æ˜¯æ•°ç»„æ¥å°†é¡µå·æ˜ å°„åˆ°ç›¸åº”çš„spanæŒ‡é’ˆã€‚\nè§£é™¤åˆ†é… å½“ä¸€ä¸ªå¯¹è±¡è¢«è§£é™¤åˆ†é…ï¼Œæˆ‘ä»¬è®¡ç®—å®ƒçš„é¡µå·å¹¶ä¸”åœ¨central arrayå¯»æ‰¾å…¶å¯¹åº”çš„spanå¯¹è±¡ã€‚è¿™ä¸ªspanå¯¹è±¡å‘Šè¯‰æˆ‘ä»¬è¿™ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯å°å¯¹è±¡ä»¥åŠå®ƒçš„size-class(å¦‚æœæ˜¯å°å¯¹è±¡çš„è¯)ã€‚å¦‚æœå¯¹è±¡æ˜¯å°å¯¹è±¡ï¼Œæˆ‘ä»¬å°†å…¶æ’å…¥åˆ°å½“å‰çº¿ç¨‹çš„thread-local cacheä¸­çš„ç©ºé—²é“¾è¡¨ä¸­ã€‚å¦‚æœå½“å‰thread-local cacheè¶…å‡ºäº†é¢„è®¾çš„å¤§å°ï¼ˆä¸€èˆ¬ä¸º2MBï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¿›è¡Œä¸€ä¸ªåƒåœ¾å›æ”¶ä»¥å°†å…¶ä»thread-local cacheç§»åˆ°central free listã€‚\nå¦‚æœè¿™ä¸ªå¯¹è±¡æ˜¯å¤§å¯¹è±¡ï¼Œé‚£ä¹ˆsapnå‘Šè¯‰æˆ‘ä»¬è¿™ä¸ªå¯¹è±¡åŒ…å«çš„é¡µå·ã€‚å‡è®¾å…¶åŒ…å«çš„é¡µå·ä¸º[p, q]ã€‚æˆ‘ä»¬åŒæ ·ä¼šæŸ¥çœ‹ç›¸é‚»çš„[p-1][q+1]å·é¡µï¼Œå¦‚æœè¿™äº›ç›¸é‚»çš„é¡µä¸ºç©ºé—²çŠ¶æ€ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†è¿™äº›ç©ºé—²é¡µä¸[p, q]é¡µåˆå¹¶ã€‚æœ€åå¾—åˆ°çš„spanå°†è¢«æ’å…¥åˆ°page heapä¸­åˆé€‚çš„ç©ºé—²åˆ—è¡¨ä¸­ã€‚\né¢å‘å°å¯¹è±¡çš„central free list æ­£å¦‚ä¹‹å‰æ‰€è¯´ï¼Œæˆ‘ä»¬ä¸ºæ¯ä¸ªsize-classç»´æŠ¤äº†ä¸€ä¸ªcentral free listã€‚æ¯ä¸ªcentral free listè¢«ç»„ç»‡ä¸ºä¸¤å±‚æ•°æ®ç»“æ„ï¼šä¸€ç³»åˆ—spanå¯¹è±¡ï¼Œä»¥åŠspanä¸­çš„ç©ºé—²å¯¹è±¡åˆ—è¡¨ã€‚\nè¢«åˆ†é…çš„å¯¹è±¡æ¥è‡ªæŸäº›spançš„ç©ºé—²é“¾è¡¨çš„å¤´éƒ¨ã€‚ï¼ˆå¦‚æœæ‰€æœ‰çš„spanéƒ½æŒæœ‰ç©ºçš„ç©ºé—²é“¾è¡¨ï¼Œé‚£ä¹ˆå°†ä»central page heapåˆ†é…åˆé€‚å¤§å°çš„spanï¼‰\nåœ¨å¯¹è±¡è¢«è¿”å›æ—¶ï¼Œå…¶å°†è¢«æ·»åŠ åˆ°spanæŒæœ‰çš„é“¾è¡¨ä¸­ã€‚å¦‚æœé“¾è¡¨çš„é•¿åº¦ç­‰äºspanä¸­çš„å°å¯¹è±¡æ•°ç›®ï¼Œé‚£ä¹ˆè¯´æ˜è¿™ä¸ªspanç°åœ¨å·²ç»è¢«å®Œå…¨é‡Šæ”¾ï¼Œå…¶åº”è¯¥è¢«è¿”è¿˜åˆ°page heap.\nthread-local cacheçš„åƒåœ¾æ”¶é›† å½“thread-local cacheçš„æ€»å¤§å°è¶…è¿‡2MBæ—¶ï¼Œå°±ä¼šè§¦å‘å¯¹å…¶çš„åƒåœ¾æ”¶é›†ã€‚å½“çº¿ç¨‹å¢åŠ æ•°æ—¶ï¼Œè¿™ä¸ªåƒåœ¾æ”¶é›†é—¨æ§›å°†è‡ªåŠ¨å‡å°‘ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸ä¼šåœ¨å…·æœ‰å¤§é‡çº¿ç¨‹çš„ç¨‹åºä¸­æµªè´¹è¿‡å¤šçš„å†…å­˜ã€‚\næˆ‘ä»¬å°†éå†æ‰€æœ‰cacheä¸­çš„ç©ºé—²åˆ—è¡¨å¹¶ä¸”å°†ä¸€äº›å¯¹è±¡ä»ç©ºé—²åˆ—è¡¨ä¸­ç§»åŠ¨åˆ°ç›¸åº”çš„central listã€‚\nè¢«ç§»åŠ¨å¯¹è±¡çš„æ•°ç›®æ˜¯ä½¿ç”¨æ¯ä¸ªåˆ—è¡¨ä¸Šä½ä½æ ‡è®°Lç¡®å®šçš„ï¼ŒLè®°å½•è‡ªä¸Šæ¬¡åƒåœ¾å›æ”¶ä»¥æ¥åˆ—è¡¨çš„æœ€å°é•¿åº¦ã€‚æ³¨æ„ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æœ€åä¸€æ¬¡åƒåœ¾å›æ”¶æ—¶å°†åˆ—è¡¨ç¼©çŸ­Lä¸ªå¯¹è±¡è€Œæ— éœ€å¯¹central listè¿›è¡Œä»»ä½•é¢å¤–è®¿é—®ã€‚æˆ‘ä»¬å°†è¿™éƒ¨åˆ†å†å²è®°å½•ä½œä¸ºå¯¹æœªæ¥è®¿é—®çš„ä¸€ä¸ªé¢„æµ‹ï¼Œå°†L/2ä¸ªå¯¹è±¡ä»thread-local cacheç§»åŠ¨åˆ°å¯¹åº”çš„central free listã€‚è¿™ä¸ªç®—æ³•æœ‰ä¸€ä¸ªå¾ˆå¥½çš„ç‰¹æ€§ï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹åœæ­¢ä½¿ç”¨ç‰¹å®šå¤§å°çš„å†…å­˜ï¼Œé‚£ä¹ˆæ‰€æœ‰è¯¥å¤§å°çš„å¯¹è±¡å°†è¢«å¿«é€Ÿçš„ä»thread-local cacheç§»åŠ¨åˆ°central free listï¼Œä»è€Œè¿™äº›å¯¹è±¡å¯ä»¥è¢«å…¶ä»–çº¿ç¨‹ä½¿ç”¨ã€‚\n","permalink":"http://yangchnet.github.io/Dessert/posts/linux/tcmalloc/","summary":"ç¿»è¯‘è‡ªï¼šTCMalloc : Thread-Caching Mallocï¼ˆæ€§èƒ½æµ‹è¯•éƒ¨åˆ†æ²¡æœ‰ç¿»è¯‘ï¼‰\n åŠ¨æœº åœ¨æˆ‘æµ‹è¯•è¿‡çš„æ‰€æœ‰malloc(åŠ¨æ€å†…å­˜åˆ†é…å™¨)ä¸­ï¼ŒTCMallocæ¯”glibc 2.3 malloc(ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„åº“ç§°ä½œptmalloc2)ä»¥åŠå…¶ä»–å†…å­˜åˆ†é…å™¨éƒ½è¦å¿«ã€‚å¯¹äºå°å†…å­˜å¯¹è±¡æ¥è¯´ï¼Œåœ¨IntelÂ® PentiumÂ® 4 Processor 2.80 GHzCPUä¸Šptmalloc2æ‰§è¡Œä¸€æ¬¡å†…å­˜åˆ†é…/å›æ”¶æ“ä½œéœ€è¦å¤§çº¦300nsï¼Œè€ŒTCMallocå®Œæˆç›¸åŒçš„æ“ä½œåªéœ€è¦50nsã€‚æ˜¾ç„¶å¯¹äºå†…å­˜åˆ†é…æ“ä½œæ¥è¯´ï¼Œé€Ÿåº¦ååˆ†é‡è¦ï¼Œå› ä¸ºå¦‚æœå†…å­˜åˆ†é…ä¸å¤ŸåŠæ—¶ï¼Œå¼€å‘äººå‘˜å°±å€¾å‘äºåœ¨mallocä¸Šç¼–å†™ä»–ä»¬è‡ªå·±çš„ç©ºé—²åˆ—è¡¨ï¼Œè¿™ä¼šé€ æˆé¢å¤–çš„å¤æ‚æ€§ä»¥åŠæ›´å¤šçš„å†…å­˜å ç”¨ï¼Œé™¤éå¼€å‘äººå‘˜éå¸¸å°å¿ƒçš„ä¼°ç®—ç©ºé—²åˆ—è¡¨çš„å¤§å°å¹¶æ¸…ç†å…¶ä¸­çš„ç©ºé—²å¯¹è±¡ã€‚\nTCMallocä¹Ÿé™ä½äº†å¤šçº¿ç¨‹åº”ç”¨ä¸­çš„é”å†²çªã€‚å¯¹äºå°å†…å­˜å¯¹è±¡æ¥è¯´å‡ ä¹ä¸å­˜åœ¨å†²çªã€‚å¯¹äºå¤§å†…å­˜å¯¹è±¡æ¥è¯´ï¼ŒTCMallocå°è¯•ä½¿ç”¨ç»†ç²’åº¦å’Œé«˜æ•ˆçš„è‡ªæ—‹é”ã€‚ptmalloc2ä¹Ÿå°è¯•é€šè¿‡ä¸€äº›æ–¹æ³•é™ä½é”å†²çªï¼Œå…¶ä¸ºæ¯ä¸ªçº¿ç¨‹åˆ†é…ä¸€ä¸ªarenaç©ºé—´ï¼Œä½†ptmalloc2å¯¹äºarenaç©ºé—´çš„ä½¿ç”¨å­˜åœ¨ä¸€ä¸ªå¤§é—®é¢˜ï¼šåœ¨ptmalloc2ä¸­å†…å­˜å°†ä¸å¯èƒ½ä»ä¸€ä¸ªarenaç©ºé—´è½¬ç§»åˆ°å¦ä¸€ä¸ªarenaç©ºé—´ï¼Œä¹Ÿå³å†…å­˜ä¸å¯ä»¥åœ¨çº¿ç¨‹ä¹‹é—´è¿›è¡ŒäºŒæ¬¡åˆ†é…ã€‚è¿™ä¼šå¯¼è‡´å·¨å¤§çš„å†…å­˜æµªè´¹ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªGoogleåº”ç”¨ä¸­ï¼Œé˜¶æ®µä¸€ä¸ºå…¶æ•°æ®ç»“æ„åˆ†é…äº†å¤§çº¦300MBã€‚å½“å…¶ç¬¬ä¸€é˜¶æ®µç»“æŸåï¼Œé˜¶æ®µäºŒå°†åœ¨ç›¸åŒçš„åœ°å€ç©ºé—´ä¸Šå¼€å§‹ã€‚å¦‚æœé˜¶æ®µäºŒåˆ†é…äº†ä¸€ä¸ªä¸é˜¶æ®µä¸€ä¸åŒçš„arenaç©ºé—´ï¼Œé‚£ä¹ˆé˜¶æ®µäºŒçš„è®¡ç®—å°†ä¸ä¼šé‡å¤ä½¿ç”¨é˜¶æ®µä¸€ç•™ä¸‹çš„ä»»ä½•å†…å­˜ç©ºé—´ï¼Œè€Œæ˜¯é‡æ–°åˆ†é…å¦ä¸€ä¸ª300MBå†…å­˜ç©ºé—´ã€‚è¿™ç§å†…å­˜çš„â€œblowupâ€é—®é¢˜åŒæ ·å‡ºç°åœ¨å…¶ä»–åº”ç”¨ä¸­ã€‚\nTCMollocçš„å¦ä¸€ä¸ªä¼˜ç‚¹æ˜¯é’ˆå¯¹å°å†…å­˜å¯¹è±¡çš„ç©ºé—´çš„æœ‰æ•ˆåˆ©ç”¨ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥å°†8N byteså¤§å°çš„å¯¹è±¡åˆ†é…åˆ°8N*1.01bytesçš„ç©ºé—´ä¸Šï¼Œå³åªéœ€è¦1%çš„ç©ºé—´å¼€é”€ã€‚ptmalloc2å¯¹æ¯ä¸€ä¸ªå¯¹è±¡åˆ†é…ä¸€ä¸ª4bytesçš„å¤´ï¼Œï¼ˆæˆ‘è®¤ä¸ºï¼‰è¿™ç§æ–¹å¼å°†æœ¬æ¥åªéœ€è¦8N byteså¤§å°å¯¹è±¡å˜æˆäº†éœ€è¦16N bytes\nç”¨æ³• è¦æƒ³ä½¿ç”¨TCMallocï¼Œåªè¦ä½¿ç”¨-l tcmallocæ ‡å¿—å°†tcmallocé“¾æ¥åˆ°ä½ çš„åº”ç”¨ã€‚\nä½ ä¹Ÿå¯ä»¥åœ¨ä¸æ˜¯ä½ ç¼–è¯‘çš„åº”ç”¨ä¸­ä½¿ç”¨tcmallocï¼Œé€šè¿‡ä½¿ç”¨LD_PRELOADç¯å¢ƒå˜é‡\nLD_PRELOAD=\u0026#34;/usr/lib/libtcmalloc.so\u0026#34; ä½†æˆ‘ä»¬ä¸æ¨èåœ¨éå¿…è¦çš„æƒ…å†µä¸‹ä½¿ç”¨è¿™ç§æ–¹å¼ã€‚\nTCMallocä¹ŸåŒ…æ‹¬ä¸€ä¸ªå †æ£€æŸ¥å™¨å’Œä¸€ä¸ªå †åˆ†æå™¨ã€‚\nå¦‚æœä½ åªæƒ³è¦é“¾æ¥ä¸€ä¸ªæ²¡æœ‰å †æ£€æŸ¥å™¨å’Œåˆ†æå™¨çš„TCMallocç‰ˆæœ¬ï¼ˆå¯èƒ½æƒ³è¦å‡å°äºŒè¿›åˆ¶åŒ…çš„å¤§å°ï¼‰ï¼Œä½ å¯ä»¥é“¾æ¥libtcmalloc_minimal\næ¦‚è§ˆ TCMallocä¸ºæ¯ä¸ªçº¿ç¨‹åˆ†é…ä¸€ä¸ªæœ¬åœ°çº¿ç¨‹ç¼“å­˜thread-local cacheã€‚å°çš„å†…å­˜åˆ†é…å°†ç›´æ¥è¢«æœ¬åœ°çº¿ç¨‹ç¼“å­˜æ»¡è¶³ã€‚å¯¹è±¡æŒ‰éœ€ä»ä¸­é—´éƒ¨ä»¶central data structureç§»åŠ¨åˆ°æœ¬åœ°çº¿ç¨‹ç¼“å­˜ã€‚å®šæœŸçš„åƒåœ¾æ”¶é›†è¢«ç”¨æ¥æŠŠå†…å­˜ä»æœ¬åœ°çº¿ç¨‹ç¼“å­˜æ”¾å›ä¸­é—´éƒ¨ä»¶central data structureã€‚\nTCMallocå¯¹äºå¤§å°\u0026lt;=32Kçš„ï¼ˆå°ï¼‰å¯¹è±¡çš„å¤„ç†æ–¹å¼ä¸å¤§å¯¹è±¡ä¸åŒã€‚å¤§å¯¹è±¡ç”±é¡¶å±‚å †ç®¡ç†å™¨central heapä½¿ç”¨é¡µçº§çš„åˆ†é…å™¨ç›´æ¥åˆ†é…ã€‚ï¼ˆä¸€ä¸ªé¡µé¢æ˜¯ä¸€ä¸ª4Kå¯¹é½çš„å†…å­˜åŒºåŸŸï¼‰ï¼ŒåŒæ—¶ï¼Œå¤§å¯¹è±¡æ€»æ˜¯é¡µå¯¹é½å¹¶ä¸”å æ®æ•´æ•°ä¸ªé¡µé¢ã€‚\né¡µé¢å¯è¢«ä¸€ç³»åˆ—çš„å°å¯¹è±¡ç“œåˆ†ä¸ºå¤§å°ç›¸åŒçš„åŒºåŸŸã€‚ä¾‹å¦‚ï¼šä¸€ä¸ª4Kçš„å†…å­˜å°†è¢«32ä¸ªå¯¹è±¡åˆ†å‰²ä¸ºæ¯ä¸ª128bytesçš„å†…å­˜åºåˆ—ã€‚\nå°å¯¹è±¡çš„åˆ†é… æ¯ä¸ªå°å¯¹è±¡éƒ½å¯¹åº”äº170ä¸ªå¯åˆ†é…å†…å­˜å¤§å°size-classesä¸­çš„ä¸€ç§ï¼Œä¾‹å¦‚ï¼Œå¤§å°èŒƒå›´åœ¨961-1024bytesçš„å¯¹è±¡å°†å æ®1024bytesã€‚è¿™äº›å†…å­˜å¤§å°çº§åˆ«è¢«ä¸åŒå¤§å°çš„é—´è·åˆ†éš”å¼€ï¼Œå…¶ä¸­è¾ƒå°å°ºå¯¸ä¸º8bytesï¼Œå¤§å°ºå¯¸ä¸º16bytesï¼Œæ›´å¤§çš„æ˜¯32bytesï¼Œä»¥æ­¤ç±»æ¨ã€‚æœ€å¤§çš„ç©ºé—´æ˜¯256bytesï¼ˆå¯¹äºsize-classesï¼‰å¤§äºç­‰äº2kã€‚\næœ¬åœ°çº¿ç¨‹ç¼“å­˜thread-local cacheæŒæœ‰ä¸åŒsize-classçš„ç©ºé—²é“¾è¡¨ã€‚\nå½“åˆ†é…ä¸€ä¸ªå°å¯¹è±¡æ—¶ï¼š\n å°†å…¶å¤§å°æ˜ å°„åˆ°ç›¸åº”çš„size-class ä¸ºå½“å‰çº¿ç¨‹åœ¨å…¶thread-local cacheçš„ï¼ˆå†…å­˜ï¼‰ç©ºé—²é“¾è¡¨ä¸­å¯»æ‰¾å¯¹åº”size-classé“¾è¡¨ å¦‚æœç©ºé—²é“¾è¡¨éç©ºï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†é“¾è¡¨çš„ç¬¬ä¸€ä¸ªå¯¹è±¡ç§»å‡ºå¹¶è¿”å›ä¹‹ï¼Œå½“æ‰§è¡Œè¿™ç§å¿«é€Ÿè·¯å¾„æ—¶ï¼ŒTCMallocä¸éœ€è¦ä»»ä½•é”ï¼Œå› ä¸ºåŠ é”è§£é”è¿™ä¸€å¯¹æ“ä½œåœ¨2.8GHzçš„æœºå™¨ä¸Šå¤§çº¦éœ€è¦100nsï¼Œè¿™ä½¿å¾—å†…å­˜åˆ†é…é€Ÿåº¦æ˜æ˜¾åŠ å¿«ã€‚  å¦‚æœç©ºé—²é“¾è¡¨ä¸ºç©ºï¼š\n ä»central free list(central data structure)è·å–ä¸€ç³»åˆ—å¯¹åº”å¤§å°çš„å†…å­˜ã€‚ï¼ˆcentral data structureè¢«æ‰€æœ‰çº¿ç¨‹å…±äº«ï¼‰ å°†è·å–åˆ°çš„å†…å­˜æ”¾å…¥thread-local cacheçš„ç©ºé—²é“¾è¡¨ã€‚ è¿”å›å…¶ä¸­ä¸€ä¸ªæ–°è·å–çš„å†…å­˜å¯¹è±¡ç»™åº”ç”¨  å¦‚æœcentral free listä¹Ÿä¸ºç©ºï¼š\n ä»central page allocator(central heap)åˆ†é…ä¸€ç³»åˆ—é¡µé¢ å°†è¿™äº›é¡µé¢åˆ†å‰²ä¸ºå¯¹åº”size-classå¤§å°çš„å†…å­˜å¯¹è±¡ å°†è¿™äº›æ–°çš„å†…å­˜å¯¹è±¡æ”¾å…¥central free list åƒä¹‹å‰æ‰€è¯´å°†å†…å­˜å¯¹è±¡æ”¾å…¥thread-local free list  å¤§å†…å­˜çš„åˆ†é… å¤§å¯¹è±¡è¢«å¯¹é½åˆ°é¡µå¤§å°ï¼ˆ4Kï¼‰,å¹¶ä¸”è¢«central page heapç®¡ç†ã€‚central page heapåŒæ ·æ˜¯ä¸€ä¸ªç©ºé—²åˆ—è¡¨æ•°ç»„ã€‚å½“æ•°ç»„ä¸‹æ ‡iå°äº256æ—¶ï¼Œç¬¬kä¸ªæ•°ç»„å…ƒç´ æ˜¯ä¸€ä¸ªæ¯ä¸ªèŠ‚ç‚¹åŒ…å«kä¸ªé¡µçš„ç©ºé—²åˆ—è¡¨ï¼Œè€Œç¬¬256ä¸ªæ•°ç»„å…ƒç´ ä¸­ï¼Œé“¾è¡¨çš„èŠ‚ç‚¹é•¿åº¦å¤§äº256é¡µ","title":"TCMalloc : Thread-Caching Malloc"},{"content":"1. ä¸¤ç§ç«¯å£ æˆ‘ä»¬çŸ¥é“TCP/UDPåœ¨å·¥ä½œæ—¶éƒ½éœ€è¦ä¸€ä¸ªç«¯å£æ¥è¿›è¡Œæ”¶å‘ä¿¡æ¯ï¼Œæœ‰ä¸¤ç§ç±»å‹çš„ç«¯å£ï¼š\n ä¸´æ—¶ç«¯å£æˆ–è€…å«åŠ¨æ€ç«¯å£ï¼Œæ˜¯é»˜è®¤æƒ…å†µä¸‹è®¡ç®—æœºè¿›è¡Œå‡ºç«™è¿æ¥æ—¶æ‰€æœ‰çš„ç«¯å£é›† å·²çŸ¥ç«¯å£ï¼Œæ˜¯ç‰¹å®šåº”ç”¨ç¨‹åºæˆ–æœåŠ¡çš„å®šä¹‰ç«¯å£ã€‚ ä¾‹å¦‚ï¼Œæ–‡ä»¶æœåŠ¡å™¨æœåŠ¡åœ¨ç«¯å£ 445 ä¸Šï¼ŒHTTPS ä¸º 443ï¼ŒHTTP ä¸º 80ï¼ŒRPC ä¸º 135ã€‚ è‡ªå®šä¹‰åº”ç”¨ç¨‹åºè¿˜å°†å…·æœ‰å…¶å®šä¹‰çš„ç«¯å£å·ã€‚  å®¢æˆ·ç«¯è¦æƒ³è¿æ¥åˆ°åº”ç”¨ç¨‹åºæˆ–æœåŠ¡ï¼Œéœ€è¦ä½¿ç”¨è®¡ç®—æœºä¸­çš„ä¸´æ—¶ç«¯å£å»è¿æ¥æœåŠ¡å™¨çš„å·²çŸ¥ç«¯å£ã€‚å¦‚ï¼šå®¢æˆ·ç«¯è®¡ç®—æœºä¸Šçš„æµè§ˆå™¨å°†ä½¿ç”¨ä¸´æ—¶ç«¯å£è¿æ¥åˆ°ç«¯å£ https://www.microsoft.com 443ã€‚\nå½“æµè§ˆå™¨åˆ›å»ºä¸å¤šä¸ªç½‘ç«™çš„å¤§é‡è¿æ¥çš„æƒ…å†µä¸‹ï¼Œå…¶æ‰€å°è¯•çš„ä»»ä½•æ–°è¿æ¥éƒ½å°†ä½¿ç”¨ä¸´æ—¶ç«¯å£ã€‚ ä¸€æ®µæ—¶é—´ä¹‹åï¼Œè¿æ¥å°†å¼€å§‹å¤±è´¥ï¼Œå¹¶ä¸”å‡ºç°æ­¤æ•…éšœçš„å¯èƒ½æ€§å¾ˆé«˜ï¼Œå› ä¸ºæµè§ˆå™¨å·²ä½¿ç”¨æ‰€æœ‰å¯ç”¨ç«¯å£è¿›è¡Œå¤–éƒ¨è¿æ¥ï¼Œå¹¶ä¸”å»ºç«‹è¿æ¥çš„ä»»ä½•æ–°å°è¯•éƒ½å°†å¤±è´¥ï¼Œå› ä¸ºæ²¡æœ‰æ›´å¤šçš„ç«¯å£å¯ç”¨ã€‚ å½“ä½¿ç”¨è®¡ç®—æœºä¸Šçš„æ‰€æœ‰ç«¯å£æ—¶ï¼Œæˆ‘ä»¬å°†å®ƒè§†ä¸ºç«¯å£è€—å°½ã€‚\n2. TCP/IPçš„é»˜è®¤åŠ¨æ€ç«¯å£èŒƒå›´ windowä¸Šæœ‰ä¸¤ç§åŠ¨æ€ç«¯å£èŒƒå›´ï¼š\n èµ·å§‹ç«¯å£49152ï¼Œç»“æŸç«¯å£65535 ï¼ˆæ–°ç‰ˆï¼‰ èµ·å§‹ç«¯å£1025ï¼Œç»“æŸç«¯å£5000ï¼ˆæ—§ç‰ˆï¼‰  å¯ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹è®¡ç®—æœºä¸ŠåŠ¨æ€ç«¯å£èŒƒå›´ï¼š\nnetsh int ipv4 show dynamicport tcp netsh int ipv4 show dynamicport udp netsh int ipv6 show dynamicport tcp netsh int ipv6 show dynamicport udp ä¹Ÿå¯ä»¥æ‰‹åŠ¨æ›´æ”¹åŠ¨æ€ç«¯å£çš„èŒƒå›´ï¼š\nnetsh int \u0026lt;ipv4|ipv6\u0026gt; set dynamic \u0026lt;tcp|udp\u0026gt; start=number num=range å…¶ä¸­startæ˜¯èµ·å§‹ç«¯å£å·ï¼Œnumæ˜¯èŒƒå›´\nä¾‹å¦‚ï¼š\nnetsh int ipv4 set dynamicport tcp start=10000 num=1000 netsh int ipv4 set dynamicport udp start=10000 num=1000 netsh int ipv6 set dynamicport tcp start=10000 num=1000 netsh int ipv6 set dynamicport udp start=10000 num=1000 è¿™äº›ç¤ºä¾‹å‘½ä»¤å°†åŠ¨æ€ç«¯å£èŒƒå›´è®¾ç½®ä¸ºä»10000å¼€å§‹ï¼Œåˆ†é…1000ä¸ªåŠ¨æ€ç«¯å£ï¼Œå³ï¼š10000-19999ã€‚å¯ä»¥è®¾ç½®çš„æœ€å°ç«¯å£èŒƒå›´æ˜¯255ï¼Œå¯ä»¥è®¾ç½®çš„æœ€å°èµ·å§‹ç«¯å£ä¸º1025ã€‚è‹¥è¦å¤åˆ¶ Windows Server 2003 çš„é»˜è®¤è¡Œä¸ºï¼Œè¯·ä½¿ç”¨ 1025 ä½œä¸ºèµ·å§‹ç«¯å£ï¼Œç„¶åä½¿ç”¨ 3976 ä½œä¸º TCP å’Œ UDP çš„èŒƒå›´ã€‚ è¿™å¯¼è‡´èµ·å§‹ç«¯å£ä¸º 1025ï¼Œç»“æŸç«¯å£ä¸º 5000ã€‚\n","permalink":"http://yangchnet.github.io/Dessert/posts/windows/%E7%AB%AF%E5%8F%A3%E6%B6%88%E8%80%97%E9%97%AE%E9%A2%98/","summary":"1. ä¸¤ç§ç«¯å£ æˆ‘ä»¬çŸ¥é“TCP/UDPåœ¨å·¥ä½œæ—¶éƒ½éœ€è¦ä¸€ä¸ªç«¯å£æ¥è¿›è¡Œæ”¶å‘ä¿¡æ¯ï¼Œæœ‰ä¸¤ç§ç±»å‹çš„ç«¯å£ï¼š\n ä¸´æ—¶ç«¯å£æˆ–è€…å«åŠ¨æ€ç«¯å£ï¼Œæ˜¯é»˜è®¤æƒ…å†µä¸‹è®¡ç®—æœºè¿›è¡Œå‡ºç«™è¿æ¥æ—¶æ‰€æœ‰çš„ç«¯å£é›† å·²çŸ¥ç«¯å£ï¼Œæ˜¯ç‰¹å®šåº”ç”¨ç¨‹åºæˆ–æœåŠ¡çš„å®šä¹‰ç«¯å£ã€‚ ä¾‹å¦‚ï¼Œæ–‡ä»¶æœåŠ¡å™¨æœåŠ¡åœ¨ç«¯å£ 445 ä¸Šï¼ŒHTTPS ä¸º 443ï¼ŒHTTP ä¸º 80ï¼ŒRPC ä¸º 135ã€‚ è‡ªå®šä¹‰åº”ç”¨ç¨‹åºè¿˜å°†å…·æœ‰å…¶å®šä¹‰çš„ç«¯å£å·ã€‚  å®¢æˆ·ç«¯è¦æƒ³è¿æ¥åˆ°åº”ç”¨ç¨‹åºæˆ–æœåŠ¡ï¼Œéœ€è¦ä½¿ç”¨è®¡ç®—æœºä¸­çš„ä¸´æ—¶ç«¯å£å»è¿æ¥æœåŠ¡å™¨çš„å·²çŸ¥ç«¯å£ã€‚å¦‚ï¼šå®¢æˆ·ç«¯è®¡ç®—æœºä¸Šçš„æµè§ˆå™¨å°†ä½¿ç”¨ä¸´æ—¶ç«¯å£è¿æ¥åˆ°ç«¯å£ https://www.microsoft.com 443ã€‚\nå½“æµè§ˆå™¨åˆ›å»ºä¸å¤šä¸ªç½‘ç«™çš„å¤§é‡è¿æ¥çš„æƒ…å†µä¸‹ï¼Œå…¶æ‰€å°è¯•çš„ä»»ä½•æ–°è¿æ¥éƒ½å°†ä½¿ç”¨ä¸´æ—¶ç«¯å£ã€‚ ä¸€æ®µæ—¶é—´ä¹‹åï¼Œè¿æ¥å°†å¼€å§‹å¤±è´¥ï¼Œå¹¶ä¸”å‡ºç°æ­¤æ•…éšœçš„å¯èƒ½æ€§å¾ˆé«˜ï¼Œå› ä¸ºæµè§ˆå™¨å·²ä½¿ç”¨æ‰€æœ‰å¯ç”¨ç«¯å£è¿›è¡Œå¤–éƒ¨è¿æ¥ï¼Œå¹¶ä¸”å»ºç«‹è¿æ¥çš„ä»»ä½•æ–°å°è¯•éƒ½å°†å¤±è´¥ï¼Œå› ä¸ºæ²¡æœ‰æ›´å¤šçš„ç«¯å£å¯ç”¨ã€‚ å½“ä½¿ç”¨è®¡ç®—æœºä¸Šçš„æ‰€æœ‰ç«¯å£æ—¶ï¼Œæˆ‘ä»¬å°†å®ƒè§†ä¸ºç«¯å£è€—å°½ã€‚\n2. TCP/IPçš„é»˜è®¤åŠ¨æ€ç«¯å£èŒƒå›´ windowä¸Šæœ‰ä¸¤ç§åŠ¨æ€ç«¯å£èŒƒå›´ï¼š\n èµ·å§‹ç«¯å£49152ï¼Œç»“æŸç«¯å£65535 ï¼ˆæ–°ç‰ˆï¼‰ èµ·å§‹ç«¯å£1025ï¼Œç»“æŸç«¯å£5000ï¼ˆæ—§ç‰ˆï¼‰  å¯ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹è®¡ç®—æœºä¸ŠåŠ¨æ€ç«¯å£èŒƒå›´ï¼š\nnetsh int ipv4 show dynamicport tcp netsh int ipv4 show dynamicport udp netsh int ipv6 show dynamicport tcp netsh int ipv6 show dynamicport udp ä¹Ÿå¯ä»¥æ‰‹åŠ¨æ›´æ”¹åŠ¨æ€ç«¯å£çš„èŒƒå›´ï¼š\nnetsh int \u0026lt;ipv4|ipv6\u0026gt; set dynamic \u0026lt;tcp|udp\u0026gt; start=number num=range å…¶ä¸­startæ˜¯èµ·å§‹ç«¯å£å·ï¼Œnumæ˜¯èŒƒå›´\nä¾‹å¦‚ï¼š\nnetsh int ipv4 set dynamicport tcp start=10000 num=1000 netsh int ipv4 set dynamicport udp start=10000 num=1000 netsh int ipv6 set dynamicport tcp start=10000 num=1000 netsh int ipv6 set dynamicport udp start=10000 num=1000 è¿™äº›ç¤ºä¾‹å‘½ä»¤å°†åŠ¨æ€ç«¯å£èŒƒå›´è®¾ç½®ä¸ºä»10000å¼€å§‹ï¼Œåˆ†é…1000ä¸ªåŠ¨æ€ç«¯å£ï¼Œå³ï¼š10000-19999ã€‚å¯ä»¥è®¾ç½®çš„æœ€å°ç«¯å£èŒƒå›´æ˜¯255ï¼Œå¯ä»¥è®¾ç½®çš„æœ€å°èµ·å§‹ç«¯å£ä¸º1025ã€‚è‹¥è¦å¤åˆ¶ Windows Server 2003 çš„é»˜è®¤è¡Œä¸ºï¼Œè¯·ä½¿ç”¨ 1025 ä½œä¸ºèµ·å§‹ç«¯å£ï¼Œç„¶åä½¿ç”¨ 3976 ä½œä¸º TCP å’Œ UDP çš„èŒƒå›´ã€‚ è¿™å¯¼è‡´èµ·å§‹ç«¯å£ä¸º 1025ï¼Œç»“æŸç«¯å£ä¸º 5000ã€‚","title":"ç«¯å£æ¶ˆè€—é—®é¢˜"},{"content":"1. tagçš„åŸºæœ¬ä»‹ç» å­—æ®µæ ‡ç­¾å¯ä»¥å­˜å‚¨å…ƒä¿¡æ¯ï¼Œè¿™äº›å…ƒä¿¡æ¯å¯ä»¥ä½¿ç”¨åå°„æ¥è®¿é—®ã€‚é€šå¸¸è¿™äº›å…ƒä¿¡æ¯ç”¨æ¥æä¾›ä¸€ä¸ªå­—æ®µå¦‚ä½•ä»ä¸€ç§æ ¼å¼ç¼–ç è‡³å¦ä¸€ç§æ ¼å¼çš„ç›¸å…³ä¿¡æ¯ï¼ˆæˆ–æ˜¯æ•°æ®åº”å¦‚ä½•åœ¨æ•°æ®åº“ä¸­å­˜å‚¨ç­‰ï¼‰ã€‚ä½†å®é™…ä¸Šæ ‡ç­¾å¯ä»¥å­˜å‚¨ä»»ä½•ä½ æƒ³è¦çš„å…ƒä¿¡æ¯ï¼Œæ— è®ºæ˜¯ä½ è‡ªå·±ä½¿ç”¨è¿˜æ˜¯ç”±å¦ä¸€ä¸ªåŒ…ä½¿ç”¨ã€‚\nå°±åƒreflect.StructTagæ–‡æ¡£ä¸­æåˆ°çš„é‚£æ ·ï¼Œå­—æ®µæ ‡ç­¾é€šå¸¸æ˜¯ç”±ç©ºæ ¼åˆ†å‰²çš„key:\u0026quot;value\u0026quot;åˆ—è¡¨ï¼Œä¾‹å¦‚ï¼š\ntype User struct { Name string `json:\u0026#34;name\u0026#34; xml:\u0026#34;name\u0026#34;` } å…¶ä¸­çš„keyé€šå¸¸è¡¨ç¤ºåé¢\u0026quot;value\u0026quot;æ‰€å¯¹åº”çš„åŒ…ï¼Œä¾‹å¦‚jsonè¿™ä¸ªkeyå°†è¢«encoding/jsonè¿™ä¸ªåŒ…ä½¿ç”¨ã€‚\nå¦‚æœéœ€è¦åœ¨\u0026quot;value\u0026quot;ä¸­ä¼ é€’å¤šä¸ªå€¼ï¼Œé‚£ä¹ˆé€šå¸¸ä½¿ç”¨,é€—å·æ¥åˆ†å‰²ï¼Œä¾‹å¦‚ï¼š\nName string `json:\u0026#34;name,omitempty\u0026#34; xml:\u0026#34;name\u0026#34;` å€¼ä¸ºç ´æŠ˜å·é€šå¸¸ä»£è¡¨åœ¨å¤„ç†æ—¶å¿½ç•¥è¯¥å­—æ®µï¼Œä¾‹å¦‚åœ¨jsonä¸­ä»£è¡¨ä¸è¦åºåˆ—åŒ–è¿™ä¸ªå­—æ®µ\n2. ä¾‹å­ï¼šè·å–è‡ªå®šä¹‰tag æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åå°„åŒ…æ¥è·å–ç»“æ„ä½“å­—æ®µçš„å€¼ã€‚é¦–å…ˆæˆ‘ä»¬éœ€è¦è·å–ç»“æ„ä½“çš„Typeï¼Œç„¶åæŸ¥è¯¢å­—æ®µï¼Œå¯ä»¥ä½¿ç”¨Type.Field(i int)æˆ–è€…Type.FieldByName(name string)ã€‚è¿™äº›æ–¹æ³•è¿”å›ä¸€ä¸ªä»£è¡¨ç»“æ„ä½“å­—æ®µçš„StructFieldå€¼å’Œä¸€ä¸ªä»£è¡¨tagçš„ç±»å‹ä¸ºStructTagçš„StructField.Tagå€¼ã€‚\nå‰é¢æˆ‘ä»¬æåˆ°ï¼Œå­—æ®µæ ‡ç­¾é€šå¸¸æ˜¯ç”±ç©ºæ ¼åˆ†å‰²çš„key:\u0026quot;value\u0026quot;åˆ—è¡¨ï¼Œå¦‚æœä½ çš„ç¡®æ˜¯è¿™ä¹ˆåšçš„ï¼Œä½ å¯ä»¥ä½¿ç”¨StructTag.Get(key string)è¿™ä¸ªæ–¹æ³•æ¥è·å–è¿™ä¸ªkeyå¯¹åº”çš„valueã€‚å¦‚æœä½ ä¸æ˜¯è¿™ä¹ˆåšçš„ï¼ŒGet()æ–¹æ³•å¯èƒ½ä¸èƒ½è§£ækey:\u0026quot;value\u0026quot;å¯¹å¹¶æ‰¾åˆ°ä½ æƒ³è¦çš„æ ‡ç­¾ã€‚å¦‚æœä½ æ²¡æœ‰éµå¾ªå­—æ®µæ ‡ç­¾é€šå¸¸æ˜¯ç”±ç©ºæ ¼åˆ†å‰²çš„key:\u0026quot;value\u0026quot;åˆ—è¡¨ï¼Œé‚£ä¹ˆä½ å¯èƒ½éœ€è¦å®ç°è‡ªå·±çš„è§£æé€»è¾‘ã€‚\ngo1.7ä¸­æ·»åŠ äº†StructTag.Lookup()æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•çš„è¡Œä¸ºç±»ä¼¼äºGet()ï¼Œä½†å…¶å°†ä¸åŒ…å«ç»™å®šé”®çš„æ ‡ç­¾ä¸å°†ç©ºå­—ç¬¦ä¸²ä¸ç»™å®šé”®ç›¸å…³è”çš„æ ‡ç­¾åŒºåˆ†å¼€æ¥ã€‚\næ¥çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š\ntype User struct { Name string `mytag:\u0026#34;MyName\u0026#34;` Email stirng `mytag:\u0026#34;MyEmail\u0026#34;` } u := User{\u0026#34;Bob\u0026#34;, \u0026#34;bob@cc.com\u0026#34;} t := reflect.TypeOf(u) for _ fieldName := range []string{\u0026#34;Name\u0026#34;, \u0026#34;Email\u0026#34;} { field, found := t.FieldByName(fieldName) if !found { continue } fmt.Printf(\u0026#34;\\nField: User.%s\\n\u0026#34;, fieldName) fmt.Printf(\u0026#34;\\tWhole tag value : %q\\n\u0026#34;, field.Tag) fmt.Printf(\u0026#34;\\tValue of \u0026#39;mytag\u0026#39;: %q\\n\u0026#34;, field.Tag.Get(\u0026#34;mytag\u0026#34;)) } è¾“å‡ºä¸ºï¼š\nField: User.Name Whole tag value : \u0026quot;mytag:\\\u0026quot;MyName\\\u0026quot;\u0026quot; Value of 'mytag': \u0026quot;MyName\u0026quot; Field: User.Email Whole tag value : \u0026quot;mytag:\\\u0026quot;MyEmail\\\u0026quot;\u0026quot; Value of 'mytag': \u0026quot;MyEmail\u0026quot; 3. å¸¸è§çš„tag  json - used by the encoding/json package, detailed at json.Marshal() xml - used by the encoding/xml package, detailed at xml.Marshal() bson - used by gobson, detailed at bson.Marshal() protobuf - used by github.com/golang/protobuf/proto, detailed in the package doc yaml - used by the gopkg.in/yaml.v2 package, detailed at yaml.Marshal() db - used by the github.com/jmoiron/sqlx package; also used by github.com/go-gorp/gorp package orm - used by the github.com/astaxie/beego/orm package, detailed at Models â€“ Beego ORM gorm - used by gorm.io/gorm, examples can be found in their docs valid - used by the github.com/asaskevich/govalidator package, examples can be found in the project page datastore - used by appengine/datastore (Google App Engine platform, Datastore service), detailed at Properties schema - used by github.com/gorilla/schema to fill a struct with HTML form values, detailed in the package doc asn - used by the encoding/asn1 package, detailed at asn1.Marshal() and asn1.Unmarshal() csv - used by the github.com/gocarina/gocsv package env - used by the github.com/caarlos0/env package  Translated from: https://stackoverflow.com/questions/10858787/what-are-the-uses-for-tags-in-go\n","permalink":"http://yangchnet.github.io/Dessert/posts/golang/golang%E4%B8%AD%E7%9A%84tag/","summary":"1. tagçš„åŸºæœ¬ä»‹ç» å­—æ®µæ ‡ç­¾å¯ä»¥å­˜å‚¨å…ƒä¿¡æ¯ï¼Œè¿™äº›å…ƒä¿¡æ¯å¯ä»¥ä½¿ç”¨åå°„æ¥è®¿é—®ã€‚é€šå¸¸è¿™äº›å…ƒä¿¡æ¯ç”¨æ¥æä¾›ä¸€ä¸ªå­—æ®µå¦‚ä½•ä»ä¸€ç§æ ¼å¼ç¼–ç è‡³å¦ä¸€ç§æ ¼å¼çš„ç›¸å…³ä¿¡æ¯ï¼ˆæˆ–æ˜¯æ•°æ®åº”å¦‚ä½•åœ¨æ•°æ®åº“ä¸­å­˜å‚¨ç­‰ï¼‰ã€‚ä½†å®é™…ä¸Šæ ‡ç­¾å¯ä»¥å­˜å‚¨ä»»ä½•ä½ æƒ³è¦çš„å…ƒä¿¡æ¯ï¼Œæ— è®ºæ˜¯ä½ è‡ªå·±ä½¿ç”¨è¿˜æ˜¯ç”±å¦ä¸€ä¸ªåŒ…ä½¿ç”¨ã€‚\nå°±åƒreflect.StructTagæ–‡æ¡£ä¸­æåˆ°çš„é‚£æ ·ï¼Œå­—æ®µæ ‡ç­¾é€šå¸¸æ˜¯ç”±ç©ºæ ¼åˆ†å‰²çš„key:\u0026quot;value\u0026quot;åˆ—è¡¨ï¼Œä¾‹å¦‚ï¼š\ntype User struct { Name string `json:\u0026#34;name\u0026#34; xml:\u0026#34;name\u0026#34;` } å…¶ä¸­çš„keyé€šå¸¸è¡¨ç¤ºåé¢\u0026quot;value\u0026quot;æ‰€å¯¹åº”çš„åŒ…ï¼Œä¾‹å¦‚jsonè¿™ä¸ªkeyå°†è¢«encoding/jsonè¿™ä¸ªåŒ…ä½¿ç”¨ã€‚\nå¦‚æœéœ€è¦åœ¨\u0026quot;value\u0026quot;ä¸­ä¼ é€’å¤šä¸ªå€¼ï¼Œé‚£ä¹ˆé€šå¸¸ä½¿ç”¨,é€—å·æ¥åˆ†å‰²ï¼Œä¾‹å¦‚ï¼š\nName string `json:\u0026#34;name,omitempty\u0026#34; xml:\u0026#34;name\u0026#34;` å€¼ä¸ºç ´æŠ˜å·é€šå¸¸ä»£è¡¨åœ¨å¤„ç†æ—¶å¿½ç•¥è¯¥å­—æ®µï¼Œä¾‹å¦‚åœ¨jsonä¸­ä»£è¡¨ä¸è¦åºåˆ—åŒ–è¿™ä¸ªå­—æ®µ\n2. ä¾‹å­ï¼šè·å–è‡ªå®šä¹‰tag æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åå°„åŒ…æ¥è·å–ç»“æ„ä½“å­—æ®µçš„å€¼ã€‚é¦–å…ˆæˆ‘ä»¬éœ€è¦è·å–ç»“æ„ä½“çš„Typeï¼Œç„¶åæŸ¥è¯¢å­—æ®µï¼Œå¯ä»¥ä½¿ç”¨Type.Field(i int)æˆ–è€…Type.FieldByName(name string)ã€‚è¿™äº›æ–¹æ³•è¿”å›ä¸€ä¸ªä»£è¡¨ç»“æ„ä½“å­—æ®µçš„StructFieldå€¼å’Œä¸€ä¸ªä»£è¡¨tagçš„ç±»å‹ä¸ºStructTagçš„StructField.Tagå€¼ã€‚\nå‰é¢æˆ‘ä»¬æåˆ°ï¼Œå­—æ®µæ ‡ç­¾é€šå¸¸æ˜¯ç”±ç©ºæ ¼åˆ†å‰²çš„key:\u0026quot;value\u0026quot;åˆ—è¡¨ï¼Œå¦‚æœä½ çš„ç¡®æ˜¯è¿™ä¹ˆåšçš„ï¼Œä½ å¯ä»¥ä½¿ç”¨StructTag.Get(key string)è¿™ä¸ªæ–¹æ³•æ¥è·å–è¿™ä¸ªkeyå¯¹åº”çš„valueã€‚å¦‚æœä½ ä¸æ˜¯è¿™ä¹ˆåšçš„ï¼ŒGet()æ–¹æ³•å¯èƒ½ä¸èƒ½è§£ækey:\u0026quot;value\u0026quot;å¯¹å¹¶æ‰¾åˆ°ä½ æƒ³è¦çš„æ ‡ç­¾ã€‚å¦‚æœä½ æ²¡æœ‰éµå¾ªå­—æ®µæ ‡ç­¾é€šå¸¸æ˜¯ç”±ç©ºæ ¼åˆ†å‰²çš„key:\u0026quot;value\u0026quot;åˆ—è¡¨ï¼Œé‚£ä¹ˆä½ å¯èƒ½éœ€è¦å®ç°è‡ªå·±çš„è§£æé€»è¾‘ã€‚\ngo1.7ä¸­æ·»åŠ äº†StructTag.Lookup()æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•çš„è¡Œä¸ºç±»ä¼¼äºGet()ï¼Œä½†å…¶å°†ä¸åŒ…å«ç»™å®šé”®çš„æ ‡ç­¾ä¸å°†ç©ºå­—ç¬¦ä¸²ä¸ç»™å®šé”®ç›¸å…³è”çš„æ ‡ç­¾åŒºåˆ†å¼€æ¥ã€‚\næ¥çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š\ntype User struct { Name string `mytag:\u0026#34;MyName\u0026#34;` Email stirng `mytag:\u0026#34;MyEmail\u0026#34;` } u := User{\u0026#34;Bob\u0026#34;, \u0026#34;bob@cc.com\u0026#34;} t := reflect.TypeOf(u) for _ fieldName := range []string{\u0026#34;Name\u0026#34;, \u0026#34;Email\u0026#34;} { field, found := t.FieldByName(fieldName) if !found { continue } fmt.Printf(\u0026#34;\\nField: User.%s\\n\u0026#34;, fieldName) fmt.Printf(\u0026#34;\\tWhole tag value : %q\\n\u0026#34;, field.","title":"golangä¸­çš„tag"},{"content":"å·²è¿‡æ—¶ï¼Œä¸å¯ç”¨\n éƒ¨ç½²ç¯å¢ƒï¼š ubuntu20.04ï¼Œ 8G+4æ ¸ kuberneteç‰ˆæœ¬ï¼š 1.22.1\n 1. å®‰è£…vagrantå’Œansible æŒ‰å®˜ç½‘æ•™ç¨‹å³å¯\n2. Vagrantfile å»ºç«‹å¦‚ä¸‹ç›®å½•\nk8s-cluster â”œâ”€â”€ kubernetes-setup â”‚Â â”œâ”€â”€ master-playbook.yml â”‚Â â””â”€â”€ node-playbook.yml â””â”€â”€ Vagrantfile å…¶ä¸­ï¼ŒVagrantfileå†…å®¹å¦‚ä¸‹ï¼š\nIMAGE_NAME = \u0026quot;bento/ubuntu-16.04\u0026quot; N = 2 Vagrant.configure(\u0026quot;2\u0026quot;) do |config| config.ssh.insert_key = false config.vm.provider \u0026quot;virtualbox\u0026quot; do |v| v.memory = 2048 v.cpus = 2 end config.vm.define \u0026quot;k8s-master\u0026quot; do |master| master.vm.box = IMAGE_NAME master.vm.network \u0026quot;private_network\u0026quot;, ip: \u0026quot;192.168.50.10\u0026quot; master.vm.hostname = \u0026quot;k8s-master\u0026quot; master.vm.provision \u0026quot;ansible\u0026quot; do |ansible| ansible.playbook = \u0026quot;kubernetes-setup/master-playbook.yml\u0026quot; ansible.extra_vars = { node_ip: \u0026quot;192.168.50.10\u0026quot;, } end end (1..N).each do |i| config.vm.define \u0026quot;node-#{i}\u0026quot; do |node| node.vm.box = IMAGE_NAME node.vm.network \u0026quot;private_network\u0026quot;, ip: \u0026quot;192.168.50.#{i + 10}\u0026quot; node.vm.hostname = \u0026quot;node-#{i}\u0026quot; node.vm.provision \u0026quot;ansible\u0026quot; do |ansible| ansible.playbook = \u0026quot;kubernetes-setup/node-playbook.yml\u0026quot; ansible.extra_vars = { node_ip: \u0026quot;192.168.50.#{i + 10}\u0026quot;, } end end end end master-playbook.ymå†…å®¹å¦‚ä¸‹ï¼š\n--- - hosts: all become: true tasks: - name: Install packages that allow apt to be used over HTTPS apt: name: \u0026#34;{{ packages }}\u0026#34; state: present update_cache: yes vars: packages: - apt-transport-https - ca-certificates - curl - gnupg-agent - software-properties-common - name: Add an apt signing key for Docker apt_key: url: http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg state: present - name: Add apt repository for stable version apt_repository: repo: deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu xenial stable state: present - name: Install docker and its dependecies apt: name: \u0026#34;{{ packages }}\u0026#34; state: present update_cache: yes vars: packages: - docker-ce - docker-ce-cli - containerd.io notify: - docker status - name: Add vagrant user to docker group user: name: vagrant group: docker - name: Change Cgroup Driver from cgroupfs to systemd shell: |echo \u0026#39;{ \u0026#34;exec-opts\u0026#34;: [\u0026#34;native.cgroupdriver=systemd\u0026#34;] }\u0026#39; \u0026gt;\u0026gt; /etc/docker/daemon.json - name: Restart docker shell: |systemctl daemon-reload systemctl restart docker - name: Remove swapfile from /etc/fstab mount: name: \u0026#34;{{ item }}\u0026#34; fstype: swap state: absent with_items: - swap - none - name: Disable swap command: swapoff -a when: ansible_swaptotal_mb \u0026gt; 0 - name: Add an apt signing key for Kubernetes apt_key: url: https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg state: present - name: Adding apt repository for Kubernetes apt_repository: repo: deb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main state: present filename: kubernetes.list - name: Install Kubernetes binaries apt: name: \u0026#34;{{ packages }}\u0026#34; state: present update_cache: yes vars: packages: - kubelet - kubeadm - kubectl - name: Configure node ip lineinfile: path: /usr/bin/kubelet line: KUBELET_EXTRA_ARGS=--node-ip={{ node_ip }} - name: Restart kubelet service: name: kubelet daemon_reload: yes state: restarted - name: Pull CoreDns:v1.8.4 shell: |docker pull registry.aliyuncs.com/google_containers/coredns:latest docker tag registry.aliyuncs.com/google_containers/coredns:latest registry.aliyuncs.com/google_containers/coredns:v1.8.4 docker rmi registry.aliyuncs.com/google_containers/coredns:latest - name: Initialize the Kubernetes cluster using kubeadm command: kubeadm init --apiserver-advertise-address=\u0026#34;192.168.50.10\u0026#34; --apiserver-cert-extra-sans=\u0026#34;192.168.50.10\u0026#34; --node-name k8s-master --pod-network-cidr=192.168.0.0/16 --image-repository=registry.aliyuncs.com/google_containers - name: Setup kubeconfig for vagrant user command: \u0026#34;{{ item }}\u0026#34; with_items: - mkdir -p /home/vagrant/.kube - cp -i /etc/kubernetes/admin.conf /home/vagrant/.kube/config - chown vagrant:vagrant /home/vagrant/.kube/config - name: Install calico pod network become: false command: kubectl create -f https://docs.projectcalico.org/manifests/calico.yaml - name: Generate join command command: kubeadm token create --print-join-command register: join_command - name: Copy join command to local file shell: |echo hello | tee /vagrant/hello kubeadm token create --print-join-command | tee /vagrant/join-command # local_action: copy content=\u0026#34;{{ join_command.stdout_lines[0] }}\u0026#34; dest=\u0026#34;{{ playbook_dir }}/join-command\u0026#34; handlers: - name: docker status service: name=docker state=started node-playbook.ymlå†…å®¹å¦‚ä¸‹ï¼š\n--- - hosts: all become: true tasks: - name: Install packages that allow apt to be used over HTTPS apt: name: \u0026#34;{{ packages }}\u0026#34; state: present update_cache: yes vars: packages: - apt-transport-https - ca-certificates - curl - gnupg-agent - software-properties-common - name: Add an apt signing key for Docker apt_key: url: http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg state: present - name: Add apt repository for stable version apt_repository: repo: deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu xenial stable state: present - name: Install docker and its dependecies apt: name: \u0026#34;{{ packages }}\u0026#34; state: present update_cache: yes vars: packages: - docker-ce - docker-ce-cli - containerd.io notify: - docker status - name: Add vagrant user to docker group user: name: vagrant group: docker - name: Change Cgroup Driver from cgroupfs to systemd shell: |echo \u0026#39;{ \u0026#34;exec-opts\u0026#34;: [\u0026#34;native.cgroupdriver=systemd\u0026#34;] }\u0026#39; \u0026gt;\u0026gt; /etc/docker/daemon.json - name: Restart docker shell: |systemctl daemon-reload systemctl restart docker - name: Remove swapfile from /etc/fstab mount: name: \u0026#34;{{ item }}\u0026#34; fstype: swap state: absent with_items: - swap - none - name: Disable swap command: swapoff -a when: ansible_swaptotal_mb \u0026gt; 0 - name: Add an apt signing key for Kubernetes apt_key: url: https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg state: present - name: Adding apt repository for Kubernetes apt_repository: repo: deb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main state: present filename: kubernetes.list - name: Install Kubernetes binaries apt: name: \u0026#34;{{ packages }}\u0026#34; state: present update_cache: yes vars: packages: - kubelet - kubeadm - kubectl - name: Configure node ip lineinfile: path: /usr/bin/kubelet line: KUBELET_EXTRA_ARGS=--node-ip={{ node_ip }} - name: Restart kubelet service: name: kubelet daemon_reload: yes state: restarted - name: Copy the join command to server location shell: |cat /vagrant/join-command \u0026gt;\u0026gt; /tmp/join-command.sh chmod +x /tmp/join-command.sh - name: Join the node to cluster command: sh /tmp/join-command.sh handlers: - name: docker status service: name=docker state=started 3. å¯åŠ¨é›†ç¾¤ cd /path/to/k8s-cluster/ vagrant up è€å¿ƒç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œä¸‰ä¸ªèŠ‚ç‚¹çš„k8sé›†ç¾¤å°±å¯åŠ¨æˆåŠŸäº†ã€‚\n","permalink":"http://yangchnet.github.io/Dessert/posts/container/vagrant+ansible%E5%AE%89%E8%A3%85k8s%E9%9B%86%E7%BE%A4/","summary":"å·²è¿‡æ—¶ï¼Œä¸å¯ç”¨\n éƒ¨ç½²ç¯å¢ƒï¼š ubuntu20.04ï¼Œ 8G+4æ ¸ kuberneteç‰ˆæœ¬ï¼š 1.22.1\n 1. å®‰è£…vagrantå’Œansible æŒ‰å®˜ç½‘æ•™ç¨‹å³å¯\n2. Vagrantfile å»ºç«‹å¦‚ä¸‹ç›®å½•\nk8s-cluster â”œâ”€â”€ kubernetes-setup â”‚Â â”œâ”€â”€ master-playbook.yml â”‚Â â””â”€â”€ node-playbook.yml â””â”€â”€ Vagrantfile å…¶ä¸­ï¼ŒVagrantfileå†…å®¹å¦‚ä¸‹ï¼š\nIMAGE_NAME = \u0026quot;bento/ubuntu-16.04\u0026quot; N = 2 Vagrant.configure(\u0026quot;2\u0026quot;) do |config| config.ssh.insert_key = false config.vm.provider \u0026quot;virtualbox\u0026quot; do |v| v.memory = 2048 v.cpus = 2 end config.vm.define \u0026quot;k8s-master\u0026quot; do |master| master.vm.box = IMAGE_NAME master.vm.network \u0026quot;private_network\u0026quot;, ip: \u0026quot;192.168.50.10\u0026quot; master.vm.hostname = \u0026quot;k8s-master\u0026quot; master.vm.provision \u0026quot;ansible\u0026quot; do |ansible| ansible.playbook = \u0026quot;kubernetes-setup/master-playbook.yml\u0026quot; ansible.","title":"vagrant+ansibleå®‰è£…k8sé›†ç¾¤"},{"content":" ç¯å¢ƒï¼šubuntu-20.04, kubernetes:v1.22.1\n 1. å®‰è£…docker  å®‰è£…æ—¶æœ‰å¯èƒ½ä¼šé‡åˆ°ç½‘ç»œé—®é¢˜ï¼Œä½ å¯ä»¥é€‰æ‹©æ¢æºæˆ–æ˜¯ä¸ºaptè®¾ç½®ä»£ç†ï¼Œè®¾ç½®ä»£ç†çš„æ–¹æ³•è§è¿™é‡Œ\n  æ›´æ–°æºé•œåƒå¹¶å®‰è£…ä¾èµ–  sudo apt-get update sudo apt-get install \\  apt-transport-https \\  ca-certificates \\  curl \\  gnupg \\  lsb-release å®‰è£…docker å®˜æ–¹GPGå¯†é’¥  curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg è®¾ç½®ç¨³å®šç‰ˆæœ¬  echo \\  \u0026#34;deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \\ $(lsb_release -cs)stable\u0026#34; | sudo tee /etc/apt/sources.list.d/docker.list \u0026gt; /dev/null å®‰è£…docker  sudo apt-get update sudo apt-get install docker-ce docker-ce-cli containerd.io å®‰è£…docker-compose(å¯é€‰)  sudo curl -L \u0026#34;https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)\u0026#34; -o /usr/local/bin/docker-compose sudo chmod +x /usr/local/bin/docker-compose 2. å®‰è£…kubectl, kubeadm, kubelet  æ›´æ–°æºé•œåƒå¹¶å®‰è£…ä¾èµ–  sudo apt-get update sudo apt-get install -y apt-transport-https ca-certificates curl ä¸‹è½½è°·æ­Œå…¬å…±ç­¾åå¯†é’¥   å¯¹äºcurl, å¯ä½¿ç”¨ -x , \u0026ndash;proxy \u0026lt;[protocol://][user:password@]proxyhost[:port]\u0026gt; æ¥è®¾ç½®ä»£ç†\n sudo curl -fsSLo /usr/share/keyrings/kubernetes-archive-keyring.gpg https://packages.cloud.google.com/apt/doc/apt-key.gpg å°†kuberneteså¢åŠ åˆ°aptä»“åº“  echo \u0026#34;deb [signed-by=/usr/share/keyrings/kubernetes-archive-keyring.gpg] https://apt.kubernetes.io/ kubernetes-xenial main\u0026#34; | sudo tee /etc/apt/sources.list.d/kubernetes.list æ›´æ–°è½¯ä»¶æºå¹¶å®‰è£…  sudo apt-get update sudo apt-get install -y kubelet kubeadm kubectl sudo apt-mark hold kubelet kubeadm kubectl 3. ä½¿ç”¨kubeadmå®‰è£…kubernetes kubeadm init  è¿™ä¸€æ­¥å›åˆ°Googleçš„é•œåƒä»“åº“æ‹‰å–ä¸€äº›é•œåƒï¼Œå¦‚æœæ‹‰å–ä¸åˆ°æˆ–è€…é€Ÿåº¦è¿‡æ…¢ï¼Œå¯ä½¿ç”¨é˜¿é‡Œçš„é•œåƒæº kubeadm init \u0026ndash;image-repository=registry.aliyuncs.com/google_containers\n è‹¥è¿™ä¸€æ­¥å¤±è´¥ï¼Œè°ƒæ•´è®¾ç½®é‡æ–°å¯åŠ¨ä¹‹å‰ï¼Œéœ€è¦å…ˆ\nkubeadm reset 4. é‡åˆ°çš„å‘ 4.1 swap è¦ç¡®ä¿swapå·²è¢«å…³é—­ ä½¿ç”¨free -mæŸ¥çœ‹swapå¤§å°\nfree -m ç¡®ä¿swapé‚£ä¸€è¡Œä¸º0\nå…³é—­swapæ–¹æ³•\nsudo swapoff -a sudo sed -i \u0026#39;/ swap / s/^/#/\u0026#39; /etc/fstab 4.2 cgourp-driver dockerçš„cgroup driveré»˜è®¤æ˜¯cgroupfsï¼Œéœ€è¦æ›´æ”¹ä¸ºsystemed\nä½¿ç”¨docker infoå‘½ä»¤æŸ¥çœ‹ï¼š å¦‚æœæ˜¾ç¤ºçš„æ˜¯cgroupfsï¼Œé‚£ä¹ˆéœ€è¦è¿›è¡Œæ›´æ”¹\næ”¹åŠ¨æ–¹æ³•ï¼š åˆ›å»º/etc/docker/daemon.jsonï¼Œç¼–è¾‘å†…å®¹ä¸ºï¼š\n{ \u0026#34;exec-opts\u0026#34;: [\u0026#34;native.cgroupdriver=systemd\u0026#34;] } ç„¶åé‡å¯dockeræœåŠ¡ï¼š\nsystemctl restart docker å†æ¬¡é‡è¯•ï¼š\nkubeadm reset kubeadm init 4.3 é˜¿é‡Œäº‘é•œåƒtagä¸å¯¹ è§£å†³æ–¹æ³•æ˜¯æ‹‰å–æœ€æ–°ç‰ˆæœ¬çš„é•œåƒï¼Œç„¶åæ›´æ”¹å…¶tag\ndocker pull registry.aliyuncs.com/google_container/coredns:latest docker tag registry.aliyuncs.com/google_container/coredns:latest registry.aliyuncs.com/google_container/coredns:v1.8.4 docker rmi registry.aliyuncs.com/google_container/coredns:latest 4.4 node NotReady å®‰è£…å®Œæˆåï¼Œä½¿ç”¨kubectl get nodesæŸ¥çœ‹å‘ç°çŠ¶æ€ä¸ºNotReady\nä½¿ç”¨kubectl describe ndoesæŸ¥çœ‹æŠ¥é”™ä¿¡æ¯ï¼Œæœ‰å¦‚ä¸‹è¾“å‡ºï¼Œå¯ä»¥çœ‹åˆ°é—®é¢˜æ˜¯network plugin is not ready: cni config uninitialized\n... Conditions: Type Status LastHeartbeatTime LastTransitionTime Reason Message ---- ------ ----------------- ------------------ ------ ------- MemoryPressure False Sat, 04 Sep 2021 10:16:25 +0800 Sat, 04 Sep 2021 09:15:45 +0800 KubeletHasSufficientMemory kubelet has sufficient memory available DiskPressure False Sat, 04 Sep 2021 10:16:25 +0800 Sat, 04 Sep 2021 09:15:45 +0800 KubeletHasNoDiskPressure kubelet has no disk pressure PIDPressure False Sat, 04 Sep 2021 10:16:25 +0800 Sat, 04 Sep 2021 09:15:45 +0800 KubeletHasSufficientPID kubelet has sufficient PID available Ready False Sat, 04 Sep 2021 10:16:25 +0800 Sat, 04 Sep 2021 09:15:45 +0800 KubeletNotReady container runtime network not ready: NetworkReady=false reason:NetworkPluginNotReady message:docker: network plugin is not ready: cni config uninitialized ... è§£å†³æ–¹æ³•ï¼š å®‰è£…weave\næ ¹æ®https://www.weave.works/docs/net/latest/kubernetes/kube-addon/ï¼Œåªéœ€è¿è¡Œå¦‚ä¸‹å‘½ä»¤:\nkubectl apply -f \u0026#34;https://cloud.weave.works/k8s/net?k8s-version=$(kubectl version | base64 | tr -d \u0026#39;\\n\u0026#39;)\u0026#34; å†æ¬¡æŸ¥çœ‹nodes\nkubectl get nodes çŠ¶æ€ä¸ºReady\n4.5 1 node(s) had taints that the pod didn\u0026rsquo;t tolerate: è¿™ä¸ªé—®é¢˜æ˜¯åœ¨åˆ›å»ºpodæ—¶å‡ºç°çš„\nè¿™æ˜¯å› ä¸ºkubernetesé»˜è®¤ä¸è®¸å¾€masterå®‰è£…ï¼Œå¼ºåˆ¶å…è®¸\nkubectl taint nodes --all node-role.kubernetes.io/master- ","permalink":"http://yangchnet.github.io/Dessert/posts/env/%E4%BD%BF%E7%94%A8kubeadm%E5%AE%89%E8%A3%85%E5%8D%95%E8%8A%82%E7%82%B9kubernetes/","summary":"ç¯å¢ƒï¼šubuntu-20.04, kubernetes:v1.22.1\n 1. å®‰è£…docker  å®‰è£…æ—¶æœ‰å¯èƒ½ä¼šé‡åˆ°ç½‘ç»œé—®é¢˜ï¼Œä½ å¯ä»¥é€‰æ‹©æ¢æºæˆ–æ˜¯ä¸ºaptè®¾ç½®ä»£ç†ï¼Œè®¾ç½®ä»£ç†çš„æ–¹æ³•è§è¿™é‡Œ\n  æ›´æ–°æºé•œåƒå¹¶å®‰è£…ä¾èµ–  sudo apt-get update sudo apt-get install \\  apt-transport-https \\  ca-certificates \\  curl \\  gnupg \\  lsb-release å®‰è£…docker å®˜æ–¹GPGå¯†é’¥  curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg è®¾ç½®ç¨³å®šç‰ˆæœ¬  echo \\  \u0026#34;deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \\ $(lsb_release -cs)stable\u0026#34; | sudo tee /etc/apt/sources.list.d/docker.list \u0026gt; /dev/null å®‰è£…docker  sudo apt-get update sudo apt-get install docker-ce docker-ce-cli containerd.","title":"ä½¿ç”¨kubeadmå®‰è£…å•èŠ‚ç‚¹Kubernetes"},{"content":"1. ä¸´æ—¶è®¾ç½® sudo apt-get -o Acquire::http::proxy=\u0026#34;http://127.0.0.1:8000/\u0026#34; update 2. æ°¸ä¹…è®¾ç½® åˆ›å»º/etc/apt/apt.conf\ntouch /etc/apt/apt.conf å†™å…¥å¦‚ä¸‹å†…å®¹ï¼š\nAcquire::http::Proxy \u0026quot;http://yourproxyaddress:proxyport\u0026quot;; å¦‚æœproxyéœ€è¦å¯†ç ï¼Œåˆ™æ ¼å¼å¦‚ä¸‹ï¼š\nAcquire::http::Proxy \u0026#34;http://username:password@yourproxyaddress:proxyport\u0026#34;; Reference: https://www.jianshu.com/p/fdae9cb5181b\nhttps://askubuntu.com/questions/257290/configure-proxy-for-apt\n","permalink":"http://yangchnet.github.io/Dessert/posts/linux/%E4%B8%BAapt%E8%AE%BE%E7%BD%AE%E4%BB%A3%E7%90%86/","summary":"1. ä¸´æ—¶è®¾ç½® sudo apt-get -o Acquire::http::proxy=\u0026#34;http://127.0.0.1:8000/\u0026#34; update 2. æ°¸ä¹…è®¾ç½® åˆ›å»º/etc/apt/apt.conf\ntouch /etc/apt/apt.conf å†™å…¥å¦‚ä¸‹å†…å®¹ï¼š\nAcquire::http::Proxy \u0026quot;http://yourproxyaddress:proxyport\u0026quot;; å¦‚æœproxyéœ€è¦å¯†ç ï¼Œåˆ™æ ¼å¼å¦‚ä¸‹ï¼š\nAcquire::http::Proxy \u0026#34;http://username:password@yourproxyaddress:proxyport\u0026#34;; Reference: https://www.jianshu.com/p/fdae9cb5181b\nhttps://askubuntu.com/questions/257290/configure-proxy-for-apt","title":"ä¸ºaptè®¾ç½®ä»£ç†"},{"content":"apiVersionå¯èƒ½çš„å­—æ®µå€¼ï¼š    Kind apiVersion     CertificateSigningRequest certificates.k8s.io/v1beta1   ClusterRoleBinding rbac.authorization.k8s.io/v1   ClusterRole rbac.authorization.k8s.io/v1   ComponentStatus v1   ConfigMap v1   ControllerRevision apps/v1   CronJob batch/v1beta1   DaemonSet extensions/v1beta1   Deployment extensions/v1beta1   Endpoints v1   Event v1   HorizontalPodAutoscaler autoscaling/v1   Ingress extensions/v1beta1   Job batch/v1   LimitRange v1   Namespace v1   NetworkPolicy extensions/v1beta1   Node v1   PersistentVolumeClaim v1   PersistentVolume v1   PodDisruptionBudget policy/v1beta1   Pod v1   PodSecurityPolicy extensions/v1beta1   PodTemplate v1   ReplicaSet extensions/v1beta1   ReplicationController v1   ResourceQuota v1   RoleBinding rbac.authorization.k8s.io/v1   Role rbac.authorization.k8s.io/v1   Secret v1   ServiceAccount v1   Service v1   StatefulSet apps/v1    æ¯ä¸ªå­—æ®µçš„æ„ä¹‰ alpha\nè¿™ä¸ªapiVersionæ˜¯æ—©æœŸå€™é€‰ç‰ˆæœ¬ï¼Œå¯èƒ½åŒ…å«ä¸€äº›bug\nbeta\nå·²ç»è¿‡alphaç‰ˆæœ¬çš„ä½¿ç”¨ï¼Œæœªæ¥å°†ä¼šçœŸæ­£åŒ…å«åˆ°kubernetesä¸­ï¼Œä½†å…¶å·¥ä½œæ–¹å¼å¯èƒ½ä¼šå‘ç”Ÿä¸€äº›æ”¹å˜\nstable\nå¯ä»¥å®‰å…¨ä½¿ç”¨çš„ç‰ˆæœ¬\nv1\nkubernetesç¬¬ä¸€ä¸ªç¨³å®šçš„å‘å¸ƒç‰ˆæœ¬ï¼ŒåŒ…å«è®¸å¤šæ ¸å¿ƒå¯¹è±¡\napps/v1\nappsæ˜¯kubernetesä¸­æœ€å¸¸è§çš„APiç»„ï¼Œè®¸å¤šæ ¸å¿ƒå¯¹è±¡éƒ½æ˜¯ä»è¿™é‡Œå’Œv1ä¸­æå–å‡ºæ¥çš„ã€‚å®ƒåŒ…æ‹¬ä¸€äº›ä¸kubernetesè¿è¡Œç›¸å…³çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ï¼šDeployments, RollingUpdates, ReplicaSetç­‰\nautoscaling/v1\nè¿™ä¸ªAPiç‰ˆæœ¬å…è®¸podsæ ¹æ®ä¸åŒçš„èµ„æºä½¿ç”¨æŒ‡æ ‡è‡ªåŠ¨ç¼©æ”¾ï¼Œ\nbatch/v1\nbatchAPIç»„åŒ…å«ä¸æ‰¹å¤„ç†åŠç±»ä¼¼ä½œä¸šä»»åŠ¡ç›¸å…³çš„å¯¹è±¡ã€‚\nbatch/v1beta1\nbatchåŠŸèƒ½å¯¹è±¡çš„betaç‰ˆæœ¬ï¼ŒåŒ…å«CronJobï¼ˆè½®è¯¢ä»»åŠ¡ï¼‰\nextensions/v1beta1\næ­¤ç‰ˆæœ¬çš„ API åŒ…æ‹¬ Kubernetes çš„è®¸å¤šæ–°çš„ã€å¸¸ç”¨çš„åŠŸèƒ½ã€‚ Deploymentsã€DaemonSetsã€ReplicaSets å’Œ Ingresses åœ¨æ­¤ç‰ˆæœ¬ä¸­éƒ½å‘ç”Ÿäº†é‡å¤§å˜åŒ–ã€‚\nè¯·æ³¨æ„ï¼Œåœ¨ Kubernetes 1.6 ä¸­ï¼Œå…¶ä¸­ä¸€äº›å¯¹è±¡ä»æ‰©å±•é‡æ–°å®šä½åˆ°ç‰¹å®š API ç»„ï¼ˆä¾‹å¦‚åº”ç”¨ç¨‹åºï¼‰ã€‚ å½“è¿™äº›å¯¹è±¡é€€å‡º Beta ç‰ˆæ—¶ï¼Œå¸Œæœ›å®ƒä»¬ä½äºç‰¹å®šçš„ API ç»„ä¸­ï¼Œä¾‹å¦‚ apps/v1ã€‚ ä½¿ç”¨ extensions/v1beta1 å·²è¢«å¼ƒç”¨â€”â€”æ ¹æ®æ‚¨çš„ Kubernetes é›†ç¾¤ç‰ˆæœ¬ï¼Œå°½å¯èƒ½å°è¯•ä½¿ç”¨ç‰¹å®šçš„ API ç»„ã€‚\npolicy/v1beta1\næ­¤ apiVersion å¢åŠ äº†è®¾ç½® pod ä¸­æ–­é¢„ç®—å’Œæœ‰å…³ pod å®‰å…¨æ€§çš„æ–°è§„åˆ™çš„åŠŸèƒ½ã€‚\nrbac.authorization.k8s.io/v1 æ­¤ apiVersion åŒ…æ‹¬åŸºäº Kubernetes è§’è‰²çš„è®¿é—®æ§åˆ¶çš„é¢å¤–åŠŸèƒ½ã€‚ è¿™æœ‰åŠ©äºæ‚¨ä¿æŠ¤é›†ç¾¤\næŸ¥çœ‹å¯ç”¨çš„apiVersion kubectl api-versions admissionregistration.k8s.io/v1 admissionregistration.k8s.io/v1beta1 apiextensions.k8s.io/v1 apiextensions.k8s.io/v1beta1 apiregistration.k8s.io/v1 apiregistration.k8s.io/v1beta1 apps/v1 authentication.k8s.io/v1 authentication.k8s.io/v1beta1 authorization.k8s.io/v1 authorization.k8s.io/v1beta1 autoscaling/v1 autoscaling/v2beta1 autoscaling/v2beta2 batch/v1 batch/v1beta1 certificates.k8s.io/v1 certificates.k8s.io/v1beta1 coordination.k8s.io/v1 coordination.k8s.io/v1beta1 discovery.k8s.io/v1 discovery.k8s.io/v1beta1 events.k8s.io/v1 events.k8s.io/v1beta1 extensions/v1beta1 flowcontrol.apiserver.k8s.io/v1beta1 networking.k8s.io/v1 networking.k8s.io/v1beta1 node.k8s.io/v1 node.k8s.io/v1beta1 policy/v1 policy/v1beta1 rbac.authorization.k8s.io/v1 rbac.authorization.k8s.io/v1beta1 scheduling.k8s.io/v1 scheduling.k8s.io/v1beta1 storage.k8s.io/v1 storage.k8s.io/v1beta1 v1 Translated from: https://matthewpalmer.net/kubernetes-app-developer/articles/kubernetes-apiversion-definition-guide.html\n","permalink":"http://yangchnet.github.io/Dessert/posts/container/k8s%E4%B8%AD%E7%9A%84apiversion/","summary":"apiVersionå¯èƒ½çš„å­—æ®µå€¼ï¼š    Kind apiVersion     CertificateSigningRequest certificates.k8s.io/v1beta1   ClusterRoleBinding rbac.authorization.k8s.io/v1   ClusterRole rbac.authorization.k8s.io/v1   ComponentStatus v1   ConfigMap v1   ControllerRevision apps/v1   CronJob batch/v1beta1   DaemonSet extensions/v1beta1   Deployment extensions/v1beta1   Endpoints v1   Event v1   HorizontalPodAutoscaler autoscaling/v1   Ingress extensions/v1beta1   Job batch/v1   LimitRange v1   Namespace v1   NetworkPolicy extensions/v1beta1   Node v1   PersistentVolumeClaim v1   PersistentVolume v1   PodDisruptionBudget policy/v1beta1   Pod v1   PodSecurityPolicy extensions/v1beta1   PodTemplate v1   ReplicaSet extensions/v1beta1   ReplicationController v1   ResourceQuota v1   RoleBinding rbac.","title":"k8sä¸­çš„apiVersion"},{"content":"1. å®‰è£…sqlc go get github.com/kyleconroy/sqlc/cmd/sqlc 2. åŸºæœ¬ä½¿ç”¨ å»ºç«‹åŸºæœ¬é¡¹ç›®ç»“æ„ mkdir sqlc-demo cd sqlc-demo go mod init sqlc-demo åœ¨sqlc-demoä¸­å»ºç«‹å¦‚ä¸‹ç›®å½•ç»“æ„ï¼š\n. â”œâ”€â”€ db â”‚Â â”œâ”€â”€ queries â”‚Â â”œâ”€â”€ schema â”‚Â â””â”€â”€ sqlc â””â”€â”€ go.mod å…¶ä¸­queryä¸­å­˜å‚¨æŸ¥è¯¢è¯­å¥ï¼Œschemaä¸­å­˜å‚¨æ•°æ®åº“è¡¨ç»“æ„ï¼Œsqlcä¸­å­˜å‚¨ç”Ÿæˆçš„ä»£ç ã€‚\nåŸºæœ¬è¡¨ç»“æ„  sqlc-demo/db/schema/table.sql\n CREATE TABLE \u0026#34;accounts\u0026#34; ( \u0026#34;id\u0026#34; bigserial PRIMARY KEY, \u0026#34;owner\u0026#34; varchar NOT NULL, \u0026#34;balance\u0026#34; bigint NOT NULL, \u0026#34;currency\u0026#34; varchar NOT NULL, \u0026#34;created_at\u0026#34; timestamptz NOT NULL DEFAULT (now()) ); CREATE TABLE \u0026#34;entries\u0026#34; ( \u0026#34;id\u0026#34; bigserial PRIMARY KEY, \u0026#34;account_id\u0026#34; bigint NOT NULL, \u0026#34;amount\u0026#34; bigint NOT NULL, \u0026#34;created_at\u0026#34; timestamptz NOT NULL DEFAULT (now()) ); CREATE TABLE \u0026#34;transfers\u0026#34; ( \u0026#34;id\u0026#34; bigserial PRIMARY KEY, \u0026#34;from_account_id\u0026#34; bigint NOT NULL, \u0026#34;to_account_id\u0026#34; bigint NOT NULL, \u0026#34;amount\u0026#34; bigint NOT NULL, \u0026#34;created_at\u0026#34; timestamptz NOT NULL DEFAULT (now()) ); é…ç½®æ–‡ä»¶  sqlc-demo/sqlc.yaml\n version: 1 packages: - name: \u0026#34;db\u0026#34; # ç”Ÿæˆæ–‡ä»¶çš„åŒ…å path: \u0026#34;db/sqlc\u0026#34; # ç”Ÿæˆçš„æ–‡ä»¶ä½ç½® engine: \u0026#34;postgresql\u0026#34; # æ•°æ®åº“é©±åŠ¨å¼•æ“ schema: \u0026#34;./db/schema/\u0026#34; # æ•°æ®åº“è¡¨ç»“æ„ queries: \u0026#34;./db/queries\u0026#34; # æŸ¥è¯¢è¯­å¥ä½ç½® æŸ¥è¯¢è¯­å¥ ç°åœ¨æœ‰äº†è¡¨ç»“æ„å’Œé…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹æ ¹æ®ä¸šåŠ¡éœ€è¦ä¹¦å†™æŸ¥è¯¢è¯­å¥äº†ã€‚\n sqlc-demo/db/queries/account.sql\n -- name: CreateAccount :one INSERT INTO accounts ( owner, balance, currency ) VALUES ( $1, $2, $3 ) RETURNING *; åœ¨ä¸Šé¢è¿™ä¸ªæŸ¥è¯¢è¯­å¥ä¸­ï¼Œç¬¬ä¸€è¡Œæ³¨é‡Šæ˜¯ä¸ºsqlcåšçš„æ ‡è®°ï¼Œå‘Šè¯‰sqlcï¼Œè¦ç”Ÿæˆçš„å‡½æ•°åå­—ä¸ºCreateAccount, è¿”å›å•ä¸ªå¯¹è±¡ã€‚\nç”Ÿæˆä»£ç   sqlc-demo/Makefile\n sqlc: sqlc generate .PHONY: sqlc æŸ¥çœ‹sqlc-demo/db/sqlc/æ–‡ä»¶å¤¹ä¸‹ï¼Œç”Ÿæˆäº†ä¸‰ä¸ªæ–‡ä»¶ï¼š\n. â”œâ”€â”€ db â”‚Â â”œâ”€â”€ queries â”‚Â â”‚Â â””â”€â”€ account.sql â”‚Â â”œâ”€â”€ schema â”‚Â â”‚Â â””â”€â”€ table.sql â”‚Â â””â”€â”€ sqlc â”‚Â â”œâ”€â”€ account.sql.go â”‚Â â”œâ”€â”€ db.go â”‚Â â””â”€â”€ models.go â”œâ”€â”€ go.mod â”œâ”€â”€ Makefile â””â”€â”€ sqlc.yaml å…¶ä¸­ï¼Œaccount.sql.goä¸­åŒ…å«æœ‰ç”Ÿæˆçš„CreateAccountå‡½æ•°:\nfunc (q *Queries) CreateAccount(ctx context.Context, arg CreateAccountParams) (Account, error) { row := q.db.QueryRowContext(ctx, createAccount, arg.Owner, arg.Balance, arg.Currency) var i Account err := row.Scan( \u0026amp;i.ID, \u0026amp;i.Owner, \u0026amp;i.Balance, \u0026amp;i.Currency, \u0026amp;i.CreatedAt, ) return i, err } è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥éå¸¸æ–¹ä¾¿çš„é€šè¿‡golangå‡½æ•°è°ƒç”¨çš„æ–¹å¼å®Œæˆæ“ä½œæ•°æ®åº“çš„ä»»åŠ¡ã€‚\nä½¿ç”¨ func run() error { ctx := context.Background() psql_db, err := sql.Open(\u0026#34;postgres\u0026#34;, \u0026#34;user=pqgotest dbname=pqgotest sslmode=verify-full\u0026#34;) if err != nil { return err } queries := db.New(psql_db) // create an author \tinsertedAccount, err := queries.CreateAccount(ctx, db.CreateAccountParams{ Owner: \u0026#34;name\u0026#34;, Balance: 0, Currency: \u0026#34;RMB\u0026#34;, }) if err != nil { return err } log.Println(insertedAccount) return nil 3. æ³¨é‡Š è¦æƒ³è®©sqlcä¸ºä½ ç”Ÿæˆä»£ç ï¼Œéœ€è¦åœ¨æŸ¥è¯¢è¯­å¥çš„ä¸Šæ–¹å†™ä¸Šä¸€è¡Œæ³¨é‡Šï¼Œå…¶æ ¼å¼ä¸ºï¼š\n-- name: \u0026lt;name\u0026gt; \u0026lt;command\u0026gt; å…¶ä¸­, æ˜¯ä½ æƒ³è¦ç”Ÿæˆå‡½æ•°çš„åå­—ï¼Œåˆ™æ˜¯å¯¹ç”Ÿæˆå‡½æ•°çš„è¿”å›åšç®€å•çš„è®¾ç½®\n :exec  :execä½¿å‡½æ•°åªæ‰§è¡ŒæŸ¥è¯¢è¯­å¥ï¼Œä½†ä¸è¿”å›ä»»ä½•å€¼ï¼ˆé™¤errorå¤–ï¼‰\n-- name: DeleteAuthor :exec DELETE FROM authors WHERE id = $1; func (q *Queries) DeleteAuthor(ctx context.Context, id int64) error { _, err := q.db.ExecContext(ctx, deleteAuthor, id) return err } :execresult :execresultä½¿å‡½æ•°è¿”å›ä¸€ä¸ªsql.Resultæ¥å£ï¼Œå…¶æ¥å£å®šä¹‰å¦‚ä¸‹ï¼š  type Result interface { // LastInsertId returns the integer generated by the database \t// in response to a command. Typically this will be from an \t// \u0026#34;auto increment\u0026#34; column when inserting a new row. Not all \t// databases support this feature, and the syntax of such \t// statements varies. \tLastInsertId() (int64, error) // RowsAffected returns the number of rows affected by an \t// update, insert, or delete. Not every database or database \t// driver may support this. \tRowsAffected() (int64, error) } -- name: DeleteAllAuthors :execresult DELETE FROM authors; func (q *Queries) DeleteAllAuthors(ctx context.Context) (sql.Result, error) { return q.db.ExecContext(ctx, deleteAllAuthors) } :execrows :execrowsä½¿å‡½æ•°è¿”å›å—è¯¥æŸ¥è¯¢è¯­å¥å½±å“çš„è¡Œ  -- name: DeleteAllAuthors :execrows DELETE FROM authors; func (q *Queries) DeleteAllAuthors(ctx context.Context) (int64, error) { _, err := q.db.ExecContext(ctx, deleteAllAuthors) // ... } :many :manyä½¿å‡½æ•°è¿”å›ä¸€ä¸ªåˆ‡ç‰‡  -- name: ListAuthors :many SELECT * FROM authors ORDER BY name; func (q *Queries) ListAuthors(ctx context.Context) ([]Author, error) { rows, err := q.db.QueryContext(ctx, listAuthors) // ... } :one :oneä½¿å‡½æ•°è¿”å›å•ä¸ªå¯¹è±¡  -- name: GetAuthor :one SELECT * FROM authors WHERE id = $1 LIMIT 1; func (q *Queries) GetAuthor(ctx context.Context, id int64) (Author, error) { row := q.db.QueryRowContext(ctx, getAuthor, id) // ... } 4. é…ç½®æ–‡ä»¶ version: \u0026#34;1\u0026#34; packages: - name: \u0026#34;db\u0026#34; # ç”Ÿæˆä»£ç çš„åŒ…å path: \u0026#34;internal/db\u0026#34; # ç”Ÿæˆä»£ç çš„ä½ç½® queries: \u0026#34;./sql/query/\u0026#34; # æŸ¥è¯¢è¯­å¥çš„ä½ç½® schema: \u0026#34;./sql/schema/\u0026#34; # æ•°æ®åº“è¡¨çš„ä½ç½® engine: \u0026#34;postgresql\u0026#34; # æ•°æ®åº“å¼•æ“ emit_prepared_queries: true # å¼€å¯é¢„æŸ¥è¯¢æ”¯æŒï¼Œé»˜è®¤ä¸ºfalse emit_interface: false # å¦‚æœä¸ºtrueï¼Œåˆ™ä¼šç”Ÿæˆä¸€ä¸ªQuerieræ¥å£ï¼ŒåŒ…å«æ‰€æœ‰æŸ¥è¯¢æ–¹æ³•ï¼Œé»˜è®¤ä¸ºfalse emit_exact_table_names: false # å¦‚æœä¸ºtrueï¼Œåˆ™ç»“æ„ä½“ä¼šä¸è¡¨åç›¸åŒï¼Œå¦åˆ™å°†ä¼šå¯¹å¤æ•°è¡¨åè¿›è¡Œå•æ•°åŒ–ï¼Œé»˜è®¤ä¸ºfalse emit_empty_slices: false # å¦‚æœä¸ºtrueï¼Œåˆ™:manyæ ‡ç­¾è‹¥æŸ¥è¯¢ä¸ºç©ºä¼šè¿”å›[]è€Œä¸æ˜¯nil, é»˜è®¤ä¸ºfalse emit_exported_queries: false # å¦‚æœä¸ºtrueï¼Œåˆ™ç”Ÿæˆçš„å‡½æ•°ä¸ºå¯å¯¼å‡ºçš„ emit_json_tags: true # å¦‚æœä¸ºtrueï¼Œåˆ™ä¸ºç”Ÿæˆçš„ç»“æ„ä½“å¢åŠ jsonæ ‡ç­¾ json_tags_case_style: \u0026#34;camel\u0026#34; # jsonæ ‡ç­¾çš„é£æ ¼ï¼Œ\u0026#34;camel\u0026#34;ï¼šcamelCaseï¼Œ\u0026#34;pascal\u0026#34;:PascalCase, \u0026#34;snake\u0026#34;: snake_case output_db_file_name: \u0026#34;db.go\u0026#34; # è‡ªå®šä¹‰dbæ–‡ä»¶çš„åå­— output_models_file_name: \u0026#34;models.go\u0026#34; # è‡ªå®šä¹‰modelæ–‡ä»¶çš„åå­— output_querier_file_name: \u0026#34;querier.go\u0026#34; # è‡ªå®šä¹‰querieræ–‡ä»¶çš„åå­— ","permalink":"http://yangchnet.github.io/Dessert/posts/golang/orm%E4%B9%8Bsqlc/","summary":"1. å®‰è£…sqlc go get github.com/kyleconroy/sqlc/cmd/sqlc 2. åŸºæœ¬ä½¿ç”¨ å»ºç«‹åŸºæœ¬é¡¹ç›®ç»“æ„ mkdir sqlc-demo cd sqlc-demo go mod init sqlc-demo åœ¨sqlc-demoä¸­å»ºç«‹å¦‚ä¸‹ç›®å½•ç»“æ„ï¼š\n. â”œâ”€â”€ db â”‚Â â”œâ”€â”€ queries â”‚Â â”œâ”€â”€ schema â”‚Â â””â”€â”€ sqlc â””â”€â”€ go.mod å…¶ä¸­queryä¸­å­˜å‚¨æŸ¥è¯¢è¯­å¥ï¼Œschemaä¸­å­˜å‚¨æ•°æ®åº“è¡¨ç»“æ„ï¼Œsqlcä¸­å­˜å‚¨ç”Ÿæˆçš„ä»£ç ã€‚\nåŸºæœ¬è¡¨ç»“æ„  sqlc-demo/db/schema/table.sql\n CREATE TABLE \u0026#34;accounts\u0026#34; ( \u0026#34;id\u0026#34; bigserial PRIMARY KEY, \u0026#34;owner\u0026#34; varchar NOT NULL, \u0026#34;balance\u0026#34; bigint NOT NULL, \u0026#34;currency\u0026#34; varchar NOT NULL, \u0026#34;created_at\u0026#34; timestamptz NOT NULL DEFAULT (now()) ); CREATE TABLE \u0026#34;entries\u0026#34; ( \u0026#34;id\u0026#34; bigserial PRIMARY KEY, \u0026#34;account_id\u0026#34; bigint NOT NULL, \u0026#34;amount\u0026#34; bigint NOT NULL, \u0026#34;created_at\u0026#34; timestamptz NOT NULL DEFAULT (now()) ); CREATE TABLE \u0026#34;transfers\u0026#34; ( \u0026#34;id\u0026#34; bigserial PRIMARY KEY, \u0026#34;from_account_id\u0026#34; bigint NOT NULL, \u0026#34;to_account_id\u0026#34; bigint NOT NULL, \u0026#34;amount\u0026#34; bigint NOT NULL, \u0026#34;created_at\u0026#34; timestamptz NOT NULL DEFAULT (now()) ); é…ç½®æ–‡ä»¶  sqlc-demo/sqlc.","title":"ORMä¹‹sqlc"},{"content":" migrateæ˜¯ä¸€ä¸ªgolangå†™æˆçš„æ•°æ®åº“ç‰ˆæœ¬è¿ç§»å·¥å…·ï¼Œå¯ä»¥ç”¨æ¥æ–¹ä¾¿çš„å¯¹æ•°æ®åº“è¿›è¡Œè¿ç§»å’Œå›é€€ã€‚ Githubä¸Šæœ‰è¯¦ç»†çš„æ•™ç¨‹ç­‰ï¼šhttps://github.com/golang-migrate/migrate\n  åœ¨å®‰è£…æ—¶å¯èƒ½éœ€è¦æŒ‡å®šæ‰€ç”¨çš„é©±åŠ¨ï¼Œå¦åˆ™ä¼šå› ç¼ºå°‘é©±åŠ¨æ— æ³•è¿æ¥æ•°æ®åº“ï¼Œä¾‹å¦‚go install -tags mysql github.com/golang-migrate/migrate/v4/cmd/migrate\n  å»ºç«‹ç›®å½•  mkdir -p migrate-demo/db cd migrate-demo/db mkdir ddl mkdir -p schema/blog ç°åœ¨migrate-demoç›®å½•ä¸‹ç»“æ„å¦‚ä¸‹ï¼š\n. â””â”€â”€ db â”œâ”€â”€ ddl â””â”€â”€ schema â””â”€â”€ blog å…¶ä¸­ï¼Œddlä¸­å­˜å‚¨å»ºåº“çš„sqlæ–‡ä»¶ï¼Œschemaå­˜æ”¾å»ºè¡¨çš„sqlæ–‡ä»¶\nå»ºåº“  å»ºåº“\nvim db/ddl/blog.sql CREATE DATABASE IF NOT EXISTS blog DEFAULT CHARACTER SET utf8mb4 DEFAULT COLLATE utf8mb4_unicode_ci; buildé•œåƒ  ç¼–å†™Dockerfile\nvim db/Dockerfile FROMmysql:5.7COPY ./ddl /docker-entrypoint-initdb.d/ENV MYSQL_ROOT_PASSWORD=admin123 å¤åˆ¶åˆ°/docker-entrypoint-initdb.dç›®å½•ä¸‹çš„sqlè„šæœ¬ä¼šè¢«è‡ªåŠ¨æ‰§è¡Œ\ndocker build -t mysql-demo -f ./Dockerfile . buildæˆåŠŸåï¼Œä½¿ç”¨docker imageså‘½ä»¤æŸ¥çœ‹é•œåƒï¼š\nREPOSITORY TAG IMAGE ID CREATED SIZE mysql-demo latest 6a2faae69a6f 26 minutes ago 447MB å¯åŠ¨é•œåƒå¹¶æŸ¥çœ‹  docker run --name mysql -p 13306:3306 -d mysql-demo è¿›å…¥å®¹å™¨æŸ¥çœ‹æ•°æ®åº“\ndocker exec -it mysql /bin/sh å¯ä»¥çœ‹åˆ°ï¼Œblogè¡¨å·²è¢«åˆ›å»º\nä½¿ç”¨migrateè¿›è¡Œæ•°æ®åº“è¿ç§»  ç”Ÿæˆsqlè„šæœ¬æ–‡ä»¶\nmigrate create -ext sql -dir db/blog -seq create_blog_table ä¼šåœ¨db/blogç›®å½•ä¸‹ç”Ÿæˆ000001_create_blog_table.down.sql, 000001_create_blog_table.up.sqlï¼Œå…¶åç¼€ååˆ†åˆ«ä¸ºup.sql, down.sqlã€‚\nup.sqlæ–‡ä»¶æ˜¯ä½ è¦æ‰§è¡Œçš„æ“ä½œï¼Œdown.sqlä¸­æ˜¯è¿™ä¸ªæ“ä½œçš„é€†æ“ä½œã€‚\nå»ºè¡¨\nvim schema/blog/000001_create_blog_table.up.sql.sql CREATE TABLE `blog_article` ( `id` integer PRIMARY KEY NOT NULL, `tag_id` integer DEFAULT 0, `title` varchar(100) DEFAULT null, `desc` varchar(255) DEFAULT null, `content` text, `created_on` timestamp DEFAULT CURRENT_TIMESTAMP, `created_by` varchar(100) DEFAULT null, `modified_on` timestamp DEFAULT CURRENT_TIMESTAMP, `modified_by` varchar(100) DEFAULT null, `deleted_on` timestamp DEFAULT CURRENT_TIMESTAMP, ); vim schema/blog/000001_create_blog_table.down.sql.sql DROP table IF EXISTS blog_article; ç°åœ¨çš„ç›®å½•ç»“æ„ï¼š\n. â””â”€â”€ db â”œâ”€â”€ ddl â”‚Â â””â”€â”€ blog.sql â”œâ”€â”€ Dockerfile â””â”€â”€ schema â””â”€â”€ blog â”œâ”€â”€ 000001_create_blog_table.down.sql â””â”€â”€ 000001_create_blog_table.up.sql migrate æ‰§è¡Œæ•°æ®åº“è¿ç§»  migrate -source=file://db/schema/blog -database \u0026#34;mysql://root:admin123@tcp(localhost:13306)/blog\u0026#34; -verbose up å†æ¬¡è¿›å…¥å®¹å™¨æŸ¥çœ‹æ•°æ®åº“ ","permalink":"http://yangchnet.github.io/Dessert/posts/golang/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86-migrate/","summary":"migrateæ˜¯ä¸€ä¸ªgolangå†™æˆçš„æ•°æ®åº“ç‰ˆæœ¬è¿ç§»å·¥å…·ï¼Œå¯ä»¥ç”¨æ¥æ–¹ä¾¿çš„å¯¹æ•°æ®åº“è¿›è¡Œè¿ç§»å’Œå›é€€ã€‚ Githubä¸Šæœ‰è¯¦ç»†çš„æ•™ç¨‹ç­‰ï¼šhttps://github.com/golang-migrate/migrate\n  åœ¨å®‰è£…æ—¶å¯èƒ½éœ€è¦æŒ‡å®šæ‰€ç”¨çš„é©±åŠ¨ï¼Œå¦åˆ™ä¼šå› ç¼ºå°‘é©±åŠ¨æ— æ³•è¿æ¥æ•°æ®åº“ï¼Œä¾‹å¦‚go install -tags mysql github.com/golang-migrate/migrate/v4/cmd/migrate\n  å»ºç«‹ç›®å½•  mkdir -p migrate-demo/db cd migrate-demo/db mkdir ddl mkdir -p schema/blog ç°åœ¨migrate-demoç›®å½•ä¸‹ç»“æ„å¦‚ä¸‹ï¼š\n. â””â”€â”€ db â”œâ”€â”€ ddl â””â”€â”€ schema â””â”€â”€ blog å…¶ä¸­ï¼Œddlä¸­å­˜å‚¨å»ºåº“çš„sqlæ–‡ä»¶ï¼Œschemaå­˜æ”¾å»ºè¡¨çš„sqlæ–‡ä»¶\nå»ºåº“  å»ºåº“\nvim db/ddl/blog.sql CREATE DATABASE IF NOT EXISTS blog DEFAULT CHARACTER SET utf8mb4 DEFAULT COLLATE utf8mb4_unicode_ci; buildé•œåƒ  ç¼–å†™Dockerfile\nvim db/Dockerfile FROMmysql:5.7COPY ./ddl /docker-entrypoint-initdb.d/ENV MYSQL_ROOT_PASSWORD=admin123 å¤åˆ¶åˆ°/docker-entrypoint-initdb.dç›®å½•ä¸‹çš„sqlè„šæœ¬ä¼šè¢«è‡ªåŠ¨æ‰§è¡Œ\ndocker build -t mysql-demo -f ./Dockerfile . buildæˆåŠŸåï¼Œä½¿ç”¨docker imageså‘½ä»¤æŸ¥çœ‹é•œåƒï¼š","title":"æ•°æ®åº“ç‰ˆæœ¬ç®¡ç†-migrate"},{"content":"1. docker for wsl2 åœ¨wsl2ä¸­ä½¿ç”¨dockerçš„æœ€ä½³å®è·µä¸æ˜¯åœ¨wsl2ä¸­å®‰è£…dockerï¼Œè€Œæ˜¯å®‰è£…docker desktopï¼š\nä»dockerå®˜ç½‘ä¸‹è½½å¹¶å®‰è£…å®Œæˆåï¼Œæ‰“å¼€docker desktopï¼Œé€‰æ‹©setting-\u0026gt;Generalï¼Œç¡®ä¿Use the WSL 2 based engineé€‰é¡¹è¢«å‹¾é€‰ï¼Œç„¶åé€‰æ‹©å³ä¸‹è§’Apply\u0026amp;Restartã€‚\né‡å¯docker desktopåï¼Œå†æ¬¡æ‰“å¼€è®¾ç½®ï¼Œç¡®ä¿setting-\u0026gt;Resources-\u0026gt;WSL INTEGRATIONé€‰é¡¹é¡µä¸­ä½ çš„WSLå‘è¡Œç‰ˆè¢«å‹¾é€‰ã€‚\nå®Œæˆä»¥ä¸Šæ­¥éª¤ä¹‹åï¼Œæ‰“å¼€ä½ çš„wsl, è¾“å…¥dockerï¼š å‡ºç°è¿™ä¸€å †è¯´æ˜å®‰è£…æˆåŠŸã€‚\nä½¿ç”¨docker run helloworldéªŒè¯ä½ çš„dockerå¯ä»¥æ­£å¸¸å¯åŠ¨å®¹å™¨ã€‚\n å¦‚æœè¾“å…¥dockerå‘½ä»¤åæ— æ³•å¯åŠ¨ï¼Œå¯ä»¥å°è¯•sudo docker\n 2. k8s for wsl2 å®‰è£…äº†docker desktopåï¼Œå¯ä»¥é€šè¿‡setting-\u0026gt;Kubernetesï¼Œå‹¾é€‰Enable Kubernetesæ¥ä¸ºä½ çš„wslæä¾›k8sæœåŠ¡ï¼Œä½†ç”±äºç½‘ç»œé—®é¢˜ï¼Œé€šå¸¸ä¸å¯èƒ½æˆåŠŸã€‚\næ‰€ä»¥æˆ‘ä»¬è¦\u0026quot;æ¢æº\u0026quot;ã€‚\næ‰“å¼€setting-\u0026gt;Docker Engineï¼Œå°†å³ä¾§é…ç½®æ–‡ä»¶æ”¹ä¸ºï¼š\n{ \u0026#34;registry-mirrors\u0026#34;: [ \u0026#34;https://docker.mirrors.ustc.edu.cn\u0026#34;, \u0026#34;https://registry.docker-cn.com\u0026#34; ], \u0026#34;insecure-registries\u0026#34;: [], \u0026#34;debug\u0026#34;: false, \u0026#34;experimental\u0026#34;: false, \u0026#34;features\u0026#34;: { \u0026#34;buildkit\u0026#34;: true } } Apply\u0026amp;Restartï¼Œé‡å¯docker desktopã€‚\nç°åœ¨æˆ‘ä»¬è¿˜éœ€è¦ä¸€äº›é¢å¤–çš„é•œåƒã€‚ clone AliyunContainerService/k8s-for-docker-desktop è¿™ä¸ªé¡¹ç›®ã€‚\ngit clone https://github.com/AliyunContainerService/k8s-for-docker-desktop.git æŸ¥çœ‹è‡ªå·±çš„docker desktopä¸ŠKubernetesçš„ç‰ˆæœ¬ã€‚\nå¯ä»¥çœ‹åˆ°æˆ‘ä»¬è¿™é‡Œæ˜¯v1.21.2ã€‚ç›¸åº”çš„ï¼Œæˆ‘ä»¬è¿›å…¥åˆšæ‰cloneçš„æ–‡ä»¶å¤¹ä¸‹ï¼Œåˆ‡æ¢åˆ°v1.21.2åˆ†æ”¯\ngit checkout v1.21.2 åˆ‡æ¢åˆ†æ”¯åï¼Œåœ¨å½“å‰ç›®å½•ä¸‹æ‰§è¡Œï¼š\n.\\load_images.ps1  å¦‚æœå› ä¸ºå®‰å…¨ç­–ç•¥æ— æ³•æ‰§è¡Œ PowerShell è„šæœ¬ï¼Œè¯·åœ¨ â€œä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œâ€ çš„ PowerShell ä¸­æ‰§è¡Œ Set-ExecutionPolicy RemoteSigned å‘½ä»¤\n æœ€åä¸€æ­¥ï¼Œsetting-\u0026gt;Kubernetes ç¡®ä¿Enable Kubernetesè¢«å‹¾é€‰ï¼Œç„¶åApply\u0026amp;Restartï¼Œè¿™æ—¶å€™ä½ çš„docker desktopå·¦ä¸‹è§’ä¼šå‡ºç°k8sçš„å›¾æ ‡ï¼Œå¹¶é€æ¸ä»é»„è‰²å˜æˆç»¿è‰²ï¼Œä»£è¡¨ä½ çš„k8sç¯å¢ƒå¯åŠ¨æˆåŠŸã€‚\nReferences Get started with Docker remote containers on WSL 2 Docker Desktop WSL 2 backend AliyunContainerService/k8s-for-docker-desktop åœ¨ Docker Desktop ä¸­å¯ç”¨ K8s æœåŠ¡\n","permalink":"http://yangchnet.github.io/Dessert/posts/env/wsl2-%E4%B8%8D%E8%BE%93mac%E7%9A%84%E5%BC%80%E5%8F%91%E4%BD%93%E9%AA%8C%E4%B8%89wsl2%E4%B8%AD%E4%BD%BF%E7%94%A8dockerk8s/","summary":"1. docker for wsl2 åœ¨wsl2ä¸­ä½¿ç”¨dockerçš„æœ€ä½³å®è·µä¸æ˜¯åœ¨wsl2ä¸­å®‰è£…dockerï¼Œè€Œæ˜¯å®‰è£…docker desktopï¼š\nä»dockerå®˜ç½‘ä¸‹è½½å¹¶å®‰è£…å®Œæˆåï¼Œæ‰“å¼€docker desktopï¼Œé€‰æ‹©setting-\u0026gt;Generalï¼Œç¡®ä¿Use the WSL 2 based engineé€‰é¡¹è¢«å‹¾é€‰ï¼Œç„¶åé€‰æ‹©å³ä¸‹è§’Apply\u0026amp;Restartã€‚\né‡å¯docker desktopåï¼Œå†æ¬¡æ‰“å¼€è®¾ç½®ï¼Œç¡®ä¿setting-\u0026gt;Resources-\u0026gt;WSL INTEGRATIONé€‰é¡¹é¡µä¸­ä½ çš„WSLå‘è¡Œç‰ˆè¢«å‹¾é€‰ã€‚\nå®Œæˆä»¥ä¸Šæ­¥éª¤ä¹‹åï¼Œæ‰“å¼€ä½ çš„wsl, è¾“å…¥dockerï¼š å‡ºç°è¿™ä¸€å †è¯´æ˜å®‰è£…æˆåŠŸã€‚\nä½¿ç”¨docker run helloworldéªŒè¯ä½ çš„dockerå¯ä»¥æ­£å¸¸å¯åŠ¨å®¹å™¨ã€‚\n å¦‚æœè¾“å…¥dockerå‘½ä»¤åæ— æ³•å¯åŠ¨ï¼Œå¯ä»¥å°è¯•sudo docker\n 2. k8s for wsl2 å®‰è£…äº†docker desktopåï¼Œå¯ä»¥é€šè¿‡setting-\u0026gt;Kubernetesï¼Œå‹¾é€‰Enable Kubernetesæ¥ä¸ºä½ çš„wslæä¾›k8sæœåŠ¡ï¼Œä½†ç”±äºç½‘ç»œé—®é¢˜ï¼Œé€šå¸¸ä¸å¯èƒ½æˆåŠŸã€‚\næ‰€ä»¥æˆ‘ä»¬è¦\u0026quot;æ¢æº\u0026quot;ã€‚\næ‰“å¼€setting-\u0026gt;Docker Engineï¼Œå°†å³ä¾§é…ç½®æ–‡ä»¶æ”¹ä¸ºï¼š\n{ \u0026#34;registry-mirrors\u0026#34;: [ \u0026#34;https://docker.mirrors.ustc.edu.cn\u0026#34;, \u0026#34;https://registry.docker-cn.com\u0026#34; ], \u0026#34;insecure-registries\u0026#34;: [], \u0026#34;debug\u0026#34;: false, \u0026#34;experimental\u0026#34;: false, \u0026#34;features\u0026#34;: { \u0026#34;buildkit\u0026#34;: true } } Apply\u0026amp;Restartï¼Œé‡å¯docker desktopã€‚\nç°åœ¨æˆ‘ä»¬è¿˜éœ€è¦ä¸€äº›é¢å¤–çš„é•œåƒã€‚ clone AliyunContainerService/k8s-for-docker-desktop è¿™ä¸ªé¡¹ç›®ã€‚\ngit clone https://github.com/AliyunContainerService/k8s-for-docker-desktop.git æŸ¥çœ‹è‡ªå·±çš„docker desktopä¸ŠKubernetesçš„ç‰ˆæœ¬ã€‚\nå¯ä»¥çœ‹åˆ°æˆ‘ä»¬è¿™é‡Œæ˜¯v1.21.2ã€‚ç›¸åº”çš„ï¼Œæˆ‘ä»¬è¿›å…¥åˆšæ‰cloneçš„æ–‡ä»¶å¤¹ä¸‹ï¼Œåˆ‡æ¢åˆ°v1.21.2åˆ†æ”¯\ngit checkout v1.21.2 åˆ‡æ¢åˆ†æ”¯åï¼Œåœ¨å½“å‰ç›®å½•ä¸‹æ‰§è¡Œï¼š","title":"WSL2-ä¸è¾“Macçš„å¼€å‘ä½“éªŒï¼ˆä¸‰ï¼‰ï¼šWSL2ä¸­ä½¿ç”¨docker\u0026k8s"},{"content":"1. ä»£ç†æœåŠ¡ 1.1 è·å–Windowsä¸»æœºipå¹¶ä½¿ç”¨å…¶ä»£ç† å¯ä»¥åœ¨wslä¸­å®‰è£…ä»£ç†è½¯ä»¶ï¼Œä½†å¦‚æœwinä¸»æœºä¸Šä¹Ÿæœ‰ä»£ç†è½¯ä»¶çš„è¯ï¼Œä¼šæ„Ÿè§‰æœ‰ç‚¹ä¹±ã€‚è¿™é‡Œè®©wslä½¿ç”¨ä¸»æœºçš„ä»£ç†ã€‚\næˆ‘ä½¿ç”¨çš„ä»£ç†è½¯ä»¶æ˜¯clashï¼Œè¿™é‡Œé¦–å…ˆè¦ç¡®ä¿clashå…è®¸å±€åŸŸç½‘\nç¡®è®¤å®Œclashæ”¯æŒå±€åŸŸç½‘åï¼Œæˆ‘ä»¬æ¥çœ‹å¦‚ä½•ä»wslä¸­è·å–winä¸»æœºçš„ipåœ°å€ã€‚ åœ¨Windowsä¸»æœºä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ipconfigå‘½ä»¤æ¥æŸ¥çœ‹æœ¬åœ°çš„ipåœ°å€\nipconfig å¦‚å›¾æ‰€ç¤ºï¼Œå‘½ä»¤è¡Œè¾“å‡ºäº†åœ¨wslç½‘ç»œä¸­Winä¸»æœºçš„ipåœ°å€ã€‚ï¼ˆwslå’Œwindowså¤„äºä¸€ä¸ªç½‘ç»œä¸­ï¼Œè¿™é‡Œå¾—åˆ°çš„æ˜¯windowsåœ¨è¿™ä¸ªç½‘ç»œä¸­çš„ipåœ°å€ï¼‰ã€‚\nå¦‚æœæˆ‘ä»¬æƒ³ä½¿ç”¨windowsçš„ä»£ç†ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤(åœ¨wslä¸­)ï¼š\nexport ALL_PROXY=\u0026#34;http://172.28.48.1:7890\u0026#34; è¿™é‡Œï¼Œ 172.28.48.1æ˜¯Windowsåœ¨è¿™ä¸ªç½‘ç»œä¸­çš„ipåœ°å€ï¼Œ7890æ˜¯ä»£ç†æ¥å£ã€‚\né€šè¿‡è®¿é—®googleæŸ¥çœ‹æ˜¯å¦ä»£ç†æˆåŠŸï¼š 1.2 ä½¿ç”¨è„šæœ¬è‡ªåŠ¨è·å–ipåœ°å€å¹¶è®¾ç½®ä»£ç† é€šè¿‡1.1æˆ‘ä»¬çŸ¥é“ï¼Œå¯ä»¥åœ¨Windowsä¸»æœºä¸­è·å–å…¶åœ¨wslç½‘ç»œä¸­çš„ipåœ°å€ï¼Œé‚£æˆ‘ä»¬æ˜¯å¦å¯ä»¥åœ¨wslä¸­è·å–åˆ°è¿™ä¸ªåœ°å€å‘¢ï¼Ÿ\ncat /etc/resolv.conf å¾—åˆ°ç±»ä¼¼ä¸‹é¢çš„è¾“å‡ºï¼š\n# This file was automatically generated by WSL. To stop automatic generation of this file, add the following entry to /etc/wsl.conf: # [network] # generateResolvConf = false nameserver 172.28.48.1 è¿™é‡Œçš„nameserverï¼Œæ˜¯ä¸æ˜¯å°±å’Œæˆ‘ä»¬åœ¨Windowsä¸‹è·å–åˆ°çš„ipåœ°å€æ˜¯ä¸€æ ·çš„ã€‚\næˆ‘ä»¬é€šè¿‡ä¸€ä¸ªè„šæœ¬æ¥è‡ªåŠ¨è·å–åˆ°è¿™ä¸ªipåœ°å€ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸ºä»£ç†åœ°å€ï¼š\n#!/bin/bash host_ip=$(cat /etc/resolv.conf |grep \u0026#34;nameserver\u0026#34; |cut -f 2 -d \u0026#34; \u0026#34;) # è·å–ipåœ°å€ echo $host_ip # è¾“å‡ºipåœ°å€ export ALL_PROXY=\u0026#34;http://$host_ip:7890\u0026#34; # è®¾ç½®ä»£ç†ï¼Œ7890ä¸ºæˆ‘çš„ä»£ç†ç«¯å£ curl -I https://www.google.com # å°è¯•è®¿é—®Google, éªŒè¯ä»£ç†çš„æœ‰æ•ˆæ€§ å°†è¿™ä¸ªè„šæœ¬ç§»åŠ¨åˆ°æŸä¸ªç›®å½•ä¸‹ï¼Œä¾‹å¦‚æˆ‘å°†å…¶æ”¾åœ¨/opt/proxy/proxy.sh\nå†ä¸ºå…¶è®¾ç½®ä¸€ä¸ªå¿«æ·å¯åŠ¨æ–¹å¼ï¼š\nvim ~/.bashrc åœ¨~/.bashrcæœ€åè¾“å…¥ä¸‹è¡Œ\nalias proxy=/opt/proxy/proxy.sh source ~/.bashrc ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨proxyå‘½ä»¤æ¥ä¸€é”®è®¾ç½®ä»£ç†äº† 2. ä»windowsä¸»æœºè®¿é—®wsl2 2.1 è·å–WSLçš„ipåœ°å€ å½“æˆ‘ä»¬ä½¿ç”¨WSL2æ—¶ï¼Œwslå’ŒWindowsç›¸å½“äºä¸¤å°å¤„äºä¸€ä¸ªç½‘ç»œä¸­ä½†åˆ†è´ç‹¬ç«‹çš„ä¸»æœºï¼ˆæˆ‘ä»¬ç§°è¿™ä¸ªç½‘ç»œä¸ºWSLç½‘ç»œï¼‰ã€‚åœ¨Windowsä¸»æœºä¸Šä½¿ç”¨ipconfigæˆ‘ä»¬å¯ä»¥çœ‹åˆ°Windowsä¸»æœºåœ¨WSLç½‘ç»œä¸­çš„åœ°å€ï¼Œç›¸åº”çš„ï¼Œåœ¨wslä¸­æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ifconfigå‘½ä»¤æ¥æŸ¥çœ‹wslåœ¨WSLç½‘ç»œä¸­çš„åœ°å€ã€‚\nifconfig å…¶ä¸­çš„eth0å°±æ˜¯wslåœ¨WSLç½‘ç»œä¸­çš„IPåœ°å€ï¼Œè¿™é‡Œä¸ºï¼š172.28.62.74\næ‰“å¼€Windowsæ–‡ä»¶å¤¹ï¼Œå®šä½åˆ°C:\\Windows\\System32\\drivers\\etc\\hostsè¿™ä¸ªæ–‡ä»¶ï¼Œåœ¨å…¶æœ€åä¸€è¡ŒåŠ ä¸Šï¼š\n172.28.62.74 wsl #wsl2 dns config é…ç½®å®Œæˆä¹‹åï¼Œä½ å°±å¯ä»¥ä½¿ç”¨wslåŸŸåæ¥ç›´æ¥è®¿é—®wslä¸­çš„æœåŠ¡ã€‚å¦‚ï¼šhttps://wsl:8080/indexã€‚ï¼ˆå¦‚æœä½ çš„8080ç«¯å£æœ‰æœåŠ¡ç›‘å¬çš„è¯ï¼‰ã€‚\n2.2 ä½¿ç”¨è„šæœ¬è‡ªåŠ¨ä¸ºwindowsé…ç½®dns #!/bin/bash HOSTS_FILE_WIN=\u0026#39;/mnt/c/Windows/System32/drivers/etc/hosts\u0026#39; inetIp=`ifconfig eth0 | grep -o \u0026#34;inet [0-9]*\\.[0-9]*\\.[0-9]*\\.[0-9]* netmask\u0026#34; | cut -f 2 -d \u0026#34; \u0026#34;` # è·å–æœ¬æœºip nu=`cat -n ${HOSTS_FILE_WIN} | grep wsl2 | awk \u0026#39;{print $1}\u0026#39;` # è·å–å·²è®¾ç½®dnsè¡Œå· dnsIp=`cat ${HOSTS_FILE_WIN} | grep -o \u0026#34;[0-9]*\\.[0-9]*\\.[0-9]*\\.[0-9]* wsl #\u0026#34; | cut -f 1 -d \u0026#34; \u0026#34;` # è·å–å·²è®¾ç½®dns ip echo \u0026#34;wsl\u0026#39;s ip is: ${inetIp}\u0026#34; # set -x set -e if [ ${nu} ] # è‹¥å·²è®¾ç½® then if [ ${inetIp} != ${dnsIp} ] # å·²è®¾ç½®dnsä¸æ­£ç¡® then echo reset sed -i \u0026#34;${nu}d\u0026#34; ${HOSTS_FILE_WIN} # åˆ é™¤å¯¹åº”è¡Œ echo \u0026#34;${inetIp}wsl #wsl2 dns config\u0026#34; \u0026gt;\u0026gt; ${HOSTS_FILE_WIN} # é‡æ–°è®¾ç½® fi else # æœªè®¾ç½® echo \u0026#34;${inetIp}wsl #wsl2 dns config\u0026#34; \u0026gt;\u0026gt; ${HOSTS_FILE_WIN} # ç›´æ¥è®¾ç½® fi åŒæ ·ï¼Œå°†è¿™ä¸ªè„šæœ¬ä¿å­˜åˆ°/opt/dns/dns.shï¼Œç„¶åä¸ºå…¶è®¾ç½®åˆ«åï¼ˆå¿«æ·å¯åŠ¨ï¼‰alias dns=\u0026quot;/opt/dns/dns.sh\u0026quot;ã€‚\nå½“éœ€è¦ä»Windowsè®¿é—®wslä¸­çš„æœåŠ¡æ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨dnså‘½ä»¤æ¥è®¾ç½®ä¸ºé€šè¿‡ä½¿ç”¨wslåŸŸåæ¥è®¿é—®ã€‚\n å…³äºè¿™ä¸ªè„šæœ¬ï¼Œæˆ‘è¿˜å®ç°äº†golangç‰ˆæœ¬ï¼Œå¹¶ç¼–è¯‘å‡ºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä½ å¯ä»¥ç›´æ¥ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶æ”¾åœ¨ä½ çš„/usr/local/binç›®å½•ä¸‹é¢ï¼Œåœ¨éœ€è¦çš„æ—¶å€™ä½¿ç”¨å‘½ä»¤ä¸€é”®è®¾ç½®dns. åœ°å€åœ¨è¿™é‡Œï¼šhttps://github.com/yangchnet/wsl-Ip\n 2.3 é‡åˆ°è®¿é—®æƒé™é—®é¢˜æ€ä¹ˆåŠ å¦‚æœé‡åˆ°å› æƒé™é—®é¢˜ä¸èƒ½æ›´æ”¹æ–‡ä»¶ï¼Œå¯æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ›´æ”¹C:\\Windows\\System32\\drivers\\etc\\hostsæ–‡ä»¶æƒé™ å³å‡»æ–‡ä»¶ï¼Œé€‰æ‹©å±æ€§ï¼Œé€‰æ‹©å®‰å…¨é€‰é¡¹å¡ï¼Œç‚¹å‡»ç¼–è¾‘æ¥æ›´æ”¹æ–‡ä»¶æƒé™\nä¸ºUserå¢åŠ å†™å…¥æƒé™ ç‚¹å‡»ç¡®å®šä¿å­˜é€€å‡ºã€‚\nè¿™æ—¶å€™ï¼Œå¯ä»¥åœ¨wslä¸­cdè¿›å…¥/mnt/c/Windows/System32/drivers/etcï¼Œä½¿ç”¨llå‘½ä»¤æŸ¥çœ‹hostsæ–‡ä»¶çš„æƒé™ å¯ä»¥çœ‹åˆ°ï¼Œå¯¹äºhostsæ–‡ä»¶ï¼Œå·²ç»æœ‰äº†å†™æƒé™\n","permalink":"http://yangchnet.github.io/Dessert/posts/env/wsl2-%E4%B8%8D%E8%BE%93mac%E7%9A%84%E5%BC%80%E5%8F%91%E4%BD%93%E9%AA%8C%E4%BA%8Cwsl2%E7%9A%84%E7%BD%91%E7%BB%9C%E9%97%AE%E9%A2%98/","summary":"1. ä»£ç†æœåŠ¡ 1.1 è·å–Windowsä¸»æœºipå¹¶ä½¿ç”¨å…¶ä»£ç† å¯ä»¥åœ¨wslä¸­å®‰è£…ä»£ç†è½¯ä»¶ï¼Œä½†å¦‚æœwinä¸»æœºä¸Šä¹Ÿæœ‰ä»£ç†è½¯ä»¶çš„è¯ï¼Œä¼šæ„Ÿè§‰æœ‰ç‚¹ä¹±ã€‚è¿™é‡Œè®©wslä½¿ç”¨ä¸»æœºçš„ä»£ç†ã€‚\næˆ‘ä½¿ç”¨çš„ä»£ç†è½¯ä»¶æ˜¯clashï¼Œè¿™é‡Œé¦–å…ˆè¦ç¡®ä¿clashå…è®¸å±€åŸŸç½‘\nç¡®è®¤å®Œclashæ”¯æŒå±€åŸŸç½‘åï¼Œæˆ‘ä»¬æ¥çœ‹å¦‚ä½•ä»wslä¸­è·å–winä¸»æœºçš„ipåœ°å€ã€‚ åœ¨Windowsä¸»æœºä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ipconfigå‘½ä»¤æ¥æŸ¥çœ‹æœ¬åœ°çš„ipåœ°å€\nipconfig å¦‚å›¾æ‰€ç¤ºï¼Œå‘½ä»¤è¡Œè¾“å‡ºäº†åœ¨wslç½‘ç»œä¸­Winä¸»æœºçš„ipåœ°å€ã€‚ï¼ˆwslå’Œwindowså¤„äºä¸€ä¸ªç½‘ç»œä¸­ï¼Œè¿™é‡Œå¾—åˆ°çš„æ˜¯windowsåœ¨è¿™ä¸ªç½‘ç»œä¸­çš„ipåœ°å€ï¼‰ã€‚\nå¦‚æœæˆ‘ä»¬æƒ³ä½¿ç”¨windowsçš„ä»£ç†ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤(åœ¨wslä¸­)ï¼š\nexport ALL_PROXY=\u0026#34;http://172.28.48.1:7890\u0026#34; è¿™é‡Œï¼Œ 172.28.48.1æ˜¯Windowsåœ¨è¿™ä¸ªç½‘ç»œä¸­çš„ipåœ°å€ï¼Œ7890æ˜¯ä»£ç†æ¥å£ã€‚\né€šè¿‡è®¿é—®googleæŸ¥çœ‹æ˜¯å¦ä»£ç†æˆåŠŸï¼š 1.2 ä½¿ç”¨è„šæœ¬è‡ªåŠ¨è·å–ipåœ°å€å¹¶è®¾ç½®ä»£ç† é€šè¿‡1.1æˆ‘ä»¬çŸ¥é“ï¼Œå¯ä»¥åœ¨Windowsä¸»æœºä¸­è·å–å…¶åœ¨wslç½‘ç»œä¸­çš„ipåœ°å€ï¼Œé‚£æˆ‘ä»¬æ˜¯å¦å¯ä»¥åœ¨wslä¸­è·å–åˆ°è¿™ä¸ªåœ°å€å‘¢ï¼Ÿ\ncat /etc/resolv.conf å¾—åˆ°ç±»ä¼¼ä¸‹é¢çš„è¾“å‡ºï¼š\n# This file was automatically generated by WSL. To stop automatic generation of this file, add the following entry to /etc/wsl.conf: # [network] # generateResolvConf = false nameserver 172.28.48.1 è¿™é‡Œçš„nameserverï¼Œæ˜¯ä¸æ˜¯å°±å’Œæˆ‘ä»¬åœ¨Windowsä¸‹è·å–åˆ°çš„ipåœ°å€æ˜¯ä¸€æ ·çš„ã€‚\næˆ‘ä»¬é€šè¿‡ä¸€ä¸ªè„šæœ¬æ¥è‡ªåŠ¨è·å–åˆ°è¿™ä¸ªipåœ°å€ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸ºä»£ç†åœ°å€ï¼š\n#!/bin/bash host_ip=$(cat /etc/resolv.conf |grep \u0026#34;nameserver\u0026#34; |cut -f 2 -d \u0026#34; \u0026#34;) # è·å–ipåœ°å€ echo $host_ip # è¾“å‡ºipåœ°å€ export ALL_PROXY=\u0026#34;http://$host_ip:7890\u0026#34; # è®¾ç½®ä»£ç†ï¼Œ7890ä¸ºæˆ‘çš„ä»£ç†ç«¯å£ curl -I https://www.","title":"WSL2-ä¸è¾“Macçš„å¼€å‘ä½“éªŒï¼ˆäºŒï¼‰ï¼šWSL2çš„ç½‘ç»œé—®é¢˜"},{"content":"1. å®‰è£…pm2 npm install pm2 -g æˆ–\nyarn global add pm2 ä½¿ç”¨pm2 -væŸ¥çœ‹ç‰ˆæœ¬å·\n2. åŸºæœ¬ä½¿ç”¨ 2.1 å¯åŠ¨åº”ç”¨ pm2 start app.js # ä¸æ­¢æ˜¯jsæ–‡ä»¶ï¼Œå…¶ä»–å¯æ‰§è¡Œæ–‡ä»¶ä¹Ÿå¯ä»¥æ‰§è¡Œ pm2 start script.sh # å¯åŠ¨bashè„šæœ¬ pm2 start python3 -- app.py # -- åè·Ÿè¦ä¼ ç»™å‘½ä»¤çš„å‚æ•° pm2 start binary -- -port 8080 åœ¨å¯åŠ¨åº”ç”¨æ—¶è¿˜æœ‰ä¸€äº›å‚æ•°\n--name \u0026lt;app_name\u0026gt; # ä¸ºåº”ç”¨è®¾ç½®ä¸€ä¸ªåå­— --watch # ç›‘è§†æºæ–‡ä»¶å¹¶åœ¨æºæ–‡ä»¶å­˜åœ¨æ›´æ”¹æ—¶é‡å¯åº”ç”¨ --max-memory-restart \u0026lt;200MB\u0026gt; # è®¾ç½®åº”ç”¨å ç”¨å†…å­˜ä¸Šé™ --log \u0026lt;log_path\u0026gt; # è®¾ç½®logæ–‡ä»¶è·¯å¾„ -- arg1 arg2 arg3 # ä¼ é€’å‚æ•° --restart-delay \u0026lt;delay in ms\u0026gt; # é‡å¯å‰å»¶æ—¶ --time åœ¨æ—¥å¿—å‰å¢åŠ æ—¶é—´æˆ³ --no-autorestart # ä¸è¦è‡ªåŠ¨é‡å¯ 2.2 ç®¡ç†åº”ç”¨ pm2 restart app_name pm2 reload app_name pm2 stop app_name pm2 delete app_name é™¤äº†ä½¿ç”¨app_nameï¼Œè¿˜å¯ä»¥ä½¿ç”¨åº”ç”¨çš„id, æˆ–ä½¿ç”¨allæ¥æ‰¹é‡ç®¡ç†æ‰€æœ‰åº”ç”¨\n2.3 åˆ—å‡ºè¢«ç®¡ç†çš„åº”ç”¨ pm2 list|ls|status 2.4 æ‰“å°log pm2 log æ‰“å°æœ€åä¸¤ç™¾è¡Œï¼š\npm2 log --line 200 2.5 æ˜¾ç¤ºç›‘æ§ pm2 monit 3. ecosystems.config.js \u0026ndash; ä½¿ç”¨é…ç½®æ–‡ä»¶å¯åŠ¨åº”ç”¨ 3.1 åŸºæœ¬ä½¿ç”¨ ç”Ÿæˆä¸€ä¸ªç¤ºä¾‹æ–‡ä»¶\npm2 init simple ç”Ÿæˆçš„ç¤ºä¾‹æ–‡ä»¶å¦‚ä¸‹ï¼š\nmodule.exports = { apps : [{ name : \u0026#34;app1\u0026#34;, script : \u0026#34;./app.js\u0026#34; }] } ä¸Šé¢çš„é…ç½®æ–‡ä»¶ä¸­å®šä¹‰äº†ä¸€ä¸ªæœ€ç®€å•çš„åº”ç”¨ï¼Œå…¶nameä¸ºapp1, å¯åŠ¨æ–¹å¼ä¸º./app.js\nç®¡ç†åº”ç”¨ï¼š\npm2 start ecosystem.config.js # å¯åŠ¨åº”ç”¨ pm2 stop ecosystem.config.js # åœæ­¢åº”ç”¨ pm2 restart ecosystem.config.js # é‡å¯åº”ç”¨ pm2 reload ecosystem.config.js # é‡æ–°åŠ è½½åº”ç”¨ pm2 delete ecosystem.config.js # åˆ é™¤åº”ç”¨ å¦‚æœä½ çš„é…ç½®æ–‡ä»¶ä¸­é…ç½®äº†å¤šä¸ªæ–‡ä»¶ï¼Œé‚£ä»–çœ‹èµ·æ¥å¯èƒ½é•¿è¿™æ ·ï¼š\nmodule.exports = { apps : [ { name : \u0026#34;app1\u0026#34;, script : \u0026#34;./app1.js\u0026#34; }, { name: \u0026#34;app2\u0026#34;, script : \u0026#34;./app2.js\u0026#34; }, { name: \u0026#34;app3\u0026#34;, script : \u0026#34;./app3.js\u0026#34; }, { name: \u0026#34;app4\u0026#34;, script : \u0026#34;./app4.js\u0026#34; } ] } å¦‚æœæƒ³è¦å•ç‹¬ç®¡ç†é…ç½®æ–‡ä»¶ä¸­çš„æŸï¼ˆå‡ ï¼‰ä¸ªåº”ç”¨ï¼Œå¯ä»¥ä½¿ç”¨--onlyå‚æ•°\npm2 stop ecosystem.config.js --only app1 # åªåœæ­¢app1 pm2 delete ecosystem.config.js --only \u0026#34;app1,app2\u0026#34; # åªåˆ é™¤app1å’Œapp2 å½“ç„¶ä½ è¿˜å¯ä»¥ç”¨ä»–ä»¬çš„idæ¥ç®¡ç†\n3.2 é…ç½®ä¸åŒç¯å¢ƒ å¯èƒ½ä½ æœ‰å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒä¸¤ä¸ªç¯å¢ƒï¼Œè€ŒäºŒè€…åœ¨å¯åŠ¨æ—¶å¯èƒ½éœ€è¦ä¸åŒçš„ç¯å¢ƒå˜é‡ï¼ˆå¦‚æ•°æ®åº“èŠ‚ç‚¹ï¼‰ï¼Œé‚£ä¹ˆä½ å¯ä»¥ä¸ºæ¯ä¸ªåº”ç”¨é…ç½®env_*\nmodule.exports = { apps : [ { name : \u0026#34;app1\u0026#34;, script : \u0026#34;./app.js\u0026#34;, env_production: { NODE_ENV: \u0026#34;production\u0026#34;, SQL_ENDPOINT: \u0026#34;192.168.11.11\u0026#34;, }, env_development: { NODE_ENV: \u0026#34;development\u0026#34;, SQL_ENDPOINT: \u0026#34;192.168.22.22\u0026#34;, } } ] } åœ¨è¿™ä¸ªé…ç½®æ–‡ä»¶ä¸­, å®šä¹‰äº†ä¸¤å¥—ç¯å¢ƒå˜é‡ï¼Œä½ å¯ä»¥é€‰æ‹©å…¶ä¸­ä¹‹ä¸€ç”¨æ¥å¯åŠ¨ä½ çš„åº”ç”¨\npm2 start ecosystem.config.js --env production # ä½¿ç”¨ç”Ÿäº§ç¯å¢ƒçš„ç¯å¢ƒå˜é‡ï¼Œå³ï¼šSQL_ENDPOINT = \u0026#34;192.168.11.11\u0026#34; pm2 start ecosystem.config.js --env development # ä½¿ç”¨å¼€å‘ç¯å¢ƒçš„ç¯å¢ƒå˜é‡ï¼Œå³ï¼šSQL_ENDPOINT = \u0026#34;192.168.22.22\u0026#34; 3.3 å…¶ä»–å‚æ•° åŸºæœ¬å‚æ•°\n   Field Type Example Description     name (string) â€œmy-apiâ€ application name (default to script filename without extension)   script (string) â€./api/app.jsâ€ script path relative to pm2 start   cwd (string) â€œ/var/www/â€ the directory from which your app will be launched   args (string) â€œ-a 13 -b 12â€ string containing all arguments passed via CLI to script   interpreter (string) â€œ/usr/bin/pythonâ€ interpreter absolute path (default to node)   interpreter_args (string) â€â€“harmonyâ€ option to pass to the interpreter   node_args (string)  alias to interpreter_args    é«˜çº§å‚æ•°\n   Field Type Example Description     instances number -1 number of app instance to be launched   exec_mode string â€œclusterâ€ mode to start your app, can be â€œclusterâ€ or â€œforkâ€, default fork   watch boolean or [] true enable watch \u0026amp; restart feature, if a file change in the folder or subfolder, your app will get reloaded   ignore_watch list [â€[/\\]./â€, â€œnode_modulesâ€] list of regex to ignore some file or folder names by the watch feature   max_memory_restart string â€œ150Mâ€ your app will be restarted if it exceeds the amount of memory specified. human-friendly format : it can be â€œ10Mâ€, â€œ100Kâ€, â€œ2Gâ€ and so onâ€¦   env object {â€œNODE_ENVâ€: â€œdevelopmentâ€, â€œIDâ€: â€œ42â€} env variables which will appear in your app   env_ object {â€œNODE_ENVâ€: â€œproductionâ€, â€œIDâ€: â€œ89â€} inject when doing pm2 restart app.yml \u0026ndash;env   source_map_support boolean true default to true, [enable/disable source map file]   instance_var string â€œNODE_APP_INSTANCEâ€ see documentation   filter_env array of string [ â€œREACT_â€ ] Excludes global variables starting with â€œREACT_â€ and will not allow their penetration into the cluster.    logé…ç½®    Field Type Example Description     log_date_format (string) â€œYYYY-MM-DD HH:mm Zâ€ log date format (see log section)   error_file (string)  error file path (default to $HOME/.pm2/logs/XXXerr.log)   out_file (string)  output file path (default to $HOME/.pm2/logs/XXXout.log)   combine_logs boolean true if set to true, avoid to suffix logs file with the process id   merge_logs boolean true alias to combine_logs   pid_file (string)  pid file path (default to $HOME/.pm2/pid/app-pm_id.pid)    æ§åˆ¶æµå‚æ•°\n   Field Type Example Description     min_uptime (string)  min uptime of the app to be considered started   listen_timeout number 8000 time in ms before forcing a reload if app not listening   kill_timeout number 1600 time in milliseconds before sending a final SIGKILL   shutdown_with_message boolean false shutdown an application with process.send(â€˜shutdownâ€™) instead of process.kill(pid, SIGINT)   wait_ready boolean false Instead of reload waiting for listen event, wait for process.send(â€˜readyâ€™)   max_restarts number 10 number of consecutive unstable restarts (less than 1sec interval or custom time via min_uptime) before your app is considered errored and stop being restarted   restart_delay number 4000 time to wait before restarting a crashed app (in milliseconds). defaults to 0.   autorestart boolean false true by default. if false, PM2 will not restart your app if it crashes or ends peacefully   cron_restart string â€œ1 0 * * *â€ a cron pattern to restart your app. Application must be running for cron feature to work   vizion boolean false true by default. if false, PM2 will start without vizion features (versioning control metadatas)   post_update list [â€œnpm installâ€, â€œecho launching the appâ€] a list of commands which will be executed after you perform a Pull/Upgrade operation from Keymetrics dashboard   force boolean true defaults to false. if true, you can start the same script several times which is usually not allowed by PM2    éƒ¨ç½²ç›¸å…³å‚æ•°\n   Entry name Description Type Default     key SSH key path String $HOME/.ssh   user SSH user String    host SSH host [String]    ssh_options SSH options with no command-line flag, see â€˜man sshâ€™ String or [String]    ref GIT remote/branch String    repo GIT remote String    path path in the server String    pre-setup Pre-setup command or path to a script on your local machine String    post-setup Post-setup commands or path to a script on the host machine String    pre-deploy-local pre-deploy action String    post-deploy post-deploy action String     References https://pm2.keymetrics.io/\n","permalink":"http://yangchnet.github.io/Dessert/posts/tool/pm2%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/","summary":"1. å®‰è£…pm2 npm install pm2 -g æˆ–\nyarn global add pm2 ä½¿ç”¨pm2 -væŸ¥çœ‹ç‰ˆæœ¬å·\n2. åŸºæœ¬ä½¿ç”¨ 2.1 å¯åŠ¨åº”ç”¨ pm2 start app.js # ä¸æ­¢æ˜¯jsæ–‡ä»¶ï¼Œå…¶ä»–å¯æ‰§è¡Œæ–‡ä»¶ä¹Ÿå¯ä»¥æ‰§è¡Œ pm2 start script.sh # å¯åŠ¨bashè„šæœ¬ pm2 start python3 -- app.py # -- åè·Ÿè¦ä¼ ç»™å‘½ä»¤çš„å‚æ•° pm2 start binary -- -port 8080 åœ¨å¯åŠ¨åº”ç”¨æ—¶è¿˜æœ‰ä¸€äº›å‚æ•°\n--name \u0026lt;app_name\u0026gt; # ä¸ºåº”ç”¨è®¾ç½®ä¸€ä¸ªåå­— --watch # ç›‘è§†æºæ–‡ä»¶å¹¶åœ¨æºæ–‡ä»¶å­˜åœ¨æ›´æ”¹æ—¶é‡å¯åº”ç”¨ --max-memory-restart \u0026lt;200MB\u0026gt; # è®¾ç½®åº”ç”¨å ç”¨å†…å­˜ä¸Šé™ --log \u0026lt;log_path\u0026gt; # è®¾ç½®logæ–‡ä»¶è·¯å¾„ -- arg1 arg2 arg3 # ä¼ é€’å‚æ•° --restart-delay \u0026lt;delay in ms\u0026gt; # é‡å¯å‰å»¶æ—¶ --time åœ¨æ—¥å¿—å‰å¢åŠ æ—¶é—´æˆ³ --no-autorestart # ä¸è¦è‡ªåŠ¨é‡å¯ 2.","title":"pm2ä½¿ç”¨æŒ‡å—"},{"content":"1. nvm install curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.38.0/install.sh | bash å®‰è£…å®Œæ¯•åä¼šæç¤ºä½ è®©ä½ å°†ä»¥ä¸‹å‘½ä»¤åŠ å…¥ä½ çš„é…ç½®æ–‡ä»¶ä¸­\nexport NVM_DIR=\u0026#34;$HOME/.nvm\u0026#34; [ -s \u0026#34;$NVM_DIR/nvm.sh\u0026#34; ] \u0026amp;\u0026amp; \\. \u0026#34;$NVM_DIR/nvm.sh\u0026#34; # This loads nvm [ -s \u0026#34;$NVM_DIR/bash_completion\u0026#34; ] \u0026amp;\u0026amp; \\. \u0026#34;$NVM_DIR/bash_completion\u0026#34; # This loads nvm bash_completion é»˜è®¤æƒ…å†µä¸‹ï¼Œå·²ç»åŠ å…¥ä½ çš„~/.bashrcæ–‡ä»¶ä¸­ï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯zshï¼Œé‚£ä¹ˆå°±éœ€è¦æ‰‹åŠ¨å°†å…¶æ·»åŠ åˆ°~/.zshrcä¸­\n2. å¸¸ç”¨æ“ä½œ   åˆ—å‡ºæœ¬åœ°æ‰€æœ‰npmç‰ˆæœ¬\nnvm ls   åˆ—å‡ºå¯è·å–çš„æ‰€æœ‰ç‰ˆæœ¬\nnvm ls-remote   å®‰è£…æŒ‡å®šç‰ˆæœ¬\nnvm install 14 # 14æ˜¯ç‰ˆæœ¬å·   æŒ‡å®šä½¿ç”¨æŸä¸ªç‰ˆæœ¬\nnvm use 14   ","permalink":"http://yangchnet.github.io/Dessert/posts/env/%E5%A4%9A%E7%89%88%E6%9C%ACnpm%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/","summary":"1. nvm install curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.38.0/install.sh | bash å®‰è£…å®Œæ¯•åä¼šæç¤ºä½ è®©ä½ å°†ä»¥ä¸‹å‘½ä»¤åŠ å…¥ä½ çš„é…ç½®æ–‡ä»¶ä¸­\nexport NVM_DIR=\u0026#34;$HOME/.nvm\u0026#34; [ -s \u0026#34;$NVM_DIR/nvm.sh\u0026#34; ] \u0026amp;\u0026amp; \\. \u0026#34;$NVM_DIR/nvm.sh\u0026#34; # This loads nvm [ -s \u0026#34;$NVM_DIR/bash_completion\u0026#34; ] \u0026amp;\u0026amp; \\. \u0026#34;$NVM_DIR/bash_completion\u0026#34; # This loads nvm bash_completion é»˜è®¤æƒ…å†µä¸‹ï¼Œå·²ç»åŠ å…¥ä½ çš„~/.bashrcæ–‡ä»¶ä¸­ï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯zshï¼Œé‚£ä¹ˆå°±éœ€è¦æ‰‹åŠ¨å°†å…¶æ·»åŠ åˆ°~/.zshrcä¸­\n2. å¸¸ç”¨æ“ä½œ   åˆ—å‡ºæœ¬åœ°æ‰€æœ‰npmç‰ˆæœ¬\nnvm ls   åˆ—å‡ºå¯è·å–çš„æ‰€æœ‰ç‰ˆæœ¬\nnvm ls-remote   å®‰è£…æŒ‡å®šç‰ˆæœ¬\nnvm install 14 # 14æ˜¯ç‰ˆæœ¬å·   æŒ‡å®šä½¿ç”¨æŸä¸ªç‰ˆæœ¬\nnvm use 14   ","title":"å¤šç‰ˆæœ¬npmè§£å†³æ–¹æ¡ˆ"},{"content":" ç”µå­æ•°æ®çš„è®¤å®šåŒ…å«3ä¸ªé‡è¦çš„éƒ¨åˆ†ï¼Œç§°ä¸ºâ€œä¸‰æ€§â€ï¼š\n çœŸå®æ€§ å…³è”æ€§ åˆæ³•æ€§   1. çœŸå®æ€§è®¤å®š ç”±äºç”µå­æ•°æ®å­˜è¯çš„ç‰¹æ®Šæ€§ï¼Œå…¶çœŸå®æ€§å¯ä»¥ä»ä¸‰ä¸ªä¸åŒçš„å±‚é¢æ¥è®¤å®šï¼š\n ç”µå­è¯æ®è½½ä½“çš„çœŸå®æ€§ ç”µå­æ•°æ®çš„çœŸå®æ€§ ç”µå­è¯æ®å†…å®¹çš„çœŸå®æ€§  1.1 ç”µå­è¯æ®è½½ä½“çš„çœŸå®æ€§ ç”µå­è¯æ®è½½ä½“çš„çœŸå®æ€§ï¼Œæ˜¯æŒ‡å­˜å‚¨ç”µå­æ•°æ®çš„åª’ä»‹ã€è®¾å¤‡åœ¨è¯‰è®¼è¿‡ç¨‹ä¸­ä¿æŒåŸå§‹æ€§ã€åŒä¸€æ€§ã€å®Œæ•´æ€§ï¼Œä¸å­˜åœ¨è¢«ä¼ªé€ ã€å˜é€ ã€æ›¿æ¢ã€ç ´åç­‰é—®é¢˜ã€‚ ä¸»è¦åŒ…æ‹¬ä¸¤ä¸ªæ–¹é¢çš„è¦æ±‚ï¼š\n ç”µå­è¯æ®è½½ä½“æ¥æºçš„çœŸå®æ€§ ç”µå­è¯æ®è½½ä½“åœ¨è¯‰è®¼å‰å’Œè¯‰è®¼æµè½¬è¿‡ç¨‹ä¸­çš„çœŸå®æ€§ã€‚  å…·ä½“æ¥è¯´ï¼Œæ³•å®˜å®¡æŸ¥ç”µå­è¯æ®æ—¶å¾€å¾€ä¼šå…³æ³¨ï¼šæäº¤çš„ç”µå­è¯æ®æ˜¯å¦åŒ…æ‹¬åŸå§‹å­˜å‚¨ä»‹è´¨ï¼ŒåŸå§‹å­˜å‚¨ä»‹è´¨çš„æ”¶é›†ç¨‹åºã€æ–¹å¼æ˜¯å¦ç¬¦åˆæ³•å¾‹è§„å®šå’Œæœ‰å…³è§„èŒƒï¼›å¦‚æœæ— æ³•æå–åŸå§‹å­˜å‚¨ä»‹è´¨ï¼Œå¦‚ä½•ç¡®ä¿å…¶ä»–å­˜å‚¨ä»‹è´¨èƒ½å¤Ÿä¿éšœç”µå­æ•°æ®çš„çœŸå®æ€§ã€‚ è¿™æ˜¯å¯¹ç”µå­è¯æ®è½½ä½“åŸå§‹æ€§å’ŒåŒä¸€æ€§çš„å®¡æŸ¥ã€‚\näºŒæ˜¯ç”µå­è¯æ®è½½ä½“åœ¨è¯‰è®¼å‰å’Œè¯‰è®¼ä¸­æµè½¬è¿‡ç¨‹ä¸­çš„çœŸå®æ€§ã€‚è¯‰è®¼å‰å’Œè¯‰è®¼ä¸­ï¼Œè¯æ®ä¼šåœ¨å¤šä¸ªä¸»ä½“ï¼ˆå¦‚åˆ‘äº‹æ¡ˆä»¶çš„å…¬ã€æ£€ã€æ³•å’Œæ°‘äº‹ã€è¡Œæ”¿æ¡ˆä»¶ä¸­åŸå‘Šã€æ³•é™¢ã€è¢«å‘Šï¼‰é—´æµè½¬ã€‚åœ¨æ­¤è¿‡ç¨‹ä¸­éœ€è¦è€ƒå¯Ÿï¼šç”µå­è¯æ®è½½ä½“åœ¨ç§»é€ã€ æµè½¬ä¸­æ˜¯å¦ä¿æŒåŒä¸€æ€§ï¼Œæ˜¯å¦ç¬¦åˆé‰´çœŸçš„è¦æ±‚ï¼›ç”µå­è¯æ®è½½ä½“æ˜¯å¦ä¿æŒå®Œæ•´æ€§ï¼Œæ²¡æœ‰è¢«æ”¹å˜ã€ç ´åç­‰ã€‚\nåŒºå—é“¾æŠ€æœ¯æå¤§åœ°æ‰©å±•äº†ç”µå­è¯æ®çš„è½½ä½“å¤–å»¶ï¼Œå¹¶å¯ä»¥ä»æŠ€æœ¯ä¸Šç¡®ä¿ç”µå­è¯æ®è½½ä½“çš„çœŸå®æ€§ã€‚å…·ä½“è€Œè¨€ï¼ŒåŒºå—é“¾å­˜è¯ä½¿ç”¨åˆ†å¸ƒå¼å­˜å‚¨å¹¶é™„åŠ é˜²ç¯¡æ”¹æ ¡éªŒæœºåˆ¶ï¼Œä½¿ç”µå­è¯æ®å¯ä»¥è„±ç¦»åŸå§‹å­˜å‚¨ä»‹è´¨è€Œ å®‰å…¨å­˜å‚¨ï¼ŒåŒæ—¶æ— è¢«ç¯¡æ”¹ä¹‹è™\nåŒºå—é“¾æŠ€æœ¯æœ‰æ•ˆè§£å†³äº†ç”µå­è¯æ®è½½ä½“çœŸå®æ€§è®¤å®šçš„é—®é¢˜ã€‚\n1.2 ç”µå­æ•°æ®çš„çœŸå®æ€§ ç”µå­æ•°æ®çš„çœŸå®æ€§é—®é¢˜ï¼Œæ˜¯æŒ‡ä½œä¸ºç”µå­è¯æ®ä¿¡æ¯åœ¨æŠ€æœ¯å±‚é¢çš„å­˜åœ¨å½¢å¼çš„ç”µå­æ•°æ®æ˜¯å¦çœŸå®ï¼Œæ˜¯å¦ä¸åŸå§‹æ•°æ®ä¿æŒä¸€è‡´ï¼Œæ˜¯å¦å­˜åœ¨è¢«ä¿®æ”¹ã€åˆ é™¤ã€å¢åŠ ç­‰é—®é¢˜ã€‚\nç”µå­æ•°æ®çš„çœŸå®æ€§ï¼Œæ˜¯åŒºå—é“¾å­˜è¯çš„çœŸå®æ€§è¯„ä»·ä¸­çš„ä¸€ä¸ªå…³é”®é—®é¢˜ã€‚å› ä¸ºï¼Œå¦‚å‰è¿°ï¼ŒåŒºå—é“¾æŠ€æœ¯å¯ä»¥ä¿éšœç”µå­è¯æ®çš„è½½ä½“åŠè½½ä½“ä¸Šè¯æ®å‰¯æœ¬çš„çœŸå®æ€§ï¼Œä½†è½½ä½“çš„çœŸå®å’Œå‰¯æœ¬æ•°æ®çš„çœŸå®ï¼Œæ— æ³•å†³å®šç”µå­æ•°æ®æœ¬èº«çš„çœŸå®æ€§ï¼ˆæ„æ€æ˜¯è™½ç„¶å‰¯æœ¬å’ŒåŸä»¶ç›¸åŒï¼Œä½†åŸä»¶ä¸ä¸€å®šæ˜¯çœŸå®çš„ï¼‰ã€‚åŒæ—¶ï¼Œåœ¨åŒºå—é“¾å­˜è¯åœºæ™¯ä¸‹ï¼Œå¦‚æœç”µå­è¯æ®æˆ–å…¶è¯æ®æŒ‡çº¹ï¼ˆæˆ–ç§°æ ¡éªŒæ•°æ®ï¼‰ä¸Šé“¾å¹¶åˆ†å¸ƒå¼å­˜å‚¨ï¼Œåˆ™è¯æ®çš„çœŸå®æ€§å·²ç»å…·æœ‰æŠ€æœ¯ä¿è¯ã€‚\nåˆ™æ¬²ä¿éšœç”µå­æ•°æ®çš„çœŸå®æ€§ï¼Œåˆ™éœ€è¦ç¡®ä¿ä½œä¸ºç”µå­è¯æ®çš„æ•°æ®ä¿¡æ¯ï¼ˆæˆ–å…¶è¯æ®æŒ‡çº¹ï¼‰åœ¨ç”Ÿæˆæ—¶å³åŒæ­¥ä¸Šé“¾ï¼Œ æˆ–è€…ç¡®ä¿è¯¥æ•°æ®ä¿¡æ¯åœ¨ä¸Šé“¾å‰æœªè¢«ç¯¡æ”¹ã€‚è€ƒè™‘åˆ°ç¡®ä¿ä½œä¸ºç”µå­è¯æ®çš„æ•°æ®ä¿¡æ¯åœ¨ä¸Šé“¾å‰æœªè¢«æ›´æ”¹å®é™…ä¸Šæ˜¯ä¸€ä¸ªä¼ ç»Ÿçš„ç”µå­è¯æ®é‰´å®šåœºæ™¯ï¼Œä¸èƒ½å‘æŒ¥åŒºå—é“¾æŠ€æœ¯çš„ä¼˜åŠ¿ï¼Œæ•…è€Œåœ¨åŒºå—é“¾å­˜è¯é¢†åŸŸï¼Œæ¯”è¾ƒç†æƒ³çš„ç¡®ä¿ç”µå­æ•°æ®çœŸå®æ€§çš„æ–¹æ¡ˆå³ä¸ºä½œä¸ºç”µå­è¯æ®çš„æ•°æ®ä¿¡æ¯ï¼ˆæˆ–å…¶è¯æ®æŒ‡çº¹ï¼‰åœ¨ç”Ÿæˆæ—¶å³åŒæ­¥ä¸Šé“¾ã€‚\n1.3 ç”µå­è¯æ®å†…å®¹çš„çœŸå®æ€§ ç”µå­è¯æ®å†…å®¹çš„çœŸå®æ€§ï¼Œæ˜¯æŒ‡ï¼šï¼ˆ1ï¼‰åœ¨â€œæ’é™¤åˆç†æ€€ç–‘â€çš„è¯æ˜æ ‡å‡†åœºåˆï¼Œç”µå­è¯æ®æ‰€åŒ…å«çš„ä¿¡æ¯å¯ä»¥ä¸æ¡ˆä»¶ä¸­å…¶ä»–è¯æ®æ‰€åŒ…å«çš„ä¿¡æ¯èƒ½å¤Ÿç›¸äº’å°è¯ï¼Œä»è€Œå‡†ç¡®è¯æ˜æ¡ˆä»¶äº‹å®ï¼›ï¼ˆ2ï¼‰åœ¨â€œä¼˜åŠ¿è¯æ®â€è¯æ˜æ ‡å‡†åœºåˆï¼Œ ç”µå­è¯æ®æ‰€åŒ…å«çš„ä¿¡æ¯å¯ä»¥è¯æ˜ä¸€å®šçš„æ³•å¾‹äº‹å®ï¼Œç‰¹åˆ«æ˜¯è¯æ˜å½“äº‹äººçš„æ„æ€è¡¨ç¤ºå’Œæ³•å¾‹è¡Œä¸ºã€‚\nç”µå­è¯æ®å†…å®¹çš„çœŸå®æ€§æ˜¯ç”µå­è¯æ®çœŸå®æ€§çš„æ ¸å¿ƒé—®é¢˜ï¼Œä¸å°‘è¯­å¢ƒä¸­ï¼Œç”µå­è¯æ®çš„çœŸå®æ€§ï¼Œå¾€å¾€ä¹Ÿæ˜¯æŒ‡ç”µå­è¯æ®å†…å®¹çš„çœŸå®æ€§ã€‚åœ¨å¸æ³•å®è·µä¸­ï¼Œé‰´å®šæ„è§ã€è¯æ®ç›¸äº’å°è¯æ˜¯ç¡®è®¤ç”µå­è¯æ®å†…å®¹çœŸå®æ€§çš„ä¸»è¦æ–¹å¼ï¼Œæœ‰äº›æƒ…å†µä¸‹äºŒè€…è¿˜ä¼šåŒæ—¶ä½¿ç”¨ã€‚\né™„åŠ å¯ä¿¡æ—¶é—´æˆ³çš„ä¸Šé“¾æ•°æ®ï¼Œå¯ä»¥æ¨å®šä¸ºå½¢æˆäºç‰¹å®šæ—¶é—´ç‚¹ï¼Œåˆ™è¯¥æ•°æ®ä¸­çš„æ—¶é—´ä¿¡æ¯å°±å…·æœ‰å†…å®¹çœŸå®æ€§ã€‚\nåŒç†ï¼Œé€šè¿‡åŒºå—é“¾è¾¾æˆçš„æ™ºèƒ½åˆçº¦ï¼Œåœ¨ä½œä¸ºè¯æ®ä½¿ç”¨æ—¶å¯ä»¥æ¨å®šåˆçº¦å†…å®¹æ•°æ®çœŸå®ï¼Œåˆçº¦å†…å®¹æ•°æ®ä¹Ÿå…·æœ‰äº†å†…å®¹çœŸå®æ€§ã€‚ï¼ˆæ„æ€æ˜¯å¦‚æœäº¤æ˜“é€šè¿‡æ™ºèƒ½åˆçº¦è¾¾æˆï¼Œå¯ä»¥ä¿è¯äº¤æ˜“æ˜¯çœŸå®çš„ï¼Œé‚£ä¹ˆäº¤æ˜“çš„å†…å®¹å°±å…·æœ‰äº†å†…å®¹çœŸå®æ€§ï¼‰\n2. å…³è”æ€§è®¤å®š è¯æ®çš„å…³è”æ€§ï¼Œæ˜¯æŒ‡è¯æ®å¿…é¡»å’Œéœ€è¦è¯æ˜çš„æ¡ˆä»¶äº‹å®æˆ–å…¶ä»–äº‰è®®äº‹å®å…·æœ‰ä¸€å®šçš„è”ç³»ã€‚\nåŒºå—é“¾åœ¨å•çº¯çš„å­˜è¯åœºæ™¯åº”ç”¨ï¼ŒæŠ€æœ¯æœ¬èº«å¹¶ä¸å¢å¼ºç”µå­è¯æ®çš„å…³è”æ€§ã€‚å¦‚æœæ˜¯ä¸€ç±»æˆ–ä¸€ç³»åˆ—ä¸šåŠ¡è¿è¡Œåœ¨åŒºå—é“¾ä¸Šï¼Œå› å…¶å…¨æµç¨‹ç•™ç—•ï¼Œå¯èƒ½å› ä¸ºå¯è¿½æº¯æ€§ä½¿è¯æ®çš„å…³è”æ›´åŠ æ˜ç¡®ï¼Œæ–¹ä¾¿è¿›è¡Œå…³è”æ€§è®¤å®šã€‚\næ— è®ºå¦‚ä½•ï¼Œä¸Šé“¾è¯æ®å’Œæ¡ˆä»¶æ— å…³çš„æƒ…å†µä¸å¯é¿å…ï¼ŒåŒºå—é“¾å­˜è¯ä¸èƒ½ç¡®ä¿ç”µå­è¯æ®å…·æœ‰å…³è”æ€§ï¼Œè€Œæ˜¯åœ¨éƒ¨åˆ†åœºæ™¯ä¸‹ä¸ºç”µå­è¯æ®çš„å…³è”æ€§è®¤å®šæä¾›å‚è€ƒã€‚ï¼ˆè¯æ®é“¾ï¼‰\n3. åˆæ³•æ€§è®¤å®š è¯æ®çš„åˆæ³•æ€§è®¤å®šåŒ…æ‹¬å–è¯ä¸»ä½“åˆæ³•æ€§ã€è¯æ®å½¢å¼çš„åˆæ³•æ€§ã€å–è¯ç¨‹åºåˆæ³•æ€§ä»¥åŠè¯æ®ä¿å­˜ä¸è¿ç”¨æ–¹å¼åˆæ³•æ€§å››ä¸ªæ–¹é¢ã€‚å®ƒæ˜¯è¯æ®è®¤å®šä¸»ä½“æœºæ¢°å¼å¯¹æ¯”æ³•æ¡çš„è¿‡ç¨‹ï¼Œå…¶ä¸­ä¸æºæ‚è¯æ®è®¤å®šä¸»ä½“çš„ç§äººä»·å€¼è¯„ä»·ã€‚å› æ­¤ï¼Œä¸è¯æ®çš„çœŸå®æ€§ã€å…³è”æ€§è¦æ±‚ä¸åŒï¼Œè¯æ®çš„åˆæ³•æ€§åˆ¤æ–­ä¸åº”è€ƒè™‘ä¸æ¡ˆä»¶äº‹å®çš„è”ç³»ï¼Œè€Œä¸æ³•å¾‹è§„å®šå¯†åˆ‡ç›¸å…³ã€‚ï¼ˆè¿™å°±ä¸æ˜¯åŒºå—é“¾è¦è€ƒè™‘çš„é—®é¢˜äº†ï¼‰\n4. å¯ä¿¡æ—¶é—´æˆ³ ç”±äºåŒºå—é“¾æœ¬èº«ä¸Šå­˜å‚¨çš„åªæ˜¯å“ˆå¸Œå€¼ï¼Œè€ŒéåŸä»¶ï¼Œå› æ­¤åœ¨ç¤ºè¯çš„æ—¶å€™å¦‚æœæ²¡æœ‰åŸä»¶ä¸å“ˆå¸Œå€¼ç›¸å¯¹åº”ï¼Œå­˜è¯ä¹Ÿå°†æ— æ³•è¾¾åˆ°ç›®çš„ã€‚å› æ­¤ï¼Œç”µå­æ•°æ®å­˜å‚¨ç”µå­æ•°æ®åŸä»¶ä¹Ÿæ˜¯åŒºå—é“¾å¸æ³•å­˜è¯ç³»ç»Ÿçš„é‡è¦éƒ¨åˆ†ã€‚\nå¯ä¿¡æ—¶é—´æˆ³æ˜¯å°†ç”¨æˆ·çš„ç”µå­æ•°æ®ä¿¡æ¯å’Œæƒå¨æ—¶é—´æºç»‘å®šï¼Œç”±å›½å®¶æˆæ—¶ä¸­å¿ƒæä¾›æˆæ—¶ä¿¡æ¯ï¼Œå°†å¯¹ç”µå­æ•°æ®ä¿¡æ¯å’Œæˆæ—¶ä¿¡æ¯è¿›è¡Œæ•°å­— ç­¾åç”Ÿæˆæ—¶é—´æˆ³ã€‚é€šè¿‡å¯ä¿¡æ—¶é—´æˆ³å¯ç¡®å®šç”µå­æ•°æ®ä¿¡æ¯ç”Ÿæˆçš„ç²¾ç¡®æ—¶é—´ï¼Œå¹¶é˜²æ­¢ç”µå­æ–‡ä»¶è¢«ç¯¡æ”¹ï¼Œä¸ºç”µå­æ•°æ®æä¾›å¯ä¿¡çš„æ—¶é—´è¯æ˜å’Œå†…å®¹çœŸå®æ€§ã€å®Œæ•´æ€§è¯æ˜ã€‚\nå¯ä¿¡æ—¶é—´æˆ³æ˜¯è¡¨ç¤ºç”µå­æ•°æ®åœ¨ä¸€ä¸ªç‰¹å®šæ—¶é—´ç‚¹å·²ç»å­˜åœ¨çš„å®Œæ•´çš„å¯éªŒè¯çš„æ•°æ®ã€‚\n5. åŒºå—é“¾å­˜è¯ç³»ç»Ÿå¯¹ç”µå­æ•°æ®è®¤å®šçš„ä½œç”¨ åŒºå—é“¾æŠ€æœ¯å¯¹ç”µå­æ•°æ®è¯æ®è®¤å®šçš„ä½œç”¨ï¼Œå³å¯¹ç”µå­è¯æ®â€œä¸‰æ€§â€çš„å½±å“ï¼Œé¦–å…ˆåœ¨äºå¯¹ç”µå­è¯æ®çœŸå®æ€§çš„åˆ¤å®šæ‰€äº§å‡ºçš„æ˜¾è‘—å½±å“ã€‚æ­¤å¤–ï¼Œå¯¹äºæŸäº›ä¸šåŠ¡ç±»å‹ï¼Œè¯¸å¦‚è¯æ®åœ¨é“¾ä¸Šå½¢æˆå¹¶åŒæ­¥å­˜å‚¨çš„æƒ…å½¢ï¼Œè¯¥ç³»ç»Ÿå¯¹äºè¯æ˜æ‰€å­˜è¯æ®çš„åˆæ³•æ€§å’Œå…³è”æ€§ä¹Ÿå…·æœ‰ä¸€å®šå¸®åŠ©ã€‚\nå…·ä½“è€Œè¨€ï¼Œè¯¥ç³»ç»Ÿå¯¹äºè¯æ®è®¤å®šè¾…åŠ©åŠŸèƒ½ä¸»è¦é€šè¿‡ä»¥ä¸‹å››ä¸ªå±‚é¢æ¥å®ç°ã€‚\n å®‰å…¨æ¶æ„ç¡®ä¿ç”µå­æ•°æ®è½½ä½“çœŸå®æ€§ å…³é”®æŠ€æœ¯æé«˜ç”µå­æ•°æ®çœŸå®æ€§ ç›¸å…³æŠ€æœ¯æé«˜è¯æ®è®¤å®šæ•ˆç‡ ç›¸å…³ä¸šåŠ¡å’Œé“¾ä¸‹æ²»ç†è¾…åŠ©è¯æ®è®¤å®š  6. æ€»ç»“ åœ¨ç†æƒ³æƒ…å†µä¸‹ï¼ˆå³ç”µå­æ•°æ®ç”Ÿæˆæ—¶å³åŒæ­¥ä¸Šé“¾ï¼‰ï¼š\n åŒºå—é“¾ç³»ç»Ÿä¿è¯äº†ç”µå­æ•°æ®è½½ä½“çš„çœŸå®æ€§ä¸ç”µå­æ•°æ®çš„çœŸå®æ€§ å¯ä¿¡æ—¶é—´æˆ³è¯æ˜ç”µå­æ•°æ®åœ¨æŸä¸€æ—¶åˆ»å·²ç»å­˜åœ¨ï¼Œä¿è¯äº†ç”µå­æ•°æ®æ—¶é—´å†…å®¹çš„çœŸå®æ€§ï¼Œä¸ºç”µå­æ•°æ®æä¾›å¯ä¿¡çš„æ—¶é—´è¯æ˜å’Œå†…å®¹çœŸå®æ€§ã€å®Œæ•´æ€§è¯æ˜ äºŒè€…å¯åŒæ—¶ä¿è¯æ–‡ä»¶ä¸è¢«ç¯¡æ”¹ï¼Œä½†åŒºå—é“¾ä¸­åªæœ‰æ–‡ä»¶æ‘˜è¦ï¼Œæ— æ³•ç”¨äºâ€œç¤ºè¯â€ï¼Œå› æ­¤è¿˜éœ€è¦å­˜å‚¨ç”µå­æ•°æ®åŸæ–‡  åœ¨ç°æœ‰æƒ…å†µä¸‹ï¼ˆç”µå­æ•°æ®ç”Ÿæˆåä¸Šé“¾ï¼‰ï¼š\n åŒºå—é“¾ç³»ç»Ÿä¿è¯äº†ç”µå­æ•°æ®è½½ä½“çœŸå®æ€§ å¯ä¿¡æ—¶é—´æˆ³è¯æ˜äº†ç”µå­æ•°æ®åœ¨æŸä¸€æ—¶åˆ»å·²ç»å­˜åœ¨ äºŒè€…å¯åŒæ—¶ä¿è¯æ–‡ä»¶ä¸è¢«ç¯¡æ”¹ï¼ˆä¸Šé“¾å¹¶è¿›è¡Œæ—¶é—´æˆ³ç­¾ååï¼‰ï¼Œä½†åŒºå—é“¾ä¸­åªæœ‰æ–‡ä»¶æ‘˜è¦ï¼Œæ— æ³•ç”¨äºâ€œç¤ºè¯â€ï¼Œå› æ­¤è¿˜éœ€è¦å­˜å‚¨ç”µå­æ•°æ®åŸæ–‡  References ã€ŠåŒºå—é“¾å¸æ³•å­˜è¯åº”ç”¨ç™½çš®ä¹¦ï¼ˆv1.0ï¼‰ã€‹\n","permalink":"http://yangchnet.github.io/Dessert/posts/%E5%8C%BA%E5%9D%97%E9%93%BE/%E5%8F%AF%E4%BF%A1%E5%AD%98%E8%AF%81/","summary":"ç”µå­æ•°æ®çš„è®¤å®šåŒ…å«3ä¸ªé‡è¦çš„éƒ¨åˆ†ï¼Œç§°ä¸ºâ€œä¸‰æ€§â€ï¼š\n çœŸå®æ€§ å…³è”æ€§ åˆæ³•æ€§   1. çœŸå®æ€§è®¤å®š ç”±äºç”µå­æ•°æ®å­˜è¯çš„ç‰¹æ®Šæ€§ï¼Œå…¶çœŸå®æ€§å¯ä»¥ä»ä¸‰ä¸ªä¸åŒçš„å±‚é¢æ¥è®¤å®šï¼š\n ç”µå­è¯æ®è½½ä½“çš„çœŸå®æ€§ ç”µå­æ•°æ®çš„çœŸå®æ€§ ç”µå­è¯æ®å†…å®¹çš„çœŸå®æ€§  1.1 ç”µå­è¯æ®è½½ä½“çš„çœŸå®æ€§ ç”µå­è¯æ®è½½ä½“çš„çœŸå®æ€§ï¼Œæ˜¯æŒ‡å­˜å‚¨ç”µå­æ•°æ®çš„åª’ä»‹ã€è®¾å¤‡åœ¨è¯‰è®¼è¿‡ç¨‹ä¸­ä¿æŒåŸå§‹æ€§ã€åŒä¸€æ€§ã€å®Œæ•´æ€§ï¼Œä¸å­˜åœ¨è¢«ä¼ªé€ ã€å˜é€ ã€æ›¿æ¢ã€ç ´åç­‰é—®é¢˜ã€‚ ä¸»è¦åŒ…æ‹¬ä¸¤ä¸ªæ–¹é¢çš„è¦æ±‚ï¼š\n ç”µå­è¯æ®è½½ä½“æ¥æºçš„çœŸå®æ€§ ç”µå­è¯æ®è½½ä½“åœ¨è¯‰è®¼å‰å’Œè¯‰è®¼æµè½¬è¿‡ç¨‹ä¸­çš„çœŸå®æ€§ã€‚  å…·ä½“æ¥è¯´ï¼Œæ³•å®˜å®¡æŸ¥ç”µå­è¯æ®æ—¶å¾€å¾€ä¼šå…³æ³¨ï¼šæäº¤çš„ç”µå­è¯æ®æ˜¯å¦åŒ…æ‹¬åŸå§‹å­˜å‚¨ä»‹è´¨ï¼ŒåŸå§‹å­˜å‚¨ä»‹è´¨çš„æ”¶é›†ç¨‹åºã€æ–¹å¼æ˜¯å¦ç¬¦åˆæ³•å¾‹è§„å®šå’Œæœ‰å…³è§„èŒƒï¼›å¦‚æœæ— æ³•æå–åŸå§‹å­˜å‚¨ä»‹è´¨ï¼Œå¦‚ä½•ç¡®ä¿å…¶ä»–å­˜å‚¨ä»‹è´¨èƒ½å¤Ÿä¿éšœç”µå­æ•°æ®çš„çœŸå®æ€§ã€‚ è¿™æ˜¯å¯¹ç”µå­è¯æ®è½½ä½“åŸå§‹æ€§å’ŒåŒä¸€æ€§çš„å®¡æŸ¥ã€‚\näºŒæ˜¯ç”µå­è¯æ®è½½ä½“åœ¨è¯‰è®¼å‰å’Œè¯‰è®¼ä¸­æµè½¬è¿‡ç¨‹ä¸­çš„çœŸå®æ€§ã€‚è¯‰è®¼å‰å’Œè¯‰è®¼ä¸­ï¼Œè¯æ®ä¼šåœ¨å¤šä¸ªä¸»ä½“ï¼ˆå¦‚åˆ‘äº‹æ¡ˆä»¶çš„å…¬ã€æ£€ã€æ³•å’Œæ°‘äº‹ã€è¡Œæ”¿æ¡ˆä»¶ä¸­åŸå‘Šã€æ³•é™¢ã€è¢«å‘Šï¼‰é—´æµè½¬ã€‚åœ¨æ­¤è¿‡ç¨‹ä¸­éœ€è¦è€ƒå¯Ÿï¼šç”µå­è¯æ®è½½ä½“åœ¨ç§»é€ã€ æµè½¬ä¸­æ˜¯å¦ä¿æŒåŒä¸€æ€§ï¼Œæ˜¯å¦ç¬¦åˆé‰´çœŸçš„è¦æ±‚ï¼›ç”µå­è¯æ®è½½ä½“æ˜¯å¦ä¿æŒå®Œæ•´æ€§ï¼Œæ²¡æœ‰è¢«æ”¹å˜ã€ç ´åç­‰ã€‚\nåŒºå—é“¾æŠ€æœ¯æå¤§åœ°æ‰©å±•äº†ç”µå­è¯æ®çš„è½½ä½“å¤–å»¶ï¼Œå¹¶å¯ä»¥ä»æŠ€æœ¯ä¸Šç¡®ä¿ç”µå­è¯æ®è½½ä½“çš„çœŸå®æ€§ã€‚å…·ä½“è€Œè¨€ï¼ŒåŒºå—é“¾å­˜è¯ä½¿ç”¨åˆ†å¸ƒå¼å­˜å‚¨å¹¶é™„åŠ é˜²ç¯¡æ”¹æ ¡éªŒæœºåˆ¶ï¼Œä½¿ç”µå­è¯æ®å¯ä»¥è„±ç¦»åŸå§‹å­˜å‚¨ä»‹è´¨è€Œ å®‰å…¨å­˜å‚¨ï¼ŒåŒæ—¶æ— è¢«ç¯¡æ”¹ä¹‹è™\nåŒºå—é“¾æŠ€æœ¯æœ‰æ•ˆè§£å†³äº†ç”µå­è¯æ®è½½ä½“çœŸå®æ€§è®¤å®šçš„é—®é¢˜ã€‚\n1.2 ç”µå­æ•°æ®çš„çœŸå®æ€§ ç”µå­æ•°æ®çš„çœŸå®æ€§é—®é¢˜ï¼Œæ˜¯æŒ‡ä½œä¸ºç”µå­è¯æ®ä¿¡æ¯åœ¨æŠ€æœ¯å±‚é¢çš„å­˜åœ¨å½¢å¼çš„ç”µå­æ•°æ®æ˜¯å¦çœŸå®ï¼Œæ˜¯å¦ä¸åŸå§‹æ•°æ®ä¿æŒä¸€è‡´ï¼Œæ˜¯å¦å­˜åœ¨è¢«ä¿®æ”¹ã€åˆ é™¤ã€å¢åŠ ç­‰é—®é¢˜ã€‚\nç”µå­æ•°æ®çš„çœŸå®æ€§ï¼Œæ˜¯åŒºå—é“¾å­˜è¯çš„çœŸå®æ€§è¯„ä»·ä¸­çš„ä¸€ä¸ªå…³é”®é—®é¢˜ã€‚å› ä¸ºï¼Œå¦‚å‰è¿°ï¼ŒåŒºå—é“¾æŠ€æœ¯å¯ä»¥ä¿éšœç”µå­è¯æ®çš„è½½ä½“åŠè½½ä½“ä¸Šè¯æ®å‰¯æœ¬çš„çœŸå®æ€§ï¼Œä½†è½½ä½“çš„çœŸå®å’Œå‰¯æœ¬æ•°æ®çš„çœŸå®ï¼Œæ— æ³•å†³å®šç”µå­æ•°æ®æœ¬èº«çš„çœŸå®æ€§ï¼ˆæ„æ€æ˜¯è™½ç„¶å‰¯æœ¬å’ŒåŸä»¶ç›¸åŒï¼Œä½†åŸä»¶ä¸ä¸€å®šæ˜¯çœŸå®çš„ï¼‰ã€‚åŒæ—¶ï¼Œåœ¨åŒºå—é“¾å­˜è¯åœºæ™¯ä¸‹ï¼Œå¦‚æœç”µå­è¯æ®æˆ–å…¶è¯æ®æŒ‡çº¹ï¼ˆæˆ–ç§°æ ¡éªŒæ•°æ®ï¼‰ä¸Šé“¾å¹¶åˆ†å¸ƒå¼å­˜å‚¨ï¼Œåˆ™è¯æ®çš„çœŸå®æ€§å·²ç»å…·æœ‰æŠ€æœ¯ä¿è¯ã€‚\nåˆ™æ¬²ä¿éšœç”µå­æ•°æ®çš„çœŸå®æ€§ï¼Œåˆ™éœ€è¦ç¡®ä¿ä½œä¸ºç”µå­è¯æ®çš„æ•°æ®ä¿¡æ¯ï¼ˆæˆ–å…¶è¯æ®æŒ‡çº¹ï¼‰åœ¨ç”Ÿæˆæ—¶å³åŒæ­¥ä¸Šé“¾ï¼Œ æˆ–è€…ç¡®ä¿è¯¥æ•°æ®ä¿¡æ¯åœ¨ä¸Šé“¾å‰æœªè¢«ç¯¡æ”¹ã€‚è€ƒè™‘åˆ°ç¡®ä¿ä½œä¸ºç”µå­è¯æ®çš„æ•°æ®ä¿¡æ¯åœ¨ä¸Šé“¾å‰æœªè¢«æ›´æ”¹å®é™…ä¸Šæ˜¯ä¸€ä¸ªä¼ ç»Ÿçš„ç”µå­è¯æ®é‰´å®šåœºæ™¯ï¼Œä¸èƒ½å‘æŒ¥åŒºå—é“¾æŠ€æœ¯çš„ä¼˜åŠ¿ï¼Œæ•…è€Œåœ¨åŒºå—é“¾å­˜è¯é¢†åŸŸï¼Œæ¯”è¾ƒç†æƒ³çš„ç¡®ä¿ç”µå­æ•°æ®çœŸå®æ€§çš„æ–¹æ¡ˆå³ä¸ºä½œä¸ºç”µå­è¯æ®çš„æ•°æ®ä¿¡æ¯ï¼ˆæˆ–å…¶è¯æ®æŒ‡çº¹ï¼‰åœ¨ç”Ÿæˆæ—¶å³åŒæ­¥ä¸Šé“¾ã€‚\n1.3 ç”µå­è¯æ®å†…å®¹çš„çœŸå®æ€§ ç”µå­è¯æ®å†…å®¹çš„çœŸå®æ€§ï¼Œæ˜¯æŒ‡ï¼šï¼ˆ1ï¼‰åœ¨â€œæ’é™¤åˆç†æ€€ç–‘â€çš„è¯æ˜æ ‡å‡†åœºåˆï¼Œç”µå­è¯æ®æ‰€åŒ…å«çš„ä¿¡æ¯å¯ä»¥ä¸æ¡ˆä»¶ä¸­å…¶ä»–è¯æ®æ‰€åŒ…å«çš„ä¿¡æ¯èƒ½å¤Ÿç›¸äº’å°è¯ï¼Œä»è€Œå‡†ç¡®è¯æ˜æ¡ˆä»¶äº‹å®ï¼›ï¼ˆ2ï¼‰åœ¨â€œä¼˜åŠ¿è¯æ®â€è¯æ˜æ ‡å‡†åœºåˆï¼Œ ç”µå­è¯æ®æ‰€åŒ…å«çš„ä¿¡æ¯å¯ä»¥è¯æ˜ä¸€å®šçš„æ³•å¾‹äº‹å®ï¼Œç‰¹åˆ«æ˜¯è¯æ˜å½“äº‹äººçš„æ„æ€è¡¨ç¤ºå’Œæ³•å¾‹è¡Œä¸ºã€‚\nç”µå­è¯æ®å†…å®¹çš„çœŸå®æ€§æ˜¯ç”µå­è¯æ®çœŸå®æ€§çš„æ ¸å¿ƒé—®é¢˜ï¼Œä¸å°‘è¯­å¢ƒä¸­ï¼Œç”µå­è¯æ®çš„çœŸå®æ€§ï¼Œå¾€å¾€ä¹Ÿæ˜¯æŒ‡ç”µå­è¯æ®å†…å®¹çš„çœŸå®æ€§ã€‚åœ¨å¸æ³•å®è·µä¸­ï¼Œé‰´å®šæ„è§ã€è¯æ®ç›¸äº’å°è¯æ˜¯ç¡®è®¤ç”µå­è¯æ®å†…å®¹çœŸå®æ€§çš„ä¸»è¦æ–¹å¼ï¼Œæœ‰äº›æƒ…å†µä¸‹äºŒè€…è¿˜ä¼šåŒæ—¶ä½¿ç”¨ã€‚\né™„åŠ å¯ä¿¡æ—¶é—´æˆ³çš„ä¸Šé“¾æ•°æ®ï¼Œå¯ä»¥æ¨å®šä¸ºå½¢æˆäºç‰¹å®šæ—¶é—´ç‚¹ï¼Œåˆ™è¯¥æ•°æ®ä¸­çš„æ—¶é—´ä¿¡æ¯å°±å…·æœ‰å†…å®¹çœŸå®æ€§ã€‚\nåŒç†ï¼Œé€šè¿‡åŒºå—é“¾è¾¾æˆçš„æ™ºèƒ½åˆçº¦ï¼Œåœ¨ä½œä¸ºè¯æ®ä½¿ç”¨æ—¶å¯ä»¥æ¨å®šåˆçº¦å†…å®¹æ•°æ®çœŸå®ï¼Œåˆçº¦å†…å®¹æ•°æ®ä¹Ÿå…·æœ‰äº†å†…å®¹çœŸå®æ€§ã€‚ï¼ˆæ„æ€æ˜¯å¦‚æœäº¤æ˜“é€šè¿‡æ™ºèƒ½åˆçº¦è¾¾æˆï¼Œå¯ä»¥ä¿è¯äº¤æ˜“æ˜¯çœŸå®çš„ï¼Œé‚£ä¹ˆäº¤æ˜“çš„å†…å®¹å°±å…·æœ‰äº†å†…å®¹çœŸå®æ€§ï¼‰\n2. å…³è”æ€§è®¤å®š è¯æ®çš„å…³è”æ€§ï¼Œæ˜¯æŒ‡è¯æ®å¿…é¡»å’Œéœ€è¦è¯æ˜çš„æ¡ˆä»¶äº‹å®æˆ–å…¶ä»–äº‰è®®äº‹å®å…·æœ‰ä¸€å®šçš„è”ç³»ã€‚\nåŒºå—é“¾åœ¨å•çº¯çš„å­˜è¯åœºæ™¯åº”ç”¨ï¼ŒæŠ€æœ¯æœ¬èº«å¹¶ä¸å¢å¼ºç”µå­è¯æ®çš„å…³è”æ€§ã€‚å¦‚æœæ˜¯ä¸€ç±»æˆ–ä¸€ç³»åˆ—ä¸šåŠ¡è¿è¡Œåœ¨åŒºå—é“¾ä¸Šï¼Œå› å…¶å…¨æµç¨‹ç•™ç—•ï¼Œå¯èƒ½å› ä¸ºå¯è¿½æº¯æ€§ä½¿è¯æ®çš„å…³è”æ›´åŠ æ˜ç¡®ï¼Œæ–¹ä¾¿è¿›è¡Œå…³è”æ€§è®¤å®šã€‚\næ— è®ºå¦‚ä½•ï¼Œä¸Šé“¾è¯æ®å’Œæ¡ˆä»¶æ— å…³çš„æƒ…å†µä¸å¯é¿å…ï¼ŒåŒºå—é“¾å­˜è¯ä¸èƒ½ç¡®ä¿ç”µå­è¯æ®å…·æœ‰å…³è”æ€§ï¼Œè€Œæ˜¯åœ¨éƒ¨åˆ†åœºæ™¯ä¸‹ä¸ºç”µå­è¯æ®çš„å…³è”æ€§è®¤å®šæä¾›å‚è€ƒã€‚ï¼ˆè¯æ®é“¾ï¼‰\n3. åˆæ³•æ€§è®¤å®š è¯æ®çš„åˆæ³•æ€§è®¤å®šåŒ…æ‹¬å–è¯ä¸»ä½“åˆæ³•æ€§ã€è¯æ®å½¢å¼çš„åˆæ³•æ€§ã€å–è¯ç¨‹åºåˆæ³•æ€§ä»¥åŠè¯æ®ä¿å­˜ä¸è¿ç”¨æ–¹å¼åˆæ³•æ€§å››ä¸ªæ–¹é¢ã€‚å®ƒæ˜¯è¯æ®è®¤å®šä¸»ä½“æœºæ¢°å¼å¯¹æ¯”æ³•æ¡çš„è¿‡ç¨‹ï¼Œå…¶ä¸­ä¸æºæ‚è¯æ®è®¤å®šä¸»ä½“çš„ç§äººä»·å€¼è¯„ä»·ã€‚å› æ­¤ï¼Œä¸è¯æ®çš„çœŸå®æ€§ã€å…³è”æ€§è¦æ±‚ä¸åŒï¼Œè¯æ®çš„åˆæ³•æ€§åˆ¤æ–­ä¸åº”è€ƒè™‘ä¸æ¡ˆä»¶äº‹å®çš„è”ç³»ï¼Œè€Œä¸æ³•å¾‹è§„å®šå¯†åˆ‡ç›¸å…³ã€‚ï¼ˆè¿™å°±ä¸æ˜¯åŒºå—é“¾è¦è€ƒè™‘çš„é—®é¢˜äº†ï¼‰\n4. å¯ä¿¡æ—¶é—´æˆ³ ç”±äºåŒºå—é“¾æœ¬èº«ä¸Šå­˜å‚¨çš„åªæ˜¯å“ˆå¸Œå€¼ï¼Œè€ŒéåŸä»¶ï¼Œå› æ­¤åœ¨ç¤ºè¯çš„æ—¶å€™å¦‚æœæ²¡æœ‰åŸä»¶ä¸å“ˆå¸Œå€¼ç›¸å¯¹åº”ï¼Œå­˜è¯ä¹Ÿå°†æ— æ³•è¾¾åˆ°ç›®çš„ã€‚å› æ­¤ï¼Œç”µå­æ•°æ®å­˜å‚¨ç”µå­æ•°æ®åŸä»¶ä¹Ÿæ˜¯åŒºå—é“¾å¸æ³•å­˜è¯ç³»ç»Ÿçš„é‡è¦éƒ¨åˆ†ã€‚\nå¯ä¿¡æ—¶é—´æˆ³æ˜¯å°†ç”¨æˆ·çš„ç”µå­æ•°æ®ä¿¡æ¯å’Œæƒå¨æ—¶é—´æºç»‘å®šï¼Œç”±å›½å®¶æˆæ—¶ä¸­å¿ƒæä¾›æˆæ—¶ä¿¡æ¯ï¼Œå°†å¯¹ç”µå­æ•°æ®ä¿¡æ¯å’Œæˆæ—¶ä¿¡æ¯è¿›è¡Œæ•°å­— ç­¾åç”Ÿæˆæ—¶é—´æˆ³ã€‚é€šè¿‡å¯ä¿¡æ—¶é—´æˆ³å¯ç¡®å®šç”µå­æ•°æ®ä¿¡æ¯ç”Ÿæˆçš„ç²¾ç¡®æ—¶é—´ï¼Œå¹¶é˜²æ­¢ç”µå­æ–‡ä»¶è¢«ç¯¡æ”¹ï¼Œä¸ºç”µå­æ•°æ®æä¾›å¯ä¿¡çš„æ—¶é—´è¯æ˜å’Œå†…å®¹çœŸå®æ€§ã€å®Œæ•´æ€§è¯æ˜ã€‚\nå¯ä¿¡æ—¶é—´æˆ³æ˜¯è¡¨ç¤ºç”µå­æ•°æ®åœ¨ä¸€ä¸ªç‰¹å®šæ—¶é—´ç‚¹å·²ç»å­˜åœ¨çš„å®Œæ•´çš„å¯éªŒè¯çš„æ•°æ®ã€‚\n5. åŒºå—é“¾å­˜è¯ç³»ç»Ÿå¯¹ç”µå­æ•°æ®è®¤å®šçš„ä½œç”¨ åŒºå—é“¾æŠ€æœ¯å¯¹ç”µå­æ•°æ®è¯æ®è®¤å®šçš„ä½œç”¨ï¼Œå³å¯¹ç”µå­è¯æ®â€œä¸‰æ€§â€çš„å½±å“ï¼Œé¦–å…ˆåœ¨äºå¯¹ç”µå­è¯æ®çœŸå®æ€§çš„åˆ¤å®šæ‰€äº§å‡ºçš„æ˜¾è‘—å½±å“ã€‚æ­¤å¤–ï¼Œå¯¹äºæŸäº›ä¸šåŠ¡ç±»å‹ï¼Œè¯¸å¦‚è¯æ®åœ¨é“¾ä¸Šå½¢æˆå¹¶åŒæ­¥å­˜å‚¨çš„æƒ…å½¢ï¼Œè¯¥ç³»ç»Ÿå¯¹äºè¯æ˜æ‰€å­˜è¯æ®çš„åˆæ³•æ€§å’Œå…³è”æ€§ä¹Ÿå…·æœ‰ä¸€å®šå¸®åŠ©ã€‚\nå…·ä½“è€Œè¨€ï¼Œè¯¥ç³»ç»Ÿå¯¹äºè¯æ®è®¤å®šè¾…åŠ©åŠŸèƒ½ä¸»è¦é€šè¿‡ä»¥ä¸‹å››ä¸ªå±‚é¢æ¥å®ç°ã€‚\n å®‰å…¨æ¶æ„ç¡®ä¿ç”µå­æ•°æ®è½½ä½“çœŸå®æ€§ å…³é”®æŠ€æœ¯æé«˜ç”µå­æ•°æ®çœŸå®æ€§ ç›¸å…³æŠ€æœ¯æé«˜è¯æ®è®¤å®šæ•ˆç‡ ç›¸å…³ä¸šåŠ¡å’Œé“¾ä¸‹æ²»ç†è¾…åŠ©è¯æ®è®¤å®š  6. æ€»ç»“ åœ¨ç†æƒ³æƒ…å†µä¸‹ï¼ˆå³ç”µå­æ•°æ®ç”Ÿæˆæ—¶å³åŒæ­¥ä¸Šé“¾ï¼‰ï¼š","title":"å¯ä¿¡å­˜è¯"},{"content":" å®˜æ–¹æ•™ç¨‹ï¼Œå†™çš„å¾ˆå¥½ï¼Œæˆ‘å°±ä¸å¤šè¯´äº†\n Let\u0026rsquo;s learn to use Wire by example. The Wire guide provides thorough documentation of the tool\u0026rsquo;s usage. For readers eager to see Wire applied to a larger server, the guestbook sample in Go Cloud uses Wire to initialize its components. Here we are going to build a small greeter program to understand how to use Wire. The finished product may be found in the same directory as this README.\nA First Pass of Building the Greeter Program Let\u0026rsquo;s create a small program that simulates an event with a greeter greeting guests with a particular message.\nTo start, we will create three types: 1) a message for a greeter, 2) a greeter who conveys that message, and 3) an event that starts with the greeter greeting guests. In this design, we have three struct types:\ntype Message string type Greeter struct { // ... TBD } type Event struct { // ... TBD } The Message type just wraps a string. For now, we will create a simple initializer that always returns a hard-coded message:\nfunc NewMessage() Message { return Message(\u0026#34;Hi there!\u0026#34;) } Our Greeter will need reference to the Message. So let\u0026rsquo;s create an initializer for our Greeter as well.\nfunc NewGreeter(m Message) Greeter { return Greeter{Message: m} } type Greeter struct { Message Message // \u0026lt;- adding a Message field } In the initializer we assign a Message field to Greeter. Now, we can use the Message when we create a Greet method on Greeter:\nfunc (g Greeter) Greet() Message { return g.Message } Next, we need our Event to have a Greeter, so we will create an initializer for it as well.\nfunc NewEvent(g Greeter) Event { return Event{Greeter: g} } type Event struct { Greeter Greeter // \u0026lt;- adding a Greeter field } Then we add a method to start the Event:\nfunc (e Event) Start() { msg := e.Greeter.Greet() fmt.Println(msg) } The Start method holds the core of our small application: it tells the greeter to issue a greeting and then prints that message to the screen.\nNow that we have all the components of our application ready, let\u0026rsquo;s see what it takes to initialize all the components without using Wire. Our main function would look like this:\nfunc main() { message := NewMessage() greeter := NewGreeter(message) event := NewEvent(greeter) event.Start() } First we create a message, then we create a greeter with that message, and finally we create an event with that greeter. With all the initialization done, we\u0026rsquo;re ready to start our event.\nWe are using the dependency injection design principle. In practice, that means we pass in whatever each component needs. This style of design lends itself to writing easily tested code and makes it easy to swap out one dependency with another.\nUsing Wire to Generate Code One downside to dependency injection is the need for so many initialization steps. Let\u0026rsquo;s see how we can use Wire to make the process of initializing our components smoother.\nLet\u0026rsquo;s start by changing our main function to look like this:\nfunc main() { e := InitializeEvent() e.Start() } Next, in a separate file called wire.go we will define InitializeEvent. This is where things get interesting:\n// wire.go  func InitializeEvent() Event { wire.Build(NewEvent, NewGreeter, NewMessage) return Event{} } Rather than go through the trouble of initializing each component in turn and passing it into the next one, we instead have a single call to wire.Build passing in the initializers we want to use. In Wire, initializers are known as \u0026ldquo;providers,\u0026rdquo; functions which provide a particular type. We add a zero value for Event as a return value to satisfy the compiler. Note that even if we add values to Event, Wire will ignore them. In fact, the injector\u0026rsquo;s purpose is to provide information about which providers to use to construct an Event and so we will exclude it from our final binary with a build constraint at the top of the file:\n//+build wireinject  Note, a build constraint requires a blank, trailing line.\nIn Wire parlance, InitializeEvent is an \u0026ldquo;injector.\u0026rdquo; Now that we have our injector complete, we are ready to use the wire command line tool.\nInstall the tool with:\ngo get github.com/google/wire/cmd/wire Then in the same directory with the above code, simply run wire. Wire will find the InitializeEvent injector and generate a function whose body is filled out with all the necessary initialization steps. The result will be written to a file named wire_gen.go.\nLet\u0026rsquo;s take a look at what Wire did for us:\n// wire_gen.go  func InitializeEvent() Event { message := NewMessage() greeter := NewGreeter(message) event := NewEvent(greeter) return event } It looks just like what we wrote above! Now this is a simple example with just three components, so writing the initializer by hand isn\u0026rsquo;t too painful. Imagine how useful Wire is for components that are much more complex. When working with Wire, we will commit both wire.go and wire_gen.go to source control.\nMaking Changes with Wire To show a small part of how Wire handles more complex setups, let\u0026rsquo;s refactor our initializer for Event to return an error and see what happens.\nfunc NewEvent(g Greeter) (Event, error) { if g.Grumpy { return Event{}, errors.New(\u0026#34;could not create event: event greeter is grumpy\u0026#34;) } return Event{Greeter: g}, nil } We\u0026rsquo;ll say that sometimes a Greeter might be grumpy and so we cannot create an Event. The NewGreeter initializer now looks like this:\nfunc NewGreeter(m Message) Greeter { var grumpy bool if time.Now().Unix()%2 == 0 { grumpy = true } return Greeter{Message: m, Grumpy: grumpy} } We have added a Grumpy field to Greeter struct and if the invocation time of the initializer is an even number of seconds since the Unix epoch, we will create a grumpy greeter instead of a friendly one.\nThe Greet method then becomes:\nfunc (g Greeter) Greet() Message { if g.Grumpy { return Message(\u0026#34;Go away!\u0026#34;) } return g.Message } Now you see how a grumpy Greeter is no good for an Event. So NewEvent may fail. Our main must now take into account that InitializeEvent may in fact fail:\nfunc main() { e, err := InitializeEvent() if err != nil { fmt.Printf(\u0026#34;failed to create event: %s\\n\u0026#34;, err) os.Exit(2) } e.Start() } We also need to update InitializeEvent to add an error type to the return value:\n// wire.go  func InitializeEvent() (Event, error) { wire.Build(NewEvent, NewGreeter, NewMessage) return Event{}, nil } With the setup complete, we are ready to invoke the wire command again. Note, that after running wire once to produce a wire_gen.go file, we may also use go generate. Having run the command, our wire_gen.go file looks like this:\n// wire_gen.go  func InitializeEvent() (Event, error) { message := NewMessage() greeter := NewGreeter(message) event, err := NewEvent(greeter) if err != nil { return Event{}, err } return event, nil } Wire has detected that the NewEvent provider may fail and has done the right thing inside the generated code: it checks the error and returns early if one is present.\nChanging the Injector Signature As another improvement, let\u0026rsquo;s look at how Wire generates code based on the signature of the injector. Presently, we have hard-coded the message inside NewMessage. In practice, it\u0026rsquo;s much nicer to allow callers to change that message however they see fit. So let\u0026rsquo;s change InitializeEvent to look like this:\nfunc InitializeEvent(phrase string) (Event, error) { wire.Build(NewEvent, NewGreeter, NewMessage) return Event{}, nil } Now InitializeEvent allows callers to pass in the phrase for a Greeter to use. We also add a phrase argument to NewMessage:\nfunc NewMessage(phrase string) Message { return Message(phrase) } After we run wire again, we will see that the tool has generated an initializer which passes the phrase value as a Message into Greeter. Neat!\n// wire_gen.go  func InitializeEvent(phrase string) (Event, error) { message := NewMessage(phrase) greeter := NewGreeter(message) event, err := NewEvent(greeter) if err != nil { return Event{}, err } return event, nil } Wire inspects the arguments to the injector, sees that we added a string to the list of arguments (e.g., phrase), and likewise sees that among all the providers, NewMessage takes a string, and so it passes phrase into NewMessage.\nCatching Mistakes with Helpful Errors Let\u0026rsquo;s also look at what happens when Wire detects mistakes in our code and see how Wire\u0026rsquo;s error messages help us correct any problems.\nFor example, when writing our injector InitializeEvent, let\u0026rsquo;s say we forget to add a provider for Greeter. Let\u0026rsquo;s see what happens:\nfunc InitializeEvent(phrase string) (Event, error) { wire.Build(NewEvent, NewMessage) // woops! We forgot to add a provider for Greeter  return Event{}, nil } Running wire, we see the following:\n# wrapping the error across lines for readability $GOPATH/src/github.com/google/wire/_tutorial/wire.go:24:1: inject InitializeEvent: no provider found for github.com/google/wire/_tutorial.Greeter (required by provider of github.com/google/wire/_tutorial.Event) wire: generate failed Wire is telling us some useful information: it cannot find a provider for Greeter. Note that the error message prints out the full path to the Greeter type. It\u0026rsquo;s also telling us the line number and injector name where the problem occurred: line 24 inside InitializeEvent. In addition, the error message tells us which provider needs a Greeter. It\u0026rsquo;s the Event type. Once we pass in a provider of Greeter, the problem will be solved.\nAlternatively, what happens if we provide one too many providers to wire.Build?\nfunc NewEventNumber() int { return 1 } func InitializeEvent(phrase string) (Event, error) { // woops! NewEventNumber is unused.  wire.Build(NewEvent, NewGreeter, NewMessage, NewEventNumber) return Event{}, nil } Wire helpfully tells us that we have an unused provider:\n$GOPATH/src/github.com/google/wire/_tutorial/wire.go:24:1: inject InitializeEvent: unused provider \u0026#34;NewEventNumber\u0026#34; wire: generate failed Deleting the unused provider from the call to wire.Build resolves the error.\nConclusion Let\u0026rsquo;s summarize what we have done here. First, we wrote a number of components with corresponding initializers, or providers. Next, we created an injector function, specifying which arguments it receives and which types it returns. Then, we filled in the injector function with a call to wire.Build supplying all necessary providers. Finally, we ran the wire command to generate code that wires up all the different initializers. When we added an argument to the injector and an error return value, running wire again made all the necessary updates to our generated code.\nThe example here is small, but it demonstrates some of the power of Wire, and how it takes much of the pain out of initializing code using dependency injection. Furthermore, using Wire produced code that looks much like what we would otherwise write. There are no bespoke types that commit a user to Wire. Instead it\u0026rsquo;s just generated code. We may do with it what we will. Finally, another point worth considering is how easy it is to add new dependencies to our component initialization. As long as we tell Wire how to provide (i.e., initialize) a component, we may add that component anywhere in the dependency graph and Wire will handle the rest.\nIn closing, it is worth mentioning that Wire supports a number of additional features not discussed here. Providers may be grouped in provider sets. There is support for binding interfaces, binding values, as well as support for cleanup functions. See the Advanced Features section for more.\n","permalink":"http://yangchnet.github.io/Dessert/posts/golang/%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5wire%E5%8C%85%E7%9A%84%E4%BD%BF%E7%94%A8/","summary":"å®˜æ–¹æ•™ç¨‹ï¼Œå†™çš„å¾ˆå¥½ï¼Œæˆ‘å°±ä¸å¤šè¯´äº†\n Let\u0026rsquo;s learn to use Wire by example. The Wire guide provides thorough documentation of the tool\u0026rsquo;s usage. For readers eager to see Wire applied to a larger server, the guestbook sample in Go Cloud uses Wire to initialize its components. Here we are going to build a small greeter program to understand how to use Wire. The finished product may be found in the same directory as this README.","title":"ä¾èµ–æ³¨å…¥ï¼šwireåŒ…çš„ä½¿ç”¨"},{"content":"1. æ ˆï¼ˆstackï¼‰ æ ˆç”¨äºå­˜å‚¨å‡½æ•°ï¼ˆåŒ…æ‹¬ä¸»å‡½æ•°ï¼‰å†…éƒ¨ä½¿ç”¨çš„å˜é‡ï¼Œæ˜¯ä¸€ä¸ªå…ˆè¿›å…ˆå‡ºï¼ˆLIFOï¼‰ç»“æ„ï¼Œæ¯æ¬¡å£°æ˜ä¸€ä¸ªæ–°å˜é‡ï¼Œéƒ½ä¼šå°†å…¶æ¨å…¥æ ˆä¸­ã€‚å½“å‡½æ•°è¿è¡Œç»“æŸæ—¶ï¼Œæ ˆä¸Šä¸Šä¸è¯¥å‡½æ•°æ‰€æœ‰ç›¸å…³çš„å˜é‡ï¼ˆç§°ä¸ºä¸€ä¸ªæ ˆå¸§ï¼‰å°†è¢«é‡Šæ”¾ã€‚æ ˆç”±CPUè‡ªåŠ¨ç®¡ç†ï¼Œç”¨æˆ·ä¸å¿…å…³å¿ƒå¦‚ä½•åˆ†é…å’Œé‡Šæ”¾å†…å­˜ã€‚æ ˆå†…å­˜åˆ†ä¸ºæ ˆå¸§ï¼Œæ¯æ¬¡å‡½æ•°è°ƒç”¨éƒ½ä¼šä¸ºå…¶åˆ†é…ä¸€ä¸ªæ ˆå¸§ï¼Œåœ¨å‡½æ•°è¿”å›æ—¶é‡Šæ”¾ã€‚\næ ˆçš„å¤§å°é€šå¸¸æœ‰é™ï¼Œå¦‚æœç¨‹åºè¯•å›¾å°†è¿‡å¤šçš„ä¿¡æ¯æ”¾å…¥æ ˆä¸­ï¼Œå°±ä¼šå‡ºç°æ ˆæº¢å‡ºã€‚\næ ˆçš„å…ˆè¿›åå‡ºå¹¶ä¸æ˜¯æŒ‡æ ˆä¸­çš„å˜é‡æ˜¯å…ˆè¿›åå‡ºçš„ï¼Œè€Œæ˜¯æŒ‡\u0026quot;æ ˆå¸§\u0026quot;çš„å…ˆè¿›åå‡ºï¼Œè¿™ä¿è¯äº†å‡½æ•°çš„è°ƒç”¨é¡ºåºã€‚\n æ ˆå†…å­˜ç”±CPUç®¡ç† å˜é‡è‡ªåŠ¨åˆ†é…å’Œé‡Šæ”¾ æ ˆçš„å¤§å°æœ‰é™åˆ¶ å½“å˜é‡åˆ›å»ºå’Œé”€æ¯æ—¶ï¼Œæ ˆä¼šå¢é•¿å’Œæ”¶ç¼©  2. å †ï¼ˆheapï¼‰ å †æ˜¯ä¸€å—å¤§çš„å†…å­˜ï¼Œæ”¯æŒåŠ¨æ€åˆ†é…ï¼Œç”±ç”¨æˆ·è´Ÿè´£ç®¡ç†ã€‚å¯ä»¥é€šè¿‡mallocæ–¹æ³•åˆ†é…å†…å­˜ï¼Œé€šè¿‡freeæ–¹æ³•å›æ”¶å†…å­˜ï¼Œè‹¥å†…å­˜ä½¿ç”¨åæ²¡æœ‰å›æ”¶ï¼Œåˆ™ä¼šå¯¼è‡´\u0026quot;å†…å­˜æ³„æ¼\u0026quot;ï¼Œå³è¿™å—å†…å­˜æ— æ³•è¢«å…¶ä»–è¿›ç¨‹æ‰€ç”¨ã€‚\nä¸æ ˆä¸åŒï¼Œé™¤ç‰©ç†å†…å­˜å¤§å°çš„é™åˆ¶ï¼Œå †çš„å¤§å°æ²¡æœ‰ä¸¥æ ¼é™åˆ¶ã€‚åœ¨å †ä¸­åˆ›å»ºçš„å˜é‡å¯åœ¨ç¨‹åºçš„ä»»ä½•åœ°æ–¹è®¿é—®ï¼ˆå…¨å±€å˜é‡ï¼‰ã€‚\n å †å†…å­˜ç”±ç¨‹åºå‘˜ç®¡ç† åœ¨Cä¸­ï¼Œä½¿ç”¨mallocå’Œfreeæ¥åˆ†é…å’Œé‡Šæ”¾å †å†…å­˜ éœ€è¦ç”¨æŒ‡é’ˆè®¿é—®å †  3. è€ƒè™‘ä»¥ä¸‹ç¨‹åº\n#include \u0026lt;stdio.h\u0026gt;#include \u0026lt;stdlib.h\u0026gt; int x; int main(void) { int y; char *str; y = 4; printf(\u0026#34;stack memory: %d\\n\u0026#34;, y); str = malloc(100 * sizeof(char)); str[0] = \u0026#39;m\u0026#39;; printf(\u0026#34;heap memory: %c\\n\u0026#34;, str[0]); free(str); return 0; } åœ¨ä¸Šé¢è¿™æ®µç¨‹åºä¸­ï¼Œxæ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œyå’Œstréƒ½æ˜¯å±€éƒ¨å˜é‡ã€‚mallocä¸ºstråœ¨å †ä¸Šåˆ†é…äº†100ä¸ªå­—èŠ‚çš„å†…å­˜ï¼Œfreeåˆ™é‡Šæ”¾äº†åˆ†é…çš„è¿™äº›å†…å­˜ã€‚\n   å‚æ•° å † å †     æ•°æ®ç»“æ„ç±»å‹ å †æ ˆæ˜¯çº¿æ€§æ•°æ®ç»“æ„ã€‚ å †æ˜¯ä¸€ä¸ªå±‚æ¬¡æ•°æ®ç»“æ„ã€‚   è®¿é—®é€Ÿåº¦ é«˜é€Ÿè®¿é—® ä¸å †æ ˆç›¸æ¯”é€Ÿåº¦è¾ƒæ…¢   ç©ºé—´ç®¡ç† ç©ºé—´ç”±æ“ä½œç³»ç»Ÿé«˜æ•ˆç®¡ç†ï¼Œå› æ­¤å†…å­˜æ°¸è¿œä¸ä¼šå˜å¾—æ”¯ç¦»ç ´ç¢ã€‚ å †ç©ºé—´æ²¡æœ‰æœ‰æ•ˆåœ°ä½¿ç”¨ã€‚å½“å†…å­˜å—é¦–å…ˆåˆ†é…ç„¶åé‡Šæ”¾æ—¶ï¼Œå†…å­˜å¯èƒ½ä¼šå˜å¾—æ”¯ç¦»ç ´ç¢ã€‚   è®¿é—® ä»…é™æœ¬åœ°å˜é‡ å®ƒå…è®¸æ‚¨åœ¨å…¨çƒèŒƒå›´å†…è®¿é—®å˜é‡ã€‚   ç©ºé—´å¤§å°é™åˆ¶ å–å†³äºæ“ä½œç³»ç»Ÿçš„å †æ ˆå¤§å°é™åˆ¶ã€‚ å†…å­˜å¤§å°æ²¡æœ‰ç‰¹å®šçš„é™åˆ¶ã€‚   è°ƒæ•´ å˜é‡æ— æ³•é‡æ–°ç¼©æ”¾ å˜é‡å¯ä»¥é‡æ–°ç¼©æ”¾ã€‚   å†…å­˜åˆ†é… å†…å­˜è¢«åˆ†é…åˆ°ä¸€ä¸ªè¿ç»­å—ä¸­ã€‚ å†…å­˜ä»¥ä»»æ„éšæœºé¡ºåºåˆ†é…ã€‚   åˆ†é…å’Œäº¤æ˜“å®šä½ é€šè¿‡ç¼–è¯‘å™¨è¯´æ˜è‡ªåŠ¨å®Œæˆã€‚ å®ƒç”±ç¨‹åºå‘˜æ‰‹åŠ¨å®Œæˆã€‚   é‡Šæ”¾ ä¸éœ€è¦å»åˆ†é…å˜é‡ã€‚ éœ€è¦æ˜ç¡®å»åˆ†é…ã€‚   æˆæœ¬ å°‘ æ›´å¤š   å®ç° åŸºäºç®€å•é˜µåˆ—ã€ä½¿ç”¨åŠ¨æ€å†…å­˜å’ŒåŸºäºé“¾æ¥åˆ—è¡¨çš„ 3 ç§æ–¹å¼å¯ä»¥å®ç°å †æ ˆã€‚ å †å¯ä»¥ä½¿ç”¨é˜µåˆ—å’Œæ ‘æœ¨å®ç°ã€‚   ä¸»è¦é—®é¢˜ å†…å­˜ä¸è¶³ å†…å­˜ç¢ç‰‡   å‚è€ƒåœ°åŒº è‡ªåŠ¨ç¼–è¯‘æ—¶é—´è¯´æ˜ã€‚ è¶³å¤Ÿ   çµæ´»æ€§ å›ºå®šå°ºå¯¸ è°ƒæ•´å¤§å°æ˜¯å¯èƒ½çš„   è®¿é—®æ—¶é—´ æ›´å¿« æ…¢    ","permalink":"http://yangchnet.github.io/Dessert/posts/linux/%E5%A0%86%E5%92%8C%E6%A0%88%E7%9A%84%E5%8C%BA%E5%88%AB/","summary":"1. æ ˆï¼ˆstackï¼‰ æ ˆç”¨äºå­˜å‚¨å‡½æ•°ï¼ˆåŒ…æ‹¬ä¸»å‡½æ•°ï¼‰å†…éƒ¨ä½¿ç”¨çš„å˜é‡ï¼Œæ˜¯ä¸€ä¸ªå…ˆè¿›å…ˆå‡ºï¼ˆLIFOï¼‰ç»“æ„ï¼Œæ¯æ¬¡å£°æ˜ä¸€ä¸ªæ–°å˜é‡ï¼Œéƒ½ä¼šå°†å…¶æ¨å…¥æ ˆä¸­ã€‚å½“å‡½æ•°è¿è¡Œç»“æŸæ—¶ï¼Œæ ˆä¸Šä¸Šä¸è¯¥å‡½æ•°æ‰€æœ‰ç›¸å…³çš„å˜é‡ï¼ˆç§°ä¸ºä¸€ä¸ªæ ˆå¸§ï¼‰å°†è¢«é‡Šæ”¾ã€‚æ ˆç”±CPUè‡ªåŠ¨ç®¡ç†ï¼Œç”¨æˆ·ä¸å¿…å…³å¿ƒå¦‚ä½•åˆ†é…å’Œé‡Šæ”¾å†…å­˜ã€‚æ ˆå†…å­˜åˆ†ä¸ºæ ˆå¸§ï¼Œæ¯æ¬¡å‡½æ•°è°ƒç”¨éƒ½ä¼šä¸ºå…¶åˆ†é…ä¸€ä¸ªæ ˆå¸§ï¼Œåœ¨å‡½æ•°è¿”å›æ—¶é‡Šæ”¾ã€‚\næ ˆçš„å¤§å°é€šå¸¸æœ‰é™ï¼Œå¦‚æœç¨‹åºè¯•å›¾å°†è¿‡å¤šçš„ä¿¡æ¯æ”¾å…¥æ ˆä¸­ï¼Œå°±ä¼šå‡ºç°æ ˆæº¢å‡ºã€‚\næ ˆçš„å…ˆè¿›åå‡ºå¹¶ä¸æ˜¯æŒ‡æ ˆä¸­çš„å˜é‡æ˜¯å…ˆè¿›åå‡ºçš„ï¼Œè€Œæ˜¯æŒ‡\u0026quot;æ ˆå¸§\u0026quot;çš„å…ˆè¿›åå‡ºï¼Œè¿™ä¿è¯äº†å‡½æ•°çš„è°ƒç”¨é¡ºåºã€‚\n æ ˆå†…å­˜ç”±CPUç®¡ç† å˜é‡è‡ªåŠ¨åˆ†é…å’Œé‡Šæ”¾ æ ˆçš„å¤§å°æœ‰é™åˆ¶ å½“å˜é‡åˆ›å»ºå’Œé”€æ¯æ—¶ï¼Œæ ˆä¼šå¢é•¿å’Œæ”¶ç¼©  2. å †ï¼ˆheapï¼‰ å †æ˜¯ä¸€å—å¤§çš„å†…å­˜ï¼Œæ”¯æŒåŠ¨æ€åˆ†é…ï¼Œç”±ç”¨æˆ·è´Ÿè´£ç®¡ç†ã€‚å¯ä»¥é€šè¿‡mallocæ–¹æ³•åˆ†é…å†…å­˜ï¼Œé€šè¿‡freeæ–¹æ³•å›æ”¶å†…å­˜ï¼Œè‹¥å†…å­˜ä½¿ç”¨åæ²¡æœ‰å›æ”¶ï¼Œåˆ™ä¼šå¯¼è‡´\u0026quot;å†…å­˜æ³„æ¼\u0026quot;ï¼Œå³è¿™å—å†…å­˜æ— æ³•è¢«å…¶ä»–è¿›ç¨‹æ‰€ç”¨ã€‚\nä¸æ ˆä¸åŒï¼Œé™¤ç‰©ç†å†…å­˜å¤§å°çš„é™åˆ¶ï¼Œå †çš„å¤§å°æ²¡æœ‰ä¸¥æ ¼é™åˆ¶ã€‚åœ¨å †ä¸­åˆ›å»ºçš„å˜é‡å¯åœ¨ç¨‹åºçš„ä»»ä½•åœ°æ–¹è®¿é—®ï¼ˆå…¨å±€å˜é‡ï¼‰ã€‚\n å †å†…å­˜ç”±ç¨‹åºå‘˜ç®¡ç† åœ¨Cä¸­ï¼Œä½¿ç”¨mallocå’Œfreeæ¥åˆ†é…å’Œé‡Šæ”¾å †å†…å­˜ éœ€è¦ç”¨æŒ‡é’ˆè®¿é—®å †  3. è€ƒè™‘ä»¥ä¸‹ç¨‹åº\n#include \u0026lt;stdio.h\u0026gt;#include \u0026lt;stdlib.h\u0026gt; int x; int main(void) { int y; char *str; y = 4; printf(\u0026#34;stack memory: %d\\n\u0026#34;, y); str = malloc(100 * sizeof(char)); str[0] = \u0026#39;m\u0026#39;; printf(\u0026#34;heap memory: %c\\n\u0026#34;, str[0]); free(str); return 0; } åœ¨ä¸Šé¢è¿™æ®µç¨‹åºä¸­ï¼Œxæ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œyå’Œstréƒ½æ˜¯å±€éƒ¨å˜é‡ã€‚mallocä¸ºstråœ¨å †ä¸Šåˆ†é…äº†100ä¸ªå­—èŠ‚çš„å†…å­˜ï¼Œfreeåˆ™é‡Šæ”¾äº†åˆ†é…çš„è¿™äº›å†…å­˜ã€‚\n   å‚æ•° å † å †     æ•°æ®ç»“æ„ç±»å‹ å †æ ˆæ˜¯çº¿æ€§æ•°æ®ç»“æ„ã€‚ å †æ˜¯ä¸€ä¸ªå±‚æ¬¡æ•°æ®ç»“æ„ã€‚   è®¿é—®é€Ÿåº¦ é«˜é€Ÿè®¿é—® ä¸å †æ ˆç›¸æ¯”é€Ÿåº¦è¾ƒæ…¢   ç©ºé—´ç®¡ç† ç©ºé—´ç”±æ“ä½œç³»ç»Ÿé«˜æ•ˆç®¡ç†ï¼Œå› æ­¤å†…å­˜æ°¸è¿œä¸ä¼šå˜å¾—æ”¯ç¦»ç ´ç¢ã€‚ å †ç©ºé—´æ²¡æœ‰æœ‰æ•ˆåœ°ä½¿ç”¨ã€‚å½“å†…å­˜å—é¦–å…ˆåˆ†é…ç„¶åé‡Šæ”¾æ—¶ï¼Œå†…å­˜å¯èƒ½ä¼šå˜å¾—æ”¯ç¦»ç ´ç¢ã€‚   è®¿é—® ä»…é™æœ¬åœ°å˜é‡ å®ƒå…è®¸æ‚¨åœ¨å…¨çƒèŒƒå›´å†…è®¿é—®å˜é‡ã€‚   ç©ºé—´å¤§å°é™åˆ¶ å–å†³äºæ“ä½œç³»ç»Ÿçš„å †æ ˆå¤§å°é™åˆ¶ã€‚ å†…å­˜å¤§å°æ²¡æœ‰ç‰¹å®šçš„é™åˆ¶ã€‚   è°ƒæ•´ å˜é‡æ— æ³•é‡æ–°ç¼©æ”¾ å˜é‡å¯ä»¥é‡æ–°ç¼©æ”¾ã€‚   å†…å­˜åˆ†é… å†…å­˜è¢«åˆ†é…åˆ°ä¸€ä¸ªè¿ç»­å—ä¸­ã€‚ å†…å­˜ä»¥ä»»æ„éšæœºé¡ºåºåˆ†é…ã€‚   åˆ†é…å’Œäº¤æ˜“å®šä½ é€šè¿‡ç¼–è¯‘å™¨è¯´æ˜è‡ªåŠ¨å®Œæˆã€‚ å®ƒç”±ç¨‹åºå‘˜æ‰‹åŠ¨å®Œæˆã€‚   é‡Šæ”¾ ä¸éœ€è¦å»åˆ†é…å˜é‡ã€‚ éœ€è¦æ˜ç¡®å»åˆ†é…ã€‚   æˆæœ¬ å°‘ æ›´å¤š   å®ç° åŸºäºç®€å•é˜µåˆ—ã€ä½¿ç”¨åŠ¨æ€å†…å­˜å’ŒåŸºäºé“¾æ¥åˆ—è¡¨çš„ 3 ç§æ–¹å¼å¯ä»¥å®ç°å †æ ˆã€‚ å †å¯ä»¥ä½¿ç”¨é˜µåˆ—å’Œæ ‘æœ¨å®ç°ã€‚   ä¸»è¦é—®é¢˜ å†…å­˜ä¸è¶³ å†…å­˜ç¢ç‰‡   å‚è€ƒåœ°åŒº è‡ªåŠ¨ç¼–è¯‘æ—¶é—´è¯´æ˜ã€‚ è¶³å¤Ÿ   çµæ´»æ€§ å›ºå®šå°ºå¯¸ è°ƒæ•´å¤§å°æ˜¯å¯èƒ½çš„   è®¿é—®æ—¶é—´ æ›´å¿« æ…¢    ","title":"å †å’Œæ ˆçš„åŒºåˆ«"},{"content":"1. wazsmwazsm/mortarï¼ˆâ˜…74ï¼‰ ç®€å•ä»‹ç»\nåˆ›å»ºä¸€ä¸ªå®¹é‡ä¸º N çš„æ± , åœ¨æ± å®¹é‡æœªæ»¡æ—¶, æ¯å¡å…¥ä¸€ä¸ªä»»åŠ¡ï¼ˆç”Ÿäº§ä»»åŠ¡ï¼‰, ä»»åŠ¡æ± å¼€å¯ä¸€ä¸ª worker (å»ºç«‹åç¨‹) å»å¤„ç†ä»»åŠ¡ï¼ˆæ¶ˆè´¹ä»»åŠ¡ï¼‰ã€‚ å½“ä»»åŠ¡æ± å®¹é‡èµ›æ»¡ï¼Œæ¯å¡å…¥ä¸€ä¸ªä»»åŠ¡ï¼ˆç”Ÿäº§ä»»åŠ¡ï¼‰, ä»»åŠ¡ä¼šè¢«å·²æœ‰çš„ N ä¸ª worker æŠ¢å æ‰§è¡Œï¼ˆæ¶ˆè´¹ä»»åŠ¡ï¼‰ï¼Œè¾¾åˆ°åç¨‹é™åˆ¶çš„åŠŸèƒ½ã€‚ä½†workeråˆ›å»ºåä¸ä¼šå›æ”¶ï¼Œé™¤éå°†æ•´ä¸ªpoolæ’¤é”€ã€‚\nç»“æ„\ntype Task struct { Handler func(v ...interface{}) // å‡½æ•°ç­¾å \tParams []interface{} // å‚æ•° } // Pool task pool type Pool struct { capacity uint64 // æ± çš„å®¹é‡ï¼Œè‡ªè¡Œåˆ¶å®š \trunningWorkers uint64 // æ­£åœ¨è¿è¡Œçš„worker \tstatus int64 // æ± çš„çŠ¶æ€ \tchTask chan *Task // ä»»åŠ¡é˜Ÿåˆ—ï¼Œworkerä»ä¸­è·å–ä»»åŠ¡ \tPanicHandler func(interface{}) // è‡ªå®šä¹‰çš„PanicHandlerï¼Œé˜²æ­¢å› æŸä¸ªgoroutineå‘ç”Ÿpanicè€Œå¯¼è‡´æœåŠ¡å´©æºƒã€‚ \tsync.Mutex // å…¨å±€é” } æ ¸å¿ƒä»£ç \n// Put put a task to pool func (p *Pool) Put(task *Task) error { p.Lock() // åŠ é”ï¼Œé˜²æ­¢æ•°æ®ç«äº‰ \tdefer p.Unlock() if p.status == STOPED { // æ£€æŸ¥æ± æ˜¯å¦è¿˜åœ¨è¿è¡Œ \treturn ErrPoolAlreadyClosed } // run worker \tif p.GetRunningWorkers() \u0026lt; p.GetCap() { // workeræ•°é‡å°šæœªè¾¾åˆ°å®¹é‡é™åˆ¶ï¼Œæ–°å»ºä¸€ä¸ªworker \tp.run() // è¿™é‡Œå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œè‹¥æ± ä¸­æœ‰ç©ºé—²çš„workerï¼Œä¹Ÿä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„workerï¼Œè¿™ä¸ªworkeråˆ›å»ºåä¹Ÿä¼šç©ºé—²ï¼Œå­˜åœ¨èµ„æºæµªè´¹ \t} // send task \tif p.status == RUNNING { p.chTask \u0026lt;- task // å‘ä»»åŠ¡é˜Ÿåˆ—å‘é€ä»»åŠ¡ \t} return nil } func (p *Pool) run() { p.incRunning() // workerè®¡æ•°+1  go func() { defer func() { // é˜²æ­¢å› æŸä¸ªgoroutineå‘ç”Ÿpanicè€Œå¯¼è‡´æœåŠ¡å´©æºƒ \tp.decRunning() // workerè®¡æ•°å‡1 \tif r := recover(); r != nil { if p.PanicHandler != nil { p.PanicHandler(r) // è‡ªå®šä¹‰äº†panicåæ“ä½œ \t} else { log.Printf(\u0026#34;Worker panic: %s\\n\u0026#34;, r) // panicåé»˜è®¤æ“ä½œ \t} } p.checkWorker() // æ£€æŸ¥æ˜¯å¦è¿˜æœ‰workeråœ¨è¿è¡Œï¼Œä¿æŒæœ€å°‘ä¸€ä¸ªworker \t}() for { // worker ä¿æŒè¿è¡Œ \tselect { case task, ok := \u0026lt;-p.chTask: // æ¥æ”¶task \tif !ok { // å½“ä»»åŠ¡é˜Ÿåˆ—è¢«å…³é—­æ˜¯goroutineé€€å‡º \treturn } task.Handler(task.Params...) // æ‰§è¡Œä»»åŠ¡ \t} } }() } åœ¨Putå‡½æ•°ä¸­ï¼Œæ¯å½“æ”¾å…¥ä¸€ä¸ªæ–°ä»»åŠ¡ä¹‹å‰ï¼Œéƒ½ä¼šç›´æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„workerï¼Œè¿™æ˜¾ç„¶ä¸ç”šåˆç†ï¼Œå› ä¸ºæ­¤æ—¶æ± ä¸­å¯èƒ½å­˜åœ¨ç©ºé—²çš„workerï¼Œåº”è®¾æ³•åˆ©ç”¨è¿™äº›ç©ºé—²çš„workerè€Œä¸æ˜¯åˆ›å»ºæ–°çš„workerã€‚\n å°è¯•ä¼˜åŒ–\n ä¸€ç§ä¼˜åŒ–æ€è·¯æ˜¯ï¼šåœ¨Poolå¯¹è±¡ä¸­å¢åŠ chIdle chan struct{}å­—æ®µï¼Œä½œä¸ºç©ºé—²æ ‡å¿—ã€‚æ”¾å…¥ä»»åŠ¡ä¹‹å‰é¦–å…ˆæ£€æŸ¥chIdleæ˜¯å¦å­˜åœ¨ç©ºé—²æ ‡å¿—ï¼Œè‹¥å­˜åœ¨ï¼Œåˆ™è¯´æ˜æ­¤æ—¶å­˜åœ¨ç©ºé—²workerï¼Œä¸éœ€åˆ›å»ºæ–°çš„workerï¼Œåªéœ€å°†taskæ”¾å…¥å³å¯ã€‚ è€Œè‹¥chIdleä¸­ä¸å­˜åœ¨ç©ºé—²æ ‡å¿—ï¼Œåˆ™æ£€æŸ¥workeræ•°é‡æ˜¯å¦è¾¾åˆ°é™åˆ¶ï¼Œç„¶ååˆ›å»ºæ–°çš„workerã€‚ ä¼˜åŒ–åçš„æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š\ntype Pool struct { capacity uint64 runningWorkers uint64 status int64 chTask chan *Task chIdle chan struct{} PanicHandler func(interface{}) sync.Mutex } func (p *Pool) Put(task *Task) error { p.Lock() defer p.Unlock() if p.status == STOPED { return ErrPoolAlreadyClosed } select { case \u0026lt;-p.chIdle: default: if p.GetRunningWorkers() \u0026lt; p.GetCap() { p.run() } } // send task \tif p.status == RUNNING { p.chTask \u0026lt;- task } return nil } func (p *Pool) run() { p.incRunning() p.chIdle \u0026lt;- struct{}{} go func() { defer func() { p.decRunning() if r := recover(); r != nil { if p.PanicHandler != nil { p.PanicHandler(r) } else { log.Printf(\u0026#34;Worker panic: %s\\n\u0026#34;, r) } } p.checkWorker() // check worker avoid no worker running \t}() for { select { case task, ok := \u0026lt;-p.chTask: if !ok { return } task.Handler(task.Params...) p.chIdle \u0026lt;- struct{}{} } } }() } ä¼˜åŒ–å‰åbanchmarkæµ‹è¯•æ•°æ®å¯¹æ¯”å¦‚ä¸‹ï¼š\nä¼˜åŒ–å‰ï¼šBenchmarkPut-4 815876\t1460 ns/op\t0 B/op\t0 allocs/op ä¼˜åŒ–åï¼šBenchmarkPut-4 948046\t1323 ns/op\t0 B/op\t0 allocs/op ä¼˜åŒ–å‰: BenchmarkPutTimelife-4 1000000\t1287 ns/op\t0 B/op\t0 allocs/op ä¼˜åŒ–å: BenchmarkPutTimelife-4 930015\t1356 ns/op\t0 B/op\t0 allocs/op ä¼˜åŒ–å‰: BenchmarkPoolPutSetTimes-4 1\t1433118500 ns/op\t12104 B/op\t52 allocs/op ä¼˜åŒ–å: BenchmarkPoolPutSetTimes-4 1\t1474117300 ns/op\t8504 B/op\t42 allocs/op ä¼˜åŒ–å‰: BenchmarkPoolTimeLifeSetTimes-4 1\t1277515600 ns/op\t10208 B/op\t47 allocs/op ä¼˜åŒ–å: BenchmarkPoolTimeLifeSetTimes-4 1\t1279696300 ns/op\t7928 B/op\t39 allocs/op åŸºæœ¬ä½¿ç”¨\npackage main import ( \u0026#34;fmt\u0026#34; \u0026#34;sync\u0026#34; \u0026#34;github.com/wazsmwazsm/mortar\u0026#34; ) func main() { // åˆ›å»ºå®¹é‡ä¸º 10 çš„ä»»åŠ¡æ±  \tpool, err := mortar.NewPool(10) if err != nil { panic(err) } wg := new(sync.WaitGroup) for i := 0; i \u0026lt; 1000; i++ { wg.Add(1) // åˆ›å»ºä»»åŠ¡ \ttask := \u0026amp;mortar.Task{ Handler: func(v ...interface{}) { wg.Done() fmt.Println(v) }, } // æ·»åŠ ä»»åŠ¡å‡½æ•°çš„å‚æ•° \ttask.Params = []interface{}{i, i * 2, \u0026#34;hello\u0026#34;} // å°†ä»»åŠ¡æ”¾å…¥ä»»åŠ¡æ±  \tpool.Put(task) } wg.Add(1) // å†åˆ›å»ºä¸€ä¸ªä»»åŠ¡ \tpool.Put(\u0026amp;mortar.Task{ Handler: func(v ...interface{}) { wg.Done() fmt.Println(v) }, Params: []interface{}{\u0026#34;hi!\u0026#34;}, // ä¹Ÿå¯ä»¥åœ¨åˆ›å»ºä»»åŠ¡æ—¶è®¾ç½®å‚æ•° \t}) wg.Wait() // å®‰å…¨å…³é—­ä»»åŠ¡æ± ï¼ˆä¿è¯å·²åŠ å…¥æ± ä¸­çš„ä»»åŠ¡è¢«æ¶ˆè´¹å®Œï¼‰ \tpool.Close() // å¦‚æœä»»åŠ¡æ± å·²ç»å…³é—­, Put() æ–¹æ³•ä¼šè¿”å› ErrPoolAlreadyClosed é”™è¯¯ \terr = pool.Put(\u0026amp;mortar.Task{ Handler: func(v ...interface{}) {}, }) if err != nil { fmt.Println(err) // print: pool already closed \t} } æ€»ç»“ goroutineçš„å¤ç”¨å¾ˆå¥½çš„å‡å°äº†å¤§æ‰¹é‡å¼‚æ­¥ä»»åŠ¡ä¸­çš„å†…å­˜åˆ†é…ä¸åƒåœ¾å›æ”¶å‹åŠ›ï¼Œä½†ä¸èƒ½å›æ”¶çš„goroutineå¯èƒ½åœ¨ä»»åŠ¡æ³¢å³°è¿‡å»åæˆä¸ºå†…å­˜æµªè´¹ï¼ˆä¸æ’¤é”€æ± çš„æƒ…å†µä¸‹ï¼‰ï¼Œé€‚åˆç”¨äºé•¿æœŸå¤§è§„æ¨¡æ‰§è¡Œå¹¶å‘ä»»åŠ¡çš„æƒ…å†µä¸‹ã€‚\n2. go-playground/poolï¼ˆâ˜…614ï¼‰ ç®€å•ä»‹ç» æä¾›äº†LimitedPool,UnLimitedPoolä¸¤ç§æ± ï¼Œåˆ†åˆ«å¯ä»¥åˆ›å»º(workeræ•°é‡)æœ‰é™çš„workerå’Œæ— é™çš„workerï¼›æä¾›äº†Unit taskå’Œbatch Taskä¸¤ç§ä»»åŠ¡æ¨¡å¼ï¼Œåˆ†åˆ«é€‚ç”¨äºå•æ¬¡å¶å‘ä»»åŠ¡åŠå¤šæ¬¡é‡å¤ä»»åŠ¡ã€‚LimitedPool,UnLimitedPooléƒ½å®ç°äº†Poolæ¥å£ã€‚å¯é•¿æœŸä¿æŒè¿è¡Œã€‚\nç³»ç»Ÿç»“æ„\ntype Pool interface { Queue(fn WorkFunc) WorkUnit // ä¼ å…¥è¦æ‰§è¡Œçš„ä»»åŠ¡ï¼Œç«‹å³å¼€å§‹æ‰§è¡Œ \tReset() // é‡æ–°åˆå§‹åŒ–ä¸€ä¸ªæ±  \tCancel() // å–æ¶ˆæ‰€æœ‰æœªåœ¨è¿è¡Œçš„ä»»åŠ¡ \tClose() // æ¸…é™¤æ‰€æœ‰æ± æ•°æ®å¹¶å–æ¶ˆæ‰€æœ‰æœªæäº¤çš„ä»»åŠ¡ \tBatch() Batch // åˆ›å»ºæ‰¹é‡ä»»åŠ¡ } æ ¸å¿ƒä»£ç \n// passing work and cancel channels to newWorker() to avoid any potential race condition // betweeen p.work read \u0026amp; write func (p *limitedPool) newWorker(work chan *workUnit, cancel chan struct{}) { go func(p *limitedPool) { var wu *workUnit defer func(p *limitedPool) { if err := recover(); err != nil { // ... \t} }(p) var value interface{} var err error for { select { case wu = \u0026lt;-work: // possible for one more nilled out value to make it \t// through when channel closed, don\u0026#39;t quite understand the why \tif wu == nil { continue } // support for individual WorkUnit cancellation \t// and batch job cancellation \tif wu.cancelled.Load() == nil { value, err = wu.fn(wu) wu.writing.Store(struct{}{}) // need to check again in case the WorkFunc cancelled this unit of work \t// otherwise we\u0026#39;ll have a race condition \tif wu.cancelled.Load() == nil \u0026amp;\u0026amp; wu.cancelling.Load() == nil { wu.value, wu.err = value, err // who knows where the Done channel is being listened to on the other end \t// don\u0026#39;t want this to block just because caller is waiting on another unit \t// of work to be done first so we use close \tclose(wu.done) } } case \u0026lt;-cancel: return } } }(p) } // Queue queues the work to be run, and starts processing immediately func (p *limitedPool) Queue(fn WorkFunc) WorkUnit { w := \u0026amp;workUnit{ done: make(chan struct{}), fn: fn, } go func() { p.m.RLock() if p.closed { w.err = \u0026amp;ErrPoolClosed{s: errClosed} if w.cancelled.Load() == nil { close(w.done) } p.m.RUnlock() return } p.work \u0026lt;- w p.m.RUnlock() }() return w } åŸºæœ¬ä½¿ç”¨\n Per Unit Work\n package main import ( \u0026#34;fmt\u0026#34; \u0026#34;time\u0026#34; \u0026#34;gopkg.in/go-playground/pool.v3\u0026#34; ) func main() { p := pool.NewLimited(10) defer p.Close() user := p.Queue(getUser(13)) other := p.Queue(getOtherInfo(13)) user.Wait() if err := user.Error(); err != nil { // handle error \t} // do stuff with user \tusername := user.Value().(string) fmt.Println(username) other.Wait() if err := other.Error(); err != nil { // handle error \t} // do stuff with other \totherInfo := other.Value().(string) fmt.Println(otherInfo) } func getUser(id int) pool.WorkFunc { return func(wu pool.WorkUnit) (interface{}, error) { // simulate waiting for something, like TCP connection to be established \t// or connection from pool grabbed \ttime.Sleep(time.Second * 1) if wu.IsCancelled() { // return values not used \treturn nil, nil } // ready for processing...  return \u0026#34;Joeybloggs\u0026#34;, nil } } func getOtherInfo(id int) pool.WorkFunc { return func(wu pool.WorkUnit) (interface{}, error) { // simulate waiting for something, like TCP connection to be established \t// or connection from pool grabbed \ttime.Sleep(time.Second * 1) if wu.IsCancelled() { // return values not used \treturn nil, nil } // ready for processing...  return \u0026#34;Other Info\u0026#34;, nil } }  Batch Work\n package main import ( \u0026#34;fmt\u0026#34; \u0026#34;time\u0026#34; \u0026#34;gopkg.in/go-playground/pool.v3\u0026#34; ) func main() { p := pool.NewLimited(10) defer p.Close() batch := p.Batch() // for max speed Queue in another goroutine \t// but it is not required, just can\u0026#39;t start reading results \t// until all items are Queued.  go func() { for i := 0; i \u0026lt; 10; i++ { batch.Queue(sendEmail(\u0026#34;email content\u0026#34;)) } // DO NOT FORGET THIS OR GOROUTINES WILL DEADLOCK \t// if calling Cancel() it calles QueueComplete() internally \tbatch.QueueComplete() }() for email := range batch.Results() { if err := email.Error(); err != nil { // handle error \t// maybe call batch.Cancel() \t} // use return value \tfmt.Println(email.Value().(bool)) } } func sendEmail(email string) pool.WorkFunc { return func(wu pool.WorkUnit) (interface{}, error) { // simulate waiting for something, like TCP connection to be established \t// or connection from pool grabbed \ttime.Sleep(time.Second * 1) if wu.IsCancelled() { // return values not used \treturn nil, nil } // ready for processing...  return true, nil // everything ok, send nil, error if not \t} } æ€»ç»“ åŠŸèƒ½é½å…¨ï¼Œä½†å¥½åƒç”¨èµ·æ¥ä¸å¤ªèˆ’æœã€‚\n3. ivpusic/grpoolï¼ˆâ˜…634ï¼‰ ç®€å•ä»‹ç» ç”¨æˆ·å¯ä»¥æäº¤taskã€‚ Dispatcheræ¥å—taskï¼Œå¹¶å°†å…¶å‘é€ç»™ç¬¬ä¸€ä¸ªå¯ç”¨çš„workerã€‚ å½“workerå®Œæˆå¤„ç†å·¥ä½œæ—¶ï¼Œå°†è¿”å›åˆ°workers poolã€‚ workeræ•°é‡å’Œtaské˜Ÿåˆ—å¤§å°æ˜¯å¯é…ç½®çš„ã€‚\næ•´ä¸ªç¨‹åºä»¥ä¸€ä¸ªè°ƒåº¦å™¨ä¸ºæ ¸å¿ƒï¼ŒPoolé€šè¿‡è°ƒåº¦å™¨æ¥è°ƒåº¦workerï¼Œworkerå¯å¤ç”¨ï¼Œä½†ä»»åŠ¡ç»“æŸæ—¶workerä¸ä¼šè‡ªåŠ¨å›æ”¶ï¼Œä¸é€‚åˆé•¿æœŸè¿è¡Œã€‚åªèƒ½ä¼ é€’æ— å‚ä»»åŠ¡ã€‚\nç³»ç»Ÿç»“æ„\n// Gorouting instance which can accept client jobs type worker struct { workerPool chan *worker // å·¥äººæ±  \tjobChannel chan Job // è¿™ä¸ªworkerç‹¬æœ‰çš„ä»»åŠ¡é˜Ÿåˆ— \tstop chan struct{} } type dispatcher struct { workerPool chan *worker // ä¸workeræ˜¯åŒä¸€ä¸ªworkerPool \tjobQueue chan Job // ä¸æ± å…±æœ‰çš„ä»»åŠ¡é˜Ÿåˆ— \tstop chan struct{} } // Represents user request, function which should be executed in some worker. type Job func() type Pool struct { JobQueue chan Job // ä¸dispatcherå…±æœ‰çš„ä»»åŠ¡é˜Ÿåˆ— \tdispatcher *dispatcher wg sync.WaitGroup } æ ¸å¿ƒä»£ç \nfunc (w *worker) start() { go func() { // åˆ›å»ºäº†ä¸€ä¸ªworker \tvar job Job for { // worker free, add it to pool \tw.workerPool \u0026lt;- w // æŠŠworkeræ”¾å…¥workeræ±   select { case job = \u0026lt;-w.jobChannel: job() case \u0026lt;-w.stop: w.stop \u0026lt;- struct{}{} return } } }() } func (d *dispatcher) dispatch() { for { select { case job := \u0026lt;-d.jobQueue: worker := \u0026lt;-d.workerPool worker.jobChannel \u0026lt;- job case \u0026lt;-d.stop: // åœæ­¢æ‰€æœ‰worker \tfor i := 0; i \u0026lt; cap(d.workerPool); i++ { worker := \u0026lt;-d.workerPool worker.stop \u0026lt;- struct{}{} \u0026lt;-worker.stop } d.stop \u0026lt;- struct{}{} return } } } å…¶ç¨‹åºè¿è¡Œå›¾å¤§è‡´å¦‚ä¸‹ï¼š ç¨‹åºä¸­å­˜åœ¨ä¸€ä¸ªworkerPoolï¼Œæ‰€æœ‰çš„workeréƒ½å­˜åœ¨åœ¨è¿™ä¸ªæ± ä¸­ï¼Œåœ¨ç¨‹åºçš„å¼€å§‹ï¼Œä¼šåˆ›å»ºæŒ‡å®šæ•°ç›®çš„workerï¼Œä¸€æ¬¡æ€§æ”¾å…¥æ± ä¸­ï¼ˆæ­¤åä¸å†å¢åŠ æˆ–å‡å°‘ï¼‰ã€‚æ¯ä¸ªworkeræœ‰ä¸€ä¸ªç‹¬æœ‰çš„jobChannelï¼Œè¿™ä¸ªjobChannelå‘workerä¼ é€’å…¶è¦æ‰§è¡Œçš„ä»»åŠ¡ã€‚\nç”¨æˆ·é€šè¿‡ç›´æ¥ä½¿ç”¨Poolçš„JobQueueæ¥æäº¤ä»»åŠ¡ï¼Œæäº¤çš„ä»»åŠ¡ä¼šç”±dispatcheræ¥æ”¶ï¼Œç„¶ååˆ†é…ç»™æŸä¸ªç©ºé—²çš„workerï¼Œå³æ”¾å…¥å…¶jobChannelä¸­ã€‚\nåŸºæœ¬ä½¿ç”¨\npackage main import ( \u0026#34;fmt\u0026#34; \u0026#34;runtime\u0026#34; \u0026#34;time\u0026#34; \u0026#34;github.com/ivpusic/grpool\u0026#34; ) func main() { // number of workers, and size of job queue  pool := grpool.NewPool(100, 50) // release resources used by pool  defer pool.Release() // submit one or more jobs to pool  for i := 0; i \u0026lt; 10; i++ { count := i pool.JobQueue \u0026lt;- func() { fmt.Printf(\u0026#34;I am worker! Number %d\\n\u0026#34;, count) } } // dummy wait until jobs are finished  time.Sleep(1 * time.Second) } æ€§èƒ½æµ‹è¯•\næ€»ç»“ è®¾è®¡ç®€å•ï¼Œä»£ç ç®€æ´æ¸…æ™°ï¼Œä½†æ— panicæ¢å¤ï¼Œä¸èƒ½åŠ¨æ€æ‰©å®¹ï¼Œä»»åŠ¡ä¼ é€’ç®€é™‹ï¼Œæ„Ÿè§‰åƒæ˜¯ä¸€ä¸ªæœªå®Œæˆç‰ˆæœ¬çš„ä»»åŠ¡æ± \n4. Jeffail/tunnyï¼ˆâ˜…2.4kï¼‰ ç®€å•ä»‹ç» æœ‰ä¸¤ç§æ¨¡å¼ï¼Œç¬¬ä¸€ç§æ¨¡å¼åœ¨æ± åˆ›å»ºæ—¶å³æŒ‡å®šä»»åŠ¡ï¼Œæ± åˆ›å»ºå®Œæˆåä»»åŠ¡ä¸å¯æ›´æ”¹ï¼Œä½†å¯ä¼ å…¥ä¸åŒçš„å‚æ•°ï¼Œæœ‰è¿”å›å€¼ã€‚ç¬¬äºŒç§æ¨¡å¼åœ¨åˆ›å»ºæ—¶ä¸ç»™å®šä»»åŠ¡ï¼Œå¯åœ¨æ± åˆ›å»ºåè‡ªè¡ŒæŒ‡é…ä»»åŠ¡ï¼Œä½†åªå¯æ‰§è¡Œæ— å‚æ•°ä»»åŠ¡ä¸”æ— è¿”å›å€¼ã€‚æ”¯æŒè¶…æ—¶æœºåˆ¶ï¼Œå¦‚æœä»»åŠ¡è¶…è¿‡æ—¶é—´æœŸé™è¿˜æ²¡å®Œæˆï¼Œåˆ™ä¼šç»ˆæ­¢å¹¶è¿”å›é”™è¯¯ã€‚\nç³»ç»Ÿç»“æ„\ntype Pool struct { queuedJobs int64 // å½“å‰æŒ‚èµ·çš„ä»»åŠ¡æ•°  ctor func() Worker // åˆå§‹ä»»åŠ¡ \tworkers []*workerWrapper reqChan chan workRequest workerMut sync.Mutex } type workerWrapper struct { // è´Ÿè´£ç®¡ç†workerå’Œgoroutineçš„ç”Ÿå‘½å‘¨æœŸ \tworker Worker interruptChan chan struct{} // ä¸­æ­¢ä¿¡å·é€šé“ \treqChan chan\u0026lt;- workRequest // ç”¨äºå‘é€ä»»åŠ¡è¯·æ±‚ä¿¡å· \tcloseChan chan struct{} // é€€å‡ºä¿¡å·é€šé“ \tclosedChan chan struct{} // é€€å‡ºæ ‡å¿—é€šé“ } type workRequest struct { // ä»»åŠ¡è¯·æ±‚ä¿¡å· \tjobChan chan\u0026lt;- interface{} // ç”¨äºæ¥æ”¶ä»»åŠ¡ \tretChan \u0026lt;-chan interface{} // ç”¨äºè¿”å›ç»“æœ \tinterruptFunc func() } æ ¸å¿ƒä»£ç \nfunc (p *Pool) Process(payload interface{}) interface{} { // çœç•¥äº†éƒ¨åˆ†é”™è¯¯å¤„ç†ä»£ç  \trequest, open := \u0026lt;-p.reqChan request.jobChan \u0026lt;- payload payload, open = \u0026lt;-request.retChan // åŒæ­¥ç­‰å¾…ä»»åŠ¡å®Œæˆ \treturn payload } func (w *workerWrapper) run() { jobChan, retChan := make(chan interface{}), make(chan interface{}) defer func() { w.worker.Terminate() close(retChan) close(w.closedChan) }() for { // NOTE: Blocking here will prevent the worker from closing down. \tw.worker.BlockUntilReady() select { case w.reqChan \u0026lt;- workRequest{ // tunny.go:156 \tjobChan: jobChan, retChan: retChan, interruptFunc: w.interrupt, }: select { case payload := \u0026lt;-jobChan: // tunny.go: 161 \tresult := w.worker.Process(payload) select { case retChan \u0026lt;- result: // tunny.go: 163 \tcase \u0026lt;-w.interruptChan: w.interruptChan = make(chan struct{}) } case _, _ = \u0026lt;-w.interruptChan: w.interruptChan = make(chan struct{}) } case \u0026lt;-w.closeChan: return } } } æ ¹æ®ä»¥ä¸Šä»£ç ï¼Œå…¶ä¸»è¦æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š\n æŸä¸ªgoroutineç©ºé—²åï¼Œé€šè¿‡å…¶reqChané€šé“å‘é€workRequestã€‚workRequestä¸­åŒ…æ‹¬ä¸€ä¸ªjobChanï¼Œç”¨äºç”Ÿäº§è€…å‘é€ä»»åŠ¡ï¼›ä¸€ä¸ªretChanï¼Œç”¨äºè¿”å›æ‰§è¡Œç»“æœï¼›ä¸€ä¸ªinterrupt Funcï¼Œç”¨äºä»»åŠ¡æ‰§è¡Œè¶…æ—¶æ—¶å¼ºè¡Œåœæ­¢workerã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒreqChanæ˜¯æ± å’ŒworkerWrapperå…±æœ‰çš„ï¼Œå› æ­¤å‘é€çš„workRequestå¯ç›´æ¥è¢«æ± æ¥æ”¶åˆ°ã€‚ æ¯å½“æ± ä¸­æœ‰æ–°ä»»åŠ¡æ—¶ï¼Œæ± å°è¯•ä»reqChanä¸­è·å–ä¸€ä¸ªworkRequestï¼Œè‹¥è·å–åˆ°ï¼Œåˆ™å°†ä»»åŠ¡é€šè¿‡workRequestæŒæœ‰çš„jobChan(å³æŸä¸ªworkeræŒæœ‰çš„jobChan)å‘é€åˆ°worker å‘é€å®Œæ¯•åï¼ŒåŒæ­¥çš„ä»retChanä¸­è¯»å–ç»“æœã€‚ è‹¥è®¾ç½®äº†è¶…æ—¶æ—¶é—´ï¼Œåˆ™åœ¨æ—¶é—´è¶…æ—¶åä¼šå¼ºåˆ¶åœæ­¢  åŸºæœ¬ä½¿ç”¨\npackage main import ( \u0026#34;io/ioutil\u0026#34; \u0026#34;net/http\u0026#34; \u0026#34;runtime\u0026#34; \u0026#34;github.com/Jeffail/tunny\u0026#34; ) func main() { numCPUs := runtime.NumCPU() pool := tunny.NewFunc(numCPUs, func(payload interface{}) interface{} { var result []byte // TODO: Something CPU heavy with payload  return result }) defer pool.Close() http.HandleFunc(\u0026#34;/work\u0026#34;, func(w http.ResponseWriter, r *http.Request) { input, err := ioutil.ReadAll(r.Body) if err != nil { http.Error(w, \u0026#34;Internal error\u0026#34;, http.StatusInternalServerError) } defer r.Body.Close() // Funnel this work into our pool. This call is synchronous and will \t// block until the job is completed. \tresult := pool.Process(input) w.Write(result.([]byte)) }) http.ListenAndServe(\u0026#34;:8080\u0026#34;, nil) }  è¶…æ—¶æ¼”ç¤ºï¼š\n func main() { p := tunny.NewFunc(4, func(payload interface{}) interface{} { n := payload.(int) result := fib(n) time.Sleep(5 * time.Second) return result }) defer p.Close() var wg sync.WaitGroup wg.Add(4) for i := 0; i \u0026lt; 4; i++ { go func(i int) { n := rand.Intn(30) result, err := p.ProcessTimed(n, time.Second) nowStr := time.Now().Format(\u0026#34;2006-01-02 15:04:05\u0026#34;) if err != nil { fmt.Printf(\u0026#34;[%s]task(%d) failed:%v\\n\u0026#34;, nowStr, i, err) } else { fmt.Printf(\u0026#34;[%s]fib(%d) = %d\\n\u0026#34;, nowStr, n, result) } wg.Done() }(i) } wg.Wait() } func fib(n int) int { if n \u0026lt;= 1 { return 1 } return fib(n-1) + fib(n-2) } 5. panjf2000/antsï¼ˆâ˜…5.8kï¼‰ ç®€å•ä»‹ç» å¯åŠ¨æœåŠ¡ä¹‹æ—¶å…ˆåˆå§‹åŒ–ä¸€ä¸ª Goroutine Pool æ± ï¼Œè¿™ä¸ª Pool ç»´æŠ¤äº†ä¸€ä¸ªç±»ä¼¼æ ˆçš„ LIFO é˜Ÿåˆ— ï¼Œé‡Œé¢å­˜æ”¾è´Ÿè´£å¤„ç†ä»»åŠ¡çš„ Workerï¼Œç„¶ååœ¨ client ç«¯æäº¤ task åˆ° Pool ä¸­ä¹‹åï¼Œåœ¨ Pool å†…éƒ¨ï¼Œæ¥æ”¶ task ä¹‹åçš„æ ¸å¿ƒæ“ä½œæ˜¯ï¼š\n æ£€æŸ¥å½“å‰ Worker é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰å¯ç”¨çš„ Workerï¼Œå¦‚æœæœ‰ï¼Œå–å‡ºæ‰§è¡Œå½“å‰çš„ taskï¼› æ²¡æœ‰å¯ç”¨çš„ Workerï¼Œåˆ¤æ–­å½“å‰åœ¨è¿è¡Œçš„ Worker æ˜¯å¦å·²è¶…è¿‡è¯¥ Pool çš„å®¹é‡ï¼š{æ˜¯ â€”\u0026gt; å†åˆ¤æ–­å·¥ä½œæ± æ˜¯å¦ä¸ºéé˜»å¡æ¨¡å¼ï¼š[æ˜¯ â€”â€”\u0026gt; ç›´æ¥è¿”å› nilï¼Œå¦ â€”â€”\u0026gt; é˜»å¡ç­‰å¾…ç›´è‡³æœ‰ Worker è¢«æ”¾å› Pool]ï¼Œå¦ â€”\u0026gt; æ–°å¼€ä¸€ä¸ª Workerï¼ˆgoroutineï¼‰å¤„ç†}ï¼› æ¯ä¸ª Worker æ‰§è¡Œå®Œä»»åŠ¡ä¹‹åï¼Œæ”¾å› Pool çš„é˜Ÿåˆ—ä¸­ç­‰å¾…ã€‚  å¤§è‡´æµç¨‹å¦‚ä¸‹ï¼š è¿™ä¸ªåº“çš„äº®ç‚¹ä¹‹ä¸€æ˜¯å…¶ä¸ºæ¯ä¸€ä¸ªworkerè®¾ç½®äº†è¿‡æœŸæ—¶é—´ï¼Œè‹¥workerç©ºé—²äº†ä¸€å®šæ—¶é—´å°±ä¼šè¢«å›æ”¶ï¼Œå¾ˆå¥½çš„èŠ‚çº¦äº†èµ„æºã€‚\nç³»ç»Ÿç»“æ„\ntype Pool struct { capacity int32 // æ± çš„å®¹é‡  running int32 // æ­£åœ¨è¿è¡Œçš„worker  workers workerArray // å­˜å‚¨å¯è·å–çš„worker  state int32 // æ± çš„çŠ¶æ€  lock sync.Locker cond *sync.Cond // æ¡ä»¶å˜é‡ï¼Œç”¨äºåœ¨æ¡ä»¶æ»¡è¶³æ—¶å”¤é†’é˜»å¡çš„ç¨‹åº  workerCache sync.Pool blockingNum int // è¢«é˜»å¡çš„æ•°é‡  options *Options } type workerArray interface { len() int isEmpty() bool insert(worker *goWorker) error detach() *goWorker retrieveExpiry(duration time.Duration) []*goWorker reset() } type goWorker struct { pool *Pool task chan func() recycleTime time.Time // recycleTime will be update when putting a worker back into queue } æ ¸å¿ƒä»£ç \nfunc NewPool(size int, options ...Option) (*Pool, error) { if expiry := opts.ExpiryDuration; expiry \u0026lt; 0 { return nil, ErrInvalidPoolExpiry } else if expiry == 0 { opts.ExpiryDuration = DefaultCleanIntervalTime } p := \u0026amp;Pool{ capacity: int32(size), lock: internal.NewSpinLock(), options: opts, } p.workerCache.New = func() interface{} { return \u0026amp;goWorker{ pool: p, task: make(chan func(), workerChanCap), } } if p.options.PreAlloc { if size == -1 { return nil, ErrInvalidPreAllocSize } p.workers = newWorkerArray(loopQueueType, size) } else { p.workers = newWorkerArray(stackType, 0) } p.cond = sync.NewCond(p.lock) // Start a goroutine to clean up expired workers periodically. \tgo p.purgePeriodically() // ç”¨ä¸€ä¸ªç‹¬ç«‹çš„goroutineæ¥å›æ”¶è¿‡æœŸçš„worker  return p, nil } func (w *goWorker) run() { w.pool.incRunning() go func() { defer func() { w.pool.decRunning() w.pool.workerCache.Put(w) if p := recover(); p != nil { // ... \t} // Call Signal() here in case there are goroutine waiting for available workers. \tw.pool.cond.Signal() // å‘å‡ºä¿¡å·å”¤é†’æŸäº›é˜»å¡ç­‰å¾…workerçš„çº¿ç¨‹ \t}() for f := range w.task { if f == nil { return } f() if ok := w.pool.revertWorker(w); !ok { // å°†workeré‡æ–°æ”¾å…¥æ± ä¸­å¾ªç¯åˆ©ç”¨ \treturn } } }() } // è¿”å›ä¸€ä¸ªå¯ç”¨çš„worker func (p *Pool) retrieveWorker() (w *goWorker) { spawnWorker := func() { // è¿”å›ä¸€ä¸ªå¯ç”¨çš„worker \tw = p.workerCache.Get().(*goWorker) w.run() } p.lock.Lock() w = p.workers.detach() // å°è¯•ä»workeré˜Ÿåˆ—ä¸­å–worker \tif w != nil { // ä»é˜Ÿåˆ—ä¸­è·å¾—äº†workerï¼Œç›´æ¥è¿”å› \tp.lock.Unlock() } else if capacity := p.Cap(); capacity == -1 || capacity \u0026gt; p.Running() { // é˜Ÿåˆ—ä¸ºç©ºå…¶workeræ•°é‡æœªè¾¾åˆ°é™åˆ¶ï¼Œåˆ™ç”Ÿæˆæ–°çš„worker \tp.lock.Unlock() spawnWorker() } else { // é˜Ÿåˆ—ä¸ºç©ºä¸”æ•°é‡è¾¾åˆ°é™åˆ¶ï¼Œåˆ™é˜»å¡ç­‰å¾…å…¶ä»–workerç©ºé—² \tif p.options.Nonblocking { p.lock.Unlock() return } retry: if p.options.MaxBlockingTasks != 0 \u0026amp;\u0026amp; p.blockingNum \u0026gt;= p.options.MaxBlockingTasks { p.lock.Unlock() return } p.blockingNum++ p.cond.Wait() // é˜»å¡ç­‰å¾…å¯ç”¨çš„worker \tp.blockingNum-- var nw int if nw = p.Running(); nw == 0 { // awakened by the scavenger \tp.lock.Unlock() if !p.IsClosed() { spawnWorker() } return } if w = p.workers.detach(); w == nil { if nw \u0026lt; capacity { p.lock.Unlock() spawnWorker() return } goto retry } p.lock.Unlock() } return } // å®šæ—¶æ¸…ç†è¿‡æœŸworker // purgePeriodically clears expired workers periodically which runs in an individual goroutine, as a scavenger. func (p *Pool) purgePeriodically() { heartbeat := time.NewTicker(p.options.ExpiryDuration) defer heartbeat.Stop() for range heartbeat.C { if p.IsClosed() { break } p.lock.Lock() expiredWorkers := p.workers.retrieveExpiry(p.options.ExpiryDuration) p.lock.Unlock() // Notify obsolete workers to stop. \t// This notification must be outside the p.lock, since w.task \t// may be blocking and may consume a lot of time if many workers \t// are located on non-local CPUs. \tfor i := range expiredWorkers { expiredWorkers[i].task \u0026lt;- nil expiredWorkers[i] = nil } // There might be a situation that all workers have been cleaned up(no any worker is running) \t// while some invokers still get stuck in \u0026#34;p.cond.Wait()\u0026#34;, \t// then it ought to wake all those invokers. \tif p.Running() == 0 { p.cond.Broadcast() } } } func (wq *workerStack) retrieveExpiry(duration time.Duration) []*goWorker { n := wq.len() if n == 0 { return nil } expiryTime := time.Now().Add(-duration) index := wq.binarySearch(0, n-1, expiryTime) wq.expiry = wq.expiry[:0] if index != -1 { wq.expiry = append(wq.expiry, wq.items[:index+1]...) m := copy(wq.items, wq.items[index+1:]) for i := m; i \u0026lt; n; i++ { wq.items[i] = nil } wq.items = wq.items[:m] } return wq.expiry } åŸºæœ¬ä½¿ç”¨\npackage main import ( \u0026#34;fmt\u0026#34; \u0026#34;sync\u0026#34; \u0026#34;sync/atomic\u0026#34; \u0026#34;time\u0026#34; \u0026#34;github.com/panjf2000/ants/v2\u0026#34; ) var sum int32 func myFunc(i interface{}) { n := i.(int32) atomic.AddInt32(\u0026amp;sum, n) fmt.Printf(\u0026#34;run with %d\\n\u0026#34;, n) } func demoFunc() { time.Sleep(10 * time.Millisecond) fmt.Println(\u0026#34;Hello World!\u0026#34;) } func main() { defer ants.Release() runTimes := 1000 // Use the common pool. \tvar wg sync.WaitGroup syncCalculateSum := func() { demoFunc() wg.Done() } for i := 0; i \u0026lt; runTimes; i++ { wg.Add(1) _ = ants.Submit(syncCalculateSum) } wg.Wait() fmt.Printf(\u0026#34;running goroutines: %d\\n\u0026#34;, ants.Running()) fmt.Printf(\u0026#34;finish all tasks.\\n\u0026#34;) // Use the pool with a function, \t// set 10 to the capacity of goroutine pool and 1 second for expired duration. \tp, _ := ants.NewPoolWithFunc(10, func(i interface{}) { myFunc(i) wg.Done() }) defer p.Release() // Submit tasks one by one. \tfor i := 0; i \u0026lt; runTimes; i++ { wg.Add(1) _ = p.Invoke(int32(i)) } wg.Wait() fmt.Printf(\u0026#34;running goroutines: %d\\n\u0026#34;, p.Running()) fmt.Printf(\u0026#34;finish all tasks, result is %d\\n\u0026#34;, sum) } ","permalink":"http://yangchnet.github.io/Dessert/posts/golang/5%E7%A7%8Dgoroutine%E6%B1%A0%E7%9A%84%E5%AE%9E%E7%8E%B0%E4%B9%8B%E5%AF%B9%E6%AF%94/","summary":"1. wazsmwazsm/mortarï¼ˆâ˜…74ï¼‰ ç®€å•ä»‹ç»\nåˆ›å»ºä¸€ä¸ªå®¹é‡ä¸º N çš„æ± , åœ¨æ± å®¹é‡æœªæ»¡æ—¶, æ¯å¡å…¥ä¸€ä¸ªä»»åŠ¡ï¼ˆç”Ÿäº§ä»»åŠ¡ï¼‰, ä»»åŠ¡æ± å¼€å¯ä¸€ä¸ª worker (å»ºç«‹åç¨‹) å»å¤„ç†ä»»åŠ¡ï¼ˆæ¶ˆè´¹ä»»åŠ¡ï¼‰ã€‚ å½“ä»»åŠ¡æ± å®¹é‡èµ›æ»¡ï¼Œæ¯å¡å…¥ä¸€ä¸ªä»»åŠ¡ï¼ˆç”Ÿäº§ä»»åŠ¡ï¼‰, ä»»åŠ¡ä¼šè¢«å·²æœ‰çš„ N ä¸ª worker æŠ¢å æ‰§è¡Œï¼ˆæ¶ˆè´¹ä»»åŠ¡ï¼‰ï¼Œè¾¾åˆ°åç¨‹é™åˆ¶çš„åŠŸèƒ½ã€‚ä½†workeråˆ›å»ºåä¸ä¼šå›æ”¶ï¼Œé™¤éå°†æ•´ä¸ªpoolæ’¤é”€ã€‚\nç»“æ„\ntype Task struct { Handler func(v ...interface{}) // å‡½æ•°ç­¾å \tParams []interface{} // å‚æ•° } // Pool task pool type Pool struct { capacity uint64 // æ± çš„å®¹é‡ï¼Œè‡ªè¡Œåˆ¶å®š \trunningWorkers uint64 // æ­£åœ¨è¿è¡Œçš„worker \tstatus int64 // æ± çš„çŠ¶æ€ \tchTask chan *Task // ä»»åŠ¡é˜Ÿåˆ—ï¼Œworkerä»ä¸­è·å–ä»»åŠ¡ \tPanicHandler func(interface{}) // è‡ªå®šä¹‰çš„PanicHandlerï¼Œé˜²æ­¢å› æŸä¸ªgoroutineå‘ç”Ÿpanicè€Œå¯¼è‡´æœåŠ¡å´©æºƒã€‚ \tsync.Mutex // å…¨å±€é” } æ ¸å¿ƒä»£ç ","title":"5ç§goroutineæ± çš„å®ç°ä¹‹å¯¹æ¯”"},{"content":"1. evmè™šæ‹Ÿæœº äº¤æ˜“çš„æ‰§è¡Œæ˜¯åŒºå—é“¾èŠ‚ç‚¹ä¸Šçš„ä¸€ä¸ªé‡è¦çš„åŠŸèƒ½ã€‚æ˜¯æŠŠäº¤æ˜“ä¸­çš„æ™ºèƒ½åˆçº¦äºŒè¿›åˆ¶ä»£ç å–å‡ºæ¥ï¼Œç”¨æ‰§è¡Œå™¨ï¼ˆExecutorï¼‰æ‰§è¡Œã€‚åœ¨äº¤æ˜“çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¼šå¯¹åŒºå—é“¾çš„çŠ¶æ€ï¼ˆStateï¼‰è¿›è¡Œä¿®æ”¹ï¼Œå½¢æˆæ–°åŒºå—çš„çŠ¶æ€å‚¨å­˜ä¸‹æ¥ï¼ˆStorageï¼‰ã€‚æ‰§è¡Œå™¨åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œç±»ä¼¼äºä¸€ä¸ªé»‘ç›’ï¼Œè¾“å…¥æ˜¯æ™ºèƒ½åˆçº¦ä»£ç ï¼Œè¾“å‡ºæ˜¯çŠ¶æ€çš„æ”¹å˜.\nä»¥å¤ªåŠè™šæ‹Ÿæœºï¼ˆenvironment virtual machineï¼Œç®€ç§°EVMï¼‰ï¼Œä½œç”¨æ˜¯å°†æ™ºèƒ½åˆçº¦ä»£ç ç¼–è¯‘æˆå¯åœ¨ä»¥å¤ªåŠä¸Šæ‰§è¡Œçš„æœºå™¨ç ï¼Œå¹¶æä¾›æ™ºèƒ½åˆçº¦çš„è¿è¡Œç¯å¢ƒã€‚å®ƒæ˜¯ä¸€ä¸ªå¯¹å¤–å®Œå…¨éš”ç¦»çš„æ²™ç›’ç¯å¢ƒï¼Œåœ¨è¿è¡ŒæœŸé—´ä¸èƒ½è®¿é—®ç½‘ç»œã€æ–‡ä»¶ï¼Œå³ä½¿ä¸åŒåˆçº¦ä¹‹é—´ä¹Ÿæœ‰æœ‰é™çš„è®¿é—®æƒé™ã€‚ä»¥å¤ªåŠè™šæ‹Ÿæœºæä¾›äº†é¢å‘åˆçº¦çš„é«˜çº§ç¼–ç¨‹è¯­è¨€solidityï¼Œè¿™ä½¿å¾—å¼€å‘è€…å¯ä»¥ä¸“æ³¨äºåº”ç”¨æœ¬èº«ï¼Œæ›´æ–¹ä¾¿ã€å¿«æ·çš„å¼€å‘å»ä¸­å¿ƒåŒ–åº”ç”¨ç¨‹åºï¼ŒåŒæ—¶ä¹Ÿå¤§å¤§é™ä½äº†å¼€å‘éš¾åº¦ã€‚\nEVMæ˜¯ä¸€ç§åŸºäºæ ˆçš„è™šæ‹Ÿæœºï¼ˆåŒºåˆ«äºåŸºäºå¯„å­˜å™¨çš„è™šæ‹Ÿæœºï¼‰ï¼Œç”¨äºæ‰§è¡Œæ™ºèƒ½åˆçº¦ï¼ŒåŒæ—¶EVMæ˜¯å›¾çµå®Œå¤‡çš„ï¼ŒEVMæ“ä½œæ•°æ ˆè°ƒç”¨æ·±åº¦ä¸º1024,EVMæœºå™¨ç é•¿åº¦ä¸€ä¸ªå­—èŠ‚ï¼Œæœ€å¤šå¯ä»¥æœ‰256ä¸ªæ“ä½œç ï¼Œç›®å‰å·²ç»å®šä¹‰äº†144ä¸ªæ“ä½œç ï¼Œè¿˜æœ‰100å¤šä¸ªæ“ä½œç å¯ä»¥æ‰©å±•ï¼Œæ¯ä¸ªæ“ä½œç éƒ½æ ¹æ®å…¶å¼¹æ ˆæ•°ã€å‹æ ˆæ•°å®šä¹‰äº†ç›¸åº”çš„gasæ¶ˆè€—æ•°é‡ã€‚æ³°å²³é“¾åº”ç”¨äº†ä»¥å¤ªåŠEVMæœºåˆ¶æ¥å®ç°æ™ºèƒ½åˆçº¦ï¼Œå¹¶å¢åŠ äº†å¯¹å›½å¯†ç®—æ³•çš„æ”¯æŒ(SM3)ã€‚\n2. solidityè¯­è¨€ Solidity æ˜¯ä¸€é—¨é¢å‘åˆçº¦çš„ã€ä¸ºå®ç°æ™ºèƒ½åˆçº¦è€Œåˆ›å»ºçš„é«˜çº§ç¼–ç¨‹è¯­è¨€ã€‚è¿™é—¨è¯­è¨€å—åˆ°äº† C++ï¼ŒPython å’Œ Javascript è¯­è¨€çš„å½±å“ï¼Œè®¾è®¡çš„ç›®çš„æ˜¯èƒ½åœ¨ ä»¥å¤ªåŠè™šæ‹Ÿæœºï¼ˆEVMï¼‰ ä¸Šè¿è¡Œã€‚\nSolidity æ˜¯é™æ€ç±»å‹è¯­è¨€ï¼Œæ”¯æŒç»§æ‰¿ã€åº“å’Œå¤æ‚çš„ç”¨æˆ·å®šä¹‰ç±»å‹ç­‰ç‰¹æ€§ã€‚\nç›´æ¥çœ‹è¿™é‡Œï¼šSolidityæœ€æ–°ä¸­æ–‡æ–‡æ¡£\n3. ä½¿ç”¨Ganacheä¸truffleè¿›è¡Œåˆçº¦å¼€å‘ Ganache\nganacheå¯ä»¥å¿«é€Ÿçš„åœ¨æœ¬æœºä¸Šå¯åŠ¨ä¸€æ¡ä»¥å¤ªåŠé“¾ï¼Œç”¨æˆ·å¯ä»¥æ–¹ä¾¿çš„åœ¨ä¸Šé¢éƒ¨ç½²åˆçº¦ï¼Œè°ƒç”¨åˆçº¦ï¼Œå®Œæˆå„ç§ä¸åˆçº¦ä¹‹é—´çš„äº¤äº’ã€‚\nganacheæä¾›äº†Windowsã€Linuxä»¥åŠMacä¸‰ç§ç³»ç»Ÿçš„ç‰ˆæœ¬ï¼Œç›´æ¥åˆ°å…¶å®˜ç½‘æˆ–GitHubé¡µé¢ä¸‹è½½å®‰è£…å³å¯ã€‚\nå®‰è£…å®Œæˆåï¼Œå³å¯ä»¥å¿«é€Ÿéƒ¨ç½²ä¸€æ¡é“¾ ä½¿ç”¨QUICKSTARTæ¨¡å¼éƒ¨ç½²çš„é“¾åªä¼šåœ¨æœ¬æ¬¡ä¼šè¯ä¸­å­˜åœ¨ï¼Œå…³é—­å½“å‰ä¼šè¯æˆ–æ³¨é”€å½“å‰ç”¨æˆ·éƒ½ä¼šå¯¼è‡´é“¾çš„æ’¤é”€ï¼Œå¦‚æœåªæ˜¯å†™ä¸ªå°demoçš„è¯ï¼Œé‚£ä¹ˆä½¿ç”¨è¿™ç§æ–¹å¼å³å¯ã€‚\nNEW WORKSPACEåˆ™ä¼šåˆ›å»ºä¸€æ¡æŒä¹…åŒ–çš„é“¾ï¼Œä¸ä¼šå› ä¼šè¯ç»“æŸæˆ–ç”¨æˆ·æ³¨é”€è€Œæ’¤é”€é“¾ã€‚\n ä½¿ç”¨QUICKSTARTæ¨¡å¼å¯åŠ¨\n ganacheä¼šè‡ªåŠ¨åˆ›å»º10ä¸ªæµ‹è¯•è´¦å·ï¼Œæ¯ä¸ªè´¦å·åˆ†é…äº†100ä¸ªåŸç”Ÿå¸ï¼Œäº¤æ˜“éœ€è¦æ¶ˆè€—è¿™äº›åŸç”Ÿå¸ã€‚ åœ¨é¡µé¢çš„ä¸Šæ–¹ï¼Œè¿˜æœ‰å…¶ä»–ä¸€äº›é€‰é¡¹å¡ï¼Œå¯ä»¥æ–¹ä¾¿çš„æŸ¥çœ‹å½“å‰åŒºå—ã€äº¤æ˜“ã€äº‹ä»¶ã€æ—¥å¿—ç­‰ã€‚éœ€è¦æ³¨æ„çš„æ˜¯åœ¨è¿™äº›é€‰é¡¹å¡çš„ä¸‹æ–¹ï¼Œè¿˜æ ‡æ³¨äº†æœ¬é“¾çš„ä¸€äº›ä¿¡æ¯ï¼Œå¦‚å®ƒçš„ç«¯å£ï¼Œç½‘ç»œIDç­‰ã€‚ truffle\ntruffleæä¾›äº†åˆçº¦å¼€å‘ã€æµ‹è¯•ã€éƒ¨ç½²ç­‰ä¸€ç³»åˆ—å·¥å…·ï¼Œé€šè¿‡ä¸Ganacheé…åˆå¯ä»¥ååˆ†æ–¹ä¾¿çš„æµ‹è¯•ä½ çš„åˆçº¦ã€‚\nå®‰è£…truffle\nnpm install -g truffle æ–°å»ºä¸€ä¸ªtruffleé¡¹ç›®\nmkdir MyContract truffle init truffleä¼šåˆ›å»ºå¦‚ä¸‹çš„ç›®å½•ç»“æ„ï¼š\nâ”œâ”€â”€ contracts â”‚Â â””â”€â”€ Migrations.sol â”œâ”€â”€ migrations â”‚Â â””â”€â”€ 1_initial_migration.js â”œâ”€â”€ test â””â”€â”€ truffle-config.js contractç›®å½•ä¸­å­˜æ”¾æˆ‘ä»¬çš„åˆçº¦;migrationsç›®å½•ä¸­å­˜æ”¾migrateæ–‡ä»¶ï¼ŒåŠŸèƒ½ç±»ä¼¼æ•°æ®åº“migrateæ–‡ä»¶ï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯è®©ä½ çš„åº”ç”¨ä»ä¸€ä¸ªçŠ¶æ€è¿ç§»åˆ°å¦ä¸€ä¸ªçŠ¶æ€;testç›®å½•ä¸­å­˜æ”¾æµ‹è¯•æ–‡ä»¶ï¼ˆè¿˜æœªåˆ›å»ºï¼‰;truffle-config.jsæ˜¯é…ç½®æ–‡ä»¶ï¼Œå…¶ä¸­é…ç½®äº†é“¾çš„åœ°å€ç­‰ä¿¡æ¯ã€‚\næ ¹æ®æç¤ºæˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªç®€å•çš„åˆçº¦æ¨¡æ¿ï¼š\ntruffle create contract Counter truffleåˆ›å»ºäº†Counter.solæ–‡ä»¶ï¼Œå†æ¬¡æŸ¥çœ‹ç›®å½•ç»“æ„ï¼š\nâ”œâ”€â”€ contracts â”‚Â â”œâ”€â”€ Counter.sol â”‚Â â””â”€â”€ Migrations.sol â”œâ”€â”€ migrations â”‚Â â””â”€â”€ 1_initial_migration.js â”œâ”€â”€ test â””â”€â”€ truffle-config.js æ‰“å¼€Counter.sol\n// SPDX-License-Identifier: MIT pragma solidity \u0026gt;=0.4.22 \u0026lt;0.9.0; contract Counter { constructor() public { } } ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªåˆçº¦æ¨¡æ¿ï¼Œä¿®æ”¹åˆçº¦ï¼š\n// SPDX-License-Identifier: MIT pragma solidity \u0026gt;=0.4.22 \u0026lt;0.9.0; contract counter { address owner; mapping (string =\u0026gt; uint256) values; constructor() public { owner = msg.sender; } function increase(string memory key) public payable { values[key] = values[key] + 1; } function get(string memory key) view public returns (uint) { return values[key]; } function getOwner()view public returns (address) { return owner; } } ä»¥ä¸Šåˆçº¦æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„è®¡æ•°å™¨åˆçº¦ï¼Œæä¾›äº†increase, get, getOwnerä¸‰ä¸ªæ–¹æ³•ï¼Œåˆ†åˆ«ç”¨æ¥å¢åŠ è®¡æ•°ã€è·å–è®¡æ•°å€¼ã€è·å–åˆçº¦æ‰€æœ‰è€…ã€‚\nç¼–è¯‘åˆçº¦\ntruffle compile ç¼–è¾‘migrateæ–‡ä»¶\nvim migrations/2_deploy_contracts.js const Counter = artifacts.require(\u0026#34;Counter\u0026#34;) module.exports = function(deployer) { deployer.deploy(Counter); } ç°åœ¨å‡†å¤‡å·¥ä½œå·²ç»å®Œæˆäº†ï¼Œå¼€å§‹è®©æˆ‘ä»¬çš„åˆçº¦ä¸Šé“¾ã€‚\né…ç½®truffle-config.jsæ–‡ä»¶ï¼Œä¸»è¦æ˜¯è¦é…ç½®networkï¼š\nnetworks: { development: { host: \u0026#34;127.0.0.1\u0026#34;, // Localhost (default: none)  port: 7545, // Standard Ethereum port (default: none)  network_id: \u0026#34;*\u0026#34;, // Any network (default: none)  }, }, networksæœ‰å¾ˆè¯¦ç»†çš„æ³¨é‡Šï¼Œè¿™é‡Œçš„å…³é”®æ˜¯éœ€è¦ä¸Ganacheä¸­æ˜¾ç¤ºçš„ç«¯å£å·ç­‰ä¸€è‡´ã€‚ é…ç½®å®Œæˆï¼Œç»ˆäºåˆ°äº†æ¿€åŠ¨äººå¿ƒçš„ä¸€æ­¥ï¼Œåˆçº¦ä¸Šé“¾ã€‚\ntruffle migrate Compiling your contracts... =========================== \u0026gt; Everything is up to date, there is nothing to compile. Starting migrations... ====================== \u0026gt; Network name: 'development' \u0026gt; Network id: 5777 \u0026gt; Block gas limit: 6721975 (0x6691b7) 1_initial_migration.js ====================== Deploying 'Migrations' ---------------------- \u0026gt; transaction hash: 0x75050e06c2f6f1097257de17ea1370a86225c35909e8319ed62407424b21587e \u0026gt; Blocks: 0 Seconds: 0 \u0026gt; contract address: 0xd366fCAF0F7A2b1A2Ebde67E89f1bbC2ED708c55 \u0026gt; block number: 112 \u0026gt; block timestamp: 1623909962 \u0026gt; account: 0x128F3853c98671ac43e8358e3A043f3A7bD0Ca18 \u0026gt; balance: 99.72713514 \u0026gt; gas used: 191943 (0x2edc7) \u0026gt; gas price: 20 gwei \u0026gt; value sent: 0 ETH \u0026gt; total cost: 0.00383886 ETH 2_deploy_contracts.js ===================== Deploying 'Counter' ------------------- \u0026gt; transaction hash: 0x692c27b1b9a7f04301c10a2b3ece8c5f7737581d4de9f01e88653a907eb4b711 \u0026gt; Blocks: 0 Seconds: 0 \u0026gt; contract address: 0x76607048A6628A43d981811a35a629Ff049c2B11 \u0026gt; block number: 114 \u0026gt; block timestamp: 1623910129 \u0026gt; account: 0x128F3853c98671ac43e8358e3A043f3A7bD0Ca18 \u0026gt; balance: 99.72055518 \u0026gt; gas used: 286660 (0x45fc4) \u0026gt; gas price: 20 gwei \u0026gt; value sent: 0 ETH \u0026gt; total cost: 0.0057332 ETH \u0026gt; Saving migration to chain. \u0026gt; Saving artifacts ------------------------------------- \u0026gt; Total cost: 0.0057332 ETH Summary ======= \u0026gt; Total deployments: 2 \u0026gt; Final cost: 0.00957206 ETH ä»è¾“å‡ºçš„æ—¥å¿—ä¿¡æ¯ä¸­å¯ä»¥çœ‹åˆ°éƒ¨ç½²çš„åˆçº¦åŠå…¶æ¶ˆè€—çš„èµ„æºã€‚\næŸ¥çœ‹Ganacheå¯çœ‹åˆ°ï¼Œé“¾å¢é•¿äº†4ä¸ªåŒºå— æ¶ˆè€—çš„åŸç”Ÿå¸ä¹Ÿæ˜¾ç¤ºäº†å‡ºæ¥ æ‰§è¡Œçš„æ‰€æœ‰äº¤æ˜“ ç°åœ¨æˆ‘ä»¬å®Œæˆäº†åˆçº¦ç¼–å†™ï¼Œåˆçº¦ä¸Šé“¾ç­‰æ­¥éª¤ï¼Œä½†åˆ°è¿™é‡Œåªèƒ½è¯æ˜åˆçº¦è¯­æ³•çš„æ­£ç¡®æ€§ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è¿›è¡Œä¸€ç³»åˆ—çš„æµ‹è¯•æ¥ä¿è¯æˆ‘ä»¬çš„åˆçº¦é€»è¾‘æ˜¯æ— è¯¯çš„ï¼Œå¯ä»¥æŒ‰ç…§æˆ‘ä»¬é¢„å®šçš„é€»è¾‘æ‰§è¡Œã€‚\nç”Ÿæˆæµ‹è¯•ä»£ç (å¯é€‰)\ntruffle create test Counter cat test/counter.js const Counter = artifacts.require(\u0026#34;Counter\u0026#34;); /* * uncomment accounts to access the test accounts made available by the * Ethereum client * See docs: https://www.trufflesuite.com/docs/truffle/testing/writing-tests-in-javascript */ contract(\u0026#34;Counter\u0026#34;, function (/* accounts */) { it(\u0026#34;should assert true\u0026#34;, async function () { await Counter.deployed(); return assert.isTrue(true); }); }); å¦‚æœä½ ä¸æƒ³è‡ªåŠ¨ç”Ÿæˆä»£ç ï¼Œé‚£ä¹ˆå¯ä»¥æ‰‹åŠ¨åˆ›å»ºè‡ªå·±çš„æµ‹è¯•æ–‡ä»¶\nvim test/counter.test.js å†…å®¹åŒä¸Š\nå¼€å§‹æµ‹è¯•\n$ truffle test Using network \u0026#39;development\u0026#39;. Compiling your contracts... =========================== \u0026gt; Compiling ./contracts/Counter.sol \u0026gt; Artifacts written to /tmp/test--10676-pZQ9laXW37D3 \u0026gt; Compiled successfully using: - solc: 0.5.16+commit.9c3226ce.Emscripten.clang Contract: Counter âœ“ should assert true 1 passing (74ms) ä»¥ä¸Šçš„æµ‹è¯•æ–‡ä»¶ä¸­ï¼Œæ–­è¨€æ°¸è¿œä¸ºçœŸï¼Œæ‰€ä»¥åªè¦è¿™ä¸ªæµ‹è¯•å¯ä»¥è·‘èµ·æ¥ï¼Œå°±è‚¯å®šä¸ä¼šfailï¼Œè¿™åªæ˜¯å®˜æ–¹ç»™æˆ‘ä»¬ç”Ÿæˆçš„æµ‹è¯•ä»£ç æ¨¡æ¿ï¼ŒçœŸæ­£çš„æµ‹è¯•ä»£ç è¿˜éœ€è¦æˆ‘ä»¬è‡ªå·±æ¥ç¼–å†™ã€‚ ä¿®æ”¹æµ‹è¯•ä»£ç ï¼š\nconst Counter = artifacts.require(\u0026#34;Counter\u0026#34;); contract(\u0026#34;counter\u0026#34;, async account =\u0026gt; { contract(\u0026#34;counter 1st test\u0026#34;, async account =\u0026gt; { let c; before(\u0026#34;deploy contract\u0026#34;, async () =\u0026gt; { c = await Counter.deployed(); }) it(\u0026#34;test getOwner\u0026#34;, async () =\u0026gt; { const owner = await c.getOwner(); expectedOwner = \u0026#34;0x128F3853c98671ac43e8358e3A043f3A7bD0Ca18\u0026#34; assert.equal(owner, expectedOwner, \u0026#34;owner is wrong\u0026#34;) }) it(\u0026#34;test increase\u0026#34;, async () =\u0026gt; { await c.increase(\u0026#34;0x128F3853c98671ac43e8358e3A043f3A7bD0Ca18\u0026#34;) const num = await c.get(\u0026#34;0x128F3853c98671ac43e8358e3A043f3A7bD0Ca18\u0026#34;) let expectedNum = 1; assert.equal(expectedNum, num, \u0026#34;error occur\u0026#34;); }) }) }); é‡æ–°è¿è¡Œæµ‹è¯•ï¼š\ntruffle test Using network 'development'. Compiling your contracts... =========================== \u0026gt; Compiling ./contracts/Counter.sol \u0026gt; Artifacts written to /tmp/test--10825-NWIGDIdS1RrG \u0026gt; Compiled successfully using: - solc: 0.5.16+commit.9c3226ce.Emscripten.clang Contract: counter Contract: counter 1st test âœ“ test getOwner âœ“ test increase (81ms) 2 passing (184ms) æµ‹è¯•é€šè¿‡ï¼Œå®Œç¾ã€‚\næ›´å¤šèµ„æ–™ï¼Œè¯·å‚è€ƒå®˜ç½‘æ–‡æ¡£ï¼šTRUFFLE SUITE\n æ—¶é—´å¤„ç†ï¼š https://ethereum.stackexchange.com/questions/34110/compare-dates-in-solidity\n ","permalink":"http://yangchnet.github.io/Dessert/posts/%E5%8C%BA%E5%9D%97%E9%93%BE/%E5%8D%81%E5%88%86%E9%92%9F%E5%AD%A6%E4%BC%9A%E5%8C%BA%E5%9D%97%E9%93%BE%E5%90%88%E7%BA%A6%E5%BC%80%E5%8F%91/","summary":"1. evmè™šæ‹Ÿæœº äº¤æ˜“çš„æ‰§è¡Œæ˜¯åŒºå—é“¾èŠ‚ç‚¹ä¸Šçš„ä¸€ä¸ªé‡è¦çš„åŠŸèƒ½ã€‚æ˜¯æŠŠäº¤æ˜“ä¸­çš„æ™ºèƒ½åˆçº¦äºŒè¿›åˆ¶ä»£ç å–å‡ºæ¥ï¼Œç”¨æ‰§è¡Œå™¨ï¼ˆExecutorï¼‰æ‰§è¡Œã€‚åœ¨äº¤æ˜“çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¼šå¯¹åŒºå—é“¾çš„çŠ¶æ€ï¼ˆStateï¼‰è¿›è¡Œä¿®æ”¹ï¼Œå½¢æˆæ–°åŒºå—çš„çŠ¶æ€å‚¨å­˜ä¸‹æ¥ï¼ˆStorageï¼‰ã€‚æ‰§è¡Œå™¨åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œç±»ä¼¼äºä¸€ä¸ªé»‘ç›’ï¼Œè¾“å…¥æ˜¯æ™ºèƒ½åˆçº¦ä»£ç ï¼Œè¾“å‡ºæ˜¯çŠ¶æ€çš„æ”¹å˜.\nä»¥å¤ªåŠè™šæ‹Ÿæœºï¼ˆenvironment virtual machineï¼Œç®€ç§°EVMï¼‰ï¼Œä½œç”¨æ˜¯å°†æ™ºèƒ½åˆçº¦ä»£ç ç¼–è¯‘æˆå¯åœ¨ä»¥å¤ªåŠä¸Šæ‰§è¡Œçš„æœºå™¨ç ï¼Œå¹¶æä¾›æ™ºèƒ½åˆçº¦çš„è¿è¡Œç¯å¢ƒã€‚å®ƒæ˜¯ä¸€ä¸ªå¯¹å¤–å®Œå…¨éš”ç¦»çš„æ²™ç›’ç¯å¢ƒï¼Œåœ¨è¿è¡ŒæœŸé—´ä¸èƒ½è®¿é—®ç½‘ç»œã€æ–‡ä»¶ï¼Œå³ä½¿ä¸åŒåˆçº¦ä¹‹é—´ä¹Ÿæœ‰æœ‰é™çš„è®¿é—®æƒé™ã€‚ä»¥å¤ªåŠè™šæ‹Ÿæœºæä¾›äº†é¢å‘åˆçº¦çš„é«˜çº§ç¼–ç¨‹è¯­è¨€solidityï¼Œè¿™ä½¿å¾—å¼€å‘è€…å¯ä»¥ä¸“æ³¨äºåº”ç”¨æœ¬èº«ï¼Œæ›´æ–¹ä¾¿ã€å¿«æ·çš„å¼€å‘å»ä¸­å¿ƒåŒ–åº”ç”¨ç¨‹åºï¼ŒåŒæ—¶ä¹Ÿå¤§å¤§é™ä½äº†å¼€å‘éš¾åº¦ã€‚\nEVMæ˜¯ä¸€ç§åŸºäºæ ˆçš„è™šæ‹Ÿæœºï¼ˆåŒºåˆ«äºåŸºäºå¯„å­˜å™¨çš„è™šæ‹Ÿæœºï¼‰ï¼Œç”¨äºæ‰§è¡Œæ™ºèƒ½åˆçº¦ï¼ŒåŒæ—¶EVMæ˜¯å›¾çµå®Œå¤‡çš„ï¼ŒEVMæ“ä½œæ•°æ ˆè°ƒç”¨æ·±åº¦ä¸º1024,EVMæœºå™¨ç é•¿åº¦ä¸€ä¸ªå­—èŠ‚ï¼Œæœ€å¤šå¯ä»¥æœ‰256ä¸ªæ“ä½œç ï¼Œç›®å‰å·²ç»å®šä¹‰äº†144ä¸ªæ“ä½œç ï¼Œè¿˜æœ‰100å¤šä¸ªæ“ä½œç å¯ä»¥æ‰©å±•ï¼Œæ¯ä¸ªæ“ä½œç éƒ½æ ¹æ®å…¶å¼¹æ ˆæ•°ã€å‹æ ˆæ•°å®šä¹‰äº†ç›¸åº”çš„gasæ¶ˆè€—æ•°é‡ã€‚æ³°å²³é“¾åº”ç”¨äº†ä»¥å¤ªåŠEVMæœºåˆ¶æ¥å®ç°æ™ºèƒ½åˆçº¦ï¼Œå¹¶å¢åŠ äº†å¯¹å›½å¯†ç®—æ³•çš„æ”¯æŒ(SM3)ã€‚\n2. solidityè¯­è¨€ Solidity æ˜¯ä¸€é—¨é¢å‘åˆçº¦çš„ã€ä¸ºå®ç°æ™ºèƒ½åˆçº¦è€Œåˆ›å»ºçš„é«˜çº§ç¼–ç¨‹è¯­è¨€ã€‚è¿™é—¨è¯­è¨€å—åˆ°äº† C++ï¼ŒPython å’Œ Javascript è¯­è¨€çš„å½±å“ï¼Œè®¾è®¡çš„ç›®çš„æ˜¯èƒ½åœ¨ ä»¥å¤ªåŠè™šæ‹Ÿæœºï¼ˆEVMï¼‰ ä¸Šè¿è¡Œã€‚\nSolidity æ˜¯é™æ€ç±»å‹è¯­è¨€ï¼Œæ”¯æŒç»§æ‰¿ã€åº“å’Œå¤æ‚çš„ç”¨æˆ·å®šä¹‰ç±»å‹ç­‰ç‰¹æ€§ã€‚\nç›´æ¥çœ‹è¿™é‡Œï¼šSolidityæœ€æ–°ä¸­æ–‡æ–‡æ¡£\n3. ä½¿ç”¨Ganacheä¸truffleè¿›è¡Œåˆçº¦å¼€å‘ Ganache\nganacheå¯ä»¥å¿«é€Ÿçš„åœ¨æœ¬æœºä¸Šå¯åŠ¨ä¸€æ¡ä»¥å¤ªåŠé“¾ï¼Œç”¨æˆ·å¯ä»¥æ–¹ä¾¿çš„åœ¨ä¸Šé¢éƒ¨ç½²åˆçº¦ï¼Œè°ƒç”¨åˆçº¦ï¼Œå®Œæˆå„ç§ä¸åˆçº¦ä¹‹é—´çš„äº¤äº’ã€‚\nganacheæä¾›äº†Windowsã€Linuxä»¥åŠMacä¸‰ç§ç³»ç»Ÿçš„ç‰ˆæœ¬ï¼Œç›´æ¥åˆ°å…¶å®˜ç½‘æˆ–GitHubé¡µé¢ä¸‹è½½å®‰è£…å³å¯ã€‚\nå®‰è£…å®Œæˆåï¼Œå³å¯ä»¥å¿«é€Ÿéƒ¨ç½²ä¸€æ¡é“¾ ä½¿ç”¨QUICKSTARTæ¨¡å¼éƒ¨ç½²çš„é“¾åªä¼šåœ¨æœ¬æ¬¡ä¼šè¯ä¸­å­˜åœ¨ï¼Œå…³é—­å½“å‰ä¼šè¯æˆ–æ³¨é”€å½“å‰ç”¨æˆ·éƒ½ä¼šå¯¼è‡´é“¾çš„æ’¤é”€ï¼Œå¦‚æœåªæ˜¯å†™ä¸ªå°demoçš„è¯ï¼Œé‚£ä¹ˆä½¿ç”¨è¿™ç§æ–¹å¼å³å¯ã€‚\nNEW WORKSPACEåˆ™ä¼šåˆ›å»ºä¸€æ¡æŒä¹…åŒ–çš„é“¾ï¼Œä¸ä¼šå› ä¼šè¯ç»“æŸæˆ–ç”¨æˆ·æ³¨é”€è€Œæ’¤é”€é“¾ã€‚\n ä½¿ç”¨QUICKSTARTæ¨¡å¼å¯åŠ¨\n ganacheä¼šè‡ªåŠ¨åˆ›å»º10ä¸ªæµ‹è¯•è´¦å·ï¼Œæ¯ä¸ªè´¦å·åˆ†é…äº†100ä¸ªåŸç”Ÿå¸ï¼Œäº¤æ˜“éœ€è¦æ¶ˆè€—è¿™äº›åŸç”Ÿå¸ã€‚ åœ¨é¡µé¢çš„ä¸Šæ–¹ï¼Œè¿˜æœ‰å…¶ä»–ä¸€äº›é€‰é¡¹å¡ï¼Œå¯ä»¥æ–¹ä¾¿çš„æŸ¥çœ‹å½“å‰åŒºå—ã€äº¤æ˜“ã€äº‹ä»¶ã€æ—¥å¿—ç­‰ã€‚éœ€è¦æ³¨æ„çš„æ˜¯åœ¨è¿™äº›é€‰é¡¹å¡çš„ä¸‹æ–¹ï¼Œè¿˜æ ‡æ³¨äº†æœ¬é“¾çš„ä¸€äº›ä¿¡æ¯ï¼Œå¦‚å®ƒçš„ç«¯å£ï¼Œç½‘ç»œIDç­‰ã€‚ truffle\ntruffleæä¾›äº†åˆçº¦å¼€å‘ã€æµ‹è¯•ã€éƒ¨ç½²ç­‰ä¸€ç³»åˆ—å·¥å…·ï¼Œé€šè¿‡ä¸Ganacheé…åˆå¯ä»¥ååˆ†æ–¹ä¾¿çš„æµ‹è¯•ä½ çš„åˆçº¦ã€‚\nå®‰è£…truffle\nnpm install -g truffle æ–°å»ºä¸€ä¸ªtruffleé¡¹ç›®\nmkdir MyContract truffle init truffleä¼šåˆ›å»ºå¦‚ä¸‹çš„ç›®å½•ç»“æ„ï¼š\nâ”œâ”€â”€ contracts â”‚Â â””â”€â”€ Migrations.sol â”œâ”€â”€ migrations â”‚Â â””â”€â”€ 1_initial_migration.js â”œâ”€â”€ test â””â”€â”€ truffle-config.js contractç›®å½•ä¸­å­˜æ”¾æˆ‘ä»¬çš„åˆçº¦;migrationsç›®å½•ä¸­å­˜æ”¾migrateæ–‡ä»¶ï¼ŒåŠŸèƒ½ç±»ä¼¼æ•°æ®åº“migrateæ–‡ä»¶ï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯è®©ä½ çš„åº”ç”¨ä»ä¸€ä¸ªçŠ¶æ€è¿ç§»åˆ°å¦ä¸€ä¸ªçŠ¶æ€;testç›®å½•ä¸­å­˜æ”¾æµ‹è¯•æ–‡ä»¶ï¼ˆè¿˜æœªåˆ›å»ºï¼‰;truffle-config.jsæ˜¯é…ç½®æ–‡ä»¶ï¼Œå…¶ä¸­é…ç½®äº†é“¾çš„åœ°å€ç­‰ä¿¡æ¯ã€‚\næ ¹æ®æç¤ºæˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªç®€å•çš„åˆçº¦æ¨¡æ¿ï¼š\ntruffle create contract Counter truffleåˆ›å»ºäº†Counter.solæ–‡ä»¶ï¼Œå†æ¬¡æŸ¥çœ‹ç›®å½•ç»“æ„ï¼š\nâ”œâ”€â”€ contracts â”‚Â â”œâ”€â”€ Counter.","title":"ååˆ†é’Ÿå­¦ä¼šåŒºå—é“¾åˆçº¦å¼€å‘"},{"content":"1. WSLçš„å®‰è£… 1.1 å‡çº§Windows WSLéœ€è¦é«˜ç‰ˆæœ¬çš„windowsï¼Œå¯ä½¿ç”¨å¾®è½¯å®˜æ–¹çš„æ˜“å‡å·¥å…·æˆ–ç›´æ¥ä»è®¾ç½®ä¸­å‡çº§ï¼Œå‡çº§éœ€è¦ä¸€å®šçš„æ—¶é—´ã€‚\n1.2 å®‰è£…WSL  ä½¿ç”¨ç®¡ç†å‘˜æ¨¡å¼æ‰“å¼€power shellï¼Œ ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¼€å¯WSLåŠŸèƒ½  dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart é‡å¯ä½ çš„æœºå™¨\nå¯ç”¨è™šæ‹ŸæœºåŠŸèƒ½ ä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€powershellï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š  dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart é‡æ–°å¯åŠ¨ç”µè„‘\nä¸‹è½½Linuxå†…æ ¸æ›´æ–°åŒ… é€‚ç”¨äº x64 è®¡ç®—æœºçš„ WSL2 Linux å†…æ ¸æ›´æ–°åŒ…  è¿è¡Œä½ ä¸‹è½½çš„æ›´æ–°åŒ…ã€‚\nå°†WSL2è®¾ç½®ä¸ºé»˜è®¤ç‰ˆæœ¬ ä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€powershellï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š  wsl --set-default-version 2 é€‰æ‹©ä½ è¦å®‰è£…çš„å‘è¡Œç‰ˆ  è¿™é‡Œæˆ‘é€‰æ‹©äº†Ubuntu18.04ï¼Œè·å–åå®‰è£…\nå¯åŠ¨å®‰è£…çš„å‘è¡Œç‰ˆå³å¯  2. ä½¿ç”¨WSLå›¾å½¢ç•Œé¢(å¯é€‰)  è®¾ç½®ç¯å¢ƒå˜é‡  export DISPLAY=$(awk \u0026#39;/nameserver / {print $2; exit}\u0026#39; /etc/resolv.conf 2\u0026gt;/dev/null):0 export LIBGL_ALWAYS_INDIRECT=1  å®‰è£…Xserverï¼Œè¿™é‡Œé€‰æ‹©çš„è½¯ä»¶æ˜¯vcxsrvï¼Œ å¯åœ¨sourceforgeä¸­ä¸‹è½½å®‰è£…ã€‚\n  å®‰è£…å®Œæˆåç›´æ¥å¯åŠ¨å³å¯\n   æ¯æ¬¡é‡æ–°å¯åŠ¨ç”µè„‘éƒ½è¦é‡æ–°æ‰“å¼€ä¸€ä¸‹ï¼Œç•¥çƒ¦ã€‚å¾®è½¯å®˜æ–¹çš„WSLgå·²ç»å‘å¸ƒï¼Œä¸è¿‡éœ€è¦Windows Insider,å…ˆç­‰ç­‰å§\n åœ¨wslä¸­å®‰è£…gedit  sudo apt install gedit å°è¯•å¯åŠ¨geditï¼š\ngedit å®Œæˆï¼ï¼ï¼\n å¯ä»¥ä»wslä¸­å¯åŠ¨å›¾å½¢ç•Œé¢æ„å‘³ç€ä½ å¯ä»¥å°†vscodeã€ideaã€golandç­‰å¼€å‘å·¥å…·ç›´æ¥è£…åœ¨wslä¸­ã€‚ä½†æˆ‘å¼ºçƒˆå»ºè®®ä½ ä½¿ç”¨vscodeçš„Remote-WSLæ’ä»¶æ¥è¿›è¡Œå¼€å‘ï¼Œè€Œåªåœ¨ä¸€äº›å¿…è¦çš„æ—¶å€™æ‰ä»wslä¸­ç›´æ¥å¯åŠ¨å›¾å½¢ç•Œé¢ã€‚\n 3. WSLä¸­æ–‡(å¦‚æœªå®‰è£…GUIï¼Œåˆ™ä¸éœ€è¦é…ç½®) 3.1 WSLä¸­æ–‡æ˜¾ç¤º  å®‰è£…è¯­è¨€åŒ…  sudo apt-get -y install locales xfonts-intl-chinese fonts-wqy-microhei è¯­è¨€ç¯å¢ƒè®¾ç½®  sudo dpkg-reconfigure locales ä½¿ç”¨ç©ºæ ¼é”®é€‰ä¸­en_US.UTF-8 UTF-8ã€zh_CN.UTF-8 UTF-8ï¼Œä½¿ç”¨Tabé”®åˆ‡æ¢è‡³OKï¼Œå†å°†en_US.UTF-8é€‰ä¸ºé»˜è®¤ã€‚ é‡å¯ç³»ç»Ÿ  exit ... wsl --shutdown wsl 3.2 WSLä¸­æ–‡è¾“å…¥æ³•é…ç½®(å¦‚æœªå®‰è£…GUIï¼Œåˆ™ä¸éœ€è¦é…ç½®)  å®‰è£…fcitxåŠè¾“å…¥æ³•\nå®‰è£…fcitxæ ¸å¿ƒåŠCJKå­—ä½“  sudo apt install fcitx fonts-noto-cjk fonts-noto-color-emoji dbus-x11 å®‰è£…æœç‹—è¾“å…¥æ³•ï¼Œç›´æ¥åˆ°æœç‹—è¾“å…¥æ³•å®˜ç½‘ç½‘ç«™ä¸‹è½½å¹¶æŒ‰ç…§è¯´æ˜å®‰è£…å³å¯\né…ç½®è¾“å…¥ç¯å¢ƒ  é¦–å…ˆä½¿ç”¨rootè´¦å·ç”Ÿæˆdbusæœºå™¨ç \ndbus-uuidgen \u0026gt; /var/lib/dbus/machine-id ç”¨rootè´¦å·åˆ›å»º/etc/profile.d/fcitx.shæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\n#!/bin/bash export QT_IM_MODULE=fcitx export GTK_IM_MODULE=fcitx export XMODIFIERS=@im=fcitx export DefaultIMModule=fcitx #å¯é€‰ï¼Œfcitx è‡ªå¯ fcitx-autostart \u0026amp;\u0026gt;/dev/null å…¶ä»–é…ç½® å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ°ä½ çš„bashrcé…ç½®æ–‡ä»¶ä¸­  vim ~/.bashrc export GTK_IM_MODULE=fcitx export QT_IM_MODULE=fcitx export XMODIFIERS=@im=fcitx export DefaultIMModule=fcitx fcitx-autostart \u0026amp;\u0026gt;/dev/null source ~/.bashrc è¿è¡Œfcitx-config-gtk3,ä¼šå‡ºç°å¦‚å›¾çš„ç•Œé¢ï¼š\næŒ‰ç…§æç¤ºå°†é”®ç›˜å¸ƒå±€æ”¾åœ¨ç¬¬ä¸€ä½ï¼Œè¾“å…¥æ³•æ”¾åœ¨ç¬¬äºŒä½ã€‚\nä¸ºé˜²æ­¢å’ŒWindowsä¸Šçš„è¾“å…¥æ³•åˆ‡æ¢å¿«æ·é”®å†²çªï¼Œè¿™é‡Œå°†å¿«æ·é”®åˆ‡æ¢æ›´æ”¹ä¸ºctrl+shift(Windowsä¸Šä¸ºshift)\nåˆ°è¿™é‡Œï¼Œé…ç½®å°±å®Œæˆäº†ã€‚\nå¼€å§‹è¾“å…¥\n  4. WSL å¼€å‘ç¯å¢ƒå¤‡ä»½ å¯ä»¥ä½¿ç”¨wsl --export \u0026lt;DistributionName\u0026gt; \u0026lt;fileName\u0026gt;ï¼Œ ä¾‹å¦‚ï¼Œæˆ‘ä»¬ä½¿ç”¨Ubuntu18.04çš„Linuxç‰ˆæœ¬ï¼Œé‚£ä¹ˆä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¯¼å‡ºï¼š\n# --export \u0026lt;åˆ†å‘ç‰ˆ\u0026gt; \u0026lt;æ–‡ä»¶å\u0026gt; wsl --export Ubuntu18.04 ubuntuLinux é‚£ä¹ˆå°±ä¼šåœ¨å½“å‰æ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆä¸€ä¸ªåä¸ºubuntuLinuxçš„æ–‡ä»¶ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬çš„WSLå¼€å‘ç¯å¢ƒäº†ã€‚\nå¦‚ä½•å¯¼å…¥ï¼Ÿ\n# --import \u0026lt;åˆ†å‘ç‰ˆ\u0026gt; \u0026lt;å®‰è£…ä½ç½®\u0026gt; \u0026lt;æ–‡ä»¶å\u0026gt;  wsl --import Ubuntu18.04 . ubuntuLinux  å¯¼å…¥çš„WSLé»˜è®¤ç”¨æˆ·ä¼šè¢«è®¾ç½®ä¸ºrootï¼Œä½†æ˜¯æœ‰æ—¶å€™ä½¿ç”¨rootä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œæ¯”å¦‚æˆ‘ä»¬ä½¿ç”¨æ™®é€šè´¦æˆ·å¼€å‘çš„é¡¹ç›®ï¼Œå¦‚æœç”¨rootæ‰“å¼€çš„è¯ï¼Œå¯èƒ½æœ‰äº›æ–‡ä»¶çš„æ‰€æœ‰äººå’Œæ‰€æœ‰ç»„ä¼šå˜æˆrootï¼Œè¿™æ—¶å€™å¦‚æœå†ä½¿ç”¨æ™®é€šè´¦æˆ·è¯»å†™å°±ä¼šäº§ç”Ÿé—®é¢˜ã€‚å› æ­¤è¦è®¾ç½®é»˜è®¤ç”¨æˆ·ä¸ºæ™®é€šç”¨æˆ·ã€‚\n sudo vim /etc/wsl.conf æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\n[user] default=lc FAQ   æ‰“å¼€çš„å›¾å½¢ç•Œé¢å­—ä½“å¾ˆæ¨¡ç³Š æ‰¾åˆ°è‡ªå·±çš„VcXsrvå®‰è£…ä½ç½®ï¼Œæ‰¾åˆ°vsxsrc.exeå’Œxlaunch.exeä¸¤ä¸ªåº”ç”¨ç¨‹åºæ–‡ä»¶ï¼Œå³é”®å±æ€§\u0026gt;å…¼å®¹æ€§\u0026gt;æ›´æ”¹é«˜DPIè®¾ç½®\u0026gt;å‹¾é€‰æ›¿ä»£é«˜DPIç¼©æ”¾è¡Œä¸ºï¼ˆåº”ç”¨ç¨‹åºï¼‰\u0026gt; ç¡®å®šã€‚\n  å¦‚ä½•ä»windowsè®¿é—®wsl2çš„ç½‘ç»œ\nåœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ˜¾ç¤ºwsl2çš„ipåœ°å€\n  wsl -- ifconfig eth0 å¯åŠ¨vsxsrcåï¼Œä¾ç„¶ä¸èƒ½æ‰“å¼€å›¾å½¢ç•Œé¢ é¦–å…ˆæ£€æŸ¥vsxsrcçš„é…ç½®æ˜¯å¦æ­£ç¡®ï¼Œç¯å¢ƒå˜é‡æ˜¯å¦é…ç½®ï¼Œè‹¥æ£€æŸ¥æ— è¯¯ï¼Œåˆ™å¯èƒ½æ˜¯é˜²ç«å¢™é˜»æ­¢äº†è¿æ¥ã€‚ å°è¯•å…³é—­å…¨éƒ¨é˜²ç«å¢™ï¼ˆäº‹åå†é‡æ–°æ‰“å¼€ï¼‰ï¼Œå†æ¬¡å°è¯•å¯åŠ¨ï¼Œè‹¥å¯ä»¥å¯åŠ¨æˆåŠŸï¼Œåˆ™è¯æ˜ä¸ºé˜²ç«å¢™é—®é¢˜ã€‚ ä¿®å¤æ–¹æ³•ï¼šç¡®ä¿é˜²ç«å¢™å…¥ç«™è§„åˆ™ä¸­ç§æœ‰å’Œå…¬æœ‰è§„åˆ™éƒ½å…è®¸è¿æ¥   Reference åœ¨WSLä¸Šé…ç½®è¾“å…¥æ³•\nwslä¸‹Ubuntuä¸­æ–‡æ˜¾ç¤ºæ–¹æ³•\nWSL ä¸‹ Ubuntu 20.04 ä¸­æ–‡æ˜¾ç¤ºè®¾ç½®\nWindows Subsystem for Linux Installation Guide for Windows 10\n","permalink":"http://yangchnet.github.io/Dessert/posts/env/wsl2-%E4%B8%8D%E8%BE%93mac%E7%9A%84%E5%BC%80%E5%8F%91%E4%BD%93%E9%AA%8C%E4%B8%80wsl2%E7%9A%84%E5%AE%89%E8%A3%85%E5%8F%8A%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE/","summary":"1. WSLçš„å®‰è£… 1.1 å‡çº§Windows WSLéœ€è¦é«˜ç‰ˆæœ¬çš„windowsï¼Œå¯ä½¿ç”¨å¾®è½¯å®˜æ–¹çš„æ˜“å‡å·¥å…·æˆ–ç›´æ¥ä»è®¾ç½®ä¸­å‡çº§ï¼Œå‡çº§éœ€è¦ä¸€å®šçš„æ—¶é—´ã€‚\n1.2 å®‰è£…WSL  ä½¿ç”¨ç®¡ç†å‘˜æ¨¡å¼æ‰“å¼€power shellï¼Œ ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¼€å¯WSLåŠŸèƒ½  dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart é‡å¯ä½ çš„æœºå™¨\nå¯ç”¨è™šæ‹ŸæœºåŠŸèƒ½ ä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€powershellï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š  dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart é‡æ–°å¯åŠ¨ç”µè„‘\nä¸‹è½½Linuxå†…æ ¸æ›´æ–°åŒ… é€‚ç”¨äº x64 è®¡ç®—æœºçš„ WSL2 Linux å†…æ ¸æ›´æ–°åŒ…  è¿è¡Œä½ ä¸‹è½½çš„æ›´æ–°åŒ…ã€‚\nå°†WSL2è®¾ç½®ä¸ºé»˜è®¤ç‰ˆæœ¬ ä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€powershellï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š  wsl --set-default-version 2 é€‰æ‹©ä½ è¦å®‰è£…çš„å‘è¡Œç‰ˆ  è¿™é‡Œæˆ‘é€‰æ‹©äº†Ubuntu18.04ï¼Œè·å–åå®‰è£…\nå¯åŠ¨å®‰è£…çš„å‘è¡Œç‰ˆå³å¯  2. ä½¿ç”¨WSLå›¾å½¢ç•Œé¢(å¯é€‰)  è®¾ç½®ç¯å¢ƒå˜é‡  export DISPLAY=$(awk \u0026#39;/nameserver / {print $2; exit}\u0026#39; /etc/resolv.conf 2\u0026gt;/dev/null):0 export LIBGL_ALWAYS_INDIRECT=1  å®‰è£…Xserverï¼Œè¿™é‡Œé€‰æ‹©çš„è½¯ä»¶æ˜¯vcxsrvï¼Œ å¯åœ¨sourceforgeä¸­ä¸‹è½½å®‰è£…ã€‚\n  å®‰è£…å®Œæˆåç›´æ¥å¯åŠ¨å³å¯","title":"WSL2-ä¸è¾“Macçš„å¼€å‘ä½“éªŒï¼ˆä¸€ï¼‰ï¼šWSL2çš„å®‰è£…åŠåŸºæœ¬é…ç½®"},{"content":"1. go generate go generateå‘½ä»¤è¿è¡Œæ—¶ï¼Œå°†æ‰¾åˆ°æºä»£ç ä¸­æ‰€æœ‰åŒ…å«//go:generateçš„ç‰¹æ®Šæ³¨é‡Šï¼Œæå–å¹¶æ‰§è¡Œ//go:generateåé™„åŠ çš„å‘½ä»¤ã€‚\nåŸºæœ¬è¯­æ³•ï¼š\n//go:generate [-run regexp] [-n] [-v] [-x] [build flags] [file.go... | packages] éœ€è¦æ³¨æ„çš„å‡ ç‚¹ï¼š\n è¯¥ç‰¹æ®Šæ³¨é‡Šå¿…é¡»åœ¨.goæºç æ–‡ä»¶ä¸­ã€‚ æ¯ä¸ªæºç æ–‡ä»¶å¯ä»¥åŒ…å«å¤šä¸ªgenerateç‰¹æ®Šæ³¨é‡Šã€‚ go generateåªåœ¨è¿è¡Œgo generateå‘½ä»¤æ—¶è¿è¡Œï¼Œgo build, go get, go testç­‰å…¶ä»–å‘½ä»¤ä¸ä¼šè¿è¡Œå®ƒã€‚ å‘½ä»¤ä¸²è¡Œæ‰§è¡Œçš„ï¼Œå¦‚æœå‡ºé”™ï¼Œå°±ç»ˆæ­¢åé¢çš„æ‰§è¡Œã€‚ ç‰¹æ®Šæ³¨é‡Šå¿…é¡»ä»¥\u0026quot;//go:generate\u0026quot;å¼€å¤´ï¼ŒåŒæ–œçº¿åé¢æ²¡æœ‰ç©ºæ ¼ã€‚  ç®€å•çš„ä¾‹å­ï¼š\npackage main import \u0026#34;fmt\u0026#34; //go:generate echo \u0026#34;world\u0026#34; func main() { fmt.Println(\u0026#34;hello\u0026#34;) } è¿è¡Œç»“æœï¼š\nåœ¨go generateå‘½ä»¤ä¸­ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ä¸€äº›ç¯å¢ƒå˜é‡ï¼š\n $GOARCH The execution architecture (arm, amd64, etc.) $GOOS The execution operating system (linux, windows, etc.) $GOFILE The base name of the file. $GOLINE The line number of the directive in the source file. $GOPACKAGE The name of the package of the file containing the directive. $DOLLAR A dollar sign. go generateçš„å‚æ•°\n-run æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…å‘½ä»¤è¡Œï¼Œä»…æ‰§è¡ŒåŒ¹é…çš„å‘½ä»¤ -v è¾“å‡ºè¢«å¤„ç†çš„åŒ…åå’Œæºæ–‡ä»¶å -n åªæ˜¾ç¤ºè¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œä½†ä¸æ‰§è¡Œ -x æ˜¾ç¤ºè¦æ‰§è¡Œçš„å‘½ä»¤å¹¶æ‰§è¡Œ 2. ä½¿ç”¨go generateè‡ªåŠ¨ç”Ÿæˆmockæ¥å£ åœ¨æˆ‘ä»¬å¯¹ä»£ç è¿›è¡Œå•å…ƒæµ‹è¯•æ—¶ï¼ŒæŸæ®µä»£ç å¯èƒ½æœ‰ä¸€äº›ä¾èµ–é¡¹ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨å»æ„å»ºè¿™äº›ä¾èµ–é¡¹ã€‚ä½†å½“ä¾èµ–é¡¹è¿‡å¤šæ—¶ï¼Œæ‰‹åŠ¨å»æ„å»ºæ¯ä¸€ä¸ªä¾èµ–é¡¹å°±æ˜¯ä¸€é¡¹å¤æ‚ã€è‰°å·¨ä¸”æ— èŠçš„å·¥ä½œã€‚è¿™æ—¶å€™ï¼Œå°±åˆ°äº†mockå¤§æ˜¾èº«æ‰‹çš„æ—¶å€™ã€‚mockä¼šä¸ºä½ æä¾›ä¸€äº›è™šæ‹Ÿçš„ä¾èµ–é¡¹ï¼Œå¹¶è§„å®šå®ƒä»¬çš„è¡Œä¸ºï¼Œä»è€Œä½ å¯ä»¥æ–¹ä¾¿çš„åœ¨è‡ªå·±çš„æµ‹è¯•ä¸­ä½¿ç”¨å®ƒã€‚\ngomocké’ˆå¯¹æ¥å£è¿›è¡Œmockæ“ä½œã€‚\nä¾‹å¦‚ï¼šæˆ‘ä»¬æœ‰ä¸€ä¸ªClientæ¥å£ï¼Œè¿™ä¸ªæ¥å£çš„Addressæ–¹æ³•è¿”å›å…¶åœ°å€ï¼ŒServeæ–¹æ³•ä¸­éœ€è¦ç”¨åˆ°è¿™ä¸ªClientçš„Addressã€‚å‡è®¾ç°åœ¨æˆ‘ä»¬è¿˜æ²¡æœ‰é…ç½®å®ŒæˆClientï¼Œä½†éœ€è¦å…ˆå¯¹Serveçš„è¡Œä¸ºè¿›è¡Œæµ‹è¯•ã€‚è¿™æ—¶æˆ‘ä»¬å¯ä»¥\u0026quot;mock\u0026quot;å‡ºä¸€ä¸ªClientã€‚\ntype Client interface { Address() string } func Serve(c Client) { // ...  address := client.Address() // ... } æ¥ä¸‹æ¥æˆ‘ä»¬åº”è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ\n  å®‰è£…gomock\n  ç”Ÿæˆmockæ–‡ä»¶\n  åœ¨å•å…ƒæµ‹è¯•ä¸­è§„å®šClientçš„æ“ä½œä»¥æ£€æŸ¥Serveçš„è¡Œä¸º\n  å®‰è£…gomock\n  $ go install github.com/golang/mock/mockgen@v1.5.0 ç”Ÿæˆmockæ–‡ä»¶ åœ¨ä½ çš„é¡¹ç›®ç›®å½•ä¸­è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š  $ mockgen -destination=mock_client.go -package=mock . Client å…¶ä¸­-destinationæŒ‡å®šäº†éœ€è¦ç”Ÿæˆçš„æ–‡ä»¶åï¼Œ -packageæŒ‡å®šäº†ç”Ÿæˆçš„mockæ–‡ä»¶çš„åŒ…åï¼Œè‹¥ä¸æŒ‡å®šï¼Œåˆ™é»˜è®¤ä¸ºmock_åè·Ÿè¾“å…¥æ–‡ä»¶çš„åŒ…å, ç‚¹.æŒ‡å®šäº†æºç›®å½•ï¼Œæœ€åçš„ClientæŒ‡éœ€è¦mockè¯¥æ¥å£ã€‚\nè¿è¡Œä¸Šé¢å‘½ä»¤åï¼Œå°±å¯ä»¥åœ¨æœ¬åœ°ç”Ÿæˆmock_client.goæ–‡ä»¶ã€‚\nåœ¨å•å…ƒæµ‹è¯•ä¸­è§„å®šClientçš„æ“ä½œä»¥æ£€æŸ¥Serveçš„è¡Œä¸º  func Test_Serve(t *testing.T) { ctrl := gomock.NewController(t) defer ctrl.Finish() c := NewMockClient(ctrl) // æ„å»ºå‡ºmockçš„Client  c.EXCEPT().Address().RETURN(\u0026#34;127.0.0.1\u0026#34;).AnyTimes() // å½“ä½¿ç”¨Client.Address()æ–¹æ³•æ—¶è¿”å›â€127.0.0.1â€œï¼Œå¯ä½¿ç”¨ä»»æ„æ¬¡  Server(c) // ... }  æ¯æ¬¡ä½¿ç”¨c.EXCEPT().Address().RETURN()ä»…èƒ½ä¸ºä¸€æ¬¡Address()æŒ‡å®šè¿”å›ï¼Œå¯å¤šæ¬¡ä½¿ç”¨è¯¥æ–¹æ³•ä»¥è¿”å›ä¸åŒçš„å€¼ã€‚\n æœ€åï¼Œmockå’Œgo generateæœ‰å•¥å…³ç³»ï¼Ÿ\næˆ‘ä»¬å¯ä»¥å°†go generateç‰¹æ®Šæ³¨é‡Šå†™åœ¨æ¥å£çš„å¤´éƒ¨ï¼Œç„¶åç›´æ¥ä½¿ç”¨go generateå‘½ä»¤æ¥æ–¹ä¾¿å¿«æ·çš„ç”Ÿæˆmockæ–‡ä»¶ã€‚å¦‚ä¸‹ï¼š\n//go:generate mockgen -destination=mock_client.go -package=mock . Clien type Client interface { Address() string } 3. ä½¿ç”¨go generateç”Ÿæˆé”™è¯¯ç  stringeræ˜¯ç”¨äºè‡ªåŠ¨åˆ›å»ºæ»¡è¶³fmt.Stringeræ–¹æ³•çš„å·¥å…·ã€‚ç»™å®šä¸€ä¸ªå˜é‡/å¸¸é‡åT, stringerå¯ä»¥ç”Ÿæˆç±»ä¼¼ä¸‹é¢æ–¹æ³•çš„ä»£ç ï¼š\nfunc (t T) String string  ä»¥ä¸‹å†…å®¹ä¸»è¦å‚è€ƒäº†ï¼š æ·±å…¥ç†è§£Goä¹‹generate\n åœ¨æˆ‘ä»¬çš„æœåŠ¡ä¸­ï¼Œç»å¸¸ä¼šä½¿ç”¨ä¸€äº›é”™è¯¯ç ï¼Œè¿™æ—¶å°±éœ€è¦æˆ‘ä»¬å»å®šä¹‰errCodeå’ŒErrMsg, è¿™é‡Œä»‹ç»ä¸€ç§ä¼˜é›…çš„æ–¹æ³•è§£å†³è¿™ä¸ªé—®é¢˜ã€‚\nå®šä¹‰é”™è¯¯ç çš„ä¼ ç»Ÿæ–¹å¼\nå®šä¹‰é”™è¯¯ç ï¼š\npackage errcode import \u0026#34;fmt\u0026#34; // å®šä¹‰é”™è¯¯ç  const ( ERR_CODE_OK = 0 // OK  ERR_CODE_INVALID_PARAMS = 1 // æ— æ•ˆå‚æ•°  ERR_CODE_TIMEOUT = 2 // è¶…æ—¶  // ... ) // å®šä¹‰é”™è¯¯ç ä¸æè¿°ä¿¡æ¯çš„æ˜ å°„ var mapErrDesc = map[int]string { ERR_CODE_OK: \u0026#34;OK\u0026#34;, ERR_CODE_INVALID_PARAMS: \u0026#34;æ— æ•ˆå‚æ•°\u0026#34;, ERR_CODE_TIMEOUT: \u0026#34;è¶…æ—¶\u0026#34;, // ... } // æ ¹æ®é”™è¯¯ç è¿”å›æè¿°ä¿¡æ¯ func GetDescription(errCode int) string { if desc, exist := mapErrDesc[errCode]; exist { return desc } return fmt.Sprintf(\u0026#34;error code: %d\u0026#34;, errCode) } ä½¿ç”¨é”™è¯¯ç ï¼š\npackage main import ( \u0026#34;github.com/darjun/errcode\u0026#34; ) func main() { code := errcode.ERR_CODE_INVALID_PARAMS fmt.Println(code, errcode.GetDescription(errCode)) // è¾“å‡º: 1 æ— æ•ˆå‚æ•° } ä¸ºäº†ä½¿ç”¨æ–¹ä¾¿ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºé”™è¯¯ç å®šä¹‰ä¸€ä¸ªæ–°çš„ç±»å‹ï¼Œç„¶åä¸ºè¯¥ç±»å‹å®šä¹‰String()æ–¹æ³•ï¼Œè¿™æ ·å°±ä¸ç”¨æ‰‹åŠ¨è°ƒç”¨GetDescriptionå‡½æ•°äº†ã€‚ä¿®æ”¹å¦‚ä¸‹ï¼š\ntype ErrCode int const ( ERR_CODE_OK ErrCode = 0 // OK  ERR_CODE_INVALID_PARAMS ErrCode = 1 // æ— æ•ˆå‚æ•°  ERR_CODE_TIMEOUT ErrCode = 2 // è¶…æ—¶ ) func (e ErrCode) String() string { return GetDescription(e) } è¿™ç§æ–¹å¼æœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ æ¯æ¬¡å¢åŠ é”™è¯¯ç æ—¶ï¼Œéƒ½éœ€è¦ä¿®æ”¹é”™è¯¯ç åˆ°é”™è¯¯ä¿¡æ¯çš„mapï¼Œæœ‰æ—¶å€™å¯èƒ½ä¼šå¿˜ï¼Œ å¦å¤–ï¼Œé”™è¯¯ä¿¡æ¯åœ¨æ³¨é‡Šå’Œmapä¸­éƒ½å‡ºç°äº†ï¼Œæœ‰ä¸€å®šçš„å†—ä½™ã€‚ é‚£èƒ½ä¸èƒ½åªå†™æ³¨é‡Šï¼Œç„¶åè‡ªåŠ¨ç”Ÿæˆä»£ç å‘¢ï¼Ÿ\nä½¿ç”¨\nstringeræœ‰ä¸¤ç§æ¨¡å¼ï¼Œé»˜è®¤æ˜¯æ ¹æ®å˜é‡/å¸¸é‡åæ¥ç”Ÿæˆå­—ç¬¦ä¸²æè¿°ã€‚æˆ‘ä»¬åœ¨å¸¸é‡å®šä¹‰ä¸Šå¢åŠ æ³¨é‡Šï¼š\n//go:generate stringer -type ErrCode é€‰é¡¹-typeæŒ‡å®šstringerå‘½ä»¤ä½œç”¨çš„ç±»å‹åã€‚ ç„¶ååœ¨åŒä¸€ä¸ªç›®å½•ä¸‹æ‰§è¡Œï¼š\n$ go generate è¿™ä¼šåœ¨åŒä¸€ä¸ªç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªæ–‡ä»¶errcode_string.goã€‚æ–‡ä»¶åæ ¼å¼æ˜¯ç±»å‹åå°å†™_string.goã€‚ä¹Ÿå¯ä»¥é€šè¿‡-outputé€‰é¡¹æŒ‡å®šè¾“å‡ºæ–‡ä»¶åï¼Œä¾‹å¦‚ä¸‹é¢å°±æ˜¯æŒ‡å®šè¾“å‡ºæ–‡ä»¶åä¸ºcode_string.goï¼š\n//go:generate stringer -type ErrCode -output code_string.go æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹ï¼š\n// Code generated by \u0026#34;stringer -type ErrCode -output errcode_string.go\u0026#34;; DO NOT EDIT.  package errcode import \u0026#34;strconv\u0026#34; const _ErrCode_name = \u0026#34;ERR_CODE_OKERR_CODE_INVALID_PARAMSERR_CODE_TIMEOUT\u0026#34; var _ErrCode_index = [...]uint8{0, 11, 34, 50} func (i ErrCode) String() string { if i \u0026lt; 0 || i \u0026gt;= ErrCode(len(_ErrCode_index)-1) { return \u0026#34;ErrCode(\u0026#34; + strconv.FormatInt(int64(i), 10) + \u0026#34;)\u0026#34; } return _ErrCode_name[_ErrCode_index[i]:_ErrCode_index[i+1]] } å¤åˆ¶ä»£ç ç”Ÿæˆçš„ä»£ç åšäº†ä¸€äº›ä¼˜åŒ–ï¼Œå‡å°‘äº†å­—ç¬¦ä¸²å¯¹è±¡çš„æ•°é‡ã€‚\nè¿™æ—¶ERR_CODE_INVALID_PARAMS.String()è¿”å›çš„æè¿°ä¿¡æ¯æ˜¯ERR_CODE_INVALID_PARAMSã€‚åœ¨ä¸€äº›ä¸Šä¸‹æ–‡ä¸­ç”šè‡³ä¸éœ€è¦è‡ªå·±è°ƒç”¨String()æ–¹æ³•ï¼Œå¦‚fmt.Printlnã€‚å› ä¸ºErrCodeå®ç°äº†fmt.Stringerï¼Œä¸€äº›ä¸Šä¸‹æ–‡ä¸­ä¼šè‡ªåŠ¨è°ƒç”¨ã€‚\nè¿™æ ·errcode.goæ–‡ä»¶ä¸­mapErrDescå…¨å±€å˜é‡å’ŒgetDescriptionå‡½æ•°éƒ½å¯ä»¥å»æ‰äº†ã€‚\nä½†æ˜¯æˆ‘ä»¬æ›´å¸Œæœ›çš„æ˜¯èƒ½è¿”å›åé¢çš„æ³¨é‡Šä½œä¸ºé”™è¯¯æè¿°ã€‚\nè¿™å°±éœ€è¦ä½¿ç”¨stringerçš„-linecommenté€‰é¡¹ã€‚ä¿®æ”¹go:generateå¦‚ä¸‹ï¼š\n//go:generate stringer -type ErrCode -linecomment -output code_string.go å¤åˆ¶ä»£ç ç„¶åï¼Œæ‰§è¡Œgo generateå‘½ä»¤ã€‚ç”Ÿæˆçš„code_string.goä¸ä¹‹å‰çš„æœ‰æ‰€ä¸åŒï¼Œå¦‚ä¸‹ï¼š\nconst _ErrCode_name = \u0026#34;OKæ— æ•ˆå‚æ•°è¶…æ—¶\u0026#34; var _ErrCode_index = [...]uint8{0, 2, 14, 20} å¤åˆ¶ä»£ç å¯ä»¥çœ‹åˆ°ç¡®å®é€šè¿‡æ³¨é‡Šç”Ÿæˆäº†é”™è¯¯æ¶ˆæ¯ã€‚\nReference æ·±å…¥ç†è§£Goä¹‹generate\nGoMock\nstringer\nPackage generate\ngo generateä»‹ç»\n","permalink":"http://yangchnet.github.io/Dessert/posts/golang/go-generate%E5%B7%A5%E5%85%B7/","summary":"1. go generate go generateå‘½ä»¤è¿è¡Œæ—¶ï¼Œå°†æ‰¾åˆ°æºä»£ç ä¸­æ‰€æœ‰åŒ…å«//go:generateçš„ç‰¹æ®Šæ³¨é‡Šï¼Œæå–å¹¶æ‰§è¡Œ//go:generateåé™„åŠ çš„å‘½ä»¤ã€‚\nåŸºæœ¬è¯­æ³•ï¼š\n//go:generate [-run regexp] [-n] [-v] [-x] [build flags] [file.go... | packages] éœ€è¦æ³¨æ„çš„å‡ ç‚¹ï¼š\n è¯¥ç‰¹æ®Šæ³¨é‡Šå¿…é¡»åœ¨.goæºç æ–‡ä»¶ä¸­ã€‚ æ¯ä¸ªæºç æ–‡ä»¶å¯ä»¥åŒ…å«å¤šä¸ªgenerateç‰¹æ®Šæ³¨é‡Šã€‚ go generateåªåœ¨è¿è¡Œgo generateå‘½ä»¤æ—¶è¿è¡Œï¼Œgo build, go get, go testç­‰å…¶ä»–å‘½ä»¤ä¸ä¼šè¿è¡Œå®ƒã€‚ å‘½ä»¤ä¸²è¡Œæ‰§è¡Œçš„ï¼Œå¦‚æœå‡ºé”™ï¼Œå°±ç»ˆæ­¢åé¢çš„æ‰§è¡Œã€‚ ç‰¹æ®Šæ³¨é‡Šå¿…é¡»ä»¥\u0026quot;//go:generate\u0026quot;å¼€å¤´ï¼ŒåŒæ–œçº¿åé¢æ²¡æœ‰ç©ºæ ¼ã€‚  ç®€å•çš„ä¾‹å­ï¼š\npackage main import \u0026#34;fmt\u0026#34; //go:generate echo \u0026#34;world\u0026#34; func main() { fmt.Println(\u0026#34;hello\u0026#34;) } è¿è¡Œç»“æœï¼š\nåœ¨go generateå‘½ä»¤ä¸­ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ä¸€äº›ç¯å¢ƒå˜é‡ï¼š\n $GOARCH The execution architecture (arm, amd64, etc.) $GOOS The execution operating system (linux, windows, etc.) $GOFILE The base name of the file.","title":"go generateå·¥å…·"},{"content":" contextåŒ…å®šä¹‰äº†Contextç±»å‹ï¼Œè¿™ä¸ªç±»å‹åœ¨APIè¾¹ç•Œå³è¿›ç¨‹ä¸­ä¼ é€’æˆªæ­¢æ—¥æœŸã€åŒæ­¥ä¿¡å·ï¼Œè¯·æ±‚å€¼ç­‰ç›¸å…³ä¿¡æ¯ã€‚\n 1. å¯¹contextåŒ…çš„ä»‹ç» åœ¨æœåŠ¡å™¨çš„ä¼ å…¥è¯·æ±‚ä¸­åº”åŒ…å«contextï¼Œè€Œå¯¹æœåŠ¡å™¨çš„ä¼ å‡ºè°ƒç”¨åº”æ¥æ”¶ä¸€ä¸ªcontextã€‚å®ƒä»¬ä¹‹é—´çš„è°ƒç”¨é“¾å¿…é¡»åŒ…å«contextï¼Œæˆ–æ˜¯è¡ç”Ÿçš„WithCancel, WithDeadline, WithTimeout, WithValueã€‚å½“ä¸€ä¸ªWithCancel Contextè¢«â€œcancelâ€ï¼Œé‚£ä¹ˆå½“å‰contextæ‰€æ´¾ç”Ÿçš„æ‰€æœ‰contextä¹Ÿéƒ½å°†è¢«å–æ¶ˆã€‚\nWithCancel, WithDeadline, WithTimeoutæ¥æ”¶ä¸€ä¸ªContextå¯¹è±¡ï¼ˆçˆ¶å¯¹è±¡ï¼‰ï¼Œå¹¶è¿”å›å…¶çˆ¶å¯¹è±¡çš„ä¸€ä¸ªæºå¸¦æœ‰cancel/deadline/timeoutçš„ä¸€ä¸ªæ‹·è´ï¼ˆå­å¯¹è±¡ï¼‰ã€‚è°ƒç”¨CancelFuncä¼šå–æ¶ˆå…¶å­å¯¹è±¡åŠå­å¯¹è±¡çš„å­å¯¹è±¡ç­‰ï¼Œåˆ é™¤çˆ¶å¯¹è±¡å¯¹å­å¯¹è±¡çš„å¼•ç”¨ï¼Œå¹¶åœæ­¢æ‰€æœ‰å…³è”çš„è®¡æ—¶å™¨ã€‚æœªèƒ½è°ƒç”¨CancelFuncå°†é€ æˆçˆ¶å¯¹è±¡ç»“æŸå‰æˆ–è®¡æ—¶å™¨è¢«è§¦å‘å‰å­å¯¹è±¡çš„æ³„éœ²ã€‚ä½¿ç”¨go vetå·¥å…·å¯ä»¥æ£€æŸ¥æ‰€æœ‰æ§åˆ¶æµè·¯å¾„ä¸Šæ˜¯å¦éƒ½ä½¿ç”¨äº†CancelFunc\nä½¿ç”¨contextçš„ç¨‹åºåº”éµå¾ªä»¥ä¸‹è§„åˆ™ï¼Œä»¥ä½¿å„ä¸ªåŒ…ä¹‹é—´çš„æ¥å£ä¿æŒä¸€è‡´ï¼Œå¹¶å¯ç”¨é™æ€åˆ†æå·¥å…·æ¥æ£€æŸ¥ä¸Šä¸‹æ–‡ä¼ æ’­ï¼š\n ä¸è¦å°†contextå­˜å‚¨åœ¨ç»“æ„ç±»å‹ä¸­ï¼Œè€Œæ˜¯å°†contextæ˜ç¡®ä¼ é€’ç»™éœ€è¦å®ƒçš„æ¯ä¸ªå‡½æ•°ã€‚Contextåº”è¯¥æ˜¯ç¬¬ä¸€ä¸ªå‡½æ•°ï¼Œé€šå¸¸å‘½åä¸ºctxã€‚  func DoSomething(ctx context.Context, arg Arg) error { // ...use ctx... } ä¸è¦ä¼ é€’ä¸€ä¸ªå€¼ä¸ºnilçš„contextï¼Œå³ä½¿ä¸€ä¸ªå‡½æ•°å…è®¸è¿™æ ·åšã€‚å¦‚æœä½ ä¸ç¡®å®šContextçš„ä½œç”¨é‚£å°±è¯·ä¼ é€’context.TODOã€‚ åªåœ¨è¿›ç¨‹å’ŒAPIé—´ä¼ é€’è¯·æ±‚èŒƒå›´æ•°æ®æ—¶ä½¿ç”¨contextå€¼ï¼Œä¸è¦ç”¨äºå°†å¯é€‰å‚æ•°ä¼ é€’ç»™å‡½æ•°ã€‚ åŒæ ·çš„Contextå¯ä»¥ä¼ é€’ç»™è¿è¡Œåœ¨ä¸åŒgoroutineä¸­çš„å‡½æ•°ï¼ŒContextæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚  2. Contextæ¥å£ type Context interface { Done() \u0026lt;-chan struct{} Err() error Deadline() (deadline time.Time, ok bool) Value(key interface{}) interface{} } Contextæ˜¯ä¸€ä¸ªæ¥å£ï¼Œå…¶å®šä¹‰éå¸¸çš„ç®€å•ï¼ŒåªåŒ…å«4ä¸ªæ–¹æ³•ï¼š\n  Done() \u0026lt;-chan struct{} Done()æ–¹æ³•å°†ä¸€ä¸ªchannelä½œä¸ºå–æ¶ˆä¿¡å·è¿”å›ç»™æŒæœ‰contextçš„å‡½æ•°ï¼Œå½“è¯¥channelè¢«å…³é—­ï¼ˆå³Done()è¢«è°ƒç”¨ï¼‰ï¼Œè¿™äº›å‡½æ•°åº”è¯¥ç«‹å³åœæ­¢å…¶å·¥ä½œå¹¶è¿”å›ã€‚\n  Err() error Err()è¿”å›ä¸€ä¸ªErrorï¼Œè¯´æ˜ä¸ºä»€ä¹ˆå–æ¶ˆcontextã€‚å¦‚æœDone()æ²¡æœ‰è¢«è°ƒç”¨ï¼Œé‚£ä¹ˆErrè¿”å›nilã€‚\n  Deadline() (deadline time.Time, ok bool) Deadline()æ–¹æ³•è¿”å›æŒæœ‰è¿™ä¸ªcontextçš„å‡½æ•°çš„é¢„æœŸç»“æŸæ—¶é—´ã€‚å¦‚æœå¹¶æ²¡æœ‰è®¾ç½®deadlineï¼Œé‚£ä¹ˆè¿”å›çš„okå°†è¢«è®¾ç½®ä¸ºfalseã€‚\n  Value(key interface{}) interface{} Value()æ–¹æ³•è¿”å›ä¸æ­¤contextå…³è”çš„keyï¼Œå¦‚æœæ²¡æœ‰ä¸keyå¯¹åº”çš„å€¼é‚£ä¹ˆè¿”å›nilã€‚ keyå¯ä»¥æ˜¯ä»»ä½•æ”¯æŒæ¯”è¾ƒçš„ç±»å‹ï¼Œä¸ºäº†é¿å…å†²çªï¼Œåº”å°†keyå®šä¹‰ä¸ºä¸å¯å¯¼å‡ºçš„ã€‚ ç¤ºä¾‹ï¼š\npackage user import \u0026#34;context\u0026#34; type User struct{...} type key int var userKey key func NewContext(ctx context.Context, u *User) context.Context { return context.WithValue(ctx, userKey, u) } func FromContext(ctx context.Context)(*User, bool){ u, ok := ctx.Value(userKey).(*User) return u, ok }   3. Contextæ„é€  æ„é€ ä¸€ä¸ªcontextå¯¹è±¡æœ‰ä¸¤ç§æ–¹æ³•ã€‚\nfunc Background() Context func TODO() Context ä¸Šé¢ä¸¤ä¸ªæ–¹æ³•éƒ½ä¼šè¿”å›ä¸€ä¸ªénilï¼Œéç©ºçš„Contextå¯¹è±¡ã€‚Background()ä¸€èˆ¬ç”¨äºæ„é€ å‡ºæœ€åˆçš„Contextï¼Œæ‰€æœ‰çš„Contextéƒ½æ´¾ç”Ÿè‡ªå®ƒã€‚TODO()ç”¨å½“ä¼ å…¥çš„æ–¹æ³•ä¸ç¡®å®šæ˜¯å“ªç§ç±»å‹çš„Contextæ—¶ï¼Œä¸ºäº†é¿å…Contextå‚æ•°ä¸ºnilè€Œåˆå§‹åŒ–çš„Contextã€‚\næ„é€ å‡ºContextå¯¹è±¡åï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨WithCancel, WithDeadline, WithTimeout, WithValueæ¥è¿›ä¸€æ­¥çš„è®¾ç½®Contextï¼Œæ„é€ å‡ºçš„Contextéƒ½æ´¾ç”Ÿè‡ªBackgroundæˆ–æ˜¯TODO 4. context.With\u0026hellip; 4.1 context.WithCancel() func WithCancel(parent Context) (ctx Context, cancel CancelFunc) WithCancelæ¥æ”¶ä¸€ä¸ªçˆ¶contextå¹¶è¿”å›è¯¥çˆ¶contextçš„ä¸€ä¸ªæŒæœ‰Done channelçš„å­contextå’Œä¸€ä¸ªcancelæ–¹æ³•ï¼Œå½“cancelæ–¹æ³•è¢«è°ƒç”¨æ—¶æˆ–æ˜¯çˆ¶contextçš„Done channelè¢«å…³é—­æ—¶ï¼Œå½“å‰contextçš„Done channelå°†è¢«å…³é—­ã€‚\nWithCancelå¸¸è¢«ç”¨äºé€šçŸ¥goroutineé€€å‡ºã€‚\nfunc fibonacci(c chan int, ctx context.Context) { x, y := 0, 1 for{ select { case c \u0026lt;- x: x, y = y, x+y case \u0026lt;-ctx.Done(): fmt.Println(\u0026#34;quit\u0026#34;) return } } } func main() { defer func() { time.Sleep(time.Second) fmt.Println(\u0026#34;the number of goroutines: \u0026#34;, runtime.NumGoroutine()) }() ctx, cancel := context.WithCancel(context.Background()) defer cancel() c := make(chan int) go fibonacci(c, ctx) for i := 0; i \u0026lt; 10; i++{ fmt.Println(\u0026lt;- c) } } 4.2 context.WithValue() func WithValue(parent Context, key, val interface{}) Context WithValueæ–¹æ³•æ¥æ”¶ä¸€ä¸ªçˆ¶contextï¼Œä»¥åŠä¸€ä¸ªé”®å€¼å¯¹ï¼Œè¿”å›ä¸€ä¸ªåŒ…å«è¿™ä¸ªé”®å€¼å¯¹çš„å­contextã€‚å¯ä½¿ç”¨context.Value(key)æ–¹æ³•å–å‡ºå…¶ä¸­ä¿å­˜çš„å€¼ã€‚\nfunc main() { ctx, cancel := context.WithCancel(context.Background()) valueCtx := context.WithValue(ctx, key, \u0026#34;add value\u0026#34;) go watch(valueCtx) time.Sleep(10 * time.Second) cancel() time.Sleep(5 * time.Second) } func watch(ctx context.Context) { for { select { case \u0026lt;-ctx.Done(): //get value \tfmt.Println(ctx.Value(key), \u0026#34;is cancel\u0026#34;) return default: //get value \tfmt.Println(ctx.Value(key), \u0026#34;int goroutine\u0026#34;) time.Sleep(2 * time.Second) } } } 4.3 context.WithDeadline() func WithDeadline(parent Context, d time.Time) (Context, CancelFunc) WithDeadlineæ–¹æ³•æ¥æ”¶ä¸€ä¸ªçˆ¶contextå’Œä¸€ä¸ªæˆªæ­¢æ—¶é—´dï¼Œè¿”å›å­contextå¹¶ä¸ºå…¶è®¾ç½®ä¸€ä¸ªä¸æ™šäºdçš„æˆªæ­¢æ—¶é—´ã€‚å¦‚æœçˆ¶contextçš„æˆªæ­¢æ—¶é—´å·²ç»æ—©äºd, é‚£ä¹ˆWithDeadlineåœ¨è¯­ä¹‰ä¸Šä¸çˆ¶contextç›¸åŒã€‚å½“ä»¥ä¸‹ä¸‰ç§æƒ…å†µå‘ç”Ÿæ—¶ï¼š1.æˆªæ­¢æ—¶é—´åˆ°æ¥ï¼Œ2.cancelFuncè¢«è°ƒç”¨ï¼Œ3.çˆ¶contextçš„Done channelè¢«å…³é—­ï¼Œå½“å‰contextçš„Done channelå°†è¢«å…³é—­ã€‚\nfunc main() { d := time.Now().Add(5 * time.Second) // 5ç§’ååˆ°æœŸ \tctx, cancel := context.WithDeadline(context.Background(), d) defer cancel() // ä¸€ä¸ªå¥½çš„ä¹ æƒ¯æ˜¯è°ƒç”¨cancel()ä»¥é˜²æ­¢goroutineæ³„éœ²  go doSomething(ctx) time.Sleep(10 * time.Second) } func doSomething(ctx context.Context) { for { select { case \u0026lt;-time.After(time.Second): fmt.Println(\u0026#34;I\u0026#39;m doing some funny things\u0026#34;) case \u0026lt;-ctx.Done(): // 5ç§’æ—¶åˆ°æœŸ \tfmt.Println(ctx.Err()) return } } } I'm doing some funny things I'm doing some funny things I'm doing some funny things I'm doing some funny things context deadline exceeded 4.4 context.WithTimeout() func WithTimeout(parent Context, timeout time.Duration) (Context, CancelFunc) { return WithDeadline(parent, time.Now().Add(timeout)) } ä»å…¶å®ç°å°±å¯ä»¥çœ‹å‡ºï¼ŒWithTimeoutåªæ˜¯å¯¹WithDeadlineçš„è¿›ä¸€æ­¥å°è£…ï¼Œè¿™å±‚å°è£…ä¸ºcontextè®¾ç½®äº†ä¸€ä¸ªæˆªæ­¢æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯è§„å®šäº†å…¶è¶…æ—¶æ—¶é—´ã€‚\nfunc main() { ctx, cancel := context.WithTimeout(context.Background(), time.Duration(2*time.Second)) // è¶…è¿‡ä¸¤ç§’å°±é€€å‡ºï¼Œä¸å†continue \tdefer cancel() // ä¸€ä¸ªå¥½çš„ä¹ æƒ¯æ˜¯è°ƒç”¨cancel()ä»¥é˜²æ­¢goroutineæ³„éœ²  go seek(ctx) time.Sleep(5 * time.Second) } func seek(ctx context.Context) { for { select { case \u0026lt;-time.After(time.Second): fmt.Println(\u0026#34;I\u0026#39;m looking for something\u0026#34;) case \u0026lt;-ctx.Done(): fmt.Println(ctx.Err()) return } } } 5. contextåŒ…çš„å…¶ä»–å‡½æ•° 5.1 context.String() å®ç°fmt.Stringeræ¥å£ï¼Œç”¨äºæ‰“å°context\nfunc main() { backgroundCtx := context.Background() fmt.Println(backgroundCtx) withValueCtx := context.WithValue(backgroundCtx, \u0026#34;one\u0026#34;, 1) fmt.Println(withValueCtx) withCancelCtx, cancel := context.WithCancel(withValueCtx) defer cancel() fmt.Println(withCancelCtx) d := time.Now().Add(2 * time.Second) withDeadlineCtx, cancel := context.WithDeadline(withCancelCtx, d) defer cancel() fmt.Println(withDeadlineCtx) withTimeoutCtx, cancel := context.WithTimeout(withDeadlineCtx, time.Duration(2 * time.Second)) defer cancel() fmt.Println(withTimeoutCtx) } context.Background context.Background.WithValue(type string, val \u0026lt;not Stringer\u0026gt;) context.Background.WithValue(type string, val \u0026lt;not Stringer\u0026gt;).WithCancel context.Background.WithValue(type string, val \u0026lt;not Stringer\u0026gt;).WithCancel.WithDeadline(2021-05-23 15:49:31.513587636 +0800 CST m=+2.000147913 [1.999897372s]) context.Background.WithValue(type string, val \u0026lt;not Stringer\u0026gt;).WithCancel.WithDeadline(2021-05-23 15:49:31.513587636 +0800 CST m=+2.000147913 [1.999881255s]).WithCancel 5.2 context.Value() ç”¨äºä»WithValue contextä¸­æ ¹æ®keyå–å€¼\nfunc main() { ctx := context.WithValue(context.Background(), \u0026#34;one\u0026#34;, 1) fmt.Println(ctx.Value(\u0026#34;one\u0026#34;)) } å€¼å–å‡ºåcontextä¸ä¼šåˆ é™¤å®ƒï¼Œå¯é‡å¤å–å€¼ï¼Œå¯¹ä¸€ä¸ªä¸å­˜åœ¨çš„keyå–å€¼ä¼šè¿”å›nilã€‚\nReference Package context\nGo Concurrency Patterns: Context\nGolang Contextæ·±å…¥ç†è§£\nGolang Context åŸç†ä¸å®æˆ˜\nGo è¯­è¨€è®¾è®¡ä¸å®ç°\n","permalink":"http://yangchnet.github.io/Dessert/posts/golang/golang%E4%B8%ADcontext%E5%8C%85%E7%9A%84%E4%BD%BF%E7%94%A8/","summary":"contextåŒ…å®šä¹‰äº†Contextç±»å‹ï¼Œè¿™ä¸ªç±»å‹åœ¨APIè¾¹ç•Œå³è¿›ç¨‹ä¸­ä¼ é€’æˆªæ­¢æ—¥æœŸã€åŒæ­¥ä¿¡å·ï¼Œè¯·æ±‚å€¼ç­‰ç›¸å…³ä¿¡æ¯ã€‚\n 1. å¯¹contextåŒ…çš„ä»‹ç» åœ¨æœåŠ¡å™¨çš„ä¼ å…¥è¯·æ±‚ä¸­åº”åŒ…å«contextï¼Œè€Œå¯¹æœåŠ¡å™¨çš„ä¼ å‡ºè°ƒç”¨åº”æ¥æ”¶ä¸€ä¸ªcontextã€‚å®ƒä»¬ä¹‹é—´çš„è°ƒç”¨é“¾å¿…é¡»åŒ…å«contextï¼Œæˆ–æ˜¯è¡ç”Ÿçš„WithCancel, WithDeadline, WithTimeout, WithValueã€‚å½“ä¸€ä¸ªWithCancel Contextè¢«â€œcancelâ€ï¼Œé‚£ä¹ˆå½“å‰contextæ‰€æ´¾ç”Ÿçš„æ‰€æœ‰contextä¹Ÿéƒ½å°†è¢«å–æ¶ˆã€‚\nWithCancel, WithDeadline, WithTimeoutæ¥æ”¶ä¸€ä¸ªContextå¯¹è±¡ï¼ˆçˆ¶å¯¹è±¡ï¼‰ï¼Œå¹¶è¿”å›å…¶çˆ¶å¯¹è±¡çš„ä¸€ä¸ªæºå¸¦æœ‰cancel/deadline/timeoutçš„ä¸€ä¸ªæ‹·è´ï¼ˆå­å¯¹è±¡ï¼‰ã€‚è°ƒç”¨CancelFuncä¼šå–æ¶ˆå…¶å­å¯¹è±¡åŠå­å¯¹è±¡çš„å­å¯¹è±¡ç­‰ï¼Œåˆ é™¤çˆ¶å¯¹è±¡å¯¹å­å¯¹è±¡çš„å¼•ç”¨ï¼Œå¹¶åœæ­¢æ‰€æœ‰å…³è”çš„è®¡æ—¶å™¨ã€‚æœªèƒ½è°ƒç”¨CancelFuncå°†é€ æˆçˆ¶å¯¹è±¡ç»“æŸå‰æˆ–è®¡æ—¶å™¨è¢«è§¦å‘å‰å­å¯¹è±¡çš„æ³„éœ²ã€‚ä½¿ç”¨go vetå·¥å…·å¯ä»¥æ£€æŸ¥æ‰€æœ‰æ§åˆ¶æµè·¯å¾„ä¸Šæ˜¯å¦éƒ½ä½¿ç”¨äº†CancelFunc\nä½¿ç”¨contextçš„ç¨‹åºåº”éµå¾ªä»¥ä¸‹è§„åˆ™ï¼Œä»¥ä½¿å„ä¸ªåŒ…ä¹‹é—´çš„æ¥å£ä¿æŒä¸€è‡´ï¼Œå¹¶å¯ç”¨é™æ€åˆ†æå·¥å…·æ¥æ£€æŸ¥ä¸Šä¸‹æ–‡ä¼ æ’­ï¼š\n ä¸è¦å°†contextå­˜å‚¨åœ¨ç»“æ„ç±»å‹ä¸­ï¼Œè€Œæ˜¯å°†contextæ˜ç¡®ä¼ é€’ç»™éœ€è¦å®ƒçš„æ¯ä¸ªå‡½æ•°ã€‚Contextåº”è¯¥æ˜¯ç¬¬ä¸€ä¸ªå‡½æ•°ï¼Œé€šå¸¸å‘½åä¸ºctxã€‚  func DoSomething(ctx context.Context, arg Arg) error { // ...use ctx... } ä¸è¦ä¼ é€’ä¸€ä¸ªå€¼ä¸ºnilçš„contextï¼Œå³ä½¿ä¸€ä¸ªå‡½æ•°å…è®¸è¿™æ ·åšã€‚å¦‚æœä½ ä¸ç¡®å®šContextçš„ä½œç”¨é‚£å°±è¯·ä¼ é€’context.TODOã€‚ åªåœ¨è¿›ç¨‹å’ŒAPIé—´ä¼ é€’è¯·æ±‚èŒƒå›´æ•°æ®æ—¶ä½¿ç”¨contextå€¼ï¼Œä¸è¦ç”¨äºå°†å¯é€‰å‚æ•°ä¼ é€’ç»™å‡½æ•°ã€‚ åŒæ ·çš„Contextå¯ä»¥ä¼ é€’ç»™è¿è¡Œåœ¨ä¸åŒgoroutineä¸­çš„å‡½æ•°ï¼ŒContextæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚  2. Contextæ¥å£ type Context interface { Done() \u0026lt;-chan struct{} Err() error Deadline() (deadline time.Time, ok bool) Value(key interface{}) interface{} } Contextæ˜¯ä¸€ä¸ªæ¥å£ï¼Œå…¶å®šä¹‰éå¸¸çš„ç®€å•ï¼ŒåªåŒ…å«4ä¸ªæ–¹æ³•ï¼š\n  Done() \u0026lt;-chan struct{} Done()æ–¹æ³•å°†ä¸€ä¸ªchannelä½œä¸ºå–æ¶ˆä¿¡å·è¿”å›ç»™æŒæœ‰contextçš„å‡½æ•°ï¼Œå½“è¯¥channelè¢«å…³é—­ï¼ˆå³Done()è¢«è°ƒç”¨ï¼‰ï¼Œè¿™äº›å‡½æ•°åº”è¯¥ç«‹å³åœæ­¢å…¶å·¥ä½œå¹¶è¿”å›ã€‚\n  Err() error Err()è¿”å›ä¸€ä¸ªErrorï¼Œè¯´æ˜ä¸ºä»€ä¹ˆå–æ¶ˆcontextã€‚å¦‚æœDone()æ²¡æœ‰è¢«è°ƒç”¨ï¼Œé‚£ä¹ˆErrè¿”å›nilã€‚\n  Deadline() (deadline time.Time, ok bool) Deadline()æ–¹æ³•è¿”å›æŒæœ‰è¿™ä¸ªcontextçš„å‡½æ•°çš„é¢„æœŸç»“æŸæ—¶é—´ã€‚å¦‚æœå¹¶æ²¡æœ‰è®¾ç½®deadlineï¼Œé‚£ä¹ˆè¿”å›çš„okå°†è¢«è®¾ç½®ä¸ºfalseã€‚","title":"golangä¸­contextåŒ…çš„ä½¿ç”¨"},{"content":" åœ¨è®¡ç®—æœºé¢†åŸŸï¼Œåå°„æ˜¯æŒ‡ä¸€ç±»åº”ç”¨ï¼Œå®ƒä»¬èƒ½å¤Ÿè‡ªæè¿°å’Œè‡ªæ§åˆ¶ã€‚ä¹Ÿå³æ˜¯è¯´ï¼Œè¿™ç±»åº”ç”¨é€šè¿‡é‡‡ç”¨æŸç§æœºåˆ¶æ¥å®ç°å¯¹è‡ªå·±è¡Œä¸ºçš„æè¿°å’Œç›‘æµ‹ï¼Œå¹¶èƒ½æ ¹æ®è‡ªèº«è¡Œä¸ºçš„çŠ¶æ€å’Œç»“æœï¼Œè°ƒæ•´æˆ–ä¿®æ”¹åº”ç”¨æ‰€æè¿°è¡Œä¸ºçš„çŠ¶æ€å’Œç›¸å…³çš„è¯­ä¹‰ã€‚ åå°„ï¼ˆreflectï¼‰è®©æˆ‘ä»¬èƒ½åœ¨è¿è¡ŒæœŸæ¢çŸ¥å¯¹è±¡çš„ç±»å‹ä¿¡æ¯å’Œå†…å­˜ç»“æ„ï¼Œè¿™ä»ä¸€å®šç¨‹åº¦ä¸Šå¼¥(mi)è¡¥äº†é™æ€è¯­è¨€åœ¨åŠ¨æ€è¡Œä¸ºä¸Šçš„ä¸è¶³ã€‚ åå°„ï¼ˆreflectï¼‰æ˜¯åœ¨è®¡ç®—æœºç¨‹åºè¿è¡Œæ—¶ï¼Œè®¿é—®ï¼Œæ£€æŸ¥ï¼Œä¿®æ”¹å®ƒè‡ªèº«çš„ä¸€ç§èƒ½åŠ›ï¼Œæ˜¯å…ƒç¼–ç¨‹çš„ä¸€ç§å½¢å¼ã€‚ Goè¯­éŸ³æä¾›äº†ä¸€ç§æœºåˆ¶åœ¨è¿è¡Œæ—¶æ›´æ–°å˜é‡å’Œæ£€æŸ¥å®ƒä»¬çš„å€¼ã€è°ƒç”¨å®ƒä»¬çš„æ–¹æ³•å’Œå®ƒä»¬æ”¯æŒçš„å†…åœ¨æ“ä½œï¼Œä½†æ˜¯åœ¨ç¼–è¯‘æ—¶å¹¶ä¸çŸ¥é“è¿™äº›å˜é‡çš„å…·ä½“ç±»å‹ã€‚è¿™ç§æœºåˆ¶è¢«ç§°ä¸ºåå°„ã€‚åå°„ä¹Ÿå¯ä»¥è®©æˆ‘ä»¬å°†ç±»å‹æœ¬èº«ä½œä¸ºç¬¬ä¸€ç±»çš„å€¼ç±»å‹å¤„ç†ã€‚\n 1. ä¸ºä½•æˆ‘ä»¬éœ€è¦åå°„ï¼Ÿ fmt.Fprintfå‡½æ•°æä¾›å­—ç¬¦ä¸²æ ¼å¼åŒ–å¤„ç†é€»è¾‘ï¼Œå®ƒå¯ä»¥å¯¹ä»»æ„ç±»å‹çš„å€¼æ ¼å¼åŒ–å¹¶æ‰“å°ï¼Œç”šè‡³æ”¯æŒç”¨æˆ·è‡ªå®šä¹‰çš„ç±»å‹ã€‚ è®©æˆ‘ä»¬ä¹Ÿæ¥å°è¯•å®ç°ä¸€ä¸ªç±»ä¼¼åŠŸèƒ½çš„å‡½æ•°ã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬çš„å‡½æ•°åªæ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼Œç„¶åè¿”å›å’Œfmt.Sprintç±»ä¼¼çš„æ ¼å¼åŒ–åçš„å­—ç¬¦ä¸²ã€‚æˆ‘ä»¬å®ç°çš„å‡½æ•°åä¹Ÿå«Sprintã€‚ è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨switchç±»å‹åˆ†æ”¯æ¥å¯¹ä¸åŒçš„ç±»å‹è¿›è¡Œå¤„ç†ã€‚\nfunc Sprint(x interface{}) string { type stringer interface { String() string } switch x := x.(type) { case stringer: return x.String() case string: return x case int: return strconv.Itoa(x) // ...similar cases for int16, uint32, and so on...  case bool: if x { return \u0026#34;true\u0026#34; } return \u0026#34;false\u0026#34; default: // array, chan, func, map, pointer, slice, struct  return \u0026#34;???\u0026#34; } } ä½†æ˜¯æˆ‘ä»¬å¦‚ä½•å¤„ç†å…¶å®ƒç±»ä¼¼[]float64ã€map[string][]stringç­‰ç±»å‹å‘¢ï¼Ÿæˆ‘ä»¬å½“ç„¶å¯ä»¥æ·»åŠ æ›´å¤šçš„æµ‹è¯•åˆ†æ”¯ï¼Œä½†æ˜¯è¿™äº›ç»„åˆç±»å‹çš„æ•°ç›®åŸºæœ¬æ˜¯æ— ç©·çš„ã€‚è¿˜æœ‰å¦‚ä½•å¤„ç†url.Valuesç­‰å‘½åçš„ç±»å‹å‘¢ï¼Ÿè™½ç„¶ç±»å‹åˆ†æ”¯å¯ä»¥è¯†åˆ«å‡ºåº•å±‚çš„åŸºç¡€ç±»å‹æ˜¯map[string][]stringï¼Œä½†æ˜¯å®ƒå¹¶ä¸åŒ¹é…url.Valuesç±»å‹ï¼Œå› ä¸ºå®ƒä»¬æ˜¯ä¸¤ç§ä¸åŒçš„ç±»å‹ï¼Œè€Œä¸”switchç±»å‹åˆ†æ”¯ä¹Ÿä¸å¯èƒ½åŒ…å«æ¯ä¸ªç±»ä¼¼url.Valuesçš„ç±»å‹ï¼Œè¿™ä¼šå¯¼è‡´å¯¹è¿™äº›åº“çš„å¾ªç¯ä¾èµ–ã€‚ æ²¡æœ‰ä¸€ç§æ–¹æ³•æ¥æ£€æŸ¥æœªçŸ¥ç±»å‹çš„è¡¨ç¤ºæ–¹å¼ï¼Œæˆ‘ä»¬è¢«å¡ä½äº†ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬ä¸ºä½•éœ€è¦åå°„çš„åŸå› ã€‚\n2. reflect.Typeå’Œreflect.Values 2.1 interface{}å’Œåå°„ æ¥å£å€¼ æ¦‚å¿µä¸Šè®²ä¸€ä¸ªæ¥å£çš„å€¼ï¼Œç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œä¸€ä¸ªå…·ä½“çš„ç±»å‹å’Œé‚£ä¸ªç±»å‹çš„å€¼, å®ƒä»¬è¢«ç§°ä¸ºæ¥å£çš„åŠ¨æ€ç±»å‹å’ŒåŠ¨æ€å€¼ã€‚åœ¨Goçš„æ¦‚å¿µæ¨¡å‹ä¸­ï¼Œä¸€äº›æä¾›æ¯ä¸ªç±»å‹ä¿¡æ¯çš„å€¼è¢«ç§°ä¸ºç±»å‹æè¿°ç¬¦ï¼Œæ¯”å¦‚ç±»å‹çš„åç§°å’Œæ–¹æ³•ã€‚åœ¨ä¸€ä¸ªæ¥å£å€¼ä¸­ï¼Œç±»å‹éƒ¨åˆ†ä»£è¡¨ä¸ä¹‹ç›¸å…³ç±»å‹çš„æè¿°ç¬¦ã€‚ ä¸‹é¢4ä¸ªè¯­å¥ä¸­ï¼Œå˜é‡wå¾—åˆ°äº†3ä¸ªä¸åŒçš„å€¼ï¼ˆç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªæ˜¯ç›¸åŒçš„ï¼‰\nvar w io.Writer w = os.Stdout w = new(bytes.Buffer) w = nil è¿›ä¸€æ­¥è§‚å¯Ÿåœ¨æ¯ä¸€ä¸ªè¯­å¥åçš„wå˜é‡çš„å€¼å’ŒåŠ¨æ€è¡Œä¸ºã€‚\n ç¬¬ä¸€ä¸ªè¯­å¥å®šä¹‰äº†å˜é‡w:  var w io.Writer åœ¨Goè¯­è¨€ä¸­ï¼Œå˜é‡æ€»æ˜¯è¢«ä¸€ä¸ªå®šä¹‰æ˜ç¡®çš„å€¼åˆå§‹åŒ–ï¼Œå³ä½¿æ¥å£ç±»å‹ä¹Ÿä¸ä¾‹å¤–ã€‚å¯¹äºä¸€ä¸ªæ¥å£çš„é›¶å€¼å°±æ˜¯å®ƒçš„ç±»å‹å’Œå€¼çš„éƒ¨åˆ†éƒ½æ˜¯nil.å¦‚ä¸‹å›¾ï¼š ä¸€ä¸ªæ¥å£å€¼åŸºäºå®ƒçš„åŠ¨æ€ç±»å‹è¢«æè¿°ä¸ºç©ºæˆ–éç©ºï¼Œæ‰€ä»¥è¿™æ˜¯ä¸€ä¸ªç©ºçš„æ¥å£å€¼ã€‚\nç¬¬äºŒä¸ªè¯­å¥å°†ä¸€ä¸ª*os.Fileç±»å‹çš„å€¼èµ‹ç»™å˜é‡w  w = os.Stdout è¿™ä¸ªèµ‹å€¼è¿‡ç¨‹è°ƒç”¨äº†ä¸€ä¸ªå…·ä½“ç±»å‹åˆ°æ¥å£ç±»å‹çš„éšå¼è½¬æ¢ï¼Œè¿™å’Œæ˜¾å¼çš„ä½¿ç”¨io.Writer(os.Stdout)æ˜¯ç­‰ä»·çš„.è¿™ä¸ªæ¥å£å€¼çš„åŠ¨æ€ç±»å‹è¢«è®¾ä¸º*os.StdoutæŒ‡é’ˆçš„ç±»å‹æè¿°ç¬¦ï¼Œå®ƒçš„åŠ¨æ€å€¼æŒæœ‰os.Stdoutçš„æ‹·è´ï¼›è¿™æ˜¯ä¸€ä¸ªä»£è¡¨å¤„ç†æ ‡å‡†è¾“å‡ºçš„os.Fileç±»å‹å˜é‡çš„æŒ‡é’ˆ è°ƒç”¨ä¸€ä¸ªåŒ…å«*os.Fileç±»å‹æŒ‡é’ˆçš„æ¥å£å€¼çš„Writeæ–¹æ³•ï¼Œä½¿å¾—(*os.File).Writeæ–¹æ³•è¢«è°ƒç”¨ã€‚è¿™ä¸ªè°ƒç”¨è¾“å‡ºâ€œhelloâ€ã€‚\nw.Write([]byte(\u0026#34;hello\u0026#34;)) é€šå¸¸åœ¨ç¼–è¯‘æœŸï¼Œæˆ‘ä»¬ä¸çŸ¥é“æ¥å£å€¼çš„åŠ¨æ€ç±»å‹æ˜¯ä»€ä¹ˆï¼Œæ‰€ä»¥ä¸€ä¸ªæ¥å£ä¸Šçš„è°ƒç”¨å¿…é¡»ä½¿ç”¨åŠ¨æ€åˆ†é…(å³è¿è¡Œæ—¶åˆ†é…)ã€‚å› ä¸ºä¸æ˜¯ç›´æ¥è¿›è¡Œè°ƒç”¨ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨å¿…é¡»æŠŠä»£ç ç”Ÿæˆåœ¨ç±»å‹æè¿°ç¬¦çš„æ–¹æ³•Writeä¸Šï¼Œç„¶åé—´æ¥è°ƒç”¨é‚£ä¸ªåœ°å€ã€‚è¿™ä¸ªè°ƒç”¨çš„æ¥æ”¶è€…æ˜¯ä¸€ä¸ªæ¥å£åŠ¨æ€å€¼çš„æ‹·è´ï¼šos.Stdout(å‚ç…§ä¸Šå›¾)ã€‚æ•ˆæœå’Œä¸‹é¢è¿™ä¸ªç›´æ¥è°ƒç”¨ä¸€æ ·ï¼š\nos.Stdout.Write([]byte(\u0026#34;hello\u0026#34;)) // \u0026#34;hello\u0026#34; ç¬¬ä¸‰ä¸ªè¯­å¥ç»™æ¥å£å€¼èµ‹äº†ä¸€ä¸ª*bytes.Bufferç±»å‹çš„å€¼  w = new(bytes.Buffer) ç°åœ¨åŠ¨æ€ç±»å‹æ˜¯*bytes.Bufferå¹¶ä¸”åŠ¨æ€å€¼æ˜¯ä¸€ä¸ªæŒ‡å‘æ–°åˆ†é…çš„ç¼“å†²åŒºçš„æŒ‡é’ˆã€‚ Writeæ–¹æ³•çš„è°ƒç”¨ä¹Ÿä½¿ç”¨äº†å’Œä¹‹å‰ä¸€æ ·çš„æœºåˆ¶ã€‚\nw.Write([]byte(\u0026#34;hello\u0026#34;)) // write \u0026#34;hello\u0026#34; to the bytes.Buffers è¿™æ¬¡ç±»å‹æè¿°ç¬¦æ˜¯*bytes.Bufferï¼Œæ‰€ä»¥è°ƒç”¨äº†(*bytes.Buffer).Writeæ–¹æ³•ï¼Œå¹¶ä¸”æ¥æ”¶è€…æ˜¯è¯¥ç¼“å†²åŒºçš„åœ°å€ã€‚è¿™ä¸ªè°ƒç”¨æŠŠå­—ç¬¦ä¸²â€œhelloâ€æ·»åŠ åˆ°ç¼“å†²åŒºä¸­ã€‚\næœ€åï¼Œç¬¬å››ä¸ªè¯­å¥å°†nilèµ‹ç»™äº†æ¥å£å€¼  w = nil è¿™ä¸ªé‡ç½®å°†å®ƒæ‰€æœ‰çš„éƒ¨åˆ†éƒ½è®¾ä¸ºnilå€¼ï¼ŒæŠŠå˜é‡wæ¢å¤åˆ°å’Œå®ƒä¹‹å‰å®šä¹‰æ—¶ç›¸åŒçš„çŠ¶æ€å›¾ã€‚ interfaceåŠå…¶åŠ¨æ€ç±»å‹ï¼ŒåŠ¨æ€å€¼çš„å­˜åœ¨ï¼Œæ˜¯Golangä¸­å®ç°åå°„çš„å‰æï¼Œç†è§£äº†æ¥å£çš„åŠ¨æ€ç±»å‹çš„åŠ¨æ€å€¼ï¼Œå°±æ›´å®¹æ˜“ç†è§£åå°„ã€‚åå°„å°±æ˜¯ç”¨æ¥æ£€æµ‹å­˜å‚¨åœ¨æ¥å£å˜é‡å†…éƒ¨åŠ¨æ€ç±»å‹ï¼ŒåŠ¨æ€å€¼çš„ä¸€ç§æœºåˆ¶ã€‚\n2.2 ç±»å‹ï¼ˆTypeï¼‰ ä¸€ä¸ªTypeè¡¨ç¤ºä¸€ä¸ªGoç±»å‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ¥å£:reflect.Type()ã€‚ å‡½æ•°reflect.TypeOfæ¥å—ä»»æ„çš„interface{}ç±»å‹ï¼Œå¹¶è¿”å›å¯¹åº”åŠ¨æ€ç±»å‹çš„reflect.Type:\nt := reflect.TypeOf(3) // a reflect.Type fmt.Println(t.String()) // int fmt.Println(t) // int TypeOf(3)è°ƒç”¨å°†3ä½œä¸ºinterface{}ç±»å‹å‚æ•°ä¼ å…¥ã€‚æŒ‰[2.1èŠ‚](### 2.1 interface{}å’Œåå°„)æ‰€è¿°ï¼Œå°†ä¸€ä¸ªå…·ä½“çš„å€¼è½¬ä¸ºæ¥å£ç±»å‹ä¼šæœ‰ä¸€ä¸ªéšå¼çš„æ¥å£è½¬æ¢æ“ä½œï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªåŒ…å«ä¸¤ä¸ªä¿¡æ¯çš„æ¥å£å€¼ï¼šæ“ä½œæ•°çš„åŠ¨æ€ç±»å‹ï¼ˆè¿™é‡Œæ˜¯intï¼‰å’Œå®ƒçš„åŠ¨æ€çš„å€¼ï¼ˆè¿™é‡Œæ˜¯3ï¼‰ã€‚\nå› ä¸ºreflect.TypeOfè¿”å›çš„æ˜¯ä¸€ä¸ªæ¥å£çš„åŠ¨æ€ç±»å‹å€¼ï¼Œå®ƒæ€»æ˜¯è¿”å›å…·ä½“çš„ç±»å‹ï¼Œå› æ­¤ä¸‹é¢çš„ä»£ç å°†æ‰“å°â€œ*os.Fileâ€è€Œä¸æ˜¯â€œio.Writerâ€.\nvar w io.Writer = os.Stdout fmt.Println(reflect.TypeOf(w)) // \u0026#34;*os.File\u0026#34; reflect.Typeæ¥å£æ˜¯æ»¡è¶³fmt.Stringeræ¥å£çš„ã€‚å› ä¸ºæ‰“å°åŠ¨æ€ç±»å‹å€¼å¯¹äºè°ƒè¯•å’Œæ—¥å¿—æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ï¼Œfmt.Printfæä¾›äº†ä¸€ä¸ªç®€çŸ­çš„%Tæ ‡å¿—å‚æ•°ï¼Œå†…éƒ¨ä½¿ç”¨reflect.TypeOfçš„ç»“æœè¾“å‡ºã€‚\nfmt.Printf(\u0026#34;%T\\n\u0026#34;, 3) // \u0026#34;int\u0026#34; 2.3 å€¼ï¼ˆValueï¼‰ ä¸€ä¸ªreflect.Valueå¯ä»¥æŒæœ‰ä¸€ä¸ªä»»æ„ç±»å‹çš„å€¼ï¼Œå‡½æ•°reflect.ValueOfæ¥å—ä»»æ„çš„interface{}ç±»å‹ï¼Œå¹¶è¿”å›å¯¹åº”åŠ¨æ€ç±»å‹çš„reflectã€‚Valueã€‚ ä¸reflect.TypeOfç±»ä¼¼ï¼Œreflect.ValueOfè¿”å›çš„ç»“æœä¹Ÿæ˜¯å¯¹äºå…·ä½“çš„ç±»å‹ï¼Œä½†æ˜¯reflect.Valueä¹Ÿå¯ä»¥æŒæœ‰ä¸€ä¸ªæ¥å£å€¼ã€‚\nv := reflect.ValueOf(3) // a reflect.Value fmt.Println(v) // \u0026#34;3\u0026#34; fmt.Printf(\u0026#34;%v\\n\u0026#34;, v) // \u0026#34;3\u0026#34; fmt.Println(v.String()) // NOTE: \u0026#34;\u0026lt;int Value\u0026gt; å’Œreflect.Type ç±»ä¼¼, reflect.Value ä¹Ÿæ»¡è¶³ fmt.Stringer æ¥å£, ä½†æ˜¯é™¤é Value æŒæœ‰çš„æ˜¯å­—ç¬¦ä¸²,å¦åˆ™ String åªæ˜¯è¿”å›å…·ä½“çš„ç±»å‹. ç›¸åŒ, ä½¿ç”¨ fmt åŒ…çš„ %v æ ‡å¿—å‚æ•°, å°†ä½¿ç”¨ reflect.Values çš„ç»“æœæ ¼å¼åŒ–.\nè°ƒç”¨Valueçš„Typeæ–¹æ³•å°†è¿”å›å…·ä½“ç±»å‹æ‰€å¯¹åº”çš„reflect.Type\nt := v.Type() fmt.Println(t.String()) // int é€†æ“ä½œæ˜¯è°ƒç”¨ reflect.ValueOf å¯¹åº”çš„ reflect.Value.Interface æ–¹æ³•. å®ƒè¿”å›ä¸€ä¸ª interface{} ç±»å‹ è¡¨ç¤º reflect.Value å¯¹åº”ç±»å‹çš„å…·ä½“å€¼:\nv := reflect.ValueOf(3) // a reflect.Value x := v.Interface() // an interface{} i := x.(int) // an int fmt.Printf(\u0026#34;%d\\n\u0026#34;, i) // \u0026#34;3\u0026#34; ä¸€ä¸ª reflect.Value å’Œ interface{} éƒ½èƒ½ä¿å­˜ä»»æ„çš„å€¼. æ‰€ä¸åŒçš„æ˜¯, ä¸€ä¸ªç©ºçš„æ¥å£éšè—äº†å€¼å¯¹åº”çš„è¡¨ç¤ºæ–¹å¼å’Œæ‰€æœ‰çš„å…¬å¼€çš„æ–¹æ³•, å› æ­¤åªæœ‰æˆ‘ä»¬çŸ¥é“å…·ä½“çš„åŠ¨æ€ç±»å‹æ‰èƒ½ä½¿ç”¨ç±»å‹æ–­è¨€æ¥è®¿é—®å†…éƒ¨çš„å€¼(å°±åƒä¸Šé¢é‚£æ ·), å¯¹äºå†…éƒ¨å€¼å¹¶æ²¡æœ‰ç‰¹åˆ«å¯åšçš„äº‹æƒ…. ç›¸æ¯”ä¹‹ä¸‹, ä¸€ä¸ª Value åˆ™æœ‰å¾ˆå¤šæ–¹æ³•æ¥æ£€æŸ¥å…¶å†…å®¹, æ— è®ºå®ƒçš„å…·ä½“ç±»å‹æ˜¯ä»€ä¹ˆ.\n2.4 å†æ¬¡å°è¯•format.Any æˆ‘ä»¬ä½¿ç”¨ reflect.Value çš„ Kind æ–¹æ³•æ¥æ›¿ä»£ä¹‹å‰çš„ç±»å‹switch. è™½ç„¶è¿˜æ˜¯æœ‰æ— ç©·å¤šçš„ç±»å‹, ä½†æ˜¯å®ƒä»¬çš„kindsç±»å‹å´æ˜¯æœ‰é™çš„: Bool, String å’Œ æ‰€æœ‰æ•°å­—ç±»å‹çš„åŸºç¡€ç±»å‹; Array å’Œ Struct å¯¹åº”çš„èšåˆç±»å‹; Chan, Func, Ptr, Slice, å’Œ Map å¯¹åº”çš„å¼•ç”¨ç±»ä¼¼; æ¥å£ç±»å‹; è¿˜æœ‰è¡¨ç¤ºç©ºå€¼çš„æ— æ•ˆç±»å‹. (ç©ºçš„ reflect.Value å¯¹åº” Invalid æ— æ•ˆç±»å‹. reflect.Value.Kind()è¿”å›reflect.Valueçš„åŸºç±»å‹ã€‚å³å¯¹åº”ç±»å‹çš„åº•å±‚è¡¨ç¤ºã€‚\nvar f func(string)int v := reflect.TypeOf(f) fmt.Println(v, v.Kind()) // \u0026#34;func(string)int\u0026#34; \u0026#34;int\u0026#34; v.Kind() == reflect.Func // true package format import ( \u0026#34;reflect\u0026#34; \u0026#34;strconv\u0026#34; ) // Any formats any value as a string. func Any(value interface{}) string { return formatAtom(reflect.ValueOf(value)) } // formatAtom formats a value without inspecting its internal structure. func formatAtom(v reflect.Value) string { switch v.Kind() { case reflect.Invalid: return \u0026#34;invalid\u0026#34; case reflect.Int, reflect.Int8, reflect.Int16, reflect.Int32, reflect.Int64: return strconv.FormatInt(v.Int(), 10) case reflect.Uint, reflect.Uint8, reflect.Uint16, reflect.Uint32, reflect.Uint64, reflect.Uintptr: return strconv.FormatUint(v.Uint(), 10) // ...floating-point and complex cases omitted for brevity... \tcase reflect.Bool: return strconv.FormatBool(v.Bool()) case reflect.String: return strconv.Quote(v.String()) case reflect.Chan, reflect.Func, reflect.Ptr, reflect.Slice, reflect.Map: return v.Type().String() + \u0026#34; 0x\u0026#34; + strconv.FormatUint(uint64(v.Pointer()), 16) default: // reflect.Array, reflect.Struct, reflect.Interface \treturn v.Type().String() + \u0026#34; value\u0026#34; } } 3. ä¸‰å¤§æ³•åˆ™ 3.1 ä»interface{}å˜é‡å¯ä»¥åå°„å‡ºåå°„å¯¹è±¡ å½“æˆ‘ä»¬æ‰§è¡Œ reflect.ValueOf(1) æ—¶ï¼Œè™½ç„¶çœ‹èµ·æ¥æ˜¯è·å–äº†åŸºæœ¬ç±»å‹ int å¯¹åº”çš„åå°„ç±»å‹ï¼Œä½†æ˜¯ç”±äº reflect.TypeOfã€reflect.ValueOf ä¸¤ä¸ªæ–¹æ³•çš„å…¥å‚éƒ½æ˜¯ interface{} ç±»å‹ï¼Œæ‰€ä»¥åœ¨æ–¹æ³•æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†ç±»å‹è½¬æ¢ã€‚\nå› ä¸ºGo è¯­è¨€çš„å‡½æ•°è°ƒç”¨éƒ½æ˜¯å€¼ä¼ é€’çš„ï¼Œæ‰€ä»¥å˜é‡ä¼šåœ¨å‡½æ•°è°ƒç”¨æ—¶è¿›è¡Œç±»å‹è½¬æ¢ã€‚åŸºæœ¬ç±»å‹ int ä¼šè½¬æ¢æˆ interface{} ç±»å‹ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆç¬¬ä¸€æ¡æ³•åˆ™æ˜¯ä»æ¥å£åˆ°åå°„å¯¹è±¡ã€‚\nä¸Šé¢æåˆ°çš„ reflect.TypeOf å’Œ reflect.ValueOf å‡½æ•°å°±èƒ½å®Œæˆè¿™é‡Œçš„è½¬æ¢ï¼Œå¦‚æœæˆ‘ä»¬è®¤ä¸º Go è¯­è¨€çš„ç±»å‹å’Œåå°„ç±»å‹å¤„äºä¸¤ä¸ªä¸åŒçš„ä¸–ç•Œï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªå‡½æ•°å°±æ˜¯è¿æ¥è¿™ä¸¤ä¸ªä¸–ç•Œçš„æ¡¥æ¢ã€‚ è¯·çœ‹ä»¥ä¸‹ä¾‹å­ï¼š\nauthor := \u0026#34;Bob\u0026#34; fmt.Println(\u0026#34;TypeOf author:\u0026#34;, reflect.TypeOf(author)) // TypeOf author: string  fmt.Println(\u0026#34;ValueOf author:\u0026#34;, reflect.ValueOf(author)) // ValueOf author: Bob æœ‰äº†å˜é‡çš„ç±»å‹ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ Method æ–¹æ³•è·å¾—ç±»å‹å®ç°çš„æ–¹æ³•ï¼Œé€šè¿‡ Field è·å–ç±»å‹åŒ…å«çš„å…¨éƒ¨å­—æ®µã€‚å¯¹äºä¸åŒçš„ç±»å‹ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è°ƒç”¨ä¸åŒçš„æ–¹æ³•è·å–ç›¸å…³ä¿¡æ¯ï¼š\n ç»“æ„ä½“ï¼šè·å–å­—æ®µçš„æ•°é‡å¹¶é€šè¿‡ä¸‹æ ‡å’Œå­—æ®µåè·å–å­—æ®µ StructFieldï¼› å“ˆå¸Œè¡¨ï¼šè·å–å“ˆå¸Œè¡¨çš„ Key ç±»å‹ï¼› å‡½æ•°æˆ–æ–¹æ³•ï¼šè·å–å…¥å‚å’Œè¿”å›å€¼çš„ç±»å‹ï¼› â€¦ æ€»è€Œè¨€ä¹‹ï¼Œä½¿ç”¨ reflect.TypeOfå’Œ reflect.ValueOf èƒ½å¤Ÿè·å– Go è¯­è¨€ä¸­çš„å˜é‡å¯¹åº”çš„åå°„å¯¹è±¡ã€‚ä¸€æ—¦è·å–äº†åå°„å¯¹è±¡ï¼Œæˆ‘ä»¬å°±èƒ½å¾—åˆ°è·Ÿå½“å‰ç±»å‹ç›¸å…³æ•°æ®å’Œæ“ä½œï¼Œå¹¶å¯ä»¥ä½¿ç”¨è¿™äº›è¿è¡Œæ—¶è·å–çš„ç»“æ„æ‰§è¡Œæ–¹æ³•ã€‚  3.2 ä»åå°„å¯¹è±¡å¯ä»¥è·å–interface{}å˜é‡ æ—¢ç„¶èƒ½å¤Ÿå°†æ¥å£ç±»å‹çš„å˜é‡è½¬æ¢æˆåå°„å¯¹è±¡ï¼Œé‚£ä¹ˆä¸€å®šéœ€è¦å…¶ä»–æ–¹æ³•å°†åå°„å¯¹è±¡è¿˜åŸæˆæ¥å£ç±»å‹çš„å˜é‡ï¼ŒreflectåŒ…ä¸­çš„reflect.Value.Interfaceå°±èƒ½å®Œæˆè¿™é¡¹å·¥ä½œï¼š\nv := reflect.ValueOf(3) // a reflect.Value x := v.Interface() // an interface{} i := x.(int) // an int fmt.Printf(\u0026#34;%d\\n\u0026#34;, i) // \u0026#34;3\u0026#34; reflect.ValueOfã€reflect.TypeOfä¸Interfaceæ–¹æ³•å¯ä»¥è¯´æ˜¯ä¸€ä¸ªäº’é€†çš„è¿‡ç¨‹ã€‚reflect.ValueOfã€reflect.TypeOfå°†interface{}è½¬åŒ–ä¸ºreflectå¯¹è±¡ï¼Œè€ŒInterfaceå°†ä¸€ä¸ªreflectå¯¹è±¡é‡æ–°è½¬åŒ–ä¸ºä¸€ä¸ªæ¥å£å€¼ã€‚ 3.3 è¦ä¿®æ”¹åå°„å¯¹è±¡ï¼Œå…¶å€¼å¿…é¡»å¯è®¾ç½® å‡å¦‚æˆ‘ä»¬æƒ³è¦æ›´æ–°ä¸€ä¸ªreflect.Value,é‚£ä¹ˆå®ƒæŒæœ‰çš„å€¼ä¸€å®šæ˜¯å¯ä»¥è¢«æ›´æ–°çš„ï¼Œå‡è®¾æœ‰å¦‚ä¸‹ä»£ç ï¼š\ni := 1 v := reflect.ValueOf(i) v.SetInt(10) fmt.Println(i) // panic: reflect: reflect.flag.mustBeAssignable using unaddressable value è¿è¡Œä¸Šè¿°ä»£ç ä¼šå¯¼è‡´ç¨‹åºå´©æºƒå¹¶æŠ¥å‡º â€œreflect: reflect.flag.mustBe Assignableusing unaddressable valueâ€ é”™è¯¯ï¼Œä»”ç»†æ€è€ƒä¸€ä¸‹å°±èƒ½å¤Ÿå‘ç°å‡ºé”™çš„åŸå› ï¼šç”±äº Go è¯­è¨€çš„å‡½æ•°è°ƒç”¨éƒ½æ˜¯ä¼ å€¼çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—åˆ°çš„åå°„å¯¹è±¡è·Ÿæœ€å¼€å§‹çš„å˜é‡æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œé‚£ä¹ˆç›´æ¥ä¿®æ”¹åå°„å¯¹è±¡æ— æ³•æ”¹å˜åŸå§‹å˜é‡ï¼Œç¨‹åºä¸ºäº†é˜²æ­¢é”™è¯¯å°±ä¼šå´©æºƒã€‚\næƒ³è¦ä¿®æ”¹åŸå˜é‡åªèƒ½ä½¿ç”¨å¦‚ä¸‹æ–¹æ³•ï¼š\ni := 1 v := reflect.ValueOf(\u0026amp;i) v.Elem().SetInt(10) fmt.Println(i) reflect.Value.Elem()æ–¹æ³•è·å–æŒ‡é’ˆæŒ‡å‘çš„å˜é‡\n4. reflectåœºæ™¯å®è·µ  åŠ¨æ€è°ƒç”¨å‡½æ•°(æ— å‚æ•°)  type T struct {} func main() { name := \u0026#34;Do\u0026#34; t := \u0026amp;T{} reflect.ValueOf(t).MethodByName(name).Call(nil) } func (t *T) Do() { fmt.Println(\u0026#34;hello\u0026#34;) } åŠ¨æ€è°ƒç”¨å‡½æ•°(æœ‰å‚æ•°)  type T struct{} func main() { name := \u0026#34;Do\u0026#34; t := \u0026amp;T{} a := reflect.ValueOf(1111) b := reflect.ValueOf(\u0026#34;world\u0026#34;) in := []reflect.Value{a, b} reflect.ValueOf(t).MethodByName(name).Call(in) } func (t *T) Do(a int, b string) { fmt.Println(\u0026#34;hello\u0026#34; + b, a) } å¤„ç†è¿”å›å€¼ä¸­çš„é”™è¯¯  è¿”å›å€¼ä¹Ÿæ˜¯ Value ç±»å‹ï¼Œå¯¹äºé”™è¯¯ï¼Œå¯ä»¥è½¬ä¸º interface ä¹‹åæ–­è¨€\ntype T struct{} func main() { name := \u0026#34;Do\u0026#34; t := \u0026amp;T{} ret := reflect.ValueOf(t).MethodByName(name).Call(nil) fmt.Printf(\u0026#34;strValue: %[1]v\\nerrValue: %[2]v\\nstrType: %[1]T\\nerrType: %[2]T\u0026#34;, ret[0], ret[1].Interface().(error)) } func (t *T) Do() (string, error) { return \u0026#34;hello\u0026#34;, errors.New(\u0026#34;new error\u0026#34;) } struct tag è§£æ  type T struct { A int `json:\u0026#34;aaa\u0026#34; test:\u0026#34;testaaa\u0026#34;` B string `json:\u0026#34;bbb\u0026#34; test:\u0026#34;testbbb\u0026#34;` } func main() { t := T{ A: 123, B: \u0026#34;hello\u0026#34;, } tt := reflect.TypeOf(t) for i := 0; i \u0026lt; tt.NumField(); i++ { field := tt.Field(i) if json, ok := field.Tag.Lookup(\u0026#34;json\u0026#34;); ok { fmt.Println(json) } test := field.Tag.Get(\u0026#34;test\u0026#34;) fmt.Println(test) } } ç±»å‹è½¬æ¢å’Œèµ‹å€¼  type T struct { A int `newT:\u0026#34;AA\u0026#34;` B string `newT:\u0026#34;BB\u0026#34;` } type newT struct { AA int BB string } func main() { t := T{ A: 123, B: \u0026#34;hello\u0026#34;, } tt := reflect.TypeOf(t) tv := reflect.ValueOf(t) newT := \u0026amp;newT{} newTValue := reflect.ValueOf(newT) for i := 0; i \u0026lt; tt.NumField(); i++ { field := tt.Field(i) newTTag := field.Tag.Get(\u0026#34;newT\u0026#34;) tValue := tv.Field(i) newTValue.Elem().FieldByName(newTTag).Set(tValue) } fmt.Println(newT) } é€šè¿‡ kindï¼ˆï¼‰å¤„ç†ä¸åŒåˆ†æ”¯  func main() { a := 1 t := reflect.TypeOf(a) switch t.Kind() { case reflect.Int: fmt.Println(\u0026#34;int\u0026#34;) case reflect.String: fmt.Println(\u0026#34;string\u0026#34;) } } åˆ¤æ–­å®ä¾‹æ˜¯å¦å®ç°äº†æŸæ¥å£  type IT interface { test1() } type T struct { A string } func (t *T) test1() {} func main() { t := \u0026amp;T{} ITF := reflect.TypeOf((*IT)(nil)).Elem() tv := reflect.TypeOf(t) fmt.Println(tv.Implements(ITF)) } Reference ã€ŠThe Go Programmer Languageã€‹ Golangçš„åå°„reflectæ·±å…¥ç†è§£å’Œç¤ºä¾‹\nGo è¯­è¨€è®¾è®¡ä¸å®ç°\nã€ŠGoå­¦ä¹ ç¬”è®° . é›¨ç—•ã€‹åå°„\nGo Reflect é«˜çº§å®è·µ\nPackage reflect\n","permalink":"http://yangchnet.github.io/Dessert/posts/golang/golang%E4%B8%AD%E5%8F%8D%E5%B0%84reflect%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/","summary":"åœ¨è®¡ç®—æœºé¢†åŸŸï¼Œåå°„æ˜¯æŒ‡ä¸€ç±»åº”ç”¨ï¼Œå®ƒä»¬èƒ½å¤Ÿè‡ªæè¿°å’Œè‡ªæ§åˆ¶ã€‚ä¹Ÿå³æ˜¯è¯´ï¼Œè¿™ç±»åº”ç”¨é€šè¿‡é‡‡ç”¨æŸç§æœºåˆ¶æ¥å®ç°å¯¹è‡ªå·±è¡Œä¸ºçš„æè¿°å’Œç›‘æµ‹ï¼Œå¹¶èƒ½æ ¹æ®è‡ªèº«è¡Œä¸ºçš„çŠ¶æ€å’Œç»“æœï¼Œè°ƒæ•´æˆ–ä¿®æ”¹åº”ç”¨æ‰€æè¿°è¡Œä¸ºçš„çŠ¶æ€å’Œç›¸å…³çš„è¯­ä¹‰ã€‚ åå°„ï¼ˆreflectï¼‰è®©æˆ‘ä»¬èƒ½åœ¨è¿è¡ŒæœŸæ¢çŸ¥å¯¹è±¡çš„ç±»å‹ä¿¡æ¯å’Œå†…å­˜ç»“æ„ï¼Œè¿™ä»ä¸€å®šç¨‹åº¦ä¸Šå¼¥(mi)è¡¥äº†é™æ€è¯­è¨€åœ¨åŠ¨æ€è¡Œä¸ºä¸Šçš„ä¸è¶³ã€‚ åå°„ï¼ˆreflectï¼‰æ˜¯åœ¨è®¡ç®—æœºç¨‹åºè¿è¡Œæ—¶ï¼Œè®¿é—®ï¼Œæ£€æŸ¥ï¼Œä¿®æ”¹å®ƒè‡ªèº«çš„ä¸€ç§èƒ½åŠ›ï¼Œæ˜¯å…ƒç¼–ç¨‹çš„ä¸€ç§å½¢å¼ã€‚ Goè¯­éŸ³æä¾›äº†ä¸€ç§æœºåˆ¶åœ¨è¿è¡Œæ—¶æ›´æ–°å˜é‡å’Œæ£€æŸ¥å®ƒä»¬çš„å€¼ã€è°ƒç”¨å®ƒä»¬çš„æ–¹æ³•å’Œå®ƒä»¬æ”¯æŒçš„å†…åœ¨æ“ä½œï¼Œä½†æ˜¯åœ¨ç¼–è¯‘æ—¶å¹¶ä¸çŸ¥é“è¿™äº›å˜é‡çš„å…·ä½“ç±»å‹ã€‚è¿™ç§æœºåˆ¶è¢«ç§°ä¸ºåå°„ã€‚åå°„ä¹Ÿå¯ä»¥è®©æˆ‘ä»¬å°†ç±»å‹æœ¬èº«ä½œä¸ºç¬¬ä¸€ç±»çš„å€¼ç±»å‹å¤„ç†ã€‚\n 1. ä¸ºä½•æˆ‘ä»¬éœ€è¦åå°„ï¼Ÿ fmt.Fprintfå‡½æ•°æä¾›å­—ç¬¦ä¸²æ ¼å¼åŒ–å¤„ç†é€»è¾‘ï¼Œå®ƒå¯ä»¥å¯¹ä»»æ„ç±»å‹çš„å€¼æ ¼å¼åŒ–å¹¶æ‰“å°ï¼Œç”šè‡³æ”¯æŒç”¨æˆ·è‡ªå®šä¹‰çš„ç±»å‹ã€‚ è®©æˆ‘ä»¬ä¹Ÿæ¥å°è¯•å®ç°ä¸€ä¸ªç±»ä¼¼åŠŸèƒ½çš„å‡½æ•°ã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬çš„å‡½æ•°åªæ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼Œç„¶åè¿”å›å’Œfmt.Sprintç±»ä¼¼çš„æ ¼å¼åŒ–åçš„å­—ç¬¦ä¸²ã€‚æˆ‘ä»¬å®ç°çš„å‡½æ•°åä¹Ÿå«Sprintã€‚ è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨switchç±»å‹åˆ†æ”¯æ¥å¯¹ä¸åŒçš„ç±»å‹è¿›è¡Œå¤„ç†ã€‚\nfunc Sprint(x interface{}) string { type stringer interface { String() string } switch x := x.(type) { case stringer: return x.String() case string: return x case int: return strconv.Itoa(x) // ...similar cases for int16, uint32, and so on...  case bool: if x { return \u0026#34;true\u0026#34; } return \u0026#34;false\u0026#34; default: // array, chan, func, map, pointer, slice, struct  return \u0026#34;?","title":"Golangä¸­åå°„reflectçš„åŸºæœ¬ä½¿ç”¨"},{"content":"1. æŒ‰ç…§Oh my zsh $ sh -c \u0026#34;$(curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh)\u0026#34; 2. é…ç½®Oh my zsh   å°†zshè®¾ç½®ä¸ºé»˜è®¤Shell (è„šæœ¬çš„æœ€åä¸€èˆ¬ä¼šé—®ä½ æ˜¯å¦åˆ‡æ¢)\nchsh -s /bin/zsh # ä¸éœ€è¦ä½¿ç”¨rootæƒé™   æ›´æ¢ä¸»é¢˜\nvim ~/.zshrc æ‰¾åˆ°ZSH_THEME='robbyrussell', æ›´æ¢ä¸ºä½ æƒ³è¦ä½¿ç”¨çš„ä¸»é¢˜ï¼Œå¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°ä½ æƒ³è¦çš„ä¸»é¢˜\n  å®‰è£…æ’ä»¶\nvim ~/.zshrc æ‰¾åˆ°plugins=(), æ·»åŠ æ’ä»¶åç§°ï¼Œæˆ‘è¿™é‡Œæ·»åŠ çš„æ’ä»¶æœ‰ï¼š\nplugins=(git zsh-autosuggestions zsh-syntax-highlighting) git clone https://github.com/zsh-users/zsh-syntax-highlighting.git ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-syntax-highlighting git clone https://github.com/zsh-users/zsh-autosuggestions ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-autosuggestions   å®Œæˆ\nsource ~/.zshrc # å¯åŠ¨zsh   3. ä½¿ç”¨ä¸»é¢˜powerlevel10k ä¸‹è½½ä¸»é¢˜\ngit clone --depth=1 https://gitee.com/romkatv/powerlevel10k.git ${ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom}/themes/powerlevel10k æ‰“å¼€ä½ çš„~/.zshrc,å°†ä¸»é¢˜æ¢ä¸ºï¼špowerlevel10k/powerlevel10k\næ›´æ”¹ä¿å­˜å¹¶ä½¿ç”¨ä¸»é¢˜\nsource ~/.zshrc è¿™æ—¶powerlevel10kä¼šè‡ªåŠ¨å¯åŠ¨ï¼Œè¯¢é—®ä½ æƒ³è¦çš„é…ç½® æŒ‰ç…§æç¤ºé…ç½®ä½ æƒ³è¦çš„é£æ ¼å³å¯\n","permalink":"http://yangchnet.github.io/Dessert/posts/env/zsh%E7%9A%84%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE/","summary":"1. æŒ‰ç…§Oh my zsh $ sh -c \u0026#34;$(curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh)\u0026#34; 2. é…ç½®Oh my zsh   å°†zshè®¾ç½®ä¸ºé»˜è®¤Shell (è„šæœ¬çš„æœ€åä¸€èˆ¬ä¼šé—®ä½ æ˜¯å¦åˆ‡æ¢)\nchsh -s /bin/zsh # ä¸éœ€è¦ä½¿ç”¨rootæƒé™   æ›´æ¢ä¸»é¢˜\nvim ~/.zshrc æ‰¾åˆ°ZSH_THEME='robbyrussell', æ›´æ¢ä¸ºä½ æƒ³è¦ä½¿ç”¨çš„ä¸»é¢˜ï¼Œå¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°ä½ æƒ³è¦çš„ä¸»é¢˜\n  å®‰è£…æ’ä»¶\nvim ~/.zshrc æ‰¾åˆ°plugins=(), æ·»åŠ æ’ä»¶åç§°ï¼Œæˆ‘è¿™é‡Œæ·»åŠ çš„æ’ä»¶æœ‰ï¼š\nplugins=(git zsh-autosuggestions zsh-syntax-highlighting) git clone https://github.com/zsh-users/zsh-syntax-highlighting.git ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-syntax-highlighting git clone https://github.com/zsh-users/zsh-autosuggestions ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-autosuggestions   å®Œæˆ\nsource ~/.zshrc # å¯åŠ¨zsh   3. ä½¿ç”¨ä¸»é¢˜powerlevel10k ä¸‹è½½ä¸»é¢˜\ngit clone --depth=1 https://gitee.com/romkatv/powerlevel10k.git ${ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom}/themes/powerlevel10k æ‰“å¼€ä½ çš„~/.zshrc,å°†ä¸»é¢˜æ¢ä¸ºï¼špowerlevel10k/powerlevel10k\næ›´æ”¹ä¿å­˜å¹¶ä½¿ç”¨ä¸»é¢˜\nsource ~/.zshrc è¿™æ—¶powerlevel10kä¼šè‡ªåŠ¨å¯åŠ¨ï¼Œè¯¢é—®ä½ æƒ³è¦çš„é…ç½® æŒ‰ç…§æç¤ºé…ç½®ä½ æƒ³è¦çš„é£æ ¼å³å¯","title":"zshçš„åŸºæœ¬é…ç½®"},{"content":"1. Anacondaä¸‹è½½åœ°å€  å®˜æ–¹ä¸‹è½½åœ°å€ï¼šhttps://www.anaconda.com/distribution/#linux æ¸…åå¤§å­¦é•œåƒï¼šhttps://mirrors.tuna.tsinghua.edu.cn/anaconda/archive/ # é€‰æ‹©ä½ æƒ³å®‰è£…çš„ç‰ˆæœ¬ä¸‹è½½  2. å®‰è£… $ bash Anaconda3-2021.05-Linux-x86_64.sh # ä¸­é—´ä¼šæœ‰ä¸€äº›é€‰æ‹©ï¼ŒæŒ‰ç…§è‡ªå·±çš„æ„æ„¿é€‰æ‹©å³å¯  å…³é—­å¹¶é‡æ–°æ‰“å¼€ä½ çš„ç»ˆç«¯æ¥æ¿€æ´»conda\n3. ä½¿ç”¨  æ›´æ–°è‡ªå·±  # æ›´æ–°conda conda update conda conda update anaconda  æ›´æ–°æ—¶å‡ºç°äº†ValueError: check_hostname requires server_hostnameé”™è¯¯ï¼Œç»æŸ¥å‘ç°æ˜¯ä»£ç†çš„é—®é¢˜ï¼Œå¯å°è¯•å…³é—­æˆ–å¼€å¯ä»£ç†å†æ¬¡å°è¯•\n  å¯¹åŒ…çš„æ“ä½œ\n æ›´æ–°åŒ…  conda update --all # æ›´æ–°æ‰€æœ‰åŒ…  å®‰è£…åŒ…  conda install [åŒ…å]   å¯¹ç¯å¢ƒçš„æ“ä½œ\n åˆ›å»ºç¯å¢ƒ  conda create --name [ç¯å¢ƒåå­—] # ä½¿ç”¨é»˜è®¤çš„Pythonç‰ˆæœ¬  æ¿€æ´»ç¯å¢ƒ  conda activate [ç¯å¢ƒåå­—]  é€€å‡ºç¯å¢ƒ  conda deactivate  æŸ¥çœ‹ç¯å¢ƒåå­—  conda env list # conda info -e  åˆ é™¤ç¯å¢ƒä¸­æŸä¸ªåŒ…  conda remove [ç¯å¢ƒå] [åŒ…å]  ä¿®æ”¹ç¯å¢ƒåå­—  conda create -n [æ–°ç¯å¢ƒå] --clone [æ—§ç¯å¢ƒå] # å…‹éš†æ—§çš„ conda remove -n [æ—§ç¯å¢ƒå] # åˆ é™¤æ—§çš„  åˆ é™¤ç¯å¢ƒ  conda remove -n [ç¯å¢ƒå] --all   4. é…ç½® #1ã€æ¢æº,æ·»åŠ æ¸…åæº æ–¹æ³•ä¸€ vim ~/.condarc #æ·»åŠ ä»¥ä¸‹å†…å®¹ channels: - https://mirrors.ustc.edu.cn/anaconda/pkgs/main/ - https://mirrors.ustc.edu.cn/anaconda/cloud/conda-forge/ - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/ - defaults show_channel_urls: true #2ã€æ¢æº,æ·»åŠ æ¸…åæº æ–¹æ³•äºŒ onda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/ conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/ conda config --set show_channel_urls yes #æ¢å›é»˜è®¤æº conda config --remove-key channels ","permalink":"http://yangchnet.github.io/Dessert/posts/python/deepin15%E5%AE%89%E8%A3%85anaconda/","summary":"1. Anacondaä¸‹è½½åœ°å€  å®˜æ–¹ä¸‹è½½åœ°å€ï¼šhttps://www.anaconda.com/distribution/#linux æ¸…åå¤§å­¦é•œåƒï¼šhttps://mirrors.tuna.tsinghua.edu.cn/anaconda/archive/ # é€‰æ‹©ä½ æƒ³å®‰è£…çš„ç‰ˆæœ¬ä¸‹è½½  2. å®‰è£… $ bash Anaconda3-2021.05-Linux-x86_64.sh # ä¸­é—´ä¼šæœ‰ä¸€äº›é€‰æ‹©ï¼ŒæŒ‰ç…§è‡ªå·±çš„æ„æ„¿é€‰æ‹©å³å¯  å…³é—­å¹¶é‡æ–°æ‰“å¼€ä½ çš„ç»ˆç«¯æ¥æ¿€æ´»conda\n3. ä½¿ç”¨  æ›´æ–°è‡ªå·±  # æ›´æ–°conda conda update conda conda update anaconda  æ›´æ–°æ—¶å‡ºç°äº†ValueError: check_hostname requires server_hostnameé”™è¯¯ï¼Œç»æŸ¥å‘ç°æ˜¯ä»£ç†çš„é—®é¢˜ï¼Œå¯å°è¯•å…³é—­æˆ–å¼€å¯ä»£ç†å†æ¬¡å°è¯•\n  å¯¹åŒ…çš„æ“ä½œ\n æ›´æ–°åŒ…  conda update --all # æ›´æ–°æ‰€æœ‰åŒ…  å®‰è£…åŒ…  conda install [åŒ…å]   å¯¹ç¯å¢ƒçš„æ“ä½œ\n åˆ›å»ºç¯å¢ƒ  conda create --name [ç¯å¢ƒåå­—] # ä½¿ç”¨é»˜è®¤çš„Pythonç‰ˆæœ¬  æ¿€æ´»ç¯å¢ƒ  conda activate [ç¯å¢ƒåå­—]  é€€å‡ºç¯å¢ƒ  conda deactivate  æŸ¥çœ‹ç¯å¢ƒåå­—  conda env list # conda info -e  åˆ é™¤ç¯å¢ƒä¸­æŸä¸ªåŒ…  conda remove [ç¯å¢ƒå] [åŒ…å]  ä¿®æ”¹ç¯å¢ƒåå­—  conda create -n [æ–°ç¯å¢ƒå] --clone [æ—§ç¯å¢ƒå] # å…‹éš†æ—§çš„ conda remove -n [æ—§ç¯å¢ƒå] # åˆ é™¤æ—§çš„  åˆ é™¤ç¯å¢ƒ  conda remove -n [ç¯å¢ƒå] --all   4.","title":"Deepin15å®‰è£…Anaconda"},{"content":"ä¸€ã€é‡ç”Ÿgoroutineçš„é—®é¢˜  å¼•è¨€ï¼š æ¯‹åº¸ç½®ç–‘ï¼ŒgolangåŸç”Ÿçš„goroutineæå¤§é™ä½äº†ç¨‹åºå‘˜ä½¿ç”¨å¹¶å‘ç¼–ç¨‹çš„ä»£ä»·ï¼Œç¨‹åºå‘˜ä»¬ä¸éœ€è¦å†å»å…³å¿ƒå¦‚ä½•å®ç°æ¥å£ã€å¦‚ä½•ç»§æ‰¿Threadç±»ç­‰å¤šä½™çš„æ“ä½œï¼Œåªéœ€è¦ç®€ç®€å•å•çš„go, å°±å¯ä»¥å¼€å¯ä¸€ä¸ªå¹¶å‘çš„åç¨‹ã€‚ä½†è¿™ç§ç®€å•çš„ä½¿ç”¨æ–¹å¼åŒæ—¶ä¹Ÿå¸¦æ¥ä¸€äº›é—®é¢˜ï¼Œè¿™äº›goroutineä¸å†å—æˆ‘ä»¬æ§åˆ¶äº†ï¼Œå®ƒä»¬åœ¨è¿è¡Œæ—¶å¯èƒ½ä¼šå‘ç”Ÿä»»ä½•é”™è¯¯æˆ–æ„å¤–ï¼Œè€Œæˆ‘ä»¬æ— æ³•å¾—çŸ¥æˆ–å»å¤„ç†è¿™äº›æ„å¤–ã€‚æˆ‘ä»¬å°†å¯åŠ¨åä¸å†å—ä¸»è¿›ç¨‹æ§åˆ¶çš„goroutineç§°ä¸ºé‡ç”Ÿgoroutineï¼Œæœ¬èŠ‚å°†ä»‹ç»é‡ç”Ÿgoroutineå­˜åœ¨çš„ä¸€äº›é—®é¢˜å¹¶ä»‹ç»ä¸€äº›ç®€å•çš„è§£å†³æ–¹æ³•ã€‚\n 1. goroutineä¸­panicæ— æ³•æ¢å¤ æ­£å¸¸çš„å‡½æ•°ä¸­panicçš„recover\nimport ( \u0026#34;fmt\u0026#34; ) func main(){ defer func(){ if err := recover(); err != nil{ fmt.Println(err) } }() var bar = []int{1} fmt.Println(bar[1]) } reflect: slice index out of range goroutineä¸­panicçš„æ¢å¤\nfunc main(){ defer func(){ if err := recover(); err != nil { // åœ¨è¿™é‡Œä½¿ç”¨recover(),ä¸èƒ½æ•è·panic \tfmt.Println(\u0026#34;catch you, bad guy\u0026#34;) } }() go func(){ fmt.Println(\u0026#34;I\u0026#39;m in a goroutine\u0026#34;) panic(\u0026#34;come to catch me\u0026#34;) }() time.Sleep(10 * time.Second) // ä¸»è¿›ç¨‹åšå…¶ä»–äº‹ } I'm in a goroutine panic: come to catch me goroutine 6 [running]: main.foo.func2() /home/lc/Workspace/lab/main/main.go:22 +0x95 created by main.foo /home/lc/Workspace/lab/main/main.go:15 +0x5b Process finished with the exit code 2 ä¸Šé¢çš„ç¨‹åºåœ¨goroutineä¸­è§¦å‘äº†ä¸€ä¸ªpanicï¼Œç°åœ¨å‡è®¾foo()ä¸»è¿›ç¨‹æ˜¯æˆ‘ä»¬çš„æœåŠ¡ï¼Œæˆ‘ä»¬åœ¨æœåŠ¡çš„main()ä¸­ä½¿ç”¨recover()å°è¯•æ•è·ç¨‹åºä¸­å‘ç”Ÿçš„panicï¼Œä½†ç¨‹åºè¿è¡Œåå‘ç°ï¼Œgoroutineä¸­è§¦å‘çš„panicæ²¡æœ‰è¢«æ•è·ï¼Œç¨‹åºç›´æ¥é€€å‡ºï¼Œä»£è¡¨æˆ‘ä»¬çš„æœåŠ¡æŒ‚æ‰äº†ã€‚æ˜¾ç„¶åœ¨æ­£å¼ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬ä¸å¯èƒ½å®¹å¿è¿™æ ·çš„äº‹æƒ…å‘ç”Ÿï¼Œå› æ­¤éœ€è¦å¯¹goroutineä¸­è§¦å‘çš„panicè¿›è¡Œæ•è·å¤„ç†ã€‚\næ˜¾ç„¶æœ€ç®€å•çš„æ–¹æ³•æ˜¯åœ¨goroutineä¸­æ·»åŠ recover(), è¿›è¡Œå¼‚å¸¸æ•è·ï¼Œå¦‚ä¸‹ï¼š\nfunc main(){ go func(){ defer func(){ if err := recover(); err != nil { // åœ¨è¿™é‡Œä½¿ç”¨recover(),ä¸èƒ½æ•è·panic  fmt.Println(\u0026#34;catch you, bad guy\u0026#34;) } }() fmt.Println(\u0026#34;I\u0026#39;m in a goroutine\u0026#34;) panic(\u0026#34;come to catch me\u0026#34;) }() time.Sleep(10 * time.Second) // ä¸»è¿›ç¨‹åšå…¶ä»–äº‹ } I'm in a goroutine catch you, bad guy Process finished with the exit code 0 è¿™æ—¶ç¨‹åºæ­£å¸¸é€€å‡ºï¼ŒæœåŠ¡æ²¡æœ‰æŒ‚æ‰ã€‚ä½†æ¯æ¬¡ä½¿ç”¨goroutineéƒ½è¦åŠ recover()ç¨æ˜¾éº»çƒ¦ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‡½æ•°å¼ç¼–ç¨‹çš„æ€æƒ³æ¥å¯¹goroutineè¿›è¡Œä¸€ä¸‹å°è£…ï¼š\nfunc Go(f func()){ go func(){ defer func(){ if err := recover(); err != nil{ fmt.Println(\u0026#34;catch you, bad guy\u0026#34;) } }() f() }() } func main(){ Go(func(){ fmt.Printf(\u0026#34;I\u0026#39;m in a goroutine\u0026#34;) panic(\u0026#34;come to catch me\u0026#34;) }) time.Sleep(10 * time.Second) // ä¸»è¿›ç¨‹åšå…¶ä»–äº‹ } I'm in a goroutine catch you, bad guy Process finished with the exit code 0 æ˜¾ç„¶ï¼Œè¿™æ ·å°è£…è¿‡åæˆ‘ä»¬æ•è·åˆ°äº†panicï¼Œä½†å®é™…ä¸Šæˆ‘ä»¬ä»ç„¶æ˜¯åœ¨goroutineå†…éƒ¨æ•è·çš„panicï¼ŒA goroutine cannot recover from a panic in another goroutine.\n2. goroutineçš„æ³„éœ²é—®é¢˜ 2.1 ä»€ä¹ˆæ˜¯goroutineæ³„éœ² å¦‚æœä½ å¯åŠ¨äº†ä¸€ä¸ªgoroutineï¼Œä½†å¹¶æ²¡æœ‰ç¬¦åˆé¢„æœŸçš„é€€å‡ºï¼Œè€Œæ˜¯ç›´åˆ°ç¨‹åºç»“æŸï¼Œæ­¤goroutineæ‰é€€å‡ºï¼Œè¿™ç§æƒ…å†µå°±æ˜¯goroutineæ³„éœ²ã€‚å½“goroutineæ³„éœ²å‘ç”Ÿæ—¶ï¼Œè¯¥goroutineæ‰€å ç”¨çš„å†…å­˜ä¸èƒ½å¾—åˆ°é‡Šæ”¾ï¼Œå¯ç”¨å†…å­˜æŒç»­å‡å°‘ï¼Œæœ€ç»ˆå°†å¯¼è‡´ç³»ç»Ÿå´©æºƒã€‚\npackage main import \u0026#34;fmt\u0026#34; func main(){ for{ go sayHello() } } func sayHello(){ for{ fmt.Println(\u0026#34;hello\u0026#34;) } } ä»¥ä¸Šä»£ç æ˜¯ä¸€ä¸ªæœ€ç®€å•çš„goroutineæ³„éœ²åœºæ™¯ï¼Œæ‰€æœ‰çš„goroutineéƒ½æ²¡æœ‰é€€å‡ºï¼Œè€Œæ˜¯ä¸€ç›´åœ¨åå°æ‰§è¡Œã€‚åœ¨æˆ‘çš„ç”µè„‘ä¸Šæ‰§è¡Œä»¥ä¸Šä»£ç åï¼Œå†…å­˜å ç”¨è¾¾åˆ°98%ã€‚\n2.2 goroutineæ³„éœ²å‘ç”Ÿçš„åŸå›  2.2.1 channelå¯¼è‡´çš„æ³„éœ² 1. åªè¯»ä¸å‘\nfunc leak() { ch := make(chan int) go func() { val := \u0026lt;-ch fmt.Println(\u0026#34;We received a value:\u0026#34;, val) }() } åœ¨è¿™ä¸ªå‡½æ•°ä¸­ï¼Œleakåˆ›å»ºäº†ä¸€ä¸ªgoroutineï¼Œå…¶åœ¨ä»chä¸­è¯»å–ä¸€ä¸ªå€¼ä¹‹å‰ä¸€ç›´é˜»å¡ï¼Œä½†leakå¹¶æ²¡æœ‰å¾€chä¸­å‘é€å€¼ï¼Œå› æ­¤goroutineå°†ä¸€ç›´é˜»å¡ï¼Œåœ¨å‡½æ•°ç»“æŸå‰ä¸èƒ½å¾—åˆ°é‡Šæ”¾ã€‚\nè§£å†³æ–¹æ¡ˆ\nè®°å¾—å‘é€\nfunc unleak() { ch := make(chan int) go func() { val := \u0026lt;-ch fmt.Println(\u0026#34;We received a value:\u0026#34;, val) }() ch \u0026lt;- 1 } 2. åªå‘ä¸è¯»\nfunc gen(nums ...int) \u0026lt;-chan int { out := make(chan int) go func() { for _, n := range nums { out \u0026lt;- n } close(out) }() return out } func main() { defer func() { time.Sleep(time.Second) fmt.Println(\u0026#34;the number of goroutines: \u0026#34;, runtime.NumGoroutine()) }() _ = gen(2, 3) } the number of goroutines: 2 åœ¨è¿™æ®µä»£ç ä¸­ï¼Œgenå‘channelä¸­å‘é€æ•°æ®ï¼Œä½†ç”±äºæ²¡æœ‰å¯¹channelåšæ¥æ”¶ï¼Œå› æ­¤è¿™ä¸ªchannelå°†ä¼šè¢«é˜»å¡ï¼Œä»è€Œgoroutineä¹Ÿä¸èƒ½æ­£å¸¸é€€å‡ºï¼Œå‘ç”Ÿäº†goroutineæ³„éœ²ã€‚\nè§£å†³æ–¹æ¡ˆ\nåˆ©ç”¨channelå‘æ¥æ”¶è€…å‘é€åœæ­¢æ¶ˆæ¯,goroutineä¸­ä½¿ç”¨selectå¤šè·¯å¤ç”¨æ¥æ”¶é€€å‡ºä¿¡å·ã€‚ä½†å¦‚æœæˆ‘ä»¬æƒ³è¦é€€å‡ºå¤šä¸ªgoroutineæ€ä¹ˆåŠå‘¢ã€‚è¿™æ—¶ä¸€ç§å¯è¡Œçš„æ–¹æ³•æ˜¯ä½¿ç”¨channelçš„å¹¿æ’­æœºåˆ¶å‘æ‰€æœ‰goroutineå¹¿æ’­æ¶ˆæ¯ã€‚\nå½“ä¸€ä¸ªè¢«å…³é—­çš„channelä¸­å·²ç»å‘é€çš„æ•°æ®éƒ½è¢«æˆåŠŸæ¥æ”¶åï¼Œåç»­çš„æ¥æ”¶æ“ä½œå°†ä¸å†é˜»å¡ï¼Œå®ƒä»¬ä¼šç«‹å³è¿”å›ä¸€ä¸ªé›¶å€¼ã€‚å°†è¿™ä¸ªæœºåˆ¶æ‹“å±•ä¸€ä¸‹ï¼Œä¸è¦å‘channelå‘é€å€¼ï¼Œè€Œæ˜¯ç”¨å…³é—­ä¸€ä¸ªchannelæ¥è¿›è¡Œå¹¿æ’­ã€‚\nfunc gen(done chan struct{}, nums ...int) \u0026lt;-chan int { out := make(chan int) go func() { defer close(out) for _, n := range nums { select{ case out \u0026lt;- n: case \u0026lt;- done: return } } }() return out } func main() { defer func() { time.Sleep(time.Second) fmt.Println(\u0026#34;the number of goroutines: \u0026#34;, runtime.NumGoroutine()) }() done := make(chan struct{}) defer close(done) gen(done, 2, 3) gen(done, 2, 3) // è°ƒç”¨ä¸¤æ¬¡ï¼Œä»£è¡¨åˆ›å»ºå¤šä¸ªgoroutine } the number of goroutines: 1 3. selectæ“ä½œåœ¨æ‰€æœ‰caseä¸Šé˜»å¡\nfunc fibonacci(c, quit chan int) { x, y := 0, 1 for{ select { case c \u0026lt;- x: x, y = y, x+y case \u0026lt;-quit: fmt.Println(\u0026#34;quit\u0026#34;) return } } } func main() { defer func() { time.Sleep(time.Second) fmt.Println(\u0026#34;the number of goroutines: \u0026#34;, runtime.NumGoroutine()) }() c := make(chan int) quit := make(chan int) go fibonacci(c, quit) for i := 0; i \u0026lt; 10; i++{ fmt.Println(\u0026lt;- c) } // close(quit) } the number of goroutines: 2 åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªç‹¬ç«‹çš„goroutineä½œä¸ºæ–æ³¢é‚£å¥‘æ•°åˆ—çš„ç”Ÿæˆå™¨ï¼Œä½†æ˜¯è‹¥åœ¨ä¸»å‡½æ•°çš„æœ€åå¿˜è®°å‘quitå‘é€æˆ–å…³é—­quitï¼Œé‚£ä¹ˆæ˜¾ç„¶fibonacciå°†ä¸€ç›´è¿è¡Œåˆ°mainé€€å‡ºï¼Œé€ æˆgoroutineæ³„éœ²ã€‚\nè§£å†³æ–¹æ¡ˆ\n ä½¿ç”¨deferæˆ–åœ¨ç¨‹åºçš„æœ€åå¾€quitä¸­å‘é€æˆ–å…³é—­quit ä½¿ç”¨contextåŒ…  func fibonacci(c chan int, ctx context.Context) { x, y := 0, 1 for{ select { case c \u0026lt;- x: x, y = y, x+y case \u0026lt;-ctx.Done(): fmt.Println(\u0026#34;quit\u0026#34;) return } } } func main() { defer func() { time.Sleep(time.Second) fmt.Println(\u0026#34;the number of goroutines: \u0026#34;, runtime.NumGoroutine()) }() ctx, cancel := context.WithCancel(context.Background()) defer cancel() c := make(chan int) go fibonacci(c, ctx) for i := 0; i \u0026lt; 10; i++{ fmt.Println(\u0026lt;- c) } } the number of goroutines: 1 context.WithCancelæ¥æ”¶ä¸€ä¸ªcontext.Contextä½œä¸ºå‚æ•°ï¼Œè¿”å›ä¸€ä¸ªé™„å¸¦Done channelçš„concext.Contextçš„æ‹·è´å’Œä¸€ä¸ªcancelå‡½æ•°ï¼Œå½“cancelè¢«è°ƒç”¨æ—¶ï¼Œé™„å¸¦çš„Done channelå°±ä¼šè¢«å…³é—­ã€‚goroutineä¸­é€šè¿‡æ£€æŸ¥ctx.Done()ï¼Œå°±å¯ä»¥å¾—çŸ¥æ˜¯å¦åº”è¯¥é€€å‡ºã€‚\n4. nil channel å‘nil channelå‘é€å’Œæ¥æ”¶æ•°æ®éƒ½å°†ä¼šå¯¼è‡´é˜»å¡ã€‚è¿™ç§æƒ…å†µå¯èƒ½åœ¨æˆ‘ä»¬å®šä¹‰ channel æ—¶å¿˜è®°åˆå§‹åŒ–çš„æ—¶å€™å‘ç”Ÿã€‚\nfunc main() { defer func() { time.Sleep(time.Second) fmt.Println(\u0026#34;the number of goroutines: \u0026#34;, runtime.NumGoroutine()) }() var ch chan int go func() { \u0026lt;-ch // ch \u0026lt;- 1 \t}() } the number of goroutines: 2 æ— è®ºæ˜¯å‘nil channelä¸­å‘é€è¿˜æ˜¯æ¥å—ï¼Œéƒ½ä¼šå¯¼è‡´é˜»å¡\nè§£å†³æ–¹æ¡ˆ\nä¸è¦å¿˜è®°åˆå§‹åŒ–\n5. æ­»å¾ªç¯ åŒ2.1å°èŠ‚ä¸­çš„æƒ…å†µ\n2.2.2 åŒæ­¥æœºåˆ¶å¯¼è‡´çš„æ³„éœ² 1. é”å¯¼è‡´çš„goroutineæ³„éœ²\nfunc main() { total := 0 defer func() { time.Sleep(time.Second) fmt.Println(\u0026#34;the number of goroutines: \u0026#34;, runtime.NumGoroutine()) }() var mutex sync.Mutex for i := 0; i \u0026lt; 2; i++ { go func() { mutex.Lock() total += 1 }() } } åœ¨è¿™æ®µä»£ç ä¸­ï¼Œåˆ›å»ºäº†ä¸¤ä¸ªgoroutineï¼Œä¸¤ä¸ªgoroutineéƒ½è¦å¯¹totalè¿›è¡Œç‹¬å è®¿é—®ï¼Œä½†ç”±äºç¬¬ä¸€ä¸ªgoroutineæ²¡æœ‰è§£é”ï¼Œå¯¼è‡´ç¬¬äºŒä¸ªgoroutineä¸€ç›´é˜»å¡ã€‚\nè§£å†³æ–¹æ¡ˆ\nLock()ä¹‹åé©¬ä¸Šdefer Unlock()\n2. WaitGroupå¯¼è‡´çš„å†…å­˜æ³„éœ²\nfunc handle() { var wg sync.WaitGroup wg.Add(4) go func() { wg.Done() }() go func() { wg.Done() }() go func() { wg.Done() }() wg.Wait() } func main() { defer func() { time.Sleep(time.Second * 2) fmt.Println(\u0026#34;the number of goroutines: \u0026#34;, runtime.NumGoroutine()) }() go handle() } the number of goroutines: 2 åœ¨ä»¥ä¸Šä»£ç ä¸­ï¼Œè®¾ç½®å¹¶å‘ä»»åŠ¡æ•°ä¸º4ï¼Œä½†å…¶å®åªæœ‰3ä¸ªä»»åŠ¡ï¼Œæ‰€ä»¥wg.Waitæ°¸è¿œä¸å¯èƒ½æ»¡è¶³ã€‚handleå°†ä¸€ç›´è¢«é˜»å¡ã€‚\nè§£å†³æ–¹æ¡ˆ\nå»ºè®®ä¸è¦ä¸€æ¬¡æ€§è®¾ç½®ä»»åŠ¡æ•°é‡ï¼Œå°½é‡åœ¨ä»»åŠ¡å¯åŠ¨æ—¶é€šè¿‡wg.Add(1)çš„æ–¹å¼æ¥å¢åŠ ä»»åŠ¡æ•°ã€‚\n  ä½¿ç”¨åŸç”Ÿgoroutineè¿˜å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯åœ¨å¤§è§„æ¨¡ä½¿ç”¨æ—¶ä¼šå¯¼è‡´é¢‘ç¹çš„èµ„æºåˆ›å»ºä¸å›æ”¶ï¼Œå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚é‰´äºä»¥ä¸Šç§ç§é—®é¢˜ï¼Œæˆ‘ä»¬åº”è¯¥æœ‰æŸç§goroutineç®¡ç†çš„æœºåˆ¶ï¼Œèƒ½å¤Ÿä½¿å¾—goroutineåœ¨panicæ—¶ä¸ä¼šå½±å“åˆ°ä¸»è¿›ç¨‹ï¼Œåœ¨å‘ç”Ÿé•¿æ—¶é—´é˜»å¡æˆ–æ­»é”æ—¶èƒ½å¤Ÿè¢«åŠ¨é€€å‡ºï¼Œåœ¨è¦ç”¨åˆ°å¤§é‡å¹¶å‘åç¨‹æ—¶èƒ½å¤Ÿåšåˆ°èµ„æºå¤ç”¨\u0026hellip; ç”±æ­¤æˆ‘ä»¬å¼•å‡ºäº†â€”â€”æ± ã€‚\n äºŒã€æ± çš„æ€æƒ³  å¼•è¨€ï¼šæœºå™¨å­¦ä¹ ä¸­çš„æ± åŒ–ï¼ŒæŒ‡çš„æ˜¯å°†æŸä¸€å¤§å°çŸ©é˜µä¸­çš„æ•°æ®ç»è¿‡ä¸€å®šçš„è¿ç®—åå˜æˆä¸€ä¸ªæ›´å°çš„çŸ©é˜µï¼Œç”šè‡³ç›´æ¥å˜æˆä¸€ä¸ªå€¼ï¼Œè¿™ç§æ± åŒ–å¯æœ‰æ•ˆå‡å°æ•°æ®é‡å¹¶ä¿ç•™æ•°æ®ç‰¹å¾ã€‚è€Œåœ¨ç¨‹åºè®¾è®¡ä¸­çš„æ± åŒ–ï¼Œåˆ™æ˜¯å¦å¤–ä¸€ç§æˆªç„¶ä¸åŒçš„æ€æƒ³ï¼Œæ˜¯æŒ‡é€šè¿‡å¯¹èµ„æºçš„æœ‰æ•ˆç®¡ç†ã€å¤ç”¨ï¼Œè¾¾åˆ°èŠ‚çº¦èµ„æºã€æå‡æ€§èƒ½çš„ç›®çš„ã€‚æœ¬å°èŠ‚ä»‹ç»äº†æ± åŒ–çš„åŸºæœ¬æ€æƒ³ã€é˜è¿°äº†ä¸€äº›åŸºæœ¬æ¦‚å¿µã€‚\n 1. çº¿ç¨‹æ± åŸºç¡€ 1.1 é‡ç”Ÿçº¿ç¨‹ åœ¨æˆ‘ä»¬å¹³å¸¸çš„å¼€å‘ä¸­ï¼Œç»å¸¸ä¼šæœ‰ç”¨åˆ°å¤šçº¿ç¨‹çš„åœºæ™¯ï¼Œåˆç†åˆ©ç”¨å¤šçº¿ç¨‹å¯æœ‰æ•ˆåˆ©ç”¨CPUçš„å¤šæ ¸ç»“æ„ï¼Œæé«˜ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ã€‚æœ‰è¿™æ ·ä¸€ç§çº¿ç¨‹ï¼šæˆ‘ä»¬åˆ©ç”¨å…¶å®Œæˆä¸€äº›å·¥ä½œï¼Œä½†åªæ˜¯å°†å·¥ä½œäº¤ç»™è¿™ä¸ªçº¿ç¨‹ï¼Œè¯¥çº¿ç¨‹å¹¶ä¸ä¿è¯å®Œæˆä»»åŠ¡ï¼Œä¹Ÿä¸ä¿è¯æ­£å¸¸é€€å‡ºï¼Œå¹¶ä¸”åœ¨çº¿ç¨‹å¼€å§‹è¿è¡Œåæˆ‘ä»¬æ— æ³•å¯¹å…¶è¿›è¡Œæ§åˆ¶ã€‚è¿™ç§çŠ¶æ€å¯ç§°ä¸ºï¼šé‡ç”Ÿçº¿ç¨‹ï¼Œæ„ä¸ºå…¶å·²ç»ä¸å—æ§åˆ¶ï¼Œåœ¨å†…å­˜ä¸­è‡ªç”±è¿è¡Œã€‚\nè¿™ç§çº¿ç¨‹å¯èƒ½å¸¦æ¥ä¸€ç³»åˆ—é—®é¢˜ï¼š\n é¢‘ç¹ç”³è¯·/é”€æ¯çº¿ç¨‹ï¼Œå¯èƒ½å¸¦æ¥å·¨å¤§çš„é¢å¤–æ¶ˆè€— å½“å†…å­˜ä¸­å­˜åœ¨è¾ƒå¤šçš„é‡ç”Ÿçº¿ç¨‹ï¼Œä¼šå¯¼è‡´è¿‡åˆ†è°ƒåº¦ï¼Œé™ä½ç³»ç»Ÿæ€§èƒ½ ä¸èƒ½æ­£å¸¸é€€å‡ºçš„çº¿ç¨‹ä¼šå¯¼è‡´å†…å­˜æ³„éœ² ç³»ç»Ÿæ— æ³•åˆç†ç®¡ç†å†…éƒ¨çš„èµ„æºåˆ†å¸ƒï¼Œä¼šé™ä½ç³»ç»Ÿçš„ç¨³å®šæ€§ â€¦â€¦  é‰´äºä»¥ä¸Šé‡ç”Ÿçº¿ç¨‹å¸¦æ¥çš„é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹å¼å°†å…¶ç®¡ç†èµ·æ¥ï¼Œä½¿å…¶ä»é‡ç”Ÿçš„çº¿ç¨‹å˜æˆ\u0026quot;å®¶å…»\u0026quot;çš„çº¿ç¨‹ã€‚\n1.2 ä»€ä¹ˆæ˜¯çº¿ç¨‹æ±   æ± åŒ–ï¼šæ± åŒ–æ˜¯ä¸€ç§å°†èµ„æºç»Ÿä¸€è¿›è¡Œç®¡ç†ï¼Œä»è€Œæœ€å¤§åŒ–æ”¶ç›Šå¹¶æœ€å°åŒ–é£é™©çš„æ€æƒ³ã€‚\n çº¿ç¨‹æ± ç»´æŠ¤è‹¥å¹²ä¸ªçº¿ç¨‹ï¼Œåœ¨æ€»ä½“ä¸Šæ§åˆ¶çº¿ç¨‹çš„æ•°é‡ï¼Œå…·ä½“ä¸Šæ§åˆ¶çº¿ç¨‹çš„åˆ›å»ºã€é”€æ¯ç­‰ç”Ÿå‘½å‘¨æœŸï¼Œç³»ç»Ÿå¯é€šè¿‡ç”³è¯·çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å¼‚æ­¥çš„å®ŒæˆæŸä¸ªä»»åŠ¡ã€‚çº¿ç¨‹æ± é€šè¿‡å¯¹çº¿ç¨‹çš„ç®¡ç†å®ç°å¯¹èµ„æºçš„æœ‰æ•ˆåˆ©ç”¨ï¼Œé¿å…ç³»ç»Ÿèµ„æºæµªè´¹æˆ–å†…å­˜æ³„éœ²ç­‰é—®é¢˜ã€‚\n1.3 ä½¿ç”¨çº¿ç¨‹æ± çš„å¥½å¤„  çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å¯åå¤åˆ©ç”¨ï¼Œå‡å°‘äº†çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯çš„å¼€é”€ ä»»åŠ¡æ— éœ€ç­‰å¾…çº¿ç¨‹åˆ›å»ºå³å¯å¼€å§‹è¿è¡Œï¼Œæé«˜äº†ç³»ç»Ÿå“åº”é€Ÿåº¦ é€šè¿‡è®¾ç½®åˆç†çš„çº¿ç¨‹æ± çº¿ç¨‹æ•°ï¼Œå¯æœ‰æ•ˆé¿å…èµ„æºä½¿ç”¨ä¸å½“ï¼Œèµ„æºæµªè´¹ å¯¹çº¿ç¨‹è¿è¡Œè¿›è¡Œæœ‰æ•ˆçš„ç›‘è§†ä¸ç®¡ç†  é€šä¿—æ˜“æ‡‚çš„è®²ï¼Œå¦‚æœå°†çº¿ç¨‹æ¯”ä½œå®Œæˆä»»åŠ¡çš„äººï¼Œé‚£ä¹ˆçº¿ç¨‹æ± å°±åƒä¸€ä¸ªä¸“é—¨ç®¡ç†è¿™äº›äººçš„éƒ¨é—¨ã€‚å½“æˆ‘æœ‰ä»»åŠ¡åˆ°æ¥æ—¶ï¼Œç›´æ¥æŠŠä»»åŠ¡äº¤ç»™è¯¥éƒ¨é—¨ï¼Œè€Œä¸ç”¨è‡ªå·±å†å»æ‰¾äººæ¥å®Œæˆä»»åŠ¡ã€‚\n2. çº¿ç¨‹æ± çš„å·¥ä½œæœºåˆ¶ 2.1 çº¿ç¨‹æ± æ¨¡å‹ çº¿ç¨‹æ± çš„å†…éƒ¨å®é™…ä¸Šå¯ä»¥çœ‹åšæ˜¯ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ï¼ŒäºŒè€…å¹¶ä¸ç›´æ¥å…³è”ï¼Œé€šè¿‡ä»»åŠ¡é˜Ÿåˆ—è¿›è¡Œäº¤äº’ï¼Œä»è€Œå¯ä»¥æœ‰æ•ˆçš„ç¼“å†²ä»»åŠ¡ï¼Œå¤ç”¨çº¿ç¨‹ã€‚\nåœ¨çº¿ç¨‹æ± æ¨¡å‹ä¸­ï¼Œæ‰®æ¼”ç”Ÿäº§è€…è§’è‰²çš„æ˜¯ä»»åŠ¡ç®¡ç†éƒ¨åˆ†ï¼Œå…¶æ¥å—æäº¤çš„ä»»åŠ¡ï¼Œå¹¶åˆ¤æ–­ä»»åŠ¡åº”å¦‚ä½•å¤„ç†ï¼š\n ç›´æ¥ç”³è¯·çº¿ç¨‹æ‰§è¡Œè¯¥ä»»åŠ¡ ç¼“å†²åˆ°é˜Ÿåˆ—ä¸­ç­‰å¾…çº¿ç¨‹æ‰§è¡Œ ç›´æ¥æ‹’ç»è¯¥ä»»åŠ¡  çº¿ç¨‹ç®¡ç†éƒ¨åˆ†æ˜¯æ¶ˆè´¹è€…ï¼Œçº¿ç¨‹è¢«ç»Ÿä¸€ç»´æŠ¤åœ¨çº¿ç¨‹æ± ä¸­ï¼Œå½“æœ‰ä»»åŠ¡è¯·æ±‚åˆ°æ¥æ—¶ï¼ŒæŸä¸€çº¿ç¨‹è¢«åˆ†é…å»æ‰§è¡Œè¿™ä¸ªä»»åŠ¡ï¼Œæ‰§è¡Œå®Œæˆåç»§ç»­æˆ–è®¸æ–°çš„ä»»åŠ¡æ¥æ‰§è¡Œï¼Œæœ€ç»ˆå½“çº¿ç¨‹è·å–ä¸åˆ°ä»»åŠ¡æ—¶ï¼Œçº¿ç¨‹å°±è¢«å›æ”¶ä»¥èŠ‚çœç³»ç»Ÿèµ„æºã€‚\n2.2 çº¿ç¨‹æ± çš„çŠ¶æ€ çº¿ç¨‹æ± ä¸€æ–¹é¢ç»´æŠ¤è‡ªèº«çš„çŠ¶æ€ï¼Œå¦ä¸€æ–¹é¢ç®¡ç†çº¿ç¨‹å’Œä»»åŠ¡ï¼Œä½¿äºŒè€…è‰¯å¥½çš„ç»“åˆä»è€Œæ‰§è¡Œå¹¶è¡Œä»»åŠ¡ã€‚ çº¿ç¨‹æ± çš„çŠ¶æ€æœ‰5ç§ï¼š\n   è¿è¡ŒçŠ¶æ€ çŠ¶æ€æè¿°     RUNNING èƒ½æ¥å—æ–°æäº¤çš„ä»»åŠ¡ï¼Œå¹¶ä¸”ä¹Ÿèƒ½å¤„ç†é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡   SHUTDOWN å…³é—­çŠ¶æ€ï¼Œä¸å†æ¥å—æ–°æäº¤çš„ä»»åŠ¡ï¼Œä½†å¯ä»¥ç»§ç»­å¤„ç†é˜»å¡é˜Ÿåˆ—ä¸­å·²ä¿å­˜çš„ä»»åŠ¡   STOP ä¸èƒ½æ¥å—æ–°ä»»åŠ¡ï¼Œä¹Ÿä¸å¤„ç†é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼Œä¼šä¸­æ–­æ­£åœ¨å¤„ç†ä»»åŠ¡çš„çº¿ç¨‹   TIDYING æ‰€æœ‰çš„ä»»åŠ¡éƒ½å·²ç»ˆæ­¢ï¼Œæœ‰æ•ˆçº¿ç¨‹æ•°ä¸º0   TERMINATED åœ¨terminated()æ–¹æ³•æ‰§è¡Œåè¿›å…¥è¯¥çŠ¶æ€   å…¶ç”Ÿå‘½å‘¨æœŸè½¬æ¢å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š     sequenceDiagram RUNNING-\u0026gt;\u0026gt;SHUTDOWN:shutdown() RUNNING-\u0026gt;\u0026gt;STOP: shutdownNow() SHUTDOWN-\u0026gt;\u0026gt;TIDYING:æ‰€æœ‰ä»»åŠ¡éƒ½å·²å®Œæˆï¼Œé˜»å¡é˜Ÿåˆ—ä¸ºç©ºï¼Œå·¥ä½œçº¿ç¨‹æ•°ä¸º0 STOP-\u0026gt;\u0026gt;TIDYING:çº¿ç¨‹æ± ä¸­å·¥ä½œçº¿ç¨‹æ•°ä¸º0 TIDYING-\u0026gt;\u0026gt;TERMINATED: terminated() 2.3 ä»»åŠ¡æ‰§è¡Œæœºåˆ¶ 2.3.1 ä»»åŠ¡è°ƒåº¦ ä»»åŠ¡è°ƒåº¦æ˜¯çº¿ç¨‹æ± çš„ä¸»è¦å…¥å£ï¼Œç”¨æˆ·æäº¤ä»»åŠ¡åï¼Œè¿™éƒ¨åˆ†å°†å†³å®šä»»åŠ¡å¦‚ä½•æ‰§è¡Œã€‚ ä»»åŠ¡è°ƒåº¦çš„æµç¨‹å›¾å¦‚ä¸‹ï¼š  æäº¤ä»»åŠ¡åï¼Œé¦–å…ˆæ£€æµ‹è¿è¡Œæ± çŠ¶æ€ï¼Œè‹¥ä¸æ˜¯RUNNINGï¼Œåˆ™ç›´æ¥æ‹’ç»ï¼Œçº¿ç¨‹æ± è¦ä¿è¯åœ¨RUNNINGçŠ¶æ€ä¸‹æ‰§è¡Œä»»åŠ¡ã€‚ å¦‚æœçº¿ç¨‹æ•°å°äºæ ¸å¿ƒæ•°ï¼Œè¯´æ˜ç³»ç»Ÿè¿˜æ²¡æœ‰è¢«å……åˆ†åˆ©ç”¨ï¼Œåˆ™å¯æ·»åŠ çº¿ç¨‹å¹¶æ‰§è¡Œã€‚è‹¥çº¿ç¨‹æ•°å¤§äºæ ¸å¿ƒæ•°ï¼Œæ­¤æ—¶å†ä¸€å‘³å¢åŠ çº¿ç¨‹æ•°åªä¼šå¸¦æ¥è°ƒåº¦å¼€é”€ï¼Œåˆ™å°†ä»»åŠ¡æ”¾å…¥é˜»å¡é˜Ÿåˆ—ã€‚ è‹¥é˜»å¡é˜Ÿåˆ—æœªæ»¡ï¼Œåˆ™å°†ä»»åŠ¡æ”¾å…¥é˜»å¡é˜Ÿåˆ—ç­‰å¾…æ‰§è¡Œï¼Œå¦åˆ™è¿›è¡Œä¸‹ä¸€æ­¥ã€‚ è‹¥çº¿ç¨‹æ•°å°äºæœ€å¤§çº¿ç¨‹æ•°ï¼Œå¯æ·»åŠ å·¥ä½œçº¿ç¨‹æ‰§è¡Œï¼Œè‹¥çº¿ç¨‹æ•°å·²å¤§äºç­‰äºæœ€å¤§çº¿ç¨‹æ•°ï¼Œæ­¤æ—¶ç›´æ¥æ‹’ç»ä»»åŠ¡ï¼Œä¸äºˆæ‰§è¡Œã€‚  2.3.2 ä»»åŠ¡ç¼“å†² çº¿ç¨‹æ± çš„æœ¬è´¨æ˜¯å¯¹ä»»åŠ¡å’Œçº¿ç¨‹çš„ç®¡ç†ï¼Œè¦è®©äºŒè€…åˆ†åˆ«ç‹¬ç«‹è¿è¡Œã€‚å¦‚æœä¸ä½¿ç”¨çº¿ç¨‹æ± ï¼Œä¸€ä¸ªä»»åŠ¡å³ä¸€ä¸ªçº¿ç¨‹ï¼Œå¯¹ä»»åŠ¡ä¸çº¿ç¨‹çš„ç®¡ç†éƒ½å°†é™·å…¥æ··ä¹±ã€‚è¦åˆ†åˆ«å¯¹ä»»åŠ¡å’Œçº¿ç¨‹è¿›è¡Œç®¡ç†ï¼Œåˆ™éœ€è¦å°†äºŒè€…è¿›è¡Œè§£è€¦ï¼Œä¸è®©äºŒè€…ç›´æ¥å…³è”ã€‚çº¿ç¨‹æ± ä»¥æ¶ˆè´¹è€…-ç”Ÿäº§è€…æ¨¡å‹ï¼Œé€šè¿‡ä¸€ä¸ªé˜»å¡é˜Ÿåˆ—å®ç°äºŒè€…çš„è§£è€¦ã€‚é˜»å¡é˜Ÿåˆ—ç¼“å­˜ä»»åŠ¡ï¼Œå·¥ä½œçº¿ç¨‹ä»é˜»å¡é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡ã€‚\né˜»å¡é˜Ÿåˆ—(BlockingQueue)æ˜¯ä¸€ä¸ªæ”¯æŒä¸¤ä¸ªé™„åŠ æ“ä½œçš„é˜Ÿåˆ—ã€‚è¿™ä¸¤ä¸ªé™„åŠ çš„æ“ä½œæ˜¯ï¼š\n åœ¨é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œè·å–å…ƒç´ çš„çº¿ç¨‹ä¼šç­‰å¾…é˜Ÿåˆ—å˜ä¸ºéç©ºã€‚ å½“é˜Ÿåˆ—æ»¡æ—¶ï¼Œå­˜å‚¨å…ƒç´ çš„çº¿ç¨‹ä¼šç­‰å¾…é˜Ÿåˆ—å¯ç”¨ã€‚ é˜»å¡é˜Ÿåˆ—å¸¸ç”¨äºç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„åœºæ™¯ï¼Œç”Ÿäº§è€…æ˜¯å¾€é˜Ÿåˆ—é‡Œæ·»åŠ å…ƒç´ çš„çº¿ç¨‹ï¼Œæ¶ˆè´¹è€…æ˜¯ä»é˜Ÿåˆ—é‡Œæ‹¿å…ƒç´ çš„çº¿ç¨‹ã€‚é˜»å¡é˜Ÿåˆ—å°±æ˜¯ç”Ÿäº§è€…å­˜æ”¾å…ƒç´ çš„å®¹å™¨ï¼Œè€Œæ¶ˆè´¹è€…ä¹Ÿåªä»å®¹å™¨é‡Œæ‹¿å…ƒç´ ã€‚ å…¶å·¥ä½œæ¨¡å¼å¦‚ä¸‹ï¼š   2.3.3 ä»»åŠ¡ç”³è¯· ä»ä¸Šæ–‡ä»»åŠ¡è°ƒåº¦éƒ¨åˆ†å¯çŸ¥ï¼Œä»»åŠ¡çš„æ‰§è¡Œæœ‰ä¸¤ç§å¯èƒ½ï¼š\n ä»»åŠ¡ç›´æ¥ç”±æ–°åˆ›å»ºçš„çº¿ç¨‹æ‰§è¡Œ çº¿ç¨‹ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡ç„¶åæ‰§è¡Œï¼Œæ‰§è¡Œå®Œä»»åŠ¡çš„ç©ºé—²è¿›è¡Œå†æ¬¡å»é˜Ÿåˆ—ä¸­ç”³è¯·ä»»åŠ¡æ‰§è¡Œ ç¬¬ä¸€ç§æƒ…å†µä»…åœ¨çº¿ç¨‹åˆå§‹åˆ›å»ºæ—¶å‡ºç°ï¼Œå¤šæ•°æƒ…å†µä¸‹æ˜¯ç¬¬äºŒç§æƒ…å†µ  çº¿ç¨‹è¦ä»ä»»åŠ¡ç¼“å­˜æ¨¡å—ä¸­ä¸æ–­è·å–ä»»åŠ¡æ‰§è¡Œï¼Œå®šä¹‰getTaskæ–¹æ³•æ¥å¸®åŠ©çº¿ç¨‹ä»é˜»å¡é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡ï¼Œå®ç°çº¿ç¨‹ç®¡ç†æ¨¡å—å’Œä»»åŠ¡ç®¡ç†æ¨¡å—çš„é€šä¿¡ã€‚å…¶æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š è¿™é‡Œè¿›è¡Œäº†å¤šæ¬¡åˆ¤æ–­ï¼Œç›®çš„åœ¨äºæ§åˆ¶çº¿ç¨‹çš„æ•°é‡ï¼Œä½¿å…¶ç¬¦åˆçº¿ç¨‹æ± çš„çŠ¶æ€ã€‚å¦‚æœçº¿ç¨‹æ± ç°åœ¨ä¸åº”è¯¥æŒæœ‰é‚£ä¹ˆå¤šçº¿ç¨‹ï¼Œåˆ™ä¼šè¿”å›nullå€¼ã€‚å·¥ä½œçº¿ç¨‹Workerä¼šä¸æ–­æ¥æ”¶æ–°ä»»åŠ¡å»æ‰§è¡Œï¼Œè€Œå½“å·¥ä½œçº¿ç¨‹Workeræ¥æ”¶ä¸åˆ°ä»»åŠ¡çš„æ—¶å€™ï¼Œå°±ä¼šå¼€å§‹è¢«å›æ”¶ã€‚\n2.3.4 ä»»åŠ¡æ‹’ç» ä»»åŠ¡æ‹’ç»æ¨¡å—æ˜¯çº¿ç¨‹æ± çš„ä¿æŠ¤éƒ¨åˆ†ã€‚å½“çº¿ç¨‹æ± çš„ä»»åŠ¡ç¼“å­˜é˜Ÿåˆ—å·²æ»¡ï¼Œå¹¶ä¸”çº¿ç¨‹æ•°è¾¾åˆ°è®¾å®šçš„æœ€å¤§å€¼ï¼Œå°±éœ€è¦æ‹’ç»åˆ°æ¥çš„ä»»åŠ¡ï¼Œä¿æŠ¤çº¿ç¨‹æ± ã€‚\n2.4 Workerçº¿ç¨‹ç®¡ç† 2.4.1 Workerçº¿ç¨‹ çº¿ç¨‹æ± ä¸ºäº†æŒæ¡çº¿ç¨‹çš„çŠ¶æ€å¹¶ç»´æŠ¤çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸï¼Œè®¾è®¡äº†çº¿ç¨‹æ± å†…çš„å·¥ä½œçº¿ç¨‹Workerã€‚\nWorkeræŒæœ‰ä¸€ä¸ªçº¿ç¨‹threadå’Œä¸€ä¸ªåˆå§‹åŒ–çš„ä»»åŠ¡firstTaskã€‚threadæ˜¯åœ¨Workeråˆ›å»ºæ—¶åˆ›å»ºçš„çº¿ç¨‹ï¼Œå¯ç”¨æ¥æ‰§è¡Œä»»åŠ¡ï¼›firstTaskä¿å­˜ä¼ å…¥çš„ç¬¬ä¸€ä¸ªä»»åŠ¡ï¼Œè¿™ä¸ªä»»åŠ¡å¯ä»¥æœ‰ä¹Ÿå¯ä»¥ä¸ºç©ºã€‚å¦‚æœæ­¤å€¼éç©ºï¼Œé‚£ä¹ˆWorkerä¼šå…ˆæ‰§è¡Œè¿™ä¸ªä»»åŠ¡ï¼Œå†å»è·å–ä»»åŠ¡æ‰§è¡Œï¼›å¦‚æœæ­¤å€¼ä¸ºç©ºï¼Œé‚£ä¹ˆWorkerç›´æ¥å»é˜»å¡é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡æ‰§è¡Œã€‚ çº¿ç¨‹æ± éœ€è¦ç®¡ç†çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸï¼Œéœ€è¦åœ¨çº¿ç¨‹é•¿æ—¶é—´ä¸è¿è¡Œçš„æ—¶å€™è¿›è¡Œå›æ”¶ã€‚çº¿ç¨‹æ± ä½¿ç”¨ä¸€å¼ Hashè¡¨å»æŒæœ‰çº¿ç¨‹çš„å¼•ç”¨ï¼Œè¿™æ ·å¯ä»¥é€šè¿‡æ·»åŠ å¼•ç”¨ã€ç§»é™¤å¼•ç”¨è¿™æ ·çš„æ“ä½œæ¥æ§åˆ¶çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸã€‚è¿™ä¸ªæ—¶å€™é‡è¦çš„å°±æ˜¯å¦‚ä½•åˆ¤æ–­çº¿ç¨‹æ˜¯å¦åœ¨è¿è¡Œã€‚\nâ€‹Workeræ˜¯é€šè¿‡ç»§æ‰¿AQSï¼Œä½¿ç”¨AQSæ¥å®ç°ç‹¬å é”è¿™ä¸ªåŠŸèƒ½ã€‚æ²¡æœ‰ä½¿ç”¨å¯é‡å…¥é”ReentrantLockï¼Œè€Œæ˜¯ä½¿ç”¨AQSï¼Œä¸ºçš„å°±æ˜¯å®ç°ä¸å¯é‡å…¥çš„ç‰¹æ€§å»ååº”çº¿ç¨‹ç°åœ¨çš„æ‰§è¡ŒçŠ¶æ€ã€‚\n1.lockæ–¹æ³•ä¸€æ—¦è·å–äº†ç‹¬å é”ï¼Œè¡¨ç¤ºå½“å‰çº¿ç¨‹æ­£åœ¨æ‰§è¡Œä»»åŠ¡ä¸­ã€‚ 2.å¦‚æœæ­£åœ¨æ‰§è¡Œä»»åŠ¡ï¼Œåˆ™ä¸åº”è¯¥ä¸­æ–­çº¿ç¨‹ã€‚ 3.å¦‚æœè¯¥çº¿ç¨‹ç°åœ¨ä¸æ˜¯ç‹¬å é”çš„çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯ç©ºé—²çš„çŠ¶æ€ï¼Œè¯´æ˜å®ƒæ²¡æœ‰åœ¨å¤„ç†ä»»åŠ¡ï¼Œè¿™æ—¶å¯ä»¥å¯¹è¯¥çº¿ç¨‹è¿›è¡Œä¸­æ–­ã€‚ 4.çº¿ç¨‹æ± åœ¨æ‰§è¡Œshutdownæ–¹æ³•æˆ–tryTerminateæ–¹æ³•æ—¶ä¼šè°ƒç”¨interruptIdleWorkersæ–¹æ³•æ¥ä¸­æ–­ç©ºé—²çš„çº¿ç¨‹ï¼ŒinterruptIdleWorkersæ–¹æ³•ä¼šä½¿ç”¨tryLockæ–¹æ³•æ¥åˆ¤æ–­çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ˜¯å¦æ˜¯ç©ºé—²çŠ¶æ€ï¼›å¦‚æœçº¿ç¨‹æ˜¯ç©ºé—²çŠ¶æ€åˆ™å¯ä»¥å®‰å…¨å›æ”¶ã€‚\nåœ¨çº¿ç¨‹å›æ”¶è¿‡ç¨‹ä¸­å°±ä½¿ç”¨åˆ°äº†è¿™ç§ç‰¹æ€§ï¼Œå›æ”¶è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n2.4.2 Workerçº¿ç¨‹å¢åŠ  å¢åŠ çº¿ç¨‹æ˜¯é€šè¿‡çº¿ç¨‹æ± ä¸­çš„addWorkeræ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„åŠŸèƒ½å°±æ˜¯å¢åŠ ä¸€ä¸ªçº¿ç¨‹ï¼Œè¯¥æ–¹æ³•ä¸è€ƒè™‘çº¿ç¨‹æ± æ˜¯åœ¨å“ªä¸ªé˜¶æ®µå¢åŠ çš„è¯¥çº¿ç¨‹ï¼Œè¿™ä¸ªåˆ†é…çº¿ç¨‹çš„ç­–ç•¥æ˜¯åœ¨ä¸Šä¸ªæ­¥éª¤å®Œæˆçš„ï¼Œè¯¥æ­¥éª¤ä»…ä»…å®Œæˆå¢åŠ çº¿ç¨‹ï¼Œå¹¶ä½¿å®ƒè¿è¡Œï¼Œæœ€åè¿”å›æ˜¯å¦æˆåŠŸè¿™ä¸ªç»“æœã€‚addWorkeræ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°ï¼šfirstTaskã€coreã€‚firstTaskå‚æ•°ç”¨äºæŒ‡å®šæ–°å¢çš„çº¿ç¨‹æ‰§è¡Œçš„ç¬¬ä¸€ä¸ªä»»åŠ¡ï¼Œè¯¥å‚æ•°å¯ä»¥ä¸ºç©ºï¼›coreå‚æ•°ä¸ºtrueè¡¨ç¤ºåœ¨æ–°å¢çº¿ç¨‹æ—¶ä¼šåˆ¤æ–­å½“å‰æ´»åŠ¨çº¿ç¨‹æ•°æ˜¯å¦å°‘äºcorePoolSizeï¼Œfalseè¡¨ç¤ºæ–°å¢çº¿ç¨‹å‰éœ€è¦åˆ¤æ–­å½“å‰æ´»åŠ¨çº¿ç¨‹æ•°æ˜¯å¦å°‘äºmaximumPoolSizeï¼Œå…¶æ‰§è¡Œæµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 2.4.3 Workerçº¿ç¨‹å›æ”¶ çº¿ç¨‹æ± ä¸­çº¿ç¨‹çš„é”€æ¯ä¾èµ–JVMè‡ªåŠ¨çš„å›æ”¶ï¼Œçº¿ç¨‹æ± åšçš„å·¥ä½œæ˜¯æ ¹æ®å½“å‰çº¿ç¨‹æ± çš„çŠ¶æ€ç»´æŠ¤ä¸€å®šæ•°é‡çš„çº¿ç¨‹å¼•ç”¨ï¼Œé˜²æ­¢è¿™éƒ¨åˆ†çº¿ç¨‹è¢«JVMå›æ”¶ï¼Œå½“çº¿ç¨‹æ± å†³å®šå“ªäº›çº¿ç¨‹éœ€è¦å›æ”¶æ—¶ï¼Œåªéœ€è¦å°†å…¶å¼•ç”¨æ¶ˆé™¤å³å¯ã€‚Workerè¢«åˆ›å»ºå‡ºæ¥åï¼Œå°±ä¼šä¸æ–­åœ°è¿›è¡Œè½®è¯¢ï¼Œç„¶åè·å–ä»»åŠ¡å»æ‰§è¡Œï¼Œæ ¸å¿ƒçº¿ç¨‹å¯ä»¥æ— é™ç­‰å¾…è·å–ä»»åŠ¡ï¼Œéæ ¸å¿ƒçº¿ç¨‹è¦é™æ—¶è·å–ä»»åŠ¡ã€‚å½“Workeræ— æ³•è·å–åˆ°ä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯è·å–çš„ä»»åŠ¡ä¸ºç©ºæ—¶ï¼Œå¾ªç¯ä¼šç»“æŸï¼ŒWorkerä¼šä¸»åŠ¨æ¶ˆé™¤è‡ªèº«åœ¨çº¿ç¨‹æ± å†…çš„å¼•ç”¨ã€‚\näº‹å®ä¸Šï¼Œå°†çº¿ç¨‹å¼•ç”¨ç§»å‡ºçº¿ç¨‹æ± å°±å·²ç»ç»“æŸäº†çº¿ç¨‹é”€æ¯çš„éƒ¨åˆ†ã€‚ä½†ç”±äºå¼•èµ·çº¿ç¨‹é”€æ¯çš„å¯èƒ½æ€§æœ‰å¾ˆå¤šï¼Œçº¿ç¨‹æ± è¿˜è¦åˆ¤æ–­æ˜¯ä»€ä¹ˆå¼•å‘äº†è¿™æ¬¡é”€æ¯ï¼Œæ˜¯å¦è¦æ”¹å˜çº¿ç¨‹æ± çš„ç°é˜¶æ®µçŠ¶æ€ï¼Œæ˜¯å¦è¦æ ¹æ®æ–°çŠ¶æ€ï¼Œé‡æ–°åˆ†é…çº¿ç¨‹ã€‚\n2.4.4 Workerçº¿ç¨‹æ‰§è¡Œä»»åŠ¡ åœ¨Workerç±»ä¸­çš„runæ–¹æ³•è°ƒç”¨äº†runWorkeræ–¹æ³•æ¥æ‰§è¡Œä»»åŠ¡ï¼ŒrunWorkeræ–¹æ³•çš„æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š\n1.whileå¾ªç¯ä¸æ–­åœ°é€šè¿‡getTask()æ–¹æ³•è·å–ä»»åŠ¡ã€‚ 2.getTask()æ–¹æ³•ä»é˜»å¡é˜Ÿåˆ—ä¸­å–ä»»åŠ¡ã€‚ 3.å¦‚æœçº¿ç¨‹æ± æ­£åœ¨åœæ­¢ï¼Œé‚£ä¹ˆè¦ä¿è¯å½“å‰çº¿ç¨‹æ˜¯ä¸­æ–­çŠ¶æ€ï¼Œå¦åˆ™è¦ä¿è¯å½“å‰çº¿ç¨‹ä¸æ˜¯ä¸­æ–­çŠ¶æ€ã€‚ 4.æ‰§è¡Œä»»åŠ¡ã€‚ 5.å¦‚æœgetTaskç»“æœä¸ºnullåˆ™è·³å‡ºå¾ªç¯ï¼Œæ‰§è¡ŒprocessWorkerExit()æ–¹æ³•ï¼Œé”€æ¯çº¿ç¨‹ã€‚ ä¸‰ã€ç°æœ‰goroutineæ± çš„è§£å†³æ–¹æ¡ˆ  å¼•è¨€ï¼š æœ¬å°èŠ‚ç®€å•åˆ†æäº†GitHubä¸Šäº”ä¸ªgoroutineæ± å®ç°çš„åŸºæœ¬æ€æƒ³ï¼Œå…¶ä¸­éƒ¨åˆ†ä»£ç åšäº†ç®€åŒ–ã€‚\n 1. wazsmwazsm/mortarï¼ˆâ˜…74ï¼‰ ç®€å•ä»‹ç»\nåˆ›å»ºä¸€ä¸ªå®¹é‡ä¸º N çš„æ± , åœ¨æ± å®¹é‡æœªæ»¡æ—¶, æ¯å¡å…¥ä¸€ä¸ªä»»åŠ¡ï¼ˆç”Ÿäº§ä»»åŠ¡ï¼‰, ä»»åŠ¡æ± å¼€å¯ä¸€ä¸ª worker (å»ºç«‹åç¨‹) å»å¤„ç†ä»»åŠ¡ï¼ˆæ¶ˆè´¹ä»»åŠ¡ï¼‰ã€‚ å½“ä»»åŠ¡æ± å®¹é‡èµ›æ»¡ï¼Œæ¯å¡å…¥ä¸€ä¸ªä»»åŠ¡ï¼ˆç”Ÿäº§ä»»åŠ¡ï¼‰, ä»»åŠ¡ä¼šè¢«å·²æœ‰çš„ N ä¸ª worker æŠ¢å æ‰§è¡Œï¼ˆæ¶ˆè´¹ä»»åŠ¡ï¼‰ï¼Œè¾¾åˆ°åç¨‹é™åˆ¶çš„åŠŸèƒ½ã€‚ä½†workeråˆ›å»ºåä¸ä¼šå›æ”¶ï¼Œé™¤éå°†æ•´ä¸ªpoolæ’¤é”€ã€‚\nç»“æ„\ntype Task struct { Handler func(v ...interface{}) // å‡½æ•°ç­¾å \tParams []interface{} // å‚æ•° } // Pool task pool type Pool struct { capacity uint64 // æ± çš„å®¹é‡ï¼Œè‡ªè¡Œåˆ¶å®š \trunningWorkers uint64 // æ­£åœ¨è¿è¡Œçš„worker \tstatus int64 // æ± çš„çŠ¶æ€ \tchTask chan *Task // ä»»åŠ¡é˜Ÿåˆ—ï¼Œworkerä»ä¸­è·å–ä»»åŠ¡ \tPanicHandler func(interface{}) // è‡ªå®šä¹‰çš„PanicHandlerï¼Œé˜²æ­¢å› æŸä¸ªgoroutineå‘ç”Ÿpanicè€Œå¯¼è‡´æœåŠ¡å´©æºƒã€‚ \tsync.Mutex // å…¨å±€é” } æ ¸å¿ƒä»£ç \n// Put put a task to pool func (p *Pool) Put(task *Task) error { p.Lock() // åŠ é”ï¼Œé˜²æ­¢æ•°æ®ç«äº‰ \tdefer p.Unlock() if p.status == STOPED { // æ£€æŸ¥æ± æ˜¯å¦è¿˜åœ¨è¿è¡Œ \treturn ErrPoolAlreadyClosed } // run worker \tif p.GetRunningWorkers() \u0026lt; p.GetCap() { // workeræ•°é‡å°šæœªè¾¾åˆ°å®¹é‡é™åˆ¶ï¼Œæ–°å»ºä¸€ä¸ªworker \tp.run() // è¿™é‡Œå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œè‹¥æ± ä¸­æœ‰ç©ºé—²çš„workerï¼Œä¹Ÿä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„workerï¼Œè¿™ä¸ªworkeråˆ›å»ºåä¹Ÿä¼šç©ºé—²ï¼Œå­˜åœ¨èµ„æºæµªè´¹ \t} // send task \tif p.status == RUNNING { p.chTask \u0026lt;- task // å‘ä»»åŠ¡é˜Ÿåˆ—å‘é€ä»»åŠ¡ \t} return nil } func (p *Pool) run() { p.incRunning() // workerè®¡æ•°+1  go func() { defer func() { // é˜²æ­¢å› æŸä¸ªgoroutineå‘ç”Ÿpanicè€Œå¯¼è‡´æœåŠ¡å´©æºƒ \tp.decRunning() // workerè®¡æ•°å‡1 \tif r := recover(); r != nil { if p.PanicHandler != nil { p.PanicHandler(r) // è‡ªå®šä¹‰äº†panicåæ“ä½œ \t} else { log.Printf(\u0026#34;Worker panic: %s\\n\u0026#34;, r) // panicåé»˜è®¤æ“ä½œ \t} } p.checkWorker() // æ£€æŸ¥æ˜¯å¦è¿˜æœ‰workeråœ¨è¿è¡Œï¼Œä¿æŒæœ€å°‘ä¸€ä¸ªworker \t}() for { // worker ä¿æŒè¿è¡Œ \tselect { case task, ok := \u0026lt;-p.chTask: // æ¥æ”¶task \tif !ok { // å½“ä»»åŠ¡é˜Ÿåˆ—è¢«å…³é—­æ˜¯goroutineé€€å‡º \treturn } task.Handler(task.Params...) // æ‰§è¡Œä»»åŠ¡ \t} } }() } åœ¨Putå‡½æ•°ä¸­ï¼Œæ¯å½“æ”¾å…¥ä¸€ä¸ªæ–°ä»»åŠ¡ä¹‹å‰ï¼Œéƒ½ä¼šç›´æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„workerï¼Œè¿™æ˜¾ç„¶ä¸ç”šåˆç†ï¼Œå› ä¸ºæ­¤æ—¶æ± ä¸­å¯èƒ½å­˜åœ¨ç©ºé—²çš„workerï¼Œåº”è®¾æ³•åˆ©ç”¨è¿™äº›ç©ºé—²çš„workerè€Œä¸æ˜¯åˆ›å»ºæ–°çš„workerã€‚\nå°è¯•ä¼˜åŒ–\nä¸€ç§ä¼˜åŒ–æ€è·¯æ˜¯ï¼šåœ¨Poolå¯¹è±¡ä¸­å¢åŠ chIdle chan struct{}å­—æ®µï¼Œä½œä¸ºç©ºé—²æ ‡å¿—ã€‚æ”¾å…¥ä»»åŠ¡ä¹‹å‰é¦–å…ˆæ£€æŸ¥chIdleæ˜¯å¦å­˜åœ¨ç©ºé—²æ ‡å¿—ï¼Œè‹¥å­˜åœ¨ï¼Œåˆ™è¯´æ˜æ­¤æ—¶å­˜åœ¨ç©ºé—²workerï¼Œä¸éœ€åˆ›å»ºæ–°çš„workerï¼Œåªéœ€å°†taskæ”¾å…¥å³å¯ã€‚ è€Œè‹¥chIdleä¸­ä¸å­˜åœ¨ç©ºé—²æ ‡å¿—ï¼Œåˆ™æ£€æŸ¥workeræ•°é‡æ˜¯å¦è¾¾åˆ°é™åˆ¶ï¼Œç„¶ååˆ›å»ºæ–°çš„workerã€‚ ä¼˜åŒ–åçš„æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š\ntype Pool struct { capacity uint64 runningWorkers uint64 status int64 chTask chan *Task chIdle chan struct{} PanicHandler func(interface{}) sync.Mutex } func (p *Pool) Put(task *Task) error { p.Lock() defer p.Unlock() if p.status == STOPED { return ErrPoolAlreadyClosed } select { case \u0026lt;-p.chIdle: default: if p.GetRunningWorkers() \u0026lt; p.GetCap() { p.run() } } // send task \tif p.status == RUNNING { p.chTask \u0026lt;- task } return nil } func (p *Pool) run() { p.incRunning() p.chIdle \u0026lt;- struct{}{} go func() { defer func() { p.decRunning() if r := recover(); r != nil { if p.PanicHandler != nil { p.PanicHandler(r) } else { log.Printf(\u0026#34;Worker panic: %s\\n\u0026#34;, r) } } p.checkWorker() // check worker avoid no worker running \t}() for { select { case task, ok := \u0026lt;-p.chTask: if !ok { return } task.Handler(task.Params...) p.chIdle \u0026lt;- struct{}{} } } }() } ä¼˜åŒ–å‰åbanchmarkæµ‹è¯•æ•°æ®å¯¹æ¯”å¦‚ä¸‹ï¼š\nä¼˜åŒ–å‰ï¼šBenchmarkPut-4 815876\t1460 ns/op\t0 B/op\t0 allocs/op ä¼˜åŒ–åï¼šBenchmarkPut-4 948046\t1323 ns/op\t0 B/op\t0 allocs/op ä¼˜åŒ–å‰: BenchmarkPutTimelife-4 1000000\t1287 ns/op\t0 B/op\t0 allocs/op ä¼˜åŒ–å: BenchmarkPutTimelife-4 930015\t1356 ns/op\t0 B/op\t0 allocs/op ä¼˜åŒ–å‰: BenchmarkPoolPutSetTimes-4 1\t1433118500 ns/op\t12104 B/op\t52 allocs/op ä¼˜åŒ–å: BenchmarkPoolPutSetTimes-4 1\t1474117300 ns/op\t8504 B/op\t42 allocs/op ä¼˜åŒ–å‰: BenchmarkPoolTimeLifeSetTimes-4 1\t1277515600 ns/op\t10208 B/op\t47 allocs/op ä¼˜åŒ–å: BenchmarkPoolTimeLifeSetTimes-4 1\t1279696300 ns/op\t7928 B/op\t39 allocs/op åŸºæœ¬ä½¿ç”¨\npackage main import ( \u0026#34;fmt\u0026#34; \u0026#34;sync\u0026#34; \u0026#34;github.com/wazsmwazsm/mortar\u0026#34; ) func main() { // åˆ›å»ºå®¹é‡ä¸º 10 çš„ä»»åŠ¡æ±  \tpool, err := mortar.NewPool(10) if err != nil { panic(err) } wg := new(sync.WaitGroup) for i := 0; i \u0026lt; 1000; i++ { wg.Add(1) // åˆ›å»ºä»»åŠ¡ \ttask := \u0026amp;mortar.Task{ Handler: func(v ...interface{}) { wg.Done() fmt.Println(v) }, } // æ·»åŠ ä»»åŠ¡å‡½æ•°çš„å‚æ•° \ttask.Params = []interface{}{i, i * 2, \u0026#34;hello\u0026#34;} // å°†ä»»åŠ¡æ”¾å…¥ä»»åŠ¡æ±  \tpool.Put(task) } wg.Add(1) // å†åˆ›å»ºä¸€ä¸ªä»»åŠ¡ \tpool.Put(\u0026amp;mortar.Task{ Handler: func(v ...interface{}) { wg.Done() fmt.Println(v) }, Params: []interface{}{\u0026#34;hi!\u0026#34;}, // ä¹Ÿå¯ä»¥åœ¨åˆ›å»ºä»»åŠ¡æ—¶è®¾ç½®å‚æ•° \t}) wg.Wait() // å®‰å…¨å…³é—­ä»»åŠ¡æ± ï¼ˆä¿è¯å·²åŠ å…¥æ± ä¸­çš„ä»»åŠ¡è¢«æ¶ˆè´¹å®Œï¼‰ \tpool.Close() // å¦‚æœä»»åŠ¡æ± å·²ç»å…³é—­, Put() æ–¹æ³•ä¼šè¿”å› ErrPoolAlreadyClosed é”™è¯¯ \terr = pool.Put(\u0026amp;mortar.Task{ Handler: func(v ...interface{}) {}, }) if err != nil { fmt.Println(err) // print: pool already closed \t} } æ€»ç»“ goroutineçš„å¤ç”¨å¾ˆå¥½çš„å‡å°äº†å¤§æ‰¹é‡å¼‚æ­¥ä»»åŠ¡ä¸­çš„å†…å­˜åˆ†é…ä¸åƒåœ¾å›æ”¶å‹åŠ›ï¼Œä½†ä¸èƒ½å›æ”¶çš„goroutineå¯èƒ½åœ¨ä»»åŠ¡æ³¢å³°è¿‡å»åæˆä¸ºå†…å­˜æµªè´¹ï¼ˆä¸æ’¤é”€æ± çš„æƒ…å†µä¸‹ï¼‰ï¼Œé€‚åˆç”¨äºé•¿æœŸå¤§è§„æ¨¡æ‰§è¡Œå¹¶å‘ä»»åŠ¡çš„æƒ…å†µä¸‹ã€‚\n2. go-playground/poolï¼ˆâ˜…614ï¼‰ ç®€å•ä»‹ç» æä¾›äº†LimitedPool,UnLimitedPoolä¸¤ç§æ± ï¼Œåˆ†åˆ«å¯ä»¥åˆ›å»º(workeræ•°é‡)æœ‰é™çš„workerå’Œæ— é™çš„workerï¼›æä¾›äº†Unit taskå’Œbatch Taskä¸¤ç§ä»»åŠ¡æ¨¡å¼ï¼Œåˆ†åˆ«é€‚ç”¨äºå•æ¬¡å¶å‘ä»»åŠ¡åŠå¤šæ¬¡é‡å¤ä»»åŠ¡ã€‚LimitedPool,UnLimitedPooléƒ½å®ç°äº†Poolæ¥å£ã€‚å¯é•¿æœŸä¿æŒè¿è¡Œã€‚\nç³»ç»Ÿç»“æ„\ntype Pool interface { Queue(fn WorkFunc) WorkUnit // ä¼ å…¥è¦æ‰§è¡Œçš„ä»»åŠ¡ï¼Œç«‹å³å¼€å§‹æ‰§è¡Œ \tReset() // é‡æ–°åˆå§‹åŒ–ä¸€ä¸ªæ±  \tCancel() // å–æ¶ˆæ‰€æœ‰æœªåœ¨è¿è¡Œçš„ä»»åŠ¡ \tClose() // æ¸…é™¤æ‰€æœ‰æ± æ•°æ®å¹¶å–æ¶ˆæ‰€æœ‰æœªæäº¤çš„ä»»åŠ¡ \tBatch() Batch // åˆ›å»ºæ‰¹é‡ä»»åŠ¡ } æ ¸å¿ƒä»£ç \n// passing work and cancel channels to newWorker() to avoid any potential race condition // betweeen p.work read \u0026amp; write func (p *limitedPool) newWorker(work chan *workUnit, cancel chan struct{}) { go func(p *limitedPool) { var wu *workUnit defer func(p *limitedPool) { if err := recover(); err != nil { // ... \t} }(p) var value interface{} var err error for { select { case wu = \u0026lt;-work: // possible for one more nilled out value to make it \t// through when channel closed, don\u0026#39;t quite understand the why \tif wu == nil { continue } // support for individual WorkUnit cancellation \t// and batch job cancellation \tif wu.cancelled.Load() == nil { value, err = wu.fn(wu) wu.writing.Store(struct{}{}) // need to check again in case the WorkFunc cancelled this unit of work \t// otherwise we\u0026#39;ll have a race condition \tif wu.cancelled.Load() == nil \u0026amp;\u0026amp; wu.cancelling.Load() == nil { wu.value, wu.err = value, err // who knows where the Done channel is being listened to on the other end \t// don\u0026#39;t want this to block just because caller is waiting on another unit \t// of work to be done first so we use close \tclose(wu.done) } } case \u0026lt;-cancel: return } } }(p) } // Queue queues the work to be run, and starts processing immediately func (p *limitedPool) Queue(fn WorkFunc) WorkUnit { w := \u0026amp;workUnit{ done: make(chan struct{}), fn: fn, } go func() { p.m.RLock() if p.closed { w.err = \u0026amp;ErrPoolClosed{s: errClosed} if w.cancelled.Load() == nil { close(w.done) } p.m.RUnlock() return } p.work \u0026lt;- w p.m.RUnlock() }() return w } åŸºæœ¬ä½¿ç”¨\n Per Unit Work\n package main import ( \u0026#34;fmt\u0026#34; \u0026#34;time\u0026#34; \u0026#34;gopkg.in/go-playground/pool.v3\u0026#34; ) func main() { p := pool.NewLimited(10) defer p.Close() user := p.Queue(getUser(13)) other := p.Queue(getOtherInfo(13)) user.Wait() if err := user.Error(); err != nil { // handle error \t} // do stuff with user \tusername := user.Value().(string) fmt.Println(username) other.Wait() if err := other.Error(); err != nil { // handle error \t} // do stuff with other \totherInfo := other.Value().(string) fmt.Println(otherInfo) } func getUser(id int) pool.WorkFunc { return func(wu pool.WorkUnit) (interface{}, error) { // simulate waiting for something, like TCP connection to be established \t// or connection from pool grabbed \ttime.Sleep(time.Second * 1) if wu.IsCancelled() { // return values not used \treturn nil, nil } // ready for processing...  return \u0026#34;Joeybloggs\u0026#34;, nil } } func getOtherInfo(id int) pool.WorkFunc { return func(wu pool.WorkUnit) (interface{}, error) { // simulate waiting for something, like TCP connection to be established \t// or connection from pool grabbed \ttime.Sleep(time.Second * 1) if wu.IsCancelled() { // return values not used \treturn nil, nil } // ready for processing...  return \u0026#34;Other Info\u0026#34;, nil } }  Batch Work\n package main import ( \u0026#34;fmt\u0026#34; \u0026#34;time\u0026#34; \u0026#34;gopkg.in/go-playground/pool.v3\u0026#34; ) func main() { p := pool.NewLimited(10) defer p.Close() batch := p.Batch() // for max speed Queue in another goroutine \t// but it is not required, just can\u0026#39;t start reading results \t// until all items are Queued.  go func() { for i := 0; i \u0026lt; 10; i++ { batch.Queue(sendEmail(\u0026#34;email content\u0026#34;)) } // DO NOT FORGET THIS OR GOROUTINES WILL DEADLOCK \t// if calling Cancel() it calles QueueComplete() internally \tbatch.QueueComplete() }() for email := range batch.Results() { if err := email.Error(); err != nil { // handle error \t// maybe call batch.Cancel() \t} // use return value \tfmt.Println(email.Value().(bool)) } } func sendEmail(email string) pool.WorkFunc { return func(wu pool.WorkUnit) (interface{}, error) { // simulate waiting for something, like TCP connection to be established \t// or connection from pool grabbed \ttime.Sleep(time.Second * 1) if wu.IsCancelled() { // return values not used \treturn nil, nil } // ready for processing...  return true, nil // everything ok, send nil, error if not \t} } æ€»ç»“ åŠŸèƒ½é½å…¨ï¼Œä½†å¥½åƒç”¨èµ·æ¥ä¸å¤ªèˆ’æœã€‚\n3. ivpusic/grpoolï¼ˆâ˜…634ï¼‰ ç®€å•ä»‹ç» ç”¨æˆ·å¯ä»¥æäº¤taskã€‚ Dispatcheræ¥å—taskï¼Œå¹¶å°†å…¶å‘é€ç»™ç¬¬ä¸€ä¸ªå¯ç”¨çš„workerã€‚ å½“workerå®Œæˆå¤„ç†å·¥ä½œæ—¶ï¼Œå°†è¿”å›åˆ°workers poolã€‚ workeræ•°é‡å’Œtaské˜Ÿåˆ—å¤§å°æ˜¯å¯é…ç½®çš„ã€‚\næ•´ä¸ªç¨‹åºä»¥ä¸€ä¸ªè°ƒåº¦å™¨ä¸ºæ ¸å¿ƒï¼ŒPoolé€šè¿‡è°ƒåº¦å™¨æ¥è°ƒåº¦workerï¼Œworkerå¯å¤ç”¨ï¼Œä½†ä»»åŠ¡ç»“æŸæ—¶workerä¸ä¼šè‡ªåŠ¨å›æ”¶ï¼Œä¸é€‚åˆé•¿æœŸè¿è¡Œã€‚åªèƒ½ä¼ é€’æ— å‚ä»»åŠ¡ã€‚\nç³»ç»Ÿç»“æ„\n// Gorouting instance which can accept client jobs type worker struct { workerPool chan *worker // å·¥äººæ±  \tjobChannel chan Job // è¿™ä¸ªworkerç‹¬æœ‰çš„ä»»åŠ¡é˜Ÿåˆ— \tstop chan struct{} } type dispatcher struct { workerPool chan *worker // ä¸workeræ˜¯åŒä¸€ä¸ªworkerPool \tjobQueue chan Job // ä¸æ± å…±æœ‰çš„ä»»åŠ¡é˜Ÿåˆ— \tstop chan struct{} } // Represents user request, function which should be executed in some worker. type Job func() type Pool struct { JobQueue chan Job // ä¸dispatcherå…±æœ‰çš„ä»»åŠ¡é˜Ÿåˆ— \tdispatcher *dispatcher wg sync.WaitGroup } æ ¸å¿ƒä»£ç \nfunc (w *worker) start() { go func() { // åˆ›å»ºäº†ä¸€ä¸ªworker \tvar job Job for { // worker free, add it to pool \tw.workerPool \u0026lt;- w // æŠŠworkeræ”¾å…¥workeræ±   select { case job = \u0026lt;-w.jobChannel: job() case \u0026lt;-w.stop: w.stop \u0026lt;- struct{}{} return } } }() } func (d *dispatcher) dispatch() { for { select { case job := \u0026lt;-d.jobQueue: worker := \u0026lt;-d.workerPool worker.jobChannel \u0026lt;- job case \u0026lt;-d.stop: // åœæ­¢æ‰€æœ‰worker \tfor i := 0; i \u0026lt; cap(d.workerPool); i++ { worker := \u0026lt;-d.workerPool worker.stop \u0026lt;- struct{}{} \u0026lt;-worker.stop } d.stop \u0026lt;- struct{}{} return } } } å…¶ç¨‹åºè¿è¡Œå›¾å¤§è‡´å¦‚ä¸‹ï¼š ç¨‹åºä¸­å­˜åœ¨ä¸€ä¸ªworkerPoolï¼Œæ‰€æœ‰çš„workeréƒ½å­˜åœ¨åœ¨è¿™ä¸ªæ± ä¸­ï¼Œåœ¨ç¨‹åºçš„å¼€å§‹ï¼Œä¼šåˆ›å»ºæŒ‡å®šæ•°ç›®çš„workerï¼Œä¸€æ¬¡æ€§æ”¾å…¥æ± ä¸­ï¼ˆæ­¤åä¸å†å¢åŠ æˆ–å‡å°‘ï¼‰ã€‚æ¯ä¸ªworkeræœ‰ä¸€ä¸ªç‹¬æœ‰çš„jobChannelï¼Œè¿™ä¸ªjobChannelå‘workerä¼ é€’å…¶è¦æ‰§è¡Œçš„ä»»åŠ¡ã€‚\nç”¨æˆ·é€šè¿‡ç›´æ¥ä½¿ç”¨Poolçš„JobQueueæ¥æäº¤ä»»åŠ¡ï¼Œæäº¤çš„ä»»åŠ¡ä¼šç”±dispatcheræ¥æ”¶ï¼Œç„¶ååˆ†é…ç»™æŸä¸ªç©ºé—²çš„workerï¼Œå³æ”¾å…¥å…¶jobChannelä¸­ã€‚\nåŸºæœ¬ä½¿ç”¨\npackage main import ( \u0026#34;fmt\u0026#34; \u0026#34;runtime\u0026#34; \u0026#34;time\u0026#34; \u0026#34;github.com/ivpusic/grpool\u0026#34; ) func main() { // number of workers, and size of job queue  pool := grpool.NewPool(100, 50) // release resources used by pool  defer pool.Release() // submit one or more jobs to pool  for i := 0; i \u0026lt; 10; i++ { count := i pool.JobQueue \u0026lt;- func() { fmt.Printf(\u0026#34;I am worker! Number %d\\n\u0026#34;, count) } } // dummy wait until jobs are finished  time.Sleep(1 * time.Second) } æ€§èƒ½æµ‹è¯•\næ€»ç»“ è®¾è®¡ç®€å•ï¼Œä»£ç ç®€æ´æ¸…æ™°ï¼Œä½†æ— panicæ¢å¤ï¼Œä¸èƒ½åŠ¨æ€æ‰©å®¹ï¼Œä»»åŠ¡ä¼ é€’ç®€é™‹ï¼Œæ„Ÿè§‰åƒæ˜¯ä¸€ä¸ªæœªå®Œæˆç‰ˆæœ¬çš„ä»»åŠ¡æ± \n4. Jeffail/tunnyï¼ˆâ˜…2.4kï¼‰ ç®€å•ä»‹ç» æœ‰ä¸¤ç§æ¨¡å¼ï¼Œç¬¬ä¸€ç§æ¨¡å¼åœ¨æ± åˆ›å»ºæ—¶å³æŒ‡å®šä»»åŠ¡ï¼Œæ± åˆ›å»ºå®Œæˆåä»»åŠ¡ä¸å¯æ›´æ”¹ï¼Œä½†å¯ä¼ å…¥ä¸åŒçš„å‚æ•°ï¼Œæœ‰è¿”å›å€¼ã€‚ç¬¬äºŒç§æ¨¡å¼åœ¨åˆ›å»ºæ—¶ä¸ç»™å®šä»»åŠ¡ï¼Œå¯åœ¨æ± åˆ›å»ºåè‡ªè¡ŒæŒ‡é…ä»»åŠ¡ï¼Œä½†åªå¯æ‰§è¡Œæ— å‚æ•°ä»»åŠ¡ä¸”æ— è¿”å›å€¼ã€‚æ”¯æŒè¶…æ—¶æœºåˆ¶ï¼Œå¦‚æœä»»åŠ¡è¶…è¿‡æ—¶é—´æœŸé™è¿˜æ²¡å®Œæˆï¼Œåˆ™ä¼šç»ˆæ­¢å¹¶è¿”å›é”™è¯¯ã€‚\nç³»ç»Ÿç»“æ„\ntype Pool struct { queuedJobs int64 // å½“å‰æŒ‚èµ·çš„ä»»åŠ¡æ•°  ctor func() Worker // åˆå§‹ä»»åŠ¡ \tworkers []*workerWrapper reqChan chan workRequest workerMut sync.Mutex } type workerWrapper struct { // è´Ÿè´£ç®¡ç†workerå’Œgoroutineçš„ç”Ÿå‘½å‘¨æœŸ \tworker Worker interruptChan chan struct{} // ä¸­æ­¢ä¿¡å·é€šé“ \treqChan chan\u0026lt;- workRequest // ç”¨äºå‘é€ä»»åŠ¡è¯·æ±‚ä¿¡å· \tcloseChan chan struct{} // é€€å‡ºä¿¡å·é€šé“ \tclosedChan chan struct{} // é€€å‡ºæ ‡å¿—é€šé“ } type workRequest struct { // ä»»åŠ¡è¯·æ±‚ä¿¡å· \tjobChan chan\u0026lt;- interface{} // ç”¨äºæ¥æ”¶ä»»åŠ¡ \tretChan \u0026lt;-chan interface{} // ç”¨äºè¿”å›ç»“æœ \tinterruptFunc func() } æ ¸å¿ƒä»£ç \nfunc (p *Pool) Process(payload interface{}) interface{} { // çœç•¥äº†éƒ¨åˆ†é”™è¯¯å¤„ç†ä»£ç  \trequest, open := \u0026lt;-p.reqChan request.jobChan \u0026lt;- payload payload, open = \u0026lt;-request.retChan // åŒæ­¥ç­‰å¾…ä»»åŠ¡å®Œæˆ \treturn payload } func (w *workerWrapper) run() { jobChan, retChan := make(chan interface{}), make(chan interface{}) defer func() { w.worker.Terminate() close(retChan) close(w.closedChan) }() for { // NOTE: Blocking here will prevent the worker from closing down. \tw.worker.BlockUntilReady() select { case w.reqChan \u0026lt;- workRequest{ // tunny.go:156 \tjobChan: jobChan, retChan: retChan, interruptFunc: w.interrupt, }: select { case payload := \u0026lt;-jobChan: // tunny.go: 161 \tresult := w.worker.Process(payload) select { case retChan \u0026lt;- result: // tunny.go: 163 \tcase \u0026lt;-w.interruptChan: w.interruptChan = make(chan struct{}) } case _, _ = \u0026lt;-w.interruptChan: w.interruptChan = make(chan struct{}) } case \u0026lt;-w.closeChan: return } } } æ ¹æ®ä»¥ä¸Šä»£ç ï¼Œå…¶ä¸»è¦æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š\n æŸä¸ªgoroutineç©ºé—²åï¼Œé€šè¿‡å…¶reqChané€šé“å‘é€workRequestã€‚workRequestä¸­åŒ…æ‹¬ä¸€ä¸ªjobChanï¼Œç”¨äºç”Ÿäº§è€…å‘é€ä»»åŠ¡ï¼›ä¸€ä¸ªretChanï¼Œç”¨äºè¿”å›æ‰§è¡Œç»“æœï¼›ä¸€ä¸ªinterrupt Funcï¼Œç”¨äºä»»åŠ¡æ‰§è¡Œè¶…æ—¶æ—¶å¼ºè¡Œåœæ­¢workerã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒreqChanæ˜¯æ± å’ŒworkerWrapperå…±æœ‰çš„ï¼Œå› æ­¤å‘é€çš„workRequestå¯ç›´æ¥è¢«æ± æ¥æ”¶åˆ°ã€‚ æ¯å½“æ± ä¸­æœ‰æ–°ä»»åŠ¡æ—¶ï¼Œæ± å°è¯•ä»reqChanä¸­è·å–ä¸€ä¸ªworkRequestï¼Œè‹¥è·å–åˆ°ï¼Œåˆ™å°†ä»»åŠ¡é€šè¿‡workRequestæŒæœ‰çš„jobChan(å³æŸä¸ªworkeræŒæœ‰çš„jobChan)å‘é€åˆ°worker å‘é€å®Œæ¯•åï¼ŒåŒæ­¥çš„ä»retChanä¸­è¯»å–ç»“æœã€‚ è‹¥è®¾ç½®äº†è¶…æ—¶æ—¶é—´ï¼Œåˆ™åœ¨æ—¶é—´è¶…æ—¶åä¼šå¼ºåˆ¶åœæ­¢  åŸºæœ¬ä½¿ç”¨\npackage main import ( \u0026#34;io/ioutil\u0026#34; \u0026#34;net/http\u0026#34; \u0026#34;runtime\u0026#34; \u0026#34;github.com/Jeffail/tunny\u0026#34; ) func main() { numCPUs := runtime.NumCPU() pool := tunny.NewFunc(numCPUs, func(payload interface{}) interface{} { var result []byte // TODO: Something CPU heavy with payload  return result }) defer pool.Close() http.HandleFunc(\u0026#34;/work\u0026#34;, func(w http.ResponseWriter, r *http.Request) { input, err := ioutil.ReadAll(r.Body) if err != nil { http.Error(w, \u0026#34;Internal error\u0026#34;, http.StatusInternalServerError) } defer r.Body.Close() // Funnel this work into our pool. This call is synchronous and will \t// block until the job is completed. \tresult := pool.Process(input) w.Write(result.([]byte)) }) http.ListenAndServe(\u0026#34;:8080\u0026#34;, nil) }  è¶…æ—¶æ¼”ç¤ºï¼š\n func main() { p := tunny.NewFunc(4, func(payload interface{}) interface{} { n := payload.(int) result := fib(n) time.Sleep(5 * time.Second) return result }) defer p.Close() var wg sync.WaitGroup wg.Add(4) for i := 0; i \u0026lt; 4; i++ { go func(i int) { n := rand.Intn(30) result, err := p.ProcessTimed(n, time.Second) nowStr := time.Now().Format(\u0026#34;2006-01-02 15:04:05\u0026#34;) if err != nil { fmt.Printf(\u0026#34;[%s]task(%d) failed:%v\\n\u0026#34;, nowStr, i, err) } else { fmt.Printf(\u0026#34;[%s]fib(%d) = %d\\n\u0026#34;, nowStr, n, result) } wg.Done() }(i) } wg.Wait() } func fib(n int) int { if n \u0026lt;= 1 { return 1 } return fib(n-1) + fib(n-2) } 5. panjf2000/antsï¼ˆâ˜…5.8kï¼‰ ç®€å•ä»‹ç» å¯åŠ¨æœåŠ¡ä¹‹æ—¶å…ˆåˆå§‹åŒ–ä¸€ä¸ª Goroutine Pool æ± ï¼Œè¿™ä¸ª Pool ç»´æŠ¤äº†ä¸€ä¸ªç±»ä¼¼æ ˆçš„ LIFO é˜Ÿåˆ— ï¼Œé‡Œé¢å­˜æ”¾è´Ÿè´£å¤„ç†ä»»åŠ¡çš„ Workerï¼Œç„¶ååœ¨ client ç«¯æäº¤ task åˆ° Pool ä¸­ä¹‹åï¼Œåœ¨ Pool å†…éƒ¨ï¼Œæ¥æ”¶ task ä¹‹åçš„æ ¸å¿ƒæ“ä½œæ˜¯ï¼š\n æ£€æŸ¥å½“å‰ Worker é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰å¯ç”¨çš„ Workerï¼Œå¦‚æœæœ‰ï¼Œå–å‡ºæ‰§è¡Œå½“å‰çš„ taskï¼› æ²¡æœ‰å¯ç”¨çš„ Workerï¼Œåˆ¤æ–­å½“å‰åœ¨è¿è¡Œçš„ Worker æ˜¯å¦å·²è¶…è¿‡è¯¥ Pool çš„å®¹é‡ï¼š{æ˜¯ â€”\u0026gt; å†åˆ¤æ–­å·¥ä½œæ± æ˜¯å¦ä¸ºéé˜»å¡æ¨¡å¼ï¼š[æ˜¯ â€”â€”\u0026gt; ç›´æ¥è¿”å› nilï¼Œå¦ â€”â€”\u0026gt; é˜»å¡ç­‰å¾…ç›´è‡³æœ‰ Worker è¢«æ”¾å› Pool]ï¼Œå¦ â€”\u0026gt; æ–°å¼€ä¸€ä¸ª Workerï¼ˆgoroutineï¼‰å¤„ç†}ï¼› æ¯ä¸ª Worker æ‰§è¡Œå®Œä»»åŠ¡ä¹‹åï¼Œæ”¾å› Pool çš„é˜Ÿåˆ—ä¸­ç­‰å¾…ã€‚  å¤§è‡´æµç¨‹å¦‚ä¸‹ï¼š è¿™ä¸ªåº“çš„äº®ç‚¹ä¹‹ä¸€æ˜¯å…¶ä¸ºæ¯ä¸€ä¸ªworkerè®¾ç½®äº†è¿‡æœŸæ—¶é—´ï¼Œè‹¥workerç©ºé—²äº†ä¸€å®šæ—¶é—´å°±ä¼šè¢«å›æ”¶ï¼Œå¾ˆå¥½çš„èŠ‚çº¦äº†èµ„æºã€‚\nç³»ç»Ÿç»“æ„\ntype Pool struct { capacity int32 // æ± çš„å®¹é‡  running int32 // æ­£åœ¨è¿è¡Œçš„worker  workers workerArray // å­˜å‚¨å¯è·å–çš„worker  state int32 // æ± çš„çŠ¶æ€  lock sync.Locker cond *sync.Cond // æ¡ä»¶å˜é‡ï¼Œç”¨äºåœ¨æ¡ä»¶æ»¡è¶³æ—¶å”¤é†’é˜»å¡çš„ç¨‹åº  workerCache sync.Pool blockingNum int // è¢«é˜»å¡çš„æ•°é‡  options *Options } type workerArray interface { len() int isEmpty() bool insert(worker *goWorker) error detach() *goWorker retrieveExpiry(duration time.Duration) []*goWorker reset() } type goWorker struct { pool *Pool task chan func() recycleTime time.Time // recycleTime will be update when putting a worker back into queue } æ ¸å¿ƒä»£ç \nfunc NewPool(size int, options ...Option) (*Pool, error) { if expiry := opts.ExpiryDuration; expiry \u0026lt; 0 { return nil, ErrInvalidPoolExpiry } else if expiry == 0 { opts.ExpiryDuration = DefaultCleanIntervalTime } p := \u0026amp;Pool{ capacity: int32(size), lock: internal.NewSpinLock(), options: opts, } p.workerCache.New = func() interface{} { return \u0026amp;goWorker{ pool: p, task: make(chan func(), workerChanCap), } } if p.options.PreAlloc { if size == -1 { return nil, ErrInvalidPreAllocSize } p.workers = newWorkerArray(loopQueueType, size) } else { p.workers = newWorkerArray(stackType, 0) } p.cond = sync.NewCond(p.lock) // Start a goroutine to clean up expired workers periodically. \tgo p.purgePeriodically() // ç”¨ä¸€ä¸ªç‹¬ç«‹çš„goroutineæ¥å›æ”¶è¿‡æœŸçš„worker  return p, nil } func (w *goWorker) run() { w.pool.incRunning() go func() { defer func() { w.pool.decRunning() w.pool.workerCache.Put(w) if p := recover(); p != nil { // ... \t} // Call Signal() here in case there are goroutine waiting for available workers. \tw.pool.cond.Signal() // å‘å‡ºä¿¡å·å”¤é†’æŸäº›é˜»å¡ç­‰å¾…workerçš„çº¿ç¨‹ \t}() for f := range w.task { if f == nil { return } f() if ok := w.pool.revertWorker(w); !ok { // å°†workeré‡æ–°æ”¾å…¥æ± ä¸­å¾ªç¯åˆ©ç”¨ \treturn } } }() } // è¿”å›ä¸€ä¸ªå¯ç”¨çš„worker func (p *Pool) retrieveWorker() (w *goWorker) { spawnWorker := func() { // è¿”å›ä¸€ä¸ªå¯ç”¨çš„worker \tw = p.workerCache.Get().(*goWorker) w.run() } p.lock.Lock() w = p.workers.detach() // å°è¯•ä»workeré˜Ÿåˆ—ä¸­å–worker \tif w != nil { // ä»é˜Ÿåˆ—ä¸­è·å¾—äº†workerï¼Œç›´æ¥è¿”å› \tp.lock.Unlock() } else if capacity := p.Cap(); capacity == -1 || capacity \u0026gt; p.Running() { // é˜Ÿåˆ—ä¸ºç©ºå…¶workeræ•°é‡æœªè¾¾åˆ°é™åˆ¶ï¼Œåˆ™ç”Ÿæˆæ–°çš„worker \tp.lock.Unlock() spawnWorker() } else { // é˜Ÿåˆ—ä¸ºç©ºä¸”æ•°é‡è¾¾åˆ°é™åˆ¶ï¼Œåˆ™é˜»å¡ç­‰å¾…å…¶ä»–workerç©ºé—² \tif p.options.Nonblocking { p.lock.Unlock() return } retry: if p.options.MaxBlockingTasks != 0 \u0026amp;\u0026amp; p.blockingNum \u0026gt;= p.options.MaxBlockingTasks { p.lock.Unlock() return } p.blockingNum++ p.cond.Wait() // é˜»å¡ç­‰å¾…å¯ç”¨çš„worker \tp.blockingNum-- var nw int if nw = p.Running(); nw == 0 { // awakened by the scavenger \tp.lock.Unlock() if !p.IsClosed() { spawnWorker() } return } if w = p.workers.detach(); w == nil { if nw \u0026lt; capacity { p.lock.Unlock() spawnWorker() return } goto retry } p.lock.Unlock() } return } // å®šæ—¶æ¸…ç†è¿‡æœŸworker // purgePeriodically clears expired workers periodically which runs in an individual goroutine, as a scavenger. func (p *Pool) purgePeriodically() { heartbeat := time.NewTicker(p.options.ExpiryDuration) defer heartbeat.Stop() for range heartbeat.C { if p.IsClosed() { break } p.lock.Lock() expiredWorkers := p.workers.retrieveExpiry(p.options.ExpiryDuration) p.lock.Unlock() // Notify obsolete workers to stop. \t// This notification must be outside the p.lock, since w.task \t// may be blocking and may consume a lot of time if many workers \t// are located on non-local CPUs. \tfor i := range expiredWorkers { expiredWorkers[i].task \u0026lt;- nil expiredWorkers[i] = nil } // There might be a situation that all workers have been cleaned up(no any worker is running) \t// while some invokers still get stuck in \u0026#34;p.cond.Wait()\u0026#34;, \t// then it ought to wake all those invokers. \tif p.Running() == 0 { p.cond.Broadcast() } } } func (wq *workerStack) retrieveExpiry(duration time.Duration) []*goWorker { n := wq.len() if n == 0 { return nil } expiryTime := time.Now().Add(-duration) index := wq.binarySearch(0, n-1, expiryTime) wq.expiry = wq.expiry[:0] if index != -1 { wq.expiry = append(wq.expiry, wq.items[:index+1]...) m := copy(wq.items, wq.items[index+1:]) for i := m; i \u0026lt; n; i++ { wq.items[i] = nil } wq.items = wq.items[:m] } return wq.expiry } åŸºæœ¬ä½¿ç”¨\npackage main import ( \u0026#34;fmt\u0026#34; \u0026#34;sync\u0026#34; \u0026#34;sync/atomic\u0026#34; \u0026#34;time\u0026#34; \u0026#34;github.com/panjf2000/ants/v2\u0026#34; ) var sum int32 func myFunc(i interface{}) { n := i.(int32) atomic.AddInt32(\u0026amp;sum, n) fmt.Printf(\u0026#34;run with %d\\n\u0026#34;, n) } func demoFunc() { time.Sleep(10 * time.Millisecond) fmt.Println(\u0026#34;Hello World!\u0026#34;) } func main() { defer ants.Release() runTimes := 1000 // Use the common pool. \tvar wg sync.WaitGroup syncCalculateSum := func() { demoFunc() wg.Done() } for i := 0; i \u0026lt; runTimes; i++ { wg.Add(1) _ = ants.Submit(syncCalculateSum) } wg.Wait() fmt.Printf(\u0026#34;running goroutines: %d\\n\u0026#34;, ants.Running()) fmt.Printf(\u0026#34;finish all tasks.\\n\u0026#34;) // Use the pool with a function, \t// set 10 to the capacity of goroutine pool and 1 second for expired duration. \tp, _ := ants.NewPoolWithFunc(10, func(i interface{}) { myFunc(i) wg.Done() }) defer p.Release() // Submit tasks one by one. \tfor i := 0; i \u0026lt; runTimes; i++ { wg.Add(1) _ = p.Invoke(int32(i)) } wg.Wait() fmt.Printf(\u0026#34;running goroutines: %d\\n\u0026#34;, p.Running()) fmt.Printf(\u0026#34;finish all tasks, result is %d\\n\u0026#34;, sum) } References Javaçº¿ç¨‹æ± å®ç°åŸç†åŠå…¶åœ¨ç¾å›¢ä¸šåŠ¡ä¸­çš„å®è·µ æ–°æ‰‹ä¸€çœ‹å°±æ‡‚çš„çº¿ç¨‹æ± ï¼ çº¿ç¨‹æ± å­¦ä¹ çœ‹è¿™ç¯‡å°±å¤Ÿäº†,ä¸‡å­—æ€»ç»“çº¿ç¨‹æ± !!! Golangä¸­çš„goroutineæ³„æ¼é—®é¢˜ è·Ÿè¯»è€…èŠ Goroutine æ³„éœ²çš„ N ç§æ–¹æ³•ï¼ŒçœŸåˆºæ¿€ï¼ å¦‚ä½•é˜²æ­¢ goroutine æ³„éœ² æŠ€æœ¯è§£æç³»åˆ— | PouchContainer Goroutine Leak æ£€æµ‹å®è·µ goroutineæ³„éœ²ï¼šåŸç†ã€åœºæ™¯ã€æ£€æµ‹å’Œé˜²èŒƒ Goè¯­è¨€é‡ç”Ÿgoroutineçš„å¤„ç† goroutine åˆ°åº•è¯¥æ€ä¹ˆç”¨ å¦‚ä½•æŸ¥çœ‹golangç¨‹åºä¸­æœ‰å“ªäº›goroutine æ­£åœ¨æ‰§è¡Œ Go è¯­è¨€è¸©å‘è®°â€”â€”panic ä¸ recover Handling panics in go routines INSTRUMENTING A GO APPLICATION FOR PROMETHEUS Package pprof Handling 1 Million Requests per Minute with Go Go by Example: Worker Pools Golang : Creating a concurrent worker pool Work Queue Systems The Case For A Go Worker Pool Buffered Channels and Worker Pools\n","permalink":"http://yangchnet.github.io/Dessert/posts/golang/%E9%87%8E%E7%94%9Fgoroutine%E5%B8%A6%E6%9D%A5%E7%9A%84%E9%97%AE%E9%A2%98%E5%8F%8A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/","summary":"ä¸€ã€é‡ç”Ÿgoroutineçš„é—®é¢˜  å¼•è¨€ï¼š æ¯‹åº¸ç½®ç–‘ï¼ŒgolangåŸç”Ÿçš„goroutineæå¤§é™ä½äº†ç¨‹åºå‘˜ä½¿ç”¨å¹¶å‘ç¼–ç¨‹çš„ä»£ä»·ï¼Œç¨‹åºå‘˜ä»¬ä¸éœ€è¦å†å»å…³å¿ƒå¦‚ä½•å®ç°æ¥å£ã€å¦‚ä½•ç»§æ‰¿Threadç±»ç­‰å¤šä½™çš„æ“ä½œï¼Œåªéœ€è¦ç®€ç®€å•å•çš„go, å°±å¯ä»¥å¼€å¯ä¸€ä¸ªå¹¶å‘çš„åç¨‹ã€‚ä½†è¿™ç§ç®€å•çš„ä½¿ç”¨æ–¹å¼åŒæ—¶ä¹Ÿå¸¦æ¥ä¸€äº›é—®é¢˜ï¼Œè¿™äº›goroutineä¸å†å—æˆ‘ä»¬æ§åˆ¶äº†ï¼Œå®ƒä»¬åœ¨è¿è¡Œæ—¶å¯èƒ½ä¼šå‘ç”Ÿä»»ä½•é”™è¯¯æˆ–æ„å¤–ï¼Œè€Œæˆ‘ä»¬æ— æ³•å¾—çŸ¥æˆ–å»å¤„ç†è¿™äº›æ„å¤–ã€‚æˆ‘ä»¬å°†å¯åŠ¨åä¸å†å—ä¸»è¿›ç¨‹æ§åˆ¶çš„goroutineç§°ä¸ºé‡ç”Ÿgoroutineï¼Œæœ¬èŠ‚å°†ä»‹ç»é‡ç”Ÿgoroutineå­˜åœ¨çš„ä¸€äº›é—®é¢˜å¹¶ä»‹ç»ä¸€äº›ç®€å•çš„è§£å†³æ–¹æ³•ã€‚\n 1. goroutineä¸­panicæ— æ³•æ¢å¤ æ­£å¸¸çš„å‡½æ•°ä¸­panicçš„recover\nimport ( \u0026#34;fmt\u0026#34; ) func main(){ defer func(){ if err := recover(); err != nil{ fmt.Println(err) } }() var bar = []int{1} fmt.Println(bar[1]) } reflect: slice index out of range goroutineä¸­panicçš„æ¢å¤\nfunc main(){ defer func(){ if err := recover(); err != nil { // åœ¨è¿™é‡Œä½¿ç”¨recover(),ä¸èƒ½æ•è·panic \tfmt.Println(\u0026#34;catch you, bad guy\u0026#34;) } }() go func(){ fmt.Println(\u0026#34;I\u0026#39;m in a goroutine\u0026#34;) panic(\u0026#34;come to catch me\u0026#34;) }() time.","title":"é‡ç”ŸGoroutineå¸¦æ¥çš„é—®é¢˜åŠå¯¹åº”è§£å†³æ–¹æ¡ˆ"},{"content":"1. å‰åå°åˆ‡æ¢  åœ¨Linuxç»ˆç«¯è¿è¡Œå‘½ä»¤çš„æ—¶å€™ï¼Œåœ¨å‘½ä»¤æœ«å°¾åŠ ä¸Š \u0026amp; ç¬¦å·ï¼Œå°±å¯ä»¥è®©ç¨‹åºåœ¨åå°è¿è¡Œ  $ ./main \u0026amp;  å¦‚æœç¨‹åºæ­£åœ¨å‰å°è¿è¡Œï¼Œå¯ä»¥ä½¿ç”¨ Ctrl+z é€‰é¡¹æŠŠç¨‹åºæš‚åœï¼Œç„¶åç”¨ bg %[number] å‘½ä»¤æŠŠè¿™ä¸ªç¨‹åºæ”¾åˆ°åå°è¿è¡Œï¼Œæ‘Ctrl+zï¼Œç„¶ååœ¨æœ€åä¸€è¡ŒåŠ ä¸Šbg %number\n  å¯¹äºæ‰€æœ‰è¿è¡Œçš„ç¨‹åºï¼Œæˆ‘ä»¬å¯ä»¥ç”¨jobs â€“l æŒ‡ä»¤æŸ¥çœ‹\n  $ jobs -l ä¹Ÿå¯ä»¥ç”¨ fg %[number] æŒ‡ä»¤æŠŠä¸€ä¸ªç¨‹åºæ‰åˆ°å‰å°  $ fg %1 ä¹Ÿå¯ä»¥ç›´æ¥ç»ˆæ­¢åå°è¿è¡Œçš„ç¨‹åºï¼Œä½¿ç”¨ kill å‘½ä»¤  $ kill %1 2. fgã€bgã€jobsã€\u0026amp;ã€nohupã€ctrl+zã€ctrl+c å‘½ä»¤  \u0026amp; åŠ åœ¨ä¸€ä¸ªå‘½ä»¤çš„æœ€åï¼Œå¯ä»¥æŠŠè¿™ä¸ªå‘½ä»¤æ”¾åˆ°åå°æ‰§è¡Œï¼Œå¦‚  watch -n 10 sh test.sh \u0026amp; #æ¯10såœ¨åå°æ‰§è¡Œä¸€æ¬¡test.shè„šæœ¬  ctrl + z å¯ä»¥å°†ä¸€ä¸ªæ­£åœ¨å‰å°æ‰§è¡Œçš„å‘½ä»¤æ”¾åˆ°åå°ï¼Œå¹¶ä¸”å¤„äºæš‚åœçŠ¶æ€ã€‚\n  jobs æŸ¥çœ‹å½“å‰æœ‰å¤šå°‘åœ¨åå°è¿è¡Œçš„å‘½ä»¤ jobs -lé€‰é¡¹å¯æ˜¾ç¤ºæ‰€æœ‰ä»»åŠ¡çš„PIDï¼Œjobsçš„çŠ¶æ€å¯ä»¥æ˜¯running, stopped, Terminatedã€‚ä½†æ˜¯å¦‚æœä»»åŠ¡è¢«ç»ˆæ­¢äº†ï¼ˆkillï¼‰ï¼Œshell ä»å½“å‰çš„shellç¯å¢ƒå·²çŸ¥çš„åˆ—è¡¨ä¸­åˆ é™¤ä»»åŠ¡çš„è¿›ç¨‹æ ‡è¯†ã€‚\n  fg å°†åå°ä¸­çš„å‘½ä»¤è°ƒè‡³å‰å°ç»§ç»­è¿è¡Œã€‚å¦‚æœåå°ä¸­æœ‰å¤šä¸ªå‘½ä»¤ï¼Œå¯ä»¥ç”¨fg %jobnumberï¼ˆæ˜¯å‘½ä»¤ç¼–å·ï¼Œä¸æ˜¯è¿›ç¨‹å·ï¼‰å°†é€‰ä¸­çš„å‘½ä»¤è°ƒå‡ºã€‚\n  bg å°†ä¸€ä¸ªåœ¨åå°æš‚åœçš„å‘½ä»¤ï¼Œå˜æˆåœ¨åå°ç»§ç»­æ‰§è¡Œã€‚å¦‚æœåå°ä¸­æœ‰å¤šä¸ªå‘½ä»¤ï¼Œå¯ä»¥ç”¨bg %jobnumberå°†é€‰ä¸­çš„å‘½ä»¤è°ƒå‡ºã€‚\n  kill\n   é€šè¿‡jobså‘½ä»¤æŸ¥çœ‹jobå·ï¼ˆå‡è®¾ä¸ºnumï¼‰ï¼Œç„¶åæ‰§è¡Œkill %num é€šè¿‡pså‘½ä»¤æŸ¥çœ‹jobçš„è¿›ç¨‹å·ï¼ˆPIDï¼Œå‡è®¾ä¸ºpidï¼‰ï¼Œç„¶åæ‰§è¡Œkill pid å‰å°è¿›ç¨‹çš„ç»ˆæ­¢ï¼šCtrl+c  nohup å¦‚æœè®©ç¨‹åºå§‹ç»ˆåœ¨åå°æ‰§è¡Œï¼Œå³ä½¿å…³é—­å½“å‰çš„ç»ˆç«¯ä¹Ÿæ‰§è¡Œï¼ˆä¹‹å‰çš„\u0026amp;åšä¸åˆ°ï¼‰ï¼Œè¿™æ—¶å€™éœ€è¦nohupã€‚è¯¥å‘½ä»¤å¯ä»¥åœ¨ä½ é€€å‡ºå¸æˆ·/å…³é—­ç»ˆç«¯ä¹‹åç»§ç»­è¿è¡Œç›¸åº”çš„è¿›ç¨‹ã€‚å…³é—­ä¸­æ–­åï¼Œåœ¨å¦ä¸€ä¸ªç»ˆç«¯jobså·²ç»æ— æ³•çœ‹åˆ°åå°è·‘å¾—ç¨‹åºäº†ï¼Œæ­¤æ—¶åˆ©ç”¨psï¼ˆè¿›ç¨‹æŸ¥çœ‹å‘½ä»¤ï¼‰  $ ps -aux | grep â€œtest.shâ€ #a:æ˜¾ç¤ºæ‰€æœ‰ç¨‹åº u:ä»¥ç”¨æˆ·ä¸ºä¸»çš„æ ¼å¼æ¥æ˜¾ç¤º x:æ˜¾ç¤ºæ‰€æœ‰ç¨‹åºï¼Œä¸ä»¥ç»ˆç«¯æœºæ¥åŒºåˆ† æŸ¥çœ‹nohup.outçš„æ—¥å¿—  $ tail -fn 50 nohup.out  è½¬è‡ªï¼šLinuxç¨‹åºå‰å°åå°åˆ‡æ¢\n ","permalink":"http://yangchnet.github.io/Dessert/posts/linux/linux%E7%A8%8B%E5%BA%8F%E5%89%8D%E5%8F%B0%E5%90%8E%E5%8F%B0%E5%88%87%E6%8D%A2/","summary":"1. å‰åå°åˆ‡æ¢  åœ¨Linuxç»ˆç«¯è¿è¡Œå‘½ä»¤çš„æ—¶å€™ï¼Œåœ¨å‘½ä»¤æœ«å°¾åŠ ä¸Š \u0026amp; ç¬¦å·ï¼Œå°±å¯ä»¥è®©ç¨‹åºåœ¨åå°è¿è¡Œ  $ ./main \u0026amp;  å¦‚æœç¨‹åºæ­£åœ¨å‰å°è¿è¡Œï¼Œå¯ä»¥ä½¿ç”¨ Ctrl+z é€‰é¡¹æŠŠç¨‹åºæš‚åœï¼Œç„¶åç”¨ bg %[number] å‘½ä»¤æŠŠè¿™ä¸ªç¨‹åºæ”¾åˆ°åå°è¿è¡Œï¼Œæ‘Ctrl+zï¼Œç„¶ååœ¨æœ€åä¸€è¡ŒåŠ ä¸Šbg %number\n  å¯¹äºæ‰€æœ‰è¿è¡Œçš„ç¨‹åºï¼Œæˆ‘ä»¬å¯ä»¥ç”¨jobs â€“l æŒ‡ä»¤æŸ¥çœ‹\n  $ jobs -l ä¹Ÿå¯ä»¥ç”¨ fg %[number] æŒ‡ä»¤æŠŠä¸€ä¸ªç¨‹åºæ‰åˆ°å‰å°  $ fg %1 ä¹Ÿå¯ä»¥ç›´æ¥ç»ˆæ­¢åå°è¿è¡Œçš„ç¨‹åºï¼Œä½¿ç”¨ kill å‘½ä»¤  $ kill %1 2. fgã€bgã€jobsã€\u0026amp;ã€nohupã€ctrl+zã€ctrl+c å‘½ä»¤  \u0026amp; åŠ åœ¨ä¸€ä¸ªå‘½ä»¤çš„æœ€åï¼Œå¯ä»¥æŠŠè¿™ä¸ªå‘½ä»¤æ”¾åˆ°åå°æ‰§è¡Œï¼Œå¦‚  watch -n 10 sh test.sh \u0026amp; #æ¯10såœ¨åå°æ‰§è¡Œä¸€æ¬¡test.shè„šæœ¬  ctrl + z å¯ä»¥å°†ä¸€ä¸ªæ­£åœ¨å‰å°æ‰§è¡Œçš„å‘½ä»¤æ”¾åˆ°åå°ï¼Œå¹¶ä¸”å¤„äºæš‚åœçŠ¶æ€ã€‚\n  jobs æŸ¥çœ‹å½“å‰æœ‰å¤šå°‘åœ¨åå°è¿è¡Œçš„å‘½ä»¤ jobs -lé€‰é¡¹å¯æ˜¾ç¤ºæ‰€æœ‰ä»»åŠ¡çš„PIDï¼Œjobsçš„çŠ¶æ€å¯ä»¥æ˜¯running, stopped, Terminatedã€‚ä½†æ˜¯å¦‚æœä»»åŠ¡è¢«ç»ˆæ­¢äº†ï¼ˆkillï¼‰ï¼Œshell ä»å½“å‰çš„shellç¯å¢ƒå·²çŸ¥çš„åˆ—è¡¨ä¸­åˆ é™¤ä»»åŠ¡çš„è¿›ç¨‹æ ‡è¯†ã€‚","title":"Linuxç¨‹åºå‰å°åå°åˆ‡æ¢"},{"content":"1. çº¿ç¨‹æ± åŸºç¡€ 1.1 é‡ç”Ÿçº¿ç¨‹ åœ¨æˆ‘ä»¬å¹³å¸¸çš„å¼€å‘ä¸­ï¼Œç»å¸¸ä¼šæœ‰ç”¨åˆ°å¤šçº¿ç¨‹çš„åœºæ™¯ï¼Œåˆç†åˆ©ç”¨å¤šçº¿ç¨‹å¯æœ‰æ•ˆåˆ©ç”¨CPUçš„å¤šæ ¸ç»“æ„ï¼Œæé«˜ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ã€‚æœ‰è¿™æ ·ä¸€ç§çº¿ç¨‹ï¼šæˆ‘ä»¬åˆ©ç”¨å…¶å®Œæˆä¸€äº›å·¥ä½œï¼Œä½†åªæ˜¯å°†å·¥ä½œäº¤ç»™è¿™ä¸ªçº¿ç¨‹ï¼Œè¯¥çº¿ç¨‹å¹¶ä¸ä¿è¯å®Œæˆä»»åŠ¡ï¼Œä¹Ÿä¸ä¿è¯æ­£å¸¸é€€å‡ºï¼Œå¹¶ä¸”åœ¨çº¿ç¨‹å¼€å§‹è¿è¡Œåæˆ‘ä»¬æ— æ³•å¯¹å…¶è¿›è¡Œæ§åˆ¶ã€‚è¿™ç§çŠ¶æ€å¯ç§°ä¸ºï¼šé‡ç”Ÿçº¿ç¨‹ï¼Œæ„ä¸ºå…¶å·²ç»ä¸å—æ§åˆ¶ï¼Œåœ¨å†…å­˜ä¸­è‡ªç”±è¿è¡Œã€‚\nè¿™ç§çº¿ç¨‹å¯èƒ½å¸¦æ¥ä¸€ç³»åˆ—é—®é¢˜ï¼š\n é¢‘ç¹ç”³è¯·/é”€æ¯çº¿ç¨‹ï¼Œå¯èƒ½å¸¦æ¥å·¨å¤§çš„é¢å¤–æ¶ˆè€— å½“å†…å­˜ä¸­å­˜åœ¨è¾ƒå¤šçš„é‡ç”Ÿçº¿ç¨‹ï¼Œä¼šå¯¼è‡´è¿‡åˆ†è°ƒåº¦ï¼Œé™ä½ç³»ç»Ÿæ€§èƒ½ ä¸èƒ½æ­£å¸¸é€€å‡ºçš„çº¿ç¨‹ä¼šå¯¼è‡´å†…å­˜æ³„éœ² ç³»ç»Ÿæ— æ³•åˆç†ç®¡ç†å†…éƒ¨çš„èµ„æºåˆ†å¸ƒï¼Œä¼šé™ä½ç³»ç»Ÿçš„ç¨³å®šæ€§ â€¦â€¦  é‰´äºä»¥ä¸Šé‡ç”Ÿçº¿ç¨‹å¸¦æ¥çš„é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹å¼å°†å…¶ç®¡ç†èµ·æ¥ï¼Œä½¿å…¶ä»é‡ç”Ÿçš„çº¿ç¨‹å˜æˆ\u0026quot;å®¶å…»\u0026quot;çš„çº¿ç¨‹ã€‚\n1.2 ä»€ä¹ˆæ˜¯çº¿ç¨‹æ±   æ± åŒ–ï¼šæ± åŒ–æ˜¯ä¸€ç§å°†èµ„æºç»Ÿä¸€è¿›è¡Œç®¡ç†ï¼Œä»è€Œæœ€å¤§åŒ–æ”¶ç›Šå¹¶æœ€å°åŒ–é£é™©çš„æ€æƒ³ã€‚\n çº¿ç¨‹æ± ç»´æŠ¤è‹¥å¹²ä¸ªçº¿ç¨‹ï¼Œåœ¨æ€»ä½“ä¸Šæ§åˆ¶çº¿ç¨‹çš„æ•°é‡ï¼Œå…·ä½“ä¸Šæ§åˆ¶çº¿ç¨‹çš„åˆ›å»ºã€é”€æ¯ç­‰ç”Ÿå‘½å‘¨æœŸï¼Œç³»ç»Ÿå¯é€šè¿‡ç”³è¯·çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å¼‚æ­¥çš„å®ŒæˆæŸä¸ªä»»åŠ¡ã€‚çº¿ç¨‹æ± é€šè¿‡å¯¹çº¿ç¨‹çš„ç®¡ç†å®ç°å¯¹èµ„æºçš„æœ‰æ•ˆåˆ©ç”¨ï¼Œé¿å…ç³»ç»Ÿèµ„æºæµªè´¹æˆ–å†…å­˜æ³„éœ²ç­‰é—®é¢˜ã€‚\n1.3 ä½¿ç”¨çº¿ç¨‹æ± çš„å¥½å¤„  çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å¯åå¤åˆ©ç”¨ï¼Œå‡å°‘äº†çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯çš„å¼€é”€ ä»»åŠ¡æ— éœ€ç­‰å¾…çº¿ç¨‹åˆ›å»ºå³å¯å¼€å§‹è¿è¡Œï¼Œæé«˜äº†ç³»ç»Ÿå“åº”é€Ÿåº¦ é€šè¿‡è®¾ç½®åˆç†çš„çº¿ç¨‹æ± çº¿ç¨‹æ•°ï¼Œå¯æœ‰æ•ˆé¿å…èµ„æºä½¿ç”¨ä¸å½“ï¼Œèµ„æºæµªè´¹ å¯¹çº¿ç¨‹è¿è¡Œè¿›è¡Œæœ‰æ•ˆçš„ç›‘è§†ä¸ç®¡ç†  é€šä¿—æ˜“æ‡‚çš„è®²ï¼Œå¦‚æœå°†çº¿ç¨‹æ¯”ä½œå®Œæˆä»»åŠ¡çš„äººï¼Œé‚£ä¹ˆçº¿ç¨‹æ± å°±åƒä¸€ä¸ªä¸“é—¨ç®¡ç†è¿™äº›äººçš„éƒ¨é—¨ã€‚å½“æˆ‘æœ‰ä»»åŠ¡åˆ°æ¥æ—¶ï¼Œç›´æ¥æŠŠä»»åŠ¡äº¤ç»™è¯¥éƒ¨é—¨ï¼Œè€Œä¸ç”¨è‡ªå·±å†å»æ‰¾äººæ¥å®Œæˆä»»åŠ¡ã€‚\n2. çº¿ç¨‹æ± çš„å·¥ä½œæœºåˆ¶ 2.1 çº¿ç¨‹æ± æ¨¡å‹ çº¿ç¨‹æ± çš„å†…éƒ¨å®é™…ä¸Šå¯ä»¥çœ‹åšæ˜¯ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ï¼ŒäºŒè€…å¹¶ä¸ç›´æ¥å…³è”ï¼Œé€šè¿‡ä»»åŠ¡é˜Ÿåˆ—è¿›è¡Œäº¤äº’ï¼Œä»è€Œå¯ä»¥æœ‰æ•ˆçš„ç¼“å†²ä»»åŠ¡ï¼Œå¤ç”¨çº¿ç¨‹ã€‚\nåœ¨çº¿ç¨‹æ± æ¨¡å‹ä¸­ï¼Œæ‰®æ¼”ç”Ÿäº§è€…è§’è‰²çš„æ˜¯ä»»åŠ¡ç®¡ç†éƒ¨åˆ†ï¼Œå…¶æ¥å—æäº¤çš„ä»»åŠ¡ï¼Œå¹¶åˆ¤æ–­ä»»åŠ¡åº”å¦‚ä½•å¤„ç†ï¼š\n ç›´æ¥ç”³è¯·çº¿ç¨‹æ‰§è¡Œè¯¥ä»»åŠ¡ ç¼“å†²åˆ°é˜Ÿåˆ—ä¸­ç­‰å¾…çº¿ç¨‹æ‰§è¡Œ ç›´æ¥æ‹’ç»è¯¥ä»»åŠ¡  çº¿ç¨‹ç®¡ç†éƒ¨åˆ†æ˜¯æ¶ˆè´¹è€…ï¼Œçº¿ç¨‹è¢«ç»Ÿä¸€ç»´æŠ¤åœ¨çº¿ç¨‹æ± ä¸­ï¼Œå½“æœ‰ä»»åŠ¡è¯·æ±‚åˆ°æ¥æ—¶ï¼ŒæŸä¸€çº¿ç¨‹è¢«åˆ†é…å»æ‰§è¡Œè¿™ä¸ªä»»åŠ¡ï¼Œæ‰§è¡Œå®Œæˆåç»§ç»­æˆ–è®¸æ–°çš„ä»»åŠ¡æ¥æ‰§è¡Œï¼Œæœ€ç»ˆå½“çº¿ç¨‹è·å–ä¸åˆ°ä»»åŠ¡æ—¶ï¼Œçº¿ç¨‹å°±è¢«å›æ”¶ä»¥èŠ‚çœç³»ç»Ÿèµ„æºã€‚\n2.2 çº¿ç¨‹æ± çš„çŠ¶æ€ çº¿ç¨‹æ± ä¸€æ–¹é¢ç»´æŠ¤è‡ªèº«çš„çŠ¶æ€ï¼Œå¦ä¸€æ–¹é¢ç®¡ç†çº¿ç¨‹å’Œä»»åŠ¡ï¼Œä½¿äºŒè€…è‰¯å¥½çš„ç»“åˆä»è€Œæ‰§è¡Œå¹¶è¡Œä»»åŠ¡ã€‚ çº¿ç¨‹æ± çš„çŠ¶æ€æœ‰5ç§ï¼š\n   è¿è¡ŒçŠ¶æ€ çŠ¶æ€æè¿°     RUNNING èƒ½æ¥å—æ–°æäº¤çš„ä»»åŠ¡ï¼Œå¹¶ä¸”ä¹Ÿèƒ½å¤„ç†é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡   SHUTDOWN å…³é—­çŠ¶æ€ï¼Œä¸å†æ¥å—æ–°æäº¤çš„ä»»åŠ¡ï¼Œä½†å¯ä»¥ç»§ç»­å¤„ç†é˜»å¡é˜Ÿåˆ—ä¸­å·²ä¿å­˜çš„ä»»åŠ¡   STOP ä¸èƒ½æ¥å—æ–°ä»»åŠ¡ï¼Œä¹Ÿä¸å¤„ç†é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼Œä¼šä¸­æ–­æ­£åœ¨å¤„ç†ä»»åŠ¡çš„çº¿ç¨‹   TIDYING æ‰€æœ‰çš„ä»»åŠ¡éƒ½å·²ç»ˆæ­¢ï¼Œæœ‰æ•ˆçº¿ç¨‹æ•°ä¸º0   TERMINATED åœ¨terminated()æ–¹æ³•æ‰§è¡Œåè¿›å…¥è¯¥çŠ¶æ€   å…¶ç”Ÿå‘½å‘¨æœŸè½¬æ¢å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š     sequenceDiagram RUNNING-\u0026gt;\u0026gt;SHUTDOWN:shutdown() RUNNING-\u0026gt;\u0026gt;STOP: shutdownNow() SHUTDOWN-\u0026gt;\u0026gt;TIDYING:æ‰€æœ‰ä»»åŠ¡éƒ½å·²å®Œæˆï¼Œé˜»å¡é˜Ÿåˆ—ä¸ºç©ºï¼Œå·¥ä½œçº¿ç¨‹æ•°ä¸º0 STOP-\u0026gt;\u0026gt;TIDYING:çº¿ç¨‹æ± ä¸­å·¥ä½œçº¿ç¨‹æ•°ä¸º0 TIDYING-\u0026gt;\u0026gt;TERMINATED: terminated() 2.3 ä»»åŠ¡æ‰§è¡Œæœºåˆ¶ 2.3.1 ä»»åŠ¡è°ƒåº¦ ä»»åŠ¡è°ƒåº¦æ˜¯çº¿ç¨‹æ± çš„ä¸»è¦å…¥å£ï¼Œç”¨æˆ·æäº¤ä»»åŠ¡åï¼Œè¿™éƒ¨åˆ†å°†å†³å®šä»»åŠ¡å¦‚ä½•æ‰§è¡Œã€‚ ä»»åŠ¡è°ƒåº¦çš„æµç¨‹å›¾å¦‚ä¸‹ï¼š  æäº¤ä»»åŠ¡åï¼Œé¦–å…ˆæ£€æµ‹è¿è¡Œæ± çŠ¶æ€ï¼Œè‹¥ä¸æ˜¯RUNNINGï¼Œåˆ™ç›´æ¥æ‹’ç»ï¼Œçº¿ç¨‹æ± è¦ä¿è¯åœ¨RUNNINGçŠ¶æ€ä¸‹æ‰§è¡Œä»»åŠ¡ã€‚ å¦‚æœçº¿ç¨‹æ•°å°äºæ ¸å¿ƒæ•°ï¼Œè¯´æ˜ç³»ç»Ÿè¿˜æ²¡æœ‰è¢«å……åˆ†åˆ©ç”¨ï¼Œåˆ™å¯æ·»åŠ çº¿ç¨‹å¹¶æ‰§è¡Œã€‚è‹¥çº¿ç¨‹æ•°å¤§äºæ ¸å¿ƒæ•°ï¼Œæ­¤æ—¶å†ä¸€å‘³å¢åŠ çº¿ç¨‹æ•°åªä¼šå¸¦æ¥è°ƒåº¦å¼€é”€ï¼Œåˆ™å°†ä»»åŠ¡æ”¾å…¥é˜»å¡é˜Ÿåˆ—ã€‚ è‹¥é˜»å¡é˜Ÿåˆ—æœªæ»¡ï¼Œåˆ™å°†ä»»åŠ¡æ”¾å…¥é˜»å¡é˜Ÿåˆ—ç­‰å¾…æ‰§è¡Œï¼Œå¦åˆ™è¿›è¡Œä¸‹ä¸€æ­¥ã€‚ è‹¥çº¿ç¨‹æ•°å°äºæœ€å¤§çº¿ç¨‹æ•°ï¼Œå¯æ·»åŠ å·¥ä½œçº¿ç¨‹æ‰§è¡Œï¼Œè‹¥çº¿ç¨‹æ•°å·²å¤§äºç­‰äºæœ€å¤§çº¿ç¨‹æ•°ï¼Œæ­¤æ—¶ç›´æ¥æ‹’ç»ä»»åŠ¡ï¼Œä¸äºˆæ‰§è¡Œã€‚  2.3.2 ä»»åŠ¡ç¼“å†² çº¿ç¨‹æ± çš„æœ¬è´¨æ˜¯å¯¹ä»»åŠ¡å’Œçº¿ç¨‹çš„ç®¡ç†ï¼Œè¦è®©äºŒè€…åˆ†åˆ«ç‹¬ç«‹è¿è¡Œã€‚å¦‚æœä¸ä½¿ç”¨çº¿ç¨‹æ± ï¼Œä¸€ä¸ªä»»åŠ¡å³ä¸€ä¸ªçº¿ç¨‹ï¼Œå¯¹ä»»åŠ¡ä¸çº¿ç¨‹çš„ç®¡ç†éƒ½å°†é™·å…¥æ··ä¹±ã€‚è¦åˆ†åˆ«å¯¹ä»»åŠ¡å’Œçº¿ç¨‹è¿›è¡Œç®¡ç†ï¼Œåˆ™éœ€è¦å°†äºŒè€…è¿›è¡Œè§£è€¦ï¼Œä¸è®©äºŒè€…ç›´æ¥å…³è”ã€‚çº¿ç¨‹æ± ä»¥æ¶ˆè´¹è€…-ç”Ÿäº§è€…æ¨¡å‹ï¼Œé€šè¿‡ä¸€ä¸ªé˜»å¡é˜Ÿåˆ—å®ç°äºŒè€…çš„è§£è€¦ã€‚é˜»å¡é˜Ÿåˆ—ç¼“å­˜ä»»åŠ¡ï¼Œå·¥ä½œçº¿ç¨‹ä»é˜»å¡é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡ã€‚\né˜»å¡é˜Ÿåˆ—(BlockingQueue)æ˜¯ä¸€ä¸ªæ”¯æŒä¸¤ä¸ªé™„åŠ æ“ä½œçš„é˜Ÿåˆ—ã€‚è¿™ä¸¤ä¸ªé™„åŠ çš„æ“ä½œæ˜¯ï¼š\n åœ¨é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œè·å–å…ƒç´ çš„çº¿ç¨‹ä¼šç­‰å¾…é˜Ÿåˆ—å˜ä¸ºéç©ºã€‚ å½“é˜Ÿåˆ—æ»¡æ—¶ï¼Œå­˜å‚¨å…ƒç´ çš„çº¿ç¨‹ä¼šç­‰å¾…é˜Ÿåˆ—å¯ç”¨ã€‚ é˜»å¡é˜Ÿåˆ—å¸¸ç”¨äºç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„åœºæ™¯ï¼Œç”Ÿäº§è€…æ˜¯å¾€é˜Ÿåˆ—é‡Œæ·»åŠ å…ƒç´ çš„çº¿ç¨‹ï¼Œæ¶ˆè´¹è€…æ˜¯ä»é˜Ÿåˆ—é‡Œæ‹¿å…ƒç´ çš„çº¿ç¨‹ã€‚é˜»å¡é˜Ÿåˆ—å°±æ˜¯ç”Ÿäº§è€…å­˜æ”¾å…ƒç´ çš„å®¹å™¨ï¼Œè€Œæ¶ˆè´¹è€…ä¹Ÿåªä»å®¹å™¨é‡Œæ‹¿å…ƒç´ ã€‚ å…¶å·¥ä½œæ¨¡å¼å¦‚ä¸‹ï¼š   2.3.3 ä»»åŠ¡ç”³è¯· ä»ä¸Šæ–‡ä»»åŠ¡è°ƒåº¦éƒ¨åˆ†å¯çŸ¥ï¼Œä»»åŠ¡çš„æ‰§è¡Œæœ‰ä¸¤ç§å¯èƒ½ï¼š\n ä»»åŠ¡ç›´æ¥ç”±æ–°åˆ›å»ºçš„çº¿ç¨‹æ‰§è¡Œ çº¿ç¨‹ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡ç„¶åæ‰§è¡Œï¼Œæ‰§è¡Œå®Œä»»åŠ¡çš„ç©ºé—²è¿›è¡Œå†æ¬¡å»é˜Ÿåˆ—ä¸­ç”³è¯·ä»»åŠ¡æ‰§è¡Œ ç¬¬ä¸€ç§æƒ…å†µä»…åœ¨çº¿ç¨‹åˆå§‹åˆ›å»ºæ—¶å‡ºç°ï¼Œå¤šæ•°æƒ…å†µä¸‹æ˜¯ç¬¬äºŒç§æƒ…å†µ  çº¿ç¨‹è¦ä»ä»»åŠ¡ç¼“å­˜æ¨¡å—ä¸­ä¸æ–­è·å–ä»»åŠ¡æ‰§è¡Œï¼Œå®šä¹‰getTaskæ–¹æ³•æ¥å¸®åŠ©çº¿ç¨‹ä»é˜»å¡é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡ï¼Œå®ç°çº¿ç¨‹ç®¡ç†æ¨¡å—å’Œä»»åŠ¡ç®¡ç†æ¨¡å—çš„é€šä¿¡ã€‚å…¶æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š è¿™é‡Œè¿›è¡Œäº†å¤šæ¬¡åˆ¤æ–­ï¼Œç›®çš„åœ¨äºæ§åˆ¶çº¿ç¨‹çš„æ•°é‡ï¼Œä½¿å…¶ç¬¦åˆçº¿ç¨‹æ± çš„çŠ¶æ€ã€‚å¦‚æœçº¿ç¨‹æ± ç°åœ¨ä¸åº”è¯¥æŒæœ‰é‚£ä¹ˆå¤šçº¿ç¨‹ï¼Œåˆ™ä¼šè¿”å›nullå€¼ã€‚å·¥ä½œçº¿ç¨‹Workerä¼šä¸æ–­æ¥æ”¶æ–°ä»»åŠ¡å»æ‰§è¡Œï¼Œè€Œå½“å·¥ä½œçº¿ç¨‹Workeræ¥æ”¶ä¸åˆ°ä»»åŠ¡çš„æ—¶å€™ï¼Œå°±ä¼šå¼€å§‹è¢«å›æ”¶ã€‚\n2.3.4 ä»»åŠ¡æ‹’ç» ä»»åŠ¡æ‹’ç»æ¨¡å—æ˜¯çº¿ç¨‹æ± çš„ä¿æŠ¤éƒ¨åˆ†ã€‚å½“çº¿ç¨‹æ± çš„ä»»åŠ¡ç¼“å­˜é˜Ÿåˆ—å·²æ»¡ï¼Œå¹¶ä¸”çº¿ç¨‹æ•°è¾¾åˆ°è®¾å®šçš„æœ€å¤§å€¼ï¼Œå°±éœ€è¦æ‹’ç»åˆ°æ¥çš„ä»»åŠ¡ï¼Œä¿æŠ¤çº¿ç¨‹æ± ã€‚\n2.4 Workerçº¿ç¨‹ç®¡ç† 2.4.1 Workerçº¿ç¨‹ çº¿ç¨‹æ± ä¸ºäº†æŒæ¡çº¿ç¨‹çš„çŠ¶æ€å¹¶ç»´æŠ¤çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸï¼Œè®¾è®¡äº†çº¿ç¨‹æ± å†…çš„å·¥ä½œçº¿ç¨‹Workerã€‚\nWorkeræŒæœ‰ä¸€ä¸ªçº¿ç¨‹threadå’Œä¸€ä¸ªåˆå§‹åŒ–çš„ä»»åŠ¡firstTaskã€‚threadæ˜¯åœ¨Workeråˆ›å»ºæ—¶åˆ›å»ºçš„çº¿ç¨‹ï¼Œå¯ç”¨æ¥æ‰§è¡Œä»»åŠ¡ï¼›firstTaskä¿å­˜ä¼ å…¥çš„ç¬¬ä¸€ä¸ªä»»åŠ¡ï¼Œè¿™ä¸ªä»»åŠ¡å¯ä»¥æœ‰ä¹Ÿå¯ä»¥ä¸ºç©ºã€‚å¦‚æœæ­¤å€¼éç©ºï¼Œé‚£ä¹ˆWorkerä¼šå…ˆæ‰§è¡Œè¿™ä¸ªä»»åŠ¡ï¼Œå†å»è·å–ä»»åŠ¡æ‰§è¡Œï¼›å¦‚æœæ­¤å€¼ä¸ºç©ºï¼Œé‚£ä¹ˆWorkerç›´æ¥å»é˜»å¡é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡æ‰§è¡Œã€‚ çº¿ç¨‹æ± éœ€è¦ç®¡ç†çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸï¼Œéœ€è¦åœ¨çº¿ç¨‹é•¿æ—¶é—´ä¸è¿è¡Œçš„æ—¶å€™è¿›è¡Œå›æ”¶ã€‚çº¿ç¨‹æ± ä½¿ç”¨ä¸€å¼ Hashè¡¨å»æŒæœ‰çº¿ç¨‹çš„å¼•ç”¨ï¼Œè¿™æ ·å¯ä»¥é€šè¿‡æ·»åŠ å¼•ç”¨ã€ç§»é™¤å¼•ç”¨è¿™æ ·çš„æ“ä½œæ¥æ§åˆ¶çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸã€‚è¿™ä¸ªæ—¶å€™é‡è¦çš„å°±æ˜¯å¦‚ä½•åˆ¤æ–­çº¿ç¨‹æ˜¯å¦åœ¨è¿è¡Œã€‚\nâ€‹Workeræ˜¯é€šè¿‡ç»§æ‰¿AQSï¼Œä½¿ç”¨AQSæ¥å®ç°ç‹¬å é”è¿™ä¸ªåŠŸèƒ½ã€‚æ²¡æœ‰ä½¿ç”¨å¯é‡å…¥é”ReentrantLockï¼Œè€Œæ˜¯ä½¿ç”¨AQSï¼Œä¸ºçš„å°±æ˜¯å®ç°ä¸å¯é‡å…¥çš„ç‰¹æ€§å»ååº”çº¿ç¨‹ç°åœ¨çš„æ‰§è¡ŒçŠ¶æ€ã€‚\n1.lockæ–¹æ³•ä¸€æ—¦è·å–äº†ç‹¬å é”ï¼Œè¡¨ç¤ºå½“å‰çº¿ç¨‹æ­£åœ¨æ‰§è¡Œä»»åŠ¡ä¸­ã€‚ 2.å¦‚æœæ­£åœ¨æ‰§è¡Œä»»åŠ¡ï¼Œåˆ™ä¸åº”è¯¥ä¸­æ–­çº¿ç¨‹ã€‚ 3.å¦‚æœè¯¥çº¿ç¨‹ç°åœ¨ä¸æ˜¯ç‹¬å é”çš„çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯ç©ºé—²çš„çŠ¶æ€ï¼Œè¯´æ˜å®ƒæ²¡æœ‰åœ¨å¤„ç†ä»»åŠ¡ï¼Œè¿™æ—¶å¯ä»¥å¯¹è¯¥çº¿ç¨‹è¿›è¡Œä¸­æ–­ã€‚ 4.çº¿ç¨‹æ± åœ¨æ‰§è¡Œshutdownæ–¹æ³•æˆ–tryTerminateæ–¹æ³•æ—¶ä¼šè°ƒç”¨interruptIdleWorkersæ–¹æ³•æ¥ä¸­æ–­ç©ºé—²çš„çº¿ç¨‹ï¼ŒinterruptIdleWorkersæ–¹æ³•ä¼šä½¿ç”¨tryLockæ–¹æ³•æ¥åˆ¤æ–­çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ˜¯å¦æ˜¯ç©ºé—²çŠ¶æ€ï¼›å¦‚æœçº¿ç¨‹æ˜¯ç©ºé—²çŠ¶æ€åˆ™å¯ä»¥å®‰å…¨å›æ”¶ã€‚\nåœ¨çº¿ç¨‹å›æ”¶è¿‡ç¨‹ä¸­å°±ä½¿ç”¨åˆ°äº†è¿™ç§ç‰¹æ€§ï¼Œå›æ”¶è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n2.4.2 Workerçº¿ç¨‹å¢åŠ  å¢åŠ çº¿ç¨‹æ˜¯é€šè¿‡çº¿ç¨‹æ± ä¸­çš„addWorkeræ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„åŠŸèƒ½å°±æ˜¯å¢åŠ ä¸€ä¸ªçº¿ç¨‹ï¼Œè¯¥æ–¹æ³•ä¸è€ƒè™‘çº¿ç¨‹æ± æ˜¯åœ¨å“ªä¸ªé˜¶æ®µå¢åŠ çš„è¯¥çº¿ç¨‹ï¼Œè¿™ä¸ªåˆ†é…çº¿ç¨‹çš„ç­–ç•¥æ˜¯åœ¨ä¸Šä¸ªæ­¥éª¤å®Œæˆçš„ï¼Œè¯¥æ­¥éª¤ä»…ä»…å®Œæˆå¢åŠ çº¿ç¨‹ï¼Œå¹¶ä½¿å®ƒè¿è¡Œï¼Œæœ€åè¿”å›æ˜¯å¦æˆåŠŸè¿™ä¸ªç»“æœã€‚addWorkeræ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°ï¼šfirstTaskã€coreã€‚firstTaskå‚æ•°ç”¨äºæŒ‡å®šæ–°å¢çš„çº¿ç¨‹æ‰§è¡Œçš„ç¬¬ä¸€ä¸ªä»»åŠ¡ï¼Œè¯¥å‚æ•°å¯ä»¥ä¸ºç©ºï¼›coreå‚æ•°ä¸ºtrueè¡¨ç¤ºåœ¨æ–°å¢çº¿ç¨‹æ—¶ä¼šåˆ¤æ–­å½“å‰æ´»åŠ¨çº¿ç¨‹æ•°æ˜¯å¦å°‘äºcorePoolSizeï¼Œfalseè¡¨ç¤ºæ–°å¢çº¿ç¨‹å‰éœ€è¦åˆ¤æ–­å½“å‰æ´»åŠ¨çº¿ç¨‹æ•°æ˜¯å¦å°‘äºmaximumPoolSizeï¼Œå…¶æ‰§è¡Œæµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 2.4.3 Workerçº¿ç¨‹å›æ”¶ çº¿ç¨‹æ± ä¸­çº¿ç¨‹çš„é”€æ¯ä¾èµ–JVMè‡ªåŠ¨çš„å›æ”¶ï¼Œçº¿ç¨‹æ± åšçš„å·¥ä½œæ˜¯æ ¹æ®å½“å‰çº¿ç¨‹æ± çš„çŠ¶æ€ç»´æŠ¤ä¸€å®šæ•°é‡çš„çº¿ç¨‹å¼•ç”¨ï¼Œé˜²æ­¢è¿™éƒ¨åˆ†çº¿ç¨‹è¢«JVMå›æ”¶ï¼Œå½“çº¿ç¨‹æ± å†³å®šå“ªäº›çº¿ç¨‹éœ€è¦å›æ”¶æ—¶ï¼Œåªéœ€è¦å°†å…¶å¼•ç”¨æ¶ˆé™¤å³å¯ã€‚Workerè¢«åˆ›å»ºå‡ºæ¥åï¼Œå°±ä¼šä¸æ–­åœ°è¿›è¡Œè½®è¯¢ï¼Œç„¶åè·å–ä»»åŠ¡å»æ‰§è¡Œï¼Œæ ¸å¿ƒçº¿ç¨‹å¯ä»¥æ— é™ç­‰å¾…è·å–ä»»åŠ¡ï¼Œéæ ¸å¿ƒçº¿ç¨‹è¦é™æ—¶è·å–ä»»åŠ¡ã€‚å½“Workeræ— æ³•è·å–åˆ°ä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯è·å–çš„ä»»åŠ¡ä¸ºç©ºæ—¶ï¼Œå¾ªç¯ä¼šç»“æŸï¼ŒWorkerä¼šä¸»åŠ¨æ¶ˆé™¤è‡ªèº«åœ¨çº¿ç¨‹æ± å†…çš„å¼•ç”¨ã€‚\näº‹å®ä¸Šï¼Œå°†çº¿ç¨‹å¼•ç”¨ç§»å‡ºçº¿ç¨‹æ± å°±å·²ç»ç»“æŸäº†çº¿ç¨‹é”€æ¯çš„éƒ¨åˆ†ã€‚ä½†ç”±äºå¼•èµ·çº¿ç¨‹é”€æ¯çš„å¯èƒ½æ€§æœ‰å¾ˆå¤šï¼Œçº¿ç¨‹æ± è¿˜è¦åˆ¤æ–­æ˜¯ä»€ä¹ˆå¼•å‘äº†è¿™æ¬¡é”€æ¯ï¼Œæ˜¯å¦è¦æ”¹å˜çº¿ç¨‹æ± çš„ç°é˜¶æ®µçŠ¶æ€ï¼Œæ˜¯å¦è¦æ ¹æ®æ–°çŠ¶æ€ï¼Œé‡æ–°åˆ†é…çº¿ç¨‹ã€‚\n2.4.4 Workerçº¿ç¨‹æ‰§è¡Œä»»åŠ¡ åœ¨Workerç±»ä¸­çš„runæ–¹æ³•è°ƒç”¨äº†runWorkeræ–¹æ³•æ¥æ‰§è¡Œä»»åŠ¡ï¼ŒrunWorkeræ–¹æ³•çš„æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š\n1.whileå¾ªç¯ä¸æ–­åœ°é€šè¿‡getTask()æ–¹æ³•è·å–ä»»åŠ¡ã€‚ 2.getTask()æ–¹æ³•ä»é˜»å¡é˜Ÿåˆ—ä¸­å–ä»»åŠ¡ã€‚ 3.å¦‚æœçº¿ç¨‹æ± æ­£åœ¨åœæ­¢ï¼Œé‚£ä¹ˆè¦ä¿è¯å½“å‰çº¿ç¨‹æ˜¯ä¸­æ–­çŠ¶æ€ï¼Œå¦åˆ™è¦ä¿è¯å½“å‰çº¿ç¨‹ä¸æ˜¯ä¸­æ–­çŠ¶æ€ã€‚ 4.æ‰§è¡Œä»»åŠ¡ã€‚ 5.å¦‚æœgetTaskç»“æœä¸ºnullåˆ™è·³å‡ºå¾ªç¯ï¼Œæ‰§è¡ŒprocessWorkerExit()æ–¹æ³•ï¼Œé”€æ¯çº¿ç¨‹ã€‚ ","permalink":"http://yangchnet.github.io/Dessert/posts/linux/%E7%BA%BF%E7%A8%8B%E6%B1%A0/","summary":"1. çº¿ç¨‹æ± åŸºç¡€ 1.1 é‡ç”Ÿçº¿ç¨‹ åœ¨æˆ‘ä»¬å¹³å¸¸çš„å¼€å‘ä¸­ï¼Œç»å¸¸ä¼šæœ‰ç”¨åˆ°å¤šçº¿ç¨‹çš„åœºæ™¯ï¼Œåˆç†åˆ©ç”¨å¤šçº¿ç¨‹å¯æœ‰æ•ˆåˆ©ç”¨CPUçš„å¤šæ ¸ç»“æ„ï¼Œæé«˜ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ã€‚æœ‰è¿™æ ·ä¸€ç§çº¿ç¨‹ï¼šæˆ‘ä»¬åˆ©ç”¨å…¶å®Œæˆä¸€äº›å·¥ä½œï¼Œä½†åªæ˜¯å°†å·¥ä½œäº¤ç»™è¿™ä¸ªçº¿ç¨‹ï¼Œè¯¥çº¿ç¨‹å¹¶ä¸ä¿è¯å®Œæˆä»»åŠ¡ï¼Œä¹Ÿä¸ä¿è¯æ­£å¸¸é€€å‡ºï¼Œå¹¶ä¸”åœ¨çº¿ç¨‹å¼€å§‹è¿è¡Œåæˆ‘ä»¬æ— æ³•å¯¹å…¶è¿›è¡Œæ§åˆ¶ã€‚è¿™ç§çŠ¶æ€å¯ç§°ä¸ºï¼šé‡ç”Ÿçº¿ç¨‹ï¼Œæ„ä¸ºå…¶å·²ç»ä¸å—æ§åˆ¶ï¼Œåœ¨å†…å­˜ä¸­è‡ªç”±è¿è¡Œã€‚\nè¿™ç§çº¿ç¨‹å¯èƒ½å¸¦æ¥ä¸€ç³»åˆ—é—®é¢˜ï¼š\n é¢‘ç¹ç”³è¯·/é”€æ¯çº¿ç¨‹ï¼Œå¯èƒ½å¸¦æ¥å·¨å¤§çš„é¢å¤–æ¶ˆè€— å½“å†…å­˜ä¸­å­˜åœ¨è¾ƒå¤šçš„é‡ç”Ÿçº¿ç¨‹ï¼Œä¼šå¯¼è‡´è¿‡åˆ†è°ƒåº¦ï¼Œé™ä½ç³»ç»Ÿæ€§èƒ½ ä¸èƒ½æ­£å¸¸é€€å‡ºçš„çº¿ç¨‹ä¼šå¯¼è‡´å†…å­˜æ³„éœ² ç³»ç»Ÿæ— æ³•åˆç†ç®¡ç†å†…éƒ¨çš„èµ„æºåˆ†å¸ƒï¼Œä¼šé™ä½ç³»ç»Ÿçš„ç¨³å®šæ€§ â€¦â€¦  é‰´äºä»¥ä¸Šé‡ç”Ÿçº¿ç¨‹å¸¦æ¥çš„é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹å¼å°†å…¶ç®¡ç†èµ·æ¥ï¼Œä½¿å…¶ä»é‡ç”Ÿçš„çº¿ç¨‹å˜æˆ\u0026quot;å®¶å…»\u0026quot;çš„çº¿ç¨‹ã€‚\n1.2 ä»€ä¹ˆæ˜¯çº¿ç¨‹æ±   æ± åŒ–ï¼šæ± åŒ–æ˜¯ä¸€ç§å°†èµ„æºç»Ÿä¸€è¿›è¡Œç®¡ç†ï¼Œä»è€Œæœ€å¤§åŒ–æ”¶ç›Šå¹¶æœ€å°åŒ–é£é™©çš„æ€æƒ³ã€‚\n çº¿ç¨‹æ± ç»´æŠ¤è‹¥å¹²ä¸ªçº¿ç¨‹ï¼Œåœ¨æ€»ä½“ä¸Šæ§åˆ¶çº¿ç¨‹çš„æ•°é‡ï¼Œå…·ä½“ä¸Šæ§åˆ¶çº¿ç¨‹çš„åˆ›å»ºã€é”€æ¯ç­‰ç”Ÿå‘½å‘¨æœŸï¼Œç³»ç»Ÿå¯é€šè¿‡ç”³è¯·çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å¼‚æ­¥çš„å®ŒæˆæŸä¸ªä»»åŠ¡ã€‚çº¿ç¨‹æ± é€šè¿‡å¯¹çº¿ç¨‹çš„ç®¡ç†å®ç°å¯¹èµ„æºçš„æœ‰æ•ˆåˆ©ç”¨ï¼Œé¿å…ç³»ç»Ÿèµ„æºæµªè´¹æˆ–å†…å­˜æ³„éœ²ç­‰é—®é¢˜ã€‚\n1.3 ä½¿ç”¨çº¿ç¨‹æ± çš„å¥½å¤„  çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å¯åå¤åˆ©ç”¨ï¼Œå‡å°‘äº†çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯çš„å¼€é”€ ä»»åŠ¡æ— éœ€ç­‰å¾…çº¿ç¨‹åˆ›å»ºå³å¯å¼€å§‹è¿è¡Œï¼Œæé«˜äº†ç³»ç»Ÿå“åº”é€Ÿåº¦ é€šè¿‡è®¾ç½®åˆç†çš„çº¿ç¨‹æ± çº¿ç¨‹æ•°ï¼Œå¯æœ‰æ•ˆé¿å…èµ„æºä½¿ç”¨ä¸å½“ï¼Œèµ„æºæµªè´¹ å¯¹çº¿ç¨‹è¿è¡Œè¿›è¡Œæœ‰æ•ˆçš„ç›‘è§†ä¸ç®¡ç†  é€šä¿—æ˜“æ‡‚çš„è®²ï¼Œå¦‚æœå°†çº¿ç¨‹æ¯”ä½œå®Œæˆä»»åŠ¡çš„äººï¼Œé‚£ä¹ˆçº¿ç¨‹æ± å°±åƒä¸€ä¸ªä¸“é—¨ç®¡ç†è¿™äº›äººçš„éƒ¨é—¨ã€‚å½“æˆ‘æœ‰ä»»åŠ¡åˆ°æ¥æ—¶ï¼Œç›´æ¥æŠŠä»»åŠ¡äº¤ç»™è¯¥éƒ¨é—¨ï¼Œè€Œä¸ç”¨è‡ªå·±å†å»æ‰¾äººæ¥å®Œæˆä»»åŠ¡ã€‚\n2. çº¿ç¨‹æ± çš„å·¥ä½œæœºåˆ¶ 2.1 çº¿ç¨‹æ± æ¨¡å‹ çº¿ç¨‹æ± çš„å†…éƒ¨å®é™…ä¸Šå¯ä»¥çœ‹åšæ˜¯ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ï¼ŒäºŒè€…å¹¶ä¸ç›´æ¥å…³è”ï¼Œé€šè¿‡ä»»åŠ¡é˜Ÿåˆ—è¿›è¡Œäº¤äº’ï¼Œä»è€Œå¯ä»¥æœ‰æ•ˆçš„ç¼“å†²ä»»åŠ¡ï¼Œå¤ç”¨çº¿ç¨‹ã€‚\nåœ¨çº¿ç¨‹æ± æ¨¡å‹ä¸­ï¼Œæ‰®æ¼”ç”Ÿäº§è€…è§’è‰²çš„æ˜¯ä»»åŠ¡ç®¡ç†éƒ¨åˆ†ï¼Œå…¶æ¥å—æäº¤çš„ä»»åŠ¡ï¼Œå¹¶åˆ¤æ–­ä»»åŠ¡åº”å¦‚ä½•å¤„ç†ï¼š\n ç›´æ¥ç”³è¯·çº¿ç¨‹æ‰§è¡Œè¯¥ä»»åŠ¡ ç¼“å†²åˆ°é˜Ÿåˆ—ä¸­ç­‰å¾…çº¿ç¨‹æ‰§è¡Œ ç›´æ¥æ‹’ç»è¯¥ä»»åŠ¡  çº¿ç¨‹ç®¡ç†éƒ¨åˆ†æ˜¯æ¶ˆè´¹è€…ï¼Œçº¿ç¨‹è¢«ç»Ÿä¸€ç»´æŠ¤åœ¨çº¿ç¨‹æ± ä¸­ï¼Œå½“æœ‰ä»»åŠ¡è¯·æ±‚åˆ°æ¥æ—¶ï¼ŒæŸä¸€çº¿ç¨‹è¢«åˆ†é…å»æ‰§è¡Œè¿™ä¸ªä»»åŠ¡ï¼Œæ‰§è¡Œå®Œæˆåç»§ç»­æˆ–è®¸æ–°çš„ä»»åŠ¡æ¥æ‰§è¡Œï¼Œæœ€ç»ˆå½“çº¿ç¨‹è·å–ä¸åˆ°ä»»åŠ¡æ—¶ï¼Œçº¿ç¨‹å°±è¢«å›æ”¶ä»¥èŠ‚çœç³»ç»Ÿèµ„æºã€‚\n2.2 çº¿ç¨‹æ± çš„çŠ¶æ€ çº¿ç¨‹æ± ä¸€æ–¹é¢ç»´æŠ¤è‡ªèº«çš„çŠ¶æ€ï¼Œå¦ä¸€æ–¹é¢ç®¡ç†çº¿ç¨‹å’Œä»»åŠ¡ï¼Œä½¿äºŒè€…è‰¯å¥½çš„ç»“åˆä»è€Œæ‰§è¡Œå¹¶è¡Œä»»åŠ¡ã€‚ çº¿ç¨‹æ± çš„çŠ¶æ€æœ‰5ç§ï¼š\n   è¿è¡ŒçŠ¶æ€ çŠ¶æ€æè¿°     RUNNING èƒ½æ¥å—æ–°æäº¤çš„ä»»åŠ¡ï¼Œå¹¶ä¸”ä¹Ÿèƒ½å¤„ç†é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡   SHUTDOWN å…³é—­çŠ¶æ€ï¼Œä¸å†æ¥å—æ–°æäº¤çš„ä»»åŠ¡ï¼Œä½†å¯ä»¥ç»§ç»­å¤„ç†é˜»å¡é˜Ÿåˆ—ä¸­å·²ä¿å­˜çš„ä»»åŠ¡   STOP ä¸èƒ½æ¥å—æ–°ä»»åŠ¡ï¼Œä¹Ÿä¸å¤„ç†é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼Œä¼šä¸­æ–­æ­£åœ¨å¤„ç†ä»»åŠ¡çš„çº¿ç¨‹   TIDYING æ‰€æœ‰çš„ä»»åŠ¡éƒ½å·²ç»ˆæ­¢ï¼Œæœ‰æ•ˆçº¿ç¨‹æ•°ä¸º0   TERMINATED åœ¨terminated()æ–¹æ³•æ‰§è¡Œåè¿›å…¥è¯¥çŠ¶æ€   å…¶ç”Ÿå‘½å‘¨æœŸè½¬æ¢å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š     sequenceDiagram RUNNING-\u0026gt;\u0026gt;SHUTDOWN:shutdown() RUNNING-\u0026gt;\u0026gt;STOP: shutdownNow() SHUTDOWN-\u0026gt;\u0026gt;TIDYING:æ‰€æœ‰ä»»åŠ¡éƒ½å·²å®Œæˆï¼Œé˜»å¡é˜Ÿåˆ—ä¸ºç©ºï¼Œå·¥ä½œçº¿ç¨‹æ•°ä¸º0 STOP-\u0026gt;\u0026gt;TIDYING:çº¿ç¨‹æ± ä¸­å·¥ä½œçº¿ç¨‹æ•°ä¸º0 TIDYING-\u0026gt;\u0026gt;TERMINATED: terminated() 2.","title":"çº¿ç¨‹æ± "},{"content":"1. å®‰è£…é«˜ç‰ˆæœ¬çš„Python  è¿™é‡Œè¦è¯´æ˜ï¼Œä¸èƒ½åˆ é™¤åŸæ¥çš„python2ä»¥åŠpython3.5ï¼Œå› ä¸ºç³»ç»Ÿæ˜¯ä¾èµ–äºè¿™ä¸¤ä¸ªpythonç‰ˆæœ¬çš„ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥è¯•è¯•ï¼Œåæœè‡ªè´Ÿ\u0026hellip;\n  å»å®˜ç½‘ä¸‹è½½æœ€æ–°çš„Python æˆ‘è¿™é‡Œä¸‹è½½çš„æ˜¯æºç ï¼Œå› ä¸ºæ²¡æœ‰å¯¹åº”çš„å®‰è£…åŒ…ã€‚ï¼ˆPython3.9ï¼‰ ä¸‹è½½å®Œæˆåè§£å‹åˆ°æœ¬åœ° sudo tar -xvf Python-3.9.5.tar.xz -C /opt/python  ç¼–è¯‘å®‰è£… cd /opt/python mv Python-3.9.5 python3.9 sudo ./configure --enable-optimizations # é»˜è®¤å®‰è£…åˆ°/usr/local/bin, å¯ç”¨--prefixæŒ‡å®šå®‰è£…ç›®å½• make -j8 \u0026amp;\u0026amp; sudo make altinstall sudo make clean  éªŒè¯å®‰è£…æˆåŠŸ /usr/local/bin/python3.9  Python 3.9.5 (default, May 13 2021, 09:51:10) [GCC 6.3.0 20170516] on linux Type \u0026quot;help\u0026quot;, \u0026quot;copyright\u0026quot;, \u0026quot;credits\u0026quot; or \u0026quot;license\u0026quot; for more information. \u0026gt;\u0026gt;\u0026gt; exit()   2. è®¾ç½®é»˜è®¤Pythonç‰ˆæœ¬ 2.1 ç”¨æˆ·çº§ä¿®æ”¹ vim ~/.bashrc å¢åŠ ä¸€è¡Œï¼šalias python='/usr/local/bin/python3.9\nsource ~/.bashrc 2.2 ç³»ç»Ÿçº§ä¿®æ”¹ sudo rm /usr/bin/python # åˆ é™¤åŸæ¥é»˜è®¤çš„Pythonè½¯é“¾æ¥ sudo ln -s /usr/local/bin/python3.9 /usr/bin/python # è®¾ç½®æ–°çš„è½¯è¿æ¥ ä»python3.9æŒ‡å‘python 2.3 åŸºäºupdate-alternatives åˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„pythonç‰ˆæœ¬æ›¿ä»£ä¿¡æ¯\nupdate-alternatives --list python è‹¥å‡ºç°update-alternatives: é”™è¯¯: æ—  python çš„å€™é€‰é¡¹ï¼Œåˆ™è¯´æ˜update-alternativesæ²¡æœ‰æ·»åŠ Pythonçš„æ›¿ä»£ç‰ˆæœ¬ï¼Œéœ€è¦æ‰‹åŠ¨æ·»åŠ \nsudo update-alternatives --install /usr/bin/python python /usr/bin/python2.7 1 sudo update-alternatives --install /usr/bin/python python /usr/bin/python3.5 2 sudo update-alternatives --install /usr/bin/python python /usr/local/bin/python3.9 3 update-alternativesçš„--installå‚æ•°åè·Ÿ4ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯link name path priorityï¼Œ link is the generic name for the master link, name is the name of its symlink in the alternatives directory, and path is the alternative being introduced for the master linkã€‚æœ€åä¸€ä¸ªæ˜¯ä¼˜å…ˆçº§ï¼Œæ•°å­—è¶Šé«˜ä¼˜å…ˆçº§è¶Šé«˜ å†æ¬¡ä½¿ç”¨update-alternatives --list pythonæŸ¥çœ‹å¯ç”¨çš„ç‰ˆæœ¬æ›¿ä»£ä¿¡æ¯\nå¼€å§‹åˆ‡æ¢ï¼š\nupdate-alternatives --config python æœ‰ 3 ä¸ªå€™é€‰é¡¹å¯ç”¨äºæ›¿æ¢ python (æä¾› /usr/bin/python)ã€‚ é€‰æ‹© è·¯å¾„ ä¼˜å…ˆçº§ çŠ¶æ€ ------------------------------------------------------------ * 0 /usr/local/bin/python3.9 3 è‡ªåŠ¨æ¨¡å¼ 1 /usr/bin/python2.7 1 æ‰‹åŠ¨æ¨¡å¼ 2 /usr/bin/python3.5 2 æ‰‹åŠ¨æ¨¡å¼ 3 /usr/local/bin/python3.9 3 æ‰‹åŠ¨æ¨¡å¼ è¦ç»´æŒå½“å‰å€¼[*]è¯·æŒ‰\u0026lt;å›è½¦é”®\u0026gt;ï¼Œæˆ–è€…é”®å…¥é€‰æ‹©çš„ç¼–å·ï¼š è¾“å…¥3ï¼Œé€‰æ‹©Python3.9ä¸ºé»˜è®¤å€¼\n3. pipé”™è¯¯ æ›´æ¢ç‰ˆæœ¬åï¼Œpipå¯èƒ½ä¼šå‡ºç°é”™è¯¯ã€‚ åœ¨æˆ‘çš„ç”µè„‘ä¸Šå‡ºç°äº†subprocess.CalledProcessError: Command '('lsb_release', '-a')' returned non-zero exit status 1.é”™è¯¯ï¼Œ è§£å†³æ–¹æ³•ä¸ºï¼šåˆ é™¤/usr/bin/lsb_release\nsudo rm /usr/bin/lsb_release ","permalink":"http://yangchnet.github.io/Dessert/posts/python/deepin%E4%B8%8A%E5%8D%87%E7%BA%A7python/","summary":"1. å®‰è£…é«˜ç‰ˆæœ¬çš„Python  è¿™é‡Œè¦è¯´æ˜ï¼Œä¸èƒ½åˆ é™¤åŸæ¥çš„python2ä»¥åŠpython3.5ï¼Œå› ä¸ºç³»ç»Ÿæ˜¯ä¾èµ–äºè¿™ä¸¤ä¸ªpythonç‰ˆæœ¬çš„ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥è¯•è¯•ï¼Œåæœè‡ªè´Ÿ\u0026hellip;\n  å»å®˜ç½‘ä¸‹è½½æœ€æ–°çš„Python æˆ‘è¿™é‡Œä¸‹è½½çš„æ˜¯æºç ï¼Œå› ä¸ºæ²¡æœ‰å¯¹åº”çš„å®‰è£…åŒ…ã€‚ï¼ˆPython3.9ï¼‰ ä¸‹è½½å®Œæˆåè§£å‹åˆ°æœ¬åœ° sudo tar -xvf Python-3.9.5.tar.xz -C /opt/python  ç¼–è¯‘å®‰è£… cd /opt/python mv Python-3.9.5 python3.9 sudo ./configure --enable-optimizations # é»˜è®¤å®‰è£…åˆ°/usr/local/bin, å¯ç”¨--prefixæŒ‡å®šå®‰è£…ç›®å½• make -j8 \u0026amp;\u0026amp; sudo make altinstall sudo make clean  éªŒè¯å®‰è£…æˆåŠŸ /usr/local/bin/python3.9  Python 3.9.5 (default, May 13 2021, 09:51:10) [GCC 6.3.0 20170516] on linux Type \u0026quot;help\u0026quot;, \u0026quot;copyright\u0026quot;, \u0026quot;credits\u0026quot; or \u0026quot;license\u0026quot; for more information. \u0026gt;\u0026gt;\u0026gt; exit()   2. è®¾ç½®é»˜è®¤Pythonç‰ˆæœ¬ 2.1 ç”¨æˆ·çº§ä¿®æ”¹ vim ~/.","title":"deepinä¸Šå‡çº§Python"},{"content":"åœ¨ä½¿ç”¨gitæ—¶ï¼Œæœ‰æ—¶æŸåˆ†æ”¯å·²åœ¨è¿œç¨‹æœåŠ¡å™¨åˆ é™¤ï¼Œä½†æœ¬åœ°ä¸ä¼šåŒæ­¥åˆ é™¤ï¼Œè¿™ä¸ªåˆ†æ”¯ä¾ç„¶å­˜åœ¨ã€‚\nå¦‚ä¸‹å‘½ä»¤å¯ä»¥åˆ é™¤æœ¬åœ°ç‰ˆæœ¬åº“ä¸Šé‚£äº›å¤±æ•ˆçš„è¿œç¨‹è¿½è¸ªåˆ†æ”¯ï¼Œå…·ä½“ç”¨æ³•æ˜¯ï¼Œå‡å¦‚ä½ çš„è¿œç¨‹ç‰ˆæœ¬åº“åæ˜¯ origin,åˆ™ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å…ˆæŸ¥çœ‹å“ªäº›åˆ†æ”¯éœ€è¦æ¸…ç†ï¼š\n$ git remote prune origin --dry-run ä¿®å‰ª origin URLï¼šgit@yuhu.github.com:yuhu-tech/grampus-contracts.git * [å°†åˆ é™¤] origin/cq-2021-0227_refactor * [å°†åˆ é™¤] origin/lichagn-feat-impl-grc20 * [å°†åˆ é™¤] origin/lichagn-feat-impl-grc20-em20-em721 * [å°†åˆ é™¤] origin/lichang-feat-add-some-support-for-ANT * [å°†åˆ é™¤] origin/lichang-feat-impl-20-and-720 * [å°†åˆ é™¤] origin/lichang-feat-mdy-20 * [å°†åˆ é™¤] origin/lichang-feat-mdy-20-and-721 * [å°†åˆ é™¤] origin/litao-dev * [å°†åˆ é™¤] origin/runjam-v0.0.2 å¯ä»¥çœ‹åˆ°ï¼Œ ä»¥ä¸Šåˆ†æ”¯å·²ç»å¤±æ•ˆï¼Œå°†è¢«åˆ é™¤ï¼Œæ‰§è¡Œ\n$ git remote prune origin ä¿®å‰ª origin URLï¼šgit@yuhu.github.com:yuhu-tech/grampus-contracts.git * [å·²åˆ é™¤] origin/cq-2021-0227_refactor * [å·²åˆ é™¤] origin/lichagn-feat-impl-grc20 * [å·²åˆ é™¤] origin/lichagn-feat-impl-grc20-em20-em721 * [å·²åˆ é™¤] origin/lichang-feat-add-some-support-for-ANT * [å·²åˆ é™¤] origin/lichang-feat-impl-20-and-720 * [å·²åˆ é™¤] origin/lichang-feat-mdy-20 * [å·²åˆ é™¤] origin/lichang-feat-mdy-20-and-721 * [å·²åˆ é™¤] origin/litao-dev * [å·²åˆ é™¤] origin/runjam-v0.0.2 ","permalink":"http://yangchnet.github.io/Dessert/posts/git/%E6%B8%85%E7%90%86%E6%9C%AC%E5%9C%B0%E5%88%86%E6%94%AF/","summary":"åœ¨ä½¿ç”¨gitæ—¶ï¼Œæœ‰æ—¶æŸåˆ†æ”¯å·²åœ¨è¿œç¨‹æœåŠ¡å™¨åˆ é™¤ï¼Œä½†æœ¬åœ°ä¸ä¼šåŒæ­¥åˆ é™¤ï¼Œè¿™ä¸ªåˆ†æ”¯ä¾ç„¶å­˜åœ¨ã€‚\nå¦‚ä¸‹å‘½ä»¤å¯ä»¥åˆ é™¤æœ¬åœ°ç‰ˆæœ¬åº“ä¸Šé‚£äº›å¤±æ•ˆçš„è¿œç¨‹è¿½è¸ªåˆ†æ”¯ï¼Œå…·ä½“ç”¨æ³•æ˜¯ï¼Œå‡å¦‚ä½ çš„è¿œç¨‹ç‰ˆæœ¬åº“åæ˜¯ origin,åˆ™ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å…ˆæŸ¥çœ‹å“ªäº›åˆ†æ”¯éœ€è¦æ¸…ç†ï¼š\n$ git remote prune origin --dry-run ä¿®å‰ª origin URLï¼šgit@yuhu.github.com:yuhu-tech/grampus-contracts.git * [å°†åˆ é™¤] origin/cq-2021-0227_refactor * [å°†åˆ é™¤] origin/lichagn-feat-impl-grc20 * [å°†åˆ é™¤] origin/lichagn-feat-impl-grc20-em20-em721 * [å°†åˆ é™¤] origin/lichang-feat-add-some-support-for-ANT * [å°†åˆ é™¤] origin/lichang-feat-impl-20-and-720 * [å°†åˆ é™¤] origin/lichang-feat-mdy-20 * [å°†åˆ é™¤] origin/lichang-feat-mdy-20-and-721 * [å°†åˆ é™¤] origin/litao-dev * [å°†åˆ é™¤] origin/runjam-v0.0.2 å¯ä»¥çœ‹åˆ°ï¼Œ ä»¥ä¸Šåˆ†æ”¯å·²ç»å¤±æ•ˆï¼Œå°†è¢«åˆ é™¤ï¼Œæ‰§è¡Œ\n$ git remote prune origin ä¿®å‰ª origin URLï¼šgit@yuhu.github.com:yuhu-tech/grampus-contracts.git * [å·²åˆ é™¤] origin/cq-2021-0227_refactor * [å·²åˆ é™¤] origin/lichagn-feat-impl-grc20 * [å·²åˆ é™¤] origin/lichagn-feat-impl-grc20-em20-em721 * [å·²åˆ é™¤] origin/lichang-feat-add-some-support-for-ANT * [å·²åˆ é™¤] origin/lichang-feat-impl-20-and-720 * [å·²åˆ é™¤] origin/lichang-feat-mdy-20 * [å·²åˆ é™¤] origin/lichang-feat-mdy-20-and-721 * [å·²åˆ é™¤] origin/litao-dev * [å·²åˆ é™¤] origin/runjam-v0.","title":"æ¸…ç†æœ¬åœ°åˆ†æ”¯"},{"content":"1. ä»€ä¹ˆæ˜¯åŒè´¨åŒ–ä»£å¸ï¼ˆFTï¼‰ åŒè´¨åŒ–ä»£å¸æ˜¯ä¸€ç§èƒ½å¤Ÿç›¸äº’æ›¿æ¢ï¼Œå…·æœ‰ç»Ÿä¸€æ€§ï¼Œå¯æ¥è¿‘æ— ç©·æ‹†åˆ†çš„ä»£å¸ã€‚åœ¨åŒè´¨åŒ–ä»£å¸çš„äº¤æ˜“ä¸­ï¼Œåªéœ€è¦å…³æ³¨ä»£å¸äº¤æ¥çš„æ•°é‡å³å¯ï¼Œå…¶ä»·å€¼å¯èƒ½ä¼šæ ¹æ®äº¤æ¢çš„æ—¶é—´é—´éš”è€Œæ”¹å˜ï¼Œä½†å…¶æœ¬è´¨æ²¡æœ‰å‘ç”Ÿå˜åŒ–ã€‚ ä¸¾ä¾‹æ¥è¯´ï¼Œç¾å…ƒï¼Œäººæ°‘å¸éƒ½æ˜¯åŒè´¨åŒ–ä»£å¸ï¼Œè™½ç„¶æ¯ä¸€å¼ ç¾å…ƒæˆ–äººæ°‘å¸çš„åºå·ä¸åŒï¼Œä½†åœ¨é¢é¢ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œä¸åŒåºå·çš„å¸å¯¹æŒæœ‰è€…æ¥è¯´æ²¡æœ‰åŒºåˆ«ã€‚\n2. ä»€ä¹ˆæ˜¯éåŒè´¨åŒ–ä»£å¸(NFT) Non-Fungible Tokens\néåŒè´¨åŒ–ä»£å¸åŒ…å«äº†è®°å½•åœ¨å…¶æ™ºèƒ½åˆçº¦ä¸­çš„è¯†åˆ«ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯ä½¿æ¯ç§ä»£å¸å…·æœ‰å…¶ç‹¬ç‰¹æ€§ï¼Œå› æ­¤ä¸èƒ½è¢«å¦ä¸€ç§ä»£å¸ç›´æ¥å–ä»£ã€‚å®ƒä»¬ä¸èƒ½ä»¥ä¸€æ¢ä¸€ï¼Œå› ä¸ºæ²¡æœ‰ä¸¤ä¸ª NFT æ˜¯ç›¸åŒçš„ã€‚ æ­¤å¤–ï¼ŒéåŒè´¨åŒ–ä»£å¸ä¹Ÿä¸å¯åˆ†å‰²ï¼Œå°±åƒä¸èƒ½é€ç»™åˆ«äººæ¼”å”±ä¼šé—¨ç¥¨çš„ä¸€éƒ¨åˆ†ä¸€æ ·ï¼Œé—¨ç¥¨çš„ä¸€éƒ¨åˆ†å¹¶ä¸å€¼é’±ä¹Ÿä¸èƒ½å…‘æ¢ã€‚ éåŒè´¨åŒ–çš„ç‹¬ç‰¹å±æ€§ä½¿å¾—å®ƒé€šå¸¸ä¸ç‰¹å®šèµ„äº§æŒ‚é’©ï¼Œå¯ä»¥ç”¨æ¥è¯æ˜æ•°å­—ç‰©å“ï¼ˆå¦‚æ¸¸æˆçš®è‚¤ï¼‰çš„æ‰€æœ‰æƒï¼Œç”šè‡³å®ç‰©èµ„äº§çš„æ‰€æœ‰æƒï¼Œä¸»è¦åº”ç”¨äºæ¸¸æˆå’ŒåŠ å¯†æ”¶è—å“é¢†åŸŸã€‚ FT å’Œ NFT çš„ä¸€å¤§åŒºåˆ«åœ¨äºä½¿ç”¨äº†ä¸åŒçš„åˆçº¦æ¥å£ï¼Œå‰è€…ä¸º ERC-20ï¼Œåè€…ä¸º ERC-721ã€‚\n3. ä»€ä¹ˆæ˜¯ERC-20? ERC-20 åè®®æ˜¯ä»¥å¤ªåŠåŒºå—é“¾è¾ƒæ—©çš„ã€æ¯”è¾ƒæµè¡Œçš„ä»£å¸è§„æ ¼åè®®ã€‚è‹¥ä»¥å¤ªåŠå¹³å°ä¸Šä¸¤ç§ä»£å¸éƒ½ä»¥ ERC-20 å‘è¡Œï¼Œåˆ™ä¸¤è€…ä¹‹é—´å¯ä»¥è¿›è¡Œè‡ªç”±ç½®æ¢ã€‚ERC20 æ˜¯æ ‡å‡†ä»£å¸æ¥å£ï¼Œè§„å®šäº†å…¶åŸºæœ¬åŠŸèƒ½ , æ–¹ä¾¿ç¬¬ä¸‰æ–¹ä½¿ç”¨ã€‚ç³»ç»Ÿå¼€æºä½¿å¾— ERC20 çš„æ ‡å‡†å·²ç»ç®€å•åˆ°å¯ä»¥ 5 åˆ†é’Ÿå‘è¡Œä¸€ä¸ª ERC-20 ä»£å¸ã€‚ERC-20 ä»£å¸å¬å‘½äºåŒä¸€ç»„ä»£å¸åˆçº¦çš„å‘½ä»¤ï¼Œä¹Ÿå°±æ„å‘³ç€æ‰€æœ‰ ERC-20 åè®®ä¸­çš„ä»£å¸éƒ½å¯è½»æ¾å®ç°è½¬ç§»ã€è¯·æ±‚ã€æ‰¹å‡†ç­‰åŠŸèƒ½ï¼Œä½†å…¶åŠŸèƒ½å› æ­¤ä¹Ÿå…·æœ‰å±€é™æ€§ã€‚\n4. ä»€ä¹ˆæ˜¯ERC-721ï¼Ÿ ç›¸æ¯”äº ERC-20ï¼ŒERC-721 åè®®åŠŸèƒ½æ›´å¤šä¸”æŠ€æœ¯æ›´å…ˆè¿›ã€‚è¯¥åè®®æ˜¯ä»¥å¤ªåŠçš„é’ˆå¯¹ä¸å¯ç½®æ¢ä»£å¸çš„ NFT æ•°å­—èµ„äº§çš„ç¬¬ä¸€ä¸ªæ ‡å‡†ï¼Œåº”ç”¨äº CryptoKittiesã€Decentraland ç­‰é¡¹ç›®ã€‚ERC721 æ ‡å‡†æ­£æ˜¯ç”± CryptoKitties çš„ CTO Dieter Shirley æ‰€åˆ›å»ºå’Œå‘å¸ƒçš„ï¼ŒDieter Shirley æ˜¯ NFT çš„å¥ åŸºäººä¹‹ä¸€ã€‚\nè™½ç„¶ ERC-721 è¾ƒ ERC-20 ç”¨ä¾‹è¾ƒå°‘ï¼ŒåŠŸèƒ½è¿˜å¤„äºæ¢ç´¢ä¹‹ç”¨ï¼Œä½† 721 åè®®ä¸‹çš„èµ„äº§â€”â€”ç”»ä½œã€å€ºåˆ¸ã€æˆ¿å­æˆ–æ˜¯æ±½è½¦â€”â€”çš„ä¼˜åŠ¿åœ¨äºèƒ½ä¿è¯æ‰€æœ‰æƒçš„å®‰å…¨æ€§ã€æ‰€æœ‰æƒè½¬ç§»çš„ä¾¿æ·æ€§ä»¥åŠæ‰€æœ‰æƒå†å²çš„ä¸å¯æ›´æ”¹æ€§å’Œé€æ˜æ€§ã€‚å¦å¤–ï¼ŒERC721 è¿˜å¯ä»¥ä¿ƒè¿›è¿½è¸ªã€äº¤æ˜“å’Œç®¡ç†çœŸå®èµ„ äº§çš„äº¤æ˜“å’Œç®¡ç†ç­‰ç­‰ã€‚éšç€æ¸¸æˆè™šæ‹Ÿèµ„äº§ä¸æ–­æµè¡Œèµ·æ¥ï¼Œ5G å’Œ VR ä¸æ–­æ™®åŠï¼Œæ­è½½åŒºå—é“¾æŠ€æœ¯ï¼Œ721 åè®®å‰æ™¯ä¸€ç‰‡å…‰æ˜ã€‚\n","permalink":"http://yangchnet.github.io/Dessert/posts/%E5%8C%BA%E5%9D%97%E9%93%BE/%E5%90%8C%E8%B4%A8%E5%8C%96%E4%BB%A3%E5%B8%81%E5%92%8C%E9%9D%9E%E5%90%8C%E8%B4%A8%E5%8C%96%E4%BB%A3%E5%B8%81/","summary":"1. ä»€ä¹ˆæ˜¯åŒè´¨åŒ–ä»£å¸ï¼ˆFTï¼‰ åŒè´¨åŒ–ä»£å¸æ˜¯ä¸€ç§èƒ½å¤Ÿç›¸äº’æ›¿æ¢ï¼Œå…·æœ‰ç»Ÿä¸€æ€§ï¼Œå¯æ¥è¿‘æ— ç©·æ‹†åˆ†çš„ä»£å¸ã€‚åœ¨åŒè´¨åŒ–ä»£å¸çš„äº¤æ˜“ä¸­ï¼Œåªéœ€è¦å…³æ³¨ä»£å¸äº¤æ¥çš„æ•°é‡å³å¯ï¼Œå…¶ä»·å€¼å¯èƒ½ä¼šæ ¹æ®äº¤æ¢çš„æ—¶é—´é—´éš”è€Œæ”¹å˜ï¼Œä½†å…¶æœ¬è´¨æ²¡æœ‰å‘ç”Ÿå˜åŒ–ã€‚ ä¸¾ä¾‹æ¥è¯´ï¼Œç¾å…ƒï¼Œäººæ°‘å¸éƒ½æ˜¯åŒè´¨åŒ–ä»£å¸ï¼Œè™½ç„¶æ¯ä¸€å¼ ç¾å…ƒæˆ–äººæ°‘å¸çš„åºå·ä¸åŒï¼Œä½†åœ¨é¢é¢ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œä¸åŒåºå·çš„å¸å¯¹æŒæœ‰è€…æ¥è¯´æ²¡æœ‰åŒºåˆ«ã€‚\n2. ä»€ä¹ˆæ˜¯éåŒè´¨åŒ–ä»£å¸(NFT) Non-Fungible Tokens\néåŒè´¨åŒ–ä»£å¸åŒ…å«äº†è®°å½•åœ¨å…¶æ™ºèƒ½åˆçº¦ä¸­çš„è¯†åˆ«ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯ä½¿æ¯ç§ä»£å¸å…·æœ‰å…¶ç‹¬ç‰¹æ€§ï¼Œå› æ­¤ä¸èƒ½è¢«å¦ä¸€ç§ä»£å¸ç›´æ¥å–ä»£ã€‚å®ƒä»¬ä¸èƒ½ä»¥ä¸€æ¢ä¸€ï¼Œå› ä¸ºæ²¡æœ‰ä¸¤ä¸ª NFT æ˜¯ç›¸åŒçš„ã€‚ æ­¤å¤–ï¼ŒéåŒè´¨åŒ–ä»£å¸ä¹Ÿä¸å¯åˆ†å‰²ï¼Œå°±åƒä¸èƒ½é€ç»™åˆ«äººæ¼”å”±ä¼šé—¨ç¥¨çš„ä¸€éƒ¨åˆ†ä¸€æ ·ï¼Œé—¨ç¥¨çš„ä¸€éƒ¨åˆ†å¹¶ä¸å€¼é’±ä¹Ÿä¸èƒ½å…‘æ¢ã€‚ éåŒè´¨åŒ–çš„ç‹¬ç‰¹å±æ€§ä½¿å¾—å®ƒé€šå¸¸ä¸ç‰¹å®šèµ„äº§æŒ‚é’©ï¼Œå¯ä»¥ç”¨æ¥è¯æ˜æ•°å­—ç‰©å“ï¼ˆå¦‚æ¸¸æˆçš®è‚¤ï¼‰çš„æ‰€æœ‰æƒï¼Œç”šè‡³å®ç‰©èµ„äº§çš„æ‰€æœ‰æƒï¼Œä¸»è¦åº”ç”¨äºæ¸¸æˆå’ŒåŠ å¯†æ”¶è—å“é¢†åŸŸã€‚ FT å’Œ NFT çš„ä¸€å¤§åŒºåˆ«åœ¨äºä½¿ç”¨äº†ä¸åŒçš„åˆçº¦æ¥å£ï¼Œå‰è€…ä¸º ERC-20ï¼Œåè€…ä¸º ERC-721ã€‚\n3. ä»€ä¹ˆæ˜¯ERC-20? ERC-20 åè®®æ˜¯ä»¥å¤ªåŠåŒºå—é“¾è¾ƒæ—©çš„ã€æ¯”è¾ƒæµè¡Œçš„ä»£å¸è§„æ ¼åè®®ã€‚è‹¥ä»¥å¤ªåŠå¹³å°ä¸Šä¸¤ç§ä»£å¸éƒ½ä»¥ ERC-20 å‘è¡Œï¼Œåˆ™ä¸¤è€…ä¹‹é—´å¯ä»¥è¿›è¡Œè‡ªç”±ç½®æ¢ã€‚ERC20 æ˜¯æ ‡å‡†ä»£å¸æ¥å£ï¼Œè§„å®šäº†å…¶åŸºæœ¬åŠŸèƒ½ , æ–¹ä¾¿ç¬¬ä¸‰æ–¹ä½¿ç”¨ã€‚ç³»ç»Ÿå¼€æºä½¿å¾— ERC20 çš„æ ‡å‡†å·²ç»ç®€å•åˆ°å¯ä»¥ 5 åˆ†é’Ÿå‘è¡Œä¸€ä¸ª ERC-20 ä»£å¸ã€‚ERC-20 ä»£å¸å¬å‘½äºåŒä¸€ç»„ä»£å¸åˆçº¦çš„å‘½ä»¤ï¼Œä¹Ÿå°±æ„å‘³ç€æ‰€æœ‰ ERC-20 åè®®ä¸­çš„ä»£å¸éƒ½å¯è½»æ¾å®ç°è½¬ç§»ã€è¯·æ±‚ã€æ‰¹å‡†ç­‰åŠŸèƒ½ï¼Œä½†å…¶åŠŸèƒ½å› æ­¤ä¹Ÿå…·æœ‰å±€é™æ€§ã€‚\n4. ä»€ä¹ˆæ˜¯ERC-721ï¼Ÿ ç›¸æ¯”äº ERC-20ï¼ŒERC-721 åè®®åŠŸèƒ½æ›´å¤šä¸”æŠ€æœ¯æ›´å…ˆè¿›ã€‚è¯¥åè®®æ˜¯ä»¥å¤ªåŠçš„é’ˆå¯¹ä¸å¯ç½®æ¢ä»£å¸çš„ NFT æ•°å­—èµ„äº§çš„ç¬¬ä¸€ä¸ªæ ‡å‡†ï¼Œåº”ç”¨äº CryptoKittiesã€Decentraland ç­‰é¡¹ç›®ã€‚ERC721 æ ‡å‡†æ­£æ˜¯ç”± CryptoKitties çš„ CTO Dieter Shirley æ‰€åˆ›å»ºå’Œå‘å¸ƒçš„ï¼ŒDieter Shirley æ˜¯ NFT çš„å¥ åŸºäººä¹‹ä¸€ã€‚\nè™½ç„¶ ERC-721 è¾ƒ ERC-20 ç”¨ä¾‹è¾ƒå°‘ï¼ŒåŠŸèƒ½è¿˜å¤„äºæ¢ç´¢ä¹‹ç”¨ï¼Œä½† 721 åè®®ä¸‹çš„èµ„äº§â€”â€”ç”»ä½œã€å€ºåˆ¸ã€æˆ¿å­æˆ–æ˜¯æ±½è½¦â€”â€”çš„ä¼˜åŠ¿åœ¨äºèƒ½ä¿è¯æ‰€æœ‰æƒçš„å®‰å…¨æ€§ã€æ‰€æœ‰æƒè½¬ç§»çš„ä¾¿æ·æ€§ä»¥åŠæ‰€æœ‰æƒå†å²çš„ä¸å¯æ›´æ”¹æ€§å’Œé€æ˜æ€§ã€‚å¦å¤–ï¼ŒERC721 è¿˜å¯ä»¥ä¿ƒè¿›è¿½è¸ªã€äº¤æ˜“å’Œç®¡ç†çœŸå®èµ„ äº§çš„äº¤æ˜“å’Œç®¡ç†ç­‰ç­‰ã€‚éšç€æ¸¸æˆè™šæ‹Ÿèµ„äº§ä¸æ–­æµè¡Œèµ·æ¥ï¼Œ5G å’Œ VR ä¸æ–­æ™®åŠï¼Œæ­è½½åŒºå—é“¾æŠ€æœ¯ï¼Œ721 åè®®å‰æ™¯ä¸€ç‰‡å…‰æ˜ã€‚","title":"åŒè´¨åŒ–ä»£å¸å’ŒéåŒè´¨åŒ–ä»£å¸"},{"content":" ubuntuç¯å¢ƒ\n 0. æ‹‰å–githubä»“åº“çš„ä¸¤ç§æ–¹å¼ åœ¨æ‹‰å–githubä»“åº“æ—¶ï¼Œæˆ‘ä»¬å¸¸ç”¨\ngit clone https://github.com/username/repoName.git çš„æ–¹å¼ï¼Œè¿™ç§æ–¹å¼ä½¿ç”¨httpsåè®® è¿˜å¯ä»¥ä½¿ç”¨sshåè®®ï¼Œä»¥å¦‚ä¸‹æ–¹å¼æ‹‰å–ä»“åº“\ngit clone git@github.com:username/repoName.git ä»¥ä¸‹ä»‹ç»çš„è®¾ç½®æ–¹æ³•ï¼ŒåŸºäºsshåè®®ã€‚\n1. ä½¿ç”¨SSHè¿æ¥åˆ°GitHub ä½¿ç”¨ SSH åè®®å¯ä»¥è¿æ¥è¿œç¨‹æœåŠ¡å™¨å’ŒæœåŠ¡å¹¶å‘å®ƒä»¬éªŒè¯ã€‚ åˆ©ç”¨ SSH å¯†é’¥å¯ä»¥è¿æ¥ GitHubï¼Œè€Œæ— éœ€åœ¨æ¯æ¬¡è®¿é—®æ—¶éƒ½æä¾›ç”¨æˆ·åå’Œä¸ªäººè®¿é—®ä»¤ç‰Œã€‚\næ£€æŸ¥ç°æœ‰SSHç§˜é’¥ åœ¨ç”Ÿæˆ SSH å¯†é’¥ä¹‹å‰ï¼Œæ‚¨å¯ä»¥æ£€æŸ¥æ˜¯å¦æœ‰ä»»ä½•ç°æœ‰çš„ SSH å¯†é’¥ã€‚\n$ ls -al ~/.ssh # Lists the files in your .ssh directory, if they exist å¦‚æœä½ çš„ä¸»æœºä¸Šå·²æœ‰SSHå…¬é’¥ï¼Œåˆ™å…¶å¯èƒ½æ˜¯å¦‚ä¸‹ï¼š\nid_rsa.pub id_ecdsa.pub id_ed25519.pub å¦‚æœä½ æ²¡æœ‰ç°æœ‰çš„å…¬é’¥å’Œç§é’¥å¯¹ï¼Œæˆ–è€…ä¸æƒ³ä½¿ç”¨ç°æœ‰çš„ç§˜é’¥è¿æ¥åˆ°githubï¼Œåˆ™å¯ä»¥ç”Ÿæˆæ–°çš„SSHç§˜é’¥ã€‚\nç”Ÿæˆæ–°SSHç§˜é’¥ è¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼š\nssh-keygen -t rsa -C \u0026#34;your_email@example.com\u0026#34; ä¼šæœ‰å¦‚ä¸‹è¾“å‡ºï¼š\nGenerating public/private rsa key pair. Enter file in which to save the key (/home/lc/.ssh/id_rsa): # å¯ä»¥ç›´æ¥å›è½¦ä½¿ç”¨é»˜è®¤ä½ç½® Enter passphrase (empty for no passphrase): # ä¹Ÿå¯ç›´æ¥å›è½¦ ç„¶åå°±å¯ä»¥åœ¨ä½ çš„~/.sshç›®å½•ä¸‹ç”Ÿæˆæ–°çš„ç§˜é’¥\næ·»åŠ ç§˜é’¥åˆ°ssh-agent å¯åŠ¨ssh-agent\neval \u0026#34;$(ssh-agent -s)\u0026#34; # è¾“å‡ºï¼š Agent pid 59566 æ·»åŠ \nssh-add ~/.ssh/id_rsa æ–°å¢ SSH å¯†é’¥åˆ° GitHub å¸æˆ· å¤åˆ¶ä½ çš„sshç§˜é’¥ï¼ˆid_rsa.pubæ–‡ä»¶å†…å®¹ï¼‰ï¼Œæ‰“å¼€github ç‚¹å‡»new ssh key,å°†ä½ çš„ç§˜é’¥å¤åˆ¶åˆ°å¯¹åº”çš„ä½ç½® æµ‹è¯•ä½ çš„ç§˜é’¥æ˜¯å¦ç”Ÿæ•ˆ ssh -T git@github.com # Hi yenian! You\u0026#39;ve successfully authenticated, but GitHub does not provide shell access. 2. è®¾ç½®ä¸¤ä¸ªgithubè´¦æˆ· å–æ¶ˆå·²æœ‰çš„å…¨å±€é…ç½® git config --global --unset user.name git config --global --unset user.email ç”Ÿæˆä¸¤ä¸ªæ–°çš„sshç§˜é’¥ è¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼š\nssh-keygen -t rsa -C \u0026#34;your_email@example.com\u0026#34; ä¼šæœ‰å¦‚ä¸‹è¾“å‡ºï¼š\nGenerating public/private rsa key pair. Enter file in which to save the key (/home/lc/.ssh/id_rsa): # è¿™é‡Œè¦ä¸ºä¸¤ä¸ªç§˜é’¥å®šä¹‰ä¸åŒçš„æ–‡ä»¶å Enter passphrase (empty for no passphrase): # ä¹Ÿå¯ç›´æ¥å›è½¦ è¿™é‡Œè¦æ³¨æ„çš„æ˜¯è®¾ç½®æ–‡ä»¶åæ—¶ä¸èƒ½ç›´æ¥è·³è¿‡ï¼Œè¦ä¸ºä¸¤ä¸ªç§˜é’¥å®šä¹‰ä¸åŒçš„æ–‡ä»¶åï¼Œæ¯”å¦‚æ‰€ä¸€ä¸ªä¸ºid_rsa, å¦ä¸€ä¸ªä¸ºid_rsa_work ï¼Œå…¶ä¸­workå¯ä»¥è®¾ç½®ä½ çš„å·¥ä½œgitç”¨æˆ·åã€‚åˆ†åˆ«ç”¨äºä½ ä¸ªäººå’Œå·¥ä½œç”¨çš„githubè´¦å·ã€‚\nå°†ä¸¤ä¸ªç§˜é’¥åˆ†åˆ«åŠ å…¥å¯¹åº”çš„githubè´¦å· \u0026hellip; å¦‚ä¸Š \u0026hellip;\né…ç½® ~/.ssh/config æ–‡ä»¶ æ‰“å¼€~/.ssh/config æ–‡ä»¶ï¼ˆæ²¡æœ‰åˆ™åˆ›å»ºï¼‰\nvim ~/.ssh/config æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\n# default github account Host github.com HostName github.com User git IdentityFile ~/.ssh/id_rsa_one Host work.github.com HostName github.com User git IdentityFile ~/.ssh/id_rsa_two æµ‹è¯•æ˜¯å¦è®¾ç½®æˆåŠŸ ssh -T git@work.github.com # Hi $yourWorkAccountName$! You\u0026#39;ve successfully authenticated, but GitHub does not provide shell access. ssh -T git@github.com # Hi $yourPersonAccountName$! You\u0026#39;ve successfully authenticated, but GitHub does not provide shell access. è¿˜éœ€è¦åšä»€ä¹ˆ å¦‚æœä½ è¦ä»¥å·¥ä½œè´¦æˆ·çš„èº«ä»½å»æ‹‰å–æŸä¸ªåº“ï¼Œé‚£ä¹ˆä½ éœ€è¦å°†åŸæ¥ç”¨çš„\ngit clone git@github.com:username/repository-name.git æ›¿æ¢ä¸º\ngit clone git@work.github.com:username/repository-name.git å’Œæˆ‘ä»¬çš„configç›¸å¯¹åº”\nè€Œå¦‚æœç›´æ¥ä½¿ç”¨åŸå‘½ä»¤ï¼Œå³\ngit clone git@github.com:username/repository-name.git é‚£ä¹ˆé»˜è®¤ä½¿ç”¨çš„æ˜¯ä½ ä¸ªäººè´¦æˆ·ã€‚\nå¦‚æœä½ æƒ³è¦ä¸ºä½ ä¸€ä¸ªå·²æœ‰çš„ä»“åº“æŒ‡å®šè´¦æˆ·ï¼Œå¯ä½¿ç”¨\ngit remote origin set-url git@work.github.com:username/repository-name.git # æŒ‡å®šå·¥ä½œè´¦æˆ· ","permalink":"http://yangchnet.github.io/Dessert/posts/git/%E4%B8%BB%E6%9C%BA%E4%B8%8A%E8%AE%BE%E7%BD%AE%E4%B8%A4%E4%B8%AAgit%E8%B4%A6%E5%8F%B7/","summary":"ubuntuç¯å¢ƒ\n 0. æ‹‰å–githubä»“åº“çš„ä¸¤ç§æ–¹å¼ åœ¨æ‹‰å–githubä»“åº“æ—¶ï¼Œæˆ‘ä»¬å¸¸ç”¨\ngit clone https://github.com/username/repoName.git çš„æ–¹å¼ï¼Œè¿™ç§æ–¹å¼ä½¿ç”¨httpsåè®® è¿˜å¯ä»¥ä½¿ç”¨sshåè®®ï¼Œä»¥å¦‚ä¸‹æ–¹å¼æ‹‰å–ä»“åº“\ngit clone git@github.com:username/repoName.git ä»¥ä¸‹ä»‹ç»çš„è®¾ç½®æ–¹æ³•ï¼ŒåŸºäºsshåè®®ã€‚\n1. ä½¿ç”¨SSHè¿æ¥åˆ°GitHub ä½¿ç”¨ SSH åè®®å¯ä»¥è¿æ¥è¿œç¨‹æœåŠ¡å™¨å’ŒæœåŠ¡å¹¶å‘å®ƒä»¬éªŒè¯ã€‚ åˆ©ç”¨ SSH å¯†é’¥å¯ä»¥è¿æ¥ GitHubï¼Œè€Œæ— éœ€åœ¨æ¯æ¬¡è®¿é—®æ—¶éƒ½æä¾›ç”¨æˆ·åå’Œä¸ªäººè®¿é—®ä»¤ç‰Œã€‚\næ£€æŸ¥ç°æœ‰SSHç§˜é’¥ åœ¨ç”Ÿæˆ SSH å¯†é’¥ä¹‹å‰ï¼Œæ‚¨å¯ä»¥æ£€æŸ¥æ˜¯å¦æœ‰ä»»ä½•ç°æœ‰çš„ SSH å¯†é’¥ã€‚\n$ ls -al ~/.ssh # Lists the files in your .ssh directory, if they exist å¦‚æœä½ çš„ä¸»æœºä¸Šå·²æœ‰SSHå…¬é’¥ï¼Œåˆ™å…¶å¯èƒ½æ˜¯å¦‚ä¸‹ï¼š\nid_rsa.pub id_ecdsa.pub id_ed25519.pub å¦‚æœä½ æ²¡æœ‰ç°æœ‰çš„å…¬é’¥å’Œç§é’¥å¯¹ï¼Œæˆ–è€…ä¸æƒ³ä½¿ç”¨ç°æœ‰çš„ç§˜é’¥è¿æ¥åˆ°githubï¼Œåˆ™å¯ä»¥ç”Ÿæˆæ–°çš„SSHç§˜é’¥ã€‚\nç”Ÿæˆæ–°SSHç§˜é’¥ è¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼š\nssh-keygen -t rsa -C \u0026#34;your_email@example.com\u0026#34; ä¼šæœ‰å¦‚ä¸‹è¾“å‡ºï¼š\nGenerating public/private rsa key pair. Enter file in which to save the key (/home/lc/.","title":"ä¸»æœºä¸Šè®¾ç½®ä¸¤ä¸ªgitè´¦å·"},{"content":"ä½¿ç”¨git logå‘½ä»¤æŸ¥çœ‹gitæ—¥å¿—æ–‡ä»¶ï¼Œå‡è®¾ä¸ºå¦‚ä¸‹å†…å®¹\ncommit cc7b5fc7bd2ae6f8d88144cd61c8ffad15d44e41 Author: yangchnet \u0026lt;1048887414@qq.com\u0026gt; Date: Sun Apr 25 19:40:03 2021 +0800 4-25 commit fbd7265095b4c8989fba830393eb32ef29cd9ee1 Merge: 3ae3c19 6a25204 Author: yangchnet \u0026lt;1048887414@qq.com\u0026gt; Date: Sun Apr 25 15:04:38 2021 +0800 Merge branch 'master' of https://github.com/yangchnet/Tem commit 6a25204187602449bfe4ca8c862c9677e65fed04 Author: yangchnet \u0026lt;30308940+yangchnet@users.noreply.github.com\u0026gt; Date: Thu Apr 22 21:36:05 2021 +0800 Delete CNAME ... ç°åœ¨æƒ³åˆå¹¶æœ€åä¸¤ä¸ªæäº¤ï¼Œåˆ™è¿›è¡Œä»¥ä¸‹æ­¥éª¤ï¼š\n å¤åˆ¶å€’æ•°ç¬¬ä¸‰ä¸ªæäº¤çš„å“ˆå¸Œå€¼ï¼Œå³ï¼š6a25204187602449bfe4ca8c862c9677e65fed04 ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡Œåˆå¹¶ï¼š  git rebase -i 6a25204187602449bfe4ca8c862c9677e65fed04 # è¿™ä¸ªå“ˆå¸Œå€¼å°±æ˜¯ä½ åˆšæ‰å¤åˆ¶çš„ è‹¥æœ‰å¦‚ä¸‹æç¤ºï¼Œè¯·è¿›è¡Œç¬¬4æ­¥ï¼Œå¦åˆ™ç›´æ¥è¿›è¡Œç¬¬5æ­¥  ä¸èƒ½å˜åŸºï¼šæ‚¨æœ‰æœªæš‚å­˜çš„å˜æ›´ã€‚ è¯·æäº¤æˆ–ä¸ºå®ƒä»¬ä¿å­˜è¿›åº¦ã€‚ ä½¿ç”¨git stashæš‚å­˜ä¿®æ”¹  $ git stash ä¿å­˜å·¥ä½œç›®å½•å’Œç´¢å¼•çŠ¶æ€ WIP on master: cc7b5fc 4-25 HEAD ç°åœ¨ä½äº cc7b5fc 4-25 ä½¿ç”¨git rebaseåï¼Œä¼šå‡ºç°å¦‚ä¸‹å†…å®¹  pick 3ae3c19 å¢åŠ graphqlä»‹ç» pick cc7b5fc 4-25 # å˜åŸº 6a25204..cc7b5fc åˆ° 6a25204ï¼ˆ2 ä¸ªæäº¤ï¼‰ # # å‘½ä»¤: # p, pick = ä½¿ç”¨æäº¤ # r, reword = ä½¿ç”¨æäº¤ï¼Œä½†ä¿®æ”¹æäº¤è¯´æ˜ # e, edit = ä½¿ç”¨æäº¤ï¼Œä½†åœæ­¢ä»¥ä¾¿è¿›è¡Œæäº¤ä¿®è¡¥ # s, squash = ä½¿ç”¨æäº¤ï¼Œä½†å’Œå‰ä¸€ä¸ªç‰ˆæœ¬èåˆ # f, fixup = ç±»ä¼¼äº \u0026quot;squash\u0026quot;ï¼Œä½†ä¸¢å¼ƒæäº¤è¯´æ˜æ—¥å¿— # x, exec = ä½¿ç”¨ shell è¿è¡Œå‘½ä»¤ï¼ˆæ­¤è¡Œå‰©ä½™éƒ¨åˆ†ï¼‰ # d, drop = åˆ é™¤æäº¤ # # è¿™äº›è¡Œå¯ä»¥è¢«é‡æ–°æ’åºï¼›å®ƒä»¬ä¼šè¢«ä»ä¸Šè‡³ä¸‹åœ°æ‰§è¡Œã€‚ # # # å¦‚æœæ‚¨åœ¨è¿™é‡Œåˆ é™¤ä¸€è¡Œï¼Œå¯¹åº”çš„æäº¤å°†ä¼šä¸¢å¤±ã€‚ # # ç„¶è€Œï¼Œå¦‚æœæ‚¨åˆ é™¤å…¨éƒ¨å†…å®¹ï¼Œå˜åŸºæ“ä½œå°†ä¼šç»ˆæ­¢ã€‚ # # æ³¨æ„ç©ºæäº¤å·²è¢«æ³¨é‡Šæ‰ å‰ä¸¤è¡Œä¸ºä½ æƒ³è¦åˆå¹¶çš„commitï¼ŒæŒ‰ç…§æ³¨é‡Šå†…å®¹ï¼Œè¦ä¿ç•™çš„commitå¼€å¤´ä¸å˜ï¼Œè¦åˆå¹¶åˆ°å¦ä¸€ä¸ªçš„å¼€å¤´è®¾ä¸ºsï¼Œæ„ä¸ºï¼šä½¿ç”¨æäº¤ï¼Œä½†å’Œå‰ä¸€ä¸ªç‰ˆæœ¬èåˆ ï¼ˆå¯ä»¥æŒ‰ç…§ä½ çš„éœ€æ±‚æ”¹å˜ï¼‰ï¼Œæ›´æ”¹å®Œæˆåä¿å­˜ã€‚\nä¿å­˜å®Œæˆåä¼šå‡ºç°å¦‚ä¸‹å†…å®¹  # è¿™æ˜¯ä¸€ä¸ª 2 ä¸ªæäº¤çš„ç»„åˆã€‚ # è¿™æ˜¯ç¬¬ä¸€ä¸ªæäº¤è¯´æ˜ï¼š å¢åŠ graphqlä»‹ç» # è¿™æ˜¯æäº¤è¯´æ˜ #2ï¼š 4-25 # è¯·ä¸ºæ‚¨çš„å˜æ›´è¾“å…¥æäº¤è¯´æ˜ã€‚ä»¥ '#' å¼€å§‹çš„è¡Œå°†è¢«å¿½ç•¥ï¼Œè€Œä¸€ä¸ªç©ºçš„æäº¤ # è¯´æ˜å°†ä¼šç»ˆæ­¢æäº¤ã€‚ # ... è¿™æ˜¯ä½ çš„commitçš„è¯´æ˜ï¼Œå°†ä½ æƒ³ä¿ç•™çš„commitè¯´æ˜ä¿ç•™ï¼Œä¸æƒ³è¦çš„ç›´æ¥åˆ é™¤ã€‚ä¿å­˜ä¹‹ã€‚\nå†æ¬¡æŸ¥çœ‹git log, å¯ä»¥çœ‹åˆ°åˆšæ‰çš„æ›´æ”¹å·²ç»ç”Ÿæ•ˆã€‚  commit 2994a193577f4b4175b1fe7015db955df9143b89 Author: yangchnet \u0026lt;1048887414@qq.com\u0026gt; Date: Thu Apr 22 21:30:48 2021 +0800 å¢åŠ graphqlä»‹ç» commit 6a25204187602449bfe4ca8c862c9677e65fed04 Author: yangchnet \u0026lt;30308940+yangchnet@users.noreply.github.com\u0026gt; Date: Thu Apr 22 21:36:05 2021 +0800 Delete CNAME è‹¥è¿›è¡Œäº†ç¬¬4æ­¥ï¼Œåˆ™éœ€è¿›è¡Œæœ¬æ­¥éª¤  git stash pop ","permalink":"http://yangchnet.github.io/Dessert/posts/git/%E5%B0%86%E4%B8%A4%E4%B8%AAcommit%E5%90%88%E5%B9%B6%E4%B8%BA%E4%B8%80%E4%B8%AA/","summary":"ä½¿ç”¨git logå‘½ä»¤æŸ¥çœ‹gitæ—¥å¿—æ–‡ä»¶ï¼Œå‡è®¾ä¸ºå¦‚ä¸‹å†…å®¹\ncommit cc7b5fc7bd2ae6f8d88144cd61c8ffad15d44e41 Author: yangchnet \u0026lt;1048887414@qq.com\u0026gt; Date: Sun Apr 25 19:40:03 2021 +0800 4-25 commit fbd7265095b4c8989fba830393eb32ef29cd9ee1 Merge: 3ae3c19 6a25204 Author: yangchnet \u0026lt;1048887414@qq.com\u0026gt; Date: Sun Apr 25 15:04:38 2021 +0800 Merge branch 'master' of https://github.com/yangchnet/Tem commit 6a25204187602449bfe4ca8c862c9677e65fed04 Author: yangchnet \u0026lt;30308940+yangchnet@users.noreply.github.com\u0026gt; Date: Thu Apr 22 21:36:05 2021 +0800 Delete CNAME ... ç°åœ¨æƒ³åˆå¹¶æœ€åä¸¤ä¸ªæäº¤ï¼Œåˆ™è¿›è¡Œä»¥ä¸‹æ­¥éª¤ï¼š\n å¤åˆ¶å€’æ•°ç¬¬ä¸‰ä¸ªæäº¤çš„å“ˆå¸Œå€¼ï¼Œå³ï¼š6a25204187602449bfe4ca8c862c9677e65fed04 ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡Œåˆå¹¶ï¼š  git rebase -i 6a25204187602449bfe4ca8c862c9677e65fed04 # è¿™ä¸ªå“ˆå¸Œå€¼å°±æ˜¯ä½ åˆšæ‰å¤åˆ¶çš„ è‹¥æœ‰å¦‚ä¸‹æç¤ºï¼Œè¯·è¿›è¡Œç¬¬4æ­¥ï¼Œå¦åˆ™ç›´æ¥è¿›è¡Œç¬¬5æ­¥  ä¸èƒ½å˜åŸºï¼šæ‚¨æœ‰æœªæš‚å­˜çš„å˜æ›´ã€‚ è¯·æäº¤æˆ–ä¸ºå®ƒä»¬ä¿å­˜è¿›åº¦ã€‚ ä½¿ç”¨git stashæš‚å­˜ä¿®æ”¹  $ git stash ä¿å­˜å·¥ä½œç›®å½•å’Œç´¢å¼•çŠ¶æ€ WIP on master: cc7b5fc 4-25 HEAD ç°åœ¨ä½äº cc7b5fc 4-25 ä½¿ç”¨git rebaseåï¼Œä¼šå‡ºç°å¦‚ä¸‹å†…å®¹  pick 3ae3c19 å¢åŠ graphqlä»‹ç» pick cc7b5fc 4-25 # å˜åŸº 6a25204.","title":"å°†ä¸¤ä¸ªcommitåˆå¹¶ä¸ºä¸€ä¸ª"},{"content":"1. ä»€ä¹ˆæ˜¯Graphql GraphQL æ—¢æ˜¯ä¸€ç§ç”¨äº API çš„æŸ¥è¯¢è¯­è¨€ä¹Ÿæ˜¯ä¸€ä¸ªæ»¡è¶³ä½ æ•°æ®æŸ¥è¯¢çš„runtimeã€‚ GraphQLå¯¹ä½ çš„APIä¸­çš„æ•°æ®æä¾›äº†ä¸€å¥—æ˜“äºç†è§£çš„å®Œæ•´æè¿°ï¼Œä½¿å¾—å®¢æˆ·ç«¯èƒ½å¤Ÿå‡†ç¡®åœ°è·å¾—å®ƒéœ€è¦çš„æ•°æ®ï¼Œè€Œä¸”æ²¡æœ‰ä»»ä½•å†—ä½™ï¼Œä¹Ÿè®©APIæ›´å®¹æ˜“åœ°éšç€æ—¶é—´æ¨ç§»è€Œæ¼”è¿›ï¼Œè¿˜èƒ½ç”¨äºæ„å»ºå¼ºå¤§çš„å¼€å‘è€…å·¥å…·ã€‚ ä¸€ä¸ª GraphQL æœåŠ¡æ˜¯é€šè¿‡å®šä¹‰ç±»å‹å’Œç±»å‹ä¸Šçš„å­—æ®µæ¥åˆ›å»ºçš„ï¼Œç„¶åç»™æ¯ä¸ªç±»å‹ä¸Šçš„æ¯ä¸ªå­—æ®µæä¾›è§£æå‡½æ•°ã€‚\nç®€å•çš„è¯´ï¼ŒGraphQLä¸ºæˆ‘ä»¬å®šä¹‰æ•°æ®åº“æä¾›äº†æ›´ä¸ºä¾¿æ·çš„æ–¹å¼ï¼Œä½ ä¸éœ€è¦å†™ä»»ä½•SQLè¯­å¥ï¼Œå³å¯å®Œæˆæ•°æ®åº“çš„åˆ›å»ºåŠè¿ç§»ç­‰å·¥ä½œã€‚\n2. æ¦‚è§ˆ ä¾‹å¦‚ï¼Œä¸€ä¸ª GraphQL æœåŠ¡å‘Šè¯‰æˆ‘ä»¬å½“å‰ç™»å½•ç”¨æˆ·æ˜¯ meï¼Œè¿™ä¸ªç”¨æˆ·çš„åç§°å¯èƒ½åƒè¿™æ ·ï¼š\ntype Query { me: User } type User { id: ID name: String } ä¸€å¹¶çš„è¿˜æœ‰æ¯ä¸ªç±»å‹ä¸Šå­—æ®µçš„è§£æå‡½æ•°ï¼š\nfunction Query_me(request) { return request.auth.user; } function User_name(user) { return user.getName(); } ä¸€æ—¦ä¸€ä¸ª GraphQL æœåŠ¡è¿è¡Œèµ·æ¥ï¼ˆé€šå¸¸åœ¨ web æœåŠ¡çš„ä¸€ä¸ª URL ä¸Šï¼‰ï¼Œå®ƒå°±èƒ½æ¥æ”¶ GraphQL æŸ¥è¯¢ï¼Œå¹¶éªŒè¯å’Œæ‰§è¡Œã€‚æ¥æ”¶åˆ°çš„æŸ¥è¯¢é¦–å…ˆä¼šè¢«æ£€æŸ¥ç¡®ä¿å®ƒåªå¼•ç”¨äº†å·²å®šä¹‰çš„ç±»å‹å’Œå­—æ®µï¼Œç„¶åè¿è¡ŒæŒ‡å®šçš„è§£æå‡½æ•°æ¥ç”Ÿæˆç»“æœã€‚\nä¾‹å¦‚è¿™ä¸ªæŸ¥è¯¢ï¼š\n{ me { name } } ä¼šäº§ç”Ÿè¿™æ ·çš„JSONç»“æœï¼š\n{ \u0026#34;me\u0026#34;: { \u0026#34;name\u0026#34;: \u0026#34;Luke Skywalker\u0026#34; } } 3. Schema å’Œç±»å‹ GraphQL æœåŠ¡å¯ä»¥ç”¨ä»»ä½•è¯­è¨€ç¼–å†™ï¼Œä½†å¹¶ä¸ä¾èµ–äºä»»ä½•ç‰¹å®šè¯­è¨€çš„å¥æ³•å¥å¼ï¼ˆè­¬å¦‚ JavaScriptï¼‰æ¥ä¸ GraphQL schema æ²Ÿé€šï¼ŒGraphqlå®šä¹‰äº†è‡ªå·±çš„ç®€å•è¯­è¨€ï¼Œç§°ä¹‹ä¸º â€œGraphQL schema languageâ€ã€‚\n3.1 å¯¹è±¡ç±»å‹å’Œå­—æ®µ ä¸€ä¸ª GraphQL schema ä¸­çš„æœ€åŸºæœ¬çš„ç»„ä»¶æ˜¯å¯¹è±¡ç±»å‹ï¼Œå®ƒå°±è¡¨ç¤ºä½ å¯ä»¥ä»æœåŠ¡ä¸Šè·å–åˆ°ä»€ä¹ˆç±»å‹çš„å¯¹è±¡ï¼Œä»¥åŠè¿™ä¸ªå¯¹è±¡æœ‰ä»€ä¹ˆå­—æ®µã€‚ä½¿ç”¨ GraphQL schema languageï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·è¡¨ç¤ºå®ƒï¼š\ntype Character { name: String! appearsIn: [Episode!]! }  è¯´æ˜\n  Character æ˜¯ä¸€ä¸ª GraphQL å¯¹è±¡ç±»å‹ï¼Œè¡¨ç¤ºå…¶æ˜¯ä¸€ä¸ªæ‹¥æœ‰ä¸€äº›å­—æ®µçš„ç±»å‹ã€‚ä½ çš„ schema ä¸­çš„å¤§å¤šæ•°ç±»å‹éƒ½ä¼šæ˜¯å¯¹è±¡ç±»å‹ã€‚ name å’Œ appearsIn æ˜¯ Character ç±»å‹ä¸Šçš„å­—æ®µã€‚è¿™æ„å‘³ç€åœ¨ä¸€ä¸ªæ“ä½œ Character ç±»å‹çš„ GraphQL æŸ¥è¯¢ä¸­çš„ä»»ä½•éƒ¨åˆ†ï¼Œéƒ½åªèƒ½å‡ºç° name å’Œ appearsIn å­—æ®µã€‚ String æ˜¯å†…ç½®çš„æ ‡é‡ç±»å‹ä¹‹ä¸€ â€”â€” æ ‡é‡ç±»å‹æ˜¯è§£æåˆ°å•ä¸ªæ ‡é‡å¯¹è±¡çš„ç±»å‹ï¼Œæ— æ³•åœ¨æŸ¥è¯¢ä¸­å¯¹å®ƒè¿›è¡Œæ¬¡çº§é€‰æ‹©ã€‚åé¢æˆ‘ä»¬å°†ç»†è¿°æ ‡é‡ç±»å‹ã€‚ String! è¡¨ç¤ºè¿™ä¸ªå­—æ®µæ˜¯éç©ºçš„ï¼ŒGraphQL æœåŠ¡ä¿è¯å½“ä½ æŸ¥è¯¢è¿™ä¸ªå­—æ®µåæ€»ä¼šç»™ä½ è¿”å›ä¸€ä¸ªå€¼ã€‚åœ¨ç±»å‹è¯­è¨€é‡Œé¢ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªæ„Ÿå¹å·æ¥è¡¨ç¤ºè¿™ä¸ªç‰¹æ€§ã€‚ [Episode!]! è¡¨ç¤ºä¸€ä¸ª Episode æ•°ç»„ã€‚å› ä¸ºå®ƒä¹Ÿæ˜¯éç©ºçš„ï¼Œæ‰€ä»¥å½“ä½ æŸ¥è¯¢ appearsIn å­—æ®µçš„æ—¶å€™ï¼Œä½ ä¹Ÿæ€»èƒ½å¾—åˆ°ä¸€ä¸ªæ•°ç»„ï¼ˆé›¶ä¸ªæˆ–è€…å¤šä¸ªå…ƒç´ ï¼‰ã€‚ä¸”ç”±äº Episode! ä¹Ÿæ˜¯éç©ºçš„ï¼Œä½ æ€»æ˜¯å¯ä»¥é¢„æœŸåˆ°æ•°ç»„ä¸­çš„æ¯ä¸ªé¡¹ç›®éƒ½æ˜¯ä¸€ä¸ª Episode å¯¹è±¡  3.1.5 æŸ¥è¯¢å’Œå˜æ›´ç±»å‹ï¼ˆThe Query and Mutation Typesï¼‰ ä½ çš„ schema ä¸­å¤§éƒ¨åˆ†çš„ç±»å‹éƒ½æ˜¯æ™®é€šå¯¹è±¡ç±»å‹ï¼Œä½†æ˜¯ä¸€ä¸ª schema å†…æœ‰ä¸¤ä¸ªç‰¹æ®Šç±»å‹ï¼š\nschema { query: Query mutation: Mutation } æ¯ä¸€ä¸ª GraphQL æœåŠ¡éƒ½æœ‰ä¸€ä¸ª query ç±»å‹ï¼Œå¯èƒ½æœ‰ä¸€ä¸ª mutation ç±»å‹ã€‚è¿™ä¸¤ä¸ªç±»å‹å’Œå¸¸è§„å¯¹è±¡ç±»å‹æ— å·®ï¼Œä½†æ˜¯å®ƒä»¬ä¹‹æ‰€ä»¥ç‰¹æ®Šï¼Œæ˜¯å› ä¸ºå®ƒä»¬å®šä¹‰äº†æ¯ä¸€ä¸ª GraphQL æŸ¥è¯¢çš„å…¥å£ã€‚å› æ­¤å¦‚æœä½ çœ‹åˆ°ä¸€ä¸ªåƒè¿™æ ·çš„æŸ¥è¯¢ï¼š\n# Request query { hero { name } droid(id: \u0026#34;2000\u0026#34;) { name } } # Response { \u0026#34;data\u0026#34;: { \u0026#34;hero\u0026#34;: { \u0026#34;name\u0026#34;: \u0026#34;R2-D2\u0026#34; }, \u0026#34;droid\u0026#34;: { \u0026#34;name\u0026#34;: \u0026#34;C-3PO\u0026#34; } } } é‚£è¡¨ç¤ºè¿™ä¸ª GraphQL æœåŠ¡éœ€è¦ä¸€ä¸ª Query ç±»å‹ï¼Œä¸”å…¶ä¸Šæœ‰ hero å’Œ droid å­—æ®µï¼š\ntype Query { hero(episode: Episode): Character droid(id: ID!): Droid } Mutationä¹Ÿæ˜¯ç±»ä¼¼çš„å·¥ä½œæ–¹å¼ â€”â€” ä½ åœ¨ Mutation ç±»å‹ä¸Šå®šä¹‰ä¸€äº›å­—æ®µï¼Œç„¶åè¿™äº›å­—æ®µå°†ä½œä¸º mutation æ ¹å­—æ®µä½¿ç”¨ï¼Œæ¥ç€ä½ å°±èƒ½åœ¨ä½ çš„æŸ¥è¯¢ä¸­è°ƒç”¨.\næœ‰å¿…è¦è®°ä½çš„æ˜¯ï¼Œé™¤äº†ä½œä¸º schema çš„å…¥å£ï¼ŒQuery å’Œ Mutation ç±»å‹ä¸å…¶å®ƒ GraphQL å¯¹è±¡ç±»å‹åˆ«æ— äºŒè‡´ï¼Œå®ƒä»¬çš„å­—æ®µä¹Ÿæ˜¯ä¸€æ ·çš„å·¥ä½œæ–¹å¼ã€‚\n3.2 å‚æ•° GraphQL å¯¹è±¡ç±»å‹ä¸Šçš„æ¯ä¸€ä¸ªå­—æ®µéƒ½å¯èƒ½æœ‰é›¶ä¸ªæˆ–è€…å¤šä¸ªå‚æ•°ï¼Œä¾‹å¦‚ä¸‹é¢çš„ length å­—æ®µ:\ntype Starship { id: ID! name: String! length(unit: LengthUnit = METER): Float } æ‰€æœ‰å‚æ•°éƒ½æ˜¯å…·åçš„ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œlengthå­—æ®µå®šä¹‰äº†ä¸€ä¸ªå‚æ•°ï¼šunitã€‚å‚æ•°å¯èƒ½æ˜¯å¿…é€‰æˆ–è€…å¯é€‰çš„ï¼Œå½“ä¸€ä¸ªå‚æ•°æ˜¯å¯é€‰çš„ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªé»˜è®¤å€¼ â€”â€” å¦‚æœ unit å‚æ•°æ²¡æœ‰ä¼ é€’ï¼Œé‚£ä¹ˆå®ƒå°†ä¼šè¢«é»˜è®¤è®¾ç½®ä¸º METERã€‚\n3.3 æ ‡é‡ç±»å‹ï¼ˆScalar Typesï¼‰ ä¸€ä¸ªå¯¹è±¡ç±»å‹æœ‰è‡ªå·±çš„åå­—å’Œå­—æ®µï¼Œè€ŒæŸäº›æ—¶å€™ï¼Œè¿™äº›å­—æ®µå¿…ç„¶ä¼šè§£æåˆ°å…·ä½“æ•°æ®ã€‚è¿™å°±æ˜¯æ ‡é‡ç±»å‹çš„æ¥æºï¼šå®ƒä»¬è¡¨ç¤ºå¯¹åº” GraphQL æŸ¥è¯¢çš„å¶å­èŠ‚ç‚¹ã€‚\nä¸‹åˆ—æŸ¥è¯¢ä¸­ï¼Œname å’Œ appearsIn å­—æ®µå°†è§£æåˆ°æ ‡é‡ç±»å‹ï¼š\n{ hero { name appearsIn } } { \u0026#34;data\u0026#34;: { \u0026#34;hero\u0026#34;: { \u0026#34;name\u0026#34;: \u0026#34;R2-D2\u0026#34;, \u0026#34;appearsIn\u0026#34;: [ \u0026#34;NEWHOPE\u0026#34;, \u0026#34;EMPIRE\u0026#34;, \u0026#34;JEDI\u0026#34; ] } } } æ ‡é‡ç±»å‹æ²¡æœ‰ä»»ä½•æ¬¡çº§å­—æ®µï¼Œå®ƒä»¬æ˜¯ä¸€æ¬¡æŸ¥è¯¢çš„å¶å­èŠ‚ç‚¹ã€‚ Graphqlä¸­é¢„å®šä¹‰çš„æ ‡é‡ç±»å‹æœ‰ï¼š\n Intï¼šæœ‰ç¬¦å· 32 ä½æ•´æ•°ã€‚ Floatï¼šæœ‰ç¬¦å·åŒç²¾åº¦æµ®ç‚¹å€¼ã€‚ Stringï¼šUTFâ€8 å­—ç¬¦åºåˆ—ã€‚ Booleanï¼štrue æˆ–è€… falseã€‚ IDï¼šID æ ‡é‡ç±»å‹è¡¨ç¤ºä¸€ä¸ªå”¯ä¸€æ ‡è¯†ç¬¦ï¼Œé€šå¸¸ç”¨ä»¥é‡æ–°è·å–å¯¹è±¡æˆ–è€…ä½œä¸ºç¼“å­˜ä¸­çš„é”®ã€‚ID ç±»å‹ä½¿ç”¨å’Œ String ä¸€æ ·çš„æ–¹å¼åºåˆ—åŒ–ï¼›ç„¶è€Œå°†å…¶å®šä¹‰ä¸º ID æ„å‘³ç€å¹¶ä¸éœ€è¦äººç±»å¯è¯»å‹ã€‚  è¿˜å¯ä»¥è‡ªå®šä¹‰æ ‡é‡ç±»å‹ï¼š\nscalar Date åœ¨è‡ªå·±çš„å®ç°ä¸­å®šä¹‰å¦‚ä½•å°†å…¶åºåˆ—åŒ–ã€ååºåˆ—åŒ–å’ŒéªŒè¯ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥æŒ‡å®š Date ç±»å‹åº”è¯¥æ€»æ˜¯è¢«åºåˆ—åŒ–æˆæ•´å‹æ—¶é—´æˆ³ï¼Œè€Œå®¢æˆ·ç«¯åº”è¯¥çŸ¥é“å»è¦æ±‚ä»»ä½• date å­—æ®µéƒ½æ˜¯è¿™ä¸ªæ ¼å¼ã€‚\n3.4 æšä¸¾ç±»å‹ï¼ˆEnumseration Typesï¼‰ æšä¸¾ç±»å‹æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ ‡é‡ï¼Œå®ƒé™åˆ¶åœ¨ä¸€ä¸ªç‰¹æ®Šçš„å¯é€‰å€¼é›†åˆå†…ã€‚è¿™è®©ä½ èƒ½å¤Ÿï¼š\n éªŒè¯è¿™ä¸ªç±»å‹çš„ä»»ä½•å‚æ•°æ˜¯å¯é€‰å€¼çš„çš„æŸä¸€ä¸ª ä¸ç±»å‹ç³»ç»Ÿæ²Ÿé€šï¼Œä¸€ä¸ªå­—æ®µæ€»æ˜¯ä¸€ä¸ªæœ‰é™å€¼é›†åˆçš„å…¶ä¸­ä¸€ä¸ªå€¼ã€‚  ä¸‹é¢æ˜¯ä¸€ä¸ªç”¨ GraphQL schema è¯­è¨€è¡¨ç¤ºçš„ enum å®šä¹‰ï¼š\nenum Episode { NEWHOPE EMPIRE JEDI } è¿™è¡¨ç¤ºæ— è®ºæˆ‘ä»¬åœ¨ schema çš„å“ªå¤„ä½¿ç”¨äº† Episodeï¼Œéƒ½å¯ä»¥è‚¯å®šå®ƒè¿”å›çš„æ˜¯ NEWHOPEã€EMPIRE å’Œ JEDI ä¹‹ä¸€ã€‚\n3.5 åˆ—è¡¨å’Œéç©º å¯¹è±¡ç±»å‹ã€æ ‡é‡ä»¥åŠæšä¸¾æ˜¯ GraphQL ä¸­ä½ å”¯ä¸€å¯ä»¥å®šä¹‰çš„ç±»å‹ç§ç±»ã€‚ä½†æ˜¯å½“ä½ åœ¨ schema çš„å…¶ä»–éƒ¨åˆ†ä½¿ç”¨è¿™äº›ç±»å‹æ—¶ï¼Œæˆ–è€…åœ¨ä½ çš„æŸ¥è¯¢å˜é‡å£°æ˜å¤„ä½¿ç”¨æ—¶ï¼Œä½ å¯ä»¥ç»™å®ƒä»¬åº”ç”¨é¢å¤–çš„ç±»å‹ä¿®é¥°ç¬¦æ¥å½±å“è¿™äº›å€¼çš„éªŒè¯ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š\ntype Character { name: String! appearsIn: [Episode]! } Stringç±»å‹åçš„æ„Ÿå¹å·ï¼è¡¨ç¤ºæ­¤ç±»å‹éç©ºã€‚æœåŠ¡å™¨åœ¨è¿”å›è¿™ä¸ªå­—æ®µæ—¶ï¼Œæ€»æ˜¯ä¼šè¿”å›ä¸€ä¸ªéç©ºå€¼ï¼Œå¦‚æœç»“æœå¾—åˆ°äº†ä¸€ä¸ªç©ºå€¼ï¼Œé‚£ä¹ˆäº‹å®ä¸Šå°†ä¼šè§¦å‘ä¸€ä¸ª GraphQL æ‰§è¡Œé”™è¯¯ï¼Œä»¥è®©å®¢æˆ·ç«¯çŸ¥é“å‘ç”Ÿäº†é”™è¯¯ã€‚\nåœ¨ GraphQL schema è¯­è¨€ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡å°†ç±»å‹åŒ…åœ¨æ–¹æ‹¬å·ï¼ˆ[ å’Œ ]ï¼‰ä¸­çš„æ–¹å¼æ¥æ ‡è®°åˆ—è¡¨ã€‚åˆ—è¡¨å¯¹äºå‚æ•°ä¹Ÿæ˜¯ä¸€æ ·çš„è¿ä½œæ–¹å¼ï¼ŒéªŒè¯çš„æ­¥éª¤ä¼šè¦æ±‚å¯¹åº”å€¼ä¸ºæ•°ç»„ã€‚\néç©ºå’Œåˆ—è¡¨ä¿®é¥°ç¬¦å¯ä»¥ç»„åˆä½¿ç”¨ã€‚\nmyField: [String!] # è¿™è¡¨ç¤ºæ•°ç»„æœ¬èº«å¯ä»¥ä¸ºç©º,ä½†æ˜¯å…¶ä¸èƒ½æœ‰ä»»ä½•ç©ºå€¼æˆå‘˜. # myField: null // æœ‰æ•ˆ # myField: [] // æœ‰æ•ˆ # myField: [\u0026#39;a\u0026#39;, \u0026#39;b\u0026#39;] // æœ‰æ•ˆ # myField: [\u0026#39;a\u0026#39;, null, \u0026#39;b\u0026#39;] // é”™è¯¯ myField: [String]! # æ•°ç»„æœ¬èº«ä¸èƒ½ä¸ºç©ºï¼Œä½†æ˜¯å…¶å¯ä»¥åŒ…å«ç©ºå€¼æˆå‘˜ # myField: null // é”™è¯¯ # myField: [] // æœ‰æ•ˆ # myField: [\u0026#39;a\u0026#39;, \u0026#39;b\u0026#39;] // æœ‰æ•ˆ # myField: [\u0026#39;a\u0026#39;, null, \u0026#39;b\u0026#39;] // æœ‰æ•ˆ ä½ å¯ä»¥æ ¹æ®éœ€æ±‚åµŒå¥—ä»»æ„å±‚éç©ºå’Œåˆ—è¡¨ä¿®é¥°ç¬¦ã€‚\n3.6 æ¥å£ï¼ˆinterfaceï¼‰ è·Ÿè®¸å¤šç±»å‹ç³»ç»Ÿä¸€æ ·ï¼ŒGraphQL æ”¯æŒæ¥å£ã€‚ä¸€ä¸ªæ¥å£æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»å‹ï¼Œå®ƒåŒ…å«æŸäº›å­—æ®µï¼Œè€Œå¯¹è±¡ç±»å‹å¿…é¡»åŒ…å«è¿™äº›å­—æ®µï¼Œæ‰èƒ½ç®—å®ç°äº†è¿™ä¸ªæ¥å£ã€‚\nä¾‹å¦‚ï¼Œä½ å¯ä»¥ç”¨ä¸€ä¸ª Character æ¥å£ç”¨ä»¥è¡¨ç¤ºã€Šæ˜Ÿçƒå¤§æˆ˜ã€‹ä¸‰éƒ¨æ›²ä¸­çš„ä»»ä½•è§’è‰²ï¼š\ninterface Character { id: ID! name: String! friends: [Character] appearsIn: [Episode]! } è¿™æ„å‘³ç€ä»»ä½•å®ç° Character çš„ç±»å‹éƒ½è¦å…·æœ‰è¿™äº›å­—æ®µï¼Œå¹¶æœ‰å¯¹åº”å‚æ•°å’Œè¿”å›ç±»å‹ã€‚\nä¾‹å¦‚ï¼Œè¿™é‡Œæœ‰ä¸€äº›å¯èƒ½å®ç°äº† Character çš„ç±»å‹ï¼š\ntype Human implements Character { id: ID! name: String! friends: [Character] appearsIn: [Episode]! starships: [Starship] totalCredits: Int } type Droid implements Character { id: ID! name: String! friends: [Character] appearsIn: [Episode]! primaryFunction: String } å¯è§è¿™ä¸¤ä¸ªç±»å‹éƒ½å…·å¤‡ Character æ¥å£çš„æ‰€æœ‰å­—æ®µï¼Œä½†ä¹Ÿå¼•å…¥äº†å…¶ä»–çš„å­—æ®µ totalCreditsã€starships å’Œ primaryFunctionï¼Œè¿™éƒ½å±äºç‰¹å®šçš„ç±»å‹çš„è§’è‰²ã€‚\n3.7 è”åˆç±»å‹ è”åˆç±»å‹å’Œæ¥å£ååˆ†ç›¸ä¼¼ï¼Œä½†æ˜¯å®ƒå¹¶ä¸æŒ‡å®šç±»å‹ä¹‹é—´çš„ä»»ä½•å…±åŒå­—æ®µã€‚\nunion SearchResult = Human | Droid | Starship åœ¨æˆ‘ä»¬çš„schemaä¸­ï¼Œä»»ä½•è¿”å›ä¸€ä¸ª SearchResult ç±»å‹çš„åœ°æ–¹ï¼Œéƒ½å¯èƒ½å¾—åˆ°ä¸€ä¸ª Humanã€Droid æˆ–è€… Starshipã€‚æ³¨æ„ï¼Œè”åˆç±»å‹çš„æˆå‘˜éœ€è¦æ˜¯å…·ä½“å¯¹è±¡ç±»å‹ï¼›ä½ ä¸èƒ½ä½¿ç”¨æ¥å£æˆ–è€…å…¶ä»–è”åˆç±»å‹æ¥åˆ›é€ ä¸€ä¸ªè”åˆç±»å‹ã€‚\n3.7 è¾“å…¥ç±»å‹ ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬åªè®¨è®ºè¿‡å°†ä¾‹å¦‚æšä¸¾å’Œå­—ç¬¦ä¸²ç­‰æ ‡é‡å€¼ä½œä¸ºå‚æ•°ä¼ é€’ç»™å­—æ®µï¼Œä½†æ˜¯ä½ ä¹Ÿèƒ½å¾ˆå®¹æ˜“åœ°ä¼ é€’å¤æ‚å¯¹è±¡ã€‚è¿™åœ¨å˜æ›´ï¼ˆmutationï¼‰ä¸­ç‰¹åˆ«æœ‰ç”¨ï¼Œå› ä¸ºæœ‰æ—¶å€™ä½ éœ€è¦ä¼ é€’ä¸€æ•´ä¸ªå¯¹è±¡ä½œä¸ºæ–°å»ºå¯¹è±¡ã€‚åœ¨ GraphQL schema language ä¸­ï¼Œè¾“å…¥å¯¹è±¡çœ‹ä¸Šå»å’Œå¸¸è§„å¯¹è±¡ä¸€æ¨¡ä¸€æ ·ï¼Œé™¤äº†å…³é”®å­—æ˜¯ input è€Œä¸æ˜¯ typeï¼š\ninput ReviewInput { stars: Int! commentary: String } ","permalink":"http://yangchnet.github.io/Dessert/posts/%E6%95%B0%E6%8D%AE%E5%BA%93/graphql/","summary":"1. ä»€ä¹ˆæ˜¯Graphql GraphQL æ—¢æ˜¯ä¸€ç§ç”¨äº API çš„æŸ¥è¯¢è¯­è¨€ä¹Ÿæ˜¯ä¸€ä¸ªæ»¡è¶³ä½ æ•°æ®æŸ¥è¯¢çš„runtimeã€‚ GraphQLå¯¹ä½ çš„APIä¸­çš„æ•°æ®æä¾›äº†ä¸€å¥—æ˜“äºç†è§£çš„å®Œæ•´æè¿°ï¼Œä½¿å¾—å®¢æˆ·ç«¯èƒ½å¤Ÿå‡†ç¡®åœ°è·å¾—å®ƒéœ€è¦çš„æ•°æ®ï¼Œè€Œä¸”æ²¡æœ‰ä»»ä½•å†—ä½™ï¼Œä¹Ÿè®©APIæ›´å®¹æ˜“åœ°éšç€æ—¶é—´æ¨ç§»è€Œæ¼”è¿›ï¼Œè¿˜èƒ½ç”¨äºæ„å»ºå¼ºå¤§çš„å¼€å‘è€…å·¥å…·ã€‚ ä¸€ä¸ª GraphQL æœåŠ¡æ˜¯é€šè¿‡å®šä¹‰ç±»å‹å’Œç±»å‹ä¸Šçš„å­—æ®µæ¥åˆ›å»ºçš„ï¼Œç„¶åç»™æ¯ä¸ªç±»å‹ä¸Šçš„æ¯ä¸ªå­—æ®µæä¾›è§£æå‡½æ•°ã€‚\nç®€å•çš„è¯´ï¼ŒGraphQLä¸ºæˆ‘ä»¬å®šä¹‰æ•°æ®åº“æä¾›äº†æ›´ä¸ºä¾¿æ·çš„æ–¹å¼ï¼Œä½ ä¸éœ€è¦å†™ä»»ä½•SQLè¯­å¥ï¼Œå³å¯å®Œæˆæ•°æ®åº“çš„åˆ›å»ºåŠè¿ç§»ç­‰å·¥ä½œã€‚\n2. æ¦‚è§ˆ ä¾‹å¦‚ï¼Œä¸€ä¸ª GraphQL æœåŠ¡å‘Šè¯‰æˆ‘ä»¬å½“å‰ç™»å½•ç”¨æˆ·æ˜¯ meï¼Œè¿™ä¸ªç”¨æˆ·çš„åç§°å¯èƒ½åƒè¿™æ ·ï¼š\ntype Query { me: User } type User { id: ID name: String } ä¸€å¹¶çš„è¿˜æœ‰æ¯ä¸ªç±»å‹ä¸Šå­—æ®µçš„è§£æå‡½æ•°ï¼š\nfunction Query_me(request) { return request.auth.user; } function User_name(user) { return user.getName(); } ä¸€æ—¦ä¸€ä¸ª GraphQL æœåŠ¡è¿è¡Œèµ·æ¥ï¼ˆé€šå¸¸åœ¨ web æœåŠ¡çš„ä¸€ä¸ª URL ä¸Šï¼‰ï¼Œå®ƒå°±èƒ½æ¥æ”¶ GraphQL æŸ¥è¯¢ï¼Œå¹¶éªŒè¯å’Œæ‰§è¡Œã€‚æ¥æ”¶åˆ°çš„æŸ¥è¯¢é¦–å…ˆä¼šè¢«æ£€æŸ¥ç¡®ä¿å®ƒåªå¼•ç”¨äº†å·²å®šä¹‰çš„ç±»å‹å’Œå­—æ®µï¼Œç„¶åè¿è¡ŒæŒ‡å®šçš„è§£æå‡½æ•°æ¥ç”Ÿæˆç»“æœã€‚\nä¾‹å¦‚è¿™ä¸ªæŸ¥è¯¢ï¼š\n{ me { name } } ä¼šäº§ç”Ÿè¿™æ ·çš„JSONç»“æœï¼š\n{ \u0026#34;me\u0026#34;: { \u0026#34;name\u0026#34;: \u0026#34;Luke Skywalker\u0026#34; } } 3. Schema å’Œç±»å‹ GraphQL æœåŠ¡å¯ä»¥ç”¨ä»»ä½•è¯­è¨€ç¼–å†™ï¼Œä½†å¹¶ä¸ä¾èµ–äºä»»ä½•ç‰¹å®šè¯­è¨€çš„å¥æ³•å¥å¼ï¼ˆè­¬å¦‚ JavaScriptï¼‰æ¥ä¸ GraphQL schema æ²Ÿé€šï¼ŒGraphqlå®šä¹‰äº†è‡ªå·±çš„ç®€å•è¯­è¨€ï¼Œç§°ä¹‹ä¸º â€œGraphQL schema languageâ€ã€‚","title":"GraphqlåŸºæœ¬æ¦‚å¿µ"},{"content":"1. åŒºå—é“¾å®šä¹‰ åŒºå—é“¾æŠ€æœ¯æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå»ä¸­å¿ƒåŒ–çš„æ•°æ®åº“ï¼Œå®ƒæ˜¯æ¯”ç‰¹å¸çš„æ ¸å¿ƒæŠ€æœ¯ä¸åŸºç¡€æ¶æ„ï¼Œæ˜¯åˆ†å¸ƒå¼æ•°æ®å­˜å‚¨ã€ç‚¹å¯¹ç‚¹ä¼ è¾“ã€å…±è¯†æœºåˆ¶ã€åŠ å¯†ç®—æ³•ç­‰è®¡ç®—æœºæŠ€æœ¯çš„æ–°å‹åº”ç”¨æ¨¡å¼ã€‚ç‹­ä¹‰æ¥è®²ï¼ŒåŒºå—é“¾æ˜¯ä¸€ç§æŒ‰ç…§æ—¶é—´é¡ºåºå°†æ•°æ®åŒºå—ä»¥é¡ºåºç›¸è¿çš„æ–¹å¼ç»„åˆæˆçš„ä¸€ç§é“¾å¼æ•°æ®ç»“æ„ï¼Œå¹¶ä»¥å¯†ç å­¦æ–¹å¼ä¿è¯çš„ä¸å¯ç¯¡æ”¹ã€ä¸å¯ä¼ªé€ çš„åˆ†å¸ƒå¼è´¦æœ¬ã€‚å¹¿ä¹‰æ¥è®²ï¼ŒåŒºå—é“¾æŠ€æœ¯æ˜¯åˆ©ç”¨å—é“¾å¼æ•°æ®ç»“æ„æ¥éªŒè¯ä¸å­˜å‚¨æ•°æ®ã€åˆ©ç”¨åˆ†å¸ƒå¼èŠ‚ç‚¹å…±è¯†ç®—æ³•æ¥ç”Ÿæˆå’Œæ›´æ–°æ•°æ®ã€åˆ©ç”¨å¯†ç å­¦æ–¹å¼ä¿è¯æ•°æ®ä¼ è¾“å’Œè®¿é—®çš„å®‰å…¨ã€åˆ©ç”¨ç”±è‡ªåŠ¨åŒ–è„šæœ¬ä»£ç ç»„æˆçš„æ™ºèƒ½åˆçº¦æ¥ç¼–ç¨‹å’Œæ“ä½œæ•°æ®çš„ä¸€ç§å…¨æ–°çš„åˆ†å¸ƒå¼åŸºç¡€æ¶æ„ä¸è®¡ç®—èŒƒå¼ã€‚\n1.1 åŒºå—é“¾çš„æŠ€æœ¯ç‰¹å¾ åŒºå—é“¾ä¸Šå­˜å‚¨çš„æ•°æ®éœ€ç”±å…¨ç½‘èŠ‚ç‚¹å…±åŒç»´æŠ¤ï¼Œå¯ä»¥åœ¨ç¼ºä¹ä¿¡ä»»çš„èŠ‚ç‚¹ä¹‹é—´æœ‰æ•ˆåœ°ä¼ é€’ä»·å€¼ã€‚ç›¸æ¯”ç°æœ‰çš„æ•°æ®åº“æŠ€æœ¯ï¼ŒåŒºå—é“¾å…·æœ‰ä»¥ä¸‹æŠ€æœ¯ç‰¹å¾ã€‚\n å—é“¾å¼æ•°æ®ç»“æ„\nåŒºå—é“¾åˆ©ç”¨å—é“¾å¼æ•°æ®ç»“æ„æ¥éªŒè¯å’Œå­˜å‚¨æ•°æ®ï¼Œé€šè¿‡ä¸Šæ–‡å¯¹åŒºå—é“¾åŸºæœ¬æ¦‚å¿µçš„ä»‹ç»å¯ä»¥çŸ¥é“ï¼Œæ¯ä¸ªåŒºå—æ‰“åŒ…è®°å½•äº†ä¸€æ®µæ—¶é—´å†…å‘ç”Ÿçš„äº¤æ˜“æ˜¯å¯¹å½“å‰è´¦æœ¬çš„ä¸€æ¬¡å…±è¯†ï¼Œå¹¶ä¸”é€šè¿‡è®°å½•ä¸Šä¸€ä¸ªåŒºå—çš„å“ˆå¸Œå€¼è¿›è¡Œå…³è”ï¼Œä»è€Œå½¢æˆå—é“¾å¼çš„æ•°æ®ç»“æ„ã€‚ åˆ†å¸ƒå¼å…±è¯†ç®—æ³•\nåŒºå—é“¾ç³»ç»Ÿåˆ©ç”¨åˆ†å¸ƒå¼å…±è¯†ç®—æ³•æ¥ç”Ÿæˆå’Œæ›´æ–°æ•°æ®ï¼Œä»æŠ€æœ¯å±‚é¢æœç»äº†éæ³•ç¯¡æ”¹æ•°æ®çš„å¯èƒ½æ€§ï¼Œä»è€Œå–ä»£äº†ä¼ ç»Ÿåº”ç”¨ä¸­ä¿è¯ä¿¡ä»»å’Œäº¤æ˜“å®‰å…¨çš„ç¬¬ä¸‰æ–¹ä¸­ä»‹æœºæ„ï¼Œé™ä½äº†ä¸ºç»´æŠ¤ä¿¡ç”¨è€Œé€ æˆçš„æ—¶é—´æˆæœ¬ã€äººåŠ›æˆæœ¬å’Œèµ„æºè€—ç”¨ å¯†ç å­¦æ–¹å¼\nåŒºå—é“¾ç³»ç»Ÿåˆ©ç”¨å¯†ç å­¦çš„æ–¹å¼ä¿è¯æ•°æ®ä¼ è¾“å’Œè®¿é—®çš„å®‰å…¨ã€‚å­˜å‚¨åœ¨åŒºå—é“¾ä¸Šçš„äº¤æ˜“ä¿¡æ¯æ˜¯å…¬å¼€çš„ï¼Œä½†è´¦æˆ·çš„èº«ä»½ä¿¡æ¯æ˜¯é«˜åº¦åŠ å¯†çš„ã€‚åŒºå—é“¾ç³»ç»Ÿé›†æˆäº†å¯¹ç§°åŠ å¯†ã€éå¯¹ç§°åŠ å¯†åŠå“ˆå¸Œç®—æ³•çš„ä¼˜ç‚¹ï¼Œå¹¶ä½¿ç”¨æ•°å­—ç­¾åæŠ€æœ¯æ¥ä¿è¯äº¤æ˜“çš„å®‰å…¨ã€‚  1.2 åŒºå—é“¾çš„åŠŸèƒ½ç‰¹å¾ åŒºå—é“¾ç³»ç»Ÿçš„ä»¥ä¸ŠæŠ€æœ¯ç‰¹å¾å†³å®šäº†å…¶åº”ç”¨å…·æœ‰å¦‚ä¸‹åŠŸèƒ½ç‰¹å¾ã€‚\n  å¤šä¸­å¿ƒ ä¸åŒäºä¼ ç»Ÿåº”ç”¨çš„ä¸­å¿ƒåŒ–æ•°æ®ç®¡ç†ï¼ŒåŒºå—é“¾ç½‘ç»œä¸­æœ‰å¤šä¸ªæœºæ„è¿›è¡Œç›¸äº’ç›‘ç£å¹¶å®æ—¶å¯¹è´¦ï¼Œä»è€Œé¿å…äº†å•ä¸€è®°è´¦äººé€ å‡çš„å¯èƒ½æ€§ï¼Œæé«˜äº†æ•°æ®çš„å®‰å…¨æ€§ã€‚\n  è‡ªåŠ¨åŒ– åŒºå—é“¾ç³»ç»Ÿä¸­çš„æ™ºèƒ½åˆçº¦æ˜¯å¯ä»¥è‡ªåŠ¨åŒ–æ‰§è¡Œä¸€äº›é¢„å…ˆå®šä¹‰å¥½çš„è§„åˆ™å’Œæ¡æ¬¾çš„ä¸€æ®µè®¡ç®—æœºç¨‹åºä»£ç ï¼Œå®ƒå¤§å¤§æé«˜äº†ç»æµæ´»åŠ¨ä¸å¥‘çº¦çš„è‡ªåŠ¨åŒ–ç¨‹åº¦ã€‚\n  å¯ä¿¡ä»» å­˜å‚¨åœ¨åŒºå—é“¾ä¸Šçš„äº¤æ˜“è®°å½•å’Œå…¶ä»–æ•°æ®æ˜¯ä¸å¯ç¯¡æ”¹å¹¶ä¸”å¯æº¯æºçš„ï¼Œæ‰€ä»¥èƒ½å¤Ÿå¾ˆå¥½åœ°è§£å†³å„æ–¹ä¸ä¿¡ä»»çš„é—®é¢˜ï¼Œæ— éœ€ç¬¬ä¸‰æ–¹å¯ä¿¡ä¸­ä»‹ã€‚\n  2. åŒºå—é“¾çš„ç›¸å…³æ¦‚å¿µ åŒºå—é“¾ä»¥å¯†ç å­¦çš„æ–¹å¼ç»´æŠ¤ä¸€ä»½ä¸å¯ç¯¡æ”¹å’Œä¸å¯ä¼ªé€ çš„åˆ†å¸ƒå¼è´¦æœ¬ï¼Œå¹¶é€šè¿‡åŸºäºåå•†ä¸€è‡´çš„è§„èŒƒå’Œåè®®ï¼ˆå…±è¯†æœºåˆ¶ï¼‰è§£å†³äº†å»ä¸­å¿ƒåŒ–çš„è®°è´¦ç³»ç»Ÿçš„ä¸€è‡´æ€§é—®é¢˜ï¼Œå…¶ç›¸å…³æ¦‚å¿µä¸»è¦åŒ…æ‹¬ä»¥ä¸‹ä¸‰ä¸ªã€‚\n äº¤æ˜“ï¼ˆTransactionï¼‰\nåŒºå—é“¾ä¸Šæ¯ä¸€æ¬¡å¯¼è‡´åŒºå—çŠ¶æ€å˜åŒ–çš„æ“ä½œéƒ½ç§°ä¸ºäº¤æ˜“ï¼Œæ¯ä¸€æ¬¡äº¤æ˜“å¯¹åº”å”¯ä¸€çš„äº¤æ˜“å“ˆå¸Œå€¼ï¼Œä¸€æ®µæ—¶é—´åä¾¿ä¼šå¯¹äº¤æ˜“è¿›è¡Œæ‰“åŒ…ã€‚ åŒºå—ï¼ˆBlockï¼‰\næ‰“åŒ…è®°å½•ä¸€æ®µæ—¶é—´å†…å‘ç”Ÿçš„äº¤æ˜“å’ŒçŠ¶æ€ç»“æœï¼Œæ˜¯å¯¹å½“å‰è´¦æœ¬çš„ä¸€æ¬¡å…±è¯†ã€‚æ¯ä¸ªåŒºå—ä»¥ä¸€ä¸ªç›¸å¯¹å¹³ç¨³çš„æ—¶é—´é—´éš”åŠ å…¥åˆ°é“¾ä¸Šï¼Œåœ¨ä¼ä¸šçº§åŒºå—é“¾å¹³å°ä¸­ï¼Œå…±è¯†æ—¶é—´å¯ä»¥åŠ¨æ€è®¾ç½®ã€‚ é“¾ï¼ˆChainï¼‰\nåŒºå—æŒ‰ç…§æ—¶é—´é¡ºåºä¸²è”èµ·æ¥ï¼Œé€šè¿‡æ¯ä¸ªåŒºå—è®°å½•ä¸Šä¸€ä¸ªåŒºå—çš„å“ˆå¸Œå€¼å…³è”ï¼Œæ˜¯æ•´ä¸ªçŠ¶æ€æ”¹å˜çš„æ—¥å¿—è®°å½•ã€‚   åŒºå—é“¾çš„ä¸»è¦ç»“æ„  å¦‚ä½•è§£å†³äº¤æ˜“ä¸­çš„ä¿¡ä»»å’Œå®‰å…¨é—®é¢˜ åŒºå—é“¾æŠ€æœ¯ä½“ç³»ä¸æ˜¯é€šè¿‡ä¸€ä¸ªæƒå¨çš„ä¸­å¿ƒåŒ–æœºæ„æ¥ä¿è¯äº¤æ˜“çš„å¯ä¿¡å’Œå®‰å…¨ï¼Œè€Œæ˜¯é€šè¿‡åŠ å¯†å’Œåˆ†å¸ƒå¼å…±è¯†æœºåˆ¶æ¥è§£å†³ä¿¡ä»»å’Œå®‰å…¨é—®é¢˜ï¼Œå…¶ä¸»è¦æŠ€æœ¯åˆ›æ–°æœ‰ä»¥ä¸‹4ç‚¹ã€‚\n  åˆ†å¸ƒå¼è´¦æœ¬ äº¤æ˜“æ˜¯ç”±åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å¤šä¸ªèŠ‚ç‚¹å…±åŒè®°å½•çš„ã€‚æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½è®°å½•å®Œæ•´çš„äº¤æ˜“è®°å½•ï¼Œå› æ­¤å®ƒä»¬éƒ½å¯ä»¥å‚ä¸ç›‘ç£äº¤æ˜“åˆæ³•æ€§å¹¶éªŒè¯äº¤æ˜“çš„æœ‰æ•ˆæ€§ã€‚ä¸åŒäºä¼ ç»Ÿçš„ä¸­å¿ƒåŒ–æŠ€æœ¯æ–¹æ¡ˆï¼ŒåŒºå—é“¾ä¸­æ²¡æœ‰ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹æœ‰æƒé™å•ç‹¬è®°å½•äº¤æ˜“ï¼Œä»è€Œé¿å…äº†å› å•ä¸€è®°è´¦äººæˆ–èŠ‚ç‚¹è¢«æ§åˆ¶è€Œé€ å‡çš„å¯èƒ½æ€§ã€‚å¦ä¸€æ–¹é¢ï¼Œç”±äºå…¨ç½‘èŠ‚ç‚¹å‚ä¸è®°å½•ï¼Œç†è®ºä¸Šè®²ï¼Œé™¤éæ‰€æœ‰çš„èŠ‚ç‚¹éƒ½è¢«ç ´åï¼Œå¦åˆ™äº¤æ˜“è®°å½•å°±ä¸ä¼šä¸¢å¤±ï¼Œä»è€Œä¿è¯äº†æ•°æ®çš„å®‰å…¨æ€§ã€‚\n  åŠ å¯†æŠ€æœ¯å’ŒæˆæƒæŠ€æœ¯ åŒºå—é“¾æŠ€æœ¯å¾ˆå¥½åœ°é›†æˆäº†å½“å‰å¯¹ç§°åŠ å¯†ã€éå¯¹ç§°åŠ å¯†å’Œå“ˆå¸Œç®—æ³•çš„è®¸å¤šä¼˜ç‚¹ï¼Œå¹¶ä½¿ç”¨äº†æ•°å­—ç­¾åæŠ€æœ¯æ¥ä¿è¯äº¤æ˜“çš„å®‰å…¨æ€§ï¼Œå…¶ä¸­æœ€å…·ä»£è¡¨æ€§çš„æ˜¯ä½¿ç”¨æ¤­åœ†æ›²çº¿åŠ å¯†ç®—æ³•ç”Ÿæˆç”¨æˆ·çš„å…¬ç§é’¥å¯¹å’Œä½¿ç”¨æ¤­åœ†æ›²çº¿æ•°å­—ç­¾åç®—æ³•æ¥ä¿è¯äº¤æ˜“å®‰å…¨ã€‚æ‰“åŒ…åœ¨åŒºå—ä¸Šçš„äº¤æ˜“ä¿¡æ¯å¯¹äºå‚ä¸å…±è¯†çš„æ‰€æœ‰èŠ‚ç‚¹æ˜¯å…¬å¼€çš„ï¼Œä½†æ˜¯è´¦æˆ·çš„èº«ä»½ä¿¡æ¯æ˜¯ç»è¿‡ä¸¥æ ¼åŠ å¯†çš„ã€‚\n  å…±è¯†æœºåˆ¶ å…±è¯†æœºåˆ¶æ˜¯åŒºå—é“¾ç³»ç»Ÿä¸­å„ä¸ªèŠ‚ç‚¹è¾¾æˆä¸€è‡´çš„ç­–ç•¥å’Œæ–¹æ³•ã€‚åŒºå—é“¾çš„å…±è¯†æœºåˆ¶æ›¿ä»£äº†ä¼ ç»Ÿåº”ç”¨ä¸­ä¿è¯ä¿¡ä»»å’Œäº¤æ˜“å®‰å…¨çš„ç¬¬ä¸‰æ–¹ä¸­å¿ƒæœºæ„ï¼Œèƒ½å¤Ÿé™ä½ç”±äºå„æ–¹ä¸ä¿¡ä»»è€Œäº§ç”Ÿçš„ç¬¬ä¸‰æ–¹ä¿¡ç”¨æˆæœ¬ã€æ—¶é—´æˆæœ¬å’Œèµ„æœ¬è€—ç”¨ã€‚å¸¸ç”¨çš„å…±è¯†æœºåˆ¶ä¸»è¦æœ‰PoWã€PoSã€DPoSã€Paxosã€PBFTç­‰ï¼Œå…±è¯†æœºåˆ¶æ—¢æ˜¯æ•°æ®å†™å…¥çš„æ–¹å¼ï¼Œä¹Ÿæ˜¯é˜²æ­¢ç¯¡æ”¹çš„æ‰‹æ®µã€‚\n  æ™ºèƒ½åˆçº¦ æ™ºèƒ½åˆçº¦æ˜¯å¯ä»¥è‡ªåŠ¨åŒ–æ‰§è¡Œé¢„å…ˆå®šä¹‰è§„åˆ™çš„ä¸€æ®µè®¡ç®—æœºç¨‹åºä»£ç ï¼Œå®ƒè‡ªå·±å°±æ˜¯ä¸€ä¸ªç³»ç»Ÿå‚ä¸è€…ã€‚å®ƒèƒ½å¤Ÿå®ç°ä»·å€¼çš„å­˜å‚¨ã€ä¼ é€’ã€æ§åˆ¶å’Œç®¡ç†ï¼Œä¸ºåŸºäºåŒºå—é“¾çš„åº”ç”¨æä¾›äº†åˆ›æ–°æ€§çš„è§£å†³æ–¹æ¡ˆã€‚\n  3. åŒºå—é“¾åˆ†ç±» æŒ‰ç…§èŠ‚ç‚¹å‚ä¸æ–¹å¼çš„ä¸åŒï¼ŒåŒºå—é“¾æŠ€æœ¯å¯ä»¥åˆ†ä¸ºï¼šå…¬æœ‰é“¾ï¼ˆPublic Blockchainï¼‰ã€è”ç›Ÿé“¾ï¼ˆConsortium Blockchainï¼‰å’Œç§æœ‰é“¾ï¼ˆPrivate Blockchainï¼‰ã€‚æŒ‰ç…§æƒé™çš„ä¸åŒï¼ŒåŒºå—é“¾æŠ€æœ¯å¯ä»¥åˆ†ä¸ºï¼šè®¸å¯é“¾ï¼ˆPermissioned Blockchainï¼‰å’Œéè®¸å¯é“¾ï¼ˆPermissionless Blockchainï¼‰ã€‚å‰è¿°çš„ä¸‰å¤§ç±»åŒºå—é“¾æŠ€æœ¯ä¸­ï¼Œè”ç›Ÿé“¾å’Œç§æœ‰é“¾å±äºè®¸å¯é“¾ï¼Œå…¬æœ‰é“¾å±äºéè®¸å¯é“¾ã€‚\n  å…¬æœ‰é“¾\nå…¬æœ‰é“¾ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å…¬å¼€çš„åŒºå—é“¾ã€‚å…¬æœ‰é“¾æ˜¯å…¨å…¬å¼€çš„ï¼Œæ‰€æœ‰äººéƒ½å¯ä»¥ä½œä¸ºç½‘ç»œä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè€Œä¸éœ€è¦ä»»ä½•äººç»™äºˆæƒé™æˆ–æˆæƒã€‚åœ¨å…¬æœ‰é“¾ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥è‡ªç”±åŠ å…¥æˆ–è€…é€€å‡ºç½‘ç»œï¼Œå‚ä¸é“¾ä¸Šæ•°æ®çš„è¯»å†™ã€æ‰§è¡Œäº¤æ˜“ï¼Œè¿˜å¯ä»¥å‚ä¸ç½‘ç»œä¸­å…±è¯†è¾¾æˆçš„è¿‡ç¨‹ï¼Œå³å†³å®šå“ªä¸ªåŒºå—å¯ä»¥æ·»åŠ åˆ°ä¸»é“¾ä¸Šå¹¶è®°å½•å½“å‰çš„ç½‘ç»œçŠ¶æ€ã€‚å…¬æœ‰é“¾æ˜¯å®Œå…¨æ„ä¹‰ä¸Šçš„å»ä¸­å¿ƒåŒ–åŒºå—é“¾ï¼Œå®ƒå€ŸåŠ©å¯†ç å­¦ä¸­çš„åŠ å¯†ç®—æ³•ä¿è¯é“¾ä¸Šäº¤æ˜“çš„å®‰å…¨ã€‚åœ¨é‡‡å–å…±è¯†ç®—æ³•è¾¾æˆå…±è¯†æ—¶ï¼Œå…¬æœ‰é“¾ä¸»è¦é‡‡å–å·¥ä½œé‡è¯æ˜ï¼ˆPoWï¼ŒProof of Workï¼‰æœºåˆ¶æˆ–æƒç›Šè¯æ˜ï¼ˆPoSï¼ŒProof of Stakeï¼‰æœºåˆ¶ç­‰å…±è¯†ç®—æ³•ï¼Œå°†ç»æµå¥–åŠ±å’ŒåŠ å¯†æ•°å­—éªŒè¯ç»“åˆèµ·æ¥ï¼Œæ¥è¾¾åˆ°å»ä¸­å¿ƒåŒ–å’Œå…¨ç½‘è¾¾æˆå…±è¯†çš„ç›®çš„ã€‚åœ¨è¿™äº›ç®—æ³•å…±è¯†å½¢æˆçš„è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥ä¸ºå…±è¯†è¿‡ç¨‹åšå‡ºè´¡çŒ®ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬ä¿—ç§°çš„â€œæŒ–çŸ¿â€ï¼Œæ¥è·å–ä¸è´¡çŒ®æˆæ­£æ¯”çš„ç»æµå¥–åŠ±ï¼Œä¹Ÿå°±æ˜¯ç³»ç»Ÿä¸­å‘è¡Œçš„æ•°å­—ä»£å¸ã€‚\nå…¬æœ‰é“¾é€šå¸¸ä¹Ÿè¢«ç§°ä¸ºå…¬å…±é“¾ï¼Œå®ƒå±äºä¸€ç§éè®¸å¯é“¾ï¼Œä¸éœ€è¦è®¸å¯å°±å¯ä»¥è‡ªç”±å‚åŠ é€€å‡ºã€‚å½“å‰æœ€å…¸å‹çš„ä»£è¡¨åº”ç”¨æœ‰æ¯”ç‰¹å¸ã€ä»¥å¤ªåŠï¼ˆEthereumï¼‰ç­‰ã€‚å› å…¶å®Œå…¨å»ä¸­å¿ƒåŒ–å’Œé¢å‘å¤§ä¼—çš„ç‰¹æ€§ï¼Œå…¬æœ‰é“¾é€šå¸¸é€‚ç”¨äºâ€œè™šæ‹ŸåŠ å¯†è´§å¸â€å’Œé¢å‘å¤§ä¼—çš„ä¸€äº›é‡‘èæœåŠ¡ä»¥åŠç”µå­å•†åŠ¡ç­‰ã€‚\n  è”ç›Ÿé“¾ è”ç›Ÿé“¾ä¸æ˜¯å®Œå…¨å»ä¸­å¿ƒåŒ–çš„ï¼Œè€Œæ˜¯ä¸€ç§å¤šä¸­å¿ƒåŒ–æˆ–è€…éƒ¨åˆ†å»ä¸­å¿ƒåŒ–çš„åŒºå—é“¾ã€‚åœ¨åŒºå—é“¾ç³»ç»Ÿè¿è¡Œæ—¶ï¼Œå®ƒçš„å…±è¯†è¿‡ç¨‹å¯èƒ½ä¼šå—æŸäº›æŒ‡å®šèŠ‚ç‚¹çš„æ§åˆ¶ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªæœ‰15ä¸ªé‡‘èæœºæ„æ¥å…¥çš„åŒºå—é“¾ç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªæœºæ„éƒ½ä½œä¸ºé“¾ä¸Šçš„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ¯ç¡®è®¤ä¸€ç¬”äº¤æ˜“ï¼Œéƒ½éœ€è¦è‡³å°‘å¯¹10ä¸ªèŠ‚ç‚¹è¿›è¡Œç¡®è®¤ï¼ˆ2/3ç¡®è®¤ï¼‰ï¼Œè¿™ç¬”äº¤æ˜“æˆ–è€…è¿™ä¸ªåŒºå—æ‰èƒ½è¢«è®¤å¯ã€‚è”ç›Ÿé“¾è´¦æœ¬ä¸Šçš„æ•°æ®ä¸å…¬æœ‰é“¾çš„å®Œå…¨å…¬å¼€æ˜¯ä¸åŒçš„ï¼Œåªæœ‰è”ç›Ÿæˆå‘˜èŠ‚ç‚¹æ‰å¯ä»¥è®¿é—®ï¼Œå¹¶ä¸”é“¾ä¸Šçš„è¯»å†™æƒé™ã€å‚ä¸è®°è´¦è§„åˆ™ç­‰æ“ä½œä¹Ÿéœ€è¦ç”±è”ç›Ÿæˆå‘˜èŠ‚ç‚¹å…±åŒå†³å®šã€‚ç”±äºè”ç›Ÿé“¾åœºæ™¯ä¸­çš„å‚ä¸è€…ç»„æˆä¸€ä¸ªè”ç›Ÿï¼Œ å‚ä¸å…±è¯†çš„èŠ‚ç‚¹ç›¸å¯¹å…¬æœ‰é“¾è€Œè¨€ä¼šå°‘å¾ˆå¤šï¼Œå¹¶ä¸”ä¸€èˆ¬æ˜¯é’ˆå¯¹æŸä¸ªå•†ä¸šåœºæ™¯ï¼Œæ‰€ä»¥å…±è¯†åè®®ä¸€èˆ¬ä¸é‡‡ç”¨ä¸å·¥ä½œé‡è¯æ˜ç±»ä¼¼çš„æŒ–çŸ¿æœºåˆ¶ï¼ŒåŒæ—¶ä¹Ÿä¸ä¸€å®šéœ€è¦ä»£å¸ä½œä¸ºæ¿€åŠ±æœºåˆ¶ï¼Œè€Œæ˜¯é‡‡ç”¨PBFTã€RAFTè¿™ç±»é€‚ç”¨äºå¤šä¸­å¿ƒåŒ–ä¸”æ•ˆç‡è¾ƒé«˜çš„å…±è¯†ç®—æ³•ã€‚åŒæ—¶ï¼Œè”ç›Ÿé“¾å¯¹äº¤æ˜“çš„æ—¶é—´ã€çŠ¶æ€ã€æ¯ç§’äº¤æ˜“æ•°ç­‰ä¸å…¬æœ‰é“¾æœ‰å¾ˆå¤§åŒºåˆ«ï¼Œæ‰€ä»¥å®ƒæ¯”å…¬æœ‰é“¾æœ‰æ›´é«˜çš„å®‰å…¨å’Œæ€§èƒ½è¦æ±‚ã€‚\nè”ç›Ÿé“¾å±äºä¸€ç§è®¸å¯é“¾ï¼Œæ„å‘³ç€ä¸æ˜¯ä»»ä½•äººéƒ½èƒ½è‡ªç”±åŠ å…¥ç½‘ç»œä¸­ï¼Œè€Œæ˜¯éœ€è¦ä¸€å®šçš„æƒé™è®¸å¯ï¼Œæ‰å¯ä»¥ä½œä¸ºä¸€ä¸ªæ–°çš„èŠ‚ç‚¹åŠ å…¥ã€‚å½“å‰è”ç›Ÿé“¾å…¸å‹çš„ä»£è¡¨æœ‰LinuxåŸºé‡‘ä¼šæ”¯æŒçš„è¶…çº§è´¦æœ¬ï¼ˆHyperledgerï¼‰é¡¹ç›®ã€R3åŒºå—é“¾è”ç›Ÿå¼€å‘çš„Cordaï¼Œä»¥åŠè¶£é“¾ç§‘æŠ€æ¨å‡ºçš„Hyperchainå¹³å°ç­‰ã€‚\n  ç§æœ‰é“¾ ç§æœ‰é“¾ï¼Œæ˜¯æŒ‡æ•´ä¸ªåŒºå—é“¾ä¸Šçš„æ‰€æœ‰å†™å…¥æƒé™ä»…ä»…æŒæ¡åœ¨ä¸€ä¸ªç»„ç»‡æ‰‹é‡Œï¼Œè€Œè¯»å–æƒé™å¯ä»¥æ ¹æ®æƒ…å†µå¯¹å¤–å¼€æ”¾æˆ–è€…ä»»æ„è¿›è¡Œé™åˆ¶ã€‚æ‰€ä»¥ï¼Œç§æœ‰é“¾çš„åº”ç”¨åœºæ™¯ä¸€èˆ¬æ˜¯å•ä¸€çš„ä¼ä¸šå†…éƒ¨æ€»å…¬å¸å¯¹åˆ†å…¬å¸çš„ç®¡ç†æ–¹é¢ï¼Œå¦‚æ•°æ®åº“ç®¡ç†å’Œå®¡è®¡ç­‰ã€‚ç›¸æ¯”äºå…¬æœ‰é“¾å’Œè”ç›Ÿé“¾ï¼Œç§æœ‰é“¾çš„ä»·å€¼ä¸»è¦ä½“ç°åœ¨å®ƒå¯ä»¥æä¾›ä¸€ä¸ªå®‰å…¨ã€å¯è¿½æº¯ã€ä¸å¯ç¯¡æ”¹çš„å¹³å°ï¼Œå¹¶ä¸”å¯ä»¥åŒæ—¶é˜²æ­¢æ¥è‡ªå†…éƒ¨å’Œå¤–éƒ¨çš„å®‰å…¨æ”»å‡»ã€‚ç›®å‰å¯¹äºç§æœ‰é“¾ç¡®å®å­˜åœ¨ç€ä¸€äº›äº‰è®®ï¼Œæœ‰äººè®¤ä¸ºç§æœ‰é“¾çš„æ„ä¹‰ä¸å¤§ï¼Œå› ä¸ºå®ƒéœ€è¦ä¾èµ–äºç¬¬ä¸‰æ–¹çš„åŒºå—é“¾å¹³å°æœºæ„ï¼Œæ‰€æœ‰çš„æƒé™éƒ½è¢«æ§åˆ¶åœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸­ï¼Œå·²ç»è¿èƒŒäº†åŒºå—é“¾æŠ€æœ¯çš„åˆè¡·ï¼Œä¸èƒ½ç®—ä¸€ç§åŒºå—é“¾æŠ€æœ¯ï¼Œè€Œæ˜¯å·²ç»å­˜åœ¨çš„åˆ†å¸ƒå¼è´¦æœ¬æŠ€æœ¯ã€‚ä½†æ˜¯ä¹Ÿæœ‰äººè®¤ä¸ºç§æœ‰é“¾æ‹¥æœ‰å¾ˆå¤§çš„æ½œåœ¨ä»·å€¼ï¼Œå› ä¸ºå®ƒå¯ä»¥ç»™å½“å‰å­˜åœ¨çš„è®¸å¤šé—®é¢˜æä¾›ä¸€ä¸ªå¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆï¼Œæ¯”å¦‚ä¼ä¸šå†…éƒ¨è§„ç« åˆ¶åº¦çš„éµå®ˆã€é‡‘èæœºæ„çš„åæ´—é’±è¡Œä¸ºä»¥åŠæ”¿åºœéƒ¨é—¨çš„é¢„ç®—å’Œæ‰§è¡Œï¼Œç­‰ç­‰ã€‚\nä¸è”ç›Ÿé“¾ä¸€æ ·ï¼Œç§æœ‰é“¾ä¹Ÿå±äºä¸€ç§è®¸å¯é“¾ï¼Œä¸è¿‡å®ƒçš„è®¸å¯æƒæŒæ¡åœ¨å•ä¸€èŠ‚ç‚¹ä¸­ï¼Œåœ¨æœ‰äº›åœºæ™¯ä¸­ï¼Œç§æœ‰é“¾è¿˜è¢«ç§°ä¸ºä¸“æœ‰é“¾ã€‚å½“ä¸‹ç§æœ‰é“¾çš„åº”ç”¨ä¸æ˜¯å¾ˆå¤šï¼Œå¼€åˆ›è€…éƒ½åœ¨åŠªåŠ›æ¢ç´¢ä¹‹ä¸­ã€‚å½“å‰å·²ç»å­˜åœ¨çš„åº”ç”¨ä¸»è¦æœ‰è‹±å›½å¸ç§‘å­¦å…¬å¸ï¼ˆCoin Sciences Ltd.ï¼‰æ¨å‡ºçš„å¤šé“¾ï¼ˆMultichainï¼‰å¹³å°ï¼Œè¿™ä¸ªå¹³å°çš„å®—æ—¨æ˜¯å¸Œæœ›èƒ½å¸®åŠ©å„ä¼ä¸šå¿«é€Ÿåœ°éƒ¨ç½²ç§é“¾ç¯å¢ƒï¼Œæä¾›è‰¯å¥½çš„éšç§ä¿æŠ¤å’Œæƒé™æ§åˆ¶ã€‚\n  è‡ªè¯ç”Ÿè‡³ä»Šï¼ŒåŒºå—é“¾æŠ€æœ¯ç»å†äº†ä¸‰æ¬¡å¤§çš„æŠ€æœ¯æ¼”è¿›ï¼Œå…¶å…¸å‹ä»£è¡¨å¹³å°ä¸º2009å¹´çš„æ¯”ç‰¹å¸ã€2013å¹´çš„ä»¥å¤ªåŠå’Œ2015å¹´çš„Fabricå’ŒHyperchainï¼Œå…¶ç»„ç»‡å½¢æ€ä»èµ„æºæ¶ˆè€—ä¸¥é‡ã€äº¤æ˜“æ€§èƒ½ä½ä¸‹ã€ç¼ºä¹çµæ´»æ§åˆ¶æœºåˆ¶çš„å…¬æœ‰åŒºå—é“¾ï¼Œå‘é«˜æ•ˆå…±è¯†ã€æ™ºèƒ½å¯ç¼–ç¨‹ã€å¯ä¿æŠ¤éšç§çš„è”ç›ŸåŒºå—é“¾è½¬å˜ã€‚å½“å‰ï¼ŒHyperchianå¹³å°çš„TPSï¼ˆæ¯ç§’äº‹åŠ¡å¤„ç†é‡ï¼‰å·²è¾¾åˆ°åƒç”šè‡³ä¸‡é‡çº§ï¼Œå¯ä»¥æ»¡è¶³å¤§éƒ¨åˆ†å•†ä¸šåœºæ™¯çš„éœ€è¦ã€‚å°†æ¥ï¼Œéšç€æŠ€æœ¯çš„è¿›ä¸€æ­¥å‘å±•ï¼ŒåŸºäºè”ç›Ÿé“¾çš„åŒºå—é“¾å•†ä¸šåº”ç”¨å°†æˆä¸ºåŒºå—é“¾åº”ç”¨çš„ä¸»è¦å½¢æ€ã€‚\n4. åŒºå—é“¾å…³é”®æŠ€æœ¯ 4.1 åŸºç¡€æ¨¡å‹ åŒºå—é“¾åŸºæœ¬æ¶æ„å¯ä»¥åˆ†ä¸ºæ•°æ®å±‚ã€ç½‘ç»œå±‚ã€å…±è¯†å±‚ã€æ¿€åŠ±å±‚ã€åˆçº¦å±‚å’Œåº”ç”¨å±‚ï¼š\n æ•°æ®å±‚å°è£…äº†åŒºå—é“¾çš„é“¾å¼ç»“æ„ã€åŒºå—æ•°æ®ä»¥åŠéå¯¹ç§°åŠ å¯†ç­‰åŒºå—é“¾æ ¸å¿ƒæŠ€æœ¯ï¼› ç½‘ç»œå±‚æä¾›ç‚¹å¯¹ç‚¹çš„æ•°æ®é€šä¿¡ä¼ æ’­ä»¥åŠéªŒè¯æœºåˆ¶ï¼› å…±è¯†å±‚ä¸»è¦æ˜¯ç½‘ç»œèŠ‚ç‚¹é—´è¾¾æˆå…±è¯†çš„å„ç§å…±è¯†ç®—æ³•ï¼› æ¿€åŠ±å±‚å°†ç»æµå› ç´ å¼•å…¥åˆ°åŒºå—é“¾æŠ€æœ¯ä½“ç³»ä¹‹ä¸­ï¼Œä¸»è¦åŒ…æ‹¬ç»æµå› ç´ çš„å‘è¡Œæœºåˆ¶å’Œåˆ†é…æœºåˆ¶ï¼› åˆçº¦å±‚å±•ç¤ºäº†åŒºå—é“¾ç³»ç»Ÿçš„å¯ç¼–ç¨‹æ€§ï¼Œå°è£…äº†å„ç±»è„šæœ¬ã€æ™ºèƒ½åˆçº¦å’Œç®—æ³•ï¼› åº”ç”¨å±‚åˆ™å°è£…äº†åŒºå—é“¾æŠ€æœ¯çš„åº”ç”¨åœºæ™¯å’Œæ¡ˆä¾‹ã€‚  åœ¨è¯¥æ¶æ„ä¸­ï¼ŒåŸºäºæ—¶é—´æˆ³çš„é“¾å¼ç»“æ„ã€åˆ†å¸ƒå¼èŠ‚ç‚¹é—´çš„å…±è¯†æœºåˆ¶å’Œå¯ç¼–ç¨‹çš„æ™ºèƒ½åˆçº¦æ˜¯åŒºå—é“¾æŠ€æœ¯æœ€å…·ä»£è¡¨æ€§çš„åˆ›æ–°ç‚¹ã€‚ä¸€èˆ¬å¯ä»¥åœ¨åˆçº¦å±‚ç¼–å†™æ™ºèƒ½åˆçº¦æˆ–è€…è¿›è¡Œè„šæœ¬ç¼–ç¨‹ï¼Œæ¥æ„å»ºåŸºäºåŒºå—é“¾çš„å»ä¸­å¿ƒåŒ–åº”ç”¨ã€‚ä¸‹é¢å°†å¯¹æœ¬æ¶æ„ä¸­æ¯ä¸€å±‚æ‰€æ¶‰åŠçš„æŠ€æœ¯å±•å¼€å…·ä½“ä»‹ç»ã€‚ 4.2 æ•°æ®å±‚ æ•°æ®å±‚æ˜¯åŒºå—é“¾çš„æ ¸å¿ƒéƒ¨åˆ†ï¼ŒåŒºå—é“¾æœ¬è´¨ä¸Šæ˜¯ä¸€ç§æ•°æ®åº“æŠ€æœ¯å’Œåˆ†å¸ƒå¼å…±äº«è´¦æœ¬ï¼Œæ˜¯ç”±åŒ…å«äº¤æ˜“ä¿¡æ¯çš„åŒºå—ä»åå‘å‰æœ‰åºè¿æ¥èµ·æ¥çš„ä¸€ç§æ•°æ®ç»“æ„ã€‚è¯¥å±‚æ¶‰åŠçš„æŠ€æœ¯ä¸»è¦åŒ…æ‹¬ï¼šåŒºå—ç»“æ„ã€Merkleæ ‘ã€éå¯¹ç§°åŠ å¯†ã€æ—¶é—´æˆ³ã€æ•°å­—ç­¾åå’Œå“ˆå¸Œå‡½æ•°ã€‚æ—¶é—´æˆ³å’Œå“ˆå¸Œå‡½æ•°ç›¸å¯¹æ¯”è¾ƒç®€å•ï¼Œè¿™é‡Œé‡ç‚¹ä»‹ç»ä¸€ä¸‹åŒºå—ç»“æ„ã€Merkleæ ‘ã€éå¯¹ç§°åŠ å¯†å’Œæ•°å­—ç­¾åã€‚\nåŒºå—ç»“æ„ æ¯ä¸ªåŒºå—ä¸€èˆ¬éƒ½ç”±åŒºå—å¤´å’ŒåŒºå—ä½“ä¸¤éƒ¨åˆ†ç»„æˆã€‚å¦‚å›¾æ‰€ç¤ºï¼ŒåŒºå—å¤´éƒ¨åˆ†åŒ…å«äº†çˆ¶åŒºå—å“ˆå¸Œå€¼ã€æ—¶é—´æˆ³ã€Merkleæ ¹ç­‰ä¿¡æ¯ï¼Œè€ŒåŒºå—ä½“éƒ¨åˆ†åˆ™åŒ…å«ç€æ­¤åŒºå—ä¸­æ‰€æœ‰çš„äº¤æ˜“ä¿¡æ¯ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæ¯ä¸€ä¸ªåŒºå—è¿˜å¯¹åº”ç€ä¸¤ä¸ªå€¼æ¥è¯†åˆ«åŒºå—ï¼šåŒºå—å¤´å“ˆå¸Œå€¼å’ŒåŒºå—é«˜åº¦ã€‚ æ¯ä¸€ä¸ªåŒºå—éƒ½ä¼šæœ‰ä¸€ä¸ªåŒºå—å¤´å“ˆå¸Œå€¼ï¼Œè¿™æ˜¯ä¸€ä¸ªé€šè¿‡SHA256ç®—æ³•å¯¹åŒºå—å¤´è¿›è¡ŒäºŒæ¬¡å“ˆå¸Œè®¡ç®—è€Œå¾—åˆ°çš„32å­—èŠ‚çš„æ•°å­—æŒ‡çº¹ã€‚ä¾‹å¦‚ï¼Œæ¯”ç‰¹å¸çš„ç¬¬ä¸€ä¸ªåŒºå—çš„å¤´å“ˆå¸Œå€¼ä¸º000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26fã€‚åŒºå—å¤´å“ˆå¸Œå€¼å¯ä»¥å”¯ä¸€æ ‡è¯†ä¸€ä¸ªåŒºå—é“¾ä¸Šçš„åŒºå—ï¼Œå¹¶ä¸”ä»»ä½•èŠ‚ç‚¹é€šè¿‡å¯¹åŒºå—å¤´è¿›è¡Œç®€å•çš„å“ˆå¸Œè®¡ç®—éƒ½å¯ä»¥å¾—åˆ°è¯¥åŒºå—å¤´çš„å“ˆå¸Œå€¼ã€‚åŒºå—å¤´å“ˆå¸Œä¹ŸåŒ…å«åœ¨åŒºå—çš„æ•´ä½“æ•°æ®ç»“æ„ä¸­ï¼Œä½†æ˜¯åŒºå—å¤´çš„æ•°æ®å’ŒåŒºå—ä½“çš„æ•°æ®å¹¶ä¸ä¸€å®šä¸€èµ·å­˜å‚¨ï¼Œä¸ºäº†æ£€ç´¢æ•ˆç‡èµ·è§ï¼Œåœ¨å®ç°ä¸­å¯ä»¥å°†äºŒè€…åˆ†å¼€å­˜å‚¨ã€‚\né™¤äº†é€šè¿‡å¤´å“ˆå¸Œå€¼æ¥è¯†åˆ«åŒºå—ï¼Œè¿˜å¯ä»¥é€šè¿‡åŒºå—é«˜åº¦æ¥å¯¹åŒºå—è¿›è¡Œè¯†åˆ«ã€‚ä¾‹å¦‚é«˜åº¦ä¸º0å’Œå‰é¢000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26fæ‰€ç´¢å¼•çš„åŒºå—éƒ½æ˜¯ç¬¬ä¸€ä¸ªåŒºå—ã€‚ä½†æ˜¯ä¸å¤´å“ˆå¸Œå€¼ä¸åŒçš„æ˜¯ï¼ŒåŒºå—é«˜åº¦å¹¶ä¸èƒ½å”¯ä¸€åœ°æ ‡è¯†ä¸€ä¸ªåŒºå—ã€‚ç”±äºåŒºå—é“¾å­˜åœ¨ç€åˆ†å‰æƒ…å†µï¼Œæ‰€ä»¥å¯èƒ½å­˜åœ¨2ä¸ªæˆ–ä»¥ä¸ŠåŒºå—çš„åŒºå—é«˜åº¦æ˜¯ä¸€æ ·çš„\nMerkleæ ‘ å‰é¢ä»‹ç»äº†åŒºå—å¤´å“ˆå¸Œå€¼ã€åŒºå—é«˜åº¦å’ŒåŒºå—å¤´çš„ç»“æ„ï¼Œæ¥ç€æ¥çœ‹çœ‹åŒºå—ä½“ã€‚åŒºå—ä½“å­˜å‚¨ç€äº¤æ˜“ä¿¡æ¯ï¼Œåœ¨åŒºå—ä¸­å®ƒä»¬æ˜¯ä»¥ä¸€æ£µMerkleæ ‘çš„æ•°æ®ç»“æ„è¿›è¡Œå­˜å‚¨çš„ï¼Œè€ŒMerkleæ ‘æ˜¯ä¸€ç§ç”¨æ¥æœ‰æ•ˆåœ°æ€»ç»“åŒºå—ä¸­æ‰€æœ‰äº¤æ˜“çš„æ•°æ®ç»“æ„ã€‚Merkleæ ‘æ˜¯ä¸€æ£µå“ˆå¸ŒäºŒå‰æ ‘ï¼Œæ ‘çš„æ¯ä¸ªå¶å­èŠ‚ç‚¹éƒ½æ˜¯ä¸€ç¬”äº¤æ˜“çš„å“ˆå¸Œå€¼ã€‚ä»¥æ¯”ç‰¹å¸ä¸ºä¾‹ï¼Œåœ¨æ¯”ç‰¹å¸ç½‘ç»œä¸­ï¼ŒMerkleæ ‘è¢«ç”¨æ¥å½’çº³ä¸€ä¸ªåŒºå—ä¸­çš„æ‰€æœ‰äº¤æ˜“ï¼ŒåŒæ—¶ç”Ÿæˆæ•´ä¸ªäº¤æ˜“é›†åˆçš„æ•°å­—æŒ‡çº¹å³Merkleæ ‘æ ¹ï¼Œä¸”æä¾›äº†ä¸€ç§æ ¡éªŒåŒºå—æ˜¯å¦å­˜åœ¨æŸäº¤æ˜“çš„é«˜æ•ˆé€”å¾„ã€‚ç”Ÿæˆä¸€æ£µMerkleæ ‘éœ€è¦é€’å½’åœ°å¯¹æ¯ä¸¤ä¸ªå“ˆå¸ŒèŠ‚ç‚¹è¿›è¡Œå“ˆå¸Œå¾—åˆ°ä¸€ä¸ªæ–°çš„å“ˆå¸Œå€¼ï¼Œå¹¶å°†æ–°çš„å“ˆå¸Œå€¼å­˜å…¥Merkleæ ‘ä¸­ï¼Œç›´åˆ°ä¸¤ä¸¤ç»“åˆæœ€ç»ˆåªæœ‰ä¸€ä¸ªå“ˆå¸Œå€¼æ—¶ï¼Œè¿™ä¸ªå“ˆå¸Œå€¼å°±æ˜¯è¿™ä¸€åŒºå—æ‰€æœ‰äº¤æ˜“çš„Merkleæ ¹ï¼Œå­˜å‚¨åˆ°ä¸Šé¢ä»‹ç»çš„åŒºå—å¤´ç»“æ„ä¸­ã€‚ éå¯¹ç§°åŠ å¯†ä¸æ•°å­—ç­¾å éå¯¹ç§°åŠ å¯†æ˜¯åŒºå—é“¾æŠ€æœ¯ä¸­ç”¨äºå®‰å…¨æ€§éœ€æ±‚å’Œæ‰€æœ‰æƒè®¤è¯æ—¶é‡‡ç”¨çš„åŠ å¯†æŠ€æœ¯ï¼Œå¸¸è§çš„éå¯¹ç§°åŠ å¯†ç®—æ³•æœ‰RSAã€Elgamalã€èƒŒåŒ…ç®—æ³•ã€Rabinã€D-Hã€ECCï¼ˆæ¤­åœ†æ›²çº¿åŠ å¯†ç®—æ³•ï¼‰å’ŒECDSAï¼ˆæ¤­åœ†æ›²çº¿æ•°å­—ç­¾åç®—æ³•ï¼‰ï¼Œç­‰ç­‰ã€‚ä¸å¯¹ç§°åŠ å¯†ç®—æ³•ä¸åŒçš„æ˜¯ï¼Œéå¯¹ç§°åŠ å¯†ç®—æ³•éœ€è¦ä¸¤ä¸ªå¯†é’¥ï¼šå…¬å¼€å¯†é’¥ï¼ˆpublic keyï¼‰å’Œç§æœ‰å¯†é’¥ï¼ˆprivate keyï¼‰ã€‚åŸºäºéå¯¹ç§°åŠ å¯†ç®—æ³•å¯ä½¿é€šä¿¡åŒæ–¹åœ¨ä¸å®‰å…¨çš„åª’ä½“ä¸Šäº¤æ¢ä¿¡æ¯ï¼Œå®‰å…¨åœ°è¾¾æˆä¿¡æ¯çš„ä¸€è‡´ã€‚å…¬å¼€å¯†é’¥æ˜¯å¯¹å¤–å…¬å¼€çš„ï¼Œè€Œç§æœ‰å¯†é’¥æ˜¯ä¿å¯†çš„ï¼Œå…¶ä»–äººä¸èƒ½é€šè¿‡å…¬é’¥æ¨ç®—å‡ºå¯¹åº”çš„ç§é’¥ã€‚æ¯ä¸€ä¸ªå…¬å¼€å¯†é’¥éƒ½æœ‰å…¶ç›¸å¯¹åº”çš„ç§æœ‰å¯†é’¥ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨å…¬å¼€å¯†é’¥å¯¹ä¿¡æ¯è¿›è¡Œäº†åŠ å¯†ï¼Œé‚£ä¹ˆåˆ™å¿…é¡»æœ‰å¯¹åº”çš„ç§æœ‰å¯†é’¥æ‰èƒ½å¯¹åŠ å¯†åçš„ä¿¡æ¯è¿›è¡Œè§£å¯†ï¼›è€Œå¦‚æœæ˜¯ç”¨ç§æœ‰å¯†é’¥åŠ å¯†ä¿¡æ¯ï¼Œåˆ™åªæœ‰å¯¹åº”çš„å…¬å¼€å¯†é’¥æ‰å¯ä»¥è¿›è¡Œè§£å¯†ã€‚åœ¨åŒºå—é“¾ä¸­ï¼Œéå¯¹ç§°åŠ å¯†ä¸»è¦ç”¨äºä¿¡æ¯åŠ å¯†ã€æ•°å­—ç­¾åç­‰åœºæ™¯ã€‚\nåœ¨ä¿¡æ¯åŠ å¯†åœºæ™¯ä¸­ï¼Œå¦‚å›¾æ‰€ç¤ºï¼Œä¿¡æ¯å‘é€è€…Aéœ€è¦å‘é€ä¸€ä¸ªä¿¡æ¯ç»™ä¿¡æ¯æ¥æ”¶è€…Bï¼Œéœ€è¦å…ˆä½¿ç”¨Bçš„å…¬é’¥å¯¹ä¿¡æ¯è¿›è¡ŒåŠ å¯†ï¼ŒBæ”¶åˆ°åï¼Œä½¿ç”¨è‡ªå·±çš„ç§é’¥å°±å¯ä»¥å¯¹è¿™ä¸€ä¿¡æ¯è¿›è¡Œè§£å¯†ï¼Œè€Œå…¶ä»–äººæ²¡æœ‰ç§é’¥ï¼Œæ˜¯æ²¡åŠæ³•å¯¹è¿™ä¸ªåŠ å¯†ä¿¡æ¯è¿›è¡Œè§£å¯†çš„ã€‚ è€Œåœ¨æ•°å­—ç­¾ååœºæ™¯ä¸­ï¼Œå¦‚å›¾æ‰€ç¤ºï¼Œå‘é€è€…Aå…ˆç”¨å“ˆå¸Œå‡½æ•°å¯¹åŸæ–‡ç”Ÿæˆä¸€ä¸ªæ‘˜è¦ï¼ˆDigestï¼‰ï¼Œç„¶åä½¿ç”¨ç§é’¥å¯¹æ‘˜è¦è¿›è¡ŒåŠ å¯†ï¼Œç”Ÿæˆæ•°å­—ç­¾åï¼ˆSignatureï¼‰ï¼Œä¹‹åå°†æ•°å­—ç­¾åä¸åŸæ–‡ä¸€èµ·å‘é€ç»™æ¥æ”¶è€…Bï¼›Bæ”¶åˆ°ä¿¡æ¯åä½¿ç”¨Açš„å…¬é’¥å¯¹æ•°å­—ç­¾åè¿›è¡Œè§£å¯†å¾—åˆ°æ‘˜è¦ï¼Œç”±æ­¤ç¡®ä¿ä¿¡æ¯æ˜¯Aå‘å‡ºçš„ï¼Œç„¶åå†å¯¹æ”¶åˆ°çš„åŸæ–‡ä½¿ç”¨å“ˆå¸Œå‡½æ•°äº§ç”Ÿæ‘˜è¦ï¼Œå¹¶ä¸è§£å¯†å¾—åˆ°çš„æ‘˜è¦è¿›è¡Œå¯¹æ¯”ï¼Œå¦‚æœç›¸åŒï¼Œåˆ™è¯´æ˜æ”¶åˆ°çš„ä¿¡æ¯åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ²¡æœ‰è¢«ä¿®æ”¹è¿‡ã€‚ 4.3 ç½‘ç»œå±‚ ç½‘ç»œå±‚æ˜¯åŒºå—é“¾å¹³å°ä¿¡æ¯ä¼ è¾“çš„åŸºç¡€ï¼Œé€šè¿‡P2Pçš„ç»„ç½‘æ–¹å¼ã€ç‰¹å®šçš„ä¿¡æ¯ä¼ æ’­åè®®å’Œæ•°æ®éªŒè¯æœºåˆ¶ï¼Œä½¿å¾—åŒºå—é“¾ç½‘ç»œä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥å¹³ç­‰åœ°å‚ä¸å…±è¯†ä¸è®°è´¦ã€‚ä¸‹é¢å°†è¯¦ç»†ä»‹ç»åŒºå—é“¾å¹³å°ç½‘ç»œå±‚ä¸­çš„P2Pç½‘ç»œæ¶æ„ã€ä¿¡æ¯ä¼ è¾“æœºåˆ¶å’Œæ•°æ®éªŒè¯æœºåˆ¶ã€‚\nP2Pç½‘ç»œæ¶æ„\nåŒºå—é“¾ç½‘ç»œæ¶æ„ä¸€èˆ¬é‡‡ç”¨çš„æ˜¯åŸºäºäº’è”ç½‘çš„P2Pï¼ˆpeer-to-peerï¼‰æ¶æ„ï¼Œåœ¨P2Pç½‘ç»œä¸­ï¼Œæ¯å°è®¡ç®—æœºæ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯å¯¹ç­‰çš„ï¼Œå®ƒä»¬å…±åŒä¸ºå…¨ç½‘æä¾›æœåŠ¡ã€‚è€Œä¸”ï¼Œæ²¡æœ‰ä»»ä½•ä¸­å¿ƒåŒ–çš„æœåŠ¡ç«¯ï¼Œæ¯å°ä¸»æœºéƒ½å¯ä»¥ä½œä¸ºæœåŠ¡ç«¯å“åº”è¯·æ±‚ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºå®¢æˆ·ç«¯ä½¿ç”¨å…¶ä»–èŠ‚ç‚¹æ‰€æä¾›çš„æœåŠ¡ã€‚P2Pé€šä¿¡ä¸éœ€è¦ä»å…¶ä»–å®ä½“æˆ–CAè·å–åœ°å€éªŒè¯ï¼Œå› æ­¤æœ‰æ•ˆåœ°æ¶ˆé™¤äº†ç¯¡æ”¹çš„å¯èƒ½æ€§å’Œç¬¬ä¸‰æ–¹æ¬ºéª—ã€‚æ‰€ä»¥P2Pç½‘ç»œæ˜¯å»ä¸­å¿ƒåŒ–å’Œå¼€æ”¾çš„ï¼Œè¿™ä¹Ÿæ­£ç¬¦åˆåŒºå—é“¾æŠ€æœ¯çš„ç†å¿µã€‚\nåœ¨åŒºå—é“¾ç½‘ç»œä¸­ï¼Œæ‰€æœ‰çš„èŠ‚ç‚¹åœ°ä½å‡ç­‰ä¸”ä»¥æ‰å¹³å¼æ‹“æ‰‘ç»“æ„ç›¸äº’è¿é€šå’Œäº¤äº’ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½éœ€è¦æ‰¿æ‹…ç½‘ç»œè·¯ç”±ã€éªŒè¯åŒºå—æ•°æ®ã€ä¼ æ’­åŒºå—æ•°æ®ç­‰åŠŸèƒ½ã€‚åœ¨æ¯”ç‰¹å¸ç½‘ç»œä¸­ï¼Œå­˜åœ¨ç€ä¸¤ç±»èŠ‚ç‚¹ï¼Œä¸€ç±»æ˜¯å…¨èŠ‚ç‚¹ï¼Œå®ƒä¿å­˜ç€åŒºå—é“¾ä¸Šæ‰€æœ‰çš„å®Œæ•´æ•°æ®ä¿¡æ¯ï¼Œå¹¶éœ€è¦å®æ—¶åœ°å‚ä¸åŒºå—é“¾æ•°æ®çš„æ ¡éªŒå’Œè®°å½•æ¥æ›´æ–°åŒºå—é“¾ä¸»é“¾ã€‚å¦ä¸€ç±»æ˜¯è½»èŠ‚ç‚¹ï¼Œå®ƒåªä¿å­˜ç€åŒºå—é“¾ä¸­çš„éƒ¨åˆ†ä¿¡æ¯ï¼Œé€šè¿‡ç®€æ˜“æ”¯ä»˜éªŒè¯ï¼ˆSPVï¼‰æ–¹å¼å‘å…¶ä»–ç›¸é‚»çš„èŠ‚ç‚¹è¯·æ±‚æ•°æ®ä»¥ä¾¿å®Œæˆæ•°æ®çš„éªŒè¯ã€‚\nä¼ è¾“æœºåˆ¶\nåœ¨æ–°çš„åŒºå—æ•°æ®ç”Ÿæˆåï¼Œç”Ÿæˆè¯¥æ•°æ®çš„èŠ‚ç‚¹ä¼šå°†å…¶å¹¿æ’­åˆ°å…¨ç½‘çš„å…¶ä»–èŠ‚ç‚¹ä»¥ä¾›éªŒè¯ã€‚ç›®å‰çš„åŒºå—é“¾åº•å±‚å¹³å°ä¸€èˆ¬éƒ½ä¼šæ ¹æ®è‡ªèº«çš„å®é™…åº”ç”¨éœ€æ±‚ï¼Œåœ¨æ¯”ç‰¹å¸ä¼ è¾“æœºåˆ¶çš„åŸºç¡€ä¸Šé‡æ–°è®¾è®¡æˆ–è€…æ”¹è¿›å‡ºæ–°çš„ä¼ è¾“æœºåˆ¶ï¼Œå¦‚ä»¥å¤ªåŠåŒºå—é“¾é›†æˆäº†æ‰€è°“çš„â€œå¹½çµåè®®â€ï¼Œä»¥è§£å†³å› åŒºå—æ•°æ®ç¡®è®¤é€Ÿåº¦å¿«è€Œå¯¼è‡´çš„é«˜åŒºå—ä½œåºŸç‡å’Œéšä¹‹è€Œæ¥çš„å®‰å…¨æ€§é£é™©ã€‚è¿™é‡Œæˆ‘ä»¬ä»¥ä¸­æœ¬èªè®¾è®¡çš„æ¯”ç‰¹å¸ç³»ç»Ÿä¸ºä¾‹ï¼Œåˆ—å‡ºå…¶ä¼ è¾“åè®®çš„æ­¥éª¤å¦‚ä¸‹ï¼š\n  æ¯”ç‰¹å¸äº¤æ˜“èŠ‚ç‚¹å°†æ–°ç”Ÿæˆçš„äº¤æ˜“æ•°æ®å‘å…¨ç½‘æ‰€æœ‰èŠ‚ç‚¹è¿›è¡Œå¹¿æ’­ï¼›\n  æ¯ä¸ªèŠ‚ç‚¹éƒ½å°†æ”¶é›†åˆ°çš„äº¤æ˜“æ•°æ®å­˜å‚¨åˆ°ä¸€ä¸ªåŒºå—ä¸­ï¼›\n  æ¯ä¸ªèŠ‚ç‚¹åŸºäºè‡ªèº«ç®—åŠ›åœ¨åŒºå—ä¸­æ‰¾åˆ°ä¸€ä¸ªå…·æœ‰è¶³å¤Ÿéš¾åº¦çš„å·¥ä½œé‡è¯æ˜ï¼›\n  å½“èŠ‚ç‚¹æ‰¾åˆ°åŒºå—çš„å·¥ä½œé‡è¯æ˜åï¼Œå°±å‘å…¨ç½‘æ‰€æœ‰èŠ‚ç‚¹å¹¿æ’­æ­¤åŒºå—ï¼›\n  åªæœ‰åŒ…å«åœ¨åŒºå—ä¸­çš„æ‰€æœ‰äº¤æ˜“éƒ½æœ‰æ•ˆä¸”ä¹‹å‰æœªå­˜åœ¨è¿‡ï¼Œå…¶ä»–èŠ‚ç‚¹æ‰è®¤åŒè¯¥åŒºå—çš„æœ‰æ•ˆæ€§ï¼›\n  å…¶ä»–èŠ‚ç‚¹æ¥æ”¶è¯¥æ•°æ®åŒºå—ï¼Œå¹¶åœ¨è¯¥åŒºå—çš„æœ«å°¾åˆ¶é€ æ–°çš„åŒºå—ä»¥å»¶é•¿é“¾ï¼Œè€Œå°†è¢«æ¥æ”¶çš„åŒºå—çš„éšæœºå“ˆå¸Œå€¼è§†ä¸ºæ–°åŒºå—çš„å‰åºåŒºå—å“ˆå¸Œå€¼ã€‚\n  å¦‚æœäº¤æ˜“çš„ç›¸å…³èŠ‚ç‚¹æ˜¯ä¸€ä¸ªæœªä¸å…¶ä»–èŠ‚ç‚¹ç›¸è¿æ¥çš„æ–°èŠ‚ç‚¹ï¼Œæ¯”ç‰¹å¸ç³»ç»Ÿé€šå¸¸ä¼šå°†ä¸€ç»„é•¿æœŸç¨³å®šè¿è¡Œçš„â€œç§å­èŠ‚ç‚¹â€æ¨èç»™æ–°èŠ‚ç‚¹ä»¥å»ºç«‹è¿æ¥ï¼Œæˆ–è€…æ¨èè‡³å°‘ä¸€ä¸ªèŠ‚ç‚¹è¿æ¥æ–°èŠ‚ç‚¹ã€‚æ­¤å¤–ï¼Œè¿›è¡Œå¹¿æ’­çš„äº¤æ˜“æ•°æ®å¹¶ä¸éœ€è¦å…¨éƒ¨èŠ‚ç‚¹éƒ½æ¥æ”¶åˆ°ï¼Œåªè¦æœ‰è¶³å¤Ÿå¤šçš„èŠ‚ç‚¹åšå‡ºå“åº”ï¼Œäº¤æ˜“æ•°æ®ä¾¿å¯æ•´åˆåˆ°åŒºå—é“¾è´¦æœ¬ä¸­ã€‚è€Œæœªæ¥æ”¶åˆ°å®Œæ•´äº¤æ˜“æ•°æ®çš„èŠ‚ç‚¹å¯ä»¥å‘ä¸´è¿‘èŠ‚ç‚¹è¯·æ±‚ä¸‹è½½ç¼ºå¤±çš„äº¤æ˜“æ•°æ®ã€‚\néªŒè¯æœºåˆ¶ åœ¨åŒºå—é“¾ç½‘ç»œä¸­ï¼Œæ‰€æœ‰çš„èŠ‚ç‚¹éƒ½ä¼šæ—¶åˆ»ç›‘å¬ç½‘ç»œä¸­å¹¿æ’­çš„äº¤æ˜“æ•°æ®å’Œæ–°äº§ç”Ÿçš„åŒºå—ã€‚åœ¨æ¥æ”¶åˆ°ç›¸é‚»èŠ‚ç‚¹å‘æ¥çš„æ•°æ®åï¼Œä¼šé¦–å…ˆéªŒè¯è¯¥æ•°æ®çš„æœ‰æ•ˆæ€§ï¼Œè‹¥æ•°æ®æœ‰æ•ˆåˆ™æŒ‰æ¥æ”¶é¡ºåºä¸ºæ–°æ•°æ®å»ºç«‹å­˜å‚¨æ± æ¥æš‚å­˜è¿™äº›æ•°æ®ï¼Œå¹¶ä¸”ç»§ç»­å‘ä¸´è¿‘èŠ‚ç‚¹è½¬å‘ï¼›è‹¥æ•°æ®æ— æ•ˆåˆ™ç«‹å³åºŸå¼ƒè¯¥æ•°æ®ï¼Œä»è€Œä¿è¯æ— æ•ˆæ•°æ®ä¸ä¼šåœ¨åŒºå—é“¾ç½‘ç»œä¸­ç»§ç»­ä¼ æ’­ã€‚éªŒè¯æœ‰æ•ˆæ€§çš„æ–¹æ³•æ˜¯æ ¹æ®é¢„å®šä¹‰å¥½çš„æ ‡å‡†ï¼Œä»æ•°æ®ç»“æ„ã€è¯­æ³•è§„èŒƒæ€§ã€è¾“å…¥è¾“å‡ºå’Œæ•°å­—ç­¾åç­‰å„æ–¹é¢è¿›è¡Œæ ¡éªŒã€‚å¯¹äºæ–°åŒºå—çš„æ ¡éªŒåŒç†ï¼ŒæŸèŠ‚ç‚¹äº§ç”Ÿå‡ºæ–°åŒºå—åï¼Œå…¶ä»–èŠ‚ç‚¹æŒ‰ç…§é¢„å®šä¹‰çš„æ ‡å‡†å¯¹æ–°åŒºå—çš„å·¥ä½œé‡è¯æ˜ã€æ—¶é—´æˆ³ç­‰æ–¹é¢è¿›è¡Œæ ¡éªŒï¼Œè‹¥ç¡®è®¤æœ‰æ•ˆï¼Œåˆ™å°†è¯¥åŒºå—é“¾æ¥åˆ°ä¸»åŒºå—é“¾ä¸Šï¼Œå¹¶å¼€å§‹äº‰å–ä¸‹ä¸€ä¸ªåŒºå—çš„è®°è´¦æƒã€‚\n4.4 å…±è¯†å±‚ Leslie Lamportäº1982å¹´æå‡ºè‘—åçš„æ‹œå åº­å°†å†›é—®é¢˜ï¼Œå¼•å‘äº†æ— æ•°ç ”ç©¶è€…æ¢ç´¢è§£å†³æ–¹æ¡ˆã€‚å¦‚ä½•åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­é«˜æ•ˆåœ°è¾¾æˆå…±è¯†æ˜¯åˆ†å¸ƒå¼è®¡ç®—é¢†åŸŸçš„ä¸€ä¸ªé‡è¦ç ”ç©¶è¯¾é¢˜ã€‚åŒºå—é“¾çš„å…±è¯†å±‚çš„ä½œç”¨å°±æ˜¯åœ¨ä¸åŒçš„åº”ç”¨åœºæ™¯ä¸‹é€šè¿‡ä½¿ç”¨ä¸åŒçš„å…±è¯†ç®—æ³•ï¼Œåœ¨å†³ç­–æƒé«˜åº¦åˆ†æ•£çš„å»ä¸­å¿ƒåŒ–ç³»ç»Ÿä¸­ä½¿å¾—å„ä¸ªèŠ‚ç‚¹é«˜æ•ˆåœ°è¾¾æˆå…±è¯†ã€‚\næœ€åˆï¼Œæ¯”ç‰¹å¸åŒºå—é“¾é€‰ç”¨äº†ä¸€ç§ä¾èµ–èŠ‚ç‚¹ç®—åŠ›çš„å·¥ä½œé‡è¯æ˜å…±è¯†ï¼ˆProof of Workï¼ŒPoWï¼‰æœºåˆ¶æ¥ä¿è¯æ¯”ç‰¹å¸ç½‘ç»œåˆ†å¸ƒå¼è®°è´¦çš„ä¸€è‡´æ€§ã€‚ä¹‹åéšç€åŒºå—é“¾æŠ€æœ¯çš„ä¸æ–­æ¼”è¿›å’Œæ”¹è¿›ï¼Œç ”ç©¶è€…é™†ç»­æå‡ºäº†ä¸€äº›ä¸è¿‡åº¦ä¾èµ–ç®—åŠ›è€Œèƒ½è¾¾åˆ°å…¨ç½‘ä¸€è‡´çš„ç®—æ³•ï¼Œæ¯”å¦‚æƒç›Šè¯æ˜å…±è¯†ï¼ˆProof of Stakeï¼ŒPoSï¼‰æœºåˆ¶ã€æˆæƒè‚¡ä»½è¯æ˜å…±è¯†ï¼ˆDelegated Proof of Stakeï¼ŒDPoSï¼‰æœºåˆ¶ã€å®ç”¨æ‹œå åº­å®¹é”™ï¼ˆPractical Byzantine Fault Toleranceï¼ŒPBFTï¼‰ç®—æ³•ï¼Œç­‰ç­‰ã€‚ä¸‹é¢æˆ‘ä»¬å¯¹è¿™å‡ ç§å…±è¯†ç®—æ³•è¿›è¡Œç®€å•ä»‹ç»ã€‚\nPoWï¼ˆå·¥ä½œé‡è¯æ˜æœºåˆ¶ï¼‰\nPoWæœºåˆ¶è¯ç”Ÿäº1997å¹´ Adam Back è®¾è®¡çš„Hashcashç³»ç»Ÿï¼Œå®ƒæœ€åˆè¢«åˆ›é€ å‡ºæ¥ç”¨äºé¢„é˜²é‚®ä»¶ç³»ç»Ÿä¸­æ¼«å¤©éåœ°çš„åƒåœ¾é‚®ä»¶ã€‚2009å¹´ï¼Œä¸­æœ¬èªå°†PoWæœºåˆ¶è¿ç”¨äºæ¯”ç‰¹å¸åŒºå—é“¾ç½‘ç»œä¸­ï¼Œä½œä¸ºè¾¾æˆå…¨ç½‘ä¸€è‡´æ€§çš„å…±è¯†æœºåˆ¶ã€‚ä»ä¸¥æ ¼æ„ä¹‰ä¸Šè®²ï¼Œæ¯”ç‰¹å¸ä¸­æ‰€é‡‡ç”¨çš„æ˜¯ä¸€ç§å¯é‡å¤ä½¿ç”¨çš„Hashcashå·¥ä½œè¯æ˜ï¼Œä½¿å¾—ç”Ÿæˆå·¥ä½œè¯æ˜é‡å¯ä»¥æ˜¯ä¸€ä¸ªæ¦‚ç‡æ„ä¹‰ä¸Šçš„éšæœºè¿‡ç¨‹ã€‚åœ¨è¯¥æœºåˆ¶ä¸­ï¼Œç½‘ç»œä¸Šçš„æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½åœ¨ä½¿ç”¨SHA256å“ˆå¸Œç®—æ³•è¿ç®—ä¸€ä¸ªä¸æ–­å˜åŒ–çš„åŒºå—å¤´çš„å“ˆå¸Œå€¼ã€‚å…±è¯†è¦æ±‚ç®—å‡ºçš„å€¼å¿…é¡»ç­‰äºæˆ–è€…å°äºæŸä¸ªç»™å®šçš„å€¼ã€‚åœ¨åˆ†å¸ƒå¼ç½‘ç»œä¸­ï¼Œæ‰€æœ‰çš„å‚ä¸è€…éƒ½éœ€è¦ä½¿ç”¨ä¸åŒçš„éšæœºæ•°æ¥æŒç»­è®¡ç®—è¯¥å“ˆå¸Œå€¼ï¼Œç›´åˆ°è¾¾åˆ°ç›®æ ‡ä¸ºæ­¢ã€‚å½“ä¸€ä¸ªèŠ‚ç‚¹å¾—å‡ºäº†ç¡®åˆ‡çš„å€¼ï¼Œå…¶ä»–æ‰€æœ‰çš„èŠ‚ç‚¹å¿…é¡»ç›¸äº’ç¡®è®¤è¯¥å€¼çš„æ­£ç¡®æ€§ã€‚ä¹‹åï¼Œæ–°åŒºå—ä¸­çš„äº¤æ˜“å°†è¢«éªŒè¯ä»¥é˜²æ¬ºè¯ˆã€‚ç„¶åï¼Œç”¨äºè®¡ç®—çš„äº¤æ˜“ä¿¡æ¯çš„é›†åˆä¼šè¢«ç¡®è®¤ä¸ºè®¤è¯ç»“æœï¼Œç”¨åŒºå—é“¾ä¸­çš„æ–°åŒºå—è¡¨ç¤ºã€‚åœ¨æ¯”ç‰¹å¸ä¸­ï¼Œè¿ç®—å“ˆå¸Œå€¼çš„èŠ‚ç‚¹è¢«ç§°ä½œâ€œçŸ¿å·¥â€ï¼Œè€ŒPoWçš„è¿‡ç¨‹è¢«ç§°ä¸ºâ€œæŒ–çŸ¿â€ã€‚ç”±äºè®¤è¯çš„è®¡ç®—æ˜¯ä¸€ä¸ªè€—æ—¶çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥ä¹Ÿæå‡ºäº†ç›¸åº”çš„æ¿€åŠ±æœºåˆ¶ï¼ˆä¾‹å¦‚å‘çŸ¿å·¥æˆäºˆä¸€å°éƒ¨åˆ†æ¯”ç‰¹å¸ï¼‰ã€‚æ€»çš„æ¥è¯´ï¼Œå·¥ä½œé‡è¯æ˜å°±æ˜¯å¯¹äºå·¥ä½œé‡çš„è¯æ˜ï¼Œæ¯ä¸ªåŒºå—åŠ å…¥åˆ°é“¾ä¸Šï¼Œå¿…é¡»å¾—åˆ°ç½‘ç»œå‚ä¸è€…çš„åŒæ„éªŒè¯ï¼ŒçŸ¿å·¥å¯¹å®ƒå®Œæˆäº†ç›¸å¯¹åº”çš„å·¥ä½œé‡ã€‚PoWçš„ä¼˜ç‚¹æ˜¯å®Œå…¨çš„å»ä¸­å¿ƒåŒ–å’Œåˆ†å¸ƒå¼è´¦ç°¿ã€‚ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œå³æ¶ˆè€—èµ„æºï¼šæŒ–çŸ¿è¡Œä¸ºé€ æˆäº†å¤§é‡çš„èµ„æºæµªè´¹ï¼ŒåŒæ—¶PoWè¾¾æˆå…±è¯†çš„å‘¨æœŸä¹Ÿæ¯”è¾ƒé•¿ï¼Œæ¯”ç‰¹å¸ç½‘ç»œä¼šè‡ªåŠ¨è°ƒæ•´ç›®æ ‡å€¼æ¥ç¡®ä¿åŒºå—ç”Ÿæˆè¿‡ç¨‹å¤§çº¦éœ€è¦10åˆ†é’Ÿï¼Œå› æ­¤å®ƒä¸æ˜¯å¾ˆé€‚åˆå•†ä¸šè¿ç”¨ã€‚\nPoSï¼ˆè‚¡æƒè¯æ˜æœºåˆ¶ï¼‰\nPoSçš„æƒ³æ³•æºäºå°¼å…‹Â·è¨åšï¼ˆNick Szaboï¼‰ï¼Œæ˜¯PoWçš„ä¸€ç§èŠ‚èƒ½æ›¿ä»£é€‰æ‹©ï¼Œå®ƒä¸éœ€è¦ç”¨æˆ·åœ¨ä¸å—é™åˆ¶çš„ç©ºé—´ä¸­æ‰¾åˆ°ä¸€ä¸ªéšæœºæ•°ï¼Œè€Œæ˜¯è¦æ±‚äººä»¬è¯æ˜è´§å¸æ•°é‡çš„æ‰€æœ‰æƒï¼Œå› ä¸ºå…¶ç›¸ä¿¡æ‹¥æœ‰è´§å¸æ•°é‡å¤šçš„äººæ”»å‡»ç½‘ç»œçš„å¯èƒ½æ€§æ›´ä½ã€‚ç”±äºåŸºäºè´¦æˆ·ä½™é¢çš„é€‰æ‹©æ˜¯éå¸¸ä¸å…¬å¹³çš„ï¼Œå› ä¸ºå•ä¸€æœ€å¯Œæœ‰çš„äººåŠ¿å¿…åœ¨ç½‘ç»œä¸­å ä¸»å¯¼åœ°ä½ï¼Œæ‰€ä»¥æå‡ºäº†è®¸å¤šè§£å†³æ–¹æ¡ˆï¼Œç»“åˆè‚¡æƒæ¥å†³å®šè°æ¥åˆ›å»ºä¸‹ä¸€ä¸ªå—ã€‚å…¶ä¸­ï¼ŒBlackcoinä½¿ç”¨éšæœºé€‰æ‹©æ¥é¢„æµ‹ä¸‹ä¸€ä¸ªåˆ›å»ºè€…ï¼Œè€ŒPeercoinåˆ™å€¾å‘äºåŸºäºå¸é¾„æ¥é€‰æ‹©ã€‚Peercoiné¦–æ¬¡å¼€åˆ›æ€§åœ°å®ç°äº†çœŸæ­£çš„è‚¡æƒè¯æ˜ï¼Œå®ƒé‡‡ç”¨å·¥ä½œé‡è¯æ˜æœºåˆ¶å‘è¡Œæ–°å¸ï¼Œé‡‡ç”¨è‚¡æƒè¯æ˜æœºåˆ¶ç»´æŠ¤ç½‘ç»œå®‰å…¨ï¼Œè¿™ä¹Ÿæ˜¯â€œè™šæ‹Ÿè´§å¸â€å†å²ä¸Šçš„ä¸€æ¬¡åˆ›ä¸¾ã€‚åŒæ¯”ç‰¹å¸ç½‘ç»œè¦æ±‚è¯æ˜äººæ‰§è¡Œä¸€å®šé‡çš„å·¥ä½œä¸åŒï¼Œè¯¥æœºåˆ¶åªéœ€è¦è¯æ˜äººæä¾›ä¸€å®šæ•°é‡â€œæ•°å­—è´§å¸â€çš„æ‰€æœ‰æƒå³å¯ã€‚åœ¨è‚¡æƒè¯æ˜æœºåˆ¶ä¸­ï¼Œæ¯å½“åˆ›å»ºä¸€ä¸ªåŒºå—æ—¶ï¼ŒçŸ¿å·¥éœ€è¦åˆ›å»ºä¸€ä¸ªç§°ä¸ºâ€œå¸æƒâ€çš„äº¤æ˜“ï¼Œè¿™ä¸ªäº¤æ˜“ä¼šæŒ‰ç…§ä¸€å®šçš„æ¯”ä¾‹é¢„å…ˆå°†ä¸€äº›å¸å‘ç»™çŸ¿å·¥ã€‚ç„¶åè‚¡æƒè¯æ˜æœºåˆ¶æ ¹æ®æ¯ä¸ªèŠ‚ç‚¹æŒæœ‰ä»£å¸çš„æ¯”ä¾‹å’Œæ—¶é—´ï¼Œä¾æ®ç®—æ³•ç­‰æ¯”ä¾‹åœ°é™ä½èŠ‚ç‚¹çš„æŒ–çŸ¿éš¾åº¦ï¼Œä»¥åŠ å¿«èŠ‚ç‚¹å¯»æ‰¾éšæœºæ•°çš„é€Ÿåº¦ï¼Œç¼©çŸ­è¾¾æˆå…±è¯†æ‰€éœ€çš„æ—¶é—´ã€‚ä¸PoWç›¸æ¯”ï¼ŒPoSå¯ä»¥èŠ‚çœæ›´å¤šçš„èƒ½æºï¼Œæ›´æœ‰æ•ˆç‡ã€‚ä½†æ˜¯ï¼Œç”±äºæŒ–çŸ¿æˆæœ¬æ¥è¿‘äºé›¶ï¼Œå› æ­¤å¯èƒ½ä¼šé­å—æ”»å‡»ã€‚ä¸”PoSåœ¨æœ¬è´¨ä¸Šä»ç„¶éœ€è¦ç½‘ç»œä¸­çš„èŠ‚ç‚¹è¿›è¡ŒæŒ–çŸ¿è¿ç®—ï¼Œæ‰€ä»¥å®ƒåŒæ ·éš¾ä»¥åº”ç”¨äºå•†ä¸šé¢†åŸŸã€‚\nDPoSï¼ˆè‚¡ä»½æˆæƒè¯æ˜æœºåˆ¶ï¼‰\nDPoSç”±æ¯”ç‰¹è‚¡ï¼ˆBitsharesï¼‰é¡¹ç›®ç»„å‘æ˜ã€‚è‚¡æƒæ‹¥æœ‰è€…é€‰ä¸¾ä»–ä»¬çš„ä»£è¡¨æ¥è¿›è¡ŒåŒºå—çš„ç”Ÿæˆå’ŒéªŒè¯ã€‚DPoSç±»ä¼¼äºç°ä»£ä¼ä¸šè‘£äº‹ä¼šåˆ¶åº¦ï¼Œæ¯”ç‰¹è‚¡ç³»ç»Ÿå°†ä»£å¸æŒæœ‰è€…ç§°ä¸ºè‚¡ä¸œï¼Œç”±è‚¡ä¸œæŠ•ç¥¨é€‰å‡º101åä»£è¡¨ï¼Œç„¶åç”±è¿™äº›ä»£è¡¨è´Ÿè´£ç”Ÿæˆå’ŒéªŒè¯åŒºå—ã€‚æŒå¸è€…è‹¥æƒ³æˆä¸ºä¸€åä»£è¡¨ï¼Œéœ€å…ˆç”¨è‡ªå·±çš„å…¬é’¥å»åŒºå—é“¾æ³¨å†Œï¼Œè·å¾—ä¸€ä¸ªé•¿åº¦ä¸º32ä½çš„ç‰¹æœ‰èº«ä»½æ ‡è¯†ç¬¦ï¼Œè‚¡ä¸œå¯ä»¥å¯¹è¿™ä¸ªæ ‡è¯†ç¬¦ä»¥äº¤æ˜“çš„å½¢å¼è¿›è¡ŒæŠ•ç¥¨ï¼Œå¾—ç¥¨æ•°å‰101ä½è¢«é€‰ä¸ºä»£è¡¨ã€‚ä»£è¡¨ä»¬è½®æµäº§ç”ŸåŒºå—ï¼Œæ”¶ç›Šï¼ˆäº¤æ˜“æ‰‹ç»­è´¹ï¼‰å¹³åˆ†ã€‚å¦‚æœæœ‰çš„ä»£è¡¨ä¸è€å®ç”Ÿäº§åŒºå—ï¼Œå¾ˆå®¹æ˜“è¢«å…¶ä»–ä»£è¡¨å’Œè‚¡ä¸œå‘ç°ï¼Œä»–å°†ç«‹å³è¢«è¸¢å‡ºâ€œè‘£äº‹ä¼šâ€ï¼Œç©ºç¼ºä½ç½®ç”±ç¥¨æ•°æ’å102çš„ä»£è¡¨è‡ªåŠ¨å¡«è¡¥ã€‚DPoSçš„ä¼˜ç‚¹åœ¨äºå¤§å¹…å‡å°‘äº†å‚ä¸åŒºå—éªŒè¯å’Œè®°è´¦çš„èŠ‚ç‚¹æ•°é‡ï¼Œä»è€Œç¼©çŸ­äº†å…±è¯†éªŒè¯æ‰€éœ€è¦çš„æ—¶é—´ï¼Œå¤§å¹…æé«˜äº†äº¤æ˜“æ•ˆç‡ã€‚ä»æŸç§è§’åº¦æ¥è¯´ï¼ŒDPoSå¯ä»¥ç†è§£ä¸ºå¤šä¸­å¿ƒç³»ç»Ÿï¼Œå…¼å…·å»ä¸­å¿ƒåŒ–å’Œä¸­å¿ƒåŒ–ä¼˜åŠ¿\nPBFTï¼ˆå®ç”¨æ‹œå åº­å®¹é”™ç®—æ³•ï¼‰\nè¿™ä¸ªç®—æ³•æœ€åˆå‡ºç°åœ¨MITçš„Miguelå’ŒBarbara Liskovçš„å­¦æœ¯è®ºæ–‡ä¸­[33]ï¼Œåˆè¡·æ˜¯ä¸ºä¸€ä¸ªä½å»¶è¿Ÿå­˜å‚¨ç³»ç»Ÿæ‰€è®¾è®¡ï¼Œé™ä½ç®—æ³•çš„å¤æ‚åº¦ï¼Œè¯¥ç®—æ³•å¯ä»¥åº”ç”¨äºååé‡ä¸å¤§ä½†éœ€è¦å¤„ç†å¤§é‡äº‹ä»¶çš„æ•°å­—èµ„äº§å¹³å°ã€‚å®ƒå…è®¸æ¯ä¸ªèŠ‚ç‚¹å‘å¸ƒå…¬é’¥ï¼Œä»»ä½•é€šè¿‡èŠ‚ç‚¹çš„æ¶ˆæ¯éƒ½ç”±èŠ‚ç‚¹ç­¾åï¼Œä»¥éªŒè¯å…¶æ ¼å¼ã€‚éªŒè¯è¿‡ç¨‹åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼šé¢„å¤‡ã€å‡†å¤‡ã€è½å®ã€‚å¦‚æœå·²ç»æ”¶åˆ°è¶…è¿‡$\\frac{1}{3}$ä¸åŒèŠ‚ç‚¹çš„æ‰¹å‡†ï¼ŒæœåŠ¡æ“ä½œå°†æ˜¯æœ‰æ•ˆçš„ã€‚ä½¿ç”¨PBFTï¼ŒåŒºå—é“¾ç½‘ç»œ$N$ä¸ªèŠ‚ç‚¹ä¸­å¯ä»¥åŒ…å«$f$ä¸ªæ‹œå åº­æ¶æ„èŠ‚ç‚¹ï¼Œå…¶ä¸­$f=\\frac{N-1}{3}$ã€‚ æ¢å¥è¯è¯´ï¼ŒPBFTç¡®ä¿è‡³å°‘$2f+1$ä¸ªèŠ‚ç‚¹åœ¨å°†ä¿¡æ¯æ·»åŠ åˆ°åˆ†å¸ƒå¼å…±äº«è´¦ç°¿ä¹‹å‰è¾¾åˆ°å…±è¯†ã€‚ç›®å‰ï¼ŒHyperLedgerè”ç›Ÿã€ä¸­å›½ChinaLedger è”ç›Ÿç­‰è¯¸å¤šåŒºå—é“¾è”ç›Ÿéƒ½åœ¨ç ”ç©¶å’ŒéªŒè¯è¿™ä¸ªç®—æ³•çš„å®é™…éƒ¨ç½²å’Œåº”ç”¨ã€‚\n4.5 æ¿€åŠ±å±‚ æ¿€åŠ±å±‚ä½œä¸ºå°†ç»æµå› ç´ å¼•å…¥åŒºå—é“¾æŠ€æœ¯çš„ä¸€ä¸ªå±‚æ¬¡ï¼Œå…¶å­˜åœ¨çš„å¿…è¦æ€§å–å†³äºå»ºç«‹åœ¨åŒºå—é“¾æŠ€æœ¯ä¸Šçš„å…·ä½“åº”ç”¨éœ€æ±‚ã€‚è¿™é‡Œä»¥æ¯”ç‰¹å¸ç³»ç»Ÿä¸ºä¾‹ï¼Œå¯¹å…¶æ¿€åŠ±å±‚è¿›è¡Œä»‹ç»ã€‚\nåœ¨æ¯”ç‰¹å¸ç³»ç»Ÿä¸­ï¼Œå¤§é‡çš„èŠ‚ç‚¹ç®—åŠ›èµ„æºé€šè¿‡å…±è¯†è¿‡ç¨‹å¾—ä»¥æ±‡èšï¼Œä»è€Œå®ç°åŒºå—é“¾è´¦æœ¬çš„æ•°æ®éªŒè¯å’Œè®°è´¦å·¥ä½œï¼Œå› è€Œå…¶æœ¬è´¨ä¸Šæ˜¯ä¸€ç§å…±è¯†èŠ‚ç‚¹é—´çš„ä»»åŠ¡ä¼—åŒ…è¿‡ç¨‹ã€‚åœ¨å»ä¸­å¿ƒåŒ–ç³»ç»Ÿä¸­ï¼Œå…±è¯†èŠ‚ç‚¹æœ¬èº«æ˜¯è‡ªåˆ©çš„ï¼Œå…¶å‚ä¸æ•°æ®éªŒè¯å’Œè®°è´¦å·¥ä½œçš„æ ¹æœ¬ç›®çš„æ˜¯æœ€å¤§åŒ–è‡ªèº«æ”¶ç›Šã€‚æ‰€ä»¥ï¼Œå¿…é¡»è®¾è®¡åˆç†çš„æ¿€åŠ±æœºåˆ¶ï¼Œä½¿å¾—å…±è¯†èŠ‚ç‚¹æœ€å¤§åŒ–è‡ªèº«æ”¶ç›Šçš„ä¸ªä½“è¡Œä¸ºä¸åŒºå—é“¾ç³»ç»Ÿçš„å®‰å…¨æ€§å’Œæœ‰æ•ˆæ€§ç›¸å¥‘åˆï¼Œä»è€Œä½¿å¤§è§„æ¨¡çš„èŠ‚ç‚¹å¯¹åŒºå—é“¾å†å²å½¢æˆç¨³å®šçš„å…±è¯†ã€‚\næ¯”ç‰¹å¸é‡‡ç”¨PoWå…±è¯†æœºåˆ¶ï¼Œåœ¨è¯¥å…±è¯†ä¸­å…¶ç»æµæ¿€åŠ±ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šä¸€æ˜¯æ–°å‘è¡Œçš„æ¯”ç‰¹å¸ï¼›äºŒæ˜¯äº¤æ˜“æµé€šè¿‡ç¨‹ä¸­çš„æ‰‹ç»­è´¹ã€‚ä¸¤è€…ç»„åˆåœ¨ä¸€èµ·ï¼Œå¥–åŠ±ç»™PoWå…±è¯†è¿‡ç¨‹ä¸­æˆåŠŸè®¡ç®—å‡ºç¬¦åˆè¦æ±‚çš„éšæœºæ•°å¹¶ç”Ÿæˆæ–°åŒºå—çš„èŠ‚ç‚¹ã€‚å› æ­¤ï¼Œåªæœ‰å½“å„èŠ‚ç‚¹è¾¾æˆå…±è¯†ï¼Œå…±åŒåˆä½œæ¥æ„å»ºå’Œç»´æŠ¤åŒºå—é“¾å†å²è®°å½•åŠå…¶ç³»ç»Ÿçš„æœ‰æ•ˆæ€§ï¼Œå½“ä½œå¥–åŠ±çš„æ¯”ç‰¹å¸æ‰ä¼šæœ‰ä»·å€¼ã€‚\n å‘è¡Œæœºåˆ¶  åœ¨æ¯”ç‰¹å¸ç³»ç»Ÿä¸­ï¼Œæ–°åŒºå—äº§ç”Ÿå‘è¡Œæ¯”ç‰¹å¸çš„æ•°é‡æ˜¯éšç€æ—¶é—´é˜¶æ¢¯å‹é€’å‡çš„ã€‚ä»åˆ›ä¸–åŒºå—èµ·ï¼Œæ¯ä¸ªæ–°åŒºå—å°†å‘è¡Œ50ä¸ªæ¯”ç‰¹å¸å¥–åŠ±ç»™è¯¥åŒºå—çš„è®°è´¦è€…ï¼Œæ­¤åæ¯éš”çº¦4å¹´ï¼ˆ21ä¸‡ä¸ªåŒºå—ï¼‰ï¼Œæ¯ä¸ªæ–°åŒºå—å‘è¡Œçš„æ¯”ç‰¹å¸æ•°é‡å‡å°‘ä¸€åŠï¼Œä»¥æ­¤ç±»æ¨ï¼Œä¸€ç›´åˆ°æ¯”ç‰¹å¸çš„æ•°é‡ç¨³å®šåœ¨ä¸Šé™2100ä¸‡ä¸ºæ­¢ã€‚å‰æ–‡æåˆ°è¿‡ï¼Œç»™è®°è´¦è€…çš„å¦ä¸€éƒ¨åˆ†å¥–åŠ±æ˜¯æ¯”ç‰¹å¸äº¤æ˜“è¿‡ç¨‹ä¸­äº§ç”Ÿçš„æ‰‹ç»­è´¹ï¼Œç›®å‰é»˜è®¤çš„æ‰‹ç»­è´¹æ˜¯1/10000ä¸ªæ¯”ç‰¹å¸ã€‚ä¸¤éƒ¨åˆ†è´¹ç”¨ä¼šè¢«å°è£…åœ¨æ–°åŒºå—çš„ç¬¬ä¸€ä¸ªäº¤æ˜“ï¼ˆç§°ä¸ºCoinbaseäº¤æ˜“ï¼‰ä¸­ã€‚è™½ç„¶ç°åœ¨æ¯ä¸ªæ–°åŒºå—çš„æ€»æ‰‹ç»­è´¹ä¸æ–°å‘è¡Œçš„æ¯”ç‰¹å¸ç›¸æ¯”è¦å°‘å¾—å¤šï¼Œä½†éšç€æ—¶é—´æ¨ç§»ï¼Œæœªæ¥æ¯”ç‰¹å¸çš„å‘è¡Œæ•°é‡ä¼šè¶Šæ¥è¶Šå°‘ï¼Œç”šè‡³åœæ­¢å‘è¡Œï¼Œåˆ°é‚£æ—¶æ‰‹ç»­è´¹ä¾¿ä¼šæˆä¸ºå…±è¯†èŠ‚ç‚¹è®°è´¦çš„ä¸»è¦åŠ¨åŠ›ã€‚æ­¤å¤–ï¼Œæ‰‹ç»­è´¹è¿˜å¯ä»¥èµ·åˆ°ä¿éšœå®‰å…¨æ€§çš„ä½œç”¨ï¼Œé˜²æ­¢å¤§é‡å¾®é¢äº¤æ˜“å¯¹æ¯”ç‰¹å¸ç³»ç»Ÿå‘èµ·â€œç²‰å°˜æ”»å‡»â€ã€‚\nåˆ†é…æœºåˆ¶  éšç€æ¯”ç‰¹å¸æŒ–çŸ¿ç”Ÿæ€åœˆçš„æˆç†Ÿï¼Œâ€œçŸ¿æ± â€å‡ºç°åœ¨äººä»¬çš„è§†é‡ä¸­ã€‚å¤§é‡çš„å°ç®—åŠ›èŠ‚ç‚¹é€šè¿‡åŠ å…¥çŸ¿æ± è€Œè”åˆèµ·æ¥ï¼Œç›¸äº’åˆä½œæ±‡é›†ç®—åŠ›æ¥æé«˜è·å¾—è®°è´¦æƒçš„æ¦‚ç‡ï¼Œå¹¶å…±äº«ç”Ÿæˆæ–°åŒºå—å¾—åˆ°çš„æ–°å‘è¡Œæ¯”ç‰¹å¸å’Œäº¤æ˜“æ‰‹ç»­è´¹å¥–åŠ±ã€‚æ®Bitcoinminning.comç»Ÿè®¡ï¼Œç›®å‰å·²ç»å­˜åœ¨13ç§ä¸åŒçš„åˆ†é…æœºåˆ¶ã€‚ç°ä»Šä¸»æµçŸ¿æ± é€šå¸¸é‡‡ç”¨PPLNSï¼ˆPay Per Last N Sharesï¼‰ã€PPSï¼ˆPay Per Shareï¼‰å’ŒPROPï¼ˆPRO Portionatelyï¼‰ç­‰æœºåˆ¶ã€‚åœ¨çŸ¿æ± ä¸­ï¼Œæ ¹æ®å„ä¸ªèŠ‚ç‚¹è´¡çŒ®çš„ç®—åŠ›ï¼ŒæŒ‰æ¯”ä¾‹åˆ’åˆ†ä¸ºä¸åŒçš„è‚¡ä»½ã€‚PPLNSæœºåˆ¶åœ¨äº§ç”Ÿæ–°çš„åŒºå—åï¼Œå„åˆä½œèŠ‚ç‚¹æ ¹æ®å…¶åœ¨æœ€åNä¸ªè‚¡ä»½å†…è´¡çŒ®çš„å®é™…è‚¡ä»½æ¯”ä¾‹æ¥åˆ†é…å¥–åŠ±ï¼›PPSåˆ™ç›´æ¥æ ¹æ®è‚¡ä»½æ¯”ä¾‹ä¸ºå„èŠ‚ç‚¹ä¼°ç®—å’Œæ”¯ä»˜ä¸€ä¸ªå›ºå®šçš„ç†è®ºæ”¶ç›Šï¼Œé‡‡ç”¨æ­¤æ–¹å¼çš„çŸ¿æ± å°†ä¼šé€‚åº¦æ”¶å–æ‰‹ç»­è´¹æ¥å¼¥è¡¥å…¶ä¸ºå„ä¸ªèŠ‚ç‚¹æ‰¿æ‹…çš„æ”¶ç›Šä¸ç¡®å®šæ€§é£é™©ï¼›PROPæœºåˆ¶åˆ™æ ¹æ®èŠ‚ç‚¹è´¡çŒ®çš„è‚¡ä»½æŒ‰æ¯”ä¾‹åœ°åˆ†é…å¥–åŠ±ã€‚\n4.6 åˆçº¦å±‚ åˆçº¦å±‚å°è£…äº†å„ç±»è„šæœ¬ã€ç®—æ³•å’Œæ™ºèƒ½åˆçº¦ï¼Œæ˜¯åŒºå—é“¾å¯ç¼–ç¨‹æ€§çš„ä½“ç°ã€‚æ¯”ç‰¹å¸æœ¬èº«å°±å…·æœ‰ç®€å•è„šæœ¬çš„ç¼–å†™åŠŸèƒ½ï¼Œè€Œä»¥å¤ªåŠæå¤§åœ°å¼ºåŒ–äº†ç¼–ç¨‹è¯­è¨€åè®®ï¼Œç†è®ºä¸Šå¯ä»¥ç¼–å†™å®ç°ä»»ä½•åŠŸèƒ½çš„åº”ç”¨ã€‚å¦‚æœæŠŠæ¯”ç‰¹å¸çœ‹æˆæ˜¯å…¨çƒè´¦æœ¬çš„è¯ï¼Œä»¥å¤ªåŠå¯ä»¥çœ‹ä½œä¸€å°â€œå…¨çƒè®¡ç®—æœºâ€ï¼Œä»»ä½•äººéƒ½å¯ä»¥ä¸Šä¼ å’Œæ‰§è¡Œä»»æ„çš„åº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”ç¨‹åºçš„æœ‰æ•ˆæ‰§è¡Œèƒ½å¾—åˆ°ä¿è¯ã€‚å¦‚æœè¯´æ•°æ®ã€ç½‘ç»œå’Œå…±è¯†ä¸‰ä¸ªå±‚æ¬¡ä½œä¸ºåŒºå—é“¾åº•å±‚â€œè™šæ‹Ÿæœºâ€ï¼Œåˆ†åˆ«æ‰¿æ‹…æ•°æ®è¡¨ç¤ºã€æ•°æ®ä¼ æ’­å’Œæ•°æ®éªŒè¯åŠŸèƒ½ï¼Œåˆçº¦å±‚åˆ™æ˜¯å»ºç«‹åœ¨åŒºå—é“¾è™šæ‹Ÿæœºä¹‹ä¸Šçš„å•†ä¸šé€»è¾‘å’Œç®—æ³•ï¼Œæ˜¯å®ç°åŒºå—é“¾ç³»ç»Ÿçµæ´»ç¼–ç¨‹å’Œæ“ä½œæ•°æ®çš„åŸºç¡€ã€‚åŒ…æ‹¬æ¯”ç‰¹å¸åœ¨å†…çš„â€œæ•°å­—åŠ å¯†è´§å¸â€å¤§å¤šé‡‡ç”¨éå›¾çµå®Œå¤‡çš„ç®€å•è„šæœ¬ä»£ç æ¥ç¼–ç¨‹æ§åˆ¶äº¤æ˜“è¿‡ç¨‹ï¼Œè¿™ä¹Ÿæ˜¯æ™ºèƒ½åˆçº¦çš„é›å½¢ã€‚éšç€æŠ€æœ¯çš„å‘å±•ï¼Œç›®å‰å·²ç»å‡ºç°ä»¥å¤ªåŠç­‰å›¾çµå®Œå¤‡çš„å¯å®ç°æ›´ä¸ºå¤æ‚å’Œçµæ´»çš„æ™ºèƒ½åˆçº¦çš„è„šæœ¬è¯­è¨€ï¼Œä½¿å¾—åŒºå—é“¾èƒ½å¤Ÿæ”¯æŒå®è§‚é‡‘èå’Œç¤¾ä¼šç³»ç»Ÿçš„è¯¸å¤šåº”ç”¨ã€‚\næ™ºèƒ½åˆçº¦çš„æ¦‚å¿µå¯ä»¥è¿½æº¯åˆ°1995å¹´ï¼Œæ˜¯ç”±å­¦è€…å°¼å…‹Â·è¨åšæå‡ºå¹¶è¿›è¡Œå¦‚ä¸‹å®šä¹‰çš„ï¼šâ€œä¸€ä¸ªæ™ºèƒ½åˆçº¦æ˜¯ä¸€å¥—ä»¥æ•°å­—å½¢å¼å®šä¹‰çš„æ‰¿è¯ºï¼ŒåŒ…æ‹¬åˆçº¦å‚ä¸æ–¹å¯ä»¥åœ¨ä¸Šé¢æ‰§è¡Œè¿™äº›æ‰¿è¯ºçš„åè®®ã€‚â€å…¶è®¾è®¡åˆè¡·æ˜¯å¸Œæœ›é€šè¿‡å°†æ™ºèƒ½åˆçº¦å†…ç½®åˆ°ç‰©ç†å®ä½“æ¥åˆ›é€ å„ç§çµæ´»å¯æ§çš„æ™ºèƒ½èµ„äº§ã€‚ä½†ç”±äºè®¡ç®—æ‰‹æ®µçš„è½åå’Œåº”ç”¨åœºæ™¯çš„ç¼ºå¤±ï¼Œæ™ºèƒ½åˆçº¦åœ¨å½“æ—¶å¹¶æœªå—åˆ°ç ”ç©¶è€…çš„å¹¿æ³›å…³æ³¨ã€‚\nåŒºå—é“¾æŠ€æœ¯çš„å‡ºç°å¯¹æ™ºèƒ½åˆçº¦è¿›è¡Œäº†æ–°çš„å®šä¹‰å¹¶ä½¿å…¶æˆä¸ºäº†å¯èƒ½ã€‚æ™ºèƒ½åˆçº¦ä½œä¸ºåŒºå—é“¾æŠ€æœ¯çš„å…³é”®ç‰¹æ€§ä¹‹ä¸€ï¼Œæ˜¯è¿è¡Œåœ¨åŒºå—é“¾ä¸Šçš„æ¨¡å—åŒ–ã€å¯é‡ç”¨ã€è‡ªåŠ¨æ‰§è¡Œçš„è„šæœ¬ï¼Œèƒ½å¤Ÿå®ç°æ•°æ®å¤„ç†ã€ä»·å€¼è½¬ç§»ã€èµ„äº§ç®¡ç†ç­‰ä¸€ç³»åˆ—åŠŸèƒ½ã€‚åˆçº¦éƒ¨ç½²çš„æ—¶å€™è¢«è™šæ‹Ÿæœºç¼–è¯‘æˆæ“ä½œç å­˜å‚¨åœ¨åŒºå—é“¾ä¸Šï¼Œå¯¹åº”åœ°ä¼šæœ‰ä¸€ä¸ªå­˜å‚¨åœ°å€ã€‚å½“é¢„å®šçš„æ¡ä»¶å‘ç”Ÿæ—¶ï¼Œå°±ä¼šå‘é€ä¸€ç¬”äº¤æ˜“ï¼ˆtransactionï¼‰åˆ°è¯¥åˆçº¦åœ°å€ï¼Œå…¨ç½‘èŠ‚ç‚¹éƒ½ä¼šæ‰§è¡Œåˆçº¦è„šæœ¬ç¼–è¯‘ç”Ÿæˆçš„æ“ä½œç ï¼Œæœ€åå°†æ‰§è¡Œç»“æœå†™å…¥åŒºå—é“¾[ã€‚ä½œä¸ºä¸€ç§åµŒå…¥å¼ç¨‹åºåŒ–åˆçº¦ï¼Œæ™ºèƒ½åˆçº¦å¯ä»¥å†…ç½®åœ¨ä»»ä½•åŒºå—é“¾æ•°æ®ã€äº¤æ˜“æˆ–èµ„äº§ä¸­ï¼Œå½¢æˆå¯ç”±ç¨‹åºè‡ªè¡Œæ§åˆ¶çš„ç³»ç»Ÿã€å¸‚åœºæˆ–èµ„äº§ã€‚æ™ºèƒ½åˆçº¦ä¸ä»…ä¸ºé‡‘èè¡Œä¸šæä¾›äº†åˆ›æ–°æ€§çš„è§£å†³æ–¹æ¡ˆï¼ŒåŒæ—¶ä¹Ÿèƒ½åœ¨ç¤¾ä¼šç³»ç»Ÿä¸­çš„ä¿¡æ¯ã€èµ„äº§ã€åˆåŒã€ç›‘ç®¡ç­‰äº‹åŠ¡ç®¡ç†ä¸­å‘æŒ¥é‡è¦ä½œç”¨ã€‚\nåŸºäºåŒºå—é“¾æŠ€æœ¯çš„æ™ºèƒ½åˆçº¦ä¸ä»…å¯ä»¥å‘æŒ¥æ™ºèƒ½åˆçº¦åœ¨æˆæœ¬æ•ˆç‡æ–¹é¢çš„ä¼˜åŠ¿ï¼Œè¿˜å¯ä»¥é¿å…æ¶æ„è¡Œä¸ºå¯¹åˆçº¦æ­£å¸¸æ‰§è¡Œçš„å¹²æ‰°ã€‚æ™ºèƒ½åˆçº¦å¯ä»¥åº”ç”¨åˆ°ä»»ä½•ä¸€ç§æ•°æ®é©±åŠ¨çš„ä¸šåŠ¡é€»è¾‘ä¸­ï¼Œä»¥å¤ªåŠé¦–å…ˆçœ‹åˆ°äº†åŒºå—é“¾å’Œæ™ºèƒ½åˆçº¦çš„å¥‘åˆï¼Œå‘å¸ƒäº†ç™½çš®ä¹¦ã€Šä»¥å¤ªåŠï¼šä¸‹ä¸€ä»£æ™ºèƒ½åˆçº¦å’Œå»ä¸­å¿ƒåŒ–åº”ç”¨å¹³å°ã€‹ï¼Œæ„å»ºäº†å†…ç½®æœ‰å›¾çµå®Œå¤‡ç¼–ç¨‹è¯­è¨€çš„å…¬æœ‰åŒºå—é“¾ï¼Œä½¿å¾—ä»»ä½•äººéƒ½èƒ½å¤Ÿåˆ›å»ºåˆçº¦å’Œå»ä¸­å¿ƒåŒ–åº”ç”¨ã€‚\næ™ºèƒ½åˆçº¦ä¸åŒºå—é“¾çš„ç»“åˆï¼Œä¸°å¯Œäº†åŒºå—é“¾æœ¬èº«çš„ä»·å€¼å†…æ¶µï¼Œå…¶ç‰¹æ€§æœ‰ä»¥ä¸‹3ç‚¹ï¼š\n ç”¨ç¨‹åºé€»è¾‘ä¸­çš„ä¸°å¯Œåˆçº¦è§„åˆ™è¡¨è¾¾èƒ½åŠ›å®ç°äº†ä¸ä¿¡ä»»æ–¹ä¹‹é—´çš„å…¬å¹³äº¤æ¢ï¼Œé¿å…äº†æ¶æ„æ–¹ä¸­æ–­åè®®ç­‰å¯èƒ½æ€§ï¼› æœ€å°åŒ–äº¤æ˜“æ–¹ä¹‹é—´çš„äº¤äº’ï¼Œé¿å…äº†è®¡åˆ’å¤–çš„ç›‘æ§å’Œè·Ÿè¸ªçš„å¯èƒ½æ€§ï¼› ä¸°å¯Œäº†äº¤æ˜“ä¸å¤–ç•ŒçŠ¶æ€çš„äº¤äº’ï¼Œæ¯”å¦‚å¯ä¿¡æ•°æ®æºæä¾›çš„è‚¡ç¥¨ä¿¡æ¯ã€å¤©æ°”é¢„æŠ¥ç­‰ã€‚  ","permalink":"http://yangchnet.github.io/Dessert/posts/%E5%8C%BA%E5%9D%97%E9%93%BE/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/","summary":"1. åŒºå—é“¾å®šä¹‰ åŒºå—é“¾æŠ€æœ¯æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå»ä¸­å¿ƒåŒ–çš„æ•°æ®åº“ï¼Œå®ƒæ˜¯æ¯”ç‰¹å¸çš„æ ¸å¿ƒæŠ€æœ¯ä¸åŸºç¡€æ¶æ„ï¼Œæ˜¯åˆ†å¸ƒå¼æ•°æ®å­˜å‚¨ã€ç‚¹å¯¹ç‚¹ä¼ è¾“ã€å…±è¯†æœºåˆ¶ã€åŠ å¯†ç®—æ³•ç­‰è®¡ç®—æœºæŠ€æœ¯çš„æ–°å‹åº”ç”¨æ¨¡å¼ã€‚ç‹­ä¹‰æ¥è®²ï¼ŒåŒºå—é“¾æ˜¯ä¸€ç§æŒ‰ç…§æ—¶é—´é¡ºåºå°†æ•°æ®åŒºå—ä»¥é¡ºåºç›¸è¿çš„æ–¹å¼ç»„åˆæˆçš„ä¸€ç§é“¾å¼æ•°æ®ç»“æ„ï¼Œå¹¶ä»¥å¯†ç å­¦æ–¹å¼ä¿è¯çš„ä¸å¯ç¯¡æ”¹ã€ä¸å¯ä¼ªé€ çš„åˆ†å¸ƒå¼è´¦æœ¬ã€‚å¹¿ä¹‰æ¥è®²ï¼ŒåŒºå—é“¾æŠ€æœ¯æ˜¯åˆ©ç”¨å—é“¾å¼æ•°æ®ç»“æ„æ¥éªŒè¯ä¸å­˜å‚¨æ•°æ®ã€åˆ©ç”¨åˆ†å¸ƒå¼èŠ‚ç‚¹å…±è¯†ç®—æ³•æ¥ç”Ÿæˆå’Œæ›´æ–°æ•°æ®ã€åˆ©ç”¨å¯†ç å­¦æ–¹å¼ä¿è¯æ•°æ®ä¼ è¾“å’Œè®¿é—®çš„å®‰å…¨ã€åˆ©ç”¨ç”±è‡ªåŠ¨åŒ–è„šæœ¬ä»£ç ç»„æˆçš„æ™ºèƒ½åˆçº¦æ¥ç¼–ç¨‹å’Œæ“ä½œæ•°æ®çš„ä¸€ç§å…¨æ–°çš„åˆ†å¸ƒå¼åŸºç¡€æ¶æ„ä¸è®¡ç®—èŒƒå¼ã€‚\n1.1 åŒºå—é“¾çš„æŠ€æœ¯ç‰¹å¾ åŒºå—é“¾ä¸Šå­˜å‚¨çš„æ•°æ®éœ€ç”±å…¨ç½‘èŠ‚ç‚¹å…±åŒç»´æŠ¤ï¼Œå¯ä»¥åœ¨ç¼ºä¹ä¿¡ä»»çš„èŠ‚ç‚¹ä¹‹é—´æœ‰æ•ˆåœ°ä¼ é€’ä»·å€¼ã€‚ç›¸æ¯”ç°æœ‰çš„æ•°æ®åº“æŠ€æœ¯ï¼ŒåŒºå—é“¾å…·æœ‰ä»¥ä¸‹æŠ€æœ¯ç‰¹å¾ã€‚\n å—é“¾å¼æ•°æ®ç»“æ„\nåŒºå—é“¾åˆ©ç”¨å—é“¾å¼æ•°æ®ç»“æ„æ¥éªŒè¯å’Œå­˜å‚¨æ•°æ®ï¼Œé€šè¿‡ä¸Šæ–‡å¯¹åŒºå—é“¾åŸºæœ¬æ¦‚å¿µçš„ä»‹ç»å¯ä»¥çŸ¥é“ï¼Œæ¯ä¸ªåŒºå—æ‰“åŒ…è®°å½•äº†ä¸€æ®µæ—¶é—´å†…å‘ç”Ÿçš„äº¤æ˜“æ˜¯å¯¹å½“å‰è´¦æœ¬çš„ä¸€æ¬¡å…±è¯†ï¼Œå¹¶ä¸”é€šè¿‡è®°å½•ä¸Šä¸€ä¸ªåŒºå—çš„å“ˆå¸Œå€¼è¿›è¡Œå…³è”ï¼Œä»è€Œå½¢æˆå—é“¾å¼çš„æ•°æ®ç»“æ„ã€‚ åˆ†å¸ƒå¼å…±è¯†ç®—æ³•\nåŒºå—é“¾ç³»ç»Ÿåˆ©ç”¨åˆ†å¸ƒå¼å…±è¯†ç®—æ³•æ¥ç”Ÿæˆå’Œæ›´æ–°æ•°æ®ï¼Œä»æŠ€æœ¯å±‚é¢æœç»äº†éæ³•ç¯¡æ”¹æ•°æ®çš„å¯èƒ½æ€§ï¼Œä»è€Œå–ä»£äº†ä¼ ç»Ÿåº”ç”¨ä¸­ä¿è¯ä¿¡ä»»å’Œäº¤æ˜“å®‰å…¨çš„ç¬¬ä¸‰æ–¹ä¸­ä»‹æœºæ„ï¼Œé™ä½äº†ä¸ºç»´æŠ¤ä¿¡ç”¨è€Œé€ æˆçš„æ—¶é—´æˆæœ¬ã€äººåŠ›æˆæœ¬å’Œèµ„æºè€—ç”¨ å¯†ç å­¦æ–¹å¼\nåŒºå—é“¾ç³»ç»Ÿåˆ©ç”¨å¯†ç å­¦çš„æ–¹å¼ä¿è¯æ•°æ®ä¼ è¾“å’Œè®¿é—®çš„å®‰å…¨ã€‚å­˜å‚¨åœ¨åŒºå—é“¾ä¸Šçš„äº¤æ˜“ä¿¡æ¯æ˜¯å…¬å¼€çš„ï¼Œä½†è´¦æˆ·çš„èº«ä»½ä¿¡æ¯æ˜¯é«˜åº¦åŠ å¯†çš„ã€‚åŒºå—é“¾ç³»ç»Ÿé›†æˆäº†å¯¹ç§°åŠ å¯†ã€éå¯¹ç§°åŠ å¯†åŠå“ˆå¸Œç®—æ³•çš„ä¼˜ç‚¹ï¼Œå¹¶ä½¿ç”¨æ•°å­—ç­¾åæŠ€æœ¯æ¥ä¿è¯äº¤æ˜“çš„å®‰å…¨ã€‚  1.2 åŒºå—é“¾çš„åŠŸèƒ½ç‰¹å¾ åŒºå—é“¾ç³»ç»Ÿçš„ä»¥ä¸ŠæŠ€æœ¯ç‰¹å¾å†³å®šäº†å…¶åº”ç”¨å…·æœ‰å¦‚ä¸‹åŠŸèƒ½ç‰¹å¾ã€‚\n  å¤šä¸­å¿ƒ ä¸åŒäºä¼ ç»Ÿåº”ç”¨çš„ä¸­å¿ƒåŒ–æ•°æ®ç®¡ç†ï¼ŒåŒºå—é“¾ç½‘ç»œä¸­æœ‰å¤šä¸ªæœºæ„è¿›è¡Œç›¸äº’ç›‘ç£å¹¶å®æ—¶å¯¹è´¦ï¼Œä»è€Œé¿å…äº†å•ä¸€è®°è´¦äººé€ å‡çš„å¯èƒ½æ€§ï¼Œæé«˜äº†æ•°æ®çš„å®‰å…¨æ€§ã€‚\n  è‡ªåŠ¨åŒ– åŒºå—é“¾ç³»ç»Ÿä¸­çš„æ™ºèƒ½åˆçº¦æ˜¯å¯ä»¥è‡ªåŠ¨åŒ–æ‰§è¡Œä¸€äº›é¢„å…ˆå®šä¹‰å¥½çš„è§„åˆ™å’Œæ¡æ¬¾çš„ä¸€æ®µè®¡ç®—æœºç¨‹åºä»£ç ï¼Œå®ƒå¤§å¤§æé«˜äº†ç»æµæ´»åŠ¨ä¸å¥‘çº¦çš„è‡ªåŠ¨åŒ–ç¨‹åº¦ã€‚\n  å¯ä¿¡ä»» å­˜å‚¨åœ¨åŒºå—é“¾ä¸Šçš„äº¤æ˜“è®°å½•å’Œå…¶ä»–æ•°æ®æ˜¯ä¸å¯ç¯¡æ”¹å¹¶ä¸”å¯æº¯æºçš„ï¼Œæ‰€ä»¥èƒ½å¤Ÿå¾ˆå¥½åœ°è§£å†³å„æ–¹ä¸ä¿¡ä»»çš„é—®é¢˜ï¼Œæ— éœ€ç¬¬ä¸‰æ–¹å¯ä¿¡ä¸­ä»‹ã€‚\n  2. åŒºå—é“¾çš„ç›¸å…³æ¦‚å¿µ åŒºå—é“¾ä»¥å¯†ç å­¦çš„æ–¹å¼ç»´æŠ¤ä¸€ä»½ä¸å¯ç¯¡æ”¹å’Œä¸å¯ä¼ªé€ çš„åˆ†å¸ƒå¼è´¦æœ¬ï¼Œå¹¶é€šè¿‡åŸºäºåå•†ä¸€è‡´çš„è§„èŒƒå’Œåè®®ï¼ˆå…±è¯†æœºåˆ¶ï¼‰è§£å†³äº†å»ä¸­å¿ƒåŒ–çš„è®°è´¦ç³»ç»Ÿçš„ä¸€è‡´æ€§é—®é¢˜ï¼Œå…¶ç›¸å…³æ¦‚å¿µä¸»è¦åŒ…æ‹¬ä»¥ä¸‹ä¸‰ä¸ªã€‚\n äº¤æ˜“ï¼ˆTransactionï¼‰\nåŒºå—é“¾ä¸Šæ¯ä¸€æ¬¡å¯¼è‡´åŒºå—çŠ¶æ€å˜åŒ–çš„æ“ä½œéƒ½ç§°ä¸ºäº¤æ˜“ï¼Œæ¯ä¸€æ¬¡äº¤æ˜“å¯¹åº”å”¯ä¸€çš„äº¤æ˜“å“ˆå¸Œå€¼ï¼Œä¸€æ®µæ—¶é—´åä¾¿ä¼šå¯¹äº¤æ˜“è¿›è¡Œæ‰“åŒ…ã€‚ åŒºå—ï¼ˆBlockï¼‰\næ‰“åŒ…è®°å½•ä¸€æ®µæ—¶é—´å†…å‘ç”Ÿçš„äº¤æ˜“å’ŒçŠ¶æ€ç»“æœï¼Œæ˜¯å¯¹å½“å‰è´¦æœ¬çš„ä¸€æ¬¡å…±è¯†ã€‚æ¯ä¸ªåŒºå—ä»¥ä¸€ä¸ªç›¸å¯¹å¹³ç¨³çš„æ—¶é—´é—´éš”åŠ å…¥åˆ°é“¾ä¸Šï¼Œåœ¨ä¼ä¸šçº§åŒºå—é“¾å¹³å°ä¸­ï¼Œå…±è¯†æ—¶é—´å¯ä»¥åŠ¨æ€è®¾ç½®ã€‚ é“¾ï¼ˆChainï¼‰\nåŒºå—æŒ‰ç…§æ—¶é—´é¡ºåºä¸²è”èµ·æ¥ï¼Œé€šè¿‡æ¯ä¸ªåŒºå—è®°å½•ä¸Šä¸€ä¸ªåŒºå—çš„å“ˆå¸Œå€¼å…³è”ï¼Œæ˜¯æ•´ä¸ªçŠ¶æ€æ”¹å˜çš„æ—¥å¿—è®°å½•ã€‚   åŒºå—é“¾çš„ä¸»è¦ç»“æ„  å¦‚ä½•è§£å†³äº¤æ˜“ä¸­çš„ä¿¡ä»»å’Œå®‰å…¨é—®é¢˜ åŒºå—é“¾æŠ€æœ¯ä½“ç³»ä¸æ˜¯é€šè¿‡ä¸€ä¸ªæƒå¨çš„ä¸­å¿ƒåŒ–æœºæ„æ¥ä¿è¯äº¤æ˜“çš„å¯ä¿¡å’Œå®‰å…¨ï¼Œè€Œæ˜¯é€šè¿‡åŠ å¯†å’Œåˆ†å¸ƒå¼å…±è¯†æœºåˆ¶æ¥è§£å†³ä¿¡ä»»å’Œå®‰å…¨é—®é¢˜ï¼Œå…¶ä¸»è¦æŠ€æœ¯åˆ›æ–°æœ‰ä»¥ä¸‹4ç‚¹ã€‚\n  åˆ†å¸ƒå¼è´¦æœ¬ äº¤æ˜“æ˜¯ç”±åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å¤šä¸ªèŠ‚ç‚¹å…±åŒè®°å½•çš„ã€‚æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½è®°å½•å®Œæ•´çš„äº¤æ˜“è®°å½•ï¼Œå› æ­¤å®ƒä»¬éƒ½å¯ä»¥å‚ä¸ç›‘ç£äº¤æ˜“åˆæ³•æ€§å¹¶éªŒè¯äº¤æ˜“çš„æœ‰æ•ˆæ€§ã€‚ä¸åŒäºä¼ ç»Ÿçš„ä¸­å¿ƒåŒ–æŠ€æœ¯æ–¹æ¡ˆï¼ŒåŒºå—é“¾ä¸­æ²¡æœ‰ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹æœ‰æƒé™å•ç‹¬è®°å½•äº¤æ˜“ï¼Œä»è€Œé¿å…äº†å› å•ä¸€è®°è´¦äººæˆ–èŠ‚ç‚¹è¢«æ§åˆ¶è€Œé€ å‡çš„å¯èƒ½æ€§ã€‚å¦ä¸€æ–¹é¢ï¼Œç”±äºå…¨ç½‘èŠ‚ç‚¹å‚ä¸è®°å½•ï¼Œç†è®ºä¸Šè®²ï¼Œé™¤éæ‰€æœ‰çš„èŠ‚ç‚¹éƒ½è¢«ç ´åï¼Œå¦åˆ™äº¤æ˜“è®°å½•å°±ä¸ä¼šä¸¢å¤±ï¼Œä»è€Œä¿è¯äº†æ•°æ®çš„å®‰å…¨æ€§ã€‚\n  åŠ å¯†æŠ€æœ¯å’ŒæˆæƒæŠ€æœ¯ åŒºå—é“¾æŠ€æœ¯å¾ˆå¥½åœ°é›†æˆäº†å½“å‰å¯¹ç§°åŠ å¯†ã€éå¯¹ç§°åŠ å¯†å’Œå“ˆå¸Œç®—æ³•çš„è®¸å¤šä¼˜ç‚¹ï¼Œå¹¶ä½¿ç”¨äº†æ•°å­—ç­¾åæŠ€æœ¯æ¥ä¿è¯äº¤æ˜“çš„å®‰å…¨æ€§ï¼Œå…¶ä¸­æœ€å…·ä»£è¡¨æ€§çš„æ˜¯ä½¿ç”¨æ¤­åœ†æ›²çº¿åŠ å¯†ç®—æ³•ç”Ÿæˆç”¨æˆ·çš„å…¬ç§é’¥å¯¹å’Œä½¿ç”¨æ¤­åœ†æ›²çº¿æ•°å­—ç­¾åç®—æ³•æ¥ä¿è¯äº¤æ˜“å®‰å…¨ã€‚æ‰“åŒ…åœ¨åŒºå—ä¸Šçš„äº¤æ˜“ä¿¡æ¯å¯¹äºå‚ä¸å…±è¯†çš„æ‰€æœ‰èŠ‚ç‚¹æ˜¯å…¬å¼€çš„ï¼Œä½†æ˜¯è´¦æˆ·çš„èº«ä»½ä¿¡æ¯æ˜¯ç»è¿‡ä¸¥æ ¼åŠ å¯†çš„ã€‚\n  å…±è¯†æœºåˆ¶ å…±è¯†æœºåˆ¶æ˜¯åŒºå—é“¾ç³»ç»Ÿä¸­å„ä¸ªèŠ‚ç‚¹è¾¾æˆä¸€è‡´çš„ç­–ç•¥å’Œæ–¹æ³•ã€‚åŒºå—é“¾çš„å…±è¯†æœºåˆ¶æ›¿ä»£äº†ä¼ ç»Ÿåº”ç”¨ä¸­ä¿è¯ä¿¡ä»»å’Œäº¤æ˜“å®‰å…¨çš„ç¬¬ä¸‰æ–¹ä¸­å¿ƒæœºæ„ï¼Œèƒ½å¤Ÿé™ä½ç”±äºå„æ–¹ä¸ä¿¡ä»»è€Œäº§ç”Ÿçš„ç¬¬ä¸‰æ–¹ä¿¡ç”¨æˆæœ¬ã€æ—¶é—´æˆæœ¬å’Œèµ„æœ¬è€—ç”¨ã€‚å¸¸ç”¨çš„å…±è¯†æœºåˆ¶ä¸»è¦æœ‰PoWã€PoSã€DPoSã€Paxosã€PBFTç­‰ï¼Œå…±è¯†æœºåˆ¶æ—¢æ˜¯æ•°æ®å†™å…¥çš„æ–¹å¼ï¼Œä¹Ÿæ˜¯é˜²æ­¢ç¯¡æ”¹çš„æ‰‹æ®µã€‚\n  æ™ºèƒ½åˆçº¦ æ™ºèƒ½åˆçº¦æ˜¯å¯ä»¥è‡ªåŠ¨åŒ–æ‰§è¡Œé¢„å…ˆå®šä¹‰è§„åˆ™çš„ä¸€æ®µè®¡ç®—æœºç¨‹åºä»£ç ï¼Œå®ƒè‡ªå·±å°±æ˜¯ä¸€ä¸ªç³»ç»Ÿå‚ä¸è€…ã€‚å®ƒèƒ½å¤Ÿå®ç°ä»·å€¼çš„å­˜å‚¨ã€ä¼ é€’ã€æ§åˆ¶å’Œç®¡ç†ï¼Œä¸ºåŸºäºåŒºå—é“¾çš„åº”ç”¨æä¾›äº†åˆ›æ–°æ€§çš„è§£å†³æ–¹æ¡ˆã€‚\n  3. åŒºå—é“¾åˆ†ç±» æŒ‰ç…§èŠ‚ç‚¹å‚ä¸æ–¹å¼çš„ä¸åŒï¼ŒåŒºå—é“¾æŠ€æœ¯å¯ä»¥åˆ†ä¸ºï¼šå…¬æœ‰é“¾ï¼ˆPublic Blockchainï¼‰ã€è”ç›Ÿé“¾ï¼ˆConsortium Blockchainï¼‰å’Œç§æœ‰é“¾ï¼ˆPrivate Blockchainï¼‰ã€‚æŒ‰ç…§æƒé™çš„ä¸åŒï¼ŒåŒºå—é“¾æŠ€æœ¯å¯ä»¥åˆ†ä¸ºï¼šè®¸å¯é“¾ï¼ˆPermissioned Blockchainï¼‰å’Œéè®¸å¯é“¾ï¼ˆPermissionless Blockchainï¼‰ã€‚å‰è¿°çš„ä¸‰å¤§ç±»åŒºå—é“¾æŠ€æœ¯ä¸­ï¼Œè”ç›Ÿé“¾å’Œç§æœ‰é“¾å±äºè®¸å¯é“¾ï¼Œå…¬æœ‰é“¾å±äºéè®¸å¯é“¾ã€‚","title":"åŒºå—é“¾åŸºç¡€å…¥é—¨"},{"content":"1. sync.Mutexäº’æ–¥é” ä¸åŒgoroutineä¹‹é—´å¯¹å…¬å…±èµ„æºè¿›è¡Œè®¿é—®éœ€è¦ä½¿ç”¨äº’æ–¥é”ã€‚ä¾‹å¦‚åœ¨å¯¹é“¶è¡Œè´¦æˆ·çš„æ“ä½œä¸­ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ä¸¤ç§æ“ä½œï¼Œä¸€ä¸ªæ˜¯æŸ¥è¯¢ä½™é¢ï¼Œä¸€ä¸ªæ˜¯å­˜æ¬¾ã€‚å…¶æ“ä½œå¦‚ä¸‹ï¼š\npackage bank // å­˜æ¬¾ä½™é¢ var balance int // å­˜æ¬¾ func Deposit(amount int) { balance = balance + amount } // æŸ¥è¯¢ func Balance() int { return balance } // Alice: go func() { bank.Deposit(200) // A1  fmt.Println(\u0026#34;=\u0026#34;, bank.Balance()) // A2 }() // Bob: go bank.Deposit(100) // B è¿™å…¶ä¸­ï¼Œè‹¥æŠŠA1åˆ†ä¸ºä¸¤ä¸ªæ“ä½œï¼ŒA1rï¼šæŠŠä½™é¢ä»å†…å­˜ä¸­è¯»å‡ºæ¥ï¼›A2wï¼šæŠŠä¿®æ”¹åçš„ä½™é¢å†™å…¥å†…å­˜ã€‚\nè‹¥æ‰§è¡Œé¡ºåºä¸ºA1r â†’ B â†’ A1w â†’ A2ï¼Œ æ­£å¸¸æƒ…å†µä¸‹ï¼ŒAliceå’ŒBobåˆ†åˆ«å­˜å…¥äº†$200ï¼Œ$100ï¼Œå› æ­¤æœ€åçš„å­˜æ¬¾åº”è¯¥æ˜¯300ï¼Œä½†æœ€åè¾“å‡ºç»“æœä¸º200ã€‚å› ä¸ºAåœ¨è®¡ç®—æ—¶æ˜¯æŒ‰ç…§A1rè¯»å‡ºçš„æ•°å€¼è¿›è¡Œè®¡ç®—ï¼Œå¿½ç•¥äº†Bçš„æ“ä½œï¼ŒAä¸Bä¹‹é—´å‘ç”Ÿäº†æ•°æ®ç«äº‰ã€‚\n æ•°æ®ç«äº‰ï¼šæ— è®ºä»»ä½•æ—¶å€™ï¼Œåªè¦æœ‰ä¸¤ä¸ªgoroutineå¹¶å‘è®¿é—®åŒä¸€å˜é‡ï¼Œä¸”è‡³å°‘å…¶ä¸­çš„ä¸€ä¸ªæ˜¯å†™æ“ä½œçš„æ—¶å€™å°±ä¼šå‘ç”Ÿæ•°æ®ç«äº‰ã€‚\n è§£å†³æ­¤é—®é¢˜çš„åŠæ³•ä¹‹ä¸€æ˜¯ä½¿ç”¨äº’æ–¥é”ã€‚\nimport \u0026#34;sync\u0026#34; var ( mu sync.Mutex // guards balance  balance int ) func Deposit(amount int) { mu.Lock() defer mu.Unlock() balance = balance + amount } func Balance() int { mu.Lock() defer mu.Unlock() return balance } æ¯æ¬¡ä¸€ä¸ªgoroutineè®¿é—®bankå˜é‡æ—¶(è¿™é‡Œåªæœ‰balanceä½™é¢å˜é‡)ï¼Œå®ƒéƒ½ä¼šè°ƒç”¨mutexçš„Lockæ–¹æ³•æ¥è·å–ä¸€ä¸ªäº’æ–¥é”ã€‚å¦‚æœå…¶å®ƒçš„goroutineå·²ç»è·å¾—äº†è¿™ä¸ªé”çš„è¯ï¼Œè¿™ä¸ªæ“ä½œä¼šè¢«é˜»å¡ç›´åˆ°å…¶å®ƒgoroutineè°ƒç”¨äº†Unlockä½¿è¯¥é”å˜å›å¯ç”¨çŠ¶æ€.\n2. sync.RWMutexè¯»å†™é” ç”±äºBalanceå‡½æ•°åªéœ€è¦è¯»å–å˜é‡çš„çŠ¶æ€ï¼Œæ‰€ä»¥æˆ‘ä»¬åŒæ—¶è®©å¤šä¸ªBalanceè°ƒç”¨å¹¶å‘è¿è¡Œäº‹å®ä¸Š æ˜¯å®‰å…¨çš„ï¼Œåªè¦åœ¨è¿è¡Œçš„æ—¶å€™æ²¡æœ‰å­˜æ¬¾æˆ–è€…å–æ¬¾æ“ä½œå°±è¡Œã€‚åœ¨è¿™ç§åœºæ™¯ä¸‹æˆ‘ä»¬éœ€è¦ä¸€ç§ç‰¹æ®Š ç±»å‹çš„é”ï¼Œå…¶å…è®¸å¤šä¸ªåªè¯»æ“ä½œå¹¶è¡Œæ‰§è¡Œï¼Œä½†å†™æ“ä½œä¼šå®Œå…¨äº’æ–¥ã€‚è¿™ç§é”å«ä½œâ€œå¤šè¯»å•å†™â€é” (multiple readers, single writer lock)ï¼ŒGoè¯­è¨€æä¾›çš„è¿™æ ·çš„é”æ˜¯sync.RWMutexï¼š\nvar mu sync.RWMutex var balance int func Balance() int { mu.RLock() // readers lock  defer mu.RUnlock() return balance } è¯»å†™é”çš„è§„åˆ™æ˜¯\n è¯»é”ä¸èƒ½é˜»å¡è¯»é” è¯»é”éœ€è¦é˜»å¡å†™é”ï¼Œç›´åˆ°æ‰€æœ‰è¯»é”éƒ½é‡Šæ”¾ å†™é”éœ€è¦é˜»å¡è¯»é”ï¼Œç›´åˆ°æ‰€æœ‰å†™é”éƒ½é‡Šæ”¾ å†™é”éœ€è¦é˜»å¡å†™é”  ","permalink":"http://yangchnet.github.io/Dessert/posts/golang/go%E4%B8%AD%E7%9A%84%E9%94%81/","summary":"1. sync.Mutexäº’æ–¥é” ä¸åŒgoroutineä¹‹é—´å¯¹å…¬å…±èµ„æºè¿›è¡Œè®¿é—®éœ€è¦ä½¿ç”¨äº’æ–¥é”ã€‚ä¾‹å¦‚åœ¨å¯¹é“¶è¡Œè´¦æˆ·çš„æ“ä½œä¸­ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ä¸¤ç§æ“ä½œï¼Œä¸€ä¸ªæ˜¯æŸ¥è¯¢ä½™é¢ï¼Œä¸€ä¸ªæ˜¯å­˜æ¬¾ã€‚å…¶æ“ä½œå¦‚ä¸‹ï¼š\npackage bank // å­˜æ¬¾ä½™é¢ var balance int // å­˜æ¬¾ func Deposit(amount int) { balance = balance + amount } // æŸ¥è¯¢ func Balance() int { return balance } // Alice: go func() { bank.Deposit(200) // A1  fmt.Println(\u0026#34;=\u0026#34;, bank.Balance()) // A2 }() // Bob: go bank.Deposit(100) // B è¿™å…¶ä¸­ï¼Œè‹¥æŠŠA1åˆ†ä¸ºä¸¤ä¸ªæ“ä½œï¼ŒA1rï¼šæŠŠä½™é¢ä»å†…å­˜ä¸­è¯»å‡ºæ¥ï¼›A2wï¼šæŠŠä¿®æ”¹åçš„ä½™é¢å†™å…¥å†…å­˜ã€‚\nè‹¥æ‰§è¡Œé¡ºåºä¸ºA1r â†’ B â†’ A1w â†’ A2ï¼Œ æ­£å¸¸æƒ…å†µä¸‹ï¼ŒAliceå’ŒBobåˆ†åˆ«å­˜å…¥äº†$200ï¼Œ$100ï¼Œå› æ­¤æœ€åçš„å­˜æ¬¾åº”è¯¥æ˜¯300ï¼Œä½†æœ€åè¾“å‡ºç»“æœä¸º200ã€‚å› ä¸ºAåœ¨è®¡ç®—æ—¶æ˜¯æŒ‰ç…§A1rè¯»å‡ºçš„æ•°å€¼è¿›è¡Œè®¡ç®—ï¼Œå¿½ç•¥äº†Bçš„æ“ä½œï¼ŒAä¸Bä¹‹é—´å‘ç”Ÿäº†æ•°æ®ç«äº‰ã€‚\n æ•°æ®ç«äº‰ï¼šæ— è®ºä»»ä½•æ—¶å€™ï¼Œåªè¦æœ‰ä¸¤ä¸ªgoroutineå¹¶å‘è®¿é—®åŒä¸€å˜é‡ï¼Œä¸”è‡³å°‘å…¶ä¸­çš„ä¸€ä¸ªæ˜¯å†™æ“ä½œçš„æ—¶å€™å°±ä¼šå‘ç”Ÿæ•°æ®ç«äº‰ã€‚\n è§£å†³æ­¤é—®é¢˜çš„åŠæ³•ä¹‹ä¸€æ˜¯ä½¿ç”¨äº’æ–¥é”ã€‚\nimport \u0026#34;sync\u0026#34; var ( mu sync.Mutex // guards balance  balance int ) func Deposit(amount int) { mu.","title":"Goä¸­çš„é”"},{"content":"ä¸‰ä¸ªgoroutineåˆ†åˆ«è¾“å‡ºå¼ ä¸‰ã€æå››ã€ç‹äº”ï¼Œä½¿å…¶æŒ‰ä¸Šè¿°é¡ºåºè¾“å‡º5éã€‚ package main import ( \u0026#34;fmt\u0026#34; \u0026#34;sync\u0026#34; ) var w sync.WaitGroup func main() { w.Add(15) chan1 := make(chan struct{}, 0) chan2 := make(chan struct{}, 0) for i := 0; i \u0026lt; 5; i++ { go func() { defer w.Done() fmt.Println(\u0026#34;å¼ ä¸‰\u0026#34;) chan1 \u0026lt;- struct{}{} }() go func() { defer w.Done() \u0026lt;- chan1 fmt.Println(\u0026#34;æå››\u0026#34;) chan2 \u0026lt;- struct{}{} }() go func() { defer w.Done() \u0026lt;- chan2 fmt.Println(\u0026#34;ç‹äº”\u0026#34;) }() } w.Wait() } ç¼–å†™ç¨‹åºè¾“å‡ºæŸç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼ˆåŒ…æ‹¬å­ç›®å½•ï¼‰ package main import ( \u0026#34;fmt\u0026#34; \u0026#34;io/ioutil\u0026#34; \u0026#34;os\u0026#34; ) func main() { dir := os.Args[1] listAll(dir, 0) } func listAll(path string, curHier int) { fileInfos, err := ioutil.ReadDir(path) if err != nil { fmt.Println(err) return } for _, info := range fileInfos { if info.IsDir(){ for tmpHier := curHier; tmpHier \u0026gt; 0; tmpHier-- { fmt.Printf(\u0026#34;|\\t\u0026#34;) } fmt.Println(info.Name(), \u0026#34;\\\\\u0026#34;) listAll(path + \u0026#34;/\u0026#34; + info.Name(), curHier + 1) } else { for tmpHier := curHier; tmpHier \u0026gt; 0; tmpHier-- { fmt.Printf(\u0026#34;|\\t\u0026#34;) } fmt.Println(info.Name()) } } } ","permalink":"http://yangchnet.github.io/Dessert/posts/golang/%E9%9D%A2%E8%AF%95%E9%A2%98/","summary":"ä¸‰ä¸ªgoroutineåˆ†åˆ«è¾“å‡ºå¼ ä¸‰ã€æå››ã€ç‹äº”ï¼Œä½¿å…¶æŒ‰ä¸Šè¿°é¡ºåºè¾“å‡º5éã€‚ package main import ( \u0026#34;fmt\u0026#34; \u0026#34;sync\u0026#34; ) var w sync.WaitGroup func main() { w.Add(15) chan1 := make(chan struct{}, 0) chan2 := make(chan struct{}, 0) for i := 0; i \u0026lt; 5; i++ { go func() { defer w.Done() fmt.Println(\u0026#34;å¼ ä¸‰\u0026#34;) chan1 \u0026lt;- struct{}{} }() go func() { defer w.Done() \u0026lt;- chan1 fmt.Println(\u0026#34;æå››\u0026#34;) chan2 \u0026lt;- struct{}{} }() go func() { defer w.Done() \u0026lt;- chan2 fmt.Println(\u0026#34;ç‹äº”\u0026#34;) }() } w.Wait() } ç¼–å†™ç¨‹åºè¾“å‡ºæŸç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼ˆåŒ…æ‹¬å­ç›®å½•ï¼‰ package main import ( \u0026#34;fmt\u0026#34; \u0026#34;io/ioutil\u0026#34; \u0026#34;os\u0026#34; ) func main() { dir := os.","title":"é¢è¯•é¢˜golang"},{"content":" è½¬è½½è‡ªï¼šhttps://segmentfault.com/a/1190000011365430\n 1. WSGIä»‹ç» 1.1 ä»€ä¹ˆæ˜¯WSGI é¦–å…ˆä»‹ç»å‡ ä¸ªå…³äºWSGIç›¸å…³çš„æ¦‚å¿µ WSGIï¼šå…¨ç§°æ˜¯Web Server Gateway Interfaceï¼ŒWSGIä¸æ˜¯æœåŠ¡å™¨ï¼Œpython æ¨¡å—ï¼Œæ¡†æ¶ï¼ŒAPIæˆ–è€…ä»»ä½•è½¯ä»¶ï¼Œåªæ˜¯ä¸€ç§è§„èŒƒï¼Œæè¿°web serverå¦‚ä½•ä¸web applicationé€šä¿¡çš„è§„èŒƒã€‚serverå’Œapplicationçš„è§„èŒƒåœ¨PEP 3333ä¸­æœ‰å…·ä½“æè¿°ã€‚è¦å®ç°WSGIåè®®ï¼Œå¿…é¡»åŒæ—¶å®ç°web serverå’Œweb applicationï¼Œå½“å‰è¿è¡Œåœ¨WSGIåè®®ä¹‹ä¸Šçš„webæ¡†æ¶æœ‰Torando,Flask,Django\nuwsgi:ä¸WSGIä¸€æ ·æ˜¯ä¸€ç§é€šä¿¡åè®®ï¼Œæ˜¯uWSGIæœåŠ¡å™¨çš„ç‹¬å åè®®ï¼Œç”¨äºå®šä¹‰ä¼ è¾“ä¿¡æ¯çš„ç±»å‹(type of information)ï¼Œæ¯ä¸€ä¸ªuwsgi packetå‰4byteä¸ºä¼ è¾“ä¿¡æ¯ç±»å‹çš„æè¿°ï¼Œä¸WSGIåè®®æ˜¯ä¸¤ç§ä¸œè¥¿ï¼Œæ®è¯´è¯¥åè®®æ˜¯fcgiåè®®çš„10å€å¿«ã€‚\nuWSGIï¼šæ˜¯ä¸€ä¸ªwebæœåŠ¡å™¨ï¼Œå®ç°äº†WSGIåè®®ã€uwsgiåè®®ã€httpåè®®ç­‰ã€‚\nWSGIåè®®ä¸»è¦åŒ…æ‹¬serverå’Œapplicationä¸¤éƒ¨åˆ†ï¼š\n WSGI serverè´Ÿè´£ä»å®¢æˆ·ç«¯æ¥æ”¶è¯·æ±‚ï¼Œå°†requestè½¬å‘ç»™applicationï¼Œå°†applicationè¿”å›çš„responseè¿”å›ç»™å®¢æˆ·ç«¯ï¼› WSGI applicationæ¥æ”¶ç”±serverè½¬å‘çš„requestï¼Œå¤„ç†è¯·æ±‚ï¼Œå¹¶å°†å¤„ç†ç»“æœè¿”å›ç»™serverã€‚applicationä¸­å¯ä»¥åŒ…æ‹¬å¤šä¸ªæ ˆå¼çš„ä¸­é—´ä»¶(middlewares)ï¼Œè¿™äº›ä¸­é—´ä»¶éœ€è¦åŒæ—¶å®ç°serverä¸applicationï¼Œå› æ­¤å¯ä»¥åœ¨WSGIæœåŠ¡å™¨ä¸WSGIåº”ç”¨ä¹‹é—´èµ·è°ƒèŠ‚ä½œç”¨ï¼šå¯¹æœåŠ¡å™¨æ¥è¯´ï¼Œä¸­é—´ä»¶æ‰®æ¼”åº”ç”¨ç¨‹åºï¼Œå¯¹åº”ç”¨ç¨‹åºæ¥è¯´ï¼Œä¸­é—´ä»¶æ‰®æ¼”æœåŠ¡å™¨ã€‚\n WSGIåè®®å…¶å®æ˜¯å®šä¹‰äº†ä¸€ç§serverä¸applicationè§£è€¦çš„è§„èŒƒï¼Œå³å¯ä»¥æœ‰å¤šä¸ªå®ç°WSGI serverçš„æœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥æœ‰å¤šä¸ªå®ç°WSGI applicationçš„æ¡†æ¶ï¼Œé‚£ä¹ˆå°±å¯ä»¥é€‰æ‹©ä»»æ„çš„serverå’Œapplicatiodnç»„åˆå®ç°è‡ªå·±çš„webåº”ç”¨ã€‚ä¾‹å¦‚uWSGIå’ŒGunicornéƒ½æ˜¯å®ç°äº†WSGI serveråè®®çš„æœåŠ¡å™¨ï¼ŒDjangoï¼ŒFlaskæ˜¯å®ç°äº†WSGI applicationåè®®çš„webæ¡†æ¶ï¼Œå¯ä»¥æ ¹æ®é¡¹ç›®å®é™…æƒ…å†µæ­é…ä½¿ç”¨ã€‚\nä»¥ä¸Šä»‹ç»äº†ç›¸å…³çš„å¸¸è¯†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•ç®€å•å®ç°WSGIåè®®ã€‚\n1.2 æ€ä¹ˆå®ç°WSGI ä¸Šæ–‡è¯´è¿‡ï¼Œå®ç°WSGIåè®®å¿…é¡»è¦æœ‰wsgi serverå’Œapplicationï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å°±æ¥å®ç°è¿™ä¸¤ä¸ªä¸œè¥¿ã€‚\næˆ‘ä»¬æ¥çœ‹çœ‹å®˜æ–¹WSGIä½¿ç”¨WSGIçš„wsgirefæ¨¡å—å®ç°çš„å°demo\ndef demo_app(environ,start_response): from StringIO import StringIO stdout = StringIO() print \u0026gt;\u0026gt;stdout, \u0026#34;Hello world!\u0026#34; print \u0026gt;\u0026gt;stdout h = environ.items(); h.sort() for k,v in h: print \u0026gt;\u0026gt;stdout, k,\u0026#39;=\u0026#39;, repr(v) start_response(\u0026#34;200 OK\u0026#34;, [(\u0026#39;Content-Type\u0026#39;,\u0026#39;text/plain\u0026#39;)]) return [stdout.getvalue()] httpd = make_server(\u0026#39;localhost\u0026#39;, 8002, demo_app) httpd.serve_forever() # ä½¿ç”¨select  å®ç°äº†ä¸€ä¸ªapplicationï¼Œæ¥è·å–å®¢æˆ·ç«¯çš„ç¯å¢ƒå’Œå›è°ƒå‡½æ•°ä¸¤ä¸ªå‚æ•°ï¼Œä»¥åŠhttpdæœåŠ¡ç«¯çš„å®ç°ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹make_serverçš„æºä»£ç \ndef make_server( host, port, app, server_class=WSGIServer, handler_class=WSGIRequestHandler): \u0026#34;\u0026#34;\u0026#34;Create a new WSGI server listening on `host` and `port` for `app`\u0026#34;\u0026#34;\u0026#34; server = server_class((host, port), handler_class) server.set_app(app) return server ä¸‹é¢æˆ‘ä»¬è‡ªå·±æ¥å®ç°ä¸€éï¼š WSGI è§„å®šæ¯ä¸ª python ç¨‹åºï¼ˆApplicationï¼‰å¿…é¡»æ˜¯ä¸€ä¸ªå¯è°ƒç”¨çš„å¯¹è±¡ï¼ˆå®ç°äº†__call__ å‡½æ•°çš„æ–¹æ³•æˆ–è€…ç±»ï¼‰ï¼Œæ¥å—ä¸¤ä¸ªå‚æ•° environï¼ˆWSGI çš„ç¯å¢ƒä¿¡æ¯ï¼‰ å’Œ start_responseï¼ˆå¼€å§‹å“åº”è¯·æ±‚çš„å‡½æ•°ï¼‰ï¼Œå¹¶ä¸”è¿”å› iterableã€‚å‡ ç‚¹è¯´æ˜ï¼š\nenviron å’Œ start_response ç”± http server æä¾›å¹¶å®ç° environ å˜é‡æ˜¯åŒ…å«äº†ç¯å¢ƒä¿¡æ¯çš„å­—å…¸ Application å†…éƒ¨åœ¨è¿”å›å‰è°ƒç”¨ start_response start_responseä¹Ÿæ˜¯ä¸€ä¸ª callableï¼Œæ¥å—ä¸¤ä¸ªå¿…é¡»çš„å‚æ•°ï¼Œstatusï¼ˆHTTPçŠ¶æ€ï¼‰å’Œ response_headersï¼ˆå“åº”æ¶ˆæ¯çš„å¤´ï¼‰ å¯è°ƒç”¨å¯¹è±¡è¦è¿”å›ä¸€ä¸ªå€¼ï¼Œè¿™ä¸ªå€¼æ˜¯å¯è¿­ä»£çš„ã€‚  application\n # 1. å¯è°ƒç”¨å¯¹è±¡æ˜¯ä¸€ä¸ªå‡½æ•° def application(environ, start_response): response_body = \u0026#39;The request method was %s\u0026#39; % environ[\u0026#39;REQUEST_METHOD\u0026#39;] # HTTP response code and message status = \u0026#39;200 OK\u0026#39; # åº”ç­”çš„å¤´éƒ¨æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œæ¯å¯¹é”®å€¼éƒ½å¿…é¡»æ˜¯ä¸€ä¸ª tupleã€‚ response_headers = [(\u0026#39;Content-Type\u0026#39;, \u0026#39;text/plain\u0026#39;), (\u0026#39;Content-Length\u0026#39;, str(len(response_body)))] # è°ƒç”¨æœåŠ¡å™¨ç¨‹åºæä¾›çš„ start_responseï¼Œå¡«å…¥ä¸¤ä¸ªå‚æ•° start_response(status, response_headers) # è¿”å›å¿…é¡»æ˜¯ iterable return [response_body] # 2. å¯è°ƒç”¨å¯¹è±¡æ˜¯ä¸€ä¸ªç±» class AppClass: \u0026#34;\u0026#34;\u0026#34;è¿™é‡Œçš„å¯è°ƒç”¨å¯¹è±¡å°±æ˜¯ AppClass è¿™ä¸ªç±»ï¼Œè°ƒç”¨å®ƒå°±èƒ½ç”Ÿæˆå¯ä»¥è¿­ä»£çš„ç»“æœã€‚ ä½¿ç”¨æ–¹æ³•ç±»ä¼¼äºï¼š for result in AppClass(env, start_response): do_somthing(result) \u0026#34;\u0026#34;\u0026#34; def __init__(self, environ, start_response): self.environ = environ self.start = start_response def __iter__(self): status = \u0026#39;200 OK\u0026#39; response_headers = [(\u0026#39;Content-type\u0026#39;, \u0026#39;text/plain\u0026#39;)] self.start(status, response_headers) yield \u0026#34;Hello world!\\n\u0026#34; # 3. å¯è°ƒç”¨å¯¹è±¡æ˜¯ä¸€ä¸ªå®ä¾‹  class AppClass: \u0026#34;\u0026#34;\u0026#34;è¿™é‡Œçš„å¯è°ƒç”¨å¯¹è±¡å°±æ˜¯ AppClass çš„å®ä¾‹ï¼Œä½¿ç”¨æ–¹æ³•ç±»ä¼¼äºï¼š app = AppClass() for result in app(environ, start_response): do_somthing(result) \u0026#34;\u0026#34;\u0026#34; def __init__(self): pass def __call__(self, environ, start_response): status = \u0026#39;200 OK\u0026#39; response_headers = [(\u0026#39;Content-type\u0026#39;, \u0026#39;text/plain\u0026#39;)] self.start(status, response_headers) yield \u0026#34;Hello world!\\n\u0026#34;  server\n ä¸Šé¢å·²ç»è¯´è¿‡ï¼Œæ ‡å‡†è¦èƒ½å¤Ÿç¡®åˆ‡åœ°å®è¡Œï¼Œå¿…é¡»è¦æ±‚ç¨‹åºç«¯å’ŒæœåŠ¡å™¨ç«¯å…±åŒéµå®ˆã€‚ä¸Šé¢æåˆ°ï¼Œ envrion å’Œ start_response éƒ½æ˜¯æœåŠ¡å™¨ç«¯æä¾›çš„ã€‚ä¸‹é¢å°±çœ‹çœ‹ï¼ŒæœåŠ¡å™¨ç«¯è¦å±¥è¡Œçš„ä¹‰åŠ¡ã€‚\nå‡†å¤‡ environ å‚æ•° å®šä¹‰ start_response å‡½æ•° è°ƒç”¨ç¨‹åºç«¯çš„å¯è°ƒç”¨å¯¹è±¡ import os, sys def run_with_cgi(application): # application æ˜¯ç¨‹åºç«¯çš„å¯è°ƒç”¨å¯¹è±¡ # å‡†å¤‡ environ å‚æ•°ï¼Œè¿™æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œé‡Œé¢çš„å†…å®¹æ˜¯ä¸€æ¬¡ HTTP è¯·æ±‚çš„ç¯å¢ƒå˜é‡ environ = dict(os.environ.items()) environ[\u0026#39;wsgi.input\u0026#39;] = sys.stdin environ[\u0026#39;wsgi.errors\u0026#39;] = sys.stderr environ[\u0026#39;wsgi.version\u0026#39;] = (1, 0) environ[\u0026#39;wsgi.multithread\u0026#39;] = False environ[\u0026#39;wsgi.multiprocess\u0026#39;] = True environ[\u0026#39;wsgi.run_once\u0026#39;] = True environ[\u0026#39;wsgi.url_scheme\u0026#39;] = \u0026#39;http\u0026#39; headers_set = [] headers_sent = [] # æŠŠåº”ç­”çš„ç»“æœè¾“å‡ºåˆ°ç»ˆç«¯ def write(data): sys.stdout.write(data) sys.stdout.flush() # å®ç° start_response å‡½æ•°ï¼Œæ ¹æ®ç¨‹åºç«¯ä¼ è¿‡æ¥çš„ status å’Œ response_headers å‚æ•°ï¼Œ # è®¾ç½®çŠ¶æ€å’Œå¤´éƒ¨ def start_response(status, response_headers, exc_info=None): headers_set[:] = [status, response_headers] return write # è°ƒç”¨å®¢æˆ·ç«¯çš„å¯è°ƒç”¨å¯¹è±¡ï¼ŒæŠŠå‡†å¤‡å¥½çš„å‚æ•°ä¼ é€’è¿‡å» result = application(environ, start_response) # å¤„ç†å¾—åˆ°çš„ç»“æœï¼Œè¿™é‡Œç®€å•åœ°æŠŠç»“æœè¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºã€‚ try: for data in result: if data: # don\u0026#39;t send headers until body appears write(data) finally: if hasattr(result, \u0026#39;close\u0026#39;): result.close() 2. ç”±Djangoæ¡†æ¶åˆ†æWSGI ä¸‹é¢æˆ‘ä»¬ä»¥djangoä¸ºä¾‹ï¼Œåˆ†æä¸€ä¸‹wsgiçš„æ•´ä¸ªæµç¨‹\n2.1 django WSGI application WSGI applicationåº”è¯¥å®ç°ä¸ºä¸€ä¸ªå¯è°ƒç”¨iterå¯¹è±¡ï¼Œä¾‹å¦‚å‡½æ•°ã€æ–¹æ³•ã€ç±»(åŒ…å«callæ–¹æ³•)ã€‚éœ€è¦æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼šä¸€ä¸ªå­—å…¸ï¼Œè¯¥å­—å…¸å¯ä»¥åŒ…å«äº†å®¢æˆ·ç«¯è¯·æ±‚çš„ä¿¡æ¯ä»¥åŠå…¶ä»–ä¿¡æ¯ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯è¯·æ±‚ä¸Šä¸‹æ–‡ï¼Œä¸€èˆ¬å«åšenvironmentï¼ˆç¼–ç ä¸­å¤šç®€å†™ä¸ºenvironã€envï¼‰ï¼Œä¸€ä¸ªç”¨äºå‘é€HTTPå“åº”çŠ¶æ€ï¼ˆHTTP statusï¼‰ã€å“åº”å¤´ï¼ˆHTTP headersï¼‰çš„å›è°ƒå‡½æ•°,ä¹Ÿå°±æ˜¯start_response()ã€‚é€šè¿‡å›è°ƒå‡½æ•°å°†å“åº”çŠ¶æ€å’Œå“åº”å¤´è¿”å›ç»™serverï¼ŒåŒæ—¶è¿”å›å“åº”æ­£æ–‡(response body)ï¼Œå“åº”æ­£æ–‡æ˜¯å¯è¿­ä»£çš„ã€å¹¶åŒ…å«äº†å¤šä¸ªå­—ç¬¦ä¸²ã€‚ ä¸‹é¢æ˜¯Djangoä¸­applicationçš„å…·ä½“å®ç°éƒ¨åˆ†ï¼š\n# ç»§æ‰¿, ä½†åªå®ç°äº† __call__ æ–¹æ³•, æ–¹ä¾¿ä½¿ç”¨ class WSGIHandler(base.BaseHandler): initLock = Lock() # å¯ä»¥å°†å…¶è§†ä¸ºä¸€ä¸ªä»£è¡¨ http è¯·æ±‚çš„ç±» request_class = WSGIRequest # WSGIHandler ä¹Ÿå¯ä»¥ä½œä¸ºå‡½æ•°æ¥è°ƒç”¨ def __call__(self, environ, start_response): # Set up middleware if needed. We couldn\u0026#39;t do this earlier, because # settings weren\u0026#39;t available. # è¿™é‡Œçš„æ£€æµ‹: å› ä¸º self._request_middleware æ˜¯æœ€åæ‰è®¾å®šçš„, æ‰€ä»¥å¦‚æœä¸ºç©º, # å¾ˆå¯èƒ½æ˜¯å› ä¸º self.load_middleware() æ²¡æœ‰è°ƒç”¨æˆåŠŸ. if self._request_middleware is None: with self.initLock: try: # Check that middleware is still uninitialised. if self._request_middleware is None: å› ä¸º load_middleware() å¯èƒ½æ²¡æœ‰è°ƒç”¨, è°ƒç”¨ä¸€æ¬¡. self.load_middleware() except: # Unload whatever middleware we got self._request_middleware = None raise set_script_prefix(base.get_script_name(environ)) signls.request_started.send(sender=self.__class__) # __class__ ä»£è¡¨è‡ªå·±çš„ç±» try: # å®ä¾‹åŒ– request_class = WSGIRequest, å°†åœ¨æ—¥åæ–‡ç« ä¸­å±•å¼€, å¯ä»¥å°†å…¶è§†ä¸ºä¸€ä¸ªä»£è¡¨ http è¯·æ±‚çš„ç±» request = self.request_class(environ) except UnicodeDecodeError: logger.warning(\u0026#39;Bad Request (UnicodeDecodeError)\u0026#39;, exc_info=sys.exc_info(), extra={ \u0026#39;status_code\u0026#39;: 400, } ) response = http.HttpResponseBadRequest() else: # è°ƒç”¨ self.get_response(), å°†ä¼šè¿”å›ä¸€ä¸ªç›¸åº”å¯¹è±¡ response\u0026lt;br\u0026gt; ############# å…³é”®çš„æ“ä½œ, self.response() å¯ä»¥è·å–å“åº”æ•°æ®.  response = self.get_response(request) # å°† self æŒ‚é’©åˆ° response å¯¹è±¡ response._handler_class = self.__class__ try: status_text = STATUS_CODE_TEXT[response.status_code] except KeyError: status_text = \u0026#39;UNKNOWN STATUS CODE\u0026#39; # çŠ¶æ€ç  status = \u0026#39;%s%s\u0026#39; % (response.status_code, status_text) response_headers = [(str(k), str(v)) for k, v in response.items()] # å¯¹äºæ¯ä¸ªä¸€ä¸ª cookie, éƒ½åœ¨ header ä¸­è®¾ç½®: Set-cookie xxx=yyy for c in response.cookies.values(): response_headers.append((str(\u0026#39;Set-Cookie\u0026#39;), str(c.output(header=\u0026#39;\u0026#39;)))) # start_response() æ“ä½œå·²ç»åœ¨ä¸ŠèŠ‚ä¸­ä»‹ç»äº† start_response(force_str(status), response_headers) # æˆåŠŸè¿”å›ç›¸åº”å¯¹è±¡ return response å¯ä»¥çœ‹å‡ºapplicationçš„æµç¨‹åŒ…æ‹¬:åŠ è½½æ‰€æœ‰ä¸­é—´ä»¶ï¼Œä»¥åŠæ‰§è¡Œæ¡†æ¶ç›¸å…³çš„æ“ä½œï¼Œè®¾ç½®å½“å‰çº¿ç¨‹è„šæœ¬å‰ç¼€ï¼Œå‘é€è¯·æ±‚å¼€å§‹ä¿¡å·ï¼›å¤„ç†è¯·æ±‚ï¼Œè°ƒç”¨get_response()æ–¹æ³•å¤„ç†å½“å‰è¯·æ±‚ï¼Œè¯¥æ–¹æ³•çš„çš„ä¸»è¦é€»è¾‘æ˜¯é€šè¿‡urlconfæ‰¾åˆ°å¯¹åº”çš„viewå’Œcallbackï¼ŒæŒ‰é¡ºåºæ‰§è¡Œå„ç§middlewareå’Œcallbackã€‚è°ƒç”¨ç”±serverä¼ å…¥çš„start_response()æ–¹æ³•å°†å“åº”headerä¸statusè¿”å›ç»™serverã€‚è¿”å›å“åº”æ­£æ–‡\n2.2 django WSGI Server è´Ÿè´£è·å–httpè¯·æ±‚ï¼Œå°†è¯·æ±‚ä¼ é€’ç»™WSGI applicationï¼Œç”±applicationå¤„ç†è¯·æ±‚åè¿”å›responseã€‚ä»¥Djangoå†…å»ºserverä¸ºä¾‹çœ‹ä¸€ä¸‹å…·ä½“å®ç°ã€‚é€šè¿‡runserverè¿è¡Œdjango é¡¹ç›®ï¼Œåœ¨å¯åŠ¨æ—¶éƒ½ä¼šè°ƒç”¨ä¸‹é¢çš„runæ–¹æ³•ï¼Œåˆ›å»ºä¸€ä¸ªWSGIServerçš„å®ä¾‹ï¼Œä¹‹åå†è°ƒç”¨å…¶serve_forever()æ–¹æ³•å¯åŠ¨æœåŠ¡ã€‚\ndef run(addr, port, wsgi_handler, ipv6=False, threading=False): server_address = (addr, port) if threading: httpd_cls = type(str(\u0026#39;WSGIServer\u0026#39;), (socketserver.ThreadingMixIn, WSGIServer), {}) else: httpd_cls = WSGIServer # è¿™é‡Œçš„wsgi_handlerå°±æ˜¯WSGIApplication  httpd = httpd_cls(server_address, WSGIRequestHandler, ipv6=ipv6) if threading: httpd.daemon_threads = True httpd.set_app(wsgi_handler) httpd.serve_forever() ä¸‹é¢è¡¨ç¤ºWSGI serveræœåŠ¡å™¨å¤„ç†æµç¨‹ä¸­å…³é”®çš„ç±»å’Œæ–¹æ³•ã€‚\n**WSGIServerrun()**æ–¹æ³•ä¼šåˆ›å»ºWSGIServerå®ä¾‹ï¼Œä¸»è¦ä½œç”¨æ˜¯æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚ï¼Œå°†è¯·æ±‚ä¼ é€’ç»™applicationï¼Œç„¶åå°†applicationè¿”å›çš„responseè¿”å›ç»™å®¢æˆ·ç«¯ã€‚ åˆ›å»ºå®ä¾‹æ—¶ä¼šæŒ‡å®šHTTPè¯·æ±‚çš„handlerï¼šWSGIRequestHandlerç±» é€šè¿‡set_appå’Œget_appæ–¹æ³•è®¾ç½®å’Œè·å–WSGIApplicationå®ä¾‹wsgi_handler å¤„ç†httpè¯·æ±‚æ—¶ï¼Œè°ƒç”¨handler_requestæ–¹æ³•ï¼Œä¼šåˆ›å»ºWSGIRequestHandler å®ä¾‹å¤„ç†httpè¯·æ±‚ã€‚ WSGIServerä¸­get_requestæ–¹æ³•é€šè¿‡socketæ¥å—è¯·æ±‚æ•°æ®\nWSGIRequestHandler ç”±WSGIServeråœ¨è°ƒç”¨handle_requestæ—¶åˆ›å»ºå®ä¾‹ï¼Œä¼ å…¥requestã€cient_addressã€WSGIServerä¸‰ä¸ªå‚æ•°ï¼Œ__init__æ–¹æ³•åœ¨å®ä¾‹åŒ–åŒæ—¶è¿˜ä¼šè°ƒç”¨è‡ªèº«çš„handleæ–¹æ³•handleæ–¹æ³•ä¼šåˆ›å»ºServerHandlerå®ä¾‹ï¼Œç„¶åè°ƒç”¨å…¶runæ–¹æ³•å¤„ç†è¯·æ±‚\nServerHandler WSGIRequestHandleråœ¨å…¶handleæ–¹æ³•ä¸­è°ƒç”¨runæ–¹æ³•ï¼Œä¼ å…¥self.server.get_app()å‚æ•°ï¼Œè·å–WSGIApplicationï¼Œç„¶åè°ƒç”¨å®ä¾‹(call)ï¼Œè·å–responseï¼Œå…¶ä¸­ä¼šä¼ å…¥start_responseå›è°ƒï¼Œç”¨æ¥å¤„ç†è¿”å›çš„headerå’Œstatusã€‚é€šè¿‡applicationè·å–responseä»¥åï¼Œé€šè¿‡finish_responseè¿”å›response\nWSGIHandler WSGIåè®®ä¸­çš„applicationï¼Œæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œenvironå­—å…¸åŒ…å«äº†å®¢æˆ·ç«¯è¯·æ±‚çš„ä¿¡æ¯ä»¥åŠå…¶ä»–ä¿¡æ¯ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯è¯·æ±‚ä¸Šä¸‹æ–‡ï¼Œstart_responseç”¨äºå‘é€è¿”å›statuså’Œheaderçš„å›è°ƒå‡½æ•°\nè™½ç„¶ä¸Šé¢ä¸€ä¸ªWSGI serveræ¶‰åŠåˆ°å¤šä¸ªç±»å®ç°ä»¥åŠç›¸äº’å¼•ç”¨ï¼Œä½†å…¶å®åŸç†è¿˜æ˜¯è°ƒç”¨WSGIHandlerï¼Œä¼ å…¥è¯·æ±‚å‚æ•°ä»¥åŠå›è°ƒæ–¹æ³•start_response()ï¼Œå¹¶å°†å“åº”è¿”å›ç»™å®¢æˆ·ç«¯\n","permalink":"http://yangchnet.github.io/Dessert/posts/django/wsgi/","summary":"è½¬è½½è‡ªï¼šhttps://segmentfault.com/a/1190000011365430\n 1. WSGIä»‹ç» 1.1 ä»€ä¹ˆæ˜¯WSGI é¦–å…ˆä»‹ç»å‡ ä¸ªå…³äºWSGIç›¸å…³çš„æ¦‚å¿µ WSGIï¼šå…¨ç§°æ˜¯Web Server Gateway Interfaceï¼ŒWSGIä¸æ˜¯æœåŠ¡å™¨ï¼Œpython æ¨¡å—ï¼Œæ¡†æ¶ï¼ŒAPIæˆ–è€…ä»»ä½•è½¯ä»¶ï¼Œåªæ˜¯ä¸€ç§è§„èŒƒï¼Œæè¿°web serverå¦‚ä½•ä¸web applicationé€šä¿¡çš„è§„èŒƒã€‚serverå’Œapplicationçš„è§„èŒƒåœ¨PEP 3333ä¸­æœ‰å…·ä½“æè¿°ã€‚è¦å®ç°WSGIåè®®ï¼Œå¿…é¡»åŒæ—¶å®ç°web serverå’Œweb applicationï¼Œå½“å‰è¿è¡Œåœ¨WSGIåè®®ä¹‹ä¸Šçš„webæ¡†æ¶æœ‰Torando,Flask,Django\nuwsgi:ä¸WSGIä¸€æ ·æ˜¯ä¸€ç§é€šä¿¡åè®®ï¼Œæ˜¯uWSGIæœåŠ¡å™¨çš„ç‹¬å åè®®ï¼Œç”¨äºå®šä¹‰ä¼ è¾“ä¿¡æ¯çš„ç±»å‹(type of information)ï¼Œæ¯ä¸€ä¸ªuwsgi packetå‰4byteä¸ºä¼ è¾“ä¿¡æ¯ç±»å‹çš„æè¿°ï¼Œä¸WSGIåè®®æ˜¯ä¸¤ç§ä¸œè¥¿ï¼Œæ®è¯´è¯¥åè®®æ˜¯fcgiåè®®çš„10å€å¿«ã€‚\nuWSGIï¼šæ˜¯ä¸€ä¸ªwebæœåŠ¡å™¨ï¼Œå®ç°äº†WSGIåè®®ã€uwsgiåè®®ã€httpåè®®ç­‰ã€‚\nWSGIåè®®ä¸»è¦åŒ…æ‹¬serverå’Œapplicationä¸¤éƒ¨åˆ†ï¼š\n WSGI serverè´Ÿè´£ä»å®¢æˆ·ç«¯æ¥æ”¶è¯·æ±‚ï¼Œå°†requestè½¬å‘ç»™applicationï¼Œå°†applicationè¿”å›çš„responseè¿”å›ç»™å®¢æˆ·ç«¯ï¼› WSGI applicationæ¥æ”¶ç”±serverè½¬å‘çš„requestï¼Œå¤„ç†è¯·æ±‚ï¼Œå¹¶å°†å¤„ç†ç»“æœè¿”å›ç»™serverã€‚applicationä¸­å¯ä»¥åŒ…æ‹¬å¤šä¸ªæ ˆå¼çš„ä¸­é—´ä»¶(middlewares)ï¼Œè¿™äº›ä¸­é—´ä»¶éœ€è¦åŒæ—¶å®ç°serverä¸applicationï¼Œå› æ­¤å¯ä»¥åœ¨WSGIæœåŠ¡å™¨ä¸WSGIåº”ç”¨ä¹‹é—´èµ·è°ƒèŠ‚ä½œç”¨ï¼šå¯¹æœåŠ¡å™¨æ¥è¯´ï¼Œä¸­é—´ä»¶æ‰®æ¼”åº”ç”¨ç¨‹åºï¼Œå¯¹åº”ç”¨ç¨‹åºæ¥è¯´ï¼Œä¸­é—´ä»¶æ‰®æ¼”æœåŠ¡å™¨ã€‚\n WSGIåè®®å…¶å®æ˜¯å®šä¹‰äº†ä¸€ç§serverä¸applicationè§£è€¦çš„è§„èŒƒï¼Œå³å¯ä»¥æœ‰å¤šä¸ªå®ç°WSGI serverçš„æœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥æœ‰å¤šä¸ªå®ç°WSGI applicationçš„æ¡†æ¶ï¼Œé‚£ä¹ˆå°±å¯ä»¥é€‰æ‹©ä»»æ„çš„serverå’Œapplicatiodnç»„åˆå®ç°è‡ªå·±çš„webåº”ç”¨ã€‚ä¾‹å¦‚uWSGIå’ŒGunicornéƒ½æ˜¯å®ç°äº†WSGI serveråè®®çš„æœåŠ¡å™¨ï¼ŒDjangoï¼ŒFlaskæ˜¯å®ç°äº†WSGI applicationåè®®çš„webæ¡†æ¶ï¼Œå¯ä»¥æ ¹æ®é¡¹ç›®å®é™…æƒ…å†µæ­é…ä½¿ç”¨ã€‚\nä»¥ä¸Šä»‹ç»äº†ç›¸å…³çš„å¸¸è¯†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•ç®€å•å®ç°WSGIåè®®ã€‚\n1.2 æ€ä¹ˆå®ç°WSGI ä¸Šæ–‡è¯´è¿‡ï¼Œå®ç°WSGIåè®®å¿…é¡»è¦æœ‰wsgi serverå’Œapplicationï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å°±æ¥å®ç°è¿™ä¸¤ä¸ªä¸œè¥¿ã€‚\næˆ‘ä»¬æ¥çœ‹çœ‹å®˜æ–¹WSGIä½¿ç”¨WSGIçš„wsgirefæ¨¡å—å®ç°çš„å°demo\ndef demo_app(environ,start_response): from StringIO import StringIO stdout = StringIO() print \u0026gt;\u0026gt;stdout, \u0026#34;Hello world!\u0026#34; print \u0026gt;\u0026gt;stdout h = environ.items(); h.sort() for k,v in h: print \u0026gt;\u0026gt;stdout, k,\u0026#39;=\u0026#39;, repr(v) start_response(\u0026#34;200 OK\u0026#34;, [(\u0026#39;Content-Type\u0026#39;,\u0026#39;text/plain\u0026#39;)]) return [stdout.","title":"wsgi"},{"content":"1. ORMæ˜¯ä»€ä¹ˆ é¢å‘å¯¹è±¡ç¼–ç¨‹æŠŠæ‰€æœ‰å®ä½“çœ‹æˆå¯¹è±¡ï¼ˆobjectï¼‰ï¼Œå…³ç³»å‹æ•°æ®åº“åˆ™æ˜¯é‡‡ç”¨å®ä½“ä¹‹é—´çš„å…³ç³»ï¼ˆrelationï¼‰è¿æ¥æ•°æ®ã€‚å¾ˆæ—©å°±æœ‰äººæå‡ºï¼Œå…³ç³»ä¹Ÿå¯ä»¥ç”¨å¯¹è±¡è¡¨è¾¾ï¼Œè¿™æ ·çš„è¯ï¼Œå°±èƒ½ä½¿ç”¨é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œæ¥æ“ä½œå…³ç³»å‹æ•°æ®åº“ã€‚ ç®€å•çš„è¯´ï¼ŒORM å°±æ˜¯é€šè¿‡å®ä¾‹å¯¹è±¡çš„è¯­æ³•ï¼Œå®Œæˆå…³ç³»å‹æ•°æ®åº“çš„æ“ä½œçš„æŠ€æœ¯ï¼Œæ˜¯\u0026quot;å¯¹è±¡-å…³ç³»æ˜ å°„\u0026quot;ï¼ˆObject/Relational Mappingï¼‰ çš„ç¼©å†™ã€‚\nORMæŠŠæ•°æ®åº“æ˜ å°„ä¸ºå¯¹è±¡\n æ•°æ®åº“çš„è¡¨ï¼ˆtableï¼‰ \u0026ndash;\u0026gt; ç±»ï¼ˆclassï¼‰ è®°å½•ï¼ˆrecordï¼Œè¡Œæ•°æ®ï¼‰\u0026ndash;\u0026gt; å¯¹è±¡ï¼ˆobjectï¼‰ å­—æ®µï¼ˆfieldï¼‰\u0026ndash;\u0026gt; å¯¹è±¡çš„å±æ€§ï¼ˆattributeï¼‰\n ä¸¾ä¾‹æ¥è¯´ï¼Œä¸‹é¢æ˜¯ä¸€è¡ŒSQLè¯­å¥\nSELECT id, first_name, last_name, phone, birth_date, sex FROM persons WHERE id = 10 ç¨‹åºç›´æ¥è¿è¡ŒSQLï¼Œæ“ä½œæ•°æ®åº“çš„å†™æ³•å¦‚ä¸‹ï¼š\nres = db.execSql(sql) name = res[0][\u0026#34;FIRST_NAME\u0026#34;] æ”¹æˆORMçš„å†™æ³•å¦‚ä¸‹ï¼š\np = Person.get(10) name = p.first_name ä¸€æ¯”è¾ƒå°±å¯ä»¥å‘ç°ï¼ŒORM ä½¿ç”¨å¯¹è±¡ï¼Œå°è£…äº†æ•°æ®åº“æ“ä½œï¼Œå› æ­¤å¯ä»¥ä¸ç¢° SQL è¯­è¨€ã€‚å¼€å‘è€…åªä½¿ç”¨é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œä¸æ•°æ®å¯¹è±¡ç›´æ¥äº¤äº’ï¼Œä¸ç”¨å…³å¿ƒåº•å±‚æ•°æ®åº“ã€‚\næ€»ç»“èµ·æ¥ï¼ŒORMæœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š\n æ•°æ®æ¨¡å‹éƒ½åœ¨ä¸€ä¸ªåœ°æ–¹å®šä¹‰ï¼Œæ›´å®¹æ˜“æ›´æ–°å’Œç»´æŠ¤ï¼Œä¹Ÿåˆ©äºé‡ç”¨ä»£ç ã€‚ ORM æœ‰ç°æˆçš„å·¥å…·ï¼Œå¾ˆå¤šåŠŸèƒ½éƒ½å¯ä»¥è‡ªåŠ¨å®Œæˆï¼Œæ¯”å¦‚æ•°æ®æ¶ˆæ¯’ã€é¢„å¤„ç†ã€äº‹åŠ¡ç­‰ç­‰ã€‚ å®ƒè¿«ä½¿ä½ ä½¿ç”¨ MVC æ¶æ„ï¼ŒORM å°±æ˜¯å¤©ç„¶çš„ Modelï¼Œæœ€ç»ˆä½¿ä»£ç æ›´æ¸…æ™°ã€‚ åŸºäº ORM çš„ä¸šåŠ¡ä»£ç æ¯”è¾ƒç®€å•ï¼Œä»£ç é‡å°‘ï¼Œè¯­ä¹‰æ€§å¥½ï¼Œå®¹æ˜“ç†è§£ã€‚ ä½ ä¸å¿…ç¼–å†™æ€§èƒ½ä¸ä½³çš„ SQLã€‚ ä½†æ˜¯ORMä¹Ÿæœ‰å¾ˆçªå‡ºçš„ç¼ºç‚¹ï¼š ORM åº“ä¸æ˜¯è½»é‡çº§å·¥å…·ï¼Œéœ€è¦èŠ±å¾ˆå¤šç²¾åŠ›å­¦ä¹ å’Œè®¾ç½®ã€‚ å¯¹äºå¤æ‚çš„æŸ¥è¯¢ï¼ŒORM è¦ä¹ˆæ˜¯æ— æ³•è¡¨è¾¾ï¼Œè¦ä¹ˆæ˜¯æ€§èƒ½ä¸å¦‚åŸç”Ÿçš„ SQLã€‚ ORM æŠ½è±¡æ‰äº†æ•°æ®åº“å±‚ï¼Œå¼€å‘è€…æ— æ³•äº†è§£åº•å±‚çš„æ•°æ®åº“æ“ä½œï¼Œä¹Ÿæ— æ³•å®šåˆ¶ä¸€äº›ç‰¹æ®Šçš„ SQLã€‚  2. å®ä¾‹ Djangoæ˜¯ä¸€ä¸ªéå¸¸è‘—åçš„python webæ¡†æ¶ï¼Œå…¶æä¾›äº†ç®€å•æ˜“ç”¨çš„ORMã€‚\nå®‰è£…django\npip install django å®Œæˆå®‰è£…åï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤åˆ›å»ºä¸€ä¸ªæ–°çš„djangoé¡¹ç›®\ndjango-admin startproject newSite å°è¯•è¿è¡Œ\ncd newSite python manage.py runserver è®¿é—®https://127.0.0.1:8000æŸ¥çœ‹æ˜¯å¦è¿è¡ŒæˆåŠŸã€‚\n2.1 Model å®Œæˆäº†é¡¹ç›®çš„åˆ›å»ºåï¼Œä¸‹ä¸€æ­¥æ˜¯è¦å®šä¹‰ä¸€ä¸ªModelï¼Œä¸€èˆ¬æ¥è¯´ï¼Œæ¯ä¸ªModeléƒ½æ˜ å°„ä¸€å¼ æ•°æ®åº“è¡¨ã€‚\n æ¯ä¸ªæ¨¡å‹éƒ½æ˜¯ä¸€ä¸ª Python çš„ç±»ï¼Œè¿™äº›ç±»ç»§æ‰¿ django.db.models.Model æ¨¡å‹ç±»çš„æ¯ä¸ªå±æ€§éƒ½ç›¸å½“äºä¸€ä¸ªæ•°æ®åº“çš„å­—æ®µã€‚ åˆ©ç”¨è¿™äº›ï¼ŒDjango æä¾›äº†ä¸€ä¸ªè‡ªåŠ¨ç”Ÿæˆè®¿é—®æ•°æ®åº“çš„ APIã€‚  ä¸ºdjangoé¡¹ç›®æ·»åŠ ä¸€ä¸ªæ–°çš„app\npython manage.py startapp ormTest åˆ‡æ¢åˆ°ormTestç›®å½•ä¸‹ï¼Œæ·»åŠ å¦‚ä¸‹ä»£ç \n# models.py  from django.db import models class Person(models.Model): first_name = models.CharField(max_length=30) last_name = models.CharField(max_length=30) ä»¥ä¸Šä»£ç å®šä¹‰äº†ä¸€ä¸ª Person æ¨¡å‹ï¼Œæ‹¥æœ‰ first_name å’Œ last_name:first_name å’Œ last_name æ˜¯æ¨¡å‹çš„å­—æ®µã€‚æ¯ä¸ªå­—æ®µéƒ½è¢«æŒ‡å®šä¸ºä¸€ä¸ªç±»å±æ€§ï¼Œå¹¶ä¸”æ¯ä¸ªå±æ€§æ˜ å°„ä¸ºä¸€ä¸ªæ•°æ®åº“åˆ—ã€‚ åœ¨/newSite/newSite/setting.pyä¸­çš„INSTALLED_APPSæ·»åŠ å¦‚ä¸‹ä»£ç ï¼Œæ¥å‘Šè¯‰djangoä½ å‡†å¤‡ä½¿ç”¨è¿™ä¸ªæ¨¡å‹ã€‚\nINSTALLED_APPS = [ #... \u0026#39;ormTest.apps.OrmtestConfig\u0026#39;, #... ] ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ç”Ÿæˆå¯¹åº”çš„æ•°æ®åº“è¡¨\npython manage.py makemigrations ormTest python manage.py migrate ä¸Šé¢çš„Personæ¨¡å‹ä¼šåˆ›å»ºä¸€ä¸ªå¦‚ä¸‹çš„æ•°æ®åº“è¡¨ï¼š\nCREATE TABLE ormTest_person ( \u0026#34;id\u0026#34; serial NOT NULL PRIMARY KEY, \u0026#34;first_name\u0026#34; varchar(30) NOT NULL, \u0026#34;last_name\u0026#34; varchar(30) NOT NULL ); 2.2 CRUD è¿›å…¥pythonå‘½ä»¤è¡Œ\npython manage.py shell In [1]: from ormTest.models import Person # Create  In [4]: Person.objects.create(first_name=\u0026#39;li\u0026#39;, last_name=\u0026#39;chang\u0026#39;) Out[4]: \u0026lt;Person: Person object (1)\u0026gt; # Read In [5]: Person.objects.all() Out[5]: \u0026lt;QuerySet [\u0026lt;Person: Person object (1)\u0026gt;]\u0026gt; # Update In [6]: person1 = Person.objects.get(id=1) In [8]: person1.first_name Out[8]: \u0026#39;li\u0026#39; In [9]: person1.last_name Out[9]: \u0026#39;chang\u0026#39; In [10]: person1.last_name = \u0026#39;YANG\u0026#39; In [11]: person1.save() In [14]: person2 = Person.objects.get(id=1) In [15]: person2.last_name Out[15]: \u0026#39;YANG\u0026#39; # Delete In [16]: person2.delete() Out[16]: (1, {\u0026#39;ormTest.Person\u0026#39;: 1}) In [17]: Person.objects.all() Out[17]: \u0026lt;QuerySet []\u0026gt; ","permalink":"http://yangchnet.github.io/Dessert/posts/%E6%95%B0%E6%8D%AE%E5%BA%93/orm%E7%AE%80%E4%BB%8B/","summary":"1. ORMæ˜¯ä»€ä¹ˆ é¢å‘å¯¹è±¡ç¼–ç¨‹æŠŠæ‰€æœ‰å®ä½“çœ‹æˆå¯¹è±¡ï¼ˆobjectï¼‰ï¼Œå…³ç³»å‹æ•°æ®åº“åˆ™æ˜¯é‡‡ç”¨å®ä½“ä¹‹é—´çš„å…³ç³»ï¼ˆrelationï¼‰è¿æ¥æ•°æ®ã€‚å¾ˆæ—©å°±æœ‰äººæå‡ºï¼Œå…³ç³»ä¹Ÿå¯ä»¥ç”¨å¯¹è±¡è¡¨è¾¾ï¼Œè¿™æ ·çš„è¯ï¼Œå°±èƒ½ä½¿ç”¨é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œæ¥æ“ä½œå…³ç³»å‹æ•°æ®åº“ã€‚ ç®€å•çš„è¯´ï¼ŒORM å°±æ˜¯é€šè¿‡å®ä¾‹å¯¹è±¡çš„è¯­æ³•ï¼Œå®Œæˆå…³ç³»å‹æ•°æ®åº“çš„æ“ä½œçš„æŠ€æœ¯ï¼Œæ˜¯\u0026quot;å¯¹è±¡-å…³ç³»æ˜ å°„\u0026quot;ï¼ˆObject/Relational Mappingï¼‰ çš„ç¼©å†™ã€‚\nORMæŠŠæ•°æ®åº“æ˜ å°„ä¸ºå¯¹è±¡\n æ•°æ®åº“çš„è¡¨ï¼ˆtableï¼‰ \u0026ndash;\u0026gt; ç±»ï¼ˆclassï¼‰ è®°å½•ï¼ˆrecordï¼Œè¡Œæ•°æ®ï¼‰\u0026ndash;\u0026gt; å¯¹è±¡ï¼ˆobjectï¼‰ å­—æ®µï¼ˆfieldï¼‰\u0026ndash;\u0026gt; å¯¹è±¡çš„å±æ€§ï¼ˆattributeï¼‰\n ä¸¾ä¾‹æ¥è¯´ï¼Œä¸‹é¢æ˜¯ä¸€è¡ŒSQLè¯­å¥\nSELECT id, first_name, last_name, phone, birth_date, sex FROM persons WHERE id = 10 ç¨‹åºç›´æ¥è¿è¡ŒSQLï¼Œæ“ä½œæ•°æ®åº“çš„å†™æ³•å¦‚ä¸‹ï¼š\nres = db.execSql(sql) name = res[0][\u0026#34;FIRST_NAME\u0026#34;] æ”¹æˆORMçš„å†™æ³•å¦‚ä¸‹ï¼š\np = Person.get(10) name = p.first_name ä¸€æ¯”è¾ƒå°±å¯ä»¥å‘ç°ï¼ŒORM ä½¿ç”¨å¯¹è±¡ï¼Œå°è£…äº†æ•°æ®åº“æ“ä½œï¼Œå› æ­¤å¯ä»¥ä¸ç¢° SQL è¯­è¨€ã€‚å¼€å‘è€…åªä½¿ç”¨é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œä¸æ•°æ®å¯¹è±¡ç›´æ¥äº¤äº’ï¼Œä¸ç”¨å…³å¿ƒåº•å±‚æ•°æ®åº“ã€‚\næ€»ç»“èµ·æ¥ï¼ŒORMæœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š\n æ•°æ®æ¨¡å‹éƒ½åœ¨ä¸€ä¸ªåœ°æ–¹å®šä¹‰ï¼Œæ›´å®¹æ˜“æ›´æ–°å’Œç»´æŠ¤ï¼Œä¹Ÿåˆ©äºé‡ç”¨ä»£ç ã€‚ ORM æœ‰ç°æˆçš„å·¥å…·ï¼Œå¾ˆå¤šåŠŸèƒ½éƒ½å¯ä»¥è‡ªåŠ¨å®Œæˆï¼Œæ¯”å¦‚æ•°æ®æ¶ˆæ¯’ã€é¢„å¤„ç†ã€äº‹åŠ¡ç­‰ç­‰ã€‚ å®ƒè¿«ä½¿ä½ ä½¿ç”¨ MVC æ¶æ„ï¼ŒORM å°±æ˜¯å¤©ç„¶çš„ Modelï¼Œæœ€ç»ˆä½¿ä»£ç æ›´æ¸…æ™°ã€‚ åŸºäº ORM çš„ä¸šåŠ¡ä»£ç æ¯”è¾ƒç®€å•ï¼Œä»£ç é‡å°‘ï¼Œè¯­ä¹‰æ€§å¥½ï¼Œå®¹æ˜“ç†è§£ã€‚ ä½ ä¸å¿…ç¼–å†™æ€§èƒ½ä¸ä½³çš„ SQLã€‚ ä½†æ˜¯ORMä¹Ÿæœ‰å¾ˆçªå‡ºçš„ç¼ºç‚¹ï¼š ORM åº“ä¸æ˜¯è½»é‡çº§å·¥å…·ï¼Œéœ€è¦èŠ±å¾ˆå¤šç²¾åŠ›å­¦ä¹ å’Œè®¾ç½®ã€‚ å¯¹äºå¤æ‚çš„æŸ¥è¯¢ï¼ŒORM è¦ä¹ˆæ˜¯æ— æ³•è¡¨è¾¾ï¼Œè¦ä¹ˆæ˜¯æ€§èƒ½ä¸å¦‚åŸç”Ÿçš„ SQLã€‚ ORM æŠ½è±¡æ‰äº†æ•°æ®åº“å±‚ï¼Œå¼€å‘è€…æ— æ³•äº†è§£åº•å±‚çš„æ•°æ®åº“æ“ä½œï¼Œä¹Ÿæ— æ³•å®šåˆ¶ä¸€äº›ç‰¹æ®Šçš„ SQLã€‚  2.","title":"ORMç®€ä»‹"},{"content":"1. å®‰è£…å¹¶å¯¹redisè¿›è¡Œé…ç½® æ›´æ–°æºå¹¶å®‰è£…redis\nsudo apt-get update sudo apt-get install redis-server å°†redisè®¾ç½®ä¸ºsystemctl\nsudo vim /etc/redis/redis.conf æ‰¾åˆ°supervisedé€‰é¡¹ï¼Œè®¾ç½®ä¸ºsystemd\n# If you run Redis from upstart or systemd, Redis can interact with your # supervision tree. Options: # supervised no - no supervision interaction # supervised upstart - signal upstart by putting Redis into SIGSTOP mode # supervised systemd - signal systemd by writing READY=1 to $NOTIFY_SOCKET # supervised auto - detect upstart or systemd method based on # UPSTART_JOB or NOTIFY_SOCKET environment variables # Note: these supervision methods only signal \u0026#34;process is ready.\u0026#34; # They do not enable continuous liveness pings back to your supervisor. supervised systemd å¼€å¯redisæœåŠ¡\nsudo service redis-server start 2. æµ‹è¯•redis æŸ¥çœ‹redisè¿è¡ŒçŠ¶æ€\nsudo service redis-server status æ‰“å¼€rediså‘½ä»¤è¡Œ\nredis-cli 127.0.0.1:6379\u0026gt; ping PONG 127.0.0.1:6379\u0026gt; set test \u0026#34;It\u0026#39;s a working\u0026#34; OK 127.0.0.1:6379\u0026gt; get test \u0026#34;It\u0026#39;s a working\u0026#34; 127.0.0.1:6379\u0026gt;exit é€€å‡ºåé‡æ–°è¿æ¥redisï¼Œå†æ¬¡è®¿é—®testé”®\n127.0.0.1:6379\u0026gt; get test \u0026#34;It\u0026#39;s a working\u0026#34; 127.0.0.1:6379\u0026gt; 3. ç»‘å®šåˆ°æœ¬åœ° ä¸€èˆ¬æ¥è¯´ï¼Œä¸æ¨èé…ç½®redisè¿œç¨‹å¯è®¿é—®ï¼Œå› æ­¤ï¼Œè¿™é‡Œåªå°†å…¶é…ç½®ä¸ºæœ¬åœ°å¯è®¿é—®ã€‚\næ‰“å¼€Redis configuration file\nsudo vim /etc/redis/redis.conf å®šä½åˆ°bind,å¹¶å°†å…¶é…ç½®å¦‚ä¸‹\n# By default, if no \u0026#34;bind\u0026#34; configuration directive is specified, Redis listens # for connections from all the network interfaces available on the server. # It is possible to listen to just one or multiple selected interfaces using # the \u0026#34;bind\u0026#34; configuration directive, followed by one or more IP addresses. # # Examples: # # bind 192.168.1.100 10.0.0.1 bind 127.0.0.1 ::1 # è¿™é‡Œæœ¬æ¥è¢«æ³¨é‡Šæ‰ï¼Œå»æ‰æ³¨é‡Šå³å¯ ä¿å­˜é€€å‡ºï¼Œé‡å¯redis\nsudo service redis-server restart æŸ¥çœ‹æ­¤é¡¹é…ç½®æ˜¯å¦ç”Ÿæ•ˆ\n$ sudo netstat -lnp | grep redis tcp 0 0 127.0.0.1:6379 0.0.0.0:* LISTEN 2086/redis-server 1 tcp6 0 0 ::1:6379 :::* LISTEN 2086/redis-server 1 4. ä¸ºredisé…ç½®å¯†ç  æ‰“å¼€redisé…ç½®æ–‡ä»¶ï¼Œå®šä½åˆ°# requirepass foobared\nsudo vim /etc/redis/redis.conf å°†# requirepass foobaredæ³¨é‡Šå»æ‰ï¼ŒæŠŠfoobaredæ”¹æˆä½ æƒ³è¦çš„å¯†ç ã€‚\né‡å¯redisæœåŠ¡\nsudo service redis-server restart å†æ¬¡è¿›å…¥redisï¼Œå°è¯•get\n$ redis-cli 127.0.0.1:6379\u0026gt; get test (error) NOAUTH Authentication required. 127.0.0.1:6379\u0026gt; getå¤±è´¥ï¼Œå› ä¸ºæ²¡æœ‰è¿›è¡Œè®¤è¯.\n127.0.0.1:6379\u0026gt; auth your_redis_password OK 127.0.0.1:6379\u0026gt; get test \u0026#34;It\u0026#39;s a working\u0026#34; 127.0.0.1:6379\u0026gt;  å‚è€ƒï¼šHow To Install and Secure Redis on Ubuntu 18.04\n ","permalink":"http://yangchnet.github.io/Dessert/posts/%E6%95%B0%E6%8D%AE%E5%BA%93/ubuntu18%E5%AE%89%E8%A3%85redis/","summary":"1. å®‰è£…å¹¶å¯¹redisè¿›è¡Œé…ç½® æ›´æ–°æºå¹¶å®‰è£…redis\nsudo apt-get update sudo apt-get install redis-server å°†redisè®¾ç½®ä¸ºsystemctl\nsudo vim /etc/redis/redis.conf æ‰¾åˆ°supervisedé€‰é¡¹ï¼Œè®¾ç½®ä¸ºsystemd\n# If you run Redis from upstart or systemd, Redis can interact with your # supervision tree. Options: # supervised no - no supervision interaction # supervised upstart - signal upstart by putting Redis into SIGSTOP mode # supervised systemd - signal systemd by writing READY=1 to $NOTIFY_SOCKET # supervised auto - detect upstart or systemd method based on # UPSTART_JOB or NOTIFY_SOCKET environment variables # Note: these supervision methods only signal \u0026#34;process is ready.","title":"Ubuntu18ï¼ˆWSL2ï¼‰å®‰è£…redis"},{"content":"1. é—®é¢˜ç°è±¡ è«åå…¶å¦™ï¼Œå¤šå‡ºæ¥å‡ ä¸ªæ˜¾ç¤ºå™¨ã€‚ ä»è®¾å¤‡ç®¡ç†å™¨ä¸­çœ‹ï¼Œä¹Ÿæ˜¯å­˜åœ¨å¤šä¸ªé€šç”¨éå³æ’å³ç”¨æ˜¾ç¤ºå™¨2. è§£å†³åŠæ³• é‡æ–°å®‰è£…Intelæ˜¾å¡é©±åŠ¨ï¼Œå¯ä»¥ä»ç”µè„‘å‚å®¶å®˜ç½‘ä¸‹è½½ã€‚ä½†éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼šåœ¨é‡æ–°å®‰è£…æ˜¾å¡é©±åŠ¨åï¼Œéœ€è¦ç¦ç”¨æ˜¾å¡é©±åŠ¨ç¨‹åºçš„è‡ªåŠ¨æ›´æ–°ï¼Œå¦åˆ™è¿˜æœ‰å¯èƒ½å‡ºç°è¿™ä¸ªé—®é¢˜ã€‚ æ‰“å¼€ç»„ç­–ç•¥gpedit.mscï¼Œé€‰æ‹©è®¡ç®—æœºé…ç½®â€-\u0026gt;â€œç®¡ç†æ¨¡æ¿â€-\u0026gt;â€œç³»ç»Ÿâ€-\u0026gt;â€œè®¾å¤‡å®‰è£…â€-\u0026gt;â€œè®¾å¤‡å®‰è£…é™åˆ¶â€ï¼Œæ‰¾åˆ°Intelæ˜¾å¡çš„ç±»Guidæ·»åŠ åˆ°é˜»æ­¢ä½¿ç”¨ä¸ä¸‹åˆ—è®¾å¤‡å®‰è£…ç¨‹åºç±»ç›¸åŒ¹é…çš„é©±åŠ¨ç¨‹åºå®‰è£…è®¾å¤‡ä¸­\n","permalink":"http://yangchnet.github.io/Dessert/posts/windows/%E5%A4%9A%E5%87%BA%E5%87%A0%E4%B8%AA%E9%80%9A%E7%94%A8%E9%9D%9E%E5%8D%B3%E6%8F%92%E5%8D%B3%E7%94%A8%E6%98%BE%E7%A4%BA%E5%99%A8/","summary":"1. é—®é¢˜ç°è±¡ è«åå…¶å¦™ï¼Œå¤šå‡ºæ¥å‡ ä¸ªæ˜¾ç¤ºå™¨ã€‚ ä»è®¾å¤‡ç®¡ç†å™¨ä¸­çœ‹ï¼Œä¹Ÿæ˜¯å­˜åœ¨å¤šä¸ªé€šç”¨éå³æ’å³ç”¨æ˜¾ç¤ºå™¨2. è§£å†³åŠæ³• é‡æ–°å®‰è£…Intelæ˜¾å¡é©±åŠ¨ï¼Œå¯ä»¥ä»ç”µè„‘å‚å®¶å®˜ç½‘ä¸‹è½½ã€‚ä½†éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼šåœ¨é‡æ–°å®‰è£…æ˜¾å¡é©±åŠ¨åï¼Œéœ€è¦ç¦ç”¨æ˜¾å¡é©±åŠ¨ç¨‹åºçš„è‡ªåŠ¨æ›´æ–°ï¼Œå¦åˆ™è¿˜æœ‰å¯èƒ½å‡ºç°è¿™ä¸ªé—®é¢˜ã€‚ æ‰“å¼€ç»„ç­–ç•¥gpedit.mscï¼Œé€‰æ‹©è®¡ç®—æœºé…ç½®â€-\u0026gt;â€œç®¡ç†æ¨¡æ¿â€-\u0026gt;â€œç³»ç»Ÿâ€-\u0026gt;â€œè®¾å¤‡å®‰è£…â€-\u0026gt;â€œè®¾å¤‡å®‰è£…é™åˆ¶â€ï¼Œæ‰¾åˆ°Intelæ˜¾å¡çš„ç±»Guidæ·»åŠ åˆ°é˜»æ­¢ä½¿ç”¨ä¸ä¸‹åˆ—è®¾å¤‡å®‰è£…ç¨‹åºç±»ç›¸åŒ¹é…çš„é©±åŠ¨ç¨‹åºå®‰è£…è®¾å¤‡ä¸­","title":"å¤šå‡ºå‡ ä¸ªé€šç”¨éå³æ’å³ç”¨æ˜¾ç¤ºå™¨"},{"content":"1. é•¿åº¦  æ•°ç»„\n å¯¹äºæ•°ç»„æ¥è¯´ï¼Œå®ƒçš„é•¿åº¦æ˜¯å›ºå®šçš„ï¼Œå¹¶ä¸”æ•°ç»„çš„é•¿åº¦æ˜¯å…¶ç±»å‹çš„ä¸€éƒ¨åˆ†ï¼Œå³å¯¹äºä»¥ä¸‹ä¸¤ä¸ªæ•°ç»„æ¥è¯´ï¼Œä»–ä»¬æ˜¯ä¸åŒçš„ç±»å‹ã€‚\nvar a [5]int var b [6]int fmt.Printf(\u0026#34;%v\u0026#34;, reflect.TypeOf(a) == reflect.TypeOf(b)) // è¾“å‡ºï¼š false æ•°ç»„çš„é•¿åº¦å¿…é¡»æ˜¯å¸¸é‡è¡¨è¾¾å¼ï¼Œå› ä¸ºæ•°ç»„çš„é•¿åº¦éœ€è¦åœ¨ç¼–è¯‘é˜¶æ®µç¡®å®šã€‚ å¯¹äºæ•°ç»„æ¥è¯´ï¼Œç”±äºå…¶é•¿åº¦æ˜¯å›ºå®šçš„ï¼Œå› æ­¤ä¸èƒ½æ·»åŠ æˆ–åˆ é™¤å…ƒç´ ã€‚\n åˆ‡ç‰‡\n è€Œå¯¹äºåˆ‡ç‰‡ï¼Œå…¶é•¿åº¦æ˜¯ä¸å›ºå®šçš„ï¼Œä¸åŒé•¿åº¦çš„åˆ‡ç‰‡ï¼Œåªè¦å…¶å…ƒç´ ç±»å‹ç›¸åŒï¼Œåˆ™å®ƒä»¬å°±æ˜¯ç›¸åŒçš„åˆ‡ç‰‡ç±»å‹ã€‚\na := make([]int, 5) b := make([]int, 6) fmt.Printf(\u0026#34;%v\\n\u0026#34;, reflect.TypeOf(a) == reflect.TypeOf(b)) // è¾“å‡ºï¼š true å¦‚æœåˆ‡ç‰‡æ“ä½œè¶…å‡ºcap(s)çš„ä¸Šé™å°†å¯¼è‡´ä¸€ä¸ªpanicå¼‚å¸¸ï¼Œä½†æ˜¯è¶…å‡ºlen(s)åˆ™æ˜¯æ„å‘³ç€æ‰©å±•äº† sliceï¼Œå› ä¸ºæ–°sliceçš„é•¿åº¦ä¼šå˜å¤§ï¼š\nmonths := [...]string{1: \u0026#34;January\u0026#34;, /* ... */, 12: \u0026#34;December\u0026#34;} summer := months[6:9] fmt.Println(summer[:20]) // panic: out of range endlessSummer := summer[:5] // extend a slice (within capacity) fmt.Println(endlessSummer) // \u0026#34;[June July August September October]\u0026#34; 2. æ¯”è¾ƒ  æ•°ç»„\n å¦‚æœä¸€ä¸ªæ•°ç»„çš„å…ƒç´ ç±»å‹æ˜¯å¯ä»¥ç›¸äº’æ¯”è¾ƒçš„ï¼Œé‚£ä¹ˆæ•°ç»„ç±»å‹ä¹Ÿæ˜¯å¯ä»¥ç›¸äº’æ¯”è¾ƒçš„ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡==æ¯”è¾ƒè¿ç®—ç¬¦æ¥æ¯”è¾ƒä¸¤ä¸ªæ•°ç»„ã€‚åªæœ‰å½“ä¸¤ä¸ªæ•°ç»„çš„æ‰€æœ‰å…ƒç´ éƒ½æ˜¯ç›¸ç­‰çš„æ—¶å€™æ•°ç»„æ‰æ˜¯ç›¸ç­‰çš„ã€‚ä¸ç›¸ç­‰æ¯”è¾ƒè¿ç®—ç¬¦!=éµå¾ªåŒæ ·çš„è§„åˆ™.\na := [2]int{1, 2} b := [...]int{1, 2} c := [2]int{1, 3} fmt.Println(a==b, a==c, b==c) // \u0026#34;true, false, false\u0026#34; d := [3]int{1, 2} fmt.Println(a==d) // compile error: cannot compare [2]int == [3]int  åˆ‡ç‰‡\n åˆ‡ç‰‡ä¹‹é—´ä¸èƒ½æ¯”è¾ƒï¼Œå› æ­¤æˆ‘ä»¬ä¸èƒ½ä½¿ç”¨==æ“ä½œç¬¦æ¥åˆ¤æ–­ä¸¤ä¸ªsliceæ˜¯å¦å«æœ‰å…¨éƒ¨ç›¸ç­‰å…ƒç´ ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè¦æƒ³åˆ¤æ–­ä¸¤ä¸ªsliceæ˜¯å¦ç›¸ç­‰ï¼Œæˆ‘ä»¬å¿…é¡»è‡ªå·±å±•å¼€æ¯ä¸ªå…ƒç´ è¿›è¡Œæ¯”è¾ƒã€‚\nä¸ºä»€ä¹ˆsliceä¸ç›´æ¥æ”¯æŒæ¯”è¾ƒè¿ç®—ç¬¦å‘¢ï¼Ÿ1. ä¸€ä¸ªsliceçš„å…ƒç´ æ˜¯é—´æ¥å¼•ç”¨çš„ï¼Œä¸€ä¸ªsliceç”šè‡³å¯ä»¥åŒ…å«è‡ªèº«ã€‚è™½ç„¶æœ‰å¾ˆå¤šåŠæ³•å¯ä»¥å¤„ç†è¿™ç§æƒ…å½¢ï¼Œä½†æ²¡æœ‰ä¸€ä¸ªæ˜¯ç®€å•æœ‰æ•ˆçš„ã€‚2. å› ä¸ºsliceæ˜¯é—´æ¥å¼•ç”¨çš„ï¼Œä¸€ä¸ªå›ºå®šå€¼çš„sliceåœ¨ä¸åŒçš„æ—¶é—´å¯èƒ½åŒ…å«ä¸åŒçš„å…ƒç´ ï¼Œå› ä¸ºåº•å±‚æ•°ç»„çš„å…ƒç´ å¯èƒ½ä¼šè¢«ä¿®æ”¹. sliceå”¯ä¸€åˆæ³•çš„æ¯”è¾ƒæ“ä½œæ˜¯å’Œnilè¿›è¡Œæ¯”è¾ƒï¼Œä¾‹å¦‚ï¼š\nif summer == nil { /* ... */ } 3. ä½œä¸ºå‡½æ•°å‚æ•°  æ•°ç»„\n å½“æ•°ç»„ä½œä¸ºå‡½æ•°çš„å‚æ•°ä¼ é€’æ—¶ï¼Œå®é™…ä¸Šä¼ é€’çš„æ˜¯ä¸€ä¸ªæ•°ç»„çš„å¤åˆ¶ã€‚å› æ­¤ï¼Œä»»ä½•åœ¨å‡½æ•°å†…éƒ¨å¯¹äºæ•°ç»„çš„ä¿®æ”¹éƒ½æ˜¯åœ¨æ•°ç»„çš„å¤åˆ¶ä¸Šä¿®æ”¹çš„ï¼Œå¹¶ä¸èƒ½ç›´æ¥ä¿®æ”¹è°ƒç”¨æ—¶åŸå§‹çš„æ•°ç»„å˜é‡ã€‚\n//å…ˆå®šä¹‰ä¸€ä¸ªæ•°ç»„ var a = [5]int{1, 2, 3, 4, 5} //å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œå°†æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå€¼è®¾ä¸º0 func change(a [5]int){ a[0] = 0 fmt.Println(a) } change(a) fmt.Println(a) /* è¾“å‡ºï¼š [0 2 3 4 5] [1 2 3 4 5] */ // åªä¿®æ”¹äº†å¤åˆ¶çš„æ•°ç»„ï¼ŒåŸå§‹æ•°ç»„æ²¡æœ‰å¾—åˆ°ä¿®æ”¹ã€‚ å¯ä»¥æ˜¾å¼çš„ä¼ å…¥ä¸€ä¸ªæ•°ç»„æŒ‡é’ˆï¼Œè¿™æ ·çš„è¯å‡½æ•°é€šè¿‡æŒ‡é’ˆå¯¹æ•°ç»„çš„ä»»ä½•ä¿®æ”¹éƒ½å¯ä»¥ç›´æ¥åé¦ˆåˆ°è°ƒç”¨è€…ã€‚\nfunc main() { var a = [5]int{1, 2, 3, 4, 5} fmt.Println(a) change(\u0026amp;a) fmt.Println(a) } func change(ptr *[5]int) { ptr[0] = 0 fmt.Println(*ptr) } /* è¾“å‡º: [1 2 3 4 5] [0 2 3 4 5] [0 2 3 4 5] */  slice\n sliceæ˜¯ä¸€ä¸ªå¼•ç”¨ç±»å‹ï¼Œsliceå€¼åŒ…å«æŒ‡å‘ç¬¬ä¸€ä¸ªsliceå…ƒç´ çš„æŒ‡é’ˆï¼Œå› æ­¤å‘å‡½æ•°ä¼ é€’sliceå°†å…è®¸åœ¨å‡½æ•°å†…éƒ¨ä¿®æ”¹åº• å±‚æ•°ç»„çš„å…ƒç´ ã€‚æ¢å¥è¯è¯´ï¼Œå¤åˆ¶ä¸€ä¸ªsliceåªæ˜¯å¯¹åº•å±‚çš„æ•°ç»„åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„sliceåˆ«åã€‚\nfunc reverse(s []int) { for i, j := 0, len(s)-1; i \u0026lt; j; i, j = i+1, j-1 { s[i], s[j] = s[j], s[i] } } a := [...]int{0, 1, 2, 3, 4, 5} reverse(a[:]) fmt.Println(a) // \u0026#34;[5 4 3 2 1 0]\u0026#34; è¿™é‡Œå­˜åœ¨ä¸€ä¸ªå‘ï¼Œå°±æ˜¯æˆ‘ä»¬ä¼šè¯¯ä»¥ä¸ºå¯¹äºä¼ å…¥çš„åˆ‡ç‰‡ä½œå‡ºçš„ä»»ä½•æ›´æ”¹éƒ½ä¼šåæ˜ åˆ°åŸæ¥çš„åˆ‡ç‰‡ä¸Šï¼Œå…¶å®ä¸ç„¶ï¼Œè¯·çœ‹ä¸‹é¢ç¨‹åºï¼š\npackage main import \u0026#34;fmt\u0026#34; func myAppend(s []int) []int { // è¿™é‡Œ s è™½ç„¶æ”¹å˜äº†ï¼Œä½†å¹¶ä¸ä¼šå½±å“å¤–å±‚å‡½æ•°çš„ s  s = append(s, 100) return s } func myAppendPtr(s *[]int) { // ä¼šæ”¹å˜å¤–å±‚ s æœ¬èº«  *s = append(*s, 100) return } func main() { s := []int{1, 1, 1} newS := myAppend(s) fmt.Println(s) fmt.Println(newS) s = newS myAppendPtr(\u0026amp;s) fmt.Println(s) } è¿è¡Œç»“æœä¸ºï¼š\n[1 1 1] [1 1 1 100] [1 1 1 100 100] å¾ˆæ˜æ˜¾ï¼Œå¯¹äºåˆ‡ç‰‡ä½œå‡ºçš„æ”¹å˜æœªåæ˜ åˆ°åŸåˆ‡ç‰‡ä¸Šï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ ä»”ç»†è§‚å¯Ÿï¼Œå¯ä»¥çœ‹å‡ºï¼Œå¯¹äºåæ˜ åˆ°åŸåˆ‡ç‰‡ä¸Šçš„æ”¹åŠ¨ï¼Œéƒ½æ˜¯ç›´æ¥è®¿é—®äº†åˆ‡ç‰‡å…ƒç´ ï¼Œè€Œæ²¡æœ‰åæ˜ åˆ°åŸåˆ‡ç‰‡ä¸Šçš„æ”¹åŠ¨ï¼Œåˆ™æ²¡æœ‰ç›´æ¥è®¿é—®å…ƒç´ ã€‚è¿™æ˜¯å› ä¸ºå¯¹äºåˆ‡ç‰‡å…ƒç´ çš„è®¿é—®ï¼Œå®é™…ä¸Šè®¿é—®çš„æ˜¯åˆ‡ç‰‡å†…éƒ¨arrayæŒ‡é’ˆï¼Œå› æ­¤æ‰èƒ½åæ˜ åˆ°åŸæ•°ç»„ä¸­ã€‚ è€Œå¯¹äºåˆ‡ç‰‡çš„ç›´æ¥ä¿®æ”¹ï¼Œæ²¡æœ‰è®¿é—®arrayæŒ‡é’ˆ(å¯èƒ½æ˜¯æ”¹å˜äº†arrayæˆ–lenã€cap)ï¼Œå› æ­¤æ— æ³•åæ˜ åˆ°åŸåˆ‡ç‰‡ä¸Š. ä½†å½“æˆ‘ä»¬ä¼ å…¥åˆ‡ç‰‡æŒ‡é’ˆæ—¶ï¼Œä½œå‡ºçš„ä»»ä½•æ”¹å˜å°±éƒ½å¯ä»¥åæ˜ åˆ°åŸåˆ‡ç‰‡ä¸Šäº†ã€‚\ntype slice struct { array unsafe.Pointer len int cap int } ç¤ºæ„å›¾å¦‚ä¸‹ï¼Œä¼ å…¥å‡½æ•°å†…éƒ¨çš„sliceæ˜¯å¯¹å¤–éƒ¨sliceçš„ä¸€ä¸ªå¤åˆ¶ï¼Œå› æ­¤äºŒè€…å…·æœ‰ç›¸åŒçš„arrayã€lenã€capç­‰ã€‚å¯¹äºå‡½æ•°å†…éƒ¨çš„slice.arrayè¿›è¡Œè®¿é—®ä¿®æ”¹ï¼Œå®é™…ä¸Šå°±æ˜¯åœ¨å¯¹å¤–éƒ¨sliceçš„arrayè¿›è¡Œä¿®æ”¹ã€‚ä½†å¦‚æœæ˜¯ç›´æ¥å¯¹arrayä¿®æ”¹ï¼ˆä¸è®¿é—®æŒ‡é’ˆï¼‰ï¼Œé‚£ä¹ˆæ— è®ºä½œå‡ºä»»ä½•ä¿®æ”¹ï¼Œéƒ½ä»…ä»…æ˜¯åœ¨å¤–éƒ¨sliceçš„ä¸€ä¸ªå¤åˆ¶ä¸Šä½œå‡ºçš„æ”¹åŠ¨ã€‚ ä¸€ä¸ªå°å‘ è¯·çœ‹ä¸‹é¢ç¨‹åº\na := []int{1, 2, 3} b := a[1:2] // b: [2] b[0] = 4 // b: [4] b = append(b, 5) // b: [4, 5]; a: [1, 4, 5] b = append(b, 6) // b: [4, 5, 6]; a: [1, 4, 5] b[0] = 7 // b: [7, 5, 6]; a: [1, 4, 5] fmt.Println(a) // 1, 4, 5 fmt.Println(b) // 7, 5, 6 è¿™é‡Œbæ˜¯æˆªå–aå¾—åˆ°çš„åˆ‡ç‰‡ï¼Œä¹Ÿå°±æ˜¯è¯´bä¸aå…±äº«åŒä¸€ä¸ªåº•å±‚æ•°ç»„ã€‚é‚£ä¹ˆå¯¹bçš„ä¿®æ”¹åº”åæ˜ åˆ°aä¸Šã€‚ä½†åœ¨å€’æ•°ç¬¬ä¸‰è¡Œä¸­ï¼Œå¯¹bçš„ç¬¬ä¸€ä¸ªå…ƒç´ çš„ä¿®æ”¹å»å¹¶æ²¡æœ‰è¢«åæ˜ åˆ°aä¸­ã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ\né¦–å…ˆï¼Œaçš„å®¹é‡ä¸º3,bæˆªå–äº†açš„ç¬¬1ä¸ªå…ƒç´ ï¼Œæ­¤æ—¶bçš„å®¹é‡ä¸º1ï¼Œä¸”bçš„ç¬¬0ä¸ªå…ƒç´ ä¸açš„ç¬¬1ä¸ªå…ƒç´ ä¸ºåŒä¸€ä¸ªåº•å±‚intå€¼ã€‚å¯¹bè¿›è¡Œä¸€æ¬¡appendï¼Œbçš„å®¹é‡å˜ä¸º2,ä¸”ç”±äºbçš„é•¿åº¦æœªè¶…å‡ºaçš„å®¹é‡ï¼Œæ‰€ä»¥æ˜¯ç›´æ¥åœ¨aä¸bå…±äº«çš„åº•å±‚æ•°ç»„ä¸Šè¿›è¡Œçš„ä¿®æ”¹ã€‚ä½†å†æ¬¡å¯¹bè¿›è¡Œappendæ—¶ï¼Œaçš„å®¹é‡å·²ç»ä¸è¶³ï¼Œè¿™æ—¶å°±è¦é‡æ–°ä¸ºbåˆ†é…å†…å­˜ï¼Œåˆ†é…å®Œæ¯•åå°†bçš„å€¼å¤åˆ¶åˆ°æ–°åˆ‡ç‰‡ä¸Šï¼Œç„¶åå†è¿›è¡Œappendã€‚ä¹Ÿå°±æ˜¯è¯´æ­¤æ—¶aä¸bå·²ç»ä¸æ˜¯ä¸€ä¸ªåº•å±‚æ•°ç»„äº†ï¼Œå› æ­¤å¯¹bçš„ä¿®æ”¹å°†ä¸å†ä¸aæœ‰å…³ã€‚\n","permalink":"http://yangchnet.github.io/Dessert/posts/golang/slice%E5%92%8C%E6%95%B0%E7%BB%84%E7%9A%84%E5%8C%BA%E5%88%AB/","summary":"1. é•¿åº¦  æ•°ç»„\n å¯¹äºæ•°ç»„æ¥è¯´ï¼Œå®ƒçš„é•¿åº¦æ˜¯å›ºå®šçš„ï¼Œå¹¶ä¸”æ•°ç»„çš„é•¿åº¦æ˜¯å…¶ç±»å‹çš„ä¸€éƒ¨åˆ†ï¼Œå³å¯¹äºä»¥ä¸‹ä¸¤ä¸ªæ•°ç»„æ¥è¯´ï¼Œä»–ä»¬æ˜¯ä¸åŒçš„ç±»å‹ã€‚\nvar a [5]int var b [6]int fmt.Printf(\u0026#34;%v\u0026#34;, reflect.TypeOf(a) == reflect.TypeOf(b)) // è¾“å‡ºï¼š false æ•°ç»„çš„é•¿åº¦å¿…é¡»æ˜¯å¸¸é‡è¡¨è¾¾å¼ï¼Œå› ä¸ºæ•°ç»„çš„é•¿åº¦éœ€è¦åœ¨ç¼–è¯‘é˜¶æ®µç¡®å®šã€‚ å¯¹äºæ•°ç»„æ¥è¯´ï¼Œç”±äºå…¶é•¿åº¦æ˜¯å›ºå®šçš„ï¼Œå› æ­¤ä¸èƒ½æ·»åŠ æˆ–åˆ é™¤å…ƒç´ ã€‚\n åˆ‡ç‰‡\n è€Œå¯¹äºåˆ‡ç‰‡ï¼Œå…¶é•¿åº¦æ˜¯ä¸å›ºå®šçš„ï¼Œä¸åŒé•¿åº¦çš„åˆ‡ç‰‡ï¼Œåªè¦å…¶å…ƒç´ ç±»å‹ç›¸åŒï¼Œåˆ™å®ƒä»¬å°±æ˜¯ç›¸åŒçš„åˆ‡ç‰‡ç±»å‹ã€‚\na := make([]int, 5) b := make([]int, 6) fmt.Printf(\u0026#34;%v\\n\u0026#34;, reflect.TypeOf(a) == reflect.TypeOf(b)) // è¾“å‡ºï¼š true å¦‚æœåˆ‡ç‰‡æ“ä½œè¶…å‡ºcap(s)çš„ä¸Šé™å°†å¯¼è‡´ä¸€ä¸ªpanicå¼‚å¸¸ï¼Œä½†æ˜¯è¶…å‡ºlen(s)åˆ™æ˜¯æ„å‘³ç€æ‰©å±•äº† sliceï¼Œå› ä¸ºæ–°sliceçš„é•¿åº¦ä¼šå˜å¤§ï¼š\nmonths := [...]string{1: \u0026#34;January\u0026#34;, /* ... */, 12: \u0026#34;December\u0026#34;} summer := months[6:9] fmt.Println(summer[:20]) // panic: out of range endlessSummer := summer[:5] // extend a slice (within capacity) fmt.Println(endlessSummer) // \u0026#34;[June July August September October]\u0026#34; 2.","title":"sliceå’Œæ•°ç»„çš„åŒºåˆ«"},{"content":"1. Readeræ¥å£ type Reader interface { Read(p []byte) (n int, err error) }  æ¥å£è¯´æ˜\n Read å°† len(p) ä¸ªå­—èŠ‚è¯»å–åˆ° p ä¸­ã€‚å®ƒè¿”å›è¯»å–çš„å­—èŠ‚æ•° nï¼ˆ0 \u0026lt;= n \u0026lt;= len(p)ï¼‰ ä»¥åŠä»»ä½•é‡åˆ°çš„é”™è¯¯ã€‚å³ä½¿ Read è¿”å›çš„ n \u0026lt; len(p)ï¼Œå®ƒä¹Ÿä¼šåœ¨è°ƒç”¨è¿‡ç¨‹ä¸­å ç”¨ len(p) ä¸ªå­—èŠ‚ä½œä¸ºæš‚å­˜ç©ºé—´ã€‚è‹¥å¯è¯»å–çš„æ•°æ®ä¸åˆ° len(p) ä¸ªå­—èŠ‚ï¼ŒRead ä¼šè¿”å›å¯ç”¨æ•°æ®ï¼Œè€Œä¸æ˜¯ç­‰å¾…æ›´å¤šæ•°æ®ã€‚\nå½“ Read åœ¨æˆåŠŸè¯»å– n \u0026gt; 0 ä¸ªå­—èŠ‚åé‡åˆ°ä¸€ä¸ªé”™è¯¯æˆ– EOF (end-of-file)ï¼Œå®ƒä¼šè¿”å›è¯»å–çš„å­—èŠ‚æ•°ã€‚å®ƒå¯èƒ½ä¼šåŒæ—¶åœ¨æœ¬æ¬¡çš„è°ƒç”¨ä¸­è¿”å›ä¸€ä¸ªnon-nilé”™è¯¯,æˆ–åœ¨ä¸‹ä¸€æ¬¡çš„è°ƒç”¨ä¸­è¿”å›è¿™ä¸ªé”™è¯¯ï¼ˆä¸” n ä¸º 0ï¼‰ã€‚ ä¸€èˆ¬æƒ…å†µä¸‹, Readerä¼šè¿”å›ä¸€ä¸ªé0å­—èŠ‚æ•°n, è‹¥ n = len(p) ä¸ªå­—èŠ‚ä»è¾“å…¥æºçš„ç»“å°¾å¤„ç”± Read è¿”å›ï¼ŒReadå¯èƒ½è¿”å› err == EOF æˆ–è€… err == nilã€‚å¹¶ä¸”ä¹‹åçš„ Read() éƒ½åº”è¯¥è¿”å› (n:0, err:EOF)ã€‚\nè°ƒç”¨è€…åœ¨è€ƒè™‘é”™è¯¯ä¹‹å‰åº”å½“é¦–å…ˆå¤„ç†è¿”å›çš„æ•°æ®ã€‚è¿™æ ·åšå¯ä»¥æ­£ç¡®åœ°å¤„ç†åœ¨è¯»å–ä¸€äº›å­—èŠ‚åäº§ç”Ÿçš„ I/O é”™è¯¯ï¼ŒåŒæ—¶å…è®¸EOFçš„å‡ºç°\n ä¾‹å­\n func ReadFrom(reader io.Reader, num int) ([]byte, error) { p := make([]byte, num) n, err := reader.Read(p) if n \u0026gt; 0 { return p[:n], nil } return p, err } ReadFromå‡½æ•°å°†io.Readerä½œä¸ºå‚æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒReadFromå¯ä»¥ä»ä»»ä½•å®ç°äº†io.Readeræ¥å£çš„åœ°æ–¹è¯»å–æ•°æ®ã€‚\n// ä»æ ‡å‡†è¾“å…¥è¯»å–æ•°æ® data, err := ReadFrom(os.Stdin, 11) // ä»æ™®é€šæ–‡ä»¶ä¸­è¯»å–ï¼Œ file = new(os.File) data, err := Read From(file, 9) // ä»å­—ç¬¦ä¸²è¯»å– data, err := ReadFrom(strings.NewReader(\u0026#34;from string\u0026#34;), 12) io.Readerå°†å½“å‰io.Readerå®ä¾‹ä¸­çš„å€¼è¯»å–åˆ°å‚æ•°pä¸­ $$io.Reader \\stackrel{data}{\\rightarrow} [\\ ]byte$$\n2. Writeræ¥å£ type Writer interface { Write(p []byte) (n int, err error) }  åŠŸèƒ½è¯´æ˜\n Write å°† len(p) ä¸ªå­—èŠ‚ä» p ä¸­å†™å…¥åˆ°åŸºæœ¬æ•°æ®æµä¸­ã€‚å®ƒè¿”å›ä» p ä¸­è¢«å†™å…¥çš„å­—èŠ‚æ•° nï¼ˆ0 \u0026lt;= n \u0026lt;= len(p)ï¼‰ä»¥åŠä»»ä½•é‡åˆ°çš„å¼•èµ·å†™å…¥æå‰åœæ­¢çš„é”™è¯¯ã€‚è‹¥ Write è¿”å›çš„ n \u0026lt; len(p)ï¼Œå®ƒå°±å¿…é¡»è¿”å›ä¸€ä¸ª énil çš„é”™è¯¯ã€‚\n ä¾‹å­\n åœ¨fmtæ ‡å‡†åº“ä¸­ï¼Œæœ‰ä¸€ç»„å‡½æ•°:Fprint/Fprintf/Fprintln,å®ƒä»¬æ¥æ”¶ä¸€ä¸ªio.Wirterç±»å‹å‚æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä»¬å°†æ•°æ®æ ¼å¼åŒ–è¾“å‡ºåˆ°io.Writerä¸­ã€‚é‚£ä¹ˆï¼Œè°ƒç”¨è¿™ç»„å‡½æ•°æ—¶ï¼Œè¯¥å¦‚ä½•å®ç°è¿™ä¸ªå‚æ•°å‘¢ï¼Ÿ ä»¥fmt.Fprintln()ä¸ºä¾‹ï¼š\nfunc Println(a ...interface{}) (n int, err error) { return Fprintln(os.Stdout, a...) } io.Writerå°†pä¸­çš„æ•°æ®å†™å…¥åˆ°io.Wirterå®ä¾‹ä¸­ $$[\\ ]byte \\stackrel{data}{\\rightarrow} io.Writer$$\n","permalink":"http://yangchnet.github.io/Dessert/posts/golang/reader%E5%92%8Cwriter%E6%8E%A5%E5%8F%A3/","summary":"1. Readeræ¥å£ type Reader interface { Read(p []byte) (n int, err error) }  æ¥å£è¯´æ˜\n Read å°† len(p) ä¸ªå­—èŠ‚è¯»å–åˆ° p ä¸­ã€‚å®ƒè¿”å›è¯»å–çš„å­—èŠ‚æ•° nï¼ˆ0 \u0026lt;= n \u0026lt;= len(p)ï¼‰ ä»¥åŠä»»ä½•é‡åˆ°çš„é”™è¯¯ã€‚å³ä½¿ Read è¿”å›çš„ n \u0026lt; len(p)ï¼Œå®ƒä¹Ÿä¼šåœ¨è°ƒç”¨è¿‡ç¨‹ä¸­å ç”¨ len(p) ä¸ªå­—èŠ‚ä½œä¸ºæš‚å­˜ç©ºé—´ã€‚è‹¥å¯è¯»å–çš„æ•°æ®ä¸åˆ° len(p) ä¸ªå­—èŠ‚ï¼ŒRead ä¼šè¿”å›å¯ç”¨æ•°æ®ï¼Œè€Œä¸æ˜¯ç­‰å¾…æ›´å¤šæ•°æ®ã€‚\nå½“ Read åœ¨æˆåŠŸè¯»å– n \u0026gt; 0 ä¸ªå­—èŠ‚åé‡åˆ°ä¸€ä¸ªé”™è¯¯æˆ– EOF (end-of-file)ï¼Œå®ƒä¼šè¿”å›è¯»å–çš„å­—èŠ‚æ•°ã€‚å®ƒå¯èƒ½ä¼šåŒæ—¶åœ¨æœ¬æ¬¡çš„è°ƒç”¨ä¸­è¿”å›ä¸€ä¸ªnon-nilé”™è¯¯,æˆ–åœ¨ä¸‹ä¸€æ¬¡çš„è°ƒç”¨ä¸­è¿”å›è¿™ä¸ªé”™è¯¯ï¼ˆä¸” n ä¸º 0ï¼‰ã€‚ ä¸€èˆ¬æƒ…å†µä¸‹, Readerä¼šè¿”å›ä¸€ä¸ªé0å­—èŠ‚æ•°n, è‹¥ n = len(p) ä¸ªå­—èŠ‚ä»è¾“å…¥æºçš„ç»“å°¾å¤„ç”± Read è¿”å›ï¼ŒReadå¯èƒ½è¿”å› err == EOF æˆ–è€… err == nilã€‚å¹¶ä¸”ä¹‹åçš„ Read() éƒ½åº”è¯¥è¿”å› (n:0, err:EOF)ã€‚","title":"Readerå’ŒWriteræ¥å£"},{"content":"1. çº¿ç¨‹ åœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œè¿›ç¨‹æ˜¯åˆ†é…èµ„æºçš„åŸºæœ¬å•ä½ï¼Œä½†å½“è¿›ç¨‹ä½œä¸ºè°ƒåº¦çš„åŸºæœ¬å•ä½æ—¶ï¼Œä¼šé€ æˆè¾ƒå¤§çš„å¼€é”€ï¼Œé¢‘ç¹çš„è¿›ç¨‹è°ƒåº¦å°†æ¶ˆè€—å¤§é‡æ—¶é—´ã€‚å› æ­¤å¼•å‡ºäº†çº¿ç¨‹ï¼šçº¿ç¨‹æ˜¯å¤„ç†å™¨è°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œçº¿ç¨‹åªæ‹¥æœ‰å¾ˆå°çš„è¿è¡Œæ—¶å¿…è¦çš„èµ„æºã€‚ä¸€ä¸ªè¿›ç¨‹å¯æ‹¥æœ‰å¤šä¸ªçº¿ç¨‹ï¼ŒåŒä¸€ä¸ªè¿›ç¨‹ä¸­çš„æ‰€æœ‰çº¿ç¨‹å…±äº«è¿›ç¨‹è·å¾—çš„ä¸»å­˜ç©ºé—´å’Œèµ„æºã€‚ çº¿ç¨‹çš„å®ç°\næœ‰äº›ç³»ç»ŸåŒæ—¶æ”¯æŒç”¨æˆ·çº¿ç¨‹å’Œå†…æ ¸çº¿ç¨‹ï¼Œç”±æ­¤äº§ç”Ÿäº†ä¸åŒçš„å¤šçº¿ç¨‹æ¨¡å‹ï¼Œå³å®ç°ç”¨æˆ·çº§çº¿ç¨‹ å’Œå†…æ ¸çº§çº¿ç¨‹çš„è¿æ¥æ–¹å¼ï¼šå¤šå¯¹ä¸€æ¨¡å‹ã€ä¸€å¯¹ä¸€æ¨¡å‹ã€å¤šå¯¹å¤šæ¨¡å‹ã€‚\n2. goroutine åœ¨Goè¯­è¨€ä¸­ï¼Œæ¯ä¸€ä¸ªå¹¶å‘çš„æ‰§è¡Œå•å…ƒå«ä½œä¸€ä¸ªgoroutineï¼Œæ˜¯ä¸€ç§è½»é‡çº§çš„çº¿ç¨‹ã€‚\n3. çº¿ç¨‹ä¸goroutineçš„åŒºåˆ«   è¿è¡Œæ—¶æ ˆçš„å¤§å°\n æ¯ä¸ªç³»ç»Ÿçº§çº¿ç¨‹éƒ½ä¼šæœ‰ä¸€ä¸ªå›ºå®šå¤§å°çš„æ ˆï¼ˆä¸€èˆ¬ä¸º2MBï¼‰ï¼Œä¸»è¦ç”¨äºä¿å­˜å‡½æ•°é€’å½’è°ƒç”¨æ—¶å‚æ•°å’Œå±€éƒ¨å˜é‡ã€‚è¿™é€ æˆäº†ä¸¤ä¸ªé—®é¢˜ï¼š  å¯¹äºæŸäº›éœ€è¦å¾ˆå°çš„æ ˆç©ºé—´çš„çº¿ç¨‹æ¥è¯´æ˜¯ä¸€ä¸ªå·¨å¤§çš„æµªè´¹ å¯¹äºå°‘æ•°éœ€è¦å·¨å¤§æ ˆç©ºé—´çš„çº¿ç¨‹æ¥è¯´åˆé¢ä¸´æ ˆæº¢å‡ºçš„é£é™©   goroutineä¼šä»¥ä¸€ä¸ªå¾ˆå°çš„æ ˆå¯åŠ¨ï¼ˆ2KBæˆ–4KBï¼‰ï¼Œå½“é‡åˆ°æ·±åº¦é€’å½’æ—¶å¯¼è‡´å½“å‰æ ˆç©ºé—´ä¸è¶³ï¼Œä¼šæ ¹æ®éœ€è¦åŠ¨æ€çš„ä¼¸ç¼©æ ˆçš„å¤§å°ã€‚    è°ƒåº¦\n goçš„è¿è¡Œæ—¶è¿˜åŒ…æ‹¬äº†å…¶è‡ªå·±çš„è°ƒåº¦å™¨ï¼Œå¯ä»¥åœ¨nä¸ªæ“ä½œç³»ç»Ÿçº¿ç¨‹ä¸Šå¤šå·¥è°ƒåº¦mä¸ªgoroutineï¼ˆç±»ä¼¼äºå¤šçº¿ç¨‹æ¨¡å‹ä¸­çš„å¤šå¯¹å¤šæ¨¡å‹ï¼‰ã€‚ goè°ƒåº¦å™¨çš„å·¥ä½œå’Œå†…æ ¸çš„è°ƒåº¦æ—¶ç›¸ä¼¼çš„ï¼Œä½†æ˜¯è¿™ä¸ªè°ƒåº¦å™¨åªå…³æ³¨å•ç‹¬çš„goç¨‹åºä¸­çš„goroutineã€‚ goroutinieé‡‡ç”¨çš„æ˜¯åŠæŠ¢å å¼çš„åä½œè°ƒåº¦ï¼Œåªæœ‰å½“å½“å‰goroutineå‘ç”Ÿé˜»å¡æ—¶æ‰ä¼šå¯¼è‡´è°ƒåº¦ã€‚ è¿™ç§è°ƒåº¦å‘ç”Ÿåœ¨ç”¨æˆ·æ€ï¼Œè°ƒåº¦å™¨ä¼šæ ¹æ®å…·ä½“å‡½æ•°åªä¿å­˜å¿…è¦çš„å¯„å­˜å™¨ï¼Œåˆ‡æ¢çš„ä»£ä»·æ¯”ç³»ç»Ÿçº¿ç¨‹è¦ä½å¾—å¤šã€‚    åˆ›å»ºå’Œé”€æ¯\n Thread åˆ›å»ºå’Œé”€æ¯€éƒ½ä¼šæœ‰å·¨å¤§çš„æ¶ˆè€—ï¼Œå› ä¸ºè¦å’Œæ“ä½œç³»ç»Ÿæ‰“äº¤é“ï¼Œæ˜¯å†…æ ¸çº§çš„ï¼Œé€šå¸¸è§£å†³çš„åŠæ³•å°±æ˜¯çº¿ç¨‹æ± ã€‚- goroutine å› ä¸ºæ˜¯ç”± Go runtime è´Ÿè´£ç®¡ç†çš„ï¼Œåˆ›å»ºå’Œé”€æ¯çš„æ¶ˆè€—éå¸¸å°ï¼Œæ˜¯ç”¨æˆ·çº§ã€‚    ","permalink":"http://yangchnet.github.io/Dessert/posts/golang/goroutine%E5%92%8C%E7%BA%BF%E7%A8%8B/","summary":"1. çº¿ç¨‹ åœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œè¿›ç¨‹æ˜¯åˆ†é…èµ„æºçš„åŸºæœ¬å•ä½ï¼Œä½†å½“è¿›ç¨‹ä½œä¸ºè°ƒåº¦çš„åŸºæœ¬å•ä½æ—¶ï¼Œä¼šé€ æˆè¾ƒå¤§çš„å¼€é”€ï¼Œé¢‘ç¹çš„è¿›ç¨‹è°ƒåº¦å°†æ¶ˆè€—å¤§é‡æ—¶é—´ã€‚å› æ­¤å¼•å‡ºäº†çº¿ç¨‹ï¼šçº¿ç¨‹æ˜¯å¤„ç†å™¨è°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œçº¿ç¨‹åªæ‹¥æœ‰å¾ˆå°çš„è¿è¡Œæ—¶å¿…è¦çš„èµ„æºã€‚ä¸€ä¸ªè¿›ç¨‹å¯æ‹¥æœ‰å¤šä¸ªçº¿ç¨‹ï¼ŒåŒä¸€ä¸ªè¿›ç¨‹ä¸­çš„æ‰€æœ‰çº¿ç¨‹å…±äº«è¿›ç¨‹è·å¾—çš„ä¸»å­˜ç©ºé—´å’Œèµ„æºã€‚ çº¿ç¨‹çš„å®ç°\næœ‰äº›ç³»ç»ŸåŒæ—¶æ”¯æŒç”¨æˆ·çº¿ç¨‹å’Œå†…æ ¸çº¿ç¨‹ï¼Œç”±æ­¤äº§ç”Ÿäº†ä¸åŒçš„å¤šçº¿ç¨‹æ¨¡å‹ï¼Œå³å®ç°ç”¨æˆ·çº§çº¿ç¨‹ å’Œå†…æ ¸çº§çº¿ç¨‹çš„è¿æ¥æ–¹å¼ï¼šå¤šå¯¹ä¸€æ¨¡å‹ã€ä¸€å¯¹ä¸€æ¨¡å‹ã€å¤šå¯¹å¤šæ¨¡å‹ã€‚\n2. goroutine åœ¨Goè¯­è¨€ä¸­ï¼Œæ¯ä¸€ä¸ªå¹¶å‘çš„æ‰§è¡Œå•å…ƒå«ä½œä¸€ä¸ªgoroutineï¼Œæ˜¯ä¸€ç§è½»é‡çº§çš„çº¿ç¨‹ã€‚\n3. çº¿ç¨‹ä¸goroutineçš„åŒºåˆ«   è¿è¡Œæ—¶æ ˆçš„å¤§å°\n æ¯ä¸ªç³»ç»Ÿçº§çº¿ç¨‹éƒ½ä¼šæœ‰ä¸€ä¸ªå›ºå®šå¤§å°çš„æ ˆï¼ˆä¸€èˆ¬ä¸º2MBï¼‰ï¼Œä¸»è¦ç”¨äºä¿å­˜å‡½æ•°é€’å½’è°ƒç”¨æ—¶å‚æ•°å’Œå±€éƒ¨å˜é‡ã€‚è¿™é€ æˆäº†ä¸¤ä¸ªé—®é¢˜ï¼š  å¯¹äºæŸäº›éœ€è¦å¾ˆå°çš„æ ˆç©ºé—´çš„çº¿ç¨‹æ¥è¯´æ˜¯ä¸€ä¸ªå·¨å¤§çš„æµªè´¹ å¯¹äºå°‘æ•°éœ€è¦å·¨å¤§æ ˆç©ºé—´çš„çº¿ç¨‹æ¥è¯´åˆé¢ä¸´æ ˆæº¢å‡ºçš„é£é™©   goroutineä¼šä»¥ä¸€ä¸ªå¾ˆå°çš„æ ˆå¯åŠ¨ï¼ˆ2KBæˆ–4KBï¼‰ï¼Œå½“é‡åˆ°æ·±åº¦é€’å½’æ—¶å¯¼è‡´å½“å‰æ ˆç©ºé—´ä¸è¶³ï¼Œä¼šæ ¹æ®éœ€è¦åŠ¨æ€çš„ä¼¸ç¼©æ ˆçš„å¤§å°ã€‚    è°ƒåº¦\n goçš„è¿è¡Œæ—¶è¿˜åŒ…æ‹¬äº†å…¶è‡ªå·±çš„è°ƒåº¦å™¨ï¼Œå¯ä»¥åœ¨nä¸ªæ“ä½œç³»ç»Ÿçº¿ç¨‹ä¸Šå¤šå·¥è°ƒåº¦mä¸ªgoroutineï¼ˆç±»ä¼¼äºå¤šçº¿ç¨‹æ¨¡å‹ä¸­çš„å¤šå¯¹å¤šæ¨¡å‹ï¼‰ã€‚ goè°ƒåº¦å™¨çš„å·¥ä½œå’Œå†…æ ¸çš„è°ƒåº¦æ—¶ç›¸ä¼¼çš„ï¼Œä½†æ˜¯è¿™ä¸ªè°ƒåº¦å™¨åªå…³æ³¨å•ç‹¬çš„goç¨‹åºä¸­çš„goroutineã€‚ goroutinieé‡‡ç”¨çš„æ˜¯åŠæŠ¢å å¼çš„åä½œè°ƒåº¦ï¼Œåªæœ‰å½“å½“å‰goroutineå‘ç”Ÿé˜»å¡æ—¶æ‰ä¼šå¯¼è‡´è°ƒåº¦ã€‚ è¿™ç§è°ƒåº¦å‘ç”Ÿåœ¨ç”¨æˆ·æ€ï¼Œè°ƒåº¦å™¨ä¼šæ ¹æ®å…·ä½“å‡½æ•°åªä¿å­˜å¿…è¦çš„å¯„å­˜å™¨ï¼Œåˆ‡æ¢çš„ä»£ä»·æ¯”ç³»ç»Ÿçº¿ç¨‹è¦ä½å¾—å¤šã€‚    åˆ›å»ºå’Œé”€æ¯\n Thread åˆ›å»ºå’Œé”€æ¯€éƒ½ä¼šæœ‰å·¨å¤§çš„æ¶ˆè€—ï¼Œå› ä¸ºè¦å’Œæ“ä½œç³»ç»Ÿæ‰“äº¤é“ï¼Œæ˜¯å†…æ ¸çº§çš„ï¼Œé€šå¸¸è§£å†³çš„åŠæ³•å°±æ˜¯çº¿ç¨‹æ± ã€‚- goroutine å› ä¸ºæ˜¯ç”± Go runtime è´Ÿè´£ç®¡ç†çš„ï¼Œåˆ›å»ºå’Œé”€æ¯çš„æ¶ˆè€—éå¸¸å°ï¼Œæ˜¯ç”¨æˆ·çº§ã€‚    ","title":"goroutineå’Œçº¿ç¨‹"},{"content":"hugoé»˜è®¤ä¸æ”¯æŒlatexå…¬å¼ï¼Œä¸ºäº†åœ¨æˆ‘ä»¬çš„åšå®¢ä¸Šæ˜¾ç¤ºæ•°å­¦å…¬å¼ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨katex.\nä½¿ç”¨æ–¹æ³• å¯¹äºhugoæ¥è¯´ï¼Œæˆ‘ä»¬åªéœ€è¦ä¸ºæ¯ä¸ªé¡µé¢åŠ ä¸Š\n\u0026lt;!-- KaTeX --\u0026gt; \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0-rc.1/katex.min.css\u0026#34;\u0026gt; \u0026lt;script src=\u0026#34;https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0-rc.1/katex.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script src=\u0026#34;https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0-rc.1/contrib/auto-render.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script\u0026gt; document.addEventListener(\u0026#34;DOMContentLoaded\u0026#34;, function() { renderMathInElement(document.body, { delimiters: [ {left: \u0026#34;$$\u0026#34;, right: \u0026#34;$$\u0026#34;, display: true}, {left: \u0026#34;$\u0026#34;, right: \u0026#34;$\u0026#34;, display: false} ] }); }); \u0026lt;/script\u0026gt; å°±è¡Œäº†ã€‚\nå¯ä»¥é€šè¿‡åœ¨themes/{themeName}/layouts/partials/footer.htmlä¸­æ·»åŠ æ¥ä½¿katexåŒ…å«åˆ°æ¯ä¸ªé¡µé¢ä¸­ã€‚\nä¹¦å†™å…¬å¼ è¡Œå†…å…¬å¼å¯ä»¥ä½¿ç”¨$f(x)= \\cos x$æ¥ç¼–è¾‘,æ•ˆæœä¸º$f(x)= \\cos x$ è¡Œé—´å…¬å¼å¯ä½¿ç”¨å¦‚ä¸‹æ ¼å¼ï¼š\n$$\\frac{ x^{2} }{ k+1 }\\qquad$$ æ•ˆæœä¸ºï¼š $$\\frac{ x^{2} }{ k+1 }\\qquad$$\n","permalink":"http://yangchnet.github.io/Dessert/posts/env/hugo%E4%B8%AD%E7%9A%84%E5%85%AC%E5%BC%8F%E9%97%AE%E9%A2%98/","summary":"hugoé»˜è®¤ä¸æ”¯æŒlatexå…¬å¼ï¼Œä¸ºäº†åœ¨æˆ‘ä»¬çš„åšå®¢ä¸Šæ˜¾ç¤ºæ•°å­¦å…¬å¼ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨katex.\nä½¿ç”¨æ–¹æ³• å¯¹äºhugoæ¥è¯´ï¼Œæˆ‘ä»¬åªéœ€è¦ä¸ºæ¯ä¸ªé¡µé¢åŠ ä¸Š\n\u0026lt;!-- KaTeX --\u0026gt; \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0-rc.1/katex.min.css\u0026#34;\u0026gt; \u0026lt;script src=\u0026#34;https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0-rc.1/katex.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script src=\u0026#34;https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0-rc.1/contrib/auto-render.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script\u0026gt; document.addEventListener(\u0026#34;DOMContentLoaded\u0026#34;, function() { renderMathInElement(document.body, { delimiters: [ {left: \u0026#34;$$\u0026#34;, right: \u0026#34;$$\u0026#34;, display: true}, {left: \u0026#34;$\u0026#34;, right: \u0026#34;$\u0026#34;, display: false} ] }); }); \u0026lt;/script\u0026gt; å°±è¡Œäº†ã€‚\nå¯ä»¥é€šè¿‡åœ¨themes/{themeName}/layouts/partials/footer.htmlä¸­æ·»åŠ æ¥ä½¿katexåŒ…å«åˆ°æ¯ä¸ªé¡µé¢ä¸­ã€‚\nä¹¦å†™å…¬å¼ è¡Œå†…å…¬å¼å¯ä»¥ä½¿ç”¨$f(x)= \\cos x$æ¥ç¼–è¾‘,æ•ˆæœä¸º$f(x)= \\cos x$ è¡Œé—´å…¬å¼å¯ä½¿ç”¨å¦‚ä¸‹æ ¼å¼ï¼š\n$$\\frac{ x^{2} }{ k+1 }\\qquad$$ æ•ˆæœä¸ºï¼š $$\\frac{ x^{2} }{ k+1 }\\qquad$$","title":"hugoä¸­çš„å…¬å¼é—®é¢˜"},{"content":"1. æ•°æ®åº“ç³»ç»Ÿçš„ç»“æ„æŠ½è±¡ 1.1 ä¸‰çº§æ¨¡å¼(ä¸‰çº§è§†å›¾)  External Schema \u0026mdash;-ï¼ˆExternalï¼‰View æŸä¸€ç”¨æˆ·èƒ½çœ‹åˆ°ä¸å¤„ç†çš„æ•°æ®çš„ç»“æ„æè¿° (Conceptual) Schema \u0026mdash;- Conceptual View ä»å…¨å±€è§’åº¦ç†è§£/ç®¡ç†çš„æ•°æ®çš„ç»“æ„æè¿°, å«ç›¸åº”çš„å…³è”çº¦æŸã€‚ä½“ç°åœ¨æ•°æ®ä¹‹é—´çš„å†…åœ¨æœ¬è´¨è”ç³» Internal Schema \u0026mdash;- Internal View å­˜å‚¨åœ¨ä»‹è´¨ä¸Šçš„æ•°æ®çš„ç»“æ„æè¿°ï¼Œå«å­˜å‚¨è·¯å¾„ã€å­˜å‚¨æ–¹å¼ ã€ç´¢å¼•æ–¹å¼ç­‰  1.2 ä¸¤å±‚æ˜ åƒ  E-C Mappingï¼šExternal Schema-Conceptual Schema Mapping å°†å¤–æ¨¡å¼æ˜ å°„ä¸ºæ¦‚å¿µæ¨¡å¼ï¼Œä»è€Œæ”¯æŒå®ç°æ•°æ®æ¦‚å¿µè§†å›¾å‘å¤–éƒ¨è§†å›¾çš„è½¬æ¢ï¼Œä¾¿äºç”¨æˆ·è§‚å¯Ÿå’Œä½¿ç”¨ C-I Mappingï¼šConceptual Schema-Internal Schema Mapping å°†æ¦‚å¿µæ¨¡å¼æ˜ å°„ä¸ºå†…æ¨¡å¼ï¼Œä»è€Œæ”¯æŒå®ç°æ•°æ®æ¦‚å¿µè§†å›¾å‘å†…éƒ¨è§†å›¾çš„è½¬æ¢ï¼Œä¾¿äºè®¡ç®—æœºè¿›è¡Œå­˜å‚¨å’Œå¤„ç†  1.3 ä¸¤ä¸ªç‹¬ç«‹æ€§  é€»è¾‘æ•°æ®ç‹¬ç«‹æ€§ å½“æ¦‚å¿µæ¨¡å¼å˜åŒ–æ—¶ï¼Œå¯ä»¥ä¸æ”¹å˜å¤–éƒ¨æ¨¡å¼(åªéœ€æ”¹å˜E-C Mapping)ï¼Œä»è€Œæ— éœ€ æ”¹å˜åº”ç”¨ç¨‹åº ç‰©ç†æ•°æ®ç‹¬ç«‹æ€§ å½“å†…éƒ¨æ¨¡å¼å˜åŒ–æ—¶ï¼Œå¯ä»¥ä¸æ”¹å˜æ¦‚å¿µæ¨¡å¼(åªéœ€æ”¹å˜C-I Mapping) ï¼Œä»è€Œä¸æ”¹ å˜å¤–éƒ¨æ¨¡å¼  1.4 æ•°æ®æ¨¡å‹  æ•°æ®æ¨¡å‹  è§„å®šæ¨¡å¼ç»Ÿä¸€æè¿°æ–¹å¼çš„æ¨¡å‹ï¼ŒåŒ…æ‹¬ï¼šæ•°æ®ç»“æ„ã€æ“ä½œå’Œçº¦æŸ æ•°æ®æ¨¡å‹æ˜¯å¯¹æ¨¡å¼æœ¬èº«ç»“æ„çš„æŠ½è±¡ï¼Œæ¨¡å¼æ˜¯å¯¹æ•°æ®æœ¬èº«ç»“æ„å½¢å¼çš„æŠ½è±¡   ä¸‰å¤§ç»å…¸æ•°æ®æ¨¡å‹  å…³ç³»æ¨¡å‹ï¼šè¡¨çš„å½¢å¼ç»„ç»‡æ•°æ® å±‚æ¬¡æ¨¡å‹ï¼šæ ‘çš„å½¢å¼ç»„ç»‡æ•°æ® ç½‘çŠ¶æ¨¡å‹ï¼šå›¾çš„å½¢å¼ç»„ç»‡æ•°æ®    2. å…³ç³»æ¨¡å‹çš„åŸºæœ¬æ¦‚å¿µ 2.1 å…³ç³»æ¨¡å‹çš„ä¸‰ä¸ªè¦ç´   åŸºæœ¬ç»“æ„  å½¢è±¡åœ°è¯´ï¼Œä¸€ä¸ªå…³ç³»(relation)å°±æ˜¯ä¸€ä¸ªTable Relation/Table\n  åŸºæœ¬æ“ä½œ  åŸºæœ¬çš„\n  å¹¶$\\cup$ å·®ï¼š$-$ å¹¿ä¹‰ç§¯ï¼š$\\times$ é€‰æ‹©: $\\delta$ æŠ•å½±ï¼š$\\pi$   æ‰©å±•çš„\n  äº¤: $\\cap$ è¿æ¥: $\\Join$ é™¤ï¼š$\\div$   å®Œæ•´æ€§çº¦æŸ å®ä½“å®Œæ•´æ€§ã€å‚ç…§å®Œæ•´æ€§å’Œç”¨æˆ·è‡ªå®šä¹‰çš„å®Œæ•´æ€§  2.2 ä»€ä¹ˆæ˜¯å…³ç³» å…³ç³» ç¬›å¡å°”ç§¯ä¸­å…·æœ‰æŸä¸€æ–¹é¢æ„ä¹‰çš„é‚£äº›å…ƒç»„è¢«ç§°ä½œä¸€ä¸ªå…³ç³»\n ç¬›å¡å°”ç§¯çš„æ•°å­¦æè¿°ï¼š $$ä¸€ç»„åŸŸD_1, D_2, \u0026hellip; , D_nçš„ç¬›å¡å°”ç§¯ä¸ºï¼š D_1 \\times D_2 \\times \\cdots \\times D_n = \\lbrace (d_1, d_2, \\cdots, d_n)| d_i\\in D_i,\\ i=1, \\cdots , n \\rbrace$$\n 2.3 å…³ç³»æ¨¡å¼ä¸å…³ç³»  åŒä¸€å…³ç³»æ¨¡å¼ä¸‹ï¼Œå¯æœ‰å¾ˆå¤šçš„å…³ç³» å…³ç³»æ¨¡å¼æ˜¯å…³ç³»çš„ç»“æ„, å…³ç³»æ˜¯å…³ç³»æ¨¡å¼åœ¨æŸä¸€æ—¶åˆ»çš„æ•°æ® å…³ç³»æ¨¡å¼æ˜¯ç¨³å®šçš„ï¼›è€Œå…³ç³»æ˜¯æŸä¸€æ—¶åˆ»çš„å€¼ï¼Œæ˜¯éšæ—¶é—´å¯èƒ½å˜åŒ–çš„  2.4 å…³ç³»ä¸è¡¨çš„å¼‚åŒ å¤§éƒ¨åˆ†æ–¹é¢éƒ½æ˜¯ç›¸åŒçš„ï¼Œä½†å…³ç³»ä¸­ä»»æ„ä¸¤ä¸ªå…ƒç»„ä¸èƒ½å®Œå…¨ç›¸åŒï¼Œè€Œè¡¨å¯èƒ½å¹¶ä¸å®Œå…¨éµå®ˆæ­¤ç‰¹æ€§\n2.5 å…³ç³»çš„ç‰¹æ€§  å…³ç³»çš„ä»»æ„ä¸¤ä¸ªå…ƒç»„ä¸èƒ½å®Œå…¨ç›¸åŒ å±æ€§ä¸å¯å†åˆ†ç‰¹æ€§:åˆè¢«ç§°ä¸ºå…³ç³»ç¬¬ä¸€èŒƒå¼  2.6 å…³ç³»ä¸Šçš„ä¸€äº›é‡è¦æ¦‚å¿µ å€™é€‰ç /å€™é€‰é”® å…³ç³»ä¸­çš„ä¸€ä¸ªå±æ€§ç»„ï¼Œå…¶å€¼èƒ½å”¯ä¸€æ ‡è¯†ä¸€ä¸ªå…ƒç»„ï¼Œè‹¥ä»è¯¥å±æ€§ç»„ä¸­å»æ‰ä»»ä½•ä¸€ä¸ªå±æ€§ï¼Œå®ƒå°±ä¸å…·æœ‰è¿™ä¸€æ€§è´¨äº†ï¼Œè¿™æ ·çš„å±æ€§ç»„ç§°ä½œå€™é€‰ç ã€‚\nä¸»ç /ä¸»é”® å½“æœ‰å¤šä¸ªå€™é€‰ç æ—¶ï¼Œå¯ä»¥é€‰å®šä¸€ä¸ªä½œä¸ºä¸»ç ã€‚\nä¸»å±æ€§å’Œéä¸»å±æ€§ åŒ…å«åœ¨ä»»ä½•ä¸€ä¸ªå€™é€‰ç ä¸­çš„å±æ€§è¢«ç§°ä½œä¸»å±æ€§ï¼Œè€Œå…¶ä»–å±æ€§è¢«ç§°ä½œéä¸»å±æ€§\n æœ€ç®€å•çš„ï¼Œå€™é€‰ç åªåŒ…å«ä¸€ä¸ªå±æ€§ æœ€æç«¯çš„ï¼Œæ‰€æœ‰å±æ€§æ„æˆè¿™ä¸ªå…³ç³»çš„å€™é€‰ç ï¼Œç§°ä¸ºå…¨ç (All-Key)\n å¤–ç /å¤–é”® å…³ç³»Rä¸­çš„ä¸€ä¸ªå±æ€§ç»„ï¼Œå®ƒä¸æ˜¯Rçš„å€™é€‰ç ï¼Œä½†å®ƒä¸å¦ä¸€ä¸ªå…³ç³»Sçš„å€™é€‰ ç ç›¸å¯¹åº”ï¼Œåˆ™ç§°è¿™ä¸ªå±æ€§ç»„ä¸ºRçš„å¤–ç æˆ–å¤–é”®ã€‚\n ä¸¤ä¸ªå…³ç³»é€šå¸¸æ˜¯é å¤–ç è¿æ¥èµ·æ¥çš„ã€‚\n 2.3 å…³ç³»æ¨¡å‹çš„å®Œæ•´æ€§   å®ä½“å®Œæ•´æ€§\nå…³ç³»çš„ä¸»ç ä¸­çš„å±æ€§å€¼ä¸èƒ½ä¸ºç©ºå€¼ï¼› ç©ºå€¼ï¼šä¸çŸ¥é“æˆ–æ— æ„ä¹‰çš„å€¼\næ„ä¹‰ï¼šå…³ç³»ä¸­çš„å…ƒç»„å¯¹åº”åˆ°ç°å®ä¸–ç•Œç›¸äº’ä¹‹é—´å¯åŒºåˆ†çš„ä¸€ä¸ªä¸ªä¸ª ä½“ï¼Œè¿™äº›ä¸ªä½“æ˜¯é€šè¿‡ä¸»ç æ¥å”¯ä¸€æ ‡è¯†çš„ï¼›è‹¥ä¸»ç ä¸ºç©ºï¼Œåˆ™å‡ºç°ä¸å¯æ ‡è¯† çš„ä¸ªä½“ï¼Œè¿™æ˜¯ä¸å®¹è®¸çš„\n  å‚ç…§å®Œæ•´æ€§ï¼ˆå¯¹å¤–ç è€Œè¨€ï¼‰ å¦‚æœå…³ç³»R1çš„å¤–ç Fkä¸å…³ç³»R2çš„ä¸» ç Pkç›¸å¯¹åº”ï¼Œåˆ™R1ä¸­çš„æ¯ä¸€ä¸ªå…ƒç»„çš„ Fkå€¼æˆ–è€…ç­‰äºR2 ä¸­æŸä¸ªå…ƒç»„çš„Pk å€¼ï¼Œ æˆ–è€…ä¸ºç©ºå€¼\n  ç”¨æˆ·è‡ªå®šä¹‰å®Œæ•´æ€§\nç”¨æˆ·é’ˆå¯¹å…·ä½“çš„åº”ç”¨ç¯å¢ƒå®šä¹‰çš„å®Œæ•´æ€§çº¦æŸæ¡ä»¶\n   å®ä½“å®Œæ•´æ€§å’Œå‚ç…§å®Œæ•´æ€§ç”±DBMSç³»ç»Ÿè‡ªåŠ¨æ”¯æŒ DBMSç³»ç»Ÿé€šå¸¸æä¾›äº†å¦‚ä¸‹æœºåˆ¶ï¼š  (1)å®ƒä½¿ç”¨æˆ·å¯ä»¥è‡ªè¡Œå®šä¹‰æœ‰å…³çš„å®Œæ•´æ€§çº¦æŸæ¡ä»¶ (2)å½“æœ‰æ›´æ–°æ“ä½œå‘ç”Ÿæ—¶ï¼ŒDBMSå°†è‡ªåŠ¨æŒ‰ç…§å®Œæ•´æ€§çº¦æŸæ¡ä»¶æ£€éªŒæ›´æ–°æ“ä½œçš„æ­£ç¡®æ€§ï¼Œå³æ˜¯å¦ç¬¦åˆç”¨æˆ·è‡ªå®šä¹‰çš„å®Œæ•´æ€§    3. å…³ç³»ä»£æ•° 3.1 å…³ç³»ä»£æ•°æ“ä½œ é›†åˆæ“ä½œå’Œçº¯å…³ç³»æ“ä½œ\n3.2 å…³ç³»ä»£æ•°åŸºæœ¬æ“ä½œ 3.2.1 å…³ç³»ä»£æ•°è¿ç®—çš„çº¦æŸ  å¹¶ç›¸å®¹æ€§\nå…³ç³»Rä¸å…³ç³»Så­˜åœ¨ç›¸å®¹æ€§ï¼Œå½“ä¸”ä»…å½“ï¼š\n(1) å…³ç³»Rå’Œå…³ç³»Sçš„å±æ€§æ•°ç›®å¿…é¡»ç›¸åŒï¼›\n(2) å¯¹äºä»»æ„iï¼Œå…³ç³»Rçš„ç¬¬iä¸ªå±æ€§çš„åŸŸå¿…é¡»å’Œå…³ç³»Sçš„ç¬¬iä¸ªå±æ€§çš„åŸŸç›¸åŒ  3.2.2 å…³ç³»ä»£æ•°çš„æ“ä½œ  å¹¶$\\vee$(è¦æ»¡è¶³å¹¶ç›¸å®¹æ€§)\næ•°å­¦æè¿°ï¼š $$R\\vee S= \\lbrace t|t\\in R \\vee t \\in S \\rbrace$$ å·®$-$(è¦æ»¡è¶³å¹¶ç›¸å®¹æ€§)\næ•°å­¦æè¿°ï¼š $$R-S=\\lbrace t| t \\in R \\land t \\notin S \\rbrace$$ å¹¿ä¹‰ç¬›å¡å°”ç§¯æ“ä½œ\næ•°å­¦æè¿°ï¼š $$å…³ç³»R\u0026lt; a_1, a_2, \\cdots , a_n\u0026gt;, å…³ç³»S\u0026lt;b_1, b_2, \\cdots , b_n\u0026gt;, åˆ™ \\ R \\times S = \\lbrace \u0026lt;a_1, a_2, \\cdots , a_n, b_1, b_2, \\cdots , b_n\u0026gt; | \u0026lt;a_1, a_2, \\cdots , a_n\u0026gt; \\in R \\land \u0026lt;b_1, b_2, \\cdots , b_n\u0026gt; \\in S \\rbrace$$ é€‰æ‹©æ“ä½œ\næ•°å­¦æè¿°ï¼š $$\\delta _{con}(R)=\\lbrace t | t \\in R \\land con(t) = true \\rbrace$$ æŠ•å½±\næ•°å­¦æè¿°ï¼š $$\\Pi_{a_{i1}, a_{i2}, \\cdots, a_{ik}}(R) = \\lbrace \u0026lt;t[A_{i1}],t[A_{i2}], \\cdots , t[A_{ik}]\u0026gt; | t \\in R \\rbrace$$ **ç¤ºä¾‹**\n  3.3 å…³ç³»ä»£æ•°æ‰©å±•æ“ä½œ   äº¤\næ•°å­¦æè¿°ï¼š\n$$R \\cap S= \\lbrace t|t\\in R \\land t \\in S \\rbrace$$\n  $\\theta$-è¿æ¥\nç¬¬ä¸€æ­¥ï¼šå¯¹ä¸¤ä¸ªè¡¨è¿›è¡Œå¹¿ä¹‰ç¬›å¡å°”ç§¯\nç¬¬äºŒæ­¥ï¼šä»å¹¿ä¹‰ç¬›å¡å°”ç§¯ä¸­é€‰å–å‡ºç¬¦åˆæ¡ä»¶çš„å…ƒç»„\næ•°å­¦æè¿°ï¼š $$R \\underset{A \\theta B} \\Join S = \\delta_{t[A] \\theta s[B]}(R\\times B)$$\nå…¶ä¸­$\\theta$æ˜¯æ¯”è¾ƒè¿ç®—ç¬¦\n ä¾‹å­\n æŸ¥è¯¢è‡³å°‘98030101å·åŒå­¦å’Œ98040202å·åŒå­¦å­¦è¿‡çš„æ‰€æœ‰è¯¾ç¨‹å·\næ•°å­¦æè¿°ï¼š $$\\pi_{SC.C}(\\delta_{SC.S=\u0026ldquo;98030101\u0026rdquo;\\land SC1.S=\u0026ldquo;98040202\u0026rdquo;}(SC \\underset{SC.C=SC1.C} \\Join \\rho_{SC1} (SC)) $$\nå…¶ä¸­$\\rho$ä»£è¡¨æ›´åæ“ä½œ\n  ç­‰å€¼è¿æ¥\nç»™å®šå…³ç³»Rå’Œå…³ç³»S, Rä¸Sçš„ç­‰å€¼è¿æ¥è¿ç®—ç»“æœä¹Ÿæ˜¯ä¸€ä¸ªå…³ç³»ï¼Œ è®°ä½œ$R \\underset{A=B} \\Join S$ï¼Œå®ƒç”±å…³ç³»Rå’Œå…³ç³»Sçš„ç¬›å¡å°”ç§¯ä¸­é€‰å–Rä¸­å±æ€§Aä¸Sä¸­å±æ€§ Bä¸Šå€¼ç›¸ç­‰çš„å…ƒç»„æ‰€æ„æˆã€‚ æ•°å­¦æè¿°ï¼š\n$$R \\underset{A=B}\\Join S = \\delta_{t[A]=s[B]}(R\\times S)$$ å½“$\\theta$-è¿æ¥ä¸­è¿ç®—ç¬¦ä¸ºâ€œï¼â€æ—¶ï¼Œå°±æ˜¯ç­‰å€¼è¿æ¥ï¼Œç­‰å€¼è¿æ¥æ˜¯$\\theta$-è¿æ¥çš„ä¸€ä¸ªç‰¹ä¾‹ï¼›   è‡ªç„¶è¿æ¥\nç»™å®šå…³ç³»Rå’Œå…³ç³»S, Rä¸Sçš„è‡ªç„¶è¿æ¥è¿ç®—ç»“æœä¹Ÿæ˜¯ä¸€ä¸ªå…³ç³»ï¼Œè®°ä½œ$R \\Join S$ ï¼Œå®ƒç”±å…³ç³»Rå’Œå…³ç³»Sçš„ç¬›å¡å°”ç§¯ä¸­é€‰å–ç›¸åŒå±æ€§ç»„Bä¸Šå€¼ç›¸ç­‰çš„å…ƒ ç»„æ‰€æ„æˆã€‚\næ•°å­¦æè¿°ï¼š $$R \\Join S = \\delta_{t[B]=s[B]}(R\\times S)$$\næ˜¯ä¸€ç§ç‰¹æ®Šçš„ç­‰å€¼è¿æ¥\nè¦æ±‚å…³ç³»Rå’ŒSå¿…é¡»æœ‰ç›¸åŒçš„å±æ€§ç»„B\n  3.4 å…³ç³»ä»£æ•°çš„å¤æ‚æ“ä½œ   é™¤æ“ä½œ$\\div$\nå‰ææ¡ä»¶\nè‹¥$R(A_1, A_2, \\cdots,A_n)$ä¸ºnåº¦å…³ç³»ï¼Œå…³ç³»$S(B_1, B_2, \\cdots, B_n)$ä¸ºmåº¦å…³ç³»ï¼Œåªæœ‰å½“$\\lbrace B_1, B_2, \\cdots, B_n\\rbrace \\subseteq \\lbrace A_1, A_2, \\cdots,A_n \\rbrace $å³Bæ˜¯Açš„çœŸå­é›†ï¼Œ$m\u0026lt;n$æ—¶æ‰å¯è¿›è¡Œ$R\\div S$è¿ç®—\nå®šä¹‰\nè®¾å…³ç³»$R\u0026lt;a_1, \\cdots, a_n\u0026gt;$å’Œå…³ç³»$S\u0026lt;b_1, \\cdots, b_m\u0026gt;$,é‚£ä¹ˆ$R\\div S$ç»“æœä¸ºå…³ç³»ä¸ºå…ƒç»„$\u0026lt;c_1, \\cdots, c_k\u0026gt;$çš„é›†åˆï¼Œå…ƒç»„$\u0026lt;c_1, \\cdots, c_k\u0026gt;$æ»¡è¶³ä¸‹è¿°æ¡ä»¶:å®ƒä¸Sä¸­æ¯ä¸€ä¸ªå…ƒç»„$\u0026lt;b_1, \\cdots, b_m\u0026gt;$ç»„åˆå½¢æˆçš„ä¸€ä¸ªæ–°å…ƒç»„éƒ½æ˜¯Rä¸­çš„æŸä¸€ä¸ªå…ƒç»„$\u0026lt;a_1, \\cdots, a_n\u0026gt;$\nç¤ºä¾‹ å¤–è¿æ¥ï¼ˆOuter-Joinï¼‰ å®šä¹‰\nä¸¤ä¸ªå…³ç³»Rä¸Sè¿›è¡Œè¿æ¥æ—¶ï¼Œå¦‚æœå…³ç³»R(æˆ–S)ä¸­çš„å…ƒç»„åœ¨S(æˆ–R)ä¸­æ‰¾ä¸åˆ°ç›¸åŒ¹é…çš„å…ƒç»„ï¼Œåˆ™ä¸ºäº†é¿å…è¯¥å…ƒç»„ä¿¡æ¯ä¸¢å¤±ï¼Œä»è€Œå°†è¯¥å…ƒç»„ä¸S(æˆ–R)ä¸­ å‡å®šå­˜åœ¨çš„å…¨ä¸ºç©ºå€¼çš„å…ƒç»„å½¢æˆè¿æ¥ï¼Œæ”¾ç½®åœ¨ç»“æœå…³ç³»ä¸­ï¼Œè¿™ç§è¿æ¥ç§°ä¹‹ä¸ºå¤–è¿æ¥(Outer Join)ã€‚\nå¤–è¿æ¥ = è‡ªç„¶è¿æ¥ (æˆ–$\\theta$è¿æ¥) + å¤±é…çš„å…ƒç»„(ä¸å…¨ç©ºå…ƒç»„å½¢æˆçš„è¿æ¥)\nå¤–è¿æ¥çš„å½¢å¼   å·¦å¤–è¿æ¥ = è‡ªç„¶è¿æ¥(æˆ–$\\theta$è¿æ¥) + å·¦ä¾§è¡¨ä¸­å¤±é…çš„å…ƒç»„ã€‚ è®°ä½œ$âŸ•$  å³å¤–è¿æ¥ = è‡ªç„¶è¿æ¥(æˆ–$\\theta$è¿æ¥) + å³ä¾§è¡¨ä¸­å¤±é…çš„å…ƒç»„ã€‚ è®°ä½œ $âŸ–$\n å…¨å¤–è¿æ¥ = è‡ªç„¶è¿æ¥(æˆ–$\\theta$è¿æ¥) + ä¸¤ä¾§è¡¨ä¸­å¤±é…çš„å…ƒç»„ã€‚ è®°ä½œ$âŸ—$\n    4. å…³ç³»æ¼”ç®—  å…³ç³»å…ƒç»„æ¼”ç®—  ä»¥å…ƒç»„å˜é‡ä½œä¸ºè°“è¯å˜é‡çš„åŸºæœ¬å¯¹è±¡\n  å…³ç³»åŸŸæ¼”ç®—  ä»¥åŸŸå˜é‡ä½œä¸ºè°“è¯å˜é‡çš„åŸºæœ¬å¯¹è±¡\n   4.1 å…³ç³»å…ƒç»„æ¼”ç®— åŸºæœ¬å½¢å¼\n$$\\lbrace t | P(t)\\rbrace$$\nå…¶ä¸­ï¼Œ$P(t)$å¯ä»¥æ˜¯å¦‚ä¸‹ä¸‰ç§å½¢å¼ä¹‹ä¸€çš„åŸå­å…¬å¼ï¼š\n $t\\in R$ $s[A] \\theta c$\nå…¶ä¸­$\\theta$ä¸ºæ¯”è¾ƒè¿ç®—ç¬¦$\u0026lt;, \\le, \\ge, \u0026gt;, \\ne$\nä¾‹å¦‚$\\lbrace t| t\\in R \\land t[Sage]\\le 19 \\land t[Sname] = \u0026lsquo;Bob\u0026rsquo;\\rbrace$ $s[A] \\theta u[B]$\ns[A]ä¸u[B]ä¸ºå…ƒç»„åˆ†é‡ï¼ŒAå’ŒBåˆ†åˆ«æ˜¯æŸäº›å…³ç³»çš„å±æ€§ï¼Œä»–ä»¬ä¹‹é—´æ»¡è¶³æ¯”è¾ƒå…³ç³»$\\theta$\nä¾‹å¦‚ï¼šæ£€ç´¢é™¤å¹´é¾„ä¸æ˜¯æœ€å°çš„æ‰€æœ‰åŒå­¦\n$\\lbrace t|t\\in Student \\land \\exist (u \\in Student)(t[Sage]\u0026gt;u[Sage])\\rbrace$\n  4.2 å…³ç³»åŸŸæ¼”ç®— \u0026hellip;\nå…³ç³»æ•°æ®åº“ä¸­çš„èŒƒå¼  ç¬¬ä¸€èŒƒå¼ï¼ˆ1NFï¼‰\nå…³ç³»çš„æ¯ä¸€ä¸ªåˆ†é‡éƒ½æ˜¯ä¸å¯åˆ†çš„æ•°æ®é¡¹ ç¬¬äºŒèŒƒå¼ï¼ˆ2NFï¼‰\nè‹¥$R\\in 1NF$,ä¸”æ¯ä¸€ä¸ªéä¸»å±æ€§å®Œå…¨å‡½æ•°ä¾èµ–äºä»»ä½•ä¸€ä¸ªå€™é€‰ç ï¼Œåˆ™$R\\in 2NF$ ç¬¬ä¸‰èŒƒå¼ï¼ˆ3NFï¼‰\nè®¾å…³ç³»æ¨¡å¼$R\u0026lt;U,F\u0026gt;\\in 1NF$, è‹¥Rä¸­ä¸å­˜åœ¨è¿™æ ·çš„ç Xï¼Œå±æ€§ç»„YåŠéä¸»å±æ€§$Z(Z\\nsubseteq Y)$ï¼Œä½¿å¾—$X\\rightarrow Y, Y \\rightarrow Z$æˆç«‹ï¼Œ$Y\\nrightarrow X$, åˆ™ç§°$R\u0026lt;U,F\u0026gt;\\in 3NF$ã€‚ç”¨äººè¯è¯´å°±æ˜¯ï¼Œè‹¥$R\\in 3NF$,åˆ™æ¯ä¸€ä¸ªéä¸»å±æ€§æ—¢ä¸ä¼ é€’ä¾èµ–äºç ï¼Œä¹Ÿä¸éƒ¨åˆ†ä¾èµ–äºç ã€‚ BCèŒƒå¼ å…³ç³»æ¨¡å¼$R\u0026lt;U,F\u0026gt;\\in1NF$,è‹¥$X\\rightarrow Y$ä¸”$Y\\nsubseteq X$æ—¶å¿…å«æœ‰ç ï¼Œåˆ™$R\u0026lt;U,F\u0026gt;\\in BCNF$ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå…³ç³»æ¨¡å¼$R\u0026lt;U,F\u0026gt;$ä¸­ï¼Œè‹¥æ¯ä¸€ä¸ªå†³å®šå› ç´ éƒ½åŒ…å«ç ï¼Œåˆ™$R\u0026lt;U,F\u0026gt;\\in BCNF$\nä¸€ä¸ªæ»¡è¶³BCNFçš„å…³ç³»æ¨¡å¼æœ‰ï¼š  æ‰€æœ‰éä¸»å±æ€§å¯¹æ¯ä¸€ä¸ªç éƒ½æ˜¯å®Œå…¨å‡½æ•°ä¾èµ– æ‰€æœ‰ä¸»å±æ€§å¯¹æ¯ä¸€ä¸ªä¸åŒ…å«å®ƒçš„ç ä¹Ÿæ˜¯å®Œå…¨å‡½æ•°ä¾èµ– æ²¡æœ‰ä»»ä½•å±æ€§å®Œå…¨å‡½æ•°ä¾èµ–äºéç çš„ä»»ä½•ä¸€ç»„å±æ€§    ","permalink":"http://yangchnet.github.io/Dessert/posts/%E6%9D%82%E8%AE%B0/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8E%9F%E7%90%86/","summary":"1. æ•°æ®åº“ç³»ç»Ÿçš„ç»“æ„æŠ½è±¡ 1.1 ä¸‰çº§æ¨¡å¼(ä¸‰çº§è§†å›¾)  External Schema \u0026mdash;-ï¼ˆExternalï¼‰View æŸä¸€ç”¨æˆ·èƒ½çœ‹åˆ°ä¸å¤„ç†çš„æ•°æ®çš„ç»“æ„æè¿° (Conceptual) Schema \u0026mdash;- Conceptual View ä»å…¨å±€è§’åº¦ç†è§£/ç®¡ç†çš„æ•°æ®çš„ç»“æ„æè¿°, å«ç›¸åº”çš„å…³è”çº¦æŸã€‚ä½“ç°åœ¨æ•°æ®ä¹‹é—´çš„å†…åœ¨æœ¬è´¨è”ç³» Internal Schema \u0026mdash;- Internal View å­˜å‚¨åœ¨ä»‹è´¨ä¸Šçš„æ•°æ®çš„ç»“æ„æè¿°ï¼Œå«å­˜å‚¨è·¯å¾„ã€å­˜å‚¨æ–¹å¼ ã€ç´¢å¼•æ–¹å¼ç­‰  1.2 ä¸¤å±‚æ˜ åƒ  E-C Mappingï¼šExternal Schema-Conceptual Schema Mapping å°†å¤–æ¨¡å¼æ˜ å°„ä¸ºæ¦‚å¿µæ¨¡å¼ï¼Œä»è€Œæ”¯æŒå®ç°æ•°æ®æ¦‚å¿µè§†å›¾å‘å¤–éƒ¨è§†å›¾çš„è½¬æ¢ï¼Œä¾¿äºç”¨æˆ·è§‚å¯Ÿå’Œä½¿ç”¨ C-I Mappingï¼šConceptual Schema-Internal Schema Mapping å°†æ¦‚å¿µæ¨¡å¼æ˜ å°„ä¸ºå†…æ¨¡å¼ï¼Œä»è€Œæ”¯æŒå®ç°æ•°æ®æ¦‚å¿µè§†å›¾å‘å†…éƒ¨è§†å›¾çš„è½¬æ¢ï¼Œä¾¿äºè®¡ç®—æœºè¿›è¡Œå­˜å‚¨å’Œå¤„ç†  1.3 ä¸¤ä¸ªç‹¬ç«‹æ€§  é€»è¾‘æ•°æ®ç‹¬ç«‹æ€§ å½“æ¦‚å¿µæ¨¡å¼å˜åŒ–æ—¶ï¼Œå¯ä»¥ä¸æ”¹å˜å¤–éƒ¨æ¨¡å¼(åªéœ€æ”¹å˜E-C Mapping)ï¼Œä»è€Œæ— éœ€ æ”¹å˜åº”ç”¨ç¨‹åº ç‰©ç†æ•°æ®ç‹¬ç«‹æ€§ å½“å†…éƒ¨æ¨¡å¼å˜åŒ–æ—¶ï¼Œå¯ä»¥ä¸æ”¹å˜æ¦‚å¿µæ¨¡å¼(åªéœ€æ”¹å˜C-I Mapping) ï¼Œä»è€Œä¸æ”¹ å˜å¤–éƒ¨æ¨¡å¼  1.4 æ•°æ®æ¨¡å‹  æ•°æ®æ¨¡å‹  è§„å®šæ¨¡å¼ç»Ÿä¸€æè¿°æ–¹å¼çš„æ¨¡å‹ï¼ŒåŒ…æ‹¬ï¼šæ•°æ®ç»“æ„ã€æ“ä½œå’Œçº¦æŸ æ•°æ®æ¨¡å‹æ˜¯å¯¹æ¨¡å¼æœ¬èº«ç»“æ„çš„æŠ½è±¡ï¼Œæ¨¡å¼æ˜¯å¯¹æ•°æ®æœ¬èº«ç»“æ„å½¢å¼çš„æŠ½è±¡   ä¸‰å¤§ç»å…¸æ•°æ®æ¨¡å‹  å…³ç³»æ¨¡å‹ï¼šè¡¨çš„å½¢å¼ç»„ç»‡æ•°æ® å±‚æ¬¡æ¨¡å‹ï¼šæ ‘çš„å½¢å¼ç»„ç»‡æ•°æ® ç½‘çŠ¶æ¨¡å‹ï¼šå›¾çš„å½¢å¼ç»„ç»‡æ•°æ®    2.","title":"æ•°æ®åº“åŸç†"},{"content":"0. å¤è¯•è‹±è¯­è€ƒè¯•å½¢å¼  è‡ªæˆ‘ä»‹ç»+è€å¸ˆæé—®ï¼ˆpopularï¼‰ å¬ä¸€æ®µæ–‡ç« å†…å®¹ï¼Œå¬å®Œåå›ç­”ï¼ˆå°‘ï¼‰ å°ç»„è®¨è®ºï¼ˆå°‘ï¼‰  1. è‡ªæˆ‘ä»‹ç» ä¸€å®šä¸è¦è¯´ï¼šæˆ‘çš„è‹±è¯­å¾ˆç³Ÿç³•, My English is very poor!\n ç›®çš„æ˜¯ï¼š è¡¨è¾¾æˆ‘é…ä¸Šç ”ç©¶ç”Ÿ\n  å…ˆè¯´å§“åï¼ˆå¾®ç¬‘è„¸ï¼‰ï¼Œå¹´é¾„ï¼Œå­¦æ ¡ å¤§å­¦å–å¾—çš„æˆç»©ï¼ˆæ²¡æœ‰æˆç»©å¯ä»¥ç¼–\u0026hellip; ç¼–ç‚¹æ— ä»è€ƒè¯çš„ï¼Œæ¯”å¦‚å®¶æ•™å•¥çš„ï¼‰ å†è¯´æ€§æ ¼çˆ±å¥½(ç¨å¾®ä¸¤å¥è¯ææ)ï¼Œå°½é‡å’Œä¸“ä¸šè”ç³»åˆ°ä¸€èµ·ã€‚ That\u0026rsquo;s all, thanks you very much. If I were admitted, I will go all out to learn my professional knowledge.é™¤äº†å­¦ä¹ â‘ ä¸“ä¸šçŸ¥è¯†ï¼Œæˆ‘ä¸€å®šä¼šåŠ å¼ºæˆ‘çš„â‘¡å®è·µèƒ½åŠ›ï¼Œæˆ‘è¿˜è¦å­¦ä¼šâ‘¢æ›´å¥½çš„å’Œå¯¼å¸ˆå’ŒåŒå­¦ä¹‹é—´è¿›è¡Œåˆä½œã€‚Please trusted me.(ä¸è¦è¶…è¿‡ä¸‰åˆ†é’Ÿ)  2. è€å¸ˆå¸¸é—®çš„9ä¸ªé—®é¢˜  ä½ ä¸ºä»€ä¹ˆè€ƒç ”ï¼Œä¸ºä»€ä¹ˆé€‰æ‹©è¿™ä¸ªä¸“ä¸šï¼Ÿ  ä¸€å®šä¸è¦è¯´æœ¬ç§‘å­¦æ ¡åè¯ï¼Œ ä¸è¦è¯´æˆ‘è¦æŒ£é’±.. ä¹Ÿä¸è¦è¯´ä¸ºäº†ä¸­åä¹‹å´›èµ·.. æˆ‘çœŸå¿ƒå–œæ¬¢æˆ‘çš„ä¸“ä¸šğŸ˜Š(ä¸¾ä¸ªä¾‹å­æ€ä¹ˆæ„Ÿå…´è¶£çš„) æˆ‘é—æ†¾è‡ªå·±ä»¥å‰æ²¡æœ‰å¥½å¥½å­¦ä¹ ï¼Œåœ¨åˆ«äººé€‰æ‹©å·¥ä½œçš„æ—¶å€™æˆ‘å†³å®šè€ƒç ”æå‡è‡ªå·± ç»ˆæç­”æ¡ˆæ˜¯å–œæ¬¢   ä½ å¯¹æœªæ¥æœ‰ä»€ä¹ˆè§„åˆ’ï¼Ÿ  3å¹´ç ”ç©¶ç”Ÿçš„è§„åˆ’å’Œç ”ç©¶ç”Ÿåˆšæ¯•ä¸šçš„è§„åˆ’ï¼Œå¤ªè¿œä¸è¦è¯´ ç ”ç©¶ç”Ÿå…¥æ ¡åï¼Œä¸€å®šè·Ÿè€å¸ˆå¥½å¥½å­¦ä¹ ä¸“ä¸šçŸ¥è¯†ï¼ŒååŠ©å¯¼å¸ˆï¼Œäº‰å–è‡ªå·±æ—©æ—¥å‘è¡¨è®ºæ–‡ï¼Œæœ‰æœºä¼šè€ƒåšï¼ŒåŸ¹å…»è‡ªå·±çš„å®è·µèƒ½åŠ›ï¼Œåˆä½œèƒ½åŠ›ï¼Œä¸äººç›¸å¤„èƒ½åŠ›ã€‚æ¯•ä¸šåæ‰¾ä¸€ä»½è‡ªå·±å–œæ¬¢çš„å·¥ä½œï¼Œåœ¨è‡ªå·±çš„å²—ä½ä¸Šåšå‡ºè´¡çŒ®ã€‚ï¼ˆä¸€å®šè¦é…åˆå¯¼å¸ˆï¼‰   ä»‹ç»ä½ çš„å®¶ä¹¡  é¦–å…ˆè¦è¯´æˆ‘çˆ±çš„å®¶ä¹¡ï¼ˆæ€€æœ‰ä¸€é¢—æ„Ÿæ©çš„å¿ƒï¼‰ è¯´ç‚¹åäººå’Œç‰¹äº§ï¼ˆæœ‰å¾ˆå¤šå¯ä»¥such asï¼Œç„¶åé‡ç‚¹è¯´ä¸€ä¸ªï¼‰ æœ€åå†è¯´ï¼Œæ¬¢è¿è€å¸ˆåˆ°æˆ‘çš„å®¶ä¹¡å»æ—…æ¸¸   ä»‹ç»ä½ çš„å®¶åº­  å…ˆè¯´å‡ å£äºº å¯¹æˆ‘çš„äººç”Ÿäº§ç”Ÿæœ€å¤§çš„å½±å“æ˜¯è°ï¼ˆä¸¾ä¸ªæ —å­(ã€ƒï¿£ï¸¶ï¿£)äººï¼‰   ä»‹ç»ä½ çš„æœ¬ç§‘å­¦æ ¡  ä¸€ä¸ªå­—ï¼Œå¥½ å­¦æ ¡æœ‰å†å²ã€å°±ä¸šç‡å¥½ã€æœ‰åæ°”ï¼ˆè€å¸ˆä½ å¯èƒ½ä»æ¥æ²¡å¬è¿‡è¿™ä¸ªåå­—ï¼Œä½†æ˜¯æˆ‘éå¸¸çƒ­çˆ±å®ƒï¼‰ è™½ç„¶æˆ‘çš„å­¦æ ¡ä¸æ˜¯é‚£ä¹ˆæœ‰åæ°”ï¼Œä½†æ˜¯æˆ‘ä¾ç„¶ç»“åˆ°äº†å¾ˆå¤šæœ‹å‹ï¼Œç»™æˆ‘äº†å¾ˆå¤šæ¸©æš–   å¯¹è‹±è¯­çš„æ€åº¦ï¼Œå…³äºè‹±è¯­ä½ æ€ä¹ˆçœ‹  å–œæ¬¢ï¼Œæ„Ÿå…´è¶£ ä»¥å‰å¯¹è‹±è¯­æ²¡é‚£ä¹ˆæ„Ÿå…´è¶£ï¼Œåªæ˜¯ä¸€é—¨è¯¾ åæ¥å‘ç°è‹±è¯­çœŸä»–å¨˜é‡è¦ï¼Œæ„è¯†åˆ°å­¦è‹±è¯­çš„é‡è¦æ€§ åœ¨ç ”ç©¶ç”ŸæœŸé—´æ›´åŠ ä¸“æ³¨å¯¹è‹±è¯­çš„å­¦ä¹  æˆ‘çš„å£è¯­æ²¡æœ‰é‚£ä¹ˆå¥½ï¼Œä½†æ˜¯æˆ‘å¸Œæœ›åœ¨ç ”ç©¶ç”ŸæœŸé—´å¯ä»¥æœ‰é•¿è¶³çš„è¿›æ­¥   ä½ å¯¹æˆ‘ä»¬å­¦æ ¡å’Œä¸“ä¸šäº†è§£å¤šå°‘  é¦–å…ˆï¼Œå­¦æ ¡åæ°”å¤§ï¼ˆæ¯‹åº¸ç½®ç–‘ï¼‰ å…¶æ¬¡ï¼Œå¯¹æˆ‘ä»¬å­¦é™¢ç›¸å½“æœ‰äº†è§£ï¼Œå¯¹æ•™æˆäº†è§£ï¼ˆæä¸€ä¸‹æ•™æˆçš„åå­—ï¼‰ å¸ˆèµ„åŠ›é‡ï¼Œè‘—ä½œ   ä½ çš„ä¼˜ç‚¹å’Œç¼ºç‚¹  ä¼˜ç‚¹å¯ä»¥å’Œä¸“ä¸šç›¸å…³ï¼Œä½†æ˜¯ç¼ºç‚¹ä¸è¡Œ æˆ‘å–œæ¬¢äº¤æœ‹å‹\u0026hellip; ç¼–\u0026hellip;ï¼ˆç»™çˆ·çˆ¬ï¼‰â‰¡(â–”ï¹â–”)â‰¡   ä¸ºä»€ä¹ˆæ¢ä¸“ä¸šï¼ˆç»™è·¨è€ƒï¼‰  \u0026hellip;    3. æ³¨æ„äº‹é¡¹  å¬ä¸æ‡‚æ€ä¹ˆåŠ  æå‰å‡†å¤‡å¯ä»¥å¬æ‡‚ pardonä¸€ä¸‹ã€‚ã€‚   æå‰æ‰¾å¸ˆå…„å¸ˆå§  è´«åƒ§è‡ªä¸œåœŸå¤§å”è€Œæ¥ï¼Œå¾€è¥¿å¤©å–ç»è€Œå»ã€‚ã€‚ å¸¦ç‚¹ç‰¹äº§ï¼Œé€é€ç¤¼   ç©¿ä»€ä¹ˆ  ä¸ç”¨ç©¿è¥¿è£…æ‰“é¢†å¸¦ ç‰›ä»”è£¤ï¼ŒTæ¤è¡«å°±è¡Œï¼Œé‡Œé¢çš„è¡£æœä¸è¦å¤§äºå¤–é¢çš„è¡£æœ å¥³ç”Ÿä¸è¦æŸ“å¤´å‘ã€æ¶‚å¤ªè‰³çš„æŒ‡ç”²æ²¹ã€ä¸è¦ç”¨é¦™æ°´ ä¸èƒ½ç©¿å¤ªä¼‘é—² èµ°è·¯ä¸è¦å‘å‡ºå£°éŸ³ï¼Œä¸è¦é©¼èƒŒ   å¾®ç¬‘ï¼Œä¸è¦æ€•çœ¼ç¥æ¥è§¦ ä¸“ä¸šé—®é¢˜å›ç­”ä¸ä¸Šæ¥æ€ä¹ˆåŠ  éå¸¸é—æ†¾æˆ‘è¿˜å›ç­”ä¸ä¸Šæ¥ï¼Œä½†æ˜¯å¦‚æœæˆ‘è¯»ç ”ç©¶ç”Ÿï¼Œæˆ‘ä¼šå¥½å¥½å­¦ä¹ çš„ï¼Œè¯·ç»™æˆ‘è¿™ä¸ªæœºä¼š   ä¸è¦æ‰“æ–­è€å¸ˆè¯´è¯ ä¸è¦ç”¨ä¸€å¥è¯æ¥å›ç­”è€å¸ˆçš„é—®é¢˜ ä¸è¦æ™ƒè…¿  ","permalink":"http://yangchnet.github.io/Dessert/posts/%E6%9D%82%E8%AE%B0/%E5%A4%8D%E8%AF%95%E8%8B%B1%E8%AF%AD/","summary":"0. å¤è¯•è‹±è¯­è€ƒè¯•å½¢å¼  è‡ªæˆ‘ä»‹ç»+è€å¸ˆæé—®ï¼ˆpopularï¼‰ å¬ä¸€æ®µæ–‡ç« å†…å®¹ï¼Œå¬å®Œåå›ç­”ï¼ˆå°‘ï¼‰ å°ç»„è®¨è®ºï¼ˆå°‘ï¼‰  1. è‡ªæˆ‘ä»‹ç» ä¸€å®šä¸è¦è¯´ï¼šæˆ‘çš„è‹±è¯­å¾ˆç³Ÿç³•, My English is very poor!\n ç›®çš„æ˜¯ï¼š è¡¨è¾¾æˆ‘é…ä¸Šç ”ç©¶ç”Ÿ\n  å…ˆè¯´å§“åï¼ˆå¾®ç¬‘è„¸ï¼‰ï¼Œå¹´é¾„ï¼Œå­¦æ ¡ å¤§å­¦å–å¾—çš„æˆç»©ï¼ˆæ²¡æœ‰æˆç»©å¯ä»¥ç¼–\u0026hellip; ç¼–ç‚¹æ— ä»è€ƒè¯çš„ï¼Œæ¯”å¦‚å®¶æ•™å•¥çš„ï¼‰ å†è¯´æ€§æ ¼çˆ±å¥½(ç¨å¾®ä¸¤å¥è¯ææ)ï¼Œå°½é‡å’Œä¸“ä¸šè”ç³»åˆ°ä¸€èµ·ã€‚ That\u0026rsquo;s all, thanks you very much. If I were admitted, I will go all out to learn my professional knowledge.é™¤äº†å­¦ä¹ â‘ ä¸“ä¸šçŸ¥è¯†ï¼Œæˆ‘ä¸€å®šä¼šåŠ å¼ºæˆ‘çš„â‘¡å®è·µèƒ½åŠ›ï¼Œæˆ‘è¿˜è¦å­¦ä¼šâ‘¢æ›´å¥½çš„å’Œå¯¼å¸ˆå’ŒåŒå­¦ä¹‹é—´è¿›è¡Œåˆä½œã€‚Please trusted me.(ä¸è¦è¶…è¿‡ä¸‰åˆ†é’Ÿ)  2. è€å¸ˆå¸¸é—®çš„9ä¸ªé—®é¢˜  ä½ ä¸ºä»€ä¹ˆè€ƒç ”ï¼Œä¸ºä»€ä¹ˆé€‰æ‹©è¿™ä¸ªä¸“ä¸šï¼Ÿ  ä¸€å®šä¸è¦è¯´æœ¬ç§‘å­¦æ ¡åè¯ï¼Œ ä¸è¦è¯´æˆ‘è¦æŒ£é’±.. ä¹Ÿä¸è¦è¯´ä¸ºäº†ä¸­åä¹‹å´›èµ·.. æˆ‘çœŸå¿ƒå–œæ¬¢æˆ‘çš„ä¸“ä¸šğŸ˜Š(ä¸¾ä¸ªä¾‹å­æ€ä¹ˆæ„Ÿå…´è¶£çš„) æˆ‘é—æ†¾è‡ªå·±ä»¥å‰æ²¡æœ‰å¥½å¥½å­¦ä¹ ï¼Œåœ¨åˆ«äººé€‰æ‹©å·¥ä½œçš„æ—¶å€™æˆ‘å†³å®šè€ƒç ”æå‡è‡ªå·± ç»ˆæç­”æ¡ˆæ˜¯å–œæ¬¢   ä½ å¯¹æœªæ¥æœ‰ä»€ä¹ˆè§„åˆ’ï¼Ÿ  3å¹´ç ”ç©¶ç”Ÿçš„è§„åˆ’å’Œç ”ç©¶ç”Ÿåˆšæ¯•ä¸šçš„è§„åˆ’ï¼Œå¤ªè¿œä¸è¦è¯´ ç ”ç©¶ç”Ÿå…¥æ ¡åï¼Œä¸€å®šè·Ÿè€å¸ˆå¥½å¥½å­¦ä¹ ä¸“ä¸šçŸ¥è¯†ï¼ŒååŠ©å¯¼å¸ˆï¼Œäº‰å–è‡ªå·±æ—©æ—¥å‘è¡¨è®ºæ–‡ï¼Œæœ‰æœºä¼šè€ƒåšï¼ŒåŸ¹å…»è‡ªå·±çš„å®è·µèƒ½åŠ›ï¼Œåˆä½œèƒ½åŠ›ï¼Œä¸äººç›¸å¤„èƒ½åŠ›ã€‚æ¯•ä¸šåæ‰¾ä¸€ä»½è‡ªå·±å–œæ¬¢çš„å·¥ä½œï¼Œåœ¨è‡ªå·±çš„å²—ä½ä¸Šåšå‡ºè´¡çŒ®ã€‚ï¼ˆä¸€å®šè¦é…åˆå¯¼å¸ˆï¼‰   ä»‹ç»ä½ çš„å®¶ä¹¡  é¦–å…ˆè¦è¯´æˆ‘çˆ±çš„å®¶ä¹¡ï¼ˆæ€€æœ‰ä¸€é¢—æ„Ÿæ©çš„å¿ƒï¼‰ è¯´ç‚¹åäººå’Œç‰¹äº§ï¼ˆæœ‰å¾ˆå¤šå¯ä»¥such asï¼Œç„¶åé‡ç‚¹è¯´ä¸€ä¸ªï¼‰ æœ€åå†è¯´ï¼Œæ¬¢è¿è€å¸ˆåˆ°æˆ‘çš„å®¶ä¹¡å»æ—…æ¸¸   ä»‹ç»ä½ çš„å®¶åº­  å…ˆè¯´å‡ å£äºº å¯¹æˆ‘çš„äººç”Ÿäº§ç”Ÿæœ€å¤§çš„å½±å“æ˜¯è°ï¼ˆä¸¾ä¸ªæ —å­(ã€ƒï¿£ï¸¶ï¿£)äººï¼‰   ä»‹ç»ä½ çš„æœ¬ç§‘å­¦æ ¡  ä¸€ä¸ªå­—ï¼Œå¥½ å­¦æ ¡æœ‰å†å²ã€å°±ä¸šç‡å¥½ã€æœ‰åæ°”ï¼ˆè€å¸ˆä½ å¯èƒ½ä»æ¥æ²¡å¬è¿‡è¿™ä¸ªåå­—ï¼Œä½†æ˜¯æˆ‘éå¸¸çƒ­çˆ±å®ƒï¼‰ è™½ç„¶æˆ‘çš„å­¦æ ¡ä¸æ˜¯é‚£ä¹ˆæœ‰åæ°”ï¼Œä½†æ˜¯æˆ‘ä¾ç„¶ç»“åˆ°äº†å¾ˆå¤šæœ‹å‹ï¼Œç»™æˆ‘äº†å¾ˆå¤šæ¸©æš–   å¯¹è‹±è¯­çš„æ€åº¦ï¼Œå…³äºè‹±è¯­ä½ æ€ä¹ˆçœ‹  å–œæ¬¢ï¼Œæ„Ÿå…´è¶£ ä»¥å‰å¯¹è‹±è¯­æ²¡é‚£ä¹ˆæ„Ÿå…´è¶£ï¼Œåªæ˜¯ä¸€é—¨è¯¾ åæ¥å‘ç°è‹±è¯­çœŸä»–å¨˜é‡è¦ï¼Œæ„è¯†åˆ°å­¦è‹±è¯­çš„é‡è¦æ€§ åœ¨ç ”ç©¶ç”ŸæœŸé—´æ›´åŠ ä¸“æ³¨å¯¹è‹±è¯­çš„å­¦ä¹  æˆ‘çš„å£è¯­æ²¡æœ‰é‚£ä¹ˆå¥½ï¼Œä½†æ˜¯æˆ‘å¸Œæœ›åœ¨ç ”ç©¶ç”ŸæœŸé—´å¯ä»¥æœ‰é•¿è¶³çš„è¿›æ­¥   ä½ å¯¹æˆ‘ä»¬å­¦æ ¡å’Œä¸“ä¸šäº†è§£å¤šå°‘  é¦–å…ˆï¼Œå­¦æ ¡åæ°”å¤§ï¼ˆæ¯‹åº¸ç½®ç–‘ï¼‰ å…¶æ¬¡ï¼Œå¯¹æˆ‘ä»¬å­¦é™¢ç›¸å½“æœ‰äº†è§£ï¼Œå¯¹æ•™æˆäº†è§£ï¼ˆæä¸€ä¸‹æ•™æˆçš„åå­—ï¼‰ å¸ˆèµ„åŠ›é‡ï¼Œè‘—ä½œ   ä½ çš„ä¼˜ç‚¹å’Œç¼ºç‚¹  ä¼˜ç‚¹å¯ä»¥å’Œä¸“ä¸šç›¸å…³ï¼Œä½†æ˜¯ç¼ºç‚¹ä¸è¡Œ æˆ‘å–œæ¬¢äº¤æœ‹å‹\u0026hellip; ç¼–\u0026hellip;ï¼ˆç»™çˆ·çˆ¬ï¼‰â‰¡(â–”ï¹â–”)â‰¡   ä¸ºä»€ä¹ˆæ¢ä¸“ä¸šï¼ˆç»™è·¨è€ƒï¼‰  \u0026hellip;    3.","title":"å¤è¯•è‹±è¯­"},{"content":"Github å‡ºç° Failed to connect to github.com port 443: Timed out 1. é—®é¢˜æ¥ç”± å¯èƒ½æ˜¯ç”±äºä½¿ç”¨äº†å…¨å±€ä»£ç†çš„åŸå› \n2. è§£å†³ å–æ¶ˆå…¨å±€ä»£ç†ï¼š git config --global --unset http.proxy git config --global --unset https.proxy  è®¾ç½®å…¨å±€ä»£ç†\n git config --global http.proxy http://127.0.0.1:1080 git config --global https.proxy http://127.0.0.1:1080 ","permalink":"http://yangchnet.github.io/Dessert/posts/git/failed-to-connect-to-github.com-port-443/","summary":"Github å‡ºç° Failed to connect to github.com port 443: Timed out 1. é—®é¢˜æ¥ç”± å¯èƒ½æ˜¯ç”±äºä½¿ç”¨äº†å…¨å±€ä»£ç†çš„åŸå› \n2. è§£å†³ å–æ¶ˆå…¨å±€ä»£ç†ï¼š git config --global --unset http.proxy git config --global --unset https.proxy  è®¾ç½®å…¨å±€ä»£ç†\n git config --global http.proxy http://127.0.0.1:1080 git config --global https.proxy http://127.0.0.1:1080 ","title":"Failed to connect to github.com port 443"},{"content":"VsCode Snippetsçš„SnippetsåŠŸèƒ½  snippetsæ˜¯ä»£ç ç‰‡æ®µ, åœ¨è¿™é‡Œçš„æ„æ€æ˜¯ä»£ç æ¨¡æ¿. åœ¨ä½¿ç”¨vscodeå†™ä»£ç æ—¶ï¼Œæœ‰æ—¶éœ€è¦ä½¿ç”¨ä»£ç æ¨¡æ¿ï¼Œä¸€ä¸ªå…¸å‹çš„ä¾‹å­æ˜¯åœ¨å†™æ–‡ä»¶å¤´æ³¨é‡Šæ—¶ï¼Œéœ€è¦ä¸€ä¸ªå›ºå®šæ ¼å¼çš„æ³¨é‡Šï¼Œæ¥è¡¨æ˜å½“å‰çš„æ—¶é—´ã€ä½œè€…ç­‰ã€‚\n 1. ä½¿ç”¨å†…ç½®çš„snippets vscodeä¸­å·²ç»ä¸ºæˆ‘ä»¬å†…ç½®äº†è®¸å¤šè¯­è¨€çš„ä»£ç æ¨¡æ¿ï¼Œåœ¨å®‰è£…äº†å¯¹åº”çš„è¯­è¨€æ’ä»¶å,å¯ç›´æ¥ä½¿ç”¨è¿™äº›snippets. 2. å®‰è£…æ¥è‡ªmarketplaceçš„snippets æŒ‰Ctrl+Shift+Xæ‰“å¼€marketplace, è¾“å…¥@category:\u0026quot;snippets\u0026quot;,å³å¯ä¸‹è½½æ¥è‡ªmarketplaceçš„snippets 3. è‡ªå®šä¹‰snippets å¦‚æœä½ å¯¹å†…ç½®çš„æˆ–æ¥è‡ªmarketplaceçš„snippetså‡ä¸æ»¡æ„,é‚£ä¹ˆä½ å¯ä»¥è‡ªå®šä¹‰ä½ çš„snippets.\nåœ¨File \u0026gt; Preferences \u0026gt; User Snippetsé€‰é¡¹ä¸‹,é€‰æ‹©ä½ è¦å®šä¹‰snippetsçš„æ–‡ä»¶ç±»å‹\nåœ¨é€‰æ‹©äº†æ–‡ä»¶ç±»å‹ä¹‹å,ä½ å°±å¯ä»¥æ ¹æ®vscodeæä¾›çš„Exampleè‡ªå®šä¹‰snippetsäº†.\nExample: \u0026quot;Print to console\u0026quot;: { \u0026quot;prefix\u0026quot;: \u0026quot;log\u0026quot;, \u0026quot;body\u0026quot;: [ \u0026quot;console.log('$1');\u0026quot;, \u0026quot;$2\u0026quot; ], \u0026quot;description\u0026quot;: \u0026quot;Log output to console\u0026quot; \u0026quot;Print to console\u0026quot;æ˜¯ä½ è‡ªå®šä¹‰çš„snippetsçš„åå­—,prefixä¸ºå‰ç¼€,åœ¨è¾“å…¥äº†ä½ å®šä¹‰çš„prefixå,bodyä¸­çš„å†…å®¹å°±ä¼šè¾“å‡ºåˆ°å½“å‰å…‰æ ‡çš„ä½ç½®.\nåœ¨bodyä¸­,ä½ å¯ä»¥ä½¿ç”¨\u0026quot;variables\u0026ldquo;æ¥æè¿°ä½ çš„snippets, å…¶æ ¼å¼ä¸º:\n  ${1:label}: å…¶ä¸­çš„1è¡¨ç¤ºåœ¨bodyè¾“å‡ºåå…‰æ ‡ä¼šç¬¬ä¸€ä¸ªåœæ”¾åœ¨è¿™ä¸ªä½ç½®,è€Œlabelæ˜¯å¯¹å½“å‰variablesçš„æè¿°.\n  ${1|one, two, three|}: è¿™ä¸ªè¯­æ³•æ ¼å¼å°†æé†’ä½ é€‰æ‹©one, two, threeä¸­çš„ä¸€ä¸ªå€¼.\n  $nameæˆ–${name:default}: å…¶ä¸­çš„nameä¸ºé¢„å®šä¹‰çš„å˜é‡å,å¯ä½¿ç”¨defaultæŒ‡å®šå…¶é»˜è®¤å€¼.é¢„å®šä¹‰çš„å˜é‡åæœ‰å¦‚ä¸‹:\n æœ‰å…³æ–‡ä»¶ä¸ç›®å½•çš„\n TM_SELECTED_TEXTå½“å‰é€‰å®šçš„æ–‡æœ¬æˆ–ç©ºå­—ç¬¦ä¸² TM_CURRENT_LINå½“å‰è¡Œçš„å†…å®¹ TM_CURRENT_WORDå…‰æ ‡ä¸‹æˆ–ç©ºå­—ç¬¦ä¸²ä¸‹çš„å•è¯å†…å®¹ TM_LINE_INDEXåŸºäºé›¶æŒ‡æ•°çš„è¡Œæ•° TM_LINE_NUMBERåŸºäºä¸€ä¸ªç´¢å¼•çš„è¡Œæ•° TM_FILENAMEå½“å‰æ–‡æ¡£çš„æ–‡ä»¶å TM_FILENAME_BASEæ²¡æœ‰æ‰©å±•çš„å½“å‰æ–‡æ¡£çš„æ–‡ä»¶å TM_DIRECTORYå½“å‰æ–‡æ¡£çš„ç›®å½• TM_FILEPATHå½“å‰æ–‡æ¡£çš„å®Œæ•´æ–‡ä»¶è·¯å¾„ CLIPBOARDå‰ªè´´æ¿çš„å†…å®¹ WORKSPACE_NAMEæ‰“å¼€çš„å·¥ä½œåŒºæˆ–æ–‡ä»¶å¤¹çš„åç§° WORKSPACE_FOLDERæ‰“å¼€çš„å·¥ä½œåŒºæˆ–æ–‡ä»¶å¤¹çš„è·¯å¾„    æœ‰å…³æ—¶é—´çš„\n CURRENT_YEARæœ¬å¹´åº¦ CURRENT_YEAR_SHORTä»Šå¹´æœ€åä¸¤ä½æ•° CURRENT_MONTHä»¥ä¸¤ä½æ•°è¡¨ç¤ºçš„æœˆä»½ï¼ˆä¾‹å¦‚\u0026quot;02\u0026rdquo;ï¼‰ CURRENT_MONTH_NAMEæœ¬æœˆå…¨åï¼ˆä¾‹å¦‚\u0026quot;ä¸ƒæœˆ\u0026quot;ï¼‰ CURRENT_MONTH_NAME_SHORTæœ¬æœˆçš„ç®€ç§°ï¼ˆä¾‹å¦‚\u0026quot;ä¸ƒæœˆ\u0026quot;ï¼‰ CURRENT_DATEæ¯æœˆçš„ä¸€å¤© CURRENT_DAY_NAMEæ—¥åç§°ï¼ˆä¾‹å¦‚\u0026quot;æ˜ŸæœŸä¸€\u0026quot;ï¼‰ CURRENT_DAY_NAME_SHORTå½“å¤©çš„ç®€ç§°ï¼ˆä¾‹å¦‚\u0026quot;æ˜ŸæœŸä¸€\u0026quot;ï¼‰ CURRENT_HOUR24 å°æ—¶æ—¶é’Ÿæ ¼å¼çš„å½“å‰å°æ—¶ CURRENT_MINUTEå½“å‰åˆ†é’Ÿ CURRENT_SECONDå½“å‰ç§’ CURRENT_SECONDS_UNIXè‡ªUnix epochä»¥æ¥çš„ç§’æ•°    æœ‰å…³æ³¨é‡Šçš„\n BLOCK_COMMENT_START Example output: in PHP or in HTML /*\u0026lt;!-- BLOCK_COMMENT_END Example output: in PHP or in HTML */--\u0026gt; LINE_COMMENT Example output: in PHP //     ","permalink":"http://yangchnet.github.io/Dessert/posts/tool/vscode-snippets%E5%8A%9F%E8%83%BD%E7%9A%84%E4%BD%BF%E7%94%A8/","summary":"VsCode Snippetsçš„SnippetsåŠŸèƒ½  snippetsæ˜¯ä»£ç ç‰‡æ®µ, åœ¨è¿™é‡Œçš„æ„æ€æ˜¯ä»£ç æ¨¡æ¿. åœ¨ä½¿ç”¨vscodeå†™ä»£ç æ—¶ï¼Œæœ‰æ—¶éœ€è¦ä½¿ç”¨ä»£ç æ¨¡æ¿ï¼Œä¸€ä¸ªå…¸å‹çš„ä¾‹å­æ˜¯åœ¨å†™æ–‡ä»¶å¤´æ³¨é‡Šæ—¶ï¼Œéœ€è¦ä¸€ä¸ªå›ºå®šæ ¼å¼çš„æ³¨é‡Šï¼Œæ¥è¡¨æ˜å½“å‰çš„æ—¶é—´ã€ä½œè€…ç­‰ã€‚\n 1. ä½¿ç”¨å†…ç½®çš„snippets vscodeä¸­å·²ç»ä¸ºæˆ‘ä»¬å†…ç½®äº†è®¸å¤šè¯­è¨€çš„ä»£ç æ¨¡æ¿ï¼Œåœ¨å®‰è£…äº†å¯¹åº”çš„è¯­è¨€æ’ä»¶å,å¯ç›´æ¥ä½¿ç”¨è¿™äº›snippets. 2. å®‰è£…æ¥è‡ªmarketplaceçš„snippets æŒ‰Ctrl+Shift+Xæ‰“å¼€marketplace, è¾“å…¥@category:\u0026quot;snippets\u0026quot;,å³å¯ä¸‹è½½æ¥è‡ªmarketplaceçš„snippets 3. è‡ªå®šä¹‰snippets å¦‚æœä½ å¯¹å†…ç½®çš„æˆ–æ¥è‡ªmarketplaceçš„snippetså‡ä¸æ»¡æ„,é‚£ä¹ˆä½ å¯ä»¥è‡ªå®šä¹‰ä½ çš„snippets.\nåœ¨File \u0026gt; Preferences \u0026gt; User Snippetsé€‰é¡¹ä¸‹,é€‰æ‹©ä½ è¦å®šä¹‰snippetsçš„æ–‡ä»¶ç±»å‹\nåœ¨é€‰æ‹©äº†æ–‡ä»¶ç±»å‹ä¹‹å,ä½ å°±å¯ä»¥æ ¹æ®vscodeæä¾›çš„Exampleè‡ªå®šä¹‰snippetsäº†.\nExample: \u0026quot;Print to console\u0026quot;: { \u0026quot;prefix\u0026quot;: \u0026quot;log\u0026quot;, \u0026quot;body\u0026quot;: [ \u0026quot;console.log('$1');\u0026quot;, \u0026quot;$2\u0026quot; ], \u0026quot;description\u0026quot;: \u0026quot;Log output to console\u0026quot; \u0026quot;Print to console\u0026quot;æ˜¯ä½ è‡ªå®šä¹‰çš„snippetsçš„åå­—,prefixä¸ºå‰ç¼€,åœ¨è¾“å…¥äº†ä½ å®šä¹‰çš„prefixå,bodyä¸­çš„å†…å®¹å°±ä¼šè¾“å‡ºåˆ°å½“å‰å…‰æ ‡çš„ä½ç½®.\nåœ¨bodyä¸­,ä½ å¯ä»¥ä½¿ç”¨\u0026quot;variables\u0026ldquo;æ¥æè¿°ä½ çš„snippets, å…¶æ ¼å¼ä¸º:\n  ${1:label}: å…¶ä¸­çš„1è¡¨ç¤ºåœ¨bodyè¾“å‡ºåå…‰æ ‡ä¼šç¬¬ä¸€ä¸ªåœæ”¾åœ¨è¿™ä¸ªä½ç½®,è€Œlabelæ˜¯å¯¹å½“å‰variablesçš„æè¿°.\n  ${1|one, two, three|}: è¿™ä¸ªè¯­æ³•æ ¼å¼å°†æé†’ä½ é€‰æ‹©one, two, threeä¸­çš„ä¸€ä¸ªå€¼.\n  $nameæˆ–${name:default}: å…¶ä¸­çš„nameä¸ºé¢„å®šä¹‰çš„å˜é‡å,å¯ä½¿ç”¨defaultæŒ‡å®šå…¶é»˜è®¤å€¼.é¢„å®šä¹‰çš„å˜é‡åæœ‰å¦‚ä¸‹:\n æœ‰å…³æ–‡ä»¶ä¸ç›®å½•çš„\n TM_SELECTED_TEXTå½“å‰é€‰å®šçš„æ–‡æœ¬æˆ–ç©ºå­—ç¬¦ä¸² TM_CURRENT_LINå½“å‰è¡Œçš„å†…å®¹ TM_CURRENT_WORDå…‰æ ‡ä¸‹æˆ–ç©ºå­—ç¬¦ä¸²ä¸‹çš„å•è¯å†…å®¹ TM_LINE_INDEXåŸºäºé›¶æŒ‡æ•°çš„è¡Œæ•° TM_LINE_NUMBERåŸºäºä¸€ä¸ªç´¢å¼•çš„è¡Œæ•° TM_FILENAMEå½“å‰æ–‡æ¡£çš„æ–‡ä»¶å TM_FILENAME_BASEæ²¡æœ‰æ‰©å±•çš„å½“å‰æ–‡æ¡£çš„æ–‡ä»¶å TM_DIRECTORYå½“å‰æ–‡æ¡£çš„ç›®å½• TM_FILEPATHå½“å‰æ–‡æ¡£çš„å®Œæ•´æ–‡ä»¶è·¯å¾„ CLIPBOARDå‰ªè´´æ¿çš„å†…å®¹ WORKSPACE_NAMEæ‰“å¼€çš„å·¥ä½œåŒºæˆ–æ–‡ä»¶å¤¹çš„åç§° WORKSPACE_FOLDERæ‰“å¼€çš„å·¥ä½œåŒºæˆ–æ–‡ä»¶å¤¹çš„è·¯å¾„    æœ‰å…³æ—¶é—´çš„","title":"VsCode SnippetsåŠŸèƒ½çš„ä½¿ç”¨"},{"content":"GitHubå›¾åºŠ+vscode+Picgo 0. æ¥ç”± ç”¨markdownå†™åšå®¢çš„æ—¶å€™ï¼Œå›¾ç‰‡å¾€å“ªé‡Œå­˜åœ°å¹²æ´»ï¼Ÿå›¾åºŠé‡Œå­˜Â·Â·Â·\n1. GitHubé…ç½®   åˆ›å»ºå›¾åºŠä»“åº“ ä¸ºäº†ä¸æ±¡æŸ“æˆ‘åŸæ¥çš„gitè´¦å·ï¼Œæˆ‘å†³å®šæ–°å»ºä¸€ä¸ªgitè´¦å·ï¼Œä¸“é—¨ç”¨ä½œå›¾åºŠè´¦å·ã€‚ æ–°å»ºè´¦å·ä¹‹åï¼Œnewä¸€ä¸ªrepoï¼Œå•¥éƒ½ä¸ç”¨ç‚¹ï¼Œç›´æ¥createã€‚\n  ç”Ÿæˆtoken ç‚¹å‡»ä½ GitHubé¡µé¢å³ä¸Šè§’çš„å¤´åƒï¼Œç‚¹å‡»settings åœ¨é¡µé¢å·¦ä¾§æ‰¾åˆ°Developer settingsï¼Œé€‰æ‹©ä¹‹ï¼Œå†æ‰¾åˆ°Personal access tokensï¼Œå†é€‰æ‹©ä¹‹ï¼Œç„¶ågenerate new tokens åœ¨æ–°å¼¹å‡ºçš„é¡µé¢ä¸­å¡«å†™noteï¼Œå¹¶é€‰æ‹©repoï¼Œ ç„¶åç›´æ¥åˆ°æœ€ä¸‹é¢ï¼ŒGenerate token è¿™æ ·GitHubä¼šä¸ºä½ ç”Ÿæˆä¸€ä¸ªtokenï¼ˆåªä¼šå‡ºç°è¿™ä¸€æ¬¡ï¼‰ï¼Œå¤åˆ¶å®ƒç•™ç”¨ã€‚   2. é…ç½®VScodeä¸­çš„Picgoæ’ä»¶ åœ¨vscodeçš„æ’ä»¶å•†åº—ä¸­ç›´æ¥æœç´¢Picgoï¼Œç„¶åç‚¹å‡»å®‰è£… å®‰è£…å®Œæˆåï¼Œå†æ¥é…ç½®ä½ çš„Picgo File\u0026gt;Preferences\u0026gt;settings\u0026gt;Entensions\u0026gt;Picgoæ‰¾åˆ°é…ç½®picgoçš„ä½ç½®ï¼Œå¡«å†™å¿…è¦çš„ä¿¡æ¯ \u0026#34;picgo.picBed.current\u0026#34;: \u0026#34;github\u0026#34;, \u0026#34;picgo.picBed.github.branch\u0026#34;: \u0026#34;master\u0026#34;, \u0026#34;picgo.picBed.github.path\u0026#34;: \u0026#34;\u0026#34;, # ä½ æƒ³è¦å›¾ç‰‡å­˜å‚¨çš„è·¯å¾„ \u0026#34;picgo.picBed.github.repo\u0026#34;: \u0026#34;\u0026#34;, # ä½ çš„ç”¨æˆ·åä»¥åŠrepoåï¼Œuser/REPO_name \u0026#34;picgo.picBed.github.token\u0026#34;: \u0026#34;\u0026#34; # åˆšæ‰å¤åˆ¶çš„tokenï¼Œç²˜è´´åˆ°è¿™é‡Œ 3. ä½¿ç”¨picgoä¸Šä¼ å›¾ç‰‡ æˆªä¸ªå›¾å¹¶å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œåœ¨vscodeé‡ŒæŒ‰ä¸‹\u0026quot;CTRL+ALT+u\u0026quot;ï¼Œå›¾ç‰‡å°±å¯ä»¥ååˆ†è¿…é€Ÿçš„ä¸Šä¼ åˆ°ä½ é…ç½®çš„GitHubä»“åº“å¹¶ä¸ºä½ è¿”å›å›¾ç‰‡é“¾æ¥ ï¼ˆï¿£ï¸¶ï¿£ï¼‰â†—ã€‚\nEND\n","permalink":"http://yangchnet.github.io/Dessert/posts/env/github%E5%9B%BE%E5%BA%8A+vscode+picgo-/","summary":"GitHubå›¾åºŠ+vscode+Picgo 0. æ¥ç”± ç”¨markdownå†™åšå®¢çš„æ—¶å€™ï¼Œå›¾ç‰‡å¾€å“ªé‡Œå­˜åœ°å¹²æ´»ï¼Ÿå›¾åºŠé‡Œå­˜Â·Â·Â·\n1. GitHubé…ç½®   åˆ›å»ºå›¾åºŠä»“åº“ ä¸ºäº†ä¸æ±¡æŸ“æˆ‘åŸæ¥çš„gitè´¦å·ï¼Œæˆ‘å†³å®šæ–°å»ºä¸€ä¸ªgitè´¦å·ï¼Œä¸“é—¨ç”¨ä½œå›¾åºŠè´¦å·ã€‚ æ–°å»ºè´¦å·ä¹‹åï¼Œnewä¸€ä¸ªrepoï¼Œå•¥éƒ½ä¸ç”¨ç‚¹ï¼Œç›´æ¥createã€‚\n  ç”Ÿæˆtoken ç‚¹å‡»ä½ GitHubé¡µé¢å³ä¸Šè§’çš„å¤´åƒï¼Œç‚¹å‡»settings åœ¨é¡µé¢å·¦ä¾§æ‰¾åˆ°Developer settingsï¼Œé€‰æ‹©ä¹‹ï¼Œå†æ‰¾åˆ°Personal access tokensï¼Œå†é€‰æ‹©ä¹‹ï¼Œç„¶ågenerate new tokens åœ¨æ–°å¼¹å‡ºçš„é¡µé¢ä¸­å¡«å†™noteï¼Œå¹¶é€‰æ‹©repoï¼Œ ç„¶åç›´æ¥åˆ°æœ€ä¸‹é¢ï¼ŒGenerate token è¿™æ ·GitHubä¼šä¸ºä½ ç”Ÿæˆä¸€ä¸ªtokenï¼ˆåªä¼šå‡ºç°è¿™ä¸€æ¬¡ï¼‰ï¼Œå¤åˆ¶å®ƒç•™ç”¨ã€‚   2. é…ç½®VScodeä¸­çš„Picgoæ’ä»¶ åœ¨vscodeçš„æ’ä»¶å•†åº—ä¸­ç›´æ¥æœç´¢Picgoï¼Œç„¶åç‚¹å‡»å®‰è£… å®‰è£…å®Œæˆåï¼Œå†æ¥é…ç½®ä½ çš„Picgo File\u0026gt;Preferences\u0026gt;settings\u0026gt;Entensions\u0026gt;Picgoæ‰¾åˆ°é…ç½®picgoçš„ä½ç½®ï¼Œå¡«å†™å¿…è¦çš„ä¿¡æ¯ \u0026#34;picgo.picBed.current\u0026#34;: \u0026#34;github\u0026#34;, \u0026#34;picgo.picBed.github.branch\u0026#34;: \u0026#34;master\u0026#34;, \u0026#34;picgo.picBed.github.path\u0026#34;: \u0026#34;\u0026#34;, # ä½ æƒ³è¦å›¾ç‰‡å­˜å‚¨çš„è·¯å¾„ \u0026#34;picgo.picBed.github.repo\u0026#34;: \u0026#34;\u0026#34;, # ä½ çš„ç”¨æˆ·åä»¥åŠrepoåï¼Œuser/REPO_name \u0026#34;picgo.picBed.github.token\u0026#34;: \u0026#34;\u0026#34; # åˆšæ‰å¤åˆ¶çš„tokenï¼Œç²˜è´´åˆ°è¿™é‡Œ 3. ä½¿ç”¨picgoä¸Šä¼ å›¾ç‰‡ æˆªä¸ªå›¾å¹¶å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œåœ¨vscodeé‡ŒæŒ‰ä¸‹\u0026quot;CTRL+ALT+u\u0026quot;ï¼Œå›¾ç‰‡å°±å¯ä»¥ååˆ†è¿…é€Ÿçš„ä¸Šä¼ åˆ°ä½ é…ç½®çš„GitHubä»“åº“å¹¶ä¸ºä½ è¿”å›å›¾ç‰‡é“¾æ¥ ï¼ˆï¿£ï¸¶ï¿£ï¼‰â†—ã€‚\nEND","title":"GitHubå›¾åºŠ+vscode+Picgo "},{"content":"å®‰è£…ä¸é…ç½®  å‚è€ƒäº†è¿™ä½è€å“¥çš„åšå®¢\n 0. æ¥ç”± é˜¿é‡Œäº‘ä¸è…¾è®¯äº‘gitå¤ªæ…¢äº†ã€‚ã€‚æƒ³å¿«ç‚¹\n1. ä¸‹è½½å®‰è£… åœ°å€åœ¨è¿™é‡Œï¼Œæ‰¾åˆ°å¯¹åº”è‡ªå·±ç³»ç»Ÿçš„ç‰ˆæœ¬ï¼Œå¯ä»¥å…ˆä¸‹è½½åˆ°è‡ªå·±æœ¬åœ°ä¸»æœºåå†ç”¨FileZillaä¸Šä¼ åˆ°äº‘æœåŠ¡å™¨ï¼ˆè™½ç„¶è›®éº»çƒ¦ï¼Œä½†æ˜¯å®ƒå¿«å‘€ï¼‰\n2. å®‰è£… å°†ä¸‹è½½çš„ä¸Šä¼ åˆ°è‡ªå·±çš„æœåŠ¡å™¨ä¹‹åï¼Œè§£å‹ä¹‹ï¼š\ngunzip clash-linux-amd64-v1.4.1.gz è§£å‹ç»“æœå°±æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ é‡å‘½åï¼š\nmv clash-linux-amd64 clash èµ‹äºˆè¿è¡Œæƒé™ï¼š\nchmod +x clash ç§»åŠ¨åˆ°binç›®å½•ä¸‹ï¼š\nmv clash /usr/local/bin/clash 3. ç¼–è¾‘config.yamlæ–‡ä»¶ vim ~/.config/clash/config.yaml # port of HTTP port: 7890 # port of SOCKS5 socks-port: 7891 â€¦â€¦ # è¿™é‡Œè¾“å…¥ä½ è‡ªå·±çš„é…ç½®æ–‡ä»¶ 4. å°†æ·»åŠ ä¸ºç³»ç»ŸæœåŠ¡ cd /etc/systemd/system/ vim clash.service clash.serviceçš„å†…å®¹ä¸ºï¼š\n[Unit] Description= proxy After=network.target [Service] Type=simple ExecStart=/usr/local/bin/clash -f /home/YourUsername/.config/clash/config.yaml [Install] WantedBy=multi-user.target  è¦æƒ³æ·±å…¥äº†è§£systemctlæœåŠ¡ï¼Œå¯å‰å¾€é˜®ä¸€å³°å¤§ä½¬çš„æ•™ç¨‹\n ç¼–è¾‘å®Œæˆåï¼Œé‡è½½systemctl\nsystemctl daemon-reload å¼€å¯æœåŠ¡\nsystemctl start clash è®¾ç½®å¼€æœºå¯åŠ¨\nsystemctl enable clash 5. å¼€å¯httpä»£ç†å’Œsocks5ä»£ç†  æ‰‹åŠ¨å¼€å¯ä»£ç† export https_proxy=http://127.0.0.1:7890 http_proxy=http://127.0.0.1:7890 all_proxy=socks5://127.0.0.1:7891  ä¿æŒå¯åŠ¨ï¼Œä¿®æ”¹~/.bashrc echo \u0026#34;export https_proxy=http://127.0.0.1:7890 http_proxy=http://127.0.0.1:7890 all_proxy=socks5://127.0.0.1:7891\u0026#34; \u0026gt;\u0026gt; ~/.bashrc   6. æµ‹è¯•æ˜¯å¦æˆåŠŸ curl -I https://www.google.com/ è¿”å›ï¼š\nHTTP/1.1 200 Connection established HTTP/2 200 content-type: text/html; charset=ISO-8859-1 p3p: CP=\u0026quot;This is not a P3P policy! See g.co/p3phelp for more info.\u0026quot; date: Thu, 04 Mar 2021 09:08:48 GMT server: gws x-xss-protection: 0 x-frame-options: SAMEORIGIN expires: Thu, 04 Mar 2021 09:08:48 GMT cache-control: private set-cookie: 1P_JAR=2021-03-04-09; expires=Sat, 03-Apr-2021 09:08:48 GMT; path=/; domain=.google.com; Secure set-cookie: NID=210=wzyYoXKPgWcDE4ptLfGQOeOE1w5kehSHm4-gycNKB2bUaeueNyGXgDUm-p5KR6X0aTtmcXjxsamD0xM3YJVRqJnw74uXjiOwcJpRiwsQ-jdUc4y4JG8ObdBOGQJQcddFf_d8fyJ1nVEeEWWZanQUDJToFA6b0T05oCegNpeM70Q; expires=Fri, 03-Sep-2021 09:08:48 GMT; path=/; domain=.google.com; HttpOnly alt-svc: h3-29=\u0026quot;:443\u0026quot;; ma=2592000,h3-T051=\u0026quot;:443\u0026quot;; ma=2592000,h3-Q050=\u0026quot;:443\u0026quot;; ma=2592000,h3-Q046=\u0026quot;:443\u0026quot;; ma=2592000,h3-Q043=\u0026quot;:443\u0026quot;; ma=2592000,quic=\u0026quot;:443\u0026quot;; ma=2592000; v=\u0026quot;46,43\u0026quot; ","permalink":"http://yangchnet.github.io/Dessert/posts/env/%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AEclash/","summary":"å®‰è£…ä¸é…ç½®  å‚è€ƒäº†è¿™ä½è€å“¥çš„åšå®¢\n 0. æ¥ç”± é˜¿é‡Œäº‘ä¸è…¾è®¯äº‘gitå¤ªæ…¢äº†ã€‚ã€‚æƒ³å¿«ç‚¹\n1. ä¸‹è½½å®‰è£… åœ°å€åœ¨è¿™é‡Œï¼Œæ‰¾åˆ°å¯¹åº”è‡ªå·±ç³»ç»Ÿçš„ç‰ˆæœ¬ï¼Œå¯ä»¥å…ˆä¸‹è½½åˆ°è‡ªå·±æœ¬åœ°ä¸»æœºåå†ç”¨FileZillaä¸Šä¼ åˆ°äº‘æœåŠ¡å™¨ï¼ˆè™½ç„¶è›®éº»çƒ¦ï¼Œä½†æ˜¯å®ƒå¿«å‘€ï¼‰\n2. å®‰è£… å°†ä¸‹è½½çš„ä¸Šä¼ åˆ°è‡ªå·±çš„æœåŠ¡å™¨ä¹‹åï¼Œè§£å‹ä¹‹ï¼š\ngunzip clash-linux-amd64-v1.4.1.gz è§£å‹ç»“æœå°±æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ é‡å‘½åï¼š\nmv clash-linux-amd64 clash èµ‹äºˆè¿è¡Œæƒé™ï¼š\nchmod +x clash ç§»åŠ¨åˆ°binç›®å½•ä¸‹ï¼š\nmv clash /usr/local/bin/clash 3. ç¼–è¾‘config.yamlæ–‡ä»¶ vim ~/.config/clash/config.yaml # port of HTTP port: 7890 # port of SOCKS5 socks-port: 7891 â€¦â€¦ # è¿™é‡Œè¾“å…¥ä½ è‡ªå·±çš„é…ç½®æ–‡ä»¶ 4. å°†æ·»åŠ ä¸ºç³»ç»ŸæœåŠ¡ cd /etc/systemd/system/ vim clash.service clash.serviceçš„å†…å®¹ä¸ºï¼š\n[Unit] Description= proxy After=network.target [Service] Type=simple ExecStart=/usr/local/bin/clash -f /home/YourUsername/.config/clash/config.yaml [Install] WantedBy=multi-user.target  è¦æƒ³æ·±å…¥äº†è§£systemctlæœåŠ¡ï¼Œå¯å‰å¾€é˜®ä¸€å³°å¤§ä½¬çš„æ•™ç¨‹\n ç¼–è¾‘å®Œæˆåï¼Œé‡è½½systemctl\nsystemctl daemon-reload å¼€å¯æœåŠ¡","title":"Linuxä¸Šå®‰è£…ä¸é…ç½®clash"},{"content":"åšå®¢å»ºè®¾è®° 0. å‰è®° ä¸€ç›´æƒ³è¦å»ºè®¾ä¸€ä¸ªå±äºè‡ªå·±çš„åšå®¢ï¼Œä¸€å¼€å§‹ç”¨pythonå†™è¿‡ä¸€ä¸ªç®€å•çš„ï¼Œå¯ä»¥åšåˆ°å¯Œæ–‡æœ¬ç¼–è¾‘ã€å‘å¸ƒã€æ›´æ–°ã€è¯„è®ºç­‰åŠŸèƒ½ï¼Œä½†é‚£ä¸ªä¸æ˜¯ä¸€ä¸ªå•çº¯çš„åšå®¢ï¼Œå¹¶ä¸”ç•Œé¢ä¹Ÿä¸æ˜¯å¤ªå‹å¥½ï¼Œå› æ­¤åæ¥åºŸå¼ƒäº†ã€‚åæ¥åˆç”¨äº†ä¸€æ®µæ—¶é—´çš„jupyter notebookï¼Œå¾ˆå¼ºå¤§ï¼Œå°¤å…¶è®©æˆ‘å–œæ¬¢çš„æ˜¯å¯ä»¥ç›´æ¥è¿è¡Œä»£ç ï¼Œæ›¾ç»æœ‰ä¸€æ®µæ—¶é—´æƒ³è¿‡å¯å¦æŠŠjupyter notebookç›´æ¥ä½œä¸ºæˆ‘çš„åšå®¢é¡µé¢ï¼Œæˆ–è€…æ˜¯åµŒå…¥æˆ‘çš„é¡µé¢å†…ï¼Œäºæ˜¯çœ‹äº†çœ‹å…¶æºä»£ç ã€‚ã€‚ã€‚é‚æ”¾å¼ƒã€‚åæ¥åˆç”¨äº†ä¸ºçŸ¥ç¬”è®°ï¼Œå°è±¡ç¬”è®°ï¼ŒNotionç­‰ï¼Œä½†æ„Ÿè§‰éƒ½æ²¡jupyter notebookå¥½ç”¨ã€‚ åœ¨ç”¨jupyter notebookè®°äº†æœ‰äº†ä¸€å®šçš„æ•°ç›®ä¹‹åï¼Œå°±æƒ³å°†å…¶å‘å¸ƒå‡ºæ¥ï¼Œè€ƒè™‘è¿‡CSDNï¼Œä½†æ„Ÿè§‰ä¸Šé¢å¹¿å‘Šå¥½å¤šï¼Œä¸å¤ªå–œæ¬¢ï¼Œå› æ­¤æ²¡æœ‰ä½¿ç”¨ã€‚åæ¥ä¹°äº†åŸŸåå’ŒæœåŠ¡å™¨ï¼Œç”¨wordpressæäº†ä¸€ä¸ªï¼Œä½†æ˜¯ä¸æ˜¯å¤ªæ»¡æ„ï¼Œä¹Ÿæ²¡å‘å¸ƒã€‚åæ¥ç”¨goè¯­è¨€å†™äº†ä¸€ä¸ªï¼Œå› ä¸ºæŸäº›åŸå› ï¼Œä¸­é—´çš„ä¸€äº›æ•°æ®é€šè·¯æ²¡æœ‰æé€šï¼ˆä¸»è¦æ˜¯ä»jupyteråˆ°mdå†åˆ°ç½‘ç«™çš„è‡ªåŠ¨å‘å¸ƒï¼‰ï¼Œå†åŠ ä¸Šåæ¥è€ƒç ”ï¼Œæ‰€ä»¥è¿™ä¸ªé¡¹ç›®ä¹Ÿæ²¡æ´»åˆ°\u0026quot;æˆç«™\u0026quot;ã€‚ ç»ˆäºï¼Œç”¨hugoæäº†ä¸€ä¸ªã€‚ä¹‹æ‰€ä»¥ç”¨hugoï¼Œä¸€æ˜¯å› ä¸ºæœ€è¿‘ç ”ç©¶goè¯­è¨€ï¼Œå¯¹goè¯­è¨€çš„é¡¹ç›®å…·æœ‰ä¸€å®šçš„å¥½æ„Ÿï¼Œç¬¬äºŒæ˜¯å› ä¸ºçœ‹äº†ç½‘ä¸Šçš„ä¸€äº›ä»‹ç»å¹¶ä¸”å‘ç°äº†ä¸€äº›ä½¿ç”¨hugoçš„ä¸ªäººåšå®¢ã€‚ 2021/2/28ï¼Œè®°ä¹‹ã€‚\n1. ä½¿ç”¨hugoå¼€å§‹è‡ªå·±çš„ç½‘ç«™ 1.1 å¼€å§‹ hugoçš„ä½¿ç”¨ç‚’é¸¡ç®€å•ï¼Œä½ åªéœ€è¦ä½¿ç”¨\nhugo new site MySite å³å¯æ–°å»ºä¸€ä¸ªåä¸ºMySiteçš„ç½‘ç«™\n1.2 ä¸ºä½ çš„ç½‘ç«™é€‰æ‹©ä¸€ä¸ªtheme è¿›å…¥åˆ°æˆ‘ä»¬åˆšæ‰å»ºç«‹çš„ç½‘ç«™ç›®å½•\ncd Mysite/ ä»GitHubå¯¼å…¥ä½ æƒ³åº”ç”¨çš„ä¸»é¢˜\ngit init git submodule add https://github.com/budparr/gohugo-theme-ananke.git themes/ananke å¾…ä¸‹è½½å®Œæˆåï¼Œè¿˜éœ€è¦ä¿®æ”¹ä½ çš„é…ç½®æ–‡ä»¶\necho \u0026#39;theme = \u0026#34;ananke\u0026#34; \u0026#39; \u0026gt;\u0026gt; config.toml 1.3 ä¸ºä½ çš„ç½‘ç«™æ·»åŠ ä¸€äº›å†…å®¹ hugoä½¿ç”¨æˆ‘ä»¬ä¸Šä¼ çš„mdæ–‡ä»¶æ¥è‡ªåŠ¨ç”Ÿæˆé™æ€ç½‘é¡µï¼Œè€Œæˆ‘ä»¬ä¸Šä¼ çš„mdæ–‡ä»¶çš„ä½ç½®åœ¨MySite/content/posts/*, æˆ‘ä»¬å¯ä»¥ç›´æ¥å¤åˆ¶å·²ç»ç¼–è¾‘å¥½çš„mdæ–‡ä»¶åˆ°è¿™ä¸ªç›®å½•ï¼Œæˆ–è€…ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š\nhugo new posts/my-first-post.md éœ€è¦æ³¨æ„çš„ä¸€ç‚¹ï¼šä¸ºäº†è®©hugoçŸ¥é“æ›´å¤šçš„ä¿¡æ¯ï¼Œæˆ‘ä»¬ä¸Šä¼ çš„mdæ–‡ä»¶ä¸€èˆ¬ä¼šæœ‰ä¸€ä¸ª\u0026quot;standand header\u0026quot;, å¦‚ä¸‹ï¼š\n--- title: \u0026quot;My First Post\u0026quot; date: 2019-03-26T08:47:11+01:00 draft: true --- è¿™é‡Œçš„å¤´éƒ¨å¹¶ä¸æ˜¯ä¸€æˆä¸å˜çš„ï¼Œä½ å¯ä»¥æ ¹æ®éœ€è¦è‡ªè¡Œé…ç½®ã€‚\n1.4 å¼€å§‹è®©ä½ çš„ç½‘ç«™æœåŠ¡ ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è®©ä½ çš„ç½‘ç«™å¼€å§‹æœåŠ¡å§ï¼\nhugo server -D æ³¨æ„ï¼Œè¿™ä¸ªå‘½ä»¤åªä¼šè®©ä½ çš„hugoæœåŠ¡å™¨ç›‘å¬æœ¬åœ°è®¿é—®ï¼Œä¹Ÿå°±æ˜¯127.0.0.1 å¦‚æœä½ æƒ³è¦ä½ çš„hugoæœåŠ¡å™¨ä¸ºæ•´ä¸ªç½‘ç»œæœåŠ¡ï¼Œå¯ä»¥è¿™æ ·ï¼š\nhugo server --bind=\u0026#39;0.0.0.0\u0026#39; è¿™æ ·ï¼Œä½ çš„ç½‘ç«™å°±å¯ä»¥å…¨ç½‘è®¿é—®äº†ã€‚\n2. ä½¿ç”¨webhook ç®€å•çš„è¯´ï¼Œwebhookæ˜¯ä¸€ä¸ªè§¦å‘å™¨ï¼Œå½“æˆ‘ä»¬åšå‡ºæŸä¸ªç‰¹å®šçš„çš„åŠ¨ä½œåï¼Œwebhookå¯ä»¥è‡ªåŠ¨å®Œæˆç‰¹å®šä»»åŠ¡ã€‚\n2.1 æœåŠ¡ç«¯é…ç½® é¦–å…ˆï¼Œæˆ‘ä»¬ä½¿ç”¨https://github.com/adnanh/webhook.gitæ¥é…ç½®æˆ‘ä»¬çš„æœåŠ¡å™¨ç«¯ï¼Œä½¿å…¶å¯ç›‘å¬webhookè¯·æ±‚ã€‚\n å®‰è£…adnanh/webhook go build github.com/adnanh/webhook  ç¼–è¾‘hooks.json [ { \u0026#34;id\u0026#34;: \u0026#34;redeploy-webhook\u0026#34;, \u0026#34;execute-command\u0026#34;: \u0026#34;/var/scripts/redeploy.sh\u0026#34;, //è„šæœ¬çš„ä½ç½® \u0026#34;command-working-directory\u0026#34;: \u0026#34;/var/webhook\u0026#34; // è„šæœ¬çš„å·¥ä½œç›®å½• } ] å¦‚æœä½ æƒ³è¦ä½ çš„è„šæœ¬è¿”å›ä¸€äº›å€¼ä½œä¸ºæé†’ï¼Œå¯ä»¥è¿™æ ·è®¾ç½®ï¼š\n\u0026#34;response-message\u0026#34;:\u0026#34;hooks,hooks\u0026#34;  ç¼–è¾‘ä½ è¦è¿è¡Œçš„è‡ªåŠ¨éƒ¨ç½²è„šæœ¬ # ä½ çš„è„šæœ¬ï¼Œæ ¹æ®ä½ æ‰€è¦æ‰§è¡Œçš„ä»»åŠ¡è‡ªè¡Œç¼–å†™   âœ¦âœ¦ä½ éœ€è¦æ³¨æ„ä½ çš„è„šæœ¬æƒé™ï¼Œç¡®ä¿å…¶å¯ä»¥è¿è¡Œ\n2.2 GitHubçš„webhook åœ¨æœåŠ¡ç«¯é…ç½®å®Œæˆåï¼Œå¼€å§‹é…ç½®GitHubã€‚ Githubä¸ºæˆ‘ä»¬æä¾›äº†webhookåŠŸèƒ½ï¼Œå¯ä»¥æ–¹ä¾¿çš„åº”ç”¨åœ¨æˆ‘ä»¬çš„ä»£ç ä»“åº“ä¸­ã€‚ åœ¨githubä¸Šé…ç½®ä½ çš„webhookï¼Œcontent typeé€‰æ‹©application/json,Payload URLä¸ºä½ æƒ³è¦webhookç›‘å¬çš„ç«¯å£ä¸è·¯å¾„ï¼Œå…¶ä¸­è·¯å¾„ä¸­çš„æœ€åä¸€éƒ¨åˆ†ä¸hooks.jsonä¸­çš„idæ˜¯å¯¹åº”çš„ã€‚ 2.3 æµ‹è¯•é€šè·¯ æµ‹è¯•ä½ çš„webhookæ˜¯å¦è®¾ç½®æˆåŠŸã€‚\n å¼€å¯æœåŠ¡ç«¯ç›‘å¬  /path/to/webhook -hooks hooks.json -verbose # é»˜è®¤ç«¯å£9000 # ä½ å¯ä»¥ä½¿ç”¨-portå‚æ•°æŒ‡å®šç›‘å¬ç«¯å£ åœ¨GitHubä¸Šå‘é€è¯·æ±‚ GitHub webhooké…ç½®å®Œæˆåä¼šè‡ªåŠ¨å‘é€è¯·æ±‚æŸ¥çœ‹æ˜¯å¦æœ‰å›åº”ï¼Œè‹¥Recent Deliveriesä¸­æ˜¯çº¢è‰²çš„æ„Ÿå¹å·ï¼Œä»£è¡¨æµ‹è¯•å¤±è´¥ã€‚ä½ å¯ä»¥ç‚¹å‡»RedeliveræŒ‰é’®é‡æ–°æµ‹è¯•ã€‚è‹¥å‡ºç°ç»¿è‰²çš„å¯¹å·ï¼Œåˆ™ä»£è¡¨æµ‹è¯•æˆåŠŸã€‚ ![redeliver]{}  2.4 å°†webhookè®¾ç½®ä¸ºsystemctl ä¸ºäº†è®©webhookèƒ½ä¸€ç›´ç›‘å¬è¯·æ±‚ï¼Œæˆ‘ä»¬éœ€è¦ä½¿webhookä¿æŒè¿è¡Œã€‚ æ–°å»º/etc/systemed/system/webhook.service å…¶å†…å®¹å¦‚ä¸‹ï¼š\n[Unit] Description=Webhooks [Service] ExecStart=/usr/bin/webhook -port 12345 -hooks /path/to/hooks.json -hotreload [Install] WantedBy=multi-user.target ä¿å­˜å¹¶å…³é—­ã€‚ è¿è¡Œä»¥ä¸‹å‘½ä»¤\nsudo systemctl daemon-reload # é‡è½½é…ç½®æ–‡ä»¶ sudo systemctl start webhook.service # å¯åŠ¨webhook.service sudo systemctl status webhook.service # æŸ¥çœ‹webhookçš„çŠ¶æ€ 3. ä½¿ç”¨nginxä½œä¸ºæœåŠ¡å™¨ å®‰è£…nginxï¼š\nsudo apt-get install nginx ä½¿ç”¨hugoç”Ÿæˆé™æ€æ–‡ä»¶\n# cd Mysite hugo hugoç”Ÿæˆçš„é™æ€æ–‡ä»¶å­˜å‚¨åœ¨publicæ–‡ä»¶å¤¹ä¸­ã€‚ å°†publicæ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰æ–‡ä»¶å¤åˆ¶åˆ°nginxæŒ‡å®šçš„rootæ–‡ä»¶å¤¹ä¸­ã€‚ è®¿é—®ä½ çš„æœåŠ¡å™¨ipåœ°å€æˆ–åŸŸåã€‚ é¡µé¢æ­£å¸¸ï¼ âœ¦âœ¦å¦‚æœä½ çš„nginxæ˜¾ç¤º404ï¼Œé‚£ä¹ˆè¯·æ£€æŸ¥ä½ çš„nginxçš„rootæ–‡ä»¶å¤¹é…ç½®ä»¥åŠä½ çš„æ–‡ä»¶ä½ç½®ï¼›å¦‚æœæ˜¾ç¤º403ï¼Œå¯èƒ½æ˜¯ä½ æœåŠ¡ç«¯æƒé™é…ç½®é”™è¯¯ã€‚\n4. æ•°æ®é€šè·¯ æœ¬åœ°ç¼–è¾‘mdæ–‡ä»¶ â†’ ä¸Šä¼ GitHub â†’ webhookå‘é€è¯·æ±‚ â†’ æœåŠ¡å™¨æ¥æ”¶è¯·æ±‚ï¼Œæ‹‰å–GitHubæ–‡ä»¶ï¼Œé‡æ–°ç”Ÿæˆé™æ€æ–‡ä»¶ â†’ å¤åˆ¶é™æ€æ–‡ä»¶åˆ°nginxæŒ‡å®šçš„rootç›®å½•ã€‚æ›´æ–°å®Œæˆ\n","permalink":"http://yangchnet.github.io/Dessert/posts/env/%E5%8D%9A%E5%AE%A2%E5%BB%BA%E8%AE%BE/","summary":"åšå®¢å»ºè®¾è®° 0. å‰è®° ä¸€ç›´æƒ³è¦å»ºè®¾ä¸€ä¸ªå±äºè‡ªå·±çš„åšå®¢ï¼Œä¸€å¼€å§‹ç”¨pythonå†™è¿‡ä¸€ä¸ªç®€å•çš„ï¼Œå¯ä»¥åšåˆ°å¯Œæ–‡æœ¬ç¼–è¾‘ã€å‘å¸ƒã€æ›´æ–°ã€è¯„è®ºç­‰åŠŸèƒ½ï¼Œä½†é‚£ä¸ªä¸æ˜¯ä¸€ä¸ªå•çº¯çš„åšå®¢ï¼Œå¹¶ä¸”ç•Œé¢ä¹Ÿä¸æ˜¯å¤ªå‹å¥½ï¼Œå› æ­¤åæ¥åºŸå¼ƒäº†ã€‚åæ¥åˆç”¨äº†ä¸€æ®µæ—¶é—´çš„jupyter notebookï¼Œå¾ˆå¼ºå¤§ï¼Œå°¤å…¶è®©æˆ‘å–œæ¬¢çš„æ˜¯å¯ä»¥ç›´æ¥è¿è¡Œä»£ç ï¼Œæ›¾ç»æœ‰ä¸€æ®µæ—¶é—´æƒ³è¿‡å¯å¦æŠŠjupyter notebookç›´æ¥ä½œä¸ºæˆ‘çš„åšå®¢é¡µé¢ï¼Œæˆ–è€…æ˜¯åµŒå…¥æˆ‘çš„é¡µé¢å†…ï¼Œäºæ˜¯çœ‹äº†çœ‹å…¶æºä»£ç ã€‚ã€‚ã€‚é‚æ”¾å¼ƒã€‚åæ¥åˆç”¨äº†ä¸ºçŸ¥ç¬”è®°ï¼Œå°è±¡ç¬”è®°ï¼ŒNotionç­‰ï¼Œä½†æ„Ÿè§‰éƒ½æ²¡jupyter notebookå¥½ç”¨ã€‚ åœ¨ç”¨jupyter notebookè®°äº†æœ‰äº†ä¸€å®šçš„æ•°ç›®ä¹‹åï¼Œå°±æƒ³å°†å…¶å‘å¸ƒå‡ºæ¥ï¼Œè€ƒè™‘è¿‡CSDNï¼Œä½†æ„Ÿè§‰ä¸Šé¢å¹¿å‘Šå¥½å¤šï¼Œä¸å¤ªå–œæ¬¢ï¼Œå› æ­¤æ²¡æœ‰ä½¿ç”¨ã€‚åæ¥ä¹°äº†åŸŸåå’ŒæœåŠ¡å™¨ï¼Œç”¨wordpressæäº†ä¸€ä¸ªï¼Œä½†æ˜¯ä¸æ˜¯å¤ªæ»¡æ„ï¼Œä¹Ÿæ²¡å‘å¸ƒã€‚åæ¥ç”¨goè¯­è¨€å†™äº†ä¸€ä¸ªï¼Œå› ä¸ºæŸäº›åŸå› ï¼Œä¸­é—´çš„ä¸€äº›æ•°æ®é€šè·¯æ²¡æœ‰æé€šï¼ˆä¸»è¦æ˜¯ä»jupyteråˆ°mdå†åˆ°ç½‘ç«™çš„è‡ªåŠ¨å‘å¸ƒï¼‰ï¼Œå†åŠ ä¸Šåæ¥è€ƒç ”ï¼Œæ‰€ä»¥è¿™ä¸ªé¡¹ç›®ä¹Ÿæ²¡æ´»åˆ°\u0026quot;æˆç«™\u0026quot;ã€‚ ç»ˆäºï¼Œç”¨hugoæäº†ä¸€ä¸ªã€‚ä¹‹æ‰€ä»¥ç”¨hugoï¼Œä¸€æ˜¯å› ä¸ºæœ€è¿‘ç ”ç©¶goè¯­è¨€ï¼Œå¯¹goè¯­è¨€çš„é¡¹ç›®å…·æœ‰ä¸€å®šçš„å¥½æ„Ÿï¼Œç¬¬äºŒæ˜¯å› ä¸ºçœ‹äº†ç½‘ä¸Šçš„ä¸€äº›ä»‹ç»å¹¶ä¸”å‘ç°äº†ä¸€äº›ä½¿ç”¨hugoçš„ä¸ªäººåšå®¢ã€‚ 2021/2/28ï¼Œè®°ä¹‹ã€‚\n1. ä½¿ç”¨hugoå¼€å§‹è‡ªå·±çš„ç½‘ç«™ 1.1 å¼€å§‹ hugoçš„ä½¿ç”¨ç‚’é¸¡ç®€å•ï¼Œä½ åªéœ€è¦ä½¿ç”¨\nhugo new site MySite å³å¯æ–°å»ºä¸€ä¸ªåä¸ºMySiteçš„ç½‘ç«™\n1.2 ä¸ºä½ çš„ç½‘ç«™é€‰æ‹©ä¸€ä¸ªtheme è¿›å…¥åˆ°æˆ‘ä»¬åˆšæ‰å»ºç«‹çš„ç½‘ç«™ç›®å½•\ncd Mysite/ ä»GitHubå¯¼å…¥ä½ æƒ³åº”ç”¨çš„ä¸»é¢˜\ngit init git submodule add https://github.com/budparr/gohugo-theme-ananke.git themes/ananke å¾…ä¸‹è½½å®Œæˆåï¼Œè¿˜éœ€è¦ä¿®æ”¹ä½ çš„é…ç½®æ–‡ä»¶\necho \u0026#39;theme = \u0026#34;ananke\u0026#34; \u0026#39; \u0026gt;\u0026gt; config.toml 1.3 ä¸ºä½ çš„ç½‘ç«™æ·»åŠ ä¸€äº›å†…å®¹ hugoä½¿ç”¨æˆ‘ä»¬ä¸Šä¼ çš„mdæ–‡ä»¶æ¥è‡ªåŠ¨ç”Ÿæˆé™æ€ç½‘é¡µï¼Œè€Œæˆ‘ä»¬ä¸Šä¼ çš„mdæ–‡ä»¶çš„ä½ç½®åœ¨MySite/content/posts/*, æˆ‘ä»¬å¯ä»¥ç›´æ¥å¤åˆ¶å·²ç»ç¼–è¾‘å¥½çš„mdæ–‡ä»¶åˆ°è¿™ä¸ªç›®å½•ï¼Œæˆ–è€…ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š\nhugo new posts/my-first-post.md éœ€è¦æ³¨æ„çš„ä¸€ç‚¹ï¼šä¸ºäº†è®©hugoçŸ¥é“æ›´å¤šçš„ä¿¡æ¯ï¼Œæˆ‘ä»¬ä¸Šä¼ çš„mdæ–‡ä»¶ä¸€èˆ¬ä¼šæœ‰ä¸€ä¸ª\u0026quot;standand header\u0026quot;, å¦‚ä¸‹ï¼š\n--- title: \u0026quot;My First Post\u0026quot; date: 2019-03-26T08:47:11+01:00 draft: true --- è¿™é‡Œçš„å¤´éƒ¨å¹¶ä¸æ˜¯ä¸€æˆä¸å˜çš„ï¼Œä½ å¯ä»¥æ ¹æ®éœ€è¦è‡ªè¡Œé…ç½®ã€‚\n1.4 å¼€å§‹è®©ä½ çš„ç½‘ç«™æœåŠ¡ ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è®©ä½ çš„ç½‘ç«™å¼€å§‹æœåŠ¡å§ï¼\nhugo server -D æ³¨æ„ï¼Œè¿™ä¸ªå‘½ä»¤åªä¼šè®©ä½ çš„hugoæœåŠ¡å™¨ç›‘å¬æœ¬åœ°è®¿é—®ï¼Œä¹Ÿå°±æ˜¯127.0.0.1 å¦‚æœä½ æƒ³è¦ä½ çš„hugoæœåŠ¡å™¨ä¸ºæ•´ä¸ªç½‘ç»œæœåŠ¡ï¼Œå¯ä»¥è¿™æ ·ï¼š","title":"åšå®¢å»ºè®¾"},{"content":"1ã€pythonä¸å…¶ä»–è¯­è¨€çš„å¯¹æ¯”ï¼ˆhello worldï¼‰  Cè¯­è¨€\n include\u0026lt;stdio.h\u0026gt; int main() { printf(\u0026#34;hello world\u0026#34;); return 0; }  Javaè¯­è¨€\n public class HelloWorld{ public static void main(String[] args) { System.out.println(\u0026#34;Hello World!\u0026#34;); } }  Python\n print(\u0026#39;hello world\u0026#39;) 2ã€pythonä¸­çš„å¸¸ç”¨æ•°æ®ç±»å‹  Number String List Tuple Dictionary  # Number a = 1 b = True c = 3.15 d = 1.1+2.2j # å­—ç¬¦ä¸² str1 = \u0026#39;hello\u0026#39; str1_1 = \u0026#34;hello\u0026#34; str2 = \u0026#34;world\u0026#34; print(str1==str1_1) # å­—ç¬¦ä¸²è¿æ¥ str3 = str1 + str2 print(str3) # è½¬ä¹‰å­—ç¬¦ str4 = \u0026#39;hello \\nworld\u0026#39; print(str4) str5 = \u0026#39;hello \\\\n world\u0026#39; print(str5) # æ ¼å¼åŒ–è¾“å‡º print(\u0026#39;str1:%s.\u0026#39;%str1) # åˆ‡ç‰‡ print(str1[1:4]) True helloworld hello world hello \\n world str1:hello. ell  # åˆ—è¡¨ list1 = [\u0026#39;google\u0026#39;, \u0026#39;alibaba\u0026#39;, 2001, 3.14] # é€šè¿‡ä¸‹æ ‡è®¿é—® print(list1[0]) # æ›´æ–°åˆ—è¡¨ list1[2] = \u0026#39;baidu\u0026#39; print(list1) # åˆ é™¤å…ƒç´  del list1[3] print(list1) # æ‹¼æ¥åˆ—è¡¨ list2 = [\u0026#39;microsoft\u0026#39;, \u0026#39;amazon\u0026#39;] list3 = list1 + list2 print(list3) # å¢æ·»åˆ—è¡¨é¡¹ list1.append(\u0026#39;jingdong\u0026#39;) print(list1) google ['google', 'alibaba', 'baidu', 3.14] ['google', 'alibaba', 'baidu'] ['google', 'alibaba', 'baidu', 'microsoft', 'amazon'] ['google', 'alibaba', 'baidu', 'jingdong']  # å…ƒç»„ï¼šç±»ä¼¼åˆ—è¡¨,æ˜¯ä¸€ç³»åˆ—å…ƒç´ çš„æœ‰åºé›†åˆ,ä½†å…ƒç»„ä¸­çš„å…ƒç´ æ— æ³•ä¿®æ”¹ tuple1 = (\u0026#39;google\u0026#39;, \u0026#39;alibaba\u0026#39;, \u0026#39;baidu\u0026#39;) tuple1[0] = \u0026#39;amazon\u0026#39; # ä¸èƒ½è¢«æ”¹å˜ --------------------------------------------------------------------------- TypeError Traceback (most recent call last) \u0026lt;ipython-input-23-4ed3e334c834\u0026gt; in \u0026lt;module\u0026gt; 1 # å…ƒç»„ï¼šç±»ä¼¼åˆ—è¡¨,æ˜¯ä¸€ç³»åˆ—å…ƒç´ çš„æœ‰åºé›†åˆ,ä½†å…ƒç»„ä¸­çš„å…ƒç´ æ— æ³•ä¿®æ”¹ 2 tuple1 = ('google', 'alibaba', 'baidu') ----\u0026gt; 3 tuple1[0] = 'amazon' TypeError: 'tuple' object does not support item assignment  # å­—å…¸ dict1 = { \u0026#39;color\u0026#39;: \u0026#39;green\u0026#39;, \u0026#39;points\u0026#39;: 5 } # è®¿é—®åˆ—è¡¨ä¸­çš„å€¼ print(dict1[\u0026#39;color\u0026#39;]) # å¢åŠ å­—å…¸ä¸­é”®å€¼å¯¹ dict1[\u0026#39;x_pos\u0026#39;] = 0 dict1[\u0026#39;y_pos\u0026#39;] =4 print(dict1) green {'color': 'green', 'points': 5, 'x_pos': 0, 'y_pos': 4}  3ã€pythonä¸­çš„ç»“æ„è¯­å¥ 3.1ã€ifæ¡ä»¶è¯­å¥ car = \u0026#39;bmw\u0026#39; if car == \u0026#39;bmw\u0026#39;: print(car.upper()) # è¾“å‡ºcarçš„å¤§å†™ç‰ˆæœ¬ else: print(car.title()) # è¾“å‡ºcarçš„æ ‡é¢˜ç‰ˆæœ¬ Bmw  ç°å®ä¸–ç•Œä¸­,å¾ˆå¤šæƒ…å†µä¸‹éœ€è¦è€ƒè™‘çš„æƒ…å½¢éƒ½è¶…è¿‡ä¸¤ä¸ªã€‚ä¾‹å¦‚,æ¥çœ‹ä¸€ä¸ªæ ¹æ®å¹´é¾„æ®µæ”¶è´¹çš„ æ¸¸ä¹åœº:\n 4å²ä»¥ä¸‹å…è´¹; 4~18å²æ”¶è´¹5ç¾å…ƒ; 18å²(å«)ä»¥ä¸Šæ”¶è´¹10ç¾å…ƒã€‚   å¦‚æœåªä½¿ç”¨ä¸€æ¡ if è¯­å¥,å¦‚ä½•ç¡®å®šé—¨ç¥¨ä»·æ ¼å‘¢?ä¸‹é¢çš„ä»£ç ç¡®å®šä¸€ä¸ªäººæ‰€å±çš„å¹´é¾„æ®µ,å¹¶æ‰“å°ä¸€æ¡åŒ…å«é—¨ç¥¨ä»·æ ¼çš„æ¶ˆæ¯:\n age = 12 if age \u0026lt; 4: print(\u0026#34;Your admission cost is $0.\u0026#34;) elif age \u0026lt; 18: print(\u0026#34;Your admission cost is $5.\u0026#34;) else: print(\u0026#34;Your admission cost is $10.\u0026#34;) Your admission cost is $5.  3.2ã€forå¾ªç¯è¯­å¥ fruits = [\u0026#39;banana\u0026#39;, \u0026#39;apple\u0026#39;, \u0026#39;mango\u0026#39;] for fruit in fruits: print(\u0026#39;å½“å‰æ°´æœï¼š%s\u0026#39;%fruit) å½“å‰æ°´æœï¼šbanana å½“å‰æ°´æœï¼šapple å½“å‰æ°´æœï¼šmango  # range æ­¥é•¿ä¸º1 for i in range(0, 6): print(i) 1 2 3 4 5  # range æ­¥é•¿ä¸º2 for i in range(0, 6, 2): print(i) 0 2 4  # break å’Œ continue for i in range(0, 6): if i == 3: break print(i) for i in range(0, 6): if i == 3: continue print(i, end=\u0026#39;\u0026#39;) 0 1 2 01245  3.3ã€whileå¾ªç¯è¯­å¥ # whileå¾ªç¯ current_number = 1 while current_number \u0026lt;= 5: print(current_number) current_number += 1 1 2 3 4 5  3.4ã€å‡½æ•° def greet_user(username): \u0026#34;\u0026#34;\u0026#34; æ˜¾ç¤ºç®€å•çš„é—®å€™è¯­ \u0026#34;\u0026#34;\u0026#34; print(\u0026#34;Hello, \u0026#34; + username.title() + \u0026#34;!\u0026#34;) greet_user(\u0026#39;jesse\u0026#39;) greet_user(\u0026#39;jack\u0026#39;) Hello, Jesse! Hello, Jack!  # æœ‰è¿”å›å€¼çš„å‡½æ•° def add(a, b): return a+b print(\u0026#39;ç¬¬ä¸€ä¸ªå‡½æ•°ï¼š%d\u0026#39;%add(2, 3)) # åˆ—è¡¨ä½œä¸ºå‚æ•°çš„å‡½æ•° def add_l(mylist): result = 0 for l in mylist: result += l return result print(\u0026#39;ç¬¬äºŒä¸ªå‡½æ•°ï¼š%d\u0026#39;%add_l([1, 2, 3, 4])) # æœ‰å¤šä¸ªè¿”å›å€¼çš„å‡½æ•° def muti_re(mylist): a = max(mylist) b = min(mylist) return a, b a, b = muti_re([1, 2, 3, 4]) print(\u0026#39;ç¬¬ä¸‰ä¸ªå‡½æ•°, æœ€å¤§å€¼ï¼š%d, æœ€å°å€¼ï¼š%d\u0026#39;%(a,b)) ç¬¬ä¸€ä¸ªå‡½æ•°ï¼š5 ç¬¬äºŒä¸ªå‡½æ•°ï¼š10 ç¬¬ä¸‰ä¸ªå‡½æ•°, æœ€å¤§å€¼ï¼š4, æœ€å°å€¼ï¼š1  æœ‰æ—¶å€™,ä½ é¢„å…ˆä¸çŸ¥é“å‡½æ•°éœ€è¦æ¥å—å¤šå°‘ä¸ªå®å‚, ä½†æ˜¯Pythonå…è®¸å‡½æ•°ä»è°ƒç”¨è¯­å¥ä¸­æ”¶é›†ä»»æ„æ•°é‡çš„å®å‚ã€‚\n ä¾‹å¦‚,æ¥çœ‹ä¸€ä¸ªåˆ¶ä½œæ¯”è¨çš„å‡½æ•°,å®ƒéœ€è¦æ¥å—å¾ˆå¤šé…æ–™,ä½†ä½ æ— æ³•é¢„å…ˆç¡®å®šé¡¾å®¢è¦å¤šå°‘ç§é… æ–™ã€‚ä¸‹é¢çš„å‡½æ•°åªæœ‰ä¸€ä¸ªå½¢å‚ *toppings ,ä½†ä¸ç®¡è°ƒç”¨è¯­å¥æä¾›äº†å¤šå°‘å®å‚,è¿™ä¸ªå½¢å‚éƒ½å°†å®ƒä»¬ ç»Ÿç»Ÿæ”¶å…¥å›Šä¸­:\n def make_pizza(*toppings): print(toppings) make_pizza(\u0026#39;pepperoni\u0026#39;) make_pizza(\u0026#39;mushrooms\u0026#39;, \u0026#39;green peppers\u0026#39;, \u0026#39;extra cheese\u0026#39;) ('pepperoni',) ('mushrooms', 'green peppers', 'extra cheese')  3.5ã€ç±» é¢å‘å¯¹è±¡ç¼–ç¨‹æ˜¯æœ€æœ‰æ•ˆçš„è½¯ä»¶ç¼–å†™æ–¹æ³•ä¹‹ä¸€ã€‚åœ¨é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­, ä½ ç¼–å†™è¡¨ç¤ºç°å®ä¸–ç•Œä¸­çš„äº‹ç‰©å’Œæƒ…æ™¯çš„ç±»,å¹¶åŸºäºè¿™äº›ç±»æ¥åˆ›å»ºå¯¹è±¡ã€‚ ç¼–å†™ç±»æ—¶,ä½ å®šä¹‰ä¸€å¤§ç±»å¯¹è±¡éƒ½æœ‰çš„é€šç”¨è¡Œä¸ºã€‚åŸºäºç±»åˆ›å»ºå¯¹è±¡æ—¶, æ¯ä¸ªå¯¹è±¡éƒ½è‡ªåŠ¨å…·å¤‡è¿™ç§é€šç”¨è¡Œä¸º,ç„¶åå¯æ ¹æ®éœ€è¦èµ‹äºˆæ¯ä¸ªå¯¹è±¡ç‹¬ ç‰¹çš„ä¸ªæ€§ã€‚ä½¿ç”¨é¢å‘å¯¹è±¡ç¼–ç¨‹å¯æ¨¡æ‹Ÿç°å®æƒ…æ™¯,å…¶é€¼çœŸç¨‹åº¦è¾¾åˆ°äº†ä»¤ ä½ æƒŠè®¶çš„åœ°æ­¥ã€‚ æ ¹æ®ç±»æ¥åˆ›å»ºå¯¹è±¡è¢«ç§°ä¸ºå®ä¾‹åŒ–,è¿™è®©ä½ èƒ½å¤Ÿä½¿ç”¨ç±»çš„å®ä¾‹ã€‚åœ¨ æœ¬ç« ä¸­,ä½ å°†ç¼–å†™ä¸€äº›ç±»å¹¶åˆ›å»ºå…¶å®ä¾‹ã€‚ä½ å°†æŒ‡å®šå¯åœ¨å®ä¾‹ä¸­å­˜å‚¨ä»€ ä¹ˆä¿¡æ¯,å®šä¹‰å¯å¯¹è¿™äº›å®ä¾‹æ‰§è¡Œå“ªäº›æ“ä½œã€‚ä½ è¿˜å°†ç¼–å†™ä¸€äº›ç±»æ¥æ‰©å±• æ—¢æœ‰ç±»çš„åŠŸèƒ½,è®©ç›¸ä¼¼çš„ç±»èƒ½å¤Ÿé«˜æ•ˆåœ°å…±äº«ä»£ç ã€‚ä½ å°†æŠŠè‡ªå·±ç¼–å†™çš„ç±»å­˜å‚¨åœ¨æ¨¡å—ä¸­,å¹¶åœ¨ è‡ªå·±çš„ç¨‹åºæ–‡ä»¶ä¸­å¯¼å…¥å…¶ä»–ç¨‹åºå‘˜ç¼–å†™çš„ç±»\nä½¿ç”¨ç±»å‡ ä¹å¯ä»¥æ¨¡æ‹Ÿä»»ä½•ä¸œè¥¿ã€‚ä¸‹é¢æ¥ç¼–å†™ä¸€ä¸ªè¡¨ç¤ºå°ç‹—çš„ç®€å•ç±» Dog â€”â€”å®ƒè¡¨ç¤ºçš„ä¸æ˜¯ç‰¹ å®šçš„å°ç‹—,è€Œæ˜¯ä»»ä½•å°ç‹—ã€‚å¯¹äºå¤§å¤šæ•°å® ç‰©ç‹—,æˆ‘ä»¬éƒ½çŸ¥é“äº›ä»€ä¹ˆå‘¢?å®ƒä»¬éƒ½æœ‰åå­—å’Œå¹´é¾„;æˆ‘ ä»¬è¿˜çŸ¥é“,å¤§å¤šæ•°å°ç‹—è¿˜ä¼šè¹²ä¸‹å’Œæ‰“æ»šã€‚ç”±äºå¤§å¤šæ•°å°ç‹—éƒ½å…·å¤‡ä¸Šè¿°ä¸¤é¡¹ä¿¡æ¯(åå­—å’Œå¹´é¾„)å’Œ ä¸¤ç§è¡Œä¸º(è¹²ä¸‹å’Œæ‰“æ»š),æˆ‘ä»¬çš„ Dog ç±»å°†åŒ…å«å®ƒä»¬ã€‚è¿™ä¸ªç±»è®©PythonçŸ¥é“å¦‚ä½•åˆ›å»ºè¡¨ç¤ºå°ç‹—çš„å¯¹ è±¡ã€‚ç¼–å†™è¿™ä¸ªç±»å,æˆ‘ä»¬å°†ä½¿ç”¨å®ƒæ¥åˆ›å»ºè¡¨ç¤ºç‰¹å®šå°ç‹—çš„å®ä¾‹ã€‚\n# åˆ›å»ºç±» class Dog(): def __init__(self, name, age): self.name = name self.age = age def sit(self): print(self.name.title() + \u0026#34; is now sitting.\u0026#34;) def roll_over(self): print(self.name.title() + \u0026#34; rolled over!\u0026#34;)å¯¹å­—ç¬¦ä¸²çš„å¤§å°å†™è¿›è¡Œæ›´æ”¹ ç±»ä¸­çš„å‡½æ•°ç§°ä¸ºæ–¹æ³•;ä½ å‰é¢å­¦åˆ°çš„æœ‰å…³å‡½æ•°çš„ä¸€åˆ‡éƒ½é€‚ç”¨äºæ–¹æ³•,å°±ç›®å‰è€Œè¨€,å”¯ä¸€é‡è¦ çš„å·®åˆ«æ˜¯è°ƒç”¨æ–¹æ³•çš„æ–¹å¼ã€‚æ–¹æ³• init() æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ–¹æ³•,æ¯å½“ä½ æ ¹æ® Dog ç±»åˆ›å»ºæ–°å® ä¾‹æ—¶,Pythonéƒ½ä¼šè‡ªåŠ¨è¿è¡Œå®ƒã€‚åœ¨è¿™ä¸ªæ–¹æ³•çš„åç§°ä¸­,å¼€å¤´å’Œæœ«å°¾å„æœ‰ä¸¤ä¸ªä¸‹åˆ’çº¿,è¿™æ˜¯ä¸€ç§çº¦ å®š,æ—¨åœ¨é¿å…Pythoné»˜è®¤æ–¹æ³•ä¸æ™®é€šæ–¹æ³•å‘ç”Ÿåç§°å†²çªã€‚\n# æ ¹æ®ç±»åˆ›å»ºå®ä¾‹ my_dog = Dog(\u0026#39;willie\u0026#39;, 6) print(\u0026#34;My dog\u0026#39;s name is \u0026#34; + my_dog.name.title() + \u0026#34;.\u0026#34;) print(\u0026#34;My dog is \u0026#34; + str(my_dog.age) + \u0026#34; years old.\u0026#34;) My dog's name is Willie. My dog is 6 years old.  # è®¿é—®ç±»çš„å±æ€§ my_dog.name 'willie'  # è°ƒç”¨ç±»çš„æ–¹æ³• my_dog.sit() my_dog.roll_over() Willie is now sitting. Willie rolled over!  4ã€å¯¹å­—ç¬¦ä¸²çš„ä¸€äº›æ“ä½œ 4.1ã€å¯¹å­—ç¬¦ä¸²çš„å¤§å°å†™è¿›è¡Œæ›´æ”¹ # å¯¹å­—ç¬¦ä¸²çš„å¤§å°å†™è¿›è¡Œæ›´æ”¹ name = \u0026#34;ada lovelace\u0026#34; print(name.title()) name = \u0026#34;Ada Lovelace\u0026#34; print(name.upper()) print(name.lower()) Ada Lovelace ADA LOVELACE ada lovelace  4.2ã€åˆå¹¶/æ‹¼æ¥å­—ç¬¦ä¸² first_name = \u0026#34;ada\u0026#34; last_name = \u0026#34;lovelace\u0026#34; full_name = first_name + \u0026#34; \u0026#34; + last_name print(full_name) ada lovelace  4.3ã€ä½¿ç”¨åˆ¶è¡¨ç¬¦æˆ–æ¢è¡Œç¬¦æ¥æ·»åŠ ç©ºç™½ print(\u0026#34;\\tPython\u0026#34;) print(\u0026#34;Languages:\\nPython\\nC\\nJavaScript\u0026#34;)  Python Languages: Python C JavaScript  4.4ã€åˆ é™¤ç©ºç™½ favorite_language = \u0026#39; python \u0026#39; # åˆ é™¤æœ«å°¾çš„ç©ºç™½ favorite_language.rstrip() # åˆ é™¤å¼€å¤´çš„ç©ºç™½ favorite_language.lstrip() 'python '  4.5ã€å­—ç¬¦ä¸²åˆ†å‰² my_languages = \u0026#39;python,C,JAVA,PHP,MATLAB\u0026#39; languages_list = my_languages.split(\u0026#39;,\u0026#39;) print(languages_list) print(languages_list[0]) print(languages_list[0][3]) ['python', 'C', 'JAVA', 'PHP', 'MATLAB'] python h  ä¹ é¢˜ 1ã€æ‰“å°å‡º99ä¹˜æ³•è¡¨ 2ã€åˆ¤æ–­æ˜¯å¦æ˜¯é—°å¹´ 3ã€ç¼–å†™Pythonç¨‹åºè®¡ç®—æ–æ³¢é‚£å¥‘æ•°åˆ—ï¼Œè¦æ±‚ï¼šè¾“å…¥åºå·nï¼Œè¾“å‡ºæ•°åˆ—çš„ç¬¬né¡¹ï¼Œæ•°åˆ—çš„è®¡ç®—ç”¨å‡½æ•°å®ç° 4ã€ä½¿ç”¨é¢å‘å¯¹è±¡çš„æ€æƒ³ï¼Œ åˆ›å»ºä¸€ä¸ªåä¸º User çš„ç±»,å…¶ä¸­åŒ…å«å±æ€§ first_name å’Œ last_name ,è¿˜æœ‰ç”¨æˆ·ç®€ä»‹é€šå¸¸ä¼šå­˜å‚¨çš„å…¶ä»–å‡ ä¸ªå±æ€§ã€‚åœ¨ç±» User ä¸­å®šä¹‰ä¸€ä¸ªåä¸º describe_user() çš„æ–¹æ³•,å®ƒæ‰“å°ç”¨æˆ·ä¿¡æ¯æ‘˜è¦;å†å®šä¹‰ä¸€ä¸ªåä¸º greet_user() çš„æ–¹æ³•,å®ƒå‘ç”¨æˆ·å‘å‡ºä¸ªæ€§åŒ–çš„é—®å€™ã€‚ åˆ›å»ºå¤šä¸ªè¡¨ç¤ºä¸åŒç”¨æˆ·çš„å®ä¾‹,å¹¶å¯¹æ¯ä¸ªå®ä¾‹éƒ½è°ƒç”¨ä¸Šè¿°ä¸¤ä¸ªæ–¹æ³•ã€‚ ","permalink":"http://yangchnet.github.io/Dessert/posts/python/python%E5%9F%BA%E7%A1%80/","summary":"1ã€pythonä¸å…¶ä»–è¯­è¨€çš„å¯¹æ¯”ï¼ˆhello worldï¼‰  Cè¯­è¨€\n include\u0026lt;stdio.h\u0026gt; int main() { printf(\u0026#34;hello world\u0026#34;); return 0; }  Javaè¯­è¨€\n public class HelloWorld{ public static void main(String[] args) { System.out.println(\u0026#34;Hello World!\u0026#34;); } }  Python\n print(\u0026#39;hello world\u0026#39;) 2ã€pythonä¸­çš„å¸¸ç”¨æ•°æ®ç±»å‹  Number String List Tuple Dictionary  # Number a = 1 b = True c = 3.15 d = 1.1+2.2j # å­—ç¬¦ä¸² str1 = \u0026#39;hello\u0026#39; str1_1 = \u0026#34;hello\u0026#34; str2 = \u0026#34;world\u0026#34; print(str1==str1_1) # å­—ç¬¦ä¸²è¿æ¥ str3 = str1 + str2 print(str3) # è½¬ä¹‰å­—ç¬¦ str4 = \u0026#39;hello \\nworld\u0026#39; print(str4) str5 = \u0026#39;hello \\\\n world\u0026#39; print(str5) # æ ¼å¼åŒ–è¾“å‡º print(\u0026#39;str1:%s.","title":"1ã€pythonä¸å…¶ä»–è¯­è¨€çš„å¯¹æ¯”ï¼ˆhelloworldï¼‰"},{"content":"CentOSå®‰è£…Pythonç¯å¢ƒ åæ§½ï¼šç½‘ä¸Šä¸€å †ä»å®˜ç½‘è·å–å®‰è£…åŒ…ç„¶åè‡ªå·±ç¼–è¯‘çš„ï¼Œæ…¢ä¸è¯´ï¼Œè¿˜å®¹æ˜“å‡ºé”™\nå¯ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…Python3ç¯å¢ƒï¼š\n   yum install rh-python36 ä½¿ç”¨è¿™æ¡å‘½ä»¤ï¼Œå®‰è£…Python3.6ï¼Œä½†æ˜¯å®‰è£…åæ‰¾ä¸åˆ°ï¼Œè¾“å…¥Python3åè¿˜æ˜¯æ‰¾ä¸åˆ°å‘½ä»¤\n scl enable rh-python36 bash\nä¸Šé¢çš„å‘½ä»¤æ˜¯è°ƒç”¨/opt/rh/rh-python36/enableæ›´æ”¹shellç¯å¢ƒå˜é‡çš„è„šæœ¬ã€‚\nå¦‚æœå†æ¬¡æ£€æŸ¥Pythonç‰ˆæœ¬ï¼Œä½ ä¼šå‘ç°Python 3.6ç°åœ¨æ˜¯å½“å‰shellä¸­çš„é»˜è®¤ç‰ˆæœ¬ã€‚ éœ€è¦æŒ‡å‡ºçš„æ˜¯ï¼ŒPython 3.6ä»…åœ¨æ­¤shellä¼šè¯ä¸­è®¾ç½®ä¸ºé»˜è®¤çš„Pythonç‰ˆæœ¬ã€‚å¦‚æœé€€å‡ºä¼šè¯æˆ–ä»å¦ä¸€ä¸ªç»ˆç«¯æ‰“å¼€ä¸€ä¸ªæ–°ä¼šè¯ï¼ŒPython 2.7å°†æ˜¯é»˜è®¤çš„Pythonç‰ˆæœ¬ã€‚\n  å¯ä½¿ç”¨å½“å‰shellçª—å£å»ºç«‹ä¸€ä¸ªPython3è™šæ‹Ÿç¯å¢ƒï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨Python3\n  #é¦–å…ˆï¼Œåˆ›å»ºé¡¹ç›®ç›®å½•å¹¶åˆ‡æ¢åˆ°å®ƒï¼š mkdir ~/my_new_project cd ~/my_new_project #ä½¿ç”¨è¯¥sclå·¥å…·æ¿€æ´»Python 3.6 ï¼š sl enable rh-python36 bash # ä»é¡¹ç›®æ ¹ç›®å½•å†…éƒ¨è¿è¡Œä»¥ä¸‹å‘½ä»¤ä»¥åˆ›å»ºåä¸ºçš„è™šæ‹Ÿç¯å¢ƒmy_project_venvï¼š python -m venv my_project_venv #è¦é¦–å…ˆä½¿ç”¨è™šæ‹Ÿç¯å¢ƒï¼Œæˆ‘ä»¬éœ€è¦è¾“å…¥ä»¥ä¸‹å‘½ä»¤æ¥æ¿€æ´»å®ƒï¼š source my_project_venv/bin/activate #æ¿€æ´»ç¯å¢ƒåï¼Œshellæç¤ºç¬¦å°†ä»¥ç¯å¢ƒåç§°ä½œä¸ºå‰ç¼€ï¼š (my_project_venv) user@host:~/my_new_project$ ","permalink":"http://yangchnet.github.io/Dessert/posts/linux/centos%E5%AE%89%E8%A3%85python%E7%8E%AF%E5%A2%83/","summary":"CentOSå®‰è£…Pythonç¯å¢ƒ åæ§½ï¼šç½‘ä¸Šä¸€å †ä»å®˜ç½‘è·å–å®‰è£…åŒ…ç„¶åè‡ªå·±ç¼–è¯‘çš„ï¼Œæ…¢ä¸è¯´ï¼Œè¿˜å®¹æ˜“å‡ºé”™\nå¯ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…Python3ç¯å¢ƒï¼š\n   yum install rh-python36 ä½¿ç”¨è¿™æ¡å‘½ä»¤ï¼Œå®‰è£…Python3.6ï¼Œä½†æ˜¯å®‰è£…åæ‰¾ä¸åˆ°ï¼Œè¾“å…¥Python3åè¿˜æ˜¯æ‰¾ä¸åˆ°å‘½ä»¤\n scl enable rh-python36 bash\nä¸Šé¢çš„å‘½ä»¤æ˜¯è°ƒç”¨/opt/rh/rh-python36/enableæ›´æ”¹shellç¯å¢ƒå˜é‡çš„è„šæœ¬ã€‚\nå¦‚æœå†æ¬¡æ£€æŸ¥Pythonç‰ˆæœ¬ï¼Œä½ ä¼šå‘ç°Python 3.6ç°åœ¨æ˜¯å½“å‰shellä¸­çš„é»˜è®¤ç‰ˆæœ¬ã€‚ éœ€è¦æŒ‡å‡ºçš„æ˜¯ï¼ŒPython 3.6ä»…åœ¨æ­¤shellä¼šè¯ä¸­è®¾ç½®ä¸ºé»˜è®¤çš„Pythonç‰ˆæœ¬ã€‚å¦‚æœé€€å‡ºä¼šè¯æˆ–ä»å¦ä¸€ä¸ªç»ˆç«¯æ‰“å¼€ä¸€ä¸ªæ–°ä¼šè¯ï¼ŒPython 2.7å°†æ˜¯é»˜è®¤çš„Pythonç‰ˆæœ¬ã€‚\n  å¯ä½¿ç”¨å½“å‰shellçª—å£å»ºç«‹ä¸€ä¸ªPython3è™šæ‹Ÿç¯å¢ƒï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨Python3\n  #é¦–å…ˆï¼Œåˆ›å»ºé¡¹ç›®ç›®å½•å¹¶åˆ‡æ¢åˆ°å®ƒï¼š mkdir ~/my_new_project cd ~/my_new_project #ä½¿ç”¨è¯¥sclå·¥å…·æ¿€æ´»Python 3.6 ï¼š sl enable rh-python36 bash # ä»é¡¹ç›®æ ¹ç›®å½•å†…éƒ¨è¿è¡Œä»¥ä¸‹å‘½ä»¤ä»¥åˆ›å»ºåä¸ºçš„è™šæ‹Ÿç¯å¢ƒmy_project_venvï¼š python -m venv my_project_venv #è¦é¦–å…ˆä½¿ç”¨è™šæ‹Ÿç¯å¢ƒï¼Œæˆ‘ä»¬éœ€è¦è¾“å…¥ä»¥ä¸‹å‘½ä»¤æ¥æ¿€æ´»å®ƒï¼š source my_project_venv/bin/activate #æ¿€æ´»ç¯å¢ƒåï¼Œshellæç¤ºç¬¦å°†ä»¥ç¯å¢ƒåç§°ä½œä¸ºå‰ç¼€ï¼š (my_project_venv) user@host:~/my_new_project$ ","title":"CentOSå®‰è£…Pythonç¯å¢ƒ"},{"content":"Django, Forms ä½¿ç”¨formså®Œæˆäº†ç”¨æˆ·ç™»å½• 1ã€åˆ›å»ºmodel class User(User): pass  è¿™é‡Œä½¿ç”¨äº†djangoæä¾›çš„Userç±»ï¼Œç›´æ¥ç»§æ‰¿\n2ã€åˆ›å»ºUserFormç±» class SigninFrom(forms.Form): user_name = forms.CharField() user_email = forms.EmailField() user_password = forms.CharField() 3ã€å®Œæˆæ¨¡æ¿ \u0026lt;form action=\u0026#34;{% url \u0026#39;permission:signin\u0026#39; %}\u0026#34; accept-charset=\u0026#34;UTF-8\u0026#34; method=\u0026#34;post\u0026#34;\u0026gt; \u0026lt;input name=\u0026#34;utf8\u0026#34; type=\u0026#34;hidden\u0026#34; value=\u0026#34;\u0026amp;#x2713;\u0026#34;/\u0026gt; {% csrf_token %} \u0026lt;dl class=\u0026#34;form-group mt-0\u0026#34;\u0026gt; \u0026lt;dt class=\u0026#34;input-label\u0026#34;\u0026gt; \u0026lt;label class=\u0026#34;form-label f5\u0026#34; for=\u0026#34;user[login]\u0026#34;\u0026gt;ç”¨æˆ·å\u0026lt;/label\u0026gt; \u0026lt;/dt\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; name=\u0026#34;user_name\u0026#34; id=\u0026#34;user_name\u0026#34; class=\u0026#34;form-control form-control-lg input-block\u0026#34; placeholder=\u0026#34;{{ default_name }}\u0026#34; autofocus\u0026gt; \u0026lt;/dl\u0026gt; \u0026lt;dl class=\u0026#34;form-group\u0026#34;\u0026gt; \u0026lt;dt class=\u0026#34;input-label\u0026#34;\u0026gt; \u0026lt;label class=\u0026#34;form-label f5\u0026#34; for=\u0026#34;user[email]\u0026#34;\u0026gt;Email\u0026lt;/label\u0026gt; \u0026lt;/dt\u0026gt; \u0026lt;dd\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; name=\u0026#34;user_email\u0026#34; id=\u0026#34;user_email\u0026#34; class=\u0026#34;form-control form-control-lg input-block js-email-notice-trigger\u0026#34; placeholder=\u0026#34;you@example.com\u0026#34;\u0026gt; \u0026lt;/dd\u0026gt; \u0026lt;/dl\u0026gt; \u0026lt;dl class=\u0026#34;form-group\u0026#34;\u0026gt; \u0026lt;dt class=\u0026#34;input-label\u0026#34;\u0026gt; \u0026lt;label class=\u0026#34;form-label f5\u0026#34; for=\u0026#34;user[password]\u0026#34;\u0026gt;å¯†ç \u0026lt;/label\u0026gt; \u0026lt;/dt\u0026gt; \u0026lt;dd\u0026gt; \u0026lt;input type=\u0026#34;password\u0026#34; name=\u0026#34;user_password\u0026#34; id=\u0026#34;user_password\u0026#34; class=\u0026#34;form-control form-control-lg input-block\u0026#34; placeholder=\u0026#34;Create a password\u0026#34;\u0026gt; \u0026lt;/dd\u0026gt; \u0026lt;/dl\u0026gt; \u0026lt;button class=\u0026#34;btn-mktg btn-primary-mktg btn-large-mktg f4 btn-block\u0026#34; type=\u0026#34;submit\u0026#34; data-ga-click=\u0026#34;Signup, Attempt, location:teams;\u0026#34;\u0026gt;åœ¨Bodydetectä¸Šæ³¨å†Œ \u0026lt;/button\u0026gt; \u0026lt;/form\u0026gt;  æ³¨æ„ï¼Œè¿™é‡Œä¸‰è€…è¦ç»Ÿä¸€ç”¨ä¸€æ ·çš„nameï¼Œå¦åˆ™ä¼šæ¥æ”¶ä¸åˆ°æ•°æ®  views.pyå¦‚ä½•ç¼–å†™ def fun(request): if request.method == \u0026#39;GET\u0026#39;: ... return ... if request.method == \u0026#39;POST\u0026#39;: ... return  ä½¿ç”¨forms.cleaned_dataè®¿é—®æ•°æ®ï¼Œè¿”å›å­—å…¸ç±»å‹  ä½ è¿˜å¯ä»¥  ä»viewä¸­è¿”å›formï¼Œdjangoä¼šè‡ªåŠ¨ä¸ºä½ æ¸²æŸ“ï¼Œå½“ç„¶ï¼Œååˆ†ä¸‘é™‹  ä¾‹å¦‚ï¼š\n\u0026lt;form action = \u0026#34;{% url \u0026#39;permission:signin\u0026#39; %}\u0026#34; method=\u0026#34;post\u0026#34;\u0026gt; {% csrf_token %} \u0026lt;table\u0026gt; {{ form }} \u0026lt;/table\u0026gt; \u0026lt;button class=\u0026#34;btn-mktg btn-primary-mktg btn-large-mktg f4 btn-block\u0026#34; type=\u0026#34;submit\u0026#34; data-ga-click=\u0026#34;Signup, Attempt, location:teams;\u0026#34;\u0026gt;åœ¨Bodydetectä¸Šæ³¨å†Œ \u0026lt;/button\u0026gt; \u0026lt;/form\u0026gt; åªéœ€è¦ä¸ºformä¿ç•™ä½ç½®\næ¸²æŸ“ç»“æœï¼š\nä¸ä½¿ç”¨è‡ªåŠ¨æ¸²æŸ“\nä½¿ç”¨ModelFormç±»  views.py\n from django.db import models class Article(models.Model): author = models.CharField(max_length = 150) title = models.CharField(max_lengeth = 100) content = models.CharField(max_lengeth = 10000) time = models.TimeField( )  model.py\n from django.forms import ModelForm class Article(ModelForm): class Meta: model = Article fields = [\u0026#39;author\u0026#39;, \u0026#39;title\u0026#39;, \u0026#39;content\u0026#39;, \u0026#39;time\u0026#39;] saveæ–¹æ³•  æ¯ä¸ªModelFormè¿˜æœ‰ä¸€ä¸ªsave()æ–¹æ³•ï¼Œæ­¤æ–¹æ³•æ ¹æ®ç»‘å®šåˆ°è¡¨å•çš„æ•°æ®åˆ›å»ºå¹¶ä¿å­˜æ•°æ®åº“å¯¹è±¡ã€‚   # Create a form instance with POST data. \u0026gt;\u0026gt;\u0026gt; f = AuthorForm(request.POST) # Create, but don't save the new author instance. \u0026gt;\u0026gt;\u0026gt; new_author = f.save(commit=False) # Modify the author in some way. \u0026gt;\u0026gt;\u0026gt; new_author.some_field = 'some_value' # Save the new instance. \u0026gt;\u0026gt;\u0026gt; new_author.save() # Now, save the many-to-many data for the form. \u0026gt;\u0026gt;\u0026gt; f.save_m2m() Reference Django æ•™ç¨‹ 9: ä½¿ç”¨è¡¨å•\nä»æ¨¡å‹åˆ›å»ºè¡¨å• | Django documentation | Django\nThe Forms API | Django documentation | Django\n","permalink":"http://yangchnet.github.io/Dessert/posts/django/django-form/","summary":"Django, Forms ä½¿ç”¨formså®Œæˆäº†ç”¨æˆ·ç™»å½• 1ã€åˆ›å»ºmodel class User(User): pass  è¿™é‡Œä½¿ç”¨äº†djangoæä¾›çš„Userç±»ï¼Œç›´æ¥ç»§æ‰¿\n2ã€åˆ›å»ºUserFormç±» class SigninFrom(forms.Form): user_name = forms.CharField() user_email = forms.EmailField() user_password = forms.CharField() 3ã€å®Œæˆæ¨¡æ¿ \u0026lt;form action=\u0026#34;{% url \u0026#39;permission:signin\u0026#39; %}\u0026#34; accept-charset=\u0026#34;UTF-8\u0026#34; method=\u0026#34;post\u0026#34;\u0026gt; \u0026lt;input name=\u0026#34;utf8\u0026#34; type=\u0026#34;hidden\u0026#34; value=\u0026#34;\u0026amp;#x2713;\u0026#34;/\u0026gt; {% csrf_token %} \u0026lt;dl class=\u0026#34;form-group mt-0\u0026#34;\u0026gt; \u0026lt;dt class=\u0026#34;input-label\u0026#34;\u0026gt; \u0026lt;label class=\u0026#34;form-label f5\u0026#34; for=\u0026#34;user[login]\u0026#34;\u0026gt;ç”¨æˆ·å\u0026lt;/label\u0026gt; \u0026lt;/dt\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; name=\u0026#34;user_name\u0026#34; id=\u0026#34;user_name\u0026#34; class=\u0026#34;form-control form-control-lg input-block\u0026#34; placeholder=\u0026#34;{{ default_name }}\u0026#34; autofocus\u0026gt; \u0026lt;/dl\u0026gt; \u0026lt;dl class=\u0026#34;form-group\u0026#34;\u0026gt; \u0026lt;dt class=\u0026#34;input-label\u0026#34;\u0026gt; \u0026lt;label class=\u0026#34;form-label f5\u0026#34; for=\u0026#34;user[email]\u0026#34;\u0026gt;Email\u0026lt;/label\u0026gt; \u0026lt;/dt\u0026gt; \u0026lt;dd\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; name=\u0026#34;user_email\u0026#34; id=\u0026#34;user_email\u0026#34; class=\u0026#34;form-control form-control-lg input-block js-email-notice-trigger\u0026#34; placeholder=\u0026#34;you@example.","title":"Django,Forms"},{"content":"djangoä¸­formsçš„å®šä¹‰ ç›´æ¥å®šä¹‰ class ContactForm(forms.Form): date = DateField(widget=CalendarWidget) name = CharField(max_length=40, widget=OtherWidget) widgetå‚æ•°å®šä¹‰äº†è¦ä½¿ç”¨çš„å°éƒ¨ä»¶ï¼Œå°éƒ¨ä»¶é€‰é¡¹å¯è§è¿™é‡Œ\né€šè¿‡æ¨¡å‹å®šä¹‰ å¿…é¡»ç»§æ‰¿ModelFormç±»\nfrom django.forms import ModelForm class BlogForm(ModelForm): class Meta: model = Blog fields = [\u0026#39;author\u0026#39;, \u0026#39;essay\u0026#39;, \u0026#39;title\u0026#39;, \u0026#39;label\u0026#39;, \u0026#39;cover\u0026#39;] widgets = { \u0026#39;essay\u0026#39;: CKEditorWidget, \u0026#39;cover\u0026#39;: } é€šè¿‡å®šä¹‰å†…éƒ¨ç±»æ¥ç”Ÿå‘½formçš„å±æ€§\n å¸¸ç”¨å†…éƒ¨ç±»å‚æ•°è¯´æ˜ï¼š\nmodel: è¯´æ˜è¦ç»§æ‰¿çš„æ¨¡å‹\nfieldï¼šè¯´æ˜è¦åœ¨è¡¨å•ä¸­æ˜¾ç¤ºçš„å­—æ®µï¼Œ__all__è¡¨ç¤ºæ‰€æœ‰\nexclude: è¦ä»è¡¨å•ä¸­æ’é™¤çš„å­—æ®µ\nwidgets: è®¾ç½®å­—æ®µçš„å°éƒ¨ä»¶\nï¼ˆè¯¦ç»†æ–‡æ¡£ï¼‰\n ","permalink":"http://yangchnet.github.io/Dessert/posts/django/django%E4%B8%ADform%E7%9A%84%E5%AE%9A%E4%B9%89/","summary":"djangoä¸­formsçš„å®šä¹‰ ç›´æ¥å®šä¹‰ class ContactForm(forms.Form): date = DateField(widget=CalendarWidget) name = CharField(max_length=40, widget=OtherWidget) widgetå‚æ•°å®šä¹‰äº†è¦ä½¿ç”¨çš„å°éƒ¨ä»¶ï¼Œå°éƒ¨ä»¶é€‰é¡¹å¯è§è¿™é‡Œ\né€šè¿‡æ¨¡å‹å®šä¹‰ å¿…é¡»ç»§æ‰¿ModelFormç±»\nfrom django.forms import ModelForm class BlogForm(ModelForm): class Meta: model = Blog fields = [\u0026#39;author\u0026#39;, \u0026#39;essay\u0026#39;, \u0026#39;title\u0026#39;, \u0026#39;label\u0026#39;, \u0026#39;cover\u0026#39;] widgets = { \u0026#39;essay\u0026#39;: CKEditorWidget, \u0026#39;cover\u0026#39;: } é€šè¿‡å®šä¹‰å†…éƒ¨ç±»æ¥ç”Ÿå‘½formçš„å±æ€§\n å¸¸ç”¨å†…éƒ¨ç±»å‚æ•°è¯´æ˜ï¼š\nmodel: è¯´æ˜è¦ç»§æ‰¿çš„æ¨¡å‹\nfieldï¼šè¯´æ˜è¦åœ¨è¡¨å•ä¸­æ˜¾ç¤ºçš„å­—æ®µï¼Œ__all__è¡¨ç¤ºæ‰€æœ‰\nexclude: è¦ä»è¡¨å•ä¸­æ’é™¤çš„å­—æ®µ\nwidgets: è®¾ç½®å­—æ®µçš„å°éƒ¨ä»¶\nï¼ˆè¯¦ç»†æ–‡æ¡£ï¼‰\n ","title":"djangoä¸­formsçš„å®šä¹‰"},{"content":"djangoä¸­ä½¿ç”¨highchart å¼•å…¥jsæ–‡ä»¶  é¡ºåºä¸èƒ½é”™\n \u0026lt;script src=\u0026#34;https://code.jquery.com/jquery-3.1.1.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script src=\u0026#34;https://code.highcharts.com/highcharts.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; ä¸€ç‚¹å°æ’æ›² åœ¨åˆšå¼€å§‹ä½¿ç”¨highchartæ—¶ï¼Œç”±äºä½¿ç”¨çš„æ˜¯ç»§æ‰¿æ¨¡æ¿ï¼Œå¯¼è‡´jsæ–‡ä»¶å¼•å…¥çš„é¡ºåºæ²¡æœ‰æŠŠæ¡å¥½ï¼Œå¯¼è‡´ä¸èƒ½æ˜¾ç¤ºå›¾åƒï¼Œå› æ­¤å°†ä¸Šé¢ä¸¤å¥æåˆ°base.htmlçš„å‰é¢ï¼Œç„¶åå¯ä»¥æ˜¾ç¤ºå›¾åƒã€‚\n","permalink":"http://yangchnet.github.io/Dessert/posts/django/django%E4%B8%AD%E4%BD%BF%E7%94%A8highchart/","summary":"djangoä¸­ä½¿ç”¨highchart å¼•å…¥jsæ–‡ä»¶  é¡ºåºä¸èƒ½é”™\n \u0026lt;script src=\u0026#34;https://code.jquery.com/jquery-3.1.1.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script src=\u0026#34;https://code.highcharts.com/highcharts.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; ä¸€ç‚¹å°æ’æ›² åœ¨åˆšå¼€å§‹ä½¿ç”¨highchartæ—¶ï¼Œç”±äºä½¿ç”¨çš„æ˜¯ç»§æ‰¿æ¨¡æ¿ï¼Œå¯¼è‡´jsæ–‡ä»¶å¼•å…¥çš„é¡ºåºæ²¡æœ‰æŠŠæ¡å¥½ï¼Œå¯¼è‡´ä¸èƒ½æ˜¾ç¤ºå›¾åƒï¼Œå› æ­¤å°†ä¸Šé¢ä¸¤å¥æåˆ°base.htmlçš„å‰é¢ï¼Œç„¶åå¯ä»¥æ˜¾ç¤ºå›¾åƒã€‚","title":"djangoä¸­ä½¿ç”¨highchart"},{"content":"Django ä¸­å›¾åƒçš„å¤„ç†æ–¹æ³• å›¾åƒçš„ä¸Šä¼ ä¿å­˜  å‰ç«¯å›¾ç‰‡çš„ä¸Šä¼ ï¼š  \u0026lt;form action=\u0026#34;/updateinfo\u0026#34; method=\u0026#34;POST\u0026#34; enctype=\u0026#34;multipart/form-data\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;updateImg\u0026#34;\u0026gt; \u0026lt;img src=\u0026#34;{{ account.photo.url }}\u0026#34; alt=\u0026#34;\u0026#34;/\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;input name=\u0026#34;photo\u0026#34; type=\u0026#34;file\u0026#34; id=\u0026#34;exampleInputFile\u0026#34;\u0026gt; \u0026lt;button id=\u0026#34;photo\u0026#34; class=\u0026#34;btn btn-danger\u0026#34; type=\u0026#34;submit\u0026#34;\u0026gt;ä¸Šä¼ å¤´åƒ\u0026lt;/button\u0026gt; \u0026lt;/form\u0026gt; å…¶ä¸­inputæ ‡ç­¾çš„typeä¸ºfileï¼Œ 2. å›¾ç‰‡æ¨¡å‹\nmodels.ImageField(upload_to=\u0026lsquo;path\u0026rsquo;) upload_toçš„å‚¨å­˜è·¯å¾„æ˜¯ç›¸å¯¹äºMEDIA_ROOTè€Œæ¥çš„ï¼Œè‹¥MEDIA_ROOTä¸º/media/ï¼Œupload_toè·¯å¾„ä¸ºimageï¼Œåˆ™å›¾ç‰‡ä¸Šä¼ åçš„å‚¨å­˜è·¯å¾„ä¸º/media/image\nåœ¨å‰ç«¯æ˜¾ç¤ºä¸Šä¼ çš„å›¾ç‰‡ {% load static %} \u0026lt;body data-media-url=\u0026#34;{% get_media_prefix %}\u0026#34;\u0026gt; ä½¿ç”¨get_media_prefxiæ¨¡æ¿tagï¼Œä»£è¡¨MEDIA_URLå˜é‡\n\u0026lt;img src=\u0026#34;{% get_media_prefix %}/{{ page.cover }}\u0026#34; alt = \u0026#34;{{ page.cover }}\u0026#34;\u0026gt;  å­˜åœ¨çš„é—®é¢˜  æ¯ä¸ªç”¨æˆ·ä¸Šä¼ çš„å›¾ç‰‡é›†ä¸­åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹ï¼Œå®¹æ˜“é€ æˆå‘½åå†²çªï¼Œ\nå¯å‚è€ƒè¿™é‡Œ\n","permalink":"http://yangchnet.github.io/Dessert/posts/django/%E5%9B%BE%E5%83%8F%E7%9A%84%E4%B8%8A%E4%BC%A0%E4%BF%9D%E5%AD%98%E6%98%BE%E7%A4%BA/","summary":"Django ä¸­å›¾åƒçš„å¤„ç†æ–¹æ³• å›¾åƒçš„ä¸Šä¼ ä¿å­˜  å‰ç«¯å›¾ç‰‡çš„ä¸Šä¼ ï¼š  \u0026lt;form action=\u0026#34;/updateinfo\u0026#34; method=\u0026#34;POST\u0026#34; enctype=\u0026#34;multipart/form-data\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;updateImg\u0026#34;\u0026gt; \u0026lt;img src=\u0026#34;{{ account.photo.url }}\u0026#34; alt=\u0026#34;\u0026#34;/\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;input name=\u0026#34;photo\u0026#34; type=\u0026#34;file\u0026#34; id=\u0026#34;exampleInputFile\u0026#34;\u0026gt; \u0026lt;button id=\u0026#34;photo\u0026#34; class=\u0026#34;btn btn-danger\u0026#34; type=\u0026#34;submit\u0026#34;\u0026gt;ä¸Šä¼ å¤´åƒ\u0026lt;/button\u0026gt; \u0026lt;/form\u0026gt; å…¶ä¸­inputæ ‡ç­¾çš„typeä¸ºfileï¼Œ 2. å›¾ç‰‡æ¨¡å‹\nmodels.ImageField(upload_to=\u0026lsquo;path\u0026rsquo;) upload_toçš„å‚¨å­˜è·¯å¾„æ˜¯ç›¸å¯¹äºMEDIA_ROOTè€Œæ¥çš„ï¼Œè‹¥MEDIA_ROOTä¸º/media/ï¼Œupload_toè·¯å¾„ä¸ºimageï¼Œåˆ™å›¾ç‰‡ä¸Šä¼ åçš„å‚¨å­˜è·¯å¾„ä¸º/media/image\nåœ¨å‰ç«¯æ˜¾ç¤ºä¸Šä¼ çš„å›¾ç‰‡ {% load static %} \u0026lt;body data-media-url=\u0026#34;{% get_media_prefix %}\u0026#34;\u0026gt; ä½¿ç”¨get_media_prefxiæ¨¡æ¿tagï¼Œä»£è¡¨MEDIA_URLå˜é‡\n\u0026lt;img src=\u0026#34;{% get_media_prefix %}/{{ page.cover }}\u0026#34; alt = \u0026#34;{{ page.cover }}\u0026#34;\u0026gt;  å­˜åœ¨çš„é—®é¢˜  æ¯ä¸ªç”¨æˆ·ä¸Šä¼ çš„å›¾ç‰‡é›†ä¸­åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹ï¼Œå®¹æ˜“é€ æˆå‘½åå†²çªï¼Œ\nå¯å‚è€ƒè¿™é‡Œ","title":"Djangoä¸­å›¾åƒçš„å¤„ç†æ–¹æ³•"},{"content":"dockerå¸¸ç”¨æ“ä½œ  å¯åŠ¨dockeræœåŠ¡ sudo systemctl start docker æŸ¥çœ‹æœ¬åœ°é•œåƒ sudo docker images æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„é•œåƒ sudo docker ps æŸ¥çœ‹æ‰€æœ‰é•œåƒ sudo docker ps -a åœæ­¢æ­£åœ¨è¿è¡Œçš„é•œåƒ sudo docker stop container_name å¼€å§‹è¿è¡ŒæŸä¸ªé•œåƒ sudo docker start container_name åˆ é™¤æŸä¸ªé•œåƒ sudo docker rmi container_name è¿›å…¥æŸä¸ªæ­£åœ¨è¿è¡Œçš„é•œåƒ sudo docker attach container_name å¯¼å‡ºå®¹å™¨ sudo docker export container_id \u0026gt; name.tar å¯¼å…¥å®¹å™¨ cat name.tar | sudo docker import -test/buntu:v1.0 ä»ç½‘ç»œå¯¼å…¥ sudo docker import http://example.com/exampleimage.tgz example/imagerepo  ésudoè¿è¡Œ sudo usermod -aG docker $USER \u0026amp;\u0026amp; newgrp docker # å°†å½“å‰ç”¨æˆ·æ·»åŠ åˆ°dockerç”¨æˆ·ç»„ é€€å‡ºé‡æ–°ç™»é™†å³å¯\n","permalink":"http://yangchnet.github.io/Dessert/posts/container/docker/","summary":"dockerå¸¸ç”¨æ“ä½œ  å¯åŠ¨dockeræœåŠ¡ sudo systemctl start docker æŸ¥çœ‹æœ¬åœ°é•œåƒ sudo docker images æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„é•œåƒ sudo docker ps æŸ¥çœ‹æ‰€æœ‰é•œåƒ sudo docker ps -a åœæ­¢æ­£åœ¨è¿è¡Œçš„é•œåƒ sudo docker stop container_name å¼€å§‹è¿è¡ŒæŸä¸ªé•œåƒ sudo docker start container_name åˆ é™¤æŸä¸ªé•œåƒ sudo docker rmi container_name è¿›å…¥æŸä¸ªæ­£åœ¨è¿è¡Œçš„é•œåƒ sudo docker attach container_name å¯¼å‡ºå®¹å™¨ sudo docker export container_id \u0026gt; name.tar å¯¼å…¥å®¹å™¨ cat name.tar | sudo docker import -test/buntu:v1.0 ä»ç½‘ç»œå¯¼å…¥ sudo docker import http://example.com/exampleimage.tgz example/imagerepo  ésudoè¿è¡Œ sudo usermod -aG docker $USER \u0026amp;\u0026amp; newgrp docker # å°†å½“å‰ç”¨æˆ·æ·»åŠ åˆ°dockerç”¨æˆ·ç»„ é€€å‡ºé‡æ–°ç™»é™†å³å¯","title":"dockerå¸¸ç”¨æ“ä½œ"},{"content":"1ã€dockerçš„å®‰è£…(Ubuntu) 1.1ã€ è®¾ç½®å­˜å‚¨åº“  è‹¥æ˜¯å·²å®‰è£…æ—§ç‰ˆæœ¬çš„dockerï¼Œ è¯·å¸è½½ï¼šsudo apt-get remove docker docker-engine docker.io containerd runc\n 1.1.1ã€æ›´æ–°aptç´¢å¼• sudo apt-get update 1.1.2ã€å®‰è£…ä¾èµ– sudo apt-get install \\  apt-transport-https \\  ca-certificates \\  curl \\  gnupg-agent \\  software-properties-common 1.1.3ã€æ·»åŠ dockerå®˜æ–¹çš„GPGç§˜é’¥ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -  åœ¨è¿›è¡Œæ­¤æ­¥æ—¶ï¼Œå‡ºç°äº†sudo: unable to resolve host iZ2ze4512bfzoapfvch6btZï¼Œè¿™æ˜¯å› ä¸ºæœºå™¨ä¸èƒ½åå‘è§£æ æ‰“å¼€ä¸»æœºä¸Šçš„ /etc/hosts æ·»åŠ ï¼š 127.0.0.1 ã€hostnameã€‘# ã€hostnameã€‘ç”¨ä¸»æœºåæ›¿ä»£ å¯åœ¨/etc/hostnameä¸­ä¿®æ”¹ä¸»æœºåï¼Œsudo shutdown -r nowé‡å¯è¿‡åå®Œæˆä¸»æœºåä¿®æ”¹\n éªŒè¯æ·»åŠ æˆåŠŸï¼š\nsudo apt-key fingerprint 0EBFCD88 1.1.4ã€ è®¾ç½®å­˜å‚¨åº“ sudo add-apt-repository \u0026quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) \\stable\u0026quot; 1.2ã€å®‰è£…dockerCE 1.2.1 æ›´æ–°aptç´¢å¼• sudo apt-get update 1.2.2ã€å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„dockerCEå’Œcontainerd sudo apt-get install docker-ce docker-ce-cli containerd.io 1.2.3ã€é€šè¿‡è¿è¡Œhello-worldéªŒè¯æ˜¯å¦æ­£ç¡®å®‰è£…äº†dockerCE sudo docker run hello-world 1.2.4ã€å¸è½½dockerCE 1ã€å¸è½½dockerCEè½¯ä»¶åŒ…\nsudo apt-get purge docker-ce 2ã€ä¸»æœºä¸Šçš„å›¾åƒï¼Œå®¹å™¨ï¼Œå·æˆ–è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ä¸ä¼šè‡ªåŠ¨åˆ é™¤ã€‚è¦åˆ é™¤æ‰€æœ‰å›¾åƒï¼Œå®¹å™¨å’Œå·ï¼š\nsudo rm -rf /var/lib/docker 1.3ã€åœ¨dockerä¸­è¿è¡Œåº”ç”¨ 1.3.1ã€åˆ›å»ºå·¥ä½œç›®å½• mkdir dockerwork è¿›å…¥ï¼š\ncd dockerwork 1.3.2ã€ åˆ›å»ºDockerFile å†…å®¹å¦‚ä¸‹ï¼š\nUse an official Python runtime as a parent image FROM python:2.7-slim # Set the working directory to /app  WORKDIR /app # Copy the current directory contents into the container at /app  COPY . /app # Install any needed packages specified in requirements.txt  RUN pip install --trusted-host pypi.python.org -r requirements.txt # Make port 80 available to the world outside this container  EXPOSE 80 # Define environment variable  ENV NAME World # Run app.py when the container launches  CMD [\u0026#34;python\u0026#34;, \u0026#34;app.py\u0026#34;] æœ‰å…³DockerFileçš„è§£é‡Šå¯è§è¿™é‡Œ\n å…¶ä¸­ WORKDIRè¡¨ç¤ºå·¥ä½œç›®å½•ï¼Œ COPYæ˜¯æŠŠå½“å‰ç›®å½•ä¸‹ï¼ˆ.ï¼‰çš„å†…å®¹å¤åˆ¶åˆ° /app\n å…¶ä¸­åŒ…å«ä¸¤ä¸ªæœªå»ºç«‹çš„æ–‡ä»¶ï¼šrequirements.txt \u0026amp; app.py å…¶å†…å®¹å¦‚ä¸‹ï¼š\n requirements.txt\n Flask Redis  app.py\n from flask import Flask from redis import Redis, RedisError import os import socket # Connect to Redis redis = Redis(host=\u0026#34;redis\u0026#34;, db=0, socket_connect_timeout=2, socket_timeout=2) app = Flask(__name__) @app.route(\u0026#34;/\u0026#34;) def hello(): try: visits = redis.incr(\u0026#34;counter\u0026#34;) except RedisError: visits = \u0026#34;\u0026lt;i\u0026gt;cannot connect to Redis, counter disabled\u0026lt;/i\u0026gt;\u0026#34; html = \u0026#34;\u0026lt;h3\u0026gt;Hello {name}!\u0026lt;/h3\u0026gt;\u0026#34; \\ \u0026#34;\u0026lt;b\u0026gt;Hostname:\u0026lt;/b\u0026gt; {hostname}\u0026lt;br/\u0026gt;\u0026#34; \\ \u0026#34;\u0026lt;b\u0026gt;Visits:\u0026lt;/b\u0026gt; {visits}\u0026#34; return html.format(name=os.getenv(\u0026#34;NAME\u0026#34;, \u0026#34;world\u0026#34;), hostname=socket.gethostname(), visits=visits) if __name__ == \u0026#34;__main__\u0026#34;: app.run(host=\u0026#39;0.0.0.0\u0026#39;, port=80) 1.3.3ã€æ„å»ºåº”ç”¨ç¨‹åº docker build --tag=friendlyhello . 1.3.4ã€è¿è¡Œåº”ç”¨ç¨‹åº docker run -p 4000:80 friendlyhello  è¿™æ˜¯è¿è¡Œä¸€èˆ¬ç¨‹åºçš„æ­¥éª¤ï¼Œè¦æ„å»ºdjangoé¡¹ç›®ï¼Œè¯·åˆ°è¿™é‡Œ\n ","permalink":"http://yangchnet.github.io/Dessert/posts/container/docker-%E7%AC%AC%E4%B8%80%E7%AF%87/","summary":"1ã€dockerçš„å®‰è£…(Ubuntu) 1.1ã€ è®¾ç½®å­˜å‚¨åº“  è‹¥æ˜¯å·²å®‰è£…æ—§ç‰ˆæœ¬çš„dockerï¼Œ è¯·å¸è½½ï¼šsudo apt-get remove docker docker-engine docker.io containerd runc\n 1.1.1ã€æ›´æ–°aptç´¢å¼• sudo apt-get update 1.1.2ã€å®‰è£…ä¾èµ– sudo apt-get install \\  apt-transport-https \\  ca-certificates \\  curl \\  gnupg-agent \\  software-properties-common 1.1.3ã€æ·»åŠ dockerå®˜æ–¹çš„GPGç§˜é’¥ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -  åœ¨è¿›è¡Œæ­¤æ­¥æ—¶ï¼Œå‡ºç°äº†sudo: unable to resolve host iZ2ze4512bfzoapfvch6btZï¼Œè¿™æ˜¯å› ä¸ºæœºå™¨ä¸èƒ½åå‘è§£æ æ‰“å¼€ä¸»æœºä¸Šçš„ /etc/hosts æ·»åŠ ï¼š 127.0.0.1 ã€hostnameã€‘# ã€hostnameã€‘ç”¨ä¸»æœºåæ›¿ä»£ å¯åœ¨/etc/hostnameä¸­ä¿®æ”¹ä¸»æœºåï¼Œsudo shutdown -r nowé‡å¯è¿‡åå®Œæˆä¸»æœºåä¿®æ”¹\n éªŒè¯æ·»åŠ æˆåŠŸï¼š\nsudo apt-key fingerprint 0EBFCD88 1.1.4ã€ è®¾ç½®å­˜å‚¨åº“ sudo add-apt-repository \u0026quot;deb [arch=amd64] https://download.","title":"dockerçš„å®‰è£…ï¼ˆUbuntu)"},{"content":"FlagåŒ…çš„åŸºæœ¬ç”¨æ³•  flagåŒ…ç”¨äºå¤„ç†golangå‘½ä»¤è¡Œç¨‹åºä¸­çš„å‚æ•°\n 1. ä½¿ç”¨flagåŒ…çš„åŸºæœ¬æµç¨‹ ä½¿ç”¨flagåŒ…æ¶‰åŠä¸‰ä¸ªæ­¥éª¤ï¼š\n å®šä¹‰å˜é‡ä»¥æ•è·æ ‡å¿—å€¼ å®šä¹‰Goåº”ç”¨ç¨‹åºå°†ä½¿ç”¨çš„æ ‡å¿— åœ¨æ‰§è¡Œæ—¶è§£ææä¾›ç»™åº”ç”¨ç¨‹åºçš„æ ‡å¿—ã€‚  flagè½¯ä»¶åŒ…ä¸­çš„å¤§å¤šæ•°åŠŸèƒ½éƒ½ä¸å®šä¹‰æ ‡å¿—å¹¶å°†å…¶ç»‘å®šåˆ°å®šä¹‰çš„å˜é‡æœ‰å…³ã€‚è§£æé˜¶æ®µç”±Parse()å‡½æ•°å¤„ç†ã€‚\nä¸€ä¸ªä¾‹å­ åˆ›å»ºä¸€ä¸ªç¨‹åºï¼Œè¯¥ç¨‹åºå®šä¹‰ä¸€ä¸ªå¸ƒå°”æ ‡å¿—ï¼Œè¯¥æ ‡å¿—ä¼šæ›´æ”¹å°†æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºçš„æ¶ˆæ¯ã€‚å¦‚æœ-coloræä¾›äº†ä¸€ä¸ªæ ‡å¿—ï¼Œç¨‹åºå°†ä»¥è“è‰²æ‰“å°ä¸€æ¡æ¶ˆæ¯ã€‚å¦‚æœæœªæä¾›æ ‡å¿—ï¼Œåˆ™æ¶ˆæ¯å°†è¢«æ‰“å°ä¸ºæ²¡æœ‰ä»»ä½•é¢œè‰²ã€‚\n// boolean.go import ( \u0026#34;flag\u0026#34; \u0026#34;fmt\u0026#34; ) type Color string // å®šä¹‰å˜é‡ä»¥æ•è·æ ‡å¿—å€¼  const ( ColorBlack Color = \u0026#34;\\u001b[30m\u0026#34; ColorRed = \u0026#34;\\u001b[31m\u0026#34; ColorGreen = \u0026#34;\\u001b[32m\u0026#34; ColorYellow = \u0026#34;\\u001b[33m\u0026#34; ColorBlue = \u0026#34;\\u001b[34m\u0026#34; ColorReset = \u0026#34;\\u001b[0m\u0026#34; ) func colorize(color Color, message string) { fmt.Println(string(color), message, string(ColorReset)) } func main() { useColor := flag.Bool(\u0026#34;color\u0026#34;, false, \u0026#34;display colorized output\u0026#34;) // å®šä¹‰Goåº”ç”¨ç¨‹åºå°†ä½¿ç”¨çš„æ ‡å¿—  flag.Parse() // è§£ææ ‡å¿—  if *useColor { colorize(ColorBlue, \u0026#34;Hello, DigitalOcean!\u0026#34;) return } fmt.Println(\u0026#34;Hello, DigitalOcean!\u0026#34;) } åœ¨mainå‡½æ•°ä¸­ï¼Œä½¿ç”¨flag.Boolå®šä¹‰äº†ä¸€ä¸ªå¸ƒå°”å‹çš„æ ‡å¿—colorï¼Œå…¶é»˜è®¤å€¼ä¸ºç¬¬äºŒä¸ªå‚æ•°falseï¼Œåœ¨æœªæä¾›colorå‚æ•°æ—¶å°†é»˜è®¤ä½¿ç”¨æ­¤å€¼ã€‚æœ€åä¸€ä¸ªå‚æ•°æ˜¯å…³äºæ­¤æ ‡å¿—ç”¨æ³•çš„è¯´æ˜æ–‡æ¡£ã€‚\nflag.Boolè¿”å›å€¼æ˜¯ä¸€ä¸ªboolæŒ‡é’ˆç±»å‹ï¼Œflag.Parseä½¿ç”¨æ­¤boolæŒ‡é’ˆæ ¹æ®ç”¨æˆ·ä¼ é€’çš„æ ‡å¿—æ¥è®¾ç½®å˜é‡ã€‚ç„¶åæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡å¼•ç”¨è¿™ä¸ªæŒ‡é’ˆæ¥æ£€æŸ¥è¿™ä¸ªå˜é‡ï¼Œé€šè¿‡å˜é‡çš„å€¼æ§åˆ¶ç¨‹åºçš„è¡Œä¸ºã€‚\n2. å¤„ç†ä½ç½®å‚æ•° é€šå¸¸ï¼Œå‘½ä»¤å¸¦æœ‰ä¸€å®šçš„å‚æ•°ï¼Œå¹¶ä¸”è¿™äº›å‚æ•°æ˜¯å‘½ä»¤å·¥ä½œçš„ç„¦ç‚¹æ‰€åœ¨ï¼Œä¾‹å¦‚ï¼špython main.py,è¿™é‡Œçš„main.pyå°±æ˜¯ä¸€ä¸ªä½ç½®å‚æ•°ï¼Œæ˜¯pythonè¿™ä¸ªå‘½ä»¤çš„ç¬¬ä¸€ä¸ªå‚æ•°ã€‚\nå‡å¦‚æˆ‘ä»¬æœ‰ä¸ªå‘½ä»¤headï¼Œå®ƒæ‰“å°ä¸€ä¸ªæ–‡ä»¶çš„å¼€å§‹å‡ è¡Œï¼Œç”¨æ³•ä¸ºï¼šhead {inputfile}ã€‚\né€šå¸¸ï¼ŒParse()å‡½æ•°è§£æä¸€ä¸ªå‘½ä»¤ç›´åˆ°å…¶æ£€æŸ¥åˆ°æ²¡æœ‰æ ‡å¿—å‚æ•°çš„å­˜åœ¨ã€‚flagåŒ…é€šè¿‡Argså’ŒArgå‡½æ•°æ¥è§£å†³ä½ç½®å‚æ•°çš„é—®é¢˜ã€‚\n// head.go import ( \u0026#34;bufio\u0026#34; \u0026#34;flag\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;io\u0026#34; \u0026#34;os\u0026#34; ) func main() { var count int flag.IntVar(\u0026amp;count, \u0026#34;n\u0026#34;, 5, \u0026#34;number of lines to read from the file\u0026#34;) flag.Parse() var in io.Reader if filename := flag.Arg(0); filename != \u0026#34;\u0026#34; { f, err := os.Open(filename) if err != nil { fmt.Println(\u0026#34;error opening file: err:\u0026#34;, err) os.Exit(1) } defer f.Close() in = f } else { in = os.Stdin } buf := bufio.NewScanner(in) for i := 0; i \u0026lt; count; i++ { if !buf.Scan() { break } fmt.Println(buf.Text()) } if err := buf.Err(); err != nil { fmt.Fprintln(os.Stderr, \u0026#34;error reading: err:\u0026#34;, err) } } é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªcountå˜é‡æ¥æ ‡è®°ç¨‹åºéœ€è¦è¯»å–æ–‡ä»¶çš„å‰å‡ è¡Œã€‚é€šè¿‡flag.IntVarå®šä¹‰äº†-nå‚æ•°ã€‚è¿™ä¸ªå‡½æ•°å…è®¸æˆ‘ä»¬ä¼ é€’ä¸€ä¸ªæŒ‡é’ˆä½œä¸ºæ ‡è®°è€Œä¸æ˜¯åƒæ²¡æœ‰Varåç¼€çš„å‡½æ•°é‚£æ ·è¿”å›ä¸€ä¸ªæŒ‡é’ˆã€‚flag.IntVarå’Œflag.Intä¹‹é—´é™¤äº†è¿™ä¸€ç‚¹ä¸åŒå¤–ï¼Œå…¶ä½™å‚æ•°çš„æ„ä¹‰éƒ½ç›¸åŒã€‚åœ¨ä½¿ç”¨flag.Parseè§£æåï¼Œæ¥ä¸‹æ¥æ˜¯æ ¹æ®å‚æ•°æ¥æ§åˆ¶ç¨‹åºé€»è¾‘ã€‚\nåœ¨iféƒ¨åˆ†ï¼Œä½¿ç”¨flag.Argæ¥è®¿é—®åœ¨æ‰€æœ‰æ ‡å¿—å‚æ•°ä¹‹åçš„ç¬¬ä¸€ä¸ªä½ç½®å‚æ•°ã€‚\n","permalink":"http://yangchnet.github.io/Dessert/posts/golang/flag%E5%8C%85%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95/","summary":"FlagåŒ…çš„åŸºæœ¬ç”¨æ³•  flagåŒ…ç”¨äºå¤„ç†golangå‘½ä»¤è¡Œç¨‹åºä¸­çš„å‚æ•°\n 1. ä½¿ç”¨flagåŒ…çš„åŸºæœ¬æµç¨‹ ä½¿ç”¨flagåŒ…æ¶‰åŠä¸‰ä¸ªæ­¥éª¤ï¼š\n å®šä¹‰å˜é‡ä»¥æ•è·æ ‡å¿—å€¼ å®šä¹‰Goåº”ç”¨ç¨‹åºå°†ä½¿ç”¨çš„æ ‡å¿— åœ¨æ‰§è¡Œæ—¶è§£ææä¾›ç»™åº”ç”¨ç¨‹åºçš„æ ‡å¿—ã€‚  flagè½¯ä»¶åŒ…ä¸­çš„å¤§å¤šæ•°åŠŸèƒ½éƒ½ä¸å®šä¹‰æ ‡å¿—å¹¶å°†å…¶ç»‘å®šåˆ°å®šä¹‰çš„å˜é‡æœ‰å…³ã€‚è§£æé˜¶æ®µç”±Parse()å‡½æ•°å¤„ç†ã€‚\nä¸€ä¸ªä¾‹å­ åˆ›å»ºä¸€ä¸ªç¨‹åºï¼Œè¯¥ç¨‹åºå®šä¹‰ä¸€ä¸ªå¸ƒå°”æ ‡å¿—ï¼Œè¯¥æ ‡å¿—ä¼šæ›´æ”¹å°†æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºçš„æ¶ˆæ¯ã€‚å¦‚æœ-coloræä¾›äº†ä¸€ä¸ªæ ‡å¿—ï¼Œç¨‹åºå°†ä»¥è“è‰²æ‰“å°ä¸€æ¡æ¶ˆæ¯ã€‚å¦‚æœæœªæä¾›æ ‡å¿—ï¼Œåˆ™æ¶ˆæ¯å°†è¢«æ‰“å°ä¸ºæ²¡æœ‰ä»»ä½•é¢œè‰²ã€‚\n// boolean.go import ( \u0026#34;flag\u0026#34; \u0026#34;fmt\u0026#34; ) type Color string // å®šä¹‰å˜é‡ä»¥æ•è·æ ‡å¿—å€¼  const ( ColorBlack Color = \u0026#34;\\u001b[30m\u0026#34; ColorRed = \u0026#34;\\u001b[31m\u0026#34; ColorGreen = \u0026#34;\\u001b[32m\u0026#34; ColorYellow = \u0026#34;\\u001b[33m\u0026#34; ColorBlue = \u0026#34;\\u001b[34m\u0026#34; ColorReset = \u0026#34;\\u001b[0m\u0026#34; ) func colorize(color Color, message string) { fmt.Println(string(color), message, string(ColorReset)) } func main() { useColor := flag.Bool(\u0026#34;color\u0026#34;, false, \u0026#34;display colorized output\u0026#34;) // å®šä¹‰Goåº”ç”¨ç¨‹åºå°†ä½¿ç”¨çš„æ ‡å¿—  flag.","title":"FlagåŒ…çš„åŸºæœ¬ç”¨æ³•"},{"content":"Github APIé—®é¢˜ ä½¿ç”¨githubçš„RESTful API è®¿é—®https://developer.github.com/v3/æ¥æŸ¥çœ‹å¸®åŠ©æ–‡æ¡£\nAPIè®¿é—®é™åˆ¶ åœ¨äº‘æœåŠ¡å™¨ä¸Šä½¿ç”¨gitçš„APIæ—¶ï¼Œå‘ç°å‡ºç°message\u0026quot;:\u0026quot;API rate limit exceeded for 59.110.140.133. (But here's the good news: Authenticated requests get a higher rate limit. Check out the documentation for more details.)\u0026quot;,\u0026quot;documentation_url\u0026quot;:\u0026quot;https://developer.github.com/v3/#rate-limitingæç¤ºä¿¡æ¯ï¼Œæ˜¾ç„¶ï¼Œè¿™æ˜¯å­˜åœ¨ç€è®¿é—®é™åˆ¶ã€‚\næŸ¥çœ‹è®¿é—®é™åˆ¶ ä½¿ç”¨curl -i https://api.github.com/rate_limitæŸ¥çœ‹è‡ªå·±çš„é™åˆ¶ä¿¡æ¯\nHTTP/1.1 200 OK Content-Type: application/json X-Ratelimit-Limit: 60 X-Ratelimit-Remaining: 59 X-Ratelimit-Reset: 1585470905 Date: Sun, 29 Mar 2020 07:49:35 GMT Content-Length: 482 Accept-Ranges: bytes X-GitHub-Request-Id: BB32:30AB:3EF690:50F336:5E80530E { \u0026#34;resources\u0026#34;: { \u0026#34;core\u0026#34;: { \u0026#34;limit\u0026#34;: 60, \u0026#34;remaining\u0026#34;: 59, \u0026#34;reset\u0026#34;: 1585470905 }, \u0026#34;graphql\u0026#34;: { \u0026#34;limit\u0026#34;: 0, \u0026#34;remaining\u0026#34;: 0, \u0026#34;reset\u0026#34;: 1585471775 }, \u0026#34;integration_manifest\u0026#34;: { \u0026#34;limit\u0026#34;: 5000, \u0026#34;remaining\u0026#34;: 5000, \u0026#34;reset\u0026#34;: 1585471775 }, \u0026#34;search\u0026#34;: { \u0026#34;limit\u0026#34;: 10, \u0026#34;remaining\u0026#34;: 10, \u0026#34;reset\u0026#34;: 1585468235 } }, \u0026#34;rate\u0026#34;: { \u0026#34;limit\u0026#34;: 60, \u0026#34;remaining\u0026#34;: 59, \u0026#34;reset\u0026#34;: 1585470905 } } rate.limit ä¸º60æ¬¡ï¼Œè®¿é—®60æ¬¡åå°±è¢«é™åˆ¶ï¼Œå¾ˆæ˜¾ç„¶ä¸å¤ªå¤Ÿç”¨\næé«˜è®¿é—®é™åˆ¶ é€šè¿‡åœ¨githubæ³¨å†Œåº”ç”¨ç¨‹åºï¼Œå¯æé«˜åˆ°æ¯å°æ—¶5000æ¬¡è®¿é—®ï¼Œä¸€èˆ¬åº”ç”¨ç¨‹åºè¶³å¤Ÿäº† åœ¨https://github.com/settings/applications/newæ³¨å†Œåº”ç”¨ç¨‹åº\nå°±å¯ä»¥å¾—åˆ°client_idå’Œclient_secret\nä½¿ç”¨curl -u my_client_id:my_client_secret 'https://api.github.com/user/repos'è¿›è¡Œèº«ä»½éªŒè¯ï¼Œç„¶åå³å¯\n","permalink":"http://yangchnet.github.io/Dessert/posts/git/api%E9%99%90%E5%88%B6%E9%97%AE%E9%A2%98/","summary":"Github APIé—®é¢˜ ä½¿ç”¨githubçš„RESTful API è®¿é—®https://developer.github.com/v3/æ¥æŸ¥çœ‹å¸®åŠ©æ–‡æ¡£\nAPIè®¿é—®é™åˆ¶ åœ¨äº‘æœåŠ¡å™¨ä¸Šä½¿ç”¨gitçš„APIæ—¶ï¼Œå‘ç°å‡ºç°message\u0026quot;:\u0026quot;API rate limit exceeded for 59.110.140.133. (But here's the good news: Authenticated requests get a higher rate limit. Check out the documentation for more details.)\u0026quot;,\u0026quot;documentation_url\u0026quot;:\u0026quot;https://developer.github.com/v3/#rate-limitingæç¤ºä¿¡æ¯ï¼Œæ˜¾ç„¶ï¼Œè¿™æ˜¯å­˜åœ¨ç€è®¿é—®é™åˆ¶ã€‚\næŸ¥çœ‹è®¿é—®é™åˆ¶ ä½¿ç”¨curl -i https://api.github.com/rate_limitæŸ¥çœ‹è‡ªå·±çš„é™åˆ¶ä¿¡æ¯\nHTTP/1.1 200 OK Content-Type: application/json X-Ratelimit-Limit: 60 X-Ratelimit-Remaining: 59 X-Ratelimit-Reset: 1585470905 Date: Sun, 29 Mar 2020 07:49:35 GMT Content-Length: 482 Accept-Ranges: bytes X-GitHub-Request-Id: BB32:30AB:3EF690:50F336:5E80530E { \u0026#34;resources\u0026#34;: { \u0026#34;core\u0026#34;: { \u0026#34;limit\u0026#34;: 60, \u0026#34;remaining\u0026#34;: 59, \u0026#34;reset\u0026#34;: 1585470905 }, \u0026#34;graphql\u0026#34;: { \u0026#34;limit\u0026#34;: 0, \u0026#34;remaining\u0026#34;: 0, \u0026#34;reset\u0026#34;: 1585471775 }, \u0026#34;integration_manifest\u0026#34;: { \u0026#34;limit\u0026#34;: 5000, \u0026#34;remaining\u0026#34;: 5000, \u0026#34;reset\u0026#34;: 1585471775 }, \u0026#34;search\u0026#34;: { \u0026#34;limit\u0026#34;: 10, \u0026#34;remaining\u0026#34;: 10, \u0026#34;reset\u0026#34;: 1585468235 } }, \u0026#34;rate\u0026#34;: { \u0026#34;limit\u0026#34;: 60, \u0026#34;remaining\u0026#34;: 59, \u0026#34;reset\u0026#34;: 1585470905 } } rate.","title":"GithubAPIé—®é¢˜"},{"content":" ç›´æ¥å¹²ç»ˆææ–¹æ¡ˆ: go env -w GOPROXY=https://goproxy.cn,direct\n ä¿®æ”¹hostsï¼Œç„¶åreboot\næ·»åŠ \n192.30.253.112 github.com 151.101.185.194 github.global.ssl.fastly.net åˆ°/etc/hosts ç„¶åreboot\ngo get golang.org åœ¨ä½¿ç”¨go get golang.org/...æ—¶ï¼Œæ€»æ˜¯time outï¼ˆå°±ç®—fpä¹Ÿä¸€æ ·ï¼Œfpä¹‹åå¯ä»¥è®¿é—®golang.orgï¼‰ï¼Œä¸çŸ¥é“ä¸ºå•¥ã€‚\nå¹¸å¥½githubä¸Šå­˜åœ¨golang.orgçš„é•œåƒ ä¾‹å¦‚\ngo get -u golang.org/x/net é‚£ä¹ˆè¿™ä¸ªåŒ…çš„ä½ç½®åœ¨githubä¸Šå°±æ˜¯github.com/golang/net, æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨å»ºç«‹golang.org/x/ç›®å½•ï¼Œå¹¶åˆ‡æ¢åˆ°è¯¥ç›®å½•ä¸‹ï¼Œç„¶åä½¿ç”¨\ngit clone https://github.com/golang/net.git **æ³¨æ„ï¼š**è¦ä½¿ç”¨git cloneå‘½ä»¤ï¼Œç›´æ¥ä¸‹è½½ä¸‹æ¥å¤åˆ¶åˆ°ç›®å½•ä¸‹ä¼šæç¤ºæ‰¾ä¸åˆ°ç‰ˆæœ¬å·ã€‚\nç»ˆææ–¹æ¡ˆ go env -w GOPROXY=https://goproxy.cn,direct ","permalink":"http://yangchnet.github.io/Dessert/posts/golang/go-get%E4%BB%A3%E7%90%86%E6%96%B9%E6%A1%88/","summary":" ç›´æ¥å¹²ç»ˆææ–¹æ¡ˆ: go env -w GOPROXY=https://goproxy.cn,direct\n ä¿®æ”¹hostsï¼Œç„¶åreboot\næ·»åŠ \n192.30.253.112 github.com 151.101.185.194 github.global.ssl.fastly.net åˆ°/etc/hosts ç„¶åreboot\ngo get golang.org åœ¨ä½¿ç”¨go get golang.org/...æ—¶ï¼Œæ€»æ˜¯time outï¼ˆå°±ç®—fpä¹Ÿä¸€æ ·ï¼Œfpä¹‹åå¯ä»¥è®¿é—®golang.orgï¼‰ï¼Œä¸çŸ¥é“ä¸ºå•¥ã€‚\nå¹¸å¥½githubä¸Šå­˜åœ¨golang.orgçš„é•œåƒ ä¾‹å¦‚\ngo get -u golang.org/x/net é‚£ä¹ˆè¿™ä¸ªåŒ…çš„ä½ç½®åœ¨githubä¸Šå°±æ˜¯github.com/golang/net, æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨å»ºç«‹golang.org/x/ç›®å½•ï¼Œå¹¶åˆ‡æ¢åˆ°è¯¥ç›®å½•ä¸‹ï¼Œç„¶åä½¿ç”¨\ngit clone https://github.com/golang/net.git **æ³¨æ„ï¼š**è¦ä½¿ç”¨git cloneå‘½ä»¤ï¼Œç›´æ¥ä¸‹è½½ä¸‹æ¥å¤åˆ¶åˆ°ç›®å½•ä¸‹ä¼šæç¤ºæ‰¾ä¸åˆ°ç‰ˆæœ¬å·ã€‚\nç»ˆææ–¹æ¡ˆ go env -w GOPROXY=https://goproxy.cn,direct ","title":"go getä»£ç†æ–¹æ¡ˆ"},{"content":"golangä¸­çš„printç³»å‡½æ•°è¯¦è§£ pirntç³»å‡½æ•°æ¥è‡ªfmtåŒ…ï¼Œä¸»è¦ç”¨äºåšå„ç§æ ¼å¼çš„è¾“å‡º è¿™äº›å‡½æ•°ä¸»è¦æœ‰\n golangä¸­çš„printç³»å‡½æ•°è¯¦è§£  fmt.Fprintf fmt.Printf fmt.Sprintf fmt.Fprint fmt.Print fmt.Sprint fmt.Fprintln fmt.Println fmt.Sprintln æ€»ç»“    ä¸‹é¢æ¥é€ä¸ªåˆ†æ\nimport ( \u0026#34;fmt\u0026#34; \u0026#34;os\u0026#34; \u0026#34;io\u0026#34; ) fmt.Fprintf  å‡½æ•°åŸå‹ï¼š  Fprintf(w io.Writer, format string, a ...interface{}) (n int, err error)   å®˜æ–¹æ³¨é‡Š Fprintf formats according to a format specifier and writes to w.It returns the number of bytes written and any write error encountered.\n  Arguement fmt.Fprintf() ä¾æ®æŒ‡å®šçš„æ ¼å¼å‘ç¬¬ä¸€ä¸ªå‚æ•°å†…å†™å…¥å­—ç¬¦ä¸²ï¼Œç¬¬ä¸€å‚æ•°å¿…é¡»å®ç°äº† io.Writer æ¥å£ã€‚Fprintf() èƒ½å¤Ÿå†™å…¥ä»»ä½•ç±»å‹ï¼Œåªè¦å…¶å®ç°äº† Write æ–¹æ³•ï¼ŒåŒ…æ‹¬ os.Stdout,æ–‡ä»¶ï¼ˆä¾‹å¦‚ os.Fileï¼‰ï¼Œç®¡é“ï¼Œç½‘ç»œè¿æ¥ï¼Œé€šé“ç­‰ç­‰ï¼ŒåŒæ ·çš„ä¹Ÿå¯ä»¥ä½¿ç”¨ bufio åŒ…ä¸­ç¼“å†²å†™å…¥ã€‚bufio åŒ…ä¸­å®šä¹‰äº† type Writer struct{...}ã€‚Fprintfï¼šæ¥æ ¼å¼åŒ–å¹¶è¾“å‡ºåˆ° io.Writers è€Œä¸æ˜¯ os.Stdoutã€‚\n  // example func ExampleFprintf() { const name, age = \u0026#34;Kim\u0026#34;, 22 n, err := fmt.Fprintf(os.Stdout, \u0026#34;%s is %d years old.\\n\u0026#34;, name, age) // The n and err return values from Fprintf are \t// those returned by the underlying io.Writer. \tif err != nil { fmt.Fprintf(os.Stderr, \u0026#34;Fprintf: %v\\n\u0026#34;, err) } fmt.Printf(\u0026#34;%d bytes written.\\n\u0026#34;, n) // Output: \t// Kim is 22 years old. \t// 21 bytes written. } ExampleFprintf() Kim is 22 years old. 21 bytes written.  fmt.Printf  å‡½æ•°åŸå‹  Printf(format string, a ...interface{}) (n int, err error)   å®˜æ–¹æ³¨é‡Š Printf formats according to a format specifier and writes to standard output.It returns the number of bytes written and any write error encountered.\n  Arguement åªå¯ä»¥æ‰“å°å‡ºæ ¼å¼åŒ–çš„å­—ç¬¦ä¸²ã€‚åªå¯ä»¥ç›´æ¥è¾“å‡ºå­—ç¬¦ä¸²ç±»å‹çš„å˜é‡ï¼ˆä¸å¯ä»¥è¾“å‡ºæ•´å½¢å˜é‡å’Œæ•´å½¢ ç­‰ï¼‰ï¼Œå…¶å®è¿™ä¸ªå‡½æ•°æ˜¯fmt.Fprintfçš„è°ƒç”¨ï¼Œå…¶è°ƒç”¨è¯­å¥return Fprintf(os.Stdout, format, a...)ï¼Œè¾“å‡ºå¯¹è±¡ä¸ºæ ‡å‡†è¾“å‡ºã€‚\n  optional\n     optional description     %d åè¿›åˆ¶æ•´æ•°   %x, %o, %b åå…­è¿›åˆ¶ï¼Œå…«è¿›åˆ¶ï¼ŒäºŒè¿›åˆ¶æ•´æ•°   %f, %g, %e æµ®ç‚¹æ•°ï¼Œ3.141593 3.141592653589793 3.141593e+00   %t å¸ƒå°” tureæˆ–false   %c å­—ç¬¦ï¼ˆruneï¼‰ï¼ˆUniodeç ç‚¹ï¼‰   %s å­—ç¬¦ä¸²   %q å¸¦åŒå¼•å·çš„å­—ç¬¦ä¸²\u0026quot;abc\u0026quot;æˆ–å¸¦å•å¼•å·çš„å­—ç¬¦\u0026rsquo;c'   %v å˜é‡çš„è‡ªç„¶å½¢å¼   %T å˜é‡çš„ç±»å‹   %% å­—é¢ä¸Šçš„ç™¾åˆ†å·æ ‡å¿—ï¼ˆæ— æ“ä½œæ•°ï¼‰    fmt.Printf(\u0026#34;æ•´æ•°ï¼š%d\\tæµ®ç‚¹æ•°ï¼š%v\\tå­—ç¬¦ä¸²ï¼š%s\\n\u0026#34;, 1, 3.14, \u0026#34;hello world\u0026#34;) func ExamplePrintf() { const name, age = \u0026#34;Kim\u0026#34;, 22 fmt.Printf(\u0026#34;%s is %d years old.\\n\u0026#34;, name, age) // It is conventional not to worry about any \t// error returned by Printf.  // Output: \t// Kim is 22 years old. } ExamplePrintf() æ•´æ•°ï¼š1\tæµ®ç‚¹æ•°ï¼š3.14\tå­—ç¬¦ä¸²ï¼šhello world Kim is 22 years old.  fmt.Sprintf  å‡½æ•°åŸå‹  func Sprintf(format string, a ...interface{}) string   å®˜æ–¹æ³¨é‡Š Sprintf formats according to a format specifier and returns the resulting string.\n  Argument æ ¼å¼åŒ–å¹¶è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²è€Œä¸å¸¦ä»»ä½•è¾“å‡ºã€‚å¯ç”¨äºç»™å…¶ä»–å‡½æ•°ä¼ é€’æ ¼å¼åŒ–å‚æ•°ã€‚\n  func ExampleSprintf() { const name, age = \u0026#34;Kim\u0026#34;, 22 s := fmt.Sprintf(\u0026#34;%s is %d years old.\\n\u0026#34;, name, age) io.WriteString(os.Stdout, s) // Ignoring error for simplicity.  // Output: \t// Kim is 22 years old. } ExampleSprintf() Kim is 22 years old.  fmt.Fprint  å‡½æ•°åŸå‹  Fprint(w io.Writer, a ...interface{}) (n int, err error)   å®˜æ–¹æ³¨é‡Š Fprint formats using the default formats for its operands and writes to w.Spaces are added between operands when neither is a string.It returns the number of bytes written and any write error encountered.\n  Argument å‘io.Writerå¯¹è±¡ä¸­è¾“å…¥å­—ç¬¦ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè¾“å…¥å¯¹è±¡ï¼Œåé¢çš„å‚æ•°ä¸ºå­—ç¬¦ä¸²ï¼Œç›´æ¥è¾“å‡º\n  func ExampleFprint() { const name, age = \u0026#34;Kim\u0026#34;, 22 n, err := fmt.Fprint(os.Stdout, name, \u0026#34; is \u0026#34;, age, \u0026#34; years old.\\n\u0026#34;) // The n and err return values from Fprint are \t// those returned by the underlying io.Writer. \tif err != nil { fmt.Fprintf(os.Stderr, \u0026#34;Fprint: %v\\n\u0026#34;, err) } fmt.Print(n, \u0026#34; bytes written.\\n\u0026#34;) // Output: \t// Kim is 22 years old. \t// 21 bytes written. } ExampleFprint() Kim is 22 years old. 21 bytes written.  fmt.Print  å‡½æ•°åŸå‹  func Print(a ...interface{}) (n int, err error) { return Fprint(os.Stdout, a...) }   å®˜æ–¹æ³¨é‡Š Print formats using the default formats for its operands and writes to standard output.Spaces are added between operands when neither is a string.It returns the number of bytes written and any write error encountered.\n  Arguement æ˜¾ç„¶ï¼Œè¿™ä¸ªå‡½æ•°æ˜¯å¯¹fmt.Fprintçš„è°ƒç”¨ï¼Œåªæ˜¯æŠŠè¾“å…¥å¯¹è±¡é»˜è®¤ä¸ºæ ‡å‡†è¾“å‡ºã€‚\n  func ExamplePrint() { const name, age = \u0026#34;Kim\u0026#34;, 22 fmt.Print(name, \u0026#34; is \u0026#34;, age, \u0026#34; years old.\\n\u0026#34;) // It is conventional not to worry about any \t// error returned by Print.  // Output: \t// Kim is 22 years old. } ExamplePrint() Kim is 22 years old.  fmt.Sprint  å‡½æ•°åŸå‹  Sprint(a ...interface{}) string   å®˜æ–¹æ³¨é‡Š Sprint formats using the default formats for its operands and returns the resulting string.Spaces are added between operands when neither is a string.\n  Arguement æ ¼å¼åŒ–å¹¶è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²è€Œä¸å¸¦ä»»ä½•è¾“å‡º\n  func ExampleSprint() { const name, age = \u0026#34;Kim\u0026#34;, 22 s := fmt.Sprint(name, \u0026#34; is \u0026#34;, age, \u0026#34; years old.\\n\u0026#34;) io.WriteString(os.Stdout, s) // Ignoring error for simplicity.  // Output: \t// Kim is 22 years old. } ExampleSprint() Kim is 22 years old.  fmt.Fprintln  å‡½æ•°åŸå‹  Fprintln(w io.Writer, a ...interface{}) (n int, err error)   å®˜æ–¹æ³¨é‡Š Fprintln formats using the default formats for its operands and writes to w.Spaces are always added between operands and a newline is appended.It returns the number of bytes written and any write error encountered.\n  Arguement è¾“å…¥å­—ç¬¦ä¸²åˆ°io.Writer,å¹¶ä¸”å¸¦æœ‰æ¢è¡Œ\n  func ExampleFprintln() { const name, age = \u0026#34;Kim\u0026#34;, 22 n, err := fmt.Fprintln(os.Stdout, name, \u0026#34;is\u0026#34;, age, \u0026#34;years old.\u0026#34;) // The n and err return values from Fprintln are \t// those returned by the underlying io.Writer. \tif err != nil { fmt.Fprintf(os.Stderr, \u0026#34;Fprintln: %v\\n\u0026#34;, err) } fmt.Println(n, \u0026#34;bytes written.\u0026#34;) // Output: \t// Kim is 22 years old. \t// 21 bytes written. } ExampleFprintln() Kim is 22 years old. 21 bytes written.  fmt.Println  å‡½æ•°åŸå‹  func Println(a ...interface{}) (n int, err error) { return Fprintln(os.Stdout, a...) }   å®˜æ–¹æ³¨é‡Š Println formats using the default formats for its operands and writes to standard output.Spaces are always added between operands and a newline is appended.It returns the number of bytes written and any write error encountered.\n  Arguement æ˜¾ç„¶è¿™ä¸ªå‡½æ•°æ˜¯å¯¹fmt.Fprintlnçš„è°ƒç”¨ï¼Œè¾“å…¥åˆ°os.Stdout\n  func ExamplePrintln() { const name, age = \u0026#34;Kim\u0026#34;, 22 fmt.Println(name, \u0026#34;is\u0026#34;, age, \u0026#34;years old.\u0026#34;) // It is conventional not to worry about any \t// error returned by Println.  // Output: \t// Kim is 22 years old. } ExamplePrintln() Kim is 22 years old.  fmt.Sprintln  å‡½æ•°åŸå‹  Sprintln(a ...interface{}) string   å®˜æ–¹æ³¨é‡Š Sprintln formats using the default formats for its operands and returns the resulting string.Spaces are always added between operands and a newline is appended.\n  Arguement è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¸åšä»»ä½•è¾“å‡º\n  func ExampleSprintln() { const name, age = \u0026#34;Kim\u0026#34;, 22 s := fmt.Sprintln(name, \u0026#34;is\u0026#34;, age, \u0026#34;years old.\u0026#34;) io.WriteString(os.Stdout, s) // Ignoring error for simplicity.  // Output: \t// Kim is 22 years old. } ExampleSprintln() Kim is 22 years old.  æ€»ç»“ æ‰€æœ‰çš„å‡½æ•°åéƒ½æ˜¯_print_æ ¼å¼çš„ï¼Œå…¶ä¸­_ä»£è¡¨æŸä¸ªæ ‡å¿—ï¼Œæ ‡å¿—åŠå…¶å«ä¹‰å¦‚ä¸‹ï¼š\n   æ ‡å¿— å«ä¹‰     _f æ ¼å¼åŒ–   _ln æ¢è¡Œ   F_ è¾“å…¥åˆ°æŸä¸ªå¯¹è±¡   S_ åªè¿”å›è€Œä¸åšè¾“å‡º    ä¸”ï¼Œ fmt.Fprintfå’Œfmt.Printfæ˜¯ä¸€å¯¹\nfmt.Fprintå’Œfmt.Printæ˜¯ä¸€å¯¹\nfmt.Fprintlnå’Œfmt.Printlnæ˜¯ä¸€å¯¹\nä¸å¸¦Få‰ç¼€çš„å‡½æ•°å‡æ˜¯å¯¹å¸¦Få‰ç¼€å‡½æ•°çš„è°ƒç”¨ï¼Œå…¶è¾“å…¥å¯¹è±¡å‡è®¾ç½®ä¸ºæ ‡å‡†è¾“å‡º\n","permalink":"http://yangchnet.github.io/Dessert/posts/golang/golang%E4%B9%8Bprint/","summary":"golangä¸­çš„printç³»å‡½æ•°è¯¦è§£ pirntç³»å‡½æ•°æ¥è‡ªfmtåŒ…ï¼Œä¸»è¦ç”¨äºåšå„ç§æ ¼å¼çš„è¾“å‡º è¿™äº›å‡½æ•°ä¸»è¦æœ‰\n golangä¸­çš„printç³»å‡½æ•°è¯¦è§£  fmt.Fprintf fmt.Printf fmt.Sprintf fmt.Fprint fmt.Print fmt.Sprint fmt.Fprintln fmt.Println fmt.Sprintln æ€»ç»“    ä¸‹é¢æ¥é€ä¸ªåˆ†æ\nimport ( \u0026#34;fmt\u0026#34; \u0026#34;os\u0026#34; \u0026#34;io\u0026#34; ) fmt.Fprintf  å‡½æ•°åŸå‹ï¼š  Fprintf(w io.Writer, format string, a ...interface{}) (n int, err error)   å®˜æ–¹æ³¨é‡Š Fprintf formats according to a format specifier and writes to w.It returns the number of bytes written and any write error encountered.\n  Arguement fmt.Fprintf() ä¾æ®æŒ‡å®šçš„æ ¼å¼å‘ç¬¬ä¸€ä¸ªå‚æ•°å†…å†™å…¥å­—ç¬¦ä¸²ï¼Œç¬¬ä¸€å‚æ•°å¿…é¡»å®ç°äº† io.","title":"golangä¸­çš„printç³»å‡½æ•°è¯¦è§£"},{"content":"Goçš„httpåŒ…è¯¦è§£ è¯¦ç»†åœ°è§£å‰–ä¸€ä¸‹ http åŒ…ï¼Œçœ‹å®ƒåˆ°åº•æ˜¯æ€æ ·å®ç°æ•´ä¸ªè¿‡ç¨‹çš„ã€‚\nGo çš„ http æœ‰ä¸¤ä¸ªæ ¸å¿ƒåŠŸèƒ½ï¼šConnã€ServeMux\nConnçš„goroputine ä¸ºäº†å®ç°é«˜å¹¶å‘å’Œé«˜æ€§èƒ½ï¼Œgoä½¿ç”¨äº†goroutineæ¥å¤„ç†Connçš„è¯»å†™äº‹ä»¶ï¼Œè¿™æ ·æ¯ä¸ªè¯·æ±‚éƒ½èƒ½ä¿æŒç‹¬ç«‹ï¼Œç›¸äº’ä¸ä¼šé˜»å¡ï¼Œå¯ä»¥é«˜æ•ˆçš„ç›¸åº”ç½‘ç»œäº‹ä»¶ã€‚\ngoåœ¨ç­‰å¾…å®¢æˆ·ç«¯è¯·æ±‚ä¸­æ˜¯è¿™æ ·çš„ï¼š\nc, err := srv.newConn(rw) if err != nil { continue } go c.serve() å¯ä»¥çœ‹åˆ°ï¼Œå®¢æˆ·ç«¯çš„æ¯æ¬¡è¯·æ±‚éƒ½ä¼šåˆ›å»ºä¸€ä¸ªConnï¼Œè¿™ä¸ªConné‡Œé¢ä¿å­˜äº†è¯¥æ¬¡è¯·æ±‚çš„ä¿¡æ¯ï¼Œç„¶åå†ä¼ é€’åˆ°ç›¸åº”çš„handlerï¼Œè¯¥handlerä¸­ä¾¿å¯ä»¥è¯»å–åˆ°ç›¸åº”çš„headerä¿¡æ¯ï¼Œè¿™æ ·ä¿è¯äº†æ¯ä¸ªè¯·æ±‚çš„ç‹¬ç«‹æ€§ã€‚\nServeMuxçš„è‡ªå®šä¹‰ conn.serverå†…éƒ¨è°ƒç”¨äº†httpåŒ…é»˜è®¤çš„è·¯ç”±å™¨ï¼Œé€šè¿‡è·¯ç”±å™¨æŠŠæœ¬æ¬¡è¯·æ±‚çš„ä¿¡æ¯ä¼ é€’åˆ°äº†åç«¯çš„å¤„ç†å‡½æ•°ï¼Œé‚£ä¹ˆè¿™ä¸ªè·¯ç”±å™¨æ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿ\nå®ƒçš„ç»“æ„å¦‚ä¸‹ï¼š\ntype ServeMux struct{ mu sync.RWMutext // é”ï¼Œè¯·æ±‚æ¶‰åŠåˆ°å¹¶å‘å¤„ç†ï¼Œå› æ­¤éœ€è¦ä¸€ä¸ªé”æœºåˆ¶  m map[string]muxEntry // è·¯ç”±è§„åˆ™ï¼Œä¸€ä¸ªStringå¯¹åº”ä¸€ä¸ªmuxå®ä½“ï¼Œè¿™é‡Œçš„Stringå°±æ˜¯æ³¨å†Œçš„ä¸€ä¸ªè·¯ç”±è¡¨è¾¾å¼  hosts bool // æ˜¯å¦åœ¨ä»»æ„çš„è§„åˆ™ä¸­å¸¦æœ‰hostä¿¡æ¯ } ä¸‹é¢çœ‹ä¸€ä¸‹muxEntry\ntype muxEntry struct { explicit bool // æ˜¯å¦ç²¾ç¡®åŒ¹é…  h Handler // è¿™ä¸ªè·¯ç”±è¡¨è¾¾å¼å¯¹åº”å“ªä¸ªhandler  pattern string // åŒ¹é…å­—ç¬¦ä¸² } åœ¨çœ‹ä¸€ä¸‹Handlerçš„å®šä¹‰\ntype Handler interface { ServeHTTP(ResponseWriter, *Request) // è·¯ç”±å®ç°å™¨ } Handleræ˜¯ä¸€ä¸ªæ¥å£ï¼Œä½†æ˜¯é™„ä¸­çš„sayhelloNameå‡½æ•°ä¸­å¹¶æ²¡æœ‰å®ç°ServeHTTPè¿™ä¸ªæ¥å£ï¼Œä¸ºä»€ä¹ˆèƒ½æ·»åŠ å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºhttpåŒ…é‡Œé¢è¿˜å®šä¹‰äº†ä¸€ä¸ªç±»å‹HandlerFuncï¼Œå®šä¹‰çš„å‡½æ•°sayhelloNameå°±æ˜¯è¿™ä¸ªHandlerFuncè°ƒç”¨ä¹‹åçš„ç»“æœï¼Œè¿™ä¸ªç±»å‹é»˜è®¤å°±å®ç°äº†ServeHTTPè¿™ä¸ªæ–¹æ³•ï¼Œå³æˆ‘ä»¬è°ƒç”¨äº†HandlerFunc(f)ï¼Œå¼ºåˆ¶ç±»å‹è½¬æ¢fæˆä¸ºHandlerFuncç±»å‹ï¼Œè¿™æ ·få°±æ‹¥æœ‰äº†ServeHTTPæ–¹æ³•ã€‚\ntype HandlerFunc func(ResponseWriter, *Request) // ServeHTTP calls f(w, r) func (f HandlerFunc) ServeHTTP(w ResponseWriter, r *Request){ f (w, r) }  è·¯ç”±å™¨é‡Œé¢å­˜å‚¨å¥½äº†å¯¹åº”çš„è·¯ç”±è§„åˆ™ä¹‹åï¼Œé‚£ä¹ˆå…·ä½“çš„è¯·æ±‚åˆæ˜¯æ€ä¹ˆåˆ†å‘çš„å‘¢ï¼Ÿä¸‹é¢çš„ä»£ç ï¼Œé»˜è®¤çš„è·¯ç”±å™¨å®ç°äº†ServeHTTP\nfunc (mux *ServeMux) ServeHTTP(w ResponseWriter, r *Request) { if r.RequestURL == \u0026#34;*\u0026#34;{ w.Header().Set(\u0026#34;connection\u0026#34;, \u0026#34;clost\u0026#34;) w.WriteHeader(StatusBadReqest) return } h, _ := mux.Handler(r) h.ServeHTTP(w, r) } è·¯ç”±å™¨æ¥æ”¶åˆ°è¯·æ±‚åï¼Œå¦‚æœæ˜¯*é‚£ä¹ˆå…³é—­é“¾æ¥ï¼Œå¦åˆ™è°ƒç”¨mux.Handler(r)è¿”å›å¯¹åº”è®¾ç½®è·¯ç”±çš„å¤„ç†Handlerï¼Œç„¶åæ‰§è¡Œh.ServeHTTP(w, r)ï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨å¯¹åº”è·¯ç”±çš„handlerçš„ServeHTTPæ¥å£ï¼Œé‚£ä¹ˆmux.Handler(r)æ€ä¹ˆå¤„ç†çš„å‘¢ï¼Ÿ\nfunc (mux *ServeMux) Handler(r *Request)(h Handler, pattern string){ if r.Method != \u0026#34;CONNECT\u0026#34; { if p := cleanPath(r.URL.Path); p != r.URL.Path{ _, pattern = mux.handler(r.Host, p) return RedirectHandler(p, StatusMovedPermanently), pattern } } return mux.handler(r.Host, r.URL.Path) } func (mux *ServeMux) handler(host, path string) (h Handler, pattern string) { mux.mu.RLock() defer mux.mu.RUnlock() // Host-specific pattern takes precedence over generic ones  if mux.hosts { h, pattern = mux.match(host + path) } if h == nil { h, pattern = mux.match(path) } if h == nil { h, pattern = NotFoundHandler(), \u0026#34;\u0026#34; } return } æ ¹æ®ç”¨æˆ·è¯·æ±‚çš„URLå’Œè·¯ç”±å™¨é‡Œé¢å­˜å‚¨çš„mapæ¥åŒ¹é…ï¼Œå½“åŒ¹é…åˆ°ä¹‹åè¿”å›å­˜å‚¨çš„handlerï¼Œè°ƒç”¨è¿™ä¸ªhandlerçš„ServeHTTPæ¥å£å°±å¯ä»¥æ‰§è¡Œåˆ°ç›¸åº”çš„å‡½æ•°ã€‚\nGo å…¶å®æ”¯æŒå¤–éƒ¨å®ç°çš„è·¯ç”±å™¨ ListenAndServe çš„ç¬¬äºŒä¸ªå‚æ•°å°±æ˜¯ç”¨ä»¥é…ç½®å¤–éƒ¨è·¯ç”±å™¨çš„ï¼Œå®ƒæ˜¯ä¸€ä¸ª Handler æ¥å£ï¼Œå³å¤–éƒ¨è·¯ç”±å™¨åªè¦å®ç°äº† Handler æ¥å£å°±å¯ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è‡ªå·±å®ç°çš„è·¯ç”±å™¨çš„ ServeHTTP é‡Œé¢å®ç°è‡ªå®šä¹‰è·¯ç”±åŠŸèƒ½ã€‚ å¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼Œæˆ‘ä»¬è‡ªå·±å®ç°äº†ä¸€ä¸ªç®€æ˜“çš„è·¯ç”±å™¨\nimport ( \u0026#34;fmt\u0026#34; \u0026#34;net/http\u0026#34; ) type MyMux struct { } func (p *MyMux) ServeHTTP(w http.ResponseWriter, r *http.Request) { if r.URL.Path == \u0026#34;/\u0026#34; { sayhelloName(w, r) return } http.NotFound(w, r) return } func sayhelloName(w http.ResponseWriter, r *http.Request) { fmt.Fprintf(w, \u0026#34;Hello myroute!\u0026#34;) } func main() { mux := \u0026amp;MyMux{} http.ListenAndServe(\u0026#34;:9090\u0026#34;, mux) } GOä»£ç çš„æ‰§è¡Œæµç¨‹ é€šè¿‡å¯¹httpåŒ…çš„åˆ†æä¹‹åï¼Œç°åœ¨è®©æˆ‘ä»¬æ¥æ¢³ç†ä¸€ä¸‹æ•´ä¸ªçš„ä»£ç æ‰§è¡Œè¿‡ç¨‹ã€‚\n é¦–å…ˆè°ƒç”¨Http.HandleFunc æŒ‰é¡ºåºåšäº†å‡ ä»¶äº‹  è°ƒç”¨äº†DefaultServeMux çš„ HandleFunc è°ƒç”¨äº† DefaultServeMux çš„ Handle å¾€ DefaultServeMux çš„ map [string] muxEntry ä¸­å¢åŠ å¯¹åº”çš„ handler å’Œè·¯ç”±è§„åˆ™   å…¶æ¬¡è°ƒç”¨ http.ListenAndServe (\u0026quot;:9090\u0026quot;, nil)\næŒ‰é¡ºåºåšäº†å‡ ä»¶äº‹  å®ä¾‹åŒ– Server è°ƒç”¨ Server çš„ ListenAndServe () è°ƒç”¨ net.Listen (\u0026ldquo;tcp\u0026rdquo;, addr) ç›‘å¬ç«¯å£ å¯åŠ¨ä¸€ä¸ª for å¾ªç¯ï¼Œåœ¨å¾ªç¯ä½“ä¸­ Accept è¯·æ±‚ å¯¹æ¯ä¸ªè¯·æ±‚å®ä¾‹åŒ–ä¸€ä¸ª Connï¼Œå¹¶ä¸”å¼€å¯ä¸€ä¸ª goroutine ä¸ºè¿™ä¸ªè¯·æ±‚è¿›è¡ŒæœåŠ¡ go c.serve () è¯»å–æ¯ä¸ªè¯·æ±‚çš„å†…å®¹ w, err := c.readRequest () åˆ¤æ–­ handler æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœæ²¡æœ‰è®¾ç½® handlerï¼ˆè¿™ä¸ªä¾‹å­å°±æ²¡æœ‰è®¾ç½® handlerï¼‰ï¼Œhandler å°±è®¾ç½®ä¸º DefaultServeMux è°ƒç”¨ handler çš„ ServeHttp åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä¸‹é¢å°±è¿›å…¥åˆ° DefaultServeMux.ServeHttp æ ¹æ® request é€‰æ‹© handlerï¼Œå¹¶ä¸”è¿›å…¥åˆ°è¿™ä¸ª handler çš„ ServeHTTP  mux.handler(r).ServeHTTP(w, r) é€‰æ‹© handlerï¼š  åˆ¤æ–­æ˜¯å¦æœ‰è·¯ç”±èƒ½æ»¡è¶³è¿™ä¸ª requestï¼ˆå¾ªç¯éå† ServeMux çš„ muxEntryï¼‰ B å¦‚æœæœ‰è·¯ç”±æ»¡è¶³ï¼Œè°ƒç”¨è¿™ä¸ªè·¯ç”± handler çš„ ServeHTTP å¦‚æœæ²¡æœ‰è·¯ç”±æ»¡è¶³ï¼Œè°ƒç”¨ NotFoundHandler çš„ ServeHTTP       é™„ï¼š\nfunc sayHelloName(w http.ResponseWriter, r *http.Request){ r.ParseForm() fmt.Println(r.Form) fmt.Println(\u0026#34;path\u0026#34;, r.URL.Path) fmt.Println(\u0026#34;scheme\u0026#34;, r.URL.Scheme) fmt.Println(r.Form[\u0026#34;url_long\u0026#34;]) for k, v := range r.Form{ fmt.Println(\u0026#34;key: \u0026#34;, k) fmt.Println(\u0026#34;val: \u0026#34;, strings.Join(v, \u0026#34; \u0026#34;)) } fmt.Println(w, \u0026#34;hello world\u0026#34;) } func main() { http.HandleFunc(\u0026#34;/\u0026#34;, sayHelloName) err := http.ListenAndServe(\u0026#34;:9090\u0026#34;, nil) if err != nil { log.Fatal(\u0026#34;listenandserver: \u0026#34;, err) } } ","permalink":"http://yangchnet.github.io/Dessert/posts/golang/go%E7%9A%84http%E5%8C%85%E8%AF%A6%E8%A7%A3/","summary":"Goçš„httpåŒ…è¯¦è§£ è¯¦ç»†åœ°è§£å‰–ä¸€ä¸‹ http åŒ…ï¼Œçœ‹å®ƒåˆ°åº•æ˜¯æ€æ ·å®ç°æ•´ä¸ªè¿‡ç¨‹çš„ã€‚\nGo çš„ http æœ‰ä¸¤ä¸ªæ ¸å¿ƒåŠŸèƒ½ï¼šConnã€ServeMux\nConnçš„goroputine ä¸ºäº†å®ç°é«˜å¹¶å‘å’Œé«˜æ€§èƒ½ï¼Œgoä½¿ç”¨äº†goroutineæ¥å¤„ç†Connçš„è¯»å†™äº‹ä»¶ï¼Œè¿™æ ·æ¯ä¸ªè¯·æ±‚éƒ½èƒ½ä¿æŒç‹¬ç«‹ï¼Œç›¸äº’ä¸ä¼šé˜»å¡ï¼Œå¯ä»¥é«˜æ•ˆçš„ç›¸åº”ç½‘ç»œäº‹ä»¶ã€‚\ngoåœ¨ç­‰å¾…å®¢æˆ·ç«¯è¯·æ±‚ä¸­æ˜¯è¿™æ ·çš„ï¼š\nc, err := srv.newConn(rw) if err != nil { continue } go c.serve() å¯ä»¥çœ‹åˆ°ï¼Œå®¢æˆ·ç«¯çš„æ¯æ¬¡è¯·æ±‚éƒ½ä¼šåˆ›å»ºä¸€ä¸ªConnï¼Œè¿™ä¸ªConné‡Œé¢ä¿å­˜äº†è¯¥æ¬¡è¯·æ±‚çš„ä¿¡æ¯ï¼Œç„¶åå†ä¼ é€’åˆ°ç›¸åº”çš„handlerï¼Œè¯¥handlerä¸­ä¾¿å¯ä»¥è¯»å–åˆ°ç›¸åº”çš„headerä¿¡æ¯ï¼Œè¿™æ ·ä¿è¯äº†æ¯ä¸ªè¯·æ±‚çš„ç‹¬ç«‹æ€§ã€‚\nServeMuxçš„è‡ªå®šä¹‰ conn.serverå†…éƒ¨è°ƒç”¨äº†httpåŒ…é»˜è®¤çš„è·¯ç”±å™¨ï¼Œé€šè¿‡è·¯ç”±å™¨æŠŠæœ¬æ¬¡è¯·æ±‚çš„ä¿¡æ¯ä¼ é€’åˆ°äº†åç«¯çš„å¤„ç†å‡½æ•°ï¼Œé‚£ä¹ˆè¿™ä¸ªè·¯ç”±å™¨æ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿ\nå®ƒçš„ç»“æ„å¦‚ä¸‹ï¼š\ntype ServeMux struct{ mu sync.RWMutext // é”ï¼Œè¯·æ±‚æ¶‰åŠåˆ°å¹¶å‘å¤„ç†ï¼Œå› æ­¤éœ€è¦ä¸€ä¸ªé”æœºåˆ¶  m map[string]muxEntry // è·¯ç”±è§„åˆ™ï¼Œä¸€ä¸ªStringå¯¹åº”ä¸€ä¸ªmuxå®ä½“ï¼Œè¿™é‡Œçš„Stringå°±æ˜¯æ³¨å†Œçš„ä¸€ä¸ªè·¯ç”±è¡¨è¾¾å¼  hosts bool // æ˜¯å¦åœ¨ä»»æ„çš„è§„åˆ™ä¸­å¸¦æœ‰hostä¿¡æ¯ } ä¸‹é¢çœ‹ä¸€ä¸‹muxEntry\ntype muxEntry struct { explicit bool // æ˜¯å¦ç²¾ç¡®åŒ¹é…  h Handler // è¿™ä¸ªè·¯ç”±è¡¨è¾¾å¼å¯¹åº”å“ªä¸ªhandler  pattern string // åŒ¹é…å­—ç¬¦ä¸² } åœ¨çœ‹ä¸€ä¸‹Handlerçš„å®šä¹‰\ntype Handler interface { ServeHTTP(ResponseWriter, *Request) // è·¯ç”±å®ç°å™¨ } Handleræ˜¯ä¸€ä¸ªæ¥å£ï¼Œä½†æ˜¯é™„ä¸­çš„sayhelloNameå‡½æ•°ä¸­å¹¶æ²¡æœ‰å®ç°ServeHTTPè¿™ä¸ªæ¥å£ï¼Œä¸ºä»€ä¹ˆèƒ½æ·»åŠ å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºhttpåŒ…é‡Œé¢è¿˜å®šä¹‰äº†ä¸€ä¸ªç±»å‹HandlerFuncï¼Œå®šä¹‰çš„å‡½æ•°sayhelloNameå°±æ˜¯è¿™ä¸ªHandlerFuncè°ƒç”¨ä¹‹åçš„ç»“æœï¼Œè¿™ä¸ªç±»å‹é»˜è®¤å°±å®ç°äº†ServeHTTPè¿™ä¸ªæ–¹æ³•ï¼Œå³æˆ‘ä»¬è°ƒç”¨äº†HandlerFunc(f)ï¼Œå¼ºåˆ¶ç±»å‹è½¬æ¢fæˆä¸ºHandlerFuncç±»å‹ï¼Œè¿™æ ·få°±æ‹¥æœ‰äº†ServeHTTPæ–¹æ³•ã€‚","title":"Goçš„httpåŒ…è¯¦è§£"},{"content":"1.å€¼ç±»å‹ä¸å¼•ç”¨ç±»å‹ å€¼ç±»å‹ï¼šintã€floatã€boolå’Œstringè¿™äº›ç±»å‹éƒ½å±äºå€¼ç±»å‹ï¼Œä½¿ç”¨è¿™äº›ç±»å‹çš„å˜é‡ç›´æ¥æŒ‡å‘å­˜åœ¨å†…å­˜ä¸­çš„å€¼ï¼Œå€¼ç±»å‹çš„å˜é‡çš„å€¼å­˜å‚¨åœ¨æ ˆä¸­ã€‚å½“ä½¿ç”¨ç­‰å·=å°†ä¸€ä¸ªå˜é‡çš„å€¼èµ‹ç»™å¦ä¸€ä¸ªå˜é‡æ—¶ï¼Œå¦‚ j = i ,å®é™…ä¸Šæ˜¯åœ¨å†…å­˜ä¸­å°† i çš„å€¼è¿›è¡Œäº†æ‹·è´ã€‚å¯ä»¥é€šè¿‡ \u0026amp;i è·å–å˜é‡ i çš„å†…å­˜åœ°å€\nå¼•ç”¨ç±»å‹ï¼šç‰¹æŒ‡sliceã€mapã€channelè¿™ä¸‰ç§é¢„å®šä¹‰ç±»å‹ã€‚å¼•ç”¨ç±»å‹æ‹¥æœ‰æ›´å¤æ‚çš„å­˜å‚¨ç»“æ„:(1)åˆ†é…å†…å­˜ (2)åˆå§‹åŒ–ä¸€ç³»åˆ—å±æ€§ç­‰ã€‚ä¸€ä¸ªå¼•ç”¨ç±»å‹çš„å˜é‡r1å­˜å‚¨çš„æ˜¯r1çš„å€¼æ‰€åœ¨çš„å†…å­˜åœ°å€ï¼ˆæ•°å­—ï¼‰ï¼Œæˆ–å†…å­˜åœ°å€ä¸­ç¬¬ä¸€ä¸ªå­—æ‰€åœ¨çš„ä½ç½®ï¼Œè¿™ä¸ªå†…å­˜åœ°å€è¢«ç§°ä¹‹ä¸ºæŒ‡é’ˆï¼Œè¿™ä¸ªæŒ‡é’ˆå®é™…ä¸Šä¹Ÿè¢«å­˜åœ¨å¦å¤–çš„æŸä¸€ä¸ªå­—ä¸­\n2.å€¼ç±»å‹ä¸å¼•ç”¨ç±»å‹çš„åŒºåˆ« é¦–å…ˆæ˜ç¡®ï¼Œgolangä¸­æ— è®ºæ˜¯ä»€ä¹ˆç±»å‹ï¼Œä¼ å‚æ—¶éƒ½æ˜¯ä¼ é€’çš„åŸå€¼çš„å¤åˆ¶ï¼Œå› æ­¤ï¼Œå€¼ç±»å‹ç›´æ¥ä¼ å…¥å‡½æ•°ï¼Œä»»ä½•å˜åŠ¨éƒ½ä¼šåæ˜ åˆ°åŸå€¼ä¸Šï¼Œè€Œå¯¹äºå¼•ç”¨ç±»å‹ï¼Œå…¶ä¼ é€’çš„æ˜¯åŸå€¼ç±»å‹çš„ä¸€ä¸ªå¤åˆ¶ï¼Œå› æ­¤åœ¨å‡½æ•°å†…çš„ä¿®æ”¹ï¼Œå¯èƒ½ä¼šåæ˜ åˆ°åŸå€¼ä¸­ï¼Œä¹Ÿå¯èƒ½ä¸ä¼šã€‚å…·ä½“å–å†³å¼•ç”¨ç±»å‹çš„æ„é€ æ–¹å¼åŠå…¶å†…éƒ¨å®šä¹‰ã€‚å¯å‚è€ƒå¦ä¸€ç¯‡æ–‡ç« sliceå’Œæ•°ç»„çš„åŒºåˆ«\n2.1.å€¼ç±»å‹ //å…ˆå®šä¹‰ä¸€ä¸ªæ•°ç»„ var a = [5]int{1, 2, 3, 4, 5} //å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œå°†æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå€¼è®¾ä¸º0 func change(a [5]int){ a[0] = 0 fmt.Println(a) } change(a) fmt.Println(a)  è¾“å‡ºï¼š\n [0 2 3 4 5] [1 2 3 4 5] å¯ä»¥çœ‹åˆ°ï¼Œæ•°ç»„åœ¨å‡½æ•°å†…éƒ¨è¢«å˜æˆ{0,1,2,3,4}ï¼Œä½†å½“å‡½æ•°ç»“æŸï¼Œè¿˜æ˜¯åŸæ¥çš„å€¼æ²¡æœ‰å˜ã€‚\n2.2 å¼•ç”¨ç±»å‹  mapçš„æ„é€ å‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘mapå¯¹è±¡ï¼Œå› æ­¤å¯¹äºmapçš„ä»»ä½•æ“ä½œéƒ½ä¼šåæ˜ åˆ°åŸmapä¸­\n // å®šä¹‰ä¸€ä¸ªmap var dit = make(map[string]int) dit[\u0026#34;one\u0026#34;] = 1 fmt.Println(dit) // ä¼ å‚å¹¶åšæ”¹å˜ func change(dit map[string]int){ dit[\u0026#34;two\u0026#34;] = 2 fmt.Println(dit) } change(dit) //è¾“å‡ºåŸæ¥çš„map fmt.Println(dit)  è¾“å‡º\n map[one:1] map[one:1 two:2] map[one:1 two:2] å°†mapä½œä¸ºå‚æ•°ä¼ å…¥å‡½æ•°ï¼Œå½“åœ¨å‡½æ•°å†…éƒ¨å¯¹å‚æ•°è¿›è¡Œä¿®æ”¹æ—¶ï¼ŒåŸæ•°æ®ä¹Ÿéšä¹‹å˜åŒ–ã€‚\n å¼•ç”¨ç±»å‹åŒ…æ‹¬slice,map,channel.\nå†…ç½®å‡½æ•°newè®¡ç®—ç±»å‹å¤§å°,ä¸ºå…¶åˆ†é…é›¶å€¼å†…å­˜,è¿”å›æŒ‡é’ˆ.è€Œmakeä¼šè¢«ç¼–è¯‘å™¨ç¿»è¯‘æˆå…·ä½“çš„åˆ›å»ºå‡½æ•°,ç”±å…¶åˆ†é…å†…å­˜å’Œåˆå§‹åŒ–æˆå‘˜ç»“æ„,è¿”å›å¯¹è±¡è€ŒéæŒ‡é’ˆ.\n","permalink":"http://yangchnet.github.io/Dessert/posts/golang/%E5%80%BC%E7%B1%BB%E5%9E%8B%E4%B8%8E%E5%BC%95%E7%94%A8%E7%B1%BB%E5%9E%8B/","summary":"1.å€¼ç±»å‹ä¸å¼•ç”¨ç±»å‹ å€¼ç±»å‹ï¼šintã€floatã€boolå’Œstringè¿™äº›ç±»å‹éƒ½å±äºå€¼ç±»å‹ï¼Œä½¿ç”¨è¿™äº›ç±»å‹çš„å˜é‡ç›´æ¥æŒ‡å‘å­˜åœ¨å†…å­˜ä¸­çš„å€¼ï¼Œå€¼ç±»å‹çš„å˜é‡çš„å€¼å­˜å‚¨åœ¨æ ˆä¸­ã€‚å½“ä½¿ç”¨ç­‰å·=å°†ä¸€ä¸ªå˜é‡çš„å€¼èµ‹ç»™å¦ä¸€ä¸ªå˜é‡æ—¶ï¼Œå¦‚ j = i ,å®é™…ä¸Šæ˜¯åœ¨å†…å­˜ä¸­å°† i çš„å€¼è¿›è¡Œäº†æ‹·è´ã€‚å¯ä»¥é€šè¿‡ \u0026amp;i è·å–å˜é‡ i çš„å†…å­˜åœ°å€\nå¼•ç”¨ç±»å‹ï¼šç‰¹æŒ‡sliceã€mapã€channelè¿™ä¸‰ç§é¢„å®šä¹‰ç±»å‹ã€‚å¼•ç”¨ç±»å‹æ‹¥æœ‰æ›´å¤æ‚çš„å­˜å‚¨ç»“æ„:(1)åˆ†é…å†…å­˜ (2)åˆå§‹åŒ–ä¸€ç³»åˆ—å±æ€§ç­‰ã€‚ä¸€ä¸ªå¼•ç”¨ç±»å‹çš„å˜é‡r1å­˜å‚¨çš„æ˜¯r1çš„å€¼æ‰€åœ¨çš„å†…å­˜åœ°å€ï¼ˆæ•°å­—ï¼‰ï¼Œæˆ–å†…å­˜åœ°å€ä¸­ç¬¬ä¸€ä¸ªå­—æ‰€åœ¨çš„ä½ç½®ï¼Œè¿™ä¸ªå†…å­˜åœ°å€è¢«ç§°ä¹‹ä¸ºæŒ‡é’ˆï¼Œè¿™ä¸ªæŒ‡é’ˆå®é™…ä¸Šä¹Ÿè¢«å­˜åœ¨å¦å¤–çš„æŸä¸€ä¸ªå­—ä¸­\n2.å€¼ç±»å‹ä¸å¼•ç”¨ç±»å‹çš„åŒºåˆ« é¦–å…ˆæ˜ç¡®ï¼Œgolangä¸­æ— è®ºæ˜¯ä»€ä¹ˆç±»å‹ï¼Œä¼ å‚æ—¶éƒ½æ˜¯ä¼ é€’çš„åŸå€¼çš„å¤åˆ¶ï¼Œå› æ­¤ï¼Œå€¼ç±»å‹ç›´æ¥ä¼ å…¥å‡½æ•°ï¼Œä»»ä½•å˜åŠ¨éƒ½ä¼šåæ˜ åˆ°åŸå€¼ä¸Šï¼Œè€Œå¯¹äºå¼•ç”¨ç±»å‹ï¼Œå…¶ä¼ é€’çš„æ˜¯åŸå€¼ç±»å‹çš„ä¸€ä¸ªå¤åˆ¶ï¼Œå› æ­¤åœ¨å‡½æ•°å†…çš„ä¿®æ”¹ï¼Œå¯èƒ½ä¼šåæ˜ åˆ°åŸå€¼ä¸­ï¼Œä¹Ÿå¯èƒ½ä¸ä¼šã€‚å…·ä½“å–å†³å¼•ç”¨ç±»å‹çš„æ„é€ æ–¹å¼åŠå…¶å†…éƒ¨å®šä¹‰ã€‚å¯å‚è€ƒå¦ä¸€ç¯‡æ–‡ç« sliceå’Œæ•°ç»„çš„åŒºåˆ«\n2.1.å€¼ç±»å‹ //å…ˆå®šä¹‰ä¸€ä¸ªæ•°ç»„ var a = [5]int{1, 2, 3, 4, 5} //å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œå°†æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå€¼è®¾ä¸º0 func change(a [5]int){ a[0] = 0 fmt.Println(a) } change(a) fmt.Println(a)  è¾“å‡ºï¼š\n [0 2 3 4 5] [1 2 3 4 5] å¯ä»¥çœ‹åˆ°ï¼Œæ•°ç»„åœ¨å‡½æ•°å†…éƒ¨è¢«å˜æˆ{0,1,2,3,4}ï¼Œä½†å½“å‡½æ•°ç»“æŸï¼Œè¿˜æ˜¯åŸæ¥çš„å€¼æ²¡æœ‰å˜ã€‚\n2.2 å¼•ç”¨ç±»å‹  mapçš„æ„é€ å‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘mapå¯¹è±¡ï¼Œå› æ­¤å¯¹äºmapçš„ä»»ä½•æ“ä½œéƒ½ä¼šåæ˜ åˆ°åŸmapä¸­\n // å®šä¹‰ä¸€ä¸ªmap var dit = make(map[string]int) dit[\u0026#34;one\u0026#34;] = 1 fmt.Println(dit) // ä¼ å‚å¹¶åšæ”¹å˜ func change(dit map[string]int){ dit[\u0026#34;two\u0026#34;] = 2 fmt.","title":"Goè¯­è¨€ä¸­å€¼ç±»å‹ä¸å¼•ç”¨ç±»å‹"},{"content":"Goè¯­è¨€ä¸­çš„å­—é¢é‡  Goè¯­è¨€ä¸­çš„å­—é¢é‡  ä»€ä¹ˆæ˜¯å­—é¢é‡ æ•´å‹å’Œæµ®ç‚¹å‹çš„å­—é¢å€¼ å­—ç¬¦ä¸²çš„å­—é¢å€¼ å¸¸é‡çš„å­—é¢å€¼ æ•°ç»„çš„å­—é¢å€¼ Sliceçš„å­—é¢å€¼ Mapçš„å­—é¢å€¼ ç»“æ„ä½“çš„å­—é¢å€¼    ä»€ä¹ˆæ˜¯å­—é¢é‡ åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œå­—é¢é‡ï¼ˆliteralï¼‰æ˜¯ç”¨äºè¡¨è¾¾æºä»£ç ä¸­ä¸€ä¸ªå›ºå®šå€¼çš„è¡¨ç¤ºæ³•ï¼ˆnotationï¼‰ã€‚\nç®€å•çš„è¯´ï¼Œå­—é¢é‡æˆ–è€…è¯´å­—é¢å€¼å°±æ˜¯ä¸€ä¸ªå˜é‡çš„å€¼ã€‚\næ•´å‹å’Œæµ®ç‚¹å‹çš„å­—é¢å€¼ var i int = 1 var f float64 = 3.14159 å­—ç¬¦ä¸²çš„å­—é¢å€¼ å­—ç¬¦ä¸²å€¼ä¹Ÿå¯ä»¥ç”¨å­—ç¬¦ä¸²é¢å€¼æ–¹å¼ç¼–å†™ï¼Œåªè¦å°†ä¸€ç³»åˆ—å­—èŠ‚åºåˆ—åŒ…å«åœ¨åŒå¼•å·å³å¯ï¼š\n\u0026#34;Hello ä¸–ç•Œ\u0026#34; `ä¸–ç•Œ`  ä¸–ç•Œ ä¸€ä¸ªåŸç”Ÿçš„å­—ç¬¦ä¸²é¢å€¼å½¢å¼æ˜¯\n`...` ä½¿ç”¨åå¼•å·ä»£æ›¿åŒå¼•å·ã€‚åœ¨åŸç”Ÿçš„å­—ç¬¦ä¸²é¢å€¼ä¸­ï¼Œæ²¡æœ‰è½¬ä¹‰æ“ä½œï¼›å…¨éƒ¨çš„å†…å®¹éƒ½æ˜¯å­—é¢çš„æ„æ€ï¼ŒåŒ…å«é€€æ ¼å’Œæ¢è¡Œï¼Œå› æ­¤ä¸€ä¸ªç¨‹åºä¸­çš„åŸç”Ÿå­—ç¬¦ä¸²é¢å€¼å¯èƒ½è·¨è¶Šå¤šè¡Œï¼ˆè¯‘æ³¨ï¼šåœ¨åŸç”Ÿå­—ç¬¦ä¸²é¢å€¼å†…éƒ¨æ˜¯æ— æ³•ç›´æ¥å†™```````å­—ç¬¦çš„ï¼Œå¯ä»¥ç”¨å…«è¿›åˆ¶æˆ–åå…­è¿›åˆ¶è½¬ä¹‰æˆ–+\u0026quot;`\u0026quot;é“¾æ¥å­—ç¬¦ä¸²å¸¸é‡å®Œæˆï¼‰ã€‚å”¯ä¸€çš„ç‰¹æ®Šå¤„ç†æ˜¯ä¼šåˆ é™¤å›è½¦ä»¥ä¿è¯åœ¨æ‰€æœ‰å¹³å°ä¸Šçš„å€¼éƒ½æ˜¯ä¸€æ ·çš„ï¼ŒåŒ…æ‹¬é‚£äº›æŠŠå›è½¦ä¹Ÿæ”¾å…¥æ–‡æœ¬æ–‡ä»¶çš„ç³»ç»Ÿï¼ˆè¯‘æ³¨ï¼šWindowsç³»ç»Ÿä¼šæŠŠå›è½¦å’Œæ¢è¡Œä¸€èµ·æ”¾å…¥æ–‡æœ¬æ–‡ä»¶ä¸­ï¼‰ã€‚\nåŸç”Ÿå­—ç¬¦ä¸²é¢å€¼ç”¨äºç¼–å†™æ­£åˆ™è¡¨è¾¾å¼ä¼šå¾ˆæ–¹ä¾¿ï¼Œå› ä¸ºæ­£åˆ™è¡¨è¾¾å¼å¾€å¾€ä¼šåŒ…å«å¾ˆå¤šåæ–œæ ã€‚åŸç”Ÿå­—ç¬¦ä¸²é¢å€¼åŒæ—¶è¢«å¹¿æ³›åº”ç”¨äºHTMLæ¨¡æ¿ã€JSONé¢å€¼ã€å‘½ä»¤è¡Œæç¤ºä¿¡æ¯ä»¥åŠé‚£äº›éœ€è¦æ‰©å±•åˆ°å¤šè¡Œçš„åœºæ™¯ã€‚\nconst GoUsage = `Go is a tool for managing Go source code. Usage: go command [arguments] ...` GoUsage  Go is a tool for managing Go source code. Usage: go command [arguments] ... å¸¸é‡çš„å­—é¢å€¼ å¯¹äºå¸¸é‡é¢å€¼ï¼Œä¸åŒçš„å†™æ³•å¯èƒ½ä¼šå¯¹åº”ä¸åŒçš„ç±»å‹ã€‚ä¾‹å¦‚0ã€0.0ã€0iå’Œ\\u0000è™½ç„¶æœ‰ç€ç›¸åŒçš„å¸¸é‡å€¼ï¼Œä½†æ˜¯å®ƒä»¬åˆ†åˆ«å¯¹åº”æ— ç±»å‹çš„æ•´æ•°ã€æ— ç±»å‹çš„æµ®ç‚¹æ•°ã€æ— ç±»å‹çš„å¤æ•°å’Œæ— ç±»å‹çš„å­—ç¬¦ç­‰ä¸åŒçš„å¸¸é‡ç±»å‹ã€‚åŒæ ·ï¼Œtrueå’Œfalseä¹Ÿæ˜¯æ— ç±»å‹çš„å¸ƒå°”ç±»å‹ï¼Œå­—ç¬¦ä¸²é¢å€¼å¸¸é‡æ˜¯æ— ç±»å‹çš„å­—ç¬¦ä¸²ç±»å‹ã€‚\næ•°ç»„çš„å­—é¢å€¼ ä½¿ç”¨æ•°ç»„å­—é¢å€¼è¯­æ³•ç”¨ä¸€ç»„å€¼æ¥åˆå§‹åŒ–æ•°ç»„ï¼š\nvar q [3]int = [3]int{1, 2, 3} var r [3]int = [3]int{1, 2} r[2]  0 åœ¨æ•°ç»„å­—é¢å€¼ä¸­ï¼Œå¦‚æœåœ¨æ•°ç»„çš„é•¿åº¦ä½ç½®å‡ºç°çš„æ˜¯â€œ\u0026hellip;â€çœç•¥å·ï¼Œåˆ™è¡¨ç¤ºæ•°ç»„çš„é•¿åº¦æ˜¯æ ¹æ®åˆå§‹åŒ–å€¼çš„ä¸ªæ•°æ¥è®¡ç®—ã€‚å› æ­¤ï¼Œä¸Šé¢qæ•°ç»„çš„å®šä¹‰å¯ä»¥ç®€åŒ–ä¸º\nimport \u0026#34;fmt\u0026#34; q := [...]int{1, 2, 3} fmt.Printf(\u0026#34;%T\\n\u0026#34;, q) // \u0026#34;[3]int\u0026#34;  [3]int 7 \u0026lt;nil\u0026gt; æ•°ç»„ã€sliceã€mapå’Œç»“æ„ä½“å­—é¢å€¼çš„å†™æ³•éƒ½å¾ˆç›¸ä¼¼ã€‚ä¸Šé¢çš„å½¢å¼æ˜¯ç›´æ¥æä¾›é¡ºåºåˆå§‹åŒ–å€¼åºåˆ—ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥æŒ‡å®šä¸€ä¸ªç´¢å¼•å’Œå¯¹åº”å€¼åˆ—è¡¨çš„æ–¹å¼åˆå§‹åŒ–ï¼Œå°±åƒä¸‹é¢è¿™æ ·ï¼š\ntype Currency int const ( USD Currency = iota // ç¾å…ƒ  EUR // æ¬§å…ƒ  GBP // è‹±é•‘  RMB // äººæ°‘å¸ ) //è¿™ä¸ªçœ‹èµ·æ¥å’Œå­—å…¸å¾ˆç›¸ä¼¼ï¼Œä½†å…¶å®USDç­‰æ ‡è¯†æ˜¯indexä¸‹æ ‡ symbol := [...]string{USD: \u0026#34;$\u0026#34;, EUR: \u0026#34;â‚¬\u0026#34;, GBP: \u0026#34;ï¿¡\u0026#34;, RMB: \u0026#34;ï¿¥\u0026#34;} fmt.Println(RMB, symbol[RMB]) // \u0026#34;3 ï¿¥\u0026#34; symbol[EUR] == symbol[1]  3 ï¿¥ true Sliceçš„å­—é¢å€¼ sliceå’Œæ•°ç»„çš„å­—é¢å€¼è¯­æ³•å¾ˆç±»ä¼¼ï¼Œå®ƒä»¬éƒ½æ˜¯ç”¨èŠ±æ‹¬å¼§åŒ…å«ä¸€ç³»åˆ—çš„åˆå§‹åŒ–å…ƒç´ ï¼Œä½†æ˜¯å¯¹äºsliceå¹¶æ²¡æœ‰æŒ‡æ˜åºåˆ—çš„é•¿åº¦ã€‚è¿™ä¼šéšå¼åœ°åˆ›å»ºä¸€ä¸ªåˆé€‚å¤§å°çš„æ•°ç»„ï¼Œç„¶åsliceçš„æŒ‡é’ˆæŒ‡å‘åº•å±‚çš„æ•°ç»„ã€‚å°±åƒæ•°ç»„å­—é¢å€¼ä¸€æ ·ï¼Œsliceçš„å­—é¢å€¼ä¹Ÿå¯ä»¥æŒ‰é¡ºåºæŒ‡å®šåˆå§‹åŒ–å€¼åºåˆ—ï¼Œæˆ–è€…æ˜¯é€šè¿‡ç´¢å¼•å’Œå…ƒç´ å€¼æŒ‡å®šï¼Œæˆ–è€…ä¸¤ç§é£æ ¼çš„æ··åˆè¯­æ³•åˆå§‹åŒ–ã€‚\ns := []int{0, 1, 2, 3, 4, 5} s  [0 1 2 3 4 5] a := []string{\u0026#34;one\u0026#34;, \u0026#34;two\u0026#34;, 4:\u0026#34;three\u0026#34;} a[4]  three Mapçš„å­—é¢å€¼ ç”¨mapå­—é¢å€¼çš„è¯­æ³•åˆ›å»ºmapï¼ŒåŒæ—¶è¿˜å¯ä»¥æŒ‡å®šä¸€äº›æœ€åˆçš„key/valueï¼š\nages := map[string]int{ \u0026#34;alice\u0026#34;: 31, \u0026#34;charlie\u0026#34;: 34, } è¿™ç›¸å½“äº\nages := make(map[string]int) ages[\u0026#34;alice\u0026#34;] = 31 ages[\u0026#34;charlie\u0026#34;] = 34 ç»“æ„ä½“çš„å­—é¢å€¼ ç¬¬ä¸€ç§å†™æ³•\ntype Point struct{ X, Y int } p := Point{1, 2} æ›´å¸¸ç”¨çš„æ˜¯ç¬¬äºŒç§å†™æ³•ï¼Œä»¥æˆå‘˜åå­—å’Œç›¸åº”çš„å€¼æ¥åˆå§‹åŒ–ï¼Œå¯ä»¥åŒ…å«éƒ¨åˆ†æˆ–å…¨éƒ¨çš„æˆå‘˜\nanim := gif.GIF{LoopCount: nframes}  repl.go:1:9: undefined \u0026quot;gif\u0026quot; in gif.GIF \u0026lt;*ast.SelectorExpr\u0026gt; ä¸¤ç§å†™æ³•ä¸èƒ½æ··ç”¨\n","permalink":"http://yangchnet.github.io/Dessert/posts/golang/go%E8%AF%AD%E8%A8%80%E4%B8%AD%E7%9A%84%E5%AD%97%E9%9D%A2%E9%87%8F/","summary":"Goè¯­è¨€ä¸­çš„å­—é¢é‡  Goè¯­è¨€ä¸­çš„å­—é¢é‡  ä»€ä¹ˆæ˜¯å­—é¢é‡ æ•´å‹å’Œæµ®ç‚¹å‹çš„å­—é¢å€¼ å­—ç¬¦ä¸²çš„å­—é¢å€¼ å¸¸é‡çš„å­—é¢å€¼ æ•°ç»„çš„å­—é¢å€¼ Sliceçš„å­—é¢å€¼ Mapçš„å­—é¢å€¼ ç»“æ„ä½“çš„å­—é¢å€¼    ä»€ä¹ˆæ˜¯å­—é¢é‡ åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œå­—é¢é‡ï¼ˆliteralï¼‰æ˜¯ç”¨äºè¡¨è¾¾æºä»£ç ä¸­ä¸€ä¸ªå›ºå®šå€¼çš„è¡¨ç¤ºæ³•ï¼ˆnotationï¼‰ã€‚\nç®€å•çš„è¯´ï¼Œå­—é¢é‡æˆ–è€…è¯´å­—é¢å€¼å°±æ˜¯ä¸€ä¸ªå˜é‡çš„å€¼ã€‚\næ•´å‹å’Œæµ®ç‚¹å‹çš„å­—é¢å€¼ var i int = 1 var f float64 = 3.14159 å­—ç¬¦ä¸²çš„å­—é¢å€¼ å­—ç¬¦ä¸²å€¼ä¹Ÿå¯ä»¥ç”¨å­—ç¬¦ä¸²é¢å€¼æ–¹å¼ç¼–å†™ï¼Œåªè¦å°†ä¸€ç³»åˆ—å­—èŠ‚åºåˆ—åŒ…å«åœ¨åŒå¼•å·å³å¯ï¼š\n\u0026#34;Hello ä¸–ç•Œ\u0026#34; `ä¸–ç•Œ`  ä¸–ç•Œ ä¸€ä¸ªåŸç”Ÿçš„å­—ç¬¦ä¸²é¢å€¼å½¢å¼æ˜¯\n`...` ä½¿ç”¨åå¼•å·ä»£æ›¿åŒå¼•å·ã€‚åœ¨åŸç”Ÿçš„å­—ç¬¦ä¸²é¢å€¼ä¸­ï¼Œæ²¡æœ‰è½¬ä¹‰æ“ä½œï¼›å…¨éƒ¨çš„å†…å®¹éƒ½æ˜¯å­—é¢çš„æ„æ€ï¼ŒåŒ…å«é€€æ ¼å’Œæ¢è¡Œï¼Œå› æ­¤ä¸€ä¸ªç¨‹åºä¸­çš„åŸç”Ÿå­—ç¬¦ä¸²é¢å€¼å¯èƒ½è·¨è¶Šå¤šè¡Œï¼ˆè¯‘æ³¨ï¼šåœ¨åŸç”Ÿå­—ç¬¦ä¸²é¢å€¼å†…éƒ¨æ˜¯æ— æ³•ç›´æ¥å†™```````å­—ç¬¦çš„ï¼Œå¯ä»¥ç”¨å…«è¿›åˆ¶æˆ–åå…­è¿›åˆ¶è½¬ä¹‰æˆ–+\u0026quot;`\u0026quot;é“¾æ¥å­—ç¬¦ä¸²å¸¸é‡å®Œæˆï¼‰ã€‚å”¯ä¸€çš„ç‰¹æ®Šå¤„ç†æ˜¯ä¼šåˆ é™¤å›è½¦ä»¥ä¿è¯åœ¨æ‰€æœ‰å¹³å°ä¸Šçš„å€¼éƒ½æ˜¯ä¸€æ ·çš„ï¼ŒåŒ…æ‹¬é‚£äº›æŠŠå›è½¦ä¹Ÿæ”¾å…¥æ–‡æœ¬æ–‡ä»¶çš„ç³»ç»Ÿï¼ˆè¯‘æ³¨ï¼šWindowsç³»ç»Ÿä¼šæŠŠå›è½¦å’Œæ¢è¡Œä¸€èµ·æ”¾å…¥æ–‡æœ¬æ–‡ä»¶ä¸­ï¼‰ã€‚\nåŸç”Ÿå­—ç¬¦ä¸²é¢å€¼ç”¨äºç¼–å†™æ­£åˆ™è¡¨è¾¾å¼ä¼šå¾ˆæ–¹ä¾¿ï¼Œå› ä¸ºæ­£åˆ™è¡¨è¾¾å¼å¾€å¾€ä¼šåŒ…å«å¾ˆå¤šåæ–œæ ã€‚åŸç”Ÿå­—ç¬¦ä¸²é¢å€¼åŒæ—¶è¢«å¹¿æ³›åº”ç”¨äºHTMLæ¨¡æ¿ã€JSONé¢å€¼ã€å‘½ä»¤è¡Œæç¤ºä¿¡æ¯ä»¥åŠé‚£äº›éœ€è¦æ‰©å±•åˆ°å¤šè¡Œçš„åœºæ™¯ã€‚\nconst GoUsage = `Go is a tool for managing Go source code. Usage: go command [arguments] ...` GoUsage  Go is a tool for managing Go source code. Usage: go command [arguments] .","title":"Goè¯­è¨€ä¸­çš„å­—é¢é‡"},{"content":"0. é”™è¯¯å¤„ç†çš„ç¼–ç é£æ ¼ æ£€æŸ¥æŸä¸ªå­å‡½æ•°æ˜¯å¦å¤±è´¥åï¼Œæˆ‘ä»¬é€šå¸¸å°†å¤„ç†å¤±è´¥çš„é€»è¾‘ä»£ç æ”¾åœ¨å¤„ç†æˆåŠŸçš„ä»£ç ä¹‹å‰ã€‚å¦‚æœæŸä¸ªé”™è¯¯ä¼šå¯¼è‡´å‡½æ•°è¿”å›ï¼Œé‚£ä¹ˆæˆåŠŸçš„é€»è¾‘ä»£ç ä¸åº”è¯¥æ”¾åœ¨elseä¸­ï¼Œè€Œåº”ç›´æ¥æ”¾åœ¨å‡½æ•°ä½“ä¸­ã€‚\n1. é”™è¯¯ä¼ æ’­ å‡½æ•°æŸä¸ªå­ç¨‹åºçš„å¤±è´¥ï¼Œä¼šå˜æˆè¯¥å‡½æ•°çš„å¤±è´¥\nresp, err := http.Get(url) if err != nil{ return nill, err } æˆ–æ˜¯æ„é€ æ–°çš„é”™è¯¯ä¿¡æ¯è¿”å›ç»™è°ƒç”¨è€…\ndoc, err := html.Parse(resp.Body) resp.Body.Close() if err != nil { return nil, fmt.Errorf(\u0026#34;parsing %s as HTML: %v\u0026#34;, url,err) } ä¸€èˆ¬è€Œè¨€ï¼Œè¢«è°ƒå‡½æ•°f(x)ä¼šå°†è°ƒç”¨ä¿¡æ¯å’Œå‚æ•°ä¿¡æ¯ä½œä¸ºå‘ç”Ÿé”™è¯¯æ—¶çš„ä¸Šä¸‹æ–‡æ”¾åœ¨é”™è¯¯ä¿¡æ¯ä¸­å¹¶è¿”å›ç»™è°ƒç”¨è€…ï¼Œè°ƒç”¨è€…éœ€è¦æ·»åŠ ä¸€äº›é”™è¯¯ä¿¡æ¯ä¸­ä¸åŒ…å«çš„ä¿¡æ¯ã€‚\n2. é‡è¯•å¤±è´¥çš„æ“ä½œ å¦‚æœé”™è¯¯çš„å‘ç”Ÿæ˜¯å¶ç„¶çš„ï¼Œæˆ–ç”±ä¸å¯é¢„çŸ¥çš„é—®é¢˜å¯¼è‡´çš„ã€‚æ­¤æ—¶å¯é‡æ–°å°è¯•å¤±è´¥çš„æ“ä½œï¼Œä½†æ˜¯åœ¨é‡è¯•æ—¶ï¼Œè¦é™åˆ¶é‡è¯•çš„æ—¶é—´é—´éš”æˆ–é‡è¯•çš„æ—¶é—´æ¬¡æ•°ï¼Œé˜²æ­¢æ— é™åˆ¶çš„é‡è¯•ã€‚\nfunc WaitForServer(url string) error { const timeout = 1 * time.Minute deadline := time.Now().Add(timeout) for tries := 0; time.Now().Before(deadline); tries++ { _, err := http.Head(url) if err == nil { return nil // success  } log.Printf(\u0026#34;server not responding (%s);retryingâ€¦\u0026#34;, err) time.Sleep(time.Second \u0026lt;\u0026lt; uint(tries)) // exponential back-off  } return fmt.Errorf(\u0026#34;server %s failed to respond after %s\u0026#34;, url, timeout) } 3. è¾“å‡ºé”™è¯¯ä¿¡æ¯å¹¶ç»“æŸç¨‹åº è¿™ç§ç­–ç•¥åº”åªåœ¨mainä¸­ä½¿ç”¨ï¼Œå¯¹äºåº“å‡½æ•°è€Œè¨€ï¼Œåº”ä»…å‘ä¸Šä¼ æ’­é”™è¯¯ï¼Œé™¤éè¯¥é”™è¯¯æ„å‘³ç€ç¨‹åºå†…éƒ¨åŒ…å«ä¸ä¸€è‡´æ€§ï¼Œå³é‡åˆ°äº†bugï¼Œæ‰èƒ½åœ¨åº“å‡½æ•°ä¸­ç»“æŸç¨‹åº\n// (In function main.) if err := WaitForServer(url); err != nil { fmt.Fprintf(os.Stderr, \u0026#34;Site is down: %v\\n\u0026#34;, err) os.Exit(1) } 4. åªè¾“å‡ºé”™è¯¯ä¿¡æ¯ åªè¾“å‡ºé”™è¯¯ä¿¡æ¯ï¼Œä¸éœ€è¦ä¸­æ–­å‡½æ•°çš„æ‰§è¡Œ\nif err := Ping(); err != nil { log.Printf(\u0026#34;ping failed: %v; networking disabled\u0026#34;,err) } 5. ç›´æ¥å¿½ç•¥é”™è¯¯ dir, err := ioutil.TempDir(\u0026#34;\u0026#34;, \u0026#34;scratch\u0026#34;) if err != nil { return fmt.Errorf(\u0026#34;failed to create temp dir: %v\u0026#34;,err) } // ...use temp dirâ€¦ os.RemoveAll(dir) // ignore errors; $TMPDIR is cleaned periodically ","permalink":"http://yangchnet.github.io/Dessert/posts/golang/%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E7%AD%96%E7%95%A5/","summary":"0. é”™è¯¯å¤„ç†çš„ç¼–ç é£æ ¼ æ£€æŸ¥æŸä¸ªå­å‡½æ•°æ˜¯å¦å¤±è´¥åï¼Œæˆ‘ä»¬é€šå¸¸å°†å¤„ç†å¤±è´¥çš„é€»è¾‘ä»£ç æ”¾åœ¨å¤„ç†æˆåŠŸçš„ä»£ç ä¹‹å‰ã€‚å¦‚æœæŸä¸ªé”™è¯¯ä¼šå¯¼è‡´å‡½æ•°è¿”å›ï¼Œé‚£ä¹ˆæˆåŠŸçš„é€»è¾‘ä»£ç ä¸åº”è¯¥æ”¾åœ¨elseä¸­ï¼Œè€Œåº”ç›´æ¥æ”¾åœ¨å‡½æ•°ä½“ä¸­ã€‚\n1. é”™è¯¯ä¼ æ’­ å‡½æ•°æŸä¸ªå­ç¨‹åºçš„å¤±è´¥ï¼Œä¼šå˜æˆè¯¥å‡½æ•°çš„å¤±è´¥\nresp, err := http.Get(url) if err != nil{ return nill, err } æˆ–æ˜¯æ„é€ æ–°çš„é”™è¯¯ä¿¡æ¯è¿”å›ç»™è°ƒç”¨è€…\ndoc, err := html.Parse(resp.Body) resp.Body.Close() if err != nil { return nil, fmt.Errorf(\u0026#34;parsing %s as HTML: %v\u0026#34;, url,err) } ä¸€èˆ¬è€Œè¨€ï¼Œè¢«è°ƒå‡½æ•°f(x)ä¼šå°†è°ƒç”¨ä¿¡æ¯å’Œå‚æ•°ä¿¡æ¯ä½œä¸ºå‘ç”Ÿé”™è¯¯æ—¶çš„ä¸Šä¸‹æ–‡æ”¾åœ¨é”™è¯¯ä¿¡æ¯ä¸­å¹¶è¿”å›ç»™è°ƒç”¨è€…ï¼Œè°ƒç”¨è€…éœ€è¦æ·»åŠ ä¸€äº›é”™è¯¯ä¿¡æ¯ä¸­ä¸åŒ…å«çš„ä¿¡æ¯ã€‚\n2. é‡è¯•å¤±è´¥çš„æ“ä½œ å¦‚æœé”™è¯¯çš„å‘ç”Ÿæ˜¯å¶ç„¶çš„ï¼Œæˆ–ç”±ä¸å¯é¢„çŸ¥çš„é—®é¢˜å¯¼è‡´çš„ã€‚æ­¤æ—¶å¯é‡æ–°å°è¯•å¤±è´¥çš„æ“ä½œï¼Œä½†æ˜¯åœ¨é‡è¯•æ—¶ï¼Œè¦é™åˆ¶é‡è¯•çš„æ—¶é—´é—´éš”æˆ–é‡è¯•çš„æ—¶é—´æ¬¡æ•°ï¼Œé˜²æ­¢æ— é™åˆ¶çš„é‡è¯•ã€‚\nfunc WaitForServer(url string) error { const timeout = 1 * time.Minute deadline := time.Now().Add(timeout) for tries := 0; time.Now().Before(deadline); tries++ { _, err := http.Head(url) if err == nil { return nil // success  } log.","title":"Goè¯­è¨€ä¸­çš„é”™è¯¯å¤„ç†ç­–ç•¥"},{"content":"HINT: Add or change a related_name è§£å†³æ–¹æ¡ˆï¼š\néœ€è¦åœ¨settingä¸­é‡è½½AUTH_USER_MODEL\nAUTH_USER_MODEL = \u0026lsquo;users.UserProfile\u0026rsquo;\nusersï¼šä½ çš„app\nUserProfileï¼šmodel\n","permalink":"http://yangchnet.github.io/Dessert/posts/django/hint-add-or-change-a-relatedname/","summary":"HINT: Add or change a related_name è§£å†³æ–¹æ¡ˆï¼š\néœ€è¦åœ¨settingä¸­é‡è½½AUTH_USER_MODEL\nAUTH_USER_MODEL = \u0026lsquo;users.UserProfile\u0026rsquo;\nusersï¼šä½ çš„app\nUserProfileï¼šmodel","title":"HINT : Add or change are lated_name"},{"content":"http/template ä»€ä¹ˆæ˜¯æ¨¡æ¿ æ¨¡æ¿æ˜¯ä¸€ç§å¸¸è§çš„è§†å›¾ï¼Œé€šè¿‡å®ƒæˆ‘ä»¬å¯ä»¥ä¼ é€’æ•°æ®ä»¥ä½¿è¯¥è§†å›¾æœ‰æ„ä¹‰ã€‚å¯ä»¥ä»¥ä»»ä½•æ–¹å¼å¯¹å…¶è¿›è¡Œè‡ªå®šä¹‰ä»¥è·å–ä»»ä½•å¯èƒ½çš„è¾“å‡ºã€‚\næ¨¡æ¿åŒ… Goä¸­çš„æ¨¡æ¿é™„å¸¦ä¸¤ä¸ªåŒ…text/templateå’Œhtml/templateã€‚æ–‡æœ¬åŒ…å…è®¸æˆ‘ä»¬ä½¿ç”¨æ¨¡æ¿æ’å…¥æ–‡æœ¬ï¼Œè€ŒHTMLæ¨¡æ¿é€šè¿‡æä¾›å®‰å…¨çš„HTMLä»£ç æ¥å¸®åŠ©æˆ‘ä»¬ã€‚\nPart of template 1. æ¨¡æ¿åŠ¨ä½œ æ¨¡æ¿åŠ¨ä½œæ˜¯ä¸»è¦çš„æ§åˆ¶æµç¨‹ï¼Œæ•°æ®è¯„ä¼°åŠŸèƒ½ã€‚è¿™äº›åŠ¨ä½œæ§åˆ¶æœ€ç»ˆè¾“å‡ºå°†å¦‚ä½•æ˜¾ç¤º\n{{ /* a comment isside template */ }} 2. æ§åˆ¶ç»“æ„ æ§åˆ¶ç»“æ„ç¡®å®šæ¨¡æ¿çš„æ§åˆ¶æµç¨‹ï¼Œæœ‰åŠ©äºäº§ç”Ÿç»“æ„åŒ–çš„è¾“å‡ºï¼Œä»¥ä¸‹æ˜¯æ¨¡æ¿ä¸­çš„ä¸€äº›æ§åˆ¶ç»“æ„ ifè¯­å¥\n{{ if .condition }} {{ else }} {{ end }} å¾ªç¯å—\n{{ range .Items }} {{ end }} 3. åŠŸèƒ½ å‡½æ•°ä¹Ÿå¯ä»¥åœ¨æ¨¡æ¿å†…éƒ¨ä½¿ç”¨ï¼Œå¯ä»¥ä½¿ç”¨ç®¡é“ç¬¦|æ¥ä½¿ç”¨é¢„å®šä¹‰çš„å‡½æ•°\n å¦‚ä½•é¢„å®šä¹‰å‡½æ•°\n ä¸‹é¢çš„ä»£ç åˆ›å»ºå¹¶åˆ†æä¸Šé¢å®šä¹‰çš„æ¨¡æ¿templã€‚æ³¨æ„æ–¹æ³•è°ƒç”¨é“¾çš„é¡ºåº:template.Newå…ˆåˆ›å»ºå¹¶è¿”å›ä¸€ä¸ªæ¨¡æ¿;Funcsæ–¹æ³•å°†daysAgoç­‰è‡ªå®šä¹‰å‡½æ•°æ³¨å†Œåˆ°æ¨¡æ¿ä¸­,å¹¶è¿”å›æ¨¡æ¿;æœ€åè°ƒç”¨Parseå‡½æ•°åˆ†ææ¨¡æ¿ã€‚\nreport, err := template.New(\u0026#34;report\u0026#34;).Funcs(template.FuncMap{\u0026#34;daysAgo\u0026#34;: daysAgo}).Parse(templ) if err != nil { log.Fatal(err) } åœ¨Goä¸­è§£ææ¨¡æ¿ ç°åœ¨ï¼Œæˆ‘ä»¬æ¥è§£æä¸€äº›æ–‡æœ¬å’ŒHTMLæ¨¡æ¿\n1. è®¿é—®æ•°æ® è¦è®¿é—®ä¼ é€’çš„æ•°æ®ï¼Œä½¿ç”¨ç‚¹.ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n{{ .data }} 2. è§£ææ–‡æœ¬æ¨¡æ¿ ç°åœ¨ï¼Œæ¥è§£æä¸€ä¸ªæ–‡æœ¬æ¨¡æ¿\npackage main import ( \u0026#34;os\u0026#34; \u0026#34;text/template\u0026#34; ) type User struct { Name string Bio string } func main() { u := User{\u0026#34;John\u0026#34;, \u0026#34;a regular user\u0026#34;} ut, err := template.New(\u0026#34;users\u0026#34;).Parse(\u0026#34;The user is {{ .Name }} and he is {{ .Bio }}.\u0026#34;) if err != nil { panic(err) } err = ut.Execute(os.Stdout, u) if err != nil { panic(err) } } å…¶è¾“å‡ºå¦‚å›¾æ‰€ç¤ºï¼š\n3. è§£æHTMLæ¨¡æ¿  hello.html\n \u0026lt;h1\u0026gt;Go templates\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;The user is {{ .Name }}\u0026lt;/p\u0026gt; \u0026lt;h2\u0026gt;Skills:\u0026lt;/h2\u0026gt; {{ range .Skills }} \u0026lt;p\u0026gt;{{ . }}\u0026lt;/p\u0026gt; {{ end }}  main.go\n package main import ( \u0026#34;os\u0026#34; \u0026#34;html/template\u0026#34; ) func main() { t, err := template.ParseFiles(\u0026#34;templates/hello.gohtml\u0026#34;) if err != nil { panic(err) } data := struct { Name string Skills []string }{ Name: \u0026#34;John Doe\u0026#34;, Skills: []string{ \u0026#34;C++\u0026#34;, \u0026#34;Java\u0026#34;, \u0026#34;Python\u0026#34;, }, } err = t.Execute(os.Stdout, data) if err != nil { panic(err) } } åˆ™ç»“æœï¼š Goä¸­çš„æ¨¡æ¿éªŒè¯ ä¸ºäº†éªŒè¯æ¨¡æ¿æ˜¯å¦æœ‰æ•ˆï¼Œæˆ‘ä»¬ä½¿ç”¨template.Must()å‡½æ•°ã€‚å®ƒæœ‰åŠ©äºåœ¨è§£æè¿‡ç¨‹ä¸­éªŒè¯æ¨¡æ¿ã€‚å› ä¸ºæ¨¡æ¿é€šå¸¸åœ¨ç¼–è¯‘æ—¶å°±æµ‹è¯•å¥½äº†,å¦‚æœæ¨¡æ¿è§£æå¤±è´¥å°†æ˜¯ä¸€ä¸ªè‡´å‘½çš„é”™è¯¯template.Must è¾…åŠ©å‡½æ•°å¯ä»¥ç®€åŒ–è¿™ä¸ªè‡´å‘½é”™è¯¯çš„å¤„ç†:å®ƒæ¥å—ä¸€ä¸ªæ¨¡æ¿å’Œä¸€ä¸ªerrorç±»å‹çš„å‚æ•°,æ£€æµ‹erroræ˜¯å¦ä¸ºnil(å¦‚æœä¸æ˜¯nilåˆ™å‘å‡ºpanicå¼‚å¸¸),ç„¶åè¿”å›ä¼ å…¥çš„æ¨¡æ¿\nvar report = template.Must(template.New(\u0026#34;issuelist\u0026#34;). Funcs(template.FuncMap{\u0026#34;daysAgo\u0026#34;: daysAgo}). Parse(templ)) func main() { result, err := github.SearchIssues(os.Args[1:]) if err != nil { log.Fatal(err) } if err := report.Execute(os.Stdout, result); err != nil { log.Fatal(err) } } ","permalink":"http://yangchnet.github.io/Dessert/posts/golang/template/","summary":"http/template ä»€ä¹ˆæ˜¯æ¨¡æ¿ æ¨¡æ¿æ˜¯ä¸€ç§å¸¸è§çš„è§†å›¾ï¼Œé€šè¿‡å®ƒæˆ‘ä»¬å¯ä»¥ä¼ é€’æ•°æ®ä»¥ä½¿è¯¥è§†å›¾æœ‰æ„ä¹‰ã€‚å¯ä»¥ä»¥ä»»ä½•æ–¹å¼å¯¹å…¶è¿›è¡Œè‡ªå®šä¹‰ä»¥è·å–ä»»ä½•å¯èƒ½çš„è¾“å‡ºã€‚\næ¨¡æ¿åŒ… Goä¸­çš„æ¨¡æ¿é™„å¸¦ä¸¤ä¸ªåŒ…text/templateå’Œhtml/templateã€‚æ–‡æœ¬åŒ…å…è®¸æˆ‘ä»¬ä½¿ç”¨æ¨¡æ¿æ’å…¥æ–‡æœ¬ï¼Œè€ŒHTMLæ¨¡æ¿é€šè¿‡æä¾›å®‰å…¨çš„HTMLä»£ç æ¥å¸®åŠ©æˆ‘ä»¬ã€‚\nPart of template 1. æ¨¡æ¿åŠ¨ä½œ æ¨¡æ¿åŠ¨ä½œæ˜¯ä¸»è¦çš„æ§åˆ¶æµç¨‹ï¼Œæ•°æ®è¯„ä¼°åŠŸèƒ½ã€‚è¿™äº›åŠ¨ä½œæ§åˆ¶æœ€ç»ˆè¾“å‡ºå°†å¦‚ä½•æ˜¾ç¤º\n{{ /* a comment isside template */ }} 2. æ§åˆ¶ç»“æ„ æ§åˆ¶ç»“æ„ç¡®å®šæ¨¡æ¿çš„æ§åˆ¶æµç¨‹ï¼Œæœ‰åŠ©äºäº§ç”Ÿç»“æ„åŒ–çš„è¾“å‡ºï¼Œä»¥ä¸‹æ˜¯æ¨¡æ¿ä¸­çš„ä¸€äº›æ§åˆ¶ç»“æ„ ifè¯­å¥\n{{ if .condition }} {{ else }} {{ end }} å¾ªç¯å—\n{{ range .Items }} {{ end }} 3. åŠŸèƒ½ å‡½æ•°ä¹Ÿå¯ä»¥åœ¨æ¨¡æ¿å†…éƒ¨ä½¿ç”¨ï¼Œå¯ä»¥ä½¿ç”¨ç®¡é“ç¬¦|æ¥ä½¿ç”¨é¢„å®šä¹‰çš„å‡½æ•°\n å¦‚ä½•é¢„å®šä¹‰å‡½æ•°\n ä¸‹é¢çš„ä»£ç åˆ›å»ºå¹¶åˆ†æä¸Šé¢å®šä¹‰çš„æ¨¡æ¿templã€‚æ³¨æ„æ–¹æ³•è°ƒç”¨é“¾çš„é¡ºåº:template.Newå…ˆåˆ›å»ºå¹¶è¿”å›ä¸€ä¸ªæ¨¡æ¿;Funcsæ–¹æ³•å°†daysAgoç­‰è‡ªå®šä¹‰å‡½æ•°æ³¨å†Œåˆ°æ¨¡æ¿ä¸­,å¹¶è¿”å›æ¨¡æ¿;æœ€åè°ƒç”¨Parseå‡½æ•°åˆ†ææ¨¡æ¿ã€‚\nreport, err := template.New(\u0026#34;report\u0026#34;).Funcs(template.FuncMap{\u0026#34;daysAgo\u0026#34;: daysAgo}).Parse(templ) if err != nil { log.Fatal(err) } åœ¨Goä¸­è§£ææ¨¡æ¿ ç°åœ¨ï¼Œæˆ‘ä»¬æ¥è§£æä¸€äº›æ–‡æœ¬å’ŒHTMLæ¨¡æ¿\n1. è®¿é—®æ•°æ® è¦è®¿é—®ä¼ é€’çš„æ•°æ®ï¼Œä½¿ç”¨ç‚¹.ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n{{ .data }} 2. è§£ææ–‡æœ¬æ¨¡æ¿ ç°åœ¨ï¼Œæ¥è§£æä¸€ä¸ªæ–‡æœ¬æ¨¡æ¿","title":"http/template"},{"content":"%matplotlib inline ======================================= Receiver Operating Characteristic (ROC) Example of Receiver Operating Characteristic (ROC) metric to evaluate classifier output quality.\nROC curves typically feature true positive rate on the Y axis, and false positive rate on the X axis. This means that the top left corner of the plot is the \u0026ldquo;ideal\u0026rdquo; point - a false positive rate of zero, and a true positive rate of one. This is not very realistic, but it does mean that a larger area under the curve (AUC) is usually better.\nThe \u0026ldquo;steepness\u0026rdquo; of ROC curves is also important, since it is ideal to maximize the true positive rate while minimizing the false positive rate.\nMulticlass settings ROC curves are typically used in binary classification to study the output of a classifier. In order to extend ROC curve and ROC area to multi-class or multi-label classification, it is necessary to binarize the output. One ROC curve can be drawn per label, but one can also draw a ROC curve by considering each element of the label indicator matrix as a binary prediction (micro-averaging).\nAnother evaluation measure for multi-class classification is macro-averaging, which gives equal weight to the classification of each label.\nprint(__doc__) import numpy as np import matplotlib.pyplot as plt from itertools import cycle from sklearn import svm, datasets from sklearn.metrics import roc_curve, auc from sklearn.model_selection import train_test_split from sklearn.preprocessing import label_binarize from sklearn.multiclass import OneVsRestClassifier from scipy import interp # Import some data to play with iris = datasets.load_iris() X = iris.data y = iris.target # Binarize the output y = label_binarize(y, classes=[0, 1, 2]) n_classes = y.shape[1] # Add noisy features to make the problem harder random_state = np.random.RandomState(0) n_samples, n_features = X.shape X = np.c_[X, random_state.randn(n_samples, 200 * n_features)] # shuffle and split training and test sets X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=.5, random_state=0) # Learn to predict each class against the other classifier = OneVsRestClassifier(svm.SVC(kernel=\u0026#39;linear\u0026#39;, probability=True, random_state=random_state)) y_score = classifier.fit(X_train, y_train).decision_function(X_test) # print(\u0026#39;y_score\u0026#39;) # print(y_score) # Compute ROC curve and ROC area for each class fpr = dict() tpr = dict() roc_auc = dict() for i in range(n_classes): fpr[i], tpr[i], _ = roc_curve(y_test[:, i], y_score[:, i]) # print(fpr[i]) # print(tpr[i]) roc_auc[i] = auc(fpr[i], tpr[i]) # # Compute micro-average ROC curve and ROC area # fpr[\u0026#34;micro\u0026#34;], tpr[\u0026#34;micro\u0026#34;], _ = roc_curve(y_test.ravel(), y_score.ravel()) # roc_auc[\u0026#34;micro\u0026#34;] = auc(fpr[\u0026#34;micro\u0026#34;], tpr[\u0026#34;micro\u0026#34;]) # # print(roc_auc) Automatically created module for IPython interactive environment [0. 0. 0. 0.01851852 0.01851852 0.03703704 0.03703704 0.05555556 0.05555556 0.07407407 0.07407407 0.09259259 0.09259259 0.12962963 0.12962963 0.14814815 0.14814815 0.2037037 0.2037037 0.27777778 0.27777778 1. ] [0. 0.04761905 0.14285714 0.14285714 0.19047619 0.19047619 0.33333333 0.33333333 0.38095238 0.38095238 0.61904762 0.61904762 0.66666667 0.66666667 0.76190476 0.76190476 0.9047619 0.9047619 0.95238095 0.95238095 1. 1. ] [0. 0. 0. 0.02222222 0.02222222 0.11111111 0.11111111 0.17777778 0.17777778 0.2 0.2 0.24444444 0.24444444 0.26666667 0.26666667 0.37777778 0.37777778 0.42222222 0.42222222 0.48888889 0.48888889 0.55555556 0.55555556 0.62222222 0.62222222 0.64444444 0.64444444 0.66666667 0.66666667 0.73333333 0.73333333 0.75555556 0.75555556 0.88888889 0.88888889 1. ] [0. 0.03333333 0.13333333 0.13333333 0.16666667 0.16666667 0.2 0.2 0.26666667 0.26666667 0.33333333 0.33333333 0.4 0.4 0.43333333 0.43333333 0.5 0.5 0.56666667 0.56666667 0.6 0.6 0.63333333 0.63333333 0.7 0.7 0.73333333 0.73333333 0.9 0.9 0.93333333 0.93333333 0.96666667 0.96666667 1. 1. ] [0. 0. 0. 0.01960784 0.01960784 0.07843137 0.07843137 0.09803922 0.09803922 0.11764706 0.11764706 0.1372549 0.1372549 0.15686275 0.15686275 0.17647059 0.17647059 0.31372549 0.31372549 0.33333333 0.33333333 0.35294118 0.35294118 0.41176471 0.41176471 0.45098039 0.45098039 0.47058824 0.47058824 0.50980392 0.50980392 0.56862745 0.56862745 1. ] [0. 0.04166667 0.125 0.125 0.25 0.25 0.29166667 0.29166667 0.33333333 0.33333333 0.41666667 0.41666667 0.5 0.5 0.54166667 0.54166667 0.58333333 0.58333333 0.70833333 0.70833333 0.75 0.75 0.79166667 0.79166667 0.83333333 0.83333333 0.875 0.875 0.91666667 0.91666667 0.95833333 0.95833333 1. 1. ]  Plot of a ROC curve for a specific class\nplt.figure() lw = 2 plt.plot(fpr[2], tpr[2], color=\u0026#39;darkorange\u0026#39;, lw=lw, label=\u0026#39;ROC curve (area = %0.2f)\u0026#39; % roc_auc[2]) plt.plot([0, 1], [0, 1], color=\u0026#39;navy\u0026#39;, lw=lw, linestyle=\u0026#39;--\u0026#39;) plt.xlim([0.0, 1.0]) plt.ylim([0.0, 1.05]) plt.xlabel(\u0026#39;False Positive Rate\u0026#39;) plt.ylabel(\u0026#39;True Positive Rate\u0026#39;) plt.title(\u0026#39;Receiver operating characteristic example\u0026#39;) plt.legend(loc=\u0026#34;lower right\u0026#34;) plt.show() Plot ROC curves for the multiclass problem\n# Compute macro-average ROC curve and ROC area # First aggregate all false positive rates all_fpr = np.unique(np.concatenate([fpr[i] for i in range(n_classes)])) # Then interpolate all ROC curves at this points mean_tpr = np.zeros_like(all_fpr) for i in range(n_classes): mean_tpr += interp(all_fpr, fpr[i], tpr[i]) # Finally average it and compute AUC mean_tpr /= n_classes fpr[\u0026#34;macro\u0026#34;] = all_fpr tpr[\u0026#34;macro\u0026#34;] = mean_tpr roc_auc[\u0026#34;macro\u0026#34;] = auc(fpr[\u0026#34;macro\u0026#34;], tpr[\u0026#34;macro\u0026#34;]) # Plot all ROC curves plt.figure() plt.plot(fpr[\u0026#34;micro\u0026#34;], tpr[\u0026#34;micro\u0026#34;], label=\u0026#39;micro-average ROC curve (area = {0:0.2f})\u0026#39; \u0026#39;\u0026#39;.format(roc_auc[\u0026#34;micro\u0026#34;]), color=\u0026#39;deeppink\u0026#39;, linestyle=\u0026#39;:\u0026#39;, linewidth=4) plt.plot(fpr[\u0026#34;macro\u0026#34;], tpr[\u0026#34;macro\u0026#34;], label=\u0026#39;macro-average ROC curve (area = {0:0.2f})\u0026#39; \u0026#39;\u0026#39;.format(roc_auc[\u0026#34;macro\u0026#34;]), color=\u0026#39;navy\u0026#39;, linestyle=\u0026#39;:\u0026#39;, linewidth=4) colors = cycle([\u0026#39;aqua\u0026#39;, \u0026#39;darkorange\u0026#39;, \u0026#39;cornflowerblue\u0026#39;]) for i, color in zip(range(n_classes), colors): plt.plot(fpr[i], tpr[i], color=color, lw=lw, label=\u0026#39;ROC curve of class {0} (area = {1:0.2f})\u0026#39; \u0026#39;\u0026#39;.format(i, roc_auc[i])) plt.plot([0, 1], [0, 1], \u0026#39;k--\u0026#39;, lw=lw) plt.xlim([0.0, 1.0]) plt.ylim([0.0, 1.05]) plt.xlabel(\u0026#39;False Positive Rate\u0026#39;) plt.ylabel(\u0026#39;True Positive Rate\u0026#39;) plt.title(\u0026#39;Some extension of Receiver operating characteristic to multi-class\u0026#39;) plt.legend(loc=\u0026#34;lower right\u0026#34;) plt.show() ","permalink":"http://yangchnet.github.io/Dessert/posts/dlml/plot_roc/","summary":"%matplotlib inline ======================================= Receiver Operating Characteristic (ROC) Example of Receiver Operating Characteristic (ROC) metric to evaluate classifier output quality.\nROC curves typically feature true positive rate on the Y axis, and false positive rate on the X axis. This means that the top left corner of the plot is the \u0026ldquo;ideal\u0026rdquo; point - a false positive rate of zero, and a true positive rate of one. This is not very realistic, but it does mean that a larger area under the curve (AUC) is usually better.","title":"Importsomedatatoplaywith"},{"content":"Keraså‡½æ•°å¼API ä½¿ç”¨å‡½æ•°å¼APIï¼Œä½ å¯ä»¥ç›´æ¥æ“ä½œå¼ é‡ï¼Œä¹Ÿå¯ä»¥æŠŠå±‚å½“åšå‡½æ•°æ¥ä½¿ç”¨ï¼Œæ¥æ”¶å¼ é‡å¹¶è¿”å›å¼ é‡ã€‚\n# ç®€å•çš„å®ä¾‹ import os # **** change the warning level **** os.environ[\u0026#39;TF_CPP_MIN_LOG_LEVEL\u0026#39;] = \u0026#39;3\u0026#39; from keras.models import Sequential, Model from keras import layers from keras import Input # ä½¿ç”¨Sequentialæ¨¡å‹ seq_model = Sequential() seq_model.add(layers.Dense(32, activation=\u0026#39;relu\u0026#39;, input_shape=(64,))) seq_model.add(layers.Dense(32, activation=\u0026#39;relu\u0026#39;)) seq_model.add(layers.Dense(10, activation=\u0026#39;softmax\u0026#39;)) # å¯¹åº”çš„å‡½æ•°å¼APIå®ç° input_tensor = Input(shape=(64,)) x = layers.Dense(32, activation=\u0026#39;relu\u0026#39;)(input_tensor) x = layers.Dense(32, activation=\u0026#39;softmax\u0026#39;)(x) output_tensor = layers.Dense(10, activation=\u0026#39;softmax\u0026#39;)(x) model = Model(input_tensor, output_tensor) model.summary() Model: \u0026quot;model_2\u0026quot; _________________________________________________________________ Layer (type) Output Shape Param # ================================================================= input_2 (InputLayer) (None, 64) 0 _________________________________________________________________ dense_10 (Dense) (None, 32) 2080 _________________________________________________________________ dense_11 (Dense) (None, 32) 1056 _________________________________________________________________ dense_12 (Dense) (None, 10) 330 ================================================================= Total params: 3,466 Trainable params: 3,466 Non-trainable params: 0 _________________________________________________________________  Kerasä¼šåœ¨åå°æ£€ç´¢ä»input_tensoråˆ°output_tensoræ‰€åŒ…å«çš„æ¯ä¸€å±‚ï¼Œå¹¶å°†è¿™äº›å±‚ç»„åˆæˆä¸€ä¸ªç±»å›¾çš„æ•°æ®ç»“æ„ï¼Œå³ä¸€ä¸ªModelã€‚è¿™ç§æ–¹æ³•æœ‰æ•ˆçš„åŸå› åœ¨äºï¼Œoutput_tensoræ˜¯é€šè¿‡å¯¹input_tensorè¿›è¡Œå¤šæ¬¡å˜æ¢å¾—åˆ°çš„ã€‚å¦‚æœä½ è¯•å›¾åˆ©ç”¨ä¸ç›¸å…³çš„è¾“å…¥å’Œè¾“å‡ºæ¥æ„å»ºä¸€ä¸ªæ¨¡å‹ï¼Œé‚£ä¹ˆä¼šå¾—åˆ°RuntimeError\nunrelated_input = Input(shape=(32,)) bad_model = model = Model(unrelated_input, output_tensor) --------------------------------------------------------------------------- ValueError Traceback (most recent call last) \u0026lt;ipython-input-3-54197a8d0ec3\u0026gt; in \u0026lt;module\u0026gt; 1 unrelated_input = Input(shape=(32,)) ----\u0026gt; 2 bad_model = model = Model(unrelated_input, output_tensor) /usr/lib/python3.7/site-packages/keras/legacy/interfaces.py in wrapper(*args, **kwargs) 89 warnings.warn('Update your `' + object_name + '` call to the ' + 90 'Keras 2 API: ' + signature, stacklevel=2) ---\u0026gt; 91 return func(*args, **kwargs) 92 wrapper._original_function = func 93 return wrapper /usr/lib/python3.7/site-packages/keras/engine/network.py in __init__(self, *args, **kwargs) 92 'inputs' in kwargs and 'outputs' in kwargs): 93 # Graph network ---\u0026gt; 94 self._init_graph_network(*args, **kwargs) 95 else: 96 # Subclassed network /usr/lib/python3.7/site-packages/keras/engine/network.py in _init_graph_network(self, inputs, outputs, name, **kwargs) 239 # Keep track of the network's nodes and layers. 240 nodes, nodes_by_depth, layers, layers_by_depth = _map_graph_network( --\u0026gt; 241 self.inputs, self.outputs) 242 self._network_nodes = nodes 243 self._nodes_by_depth = nodes_by_depth /usr/lib/python3.7/site-packages/keras/engine/network.py in _map_graph_network(inputs, outputs) 1509 'The following previous layers ' 1510 'were accessed without issue: ' + -\u0026gt; 1511 str(layers_with_complete_input)) 1512 for x in node.output_tensors: 1513 computable_tensors.append(x) ValueError: Graph disconnected: cannot obtain value for tensor Tensor(\u0026quot;input_2:0\u0026quot;, shape=(None, 64), dtype=float32) at layer \u0026quot;input_2\u0026quot;. The following previous layers were accessed without issue: []  å¯¹è¿™ç§Modelå®ä¾‹è¿›è¡Œç¼–è¯‘ã€è®­ç»ƒæˆ–è¯„ä¼°æ—¶ï¼Œå…¶APIä¸Sequentialæ¨¡å‹ç›¸åŒ\nmodel.compile(optimizer=\u0026#39;rmsprop\u0026#39;, loss=\u0026#39;categorical_crossentropy\u0026#39;) import numpy as np x_train = np.random.random((1000, 64)) y_train = np.random.random((1000, 10)) model.fit(x_train, y_train, epochs=10, batch_size=128) score = model.evaluate(x_train, y_train) Epoch 1/10 1000/1000 [==============================] - 0s 83us/step - loss: 11.6211 Epoch 2/10 1000/1000 [==============================] - 0s 33us/step - loss: 11.6215 Epoch 3/10 1000/1000 [==============================] - 0s 32us/step - loss: 11.6216 Epoch 4/10 1000/1000 [==============================] - 0s 27us/step - loss: 11.6216 Epoch 5/10 1000/1000 [==============================] - 0s 36us/step - loss: 11.6216 Epoch 6/10 1000/1000 [==============================] - 0s 37us/step - loss: 11.6217 Epoch 7/10 1000/1000 [==============================] - 0s 37us/step - loss: 11.6217 Epoch 8/10 1000/1000 [==============================] - 0s 25us/step - loss: 11.6217 Epoch 9/10 1000/1000 [==============================] - 0s 40us/step - loss: 11.6217 Epoch 10/10 1000/1000 [==============================] - 0s 34us/step - loss: 11.6216 1000/1000 [==============================] - 0s 69us/step  ","permalink":"http://yangchnet.github.io/Dessert/posts/dlml/keras%E5%87%BD%E6%95%B0%E5%BC%8Fapi/","summary":"Keraså‡½æ•°å¼API ä½¿ç”¨å‡½æ•°å¼APIï¼Œä½ å¯ä»¥ç›´æ¥æ“ä½œå¼ é‡ï¼Œä¹Ÿå¯ä»¥æŠŠå±‚å½“åšå‡½æ•°æ¥ä½¿ç”¨ï¼Œæ¥æ”¶å¼ é‡å¹¶è¿”å›å¼ é‡ã€‚\n# ç®€å•çš„å®ä¾‹ import os # **** change the warning level **** os.environ[\u0026#39;TF_CPP_MIN_LOG_LEVEL\u0026#39;] = \u0026#39;3\u0026#39; from keras.models import Sequential, Model from keras import layers from keras import Input # ä½¿ç”¨Sequentialæ¨¡å‹ seq_model = Sequential() seq_model.add(layers.Dense(32, activation=\u0026#39;relu\u0026#39;, input_shape=(64,))) seq_model.add(layers.Dense(32, activation=\u0026#39;relu\u0026#39;)) seq_model.add(layers.Dense(10, activation=\u0026#39;softmax\u0026#39;)) # å¯¹åº”çš„å‡½æ•°å¼APIå®ç° input_tensor = Input(shape=(64,)) x = layers.Dense(32, activation=\u0026#39;relu\u0026#39;)(input_tensor) x = layers.Dense(32, activation=\u0026#39;softmax\u0026#39;)(x) output_tensor = layers.Dense(10, activation=\u0026#39;softmax\u0026#39;)(x) model = Model(input_tensor, output_tensor) model.summary() Model: \u0026quot;model_2\u0026quot; _________________________________________________________________ Layer (type) Output Shape Param # ================================================================= input_2 (InputLayer) (None, 64) 0 _________________________________________________________________ dense_10 (Dense) (None, 32) 2080 _________________________________________________________________ dense_11 (Dense) (None, 32) 1056 _________________________________________________________________ dense_12 (Dense) (None, 10) 330 ================================================================= Total params: 3,466 Trainable params: 3,466 Non-trainable params: 0 _________________________________________________________________  Kerasä¼šåœ¨åå°æ£€ç´¢ä»input_tensoråˆ°output_tensoræ‰€åŒ…å«çš„æ¯ä¸€å±‚ï¼Œå¹¶å°†è¿™äº›å±‚ç»„åˆæˆä¸€ä¸ªç±»å›¾çš„æ•°æ®ç»“æ„ï¼Œå³ä¸€ä¸ªModelã€‚è¿™ç§æ–¹æ³•æœ‰æ•ˆçš„åŸå› åœ¨äºï¼Œoutput_tensoræ˜¯é€šè¿‡å¯¹input_tensorè¿›è¡Œå¤šæ¬¡å˜æ¢å¾—åˆ°çš„ã€‚å¦‚æœä½ è¯•å›¾åˆ©ç”¨ä¸ç›¸å…³çš„è¾“å…¥å’Œè¾“å‡ºæ¥æ„å»ºä¸€ä¸ªæ¨¡å‹ï¼Œé‚£ä¹ˆä¼šå¾—åˆ°RuntimeError","title":"Keraså‡½æ•°å¼API"},{"content":"Linuxä¸‹çš„æƒé™ç®¡ç† Linux ç³»ç»Ÿä¸­ä¸ºä»€ä¹ˆéœ€è¦è®¾å®šä¸åŒçš„æƒé™ï¼Œæ‰€æœ‰ç”¨æˆ·éƒ½ç›´æ¥ä½¿ç”¨ç®¡ç†å‘˜ï¼ˆrootï¼‰èº«ä»½ä¸å¥½å—ï¼Ÿ\n ç”±äºç»å¤§å¤šæ•°ç”¨æˆ·ä½¿ç”¨çš„æ˜¯ä¸ªäººè®¡ç®—æœºï¼Œä½¿ç”¨è€…ä¸€èˆ¬éƒ½æ˜¯è¢«ä¿¡ä»»çš„äººï¼ˆå¦‚å®¶äººã€æœ‹å‹ç­‰ï¼‰ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¤§å®¶éƒ½å¯ä»¥ä½¿ç”¨ç®¡ç†å‘˜èº«ä»½ç›´æ¥ç™»å½•ã€‚ä½†åœ¨æœåŠ¡å™¨ä¸Šå°±ä¸æ˜¯è¿™ç§æƒ…å†µäº†ï¼Œå¾€å¾€è¿è¡Œçš„æ•°æ®è¶Šé‡è¦ï¼ˆå¦‚æ¸¸æˆæ•°æ®ï¼‰ï¼Œä»·å€¼è¶Šé«˜ï¼ˆå¦‚ç”µå­å•†åŸæ•°æ®ã€é“¶è¡Œæ•°æ®ï¼‰ï¼Œåˆ™æœåŠ¡å™¨ä¸­å¯¹æƒé™çš„è®¾å®šå°±è¦è¶Šè¯¦ç»†ï¼Œç”¨æˆ·çš„åˆ†çº§ä¹Ÿè¦è¶Šæ˜ç¡®ã€‚\nå’Œ Windows ç³»ç»Ÿä¸åŒï¼ŒLinux ç³»ç»Ÿä¸ºæ¯ä¸ªæ–‡ä»¶éƒ½æ·»åŠ äº†å¾ˆå¤šçš„å±æ€§ï¼Œæœ€å¤§çš„ä½œç”¨å°±æ˜¯ç»´æŠ¤æ•°æ®çš„å®‰å…¨ã€‚ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œåœ¨ä½ çš„ Linux ç³»ç»Ÿä¸­ï¼Œå’Œç³»ç»ŸæœåŠ¡ç›¸å…³çš„æ–‡ä»¶é€šå¸¸åªæœ‰ root ç”¨æˆ·æ‰èƒ½è¯»æˆ–å†™ï¼Œå°±æ‹¿ /etc/shadow è¿™ä¸ªæ–‡ä»¶æ¥è¯´ï¼Œæ­¤æ–‡ä»¶è®°å½•äº†ç³»ç»Ÿä¸­æ‰€æœ‰ç”¨æˆ·çš„å¯†ç æ•°æ®ï¼Œéå¸¸é‡è¦ï¼Œå› æ­¤ç»ä¸èƒ½è®©ä»»ä½•äººè¯»å–ï¼ˆå¦åˆ™å¯†ç æ•°æ®ä¼šè¢«çªƒå–ï¼‰ï¼Œåªæœ‰ root æ‰å¯ä»¥æœ‰è¯»å–æƒé™ã€‚ æ­¤å¤–ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ªè½¯ä»¶å¼€å‘å›¢é˜Ÿï¼Œä½ å¸Œæœ›å›¢é˜Ÿä¸­çš„æ¯ä¸ªäººéƒ½å¯ä»¥ä½¿ç”¨æŸä¸€äº›ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œè€Œéå›¢é˜Ÿçš„å…¶ä»–äººåˆ™ä¸äºˆä»¥å¼€æ”¾ã€‚é€šè¿‡å‰é¢ç« èŠ‚çš„å­¦ä¹ æˆ‘ä»¬çŸ¥é“ï¼Œåªéœ€è¦å°†å›¢é˜Ÿä¸­çš„æ‰€æœ‰äººåŠ å…¥æ–°çš„ç¾¤ç»„ï¼Œå¹¶èµ‹äºˆæ­¤ç¾¤ç»„è¯»å†™ç›®å½•çš„æƒé™ï¼Œå³å¯å®ç°è¦æ±‚ã€‚åä¹‹ï¼Œå¦‚æœä½ çš„ç›®å½•æƒé™æ²¡æœ‰åšå¥½ï¼Œå°±å¾ˆéš¾é˜²æ­¢å…¶ä»–äººåœ¨ä½ çš„ç³»ç»Ÿä¸­ä¹±æã€‚ æ¯”å¦‚è¯´ï¼Œæœ¬æ¥ root ç”¨æˆ·æ‰èƒ½åšçš„å¼€å…³æœºã€ADSL æ‹¨æ¥ç¨‹åºï¼Œæ–°å¢æˆ–åˆ é™¤ç”¨æˆ·ç­‰å‘½ä»¤ï¼Œä¸€æ—¦å…è®¸ä»»ä½•äººæ‹¥æœ‰è¿™äº›æƒé™ï¼Œç³»ç»Ÿå¾ˆå¯èƒ½ä¼šç»å¸¸è«åå…¶å¦™çš„æŒ‚æ‰ã€‚è€Œä¸”ï¼Œä¸‡ä¸€ root ç”¨æˆ·çš„å¯†ç è¢«å…¶ä»–äººè·å–ï¼Œä»–ä»¬å°±å¯ä»¥ç™»å½•ä½ çš„ç³»ç»Ÿï¼Œä»äº‹ä¸€äº›åªæœ‰ root ç”¨æˆ·æ‰èƒ½æ‰§è¡Œçš„æ“ä½œï¼Œè¿™æ˜¯ç»å¯¹ä¸å…è®¸å‘ç”Ÿçš„ã€‚ å› æ­¤ï¼Œåœ¨æœåŠ¡å™¨ä¸Šï¼Œç»å¯¹ä¸æ˜¯æ‰€æœ‰çš„ç”¨æˆ·éƒ½ä½¿ç”¨ root èº«ä»½ç™»å½•ï¼Œè€Œè¦æ ¹æ®ä¸åŒçš„å·¥ä½œéœ€è¦å’ŒèŒä½éœ€è¦ï¼Œåˆç†åˆ†é…ç”¨æˆ·ç­‰çº§å’Œæƒé™ç­‰çº§ã€‚\n Linux ç³»ç»Ÿä¸­ï¼Œæ–‡ä»¶æˆ–ç›®å½•çš„æƒé™ä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨ ls å‘½ä»¤æŸ¥çœ‹ï¼Œä¾‹å¦‚ï¼š\n[root@localhost ~]# ls -al total 156 drwxr-x---. 4 root root 4096 Sep 8 14:06 . drwxr-xr-x. 23 root root 4096 Sep 8 14:21 .. -rw-------. 1 root root 1474 Sep 4 18:27 anaconda-ks.cfg -rw-------. 1 root root 199 Sep 8 17:14 .bash_history -rw-r--r--. 1 root root 24 Jan 6 2007 .bash_logout 1. Linux chgrpå‘½ä»¤ï¼šä¿®æ”¹æ–‡ä»¶å’Œç›®å½•çš„æ‰€å±ç»„ chgrp å‘½ä»¤ç”¨äºä¿®æ”¹æ–‡ä»¶ï¼ˆæˆ–ç›®å½•ï¼‰çš„æ‰€å±ç»„ã€‚ ä¸ºäº†æ–¹ä¾¿åˆå­¦è€…è®°å¿†ï¼Œå¯ä»¥å°† chgrp ç†è§£ä¸ºæ˜¯ \u0026ldquo;change group\u0026rdquo; çš„ç¼©å†™ã€‚\nchgrp å‘½ä»¤çš„ç”¨æ³•å¾ˆç®€å•ï¼Œå…¶åŸºæœ¬æ ¼å¼ä¸ºï¼š\n[root@localhost ~]# chgrp [-R] æ‰€å±ç»„ æ–‡ä»¶åï¼ˆç›®å½•åï¼‰ -Rï¼ˆæ³¨æ„æ˜¯å¤§å†™ï¼‰é€‰é¡¹é•¿ä½œç”¨äºæ›´æ”¹ç›®å½•çš„æ‰€å±ç»„ï¼Œè¡¨ç¤ºæ›´æ”¹è¿åŒå­ç›®å½•ä¸­æ‰€æœ‰æ–‡ä»¶çš„æ‰€å±ç»„ä¿¡æ¯ã€‚\nä½¿ç”¨æ­¤å‘½ä»¤éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œè¦è¢«æ”¹å˜çš„ç¾¤ç»„åå¿…é¡»æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œå¦åˆ™å‘½ä»¤æ— æ³•æ­£ç¡®æ‰§è¡Œï¼Œä¼šæç¤º \u0026ldquo;invaild group name\u0026rdquo;ã€‚\nä¸¾ä¸ªä¾‹å­ï¼Œå½“ä»¥ root èº«ä»½ç™»å½• Linux ç³»ç»Ÿæ—¶ï¼Œä¸»ç›®å½•ä¸­ä¼šå­˜åœ¨ä¸€ä¸ªåä¸º install.log çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹æ³•ä¿®æ”¹æ­¤æ–‡ä»¶çš„æ‰€å±ç»„ï¼š\n[root@localhost ~]# groupadd group1 #æ–°å»ºç”¨äºæµ‹è¯•çš„ç¾¤ç»„ group1 [root@localhost ~]# chgrp group1 install.log #ä¿®æ”¹install.logæ–‡ä»¶çš„æ‰€å±ç»„ä¸ºgroup1 [root@localhost ~]# ll install.log -rw-r--r--. 1 root group1 78495 Nov 17 05:54 install.log #ä¿®æ”¹ç”Ÿæ•ˆ [root@localhost ~]# chgrp testgroup install.log chgrp: invaild group name \u0026#39;testgroup\u0026#39; å¯ä»¥çœ‹åˆ°ï¼Œåœ¨å…·æœ‰ group1 ç¾¤ç»„çš„å‰æä¸‹ï¼Œæˆ‘ä»¬æˆåŠŸä¿®æ”¹äº† install.log æ–‡ä»¶çš„æ‰€å±ç»„ï¼Œä½†æˆ‘ä»¬å†æ¬¡è¯•å›¾å°†æ‰€å±ç»„ä¿®æ”¹ä¸º testgroup æ—¶ï¼Œå‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼Œå°±æ˜¯å› ä¸ºç³»ç»Ÿçš„ /etc/group æ–‡ä»¶ä¸­ï¼Œæ²¡æœ‰ testgroup ç¾¤ç»„ã€‚\n2. Linux chownå‘½ä»¤ï¼šä¿®æ”¹æ–‡ä»¶å’Œç›®å½•çš„æ‰€æœ‰è€…å’Œæ‰€å±ç»„ chown å‘½ä»¤ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯ \u0026ldquo;change owner\u0026rdquo; çš„ç¼©å†™ï¼Œä¸»è¦ç”¨äºä¿®æ”¹æ–‡ä»¶ï¼ˆæˆ–ç›®å½•ï¼‰çš„æ‰€æœ‰è€…ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œè¿™ä¸ªå‘½ä»¤ä¹Ÿå¯ä»¥ä¿®æ”¹æ–‡ä»¶ï¼ˆæˆ–ç›®å½•ï¼‰çš„æ‰€å±ç»„ã€‚\nå½“åªéœ€è¦ä¿®æ”¹æ‰€æœ‰è€…æ—¶ï¼Œå¯ä½¿ç”¨å¦‚ä¸‹ chown å‘½ä»¤çš„åŸºæœ¬æ ¼å¼ï¼š\n[root@localhost ~]# chown [-R] æ‰€æœ‰è€… æ–‡ä»¶æˆ–ç›®å½• -Rï¼ˆæ³¨æ„å¤§å†™ï¼‰é€‰é¡¹è¡¨ç¤ºè¿åŒå­ç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶ï¼Œéƒ½æ›´æ”¹æ‰€æœ‰è€…ã€‚\nå¦‚æœéœ€è¦åŒæ—¶æ›´æ”¹æ‰€æœ‰è€…å’Œæ‰€å±ç»„ï¼Œchown å‘½ä»¤çš„åŸºæœ¬æ ¼å¼ä¸ºï¼š\n[root@localhost ~]# chown [-R] æ‰€æœ‰è€…:æ‰€å±ç»„ æ–‡ä»¶æˆ–ç›®å½• æ³¨æ„ï¼Œåœ¨ chown å‘½ä»¤ä¸­ï¼Œæ‰€æœ‰è€…å’Œæ‰€å±ç»„ä¸­é—´ä¹Ÿå¯ä»¥ä½¿ç”¨ç‚¹ï¼ˆ.ï¼‰ï¼Œä½†ä¼šäº§ç”Ÿä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœç”¨æˆ·åœ¨è®¾å®šè´¦å·æ—¶åŠ å…¥äº†å°æ•°ç‚¹ï¼ˆä¾‹å¦‚ zhangsan.tempï¼‰ï¼Œå°±ä¼šé€ æˆç³»ç»Ÿè¯¯åˆ¤ã€‚å› æ­¤ï¼Œå»ºè®®å¤§å®¶ä½¿ç”¨å†’å·è¿æ¥æ‰€æœ‰è€…å’Œæ‰€å±ç»„ã€‚\nå½“ç„¶ï¼Œchown å‘½ä»¤ä¹Ÿæ”¯æŒå•çº¯çš„ä¿®æ”¹æ–‡ä»¶æˆ–ç›®å½•çš„æ‰€å±ç»„ï¼Œä¾‹å¦‚ chown :group install.log å°±è¡¨ç¤ºä¿®æ”¹ install.log æ–‡ä»¶çš„æ‰€å±ç»„ï¼Œä½†ä¿®æ”¹æ‰€å±ç»„é€šå¸¸ä½¿ç”¨ chgrp å‘½ä»¤ï¼Œå› æ­¤å¹¶ä¸æ¨èå¤§å®¶ä½¿ç”¨ chown å‘½ä»¤ã€‚\nå¦å¤–éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œä½¿ç”¨ chown å‘½ä»¤ä¿®æ”¹æ–‡ä»¶æˆ–ç›®å½•çš„æ‰€æœ‰è€…ï¼ˆæˆ–æ‰€å±è€…ï¼‰æ—¶ï¼Œè¦ä¿è¯ä½¿ç”¨è€…ç”¨æˆ·ï¼ˆæˆ–ç”¨æˆ·ç»„ï¼‰å­˜åœ¨ï¼Œå¦åˆ™è¯¥å‘½ä»¤æ— æ³•æ­£ç¡®æ‰§è¡Œï¼Œä¼šæç¤º \u0026ldquo;invalid user\u0026rdquo; æˆ–è€… \u0026ldquo;invaild group\u0026rdquo;ã€‚\nã€ä¾‹ 1ã€‘\nå…¶å®ï¼Œä¿®æ”¹æ–‡ä»¶çš„æ‰€æœ‰è€…ï¼Œæ›´å¤šæ—¶å€™æ˜¯ä¸ºäº†å¾—åˆ°æ›´é«˜çš„æƒé™ï¼Œä¸¾ä¸€ä¸ªå®ä¾‹ï¼š\n[root@localhost ~]# touch file #ç”±rootç”¨æˆ·åˆ›å»ºfileæ–‡ä»¶ [root@localhost ~]# ll file -rw-r--r--. 1 root root 0 Apr 17 05:12 file #æ–‡ä»¶çš„æ‰€æœ‰è€…æ˜¯rootï¼Œæ™®é€šç”¨æˆ·userå¯¹è¿™ä¸ªæ–‡ä»¶æ‹¥æœ‰åªè¯»æƒé™ [root@localhost ~]# chown user file #ä¿®æ”¹æ–‡ä»¶çš„æ‰€æœ‰è€… [root@localhost ~]# ll file -rw-r--r--. 1 user root 0 Apr 17 05:12 file #æ‰€æœ‰è€…å˜æˆäº†userç”¨æˆ·ï¼Œè¿™æ—¶userç”¨æˆ·å¯¹è¿™ä¸ªæ–‡ä»¶å°±æ‹¥æœ‰äº†è¯»ã€å†™æƒé™ å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡ä¿®æ”¹ file æ–‡ä»¶çš„æ‰€æœ‰è€…ï¼Œuser ç”¨æˆ·ä»å…¶ä»–äººèº«ä»½ï¼ˆåªå¯¹æ­¤æ–‡ä»¶æœ‰è¯»å–æƒé™ï¼‰è½¬å˜æˆäº†æ‰€æœ‰è€…èº«ä»½ï¼Œå¯¹æ­¤æ–‡ä»¶æ‹¥æœ‰è¯»å’Œå†™æƒé™ã€‚\nã€ä¾‹ 2ã€‘\nLinux ç³»ç»Ÿä¸­ï¼Œç”¨æˆ·ç­‰çº§æƒé™çš„åˆ’åˆ†æ˜¯éå¸¸æ¸…æ¥šçš„ï¼Œroot ç”¨æˆ·æ‹¥æœ‰æœ€é«˜æƒé™ï¼Œå¯ä»¥ä¿®æ”¹ä»»ä½•æ–‡ä»¶çš„æƒé™ï¼Œè€Œæ™®é€šç”¨æˆ·åªèƒ½ä¿®æ”¹è‡ªå·±æ–‡ä»¶çš„æƒé™ï¼ˆæ‰€æœ‰è€…æ˜¯è‡ªå·±çš„æ–‡ä»¶ï¼‰ï¼Œä¾‹å¦‚ï¼š\n[root@localhost ~]# cd /home/user #è¿›å…¥userç”¨æˆ·çš„ä¸»ç›®å½• [root@localhost user]# touch test #ç”±rootç”¨æˆ·æ–°å»ºæ–‡ä»¶test [root@localhost user]# ll test -rw-r--r--. 1 root root 0 Apr 17 05:37 test #æ–‡ä»¶æ‰€æœ‰è€…å’Œæ‰€å±ç»„éƒ½æ˜¯rootç”¨æˆ· [root@localhost user]# su - user #åˆ‡æ¢ä¸ºuserç”¨æˆ· [user@localhost ~]$ chmod 755 test chmod:æ›´æ”¹\u0026#34;test\u0026#34;çš„æƒé™ï¼šä¸å…è®¸çš„æ“ä½œ #userç”¨æˆ·ä¸èƒ½ä¿®æ”¹testæ–‡ä»¶çš„æƒé™ [user@localhost ~]$ exit #é€€å›åˆ°rootèº«ä»½ [root@localhost user]# chown user test #ç”±rootç”¨æˆ·æŠŠtestæ–‡ä»¶çš„æ‰€æœ‰è€…æ”¹ä¸ºuserç”¨æˆ· [root@localhost user]# su - user #åˆ‡æ¢ä¸ºuserç”¨æˆ· [user@localhost ~]$ chmod 755 test #userç”¨æˆ·ç”±äºæ˜¯testæ–‡ä»¶çš„æ‰€æœ‰è€…ï¼Œæ‰€ä»¥å¯ä»¥ä¿®æ”¹æ–‡ä»¶çš„æƒé™ [user@localhost ~]$ ll test -rwxr-xr-x. 1 user root 0 Apr 17 05:37 test #æŸ¥çœ‹æƒé™ å¯ä»¥çœ‹åˆ°ï¼Œuser ç”¨æˆ·æ— æƒæ›´æ”¹æ‰€æœ‰è€…ä¸º root ç”¨æˆ·æ–‡ä»¶çš„æƒé™ï¼Œåªæœ‰æ™®é€šç”¨æˆ·æ˜¯è¿™ä¸ªæ–‡ä»¶çš„æ‰€æœ‰è€…ï¼Œæ‰å¯ä»¥ä¿®æ”¹æ–‡ä»¶çš„æƒé™ã€‚\nã€ä¾‹ 3ã€‘\n[root@localhost ~]# chown user:group file [root@localhost ~]# ll file -rw-r--r--. 1 user group 0 Apr 17 05:12 file 3. Linuxæƒé™ä½ Linux ç³»ç»Ÿï¼Œæœ€å¸¸è§çš„æ–‡ä»¶æƒé™æœ‰ 3 ç§ï¼Œå³å¯¹æ–‡ä»¶çš„è¯»ï¼ˆç”¨ r è¡¨ç¤ºï¼‰ã€å†™ï¼ˆç”¨ w è¡¨ç¤ºï¼‰å’Œæ‰§è¡Œï¼ˆç”¨ x è¡¨ç¤ºï¼Œé’ˆå¯¹å¯æ‰§è¡Œæ–‡ä»¶æˆ–ç›®å½•ï¼‰æƒé™ã€‚åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªæ–‡ä»¶éƒ½æ˜ç¡®è§„å®šäº†ä¸åŒèº«ä»½ç”¨æˆ·çš„è®¿é—®æƒé™ï¼Œé€šè¿‡ ls å‘½ä»¤å³å¯çœ‹åˆ°ã€‚ é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬æœ‰æ—¶ä¼šçœ‹åˆ° sï¼ˆé’ˆå¯¹å¯æ‰§è¡Œæ–‡ä»¶æˆ–ç›®å½•ï¼Œä½¿æ–‡ä»¶åœ¨æ‰§è¡Œé˜¶æ®µï¼Œä¸´æ—¶æ‹¥æœ‰æ–‡ä»¶æ‰€æœ‰è€…çš„æƒé™ï¼‰å’Œ tï¼ˆé’ˆå¯¹ç›®å½•ï¼Œä»»ä½•ç”¨æˆ·éƒ½å¯ä»¥åœ¨æ­¤ç›®å½•ä¸­åˆ›å»ºæ–‡ä»¶ï¼Œä½†åªèƒ½åˆ é™¤è‡ªå·±çš„æ–‡ä»¶ï¼‰ï¼Œæ–‡ä»¶è®¾ç½® s å’Œ t æƒé™ï¼Œä¼šå ç”¨ x æƒé™çš„ä½ç½®ã€‚\nä¾‹å¦‚ï¼Œæˆ‘ä»¬ä»¥ root çš„èº«ä»½ç™»é™† Linuxï¼Œå¹¶æ‰§è¡Œå¦‚ä¸‹æŒ‡ä»¤ï¼š\n[root@localhost ~]# ls -al total 156 drwxr-x---. 4 root root 4096 Sep 8 14:06 . drwxr-xr-x. 23 root root 4096 Sep 8 14:21 .. -rw-------. 1 root root 1474 Sep 4 18:27 anaconda-ks.cfg -rw-------. 1 root root 199 Sep 8 17:14 .bash_history -rw-r--r--. 1 root root 24 Jan 6 2007 .bash_logout ... å¯ä»¥çœ‹åˆ°ï¼Œæ¯è¡Œçš„ç¬¬ä¸€åˆ—è¡¨ç¤ºçš„å°±æ˜¯å„æ–‡ä»¶é’ˆå¯¹ä¸åŒç”¨æˆ·è®¾å®šçš„æƒé™ï¼Œä¸€å…± 11 ä½ï¼Œä½†ç¬¬ 1 ä½ç”¨äºè¡¨ç¤ºæ–‡ä»¶çš„å…·ä½“ç±»å‹ï¼Œæœ€åä¸€ä½æ­¤æ–‡ä»¶å— SELinux çš„å®‰å…¨è§„åˆ™ç®¡ç†ï¼Œä¸æ˜¯æœ¬èŠ‚å…³å¿ƒçš„å†…å®¹ï¼Œæ”¾åˆ°åç»­ç« èŠ‚åšè¯¦ç»†ä»‹ç»ã€‚\nå› æ­¤ï¼Œä¸ºæ–‡ä»¶è®¾å®šä¸åŒç”¨æˆ·çš„è¯»ã€å†™å’Œæ‰§è¡Œæƒé™ï¼Œä»…æ¶‰åŠåˆ° 9 ä½å­—ç¬¦ï¼Œä»¥ ls å‘½ä»¤è¾“å‡ºä¿¡æ¯ä¸­çš„ .bash_logout æ–‡ä»¶ä¸ºä¾‹ï¼Œè®¾å®šä¸åŒç”¨æˆ·çš„è®¿é—®æƒé™æ˜¯ rw-r\u0026ndash;r\u0026ndash;ï¼ŒLinux å°†è®¿é—®æ–‡ä»¶çš„ç”¨æˆ·åˆ†ä¸º 3 ç±»ï¼Œåˆ†åˆ«æ˜¯æ–‡ä»¶çš„æ‰€æœ‰è€…ï¼Œæ‰€å±ç»„ï¼ˆä¹Ÿå°±æ˜¯æ–‡ä»¶æ‰€å±çš„ç¾¤ç»„ï¼‰ä»¥åŠå…¶ä»–äººã€‚é™¤äº†æ‰€æœ‰è€…ï¼Œä»¥åŠæ‰€å±ç¾¤ç»„ä¸­çš„ç”¨æˆ·å¯ä»¥è®¿é—®æ–‡ä»¶å¤–ï¼Œå…¶ä»–ç”¨æˆ·ï¼ˆå…¶ä»–ç¾¤ç»„ä¸­çš„ç”¨æˆ·ï¼‰ä¹Ÿå¯ä»¥è®¿é—®æ–‡ä»¶ï¼Œè¿™éƒ¨åˆ†ç”¨æˆ·éƒ½å½’ä¸ºå…¶ä»–äººèŒƒç•´.\nå¾ˆæ˜¾ç„¶ï¼ŒLinux ç³»ç»Ÿä¸º 3 ç§ä¸åŒçš„ç”¨æˆ·èº«ä»½ï¼Œåˆ†åˆ«è§„å®šäº†æ˜¯å¦å¯¹æ–‡ä»¶æœ‰è¯»ã€å†™å’Œæ‰§è¡Œæƒé™ã€‚æ‹¿å›¾ 1 æ¥è¯´ï¼Œæ–‡ä»¶æ‰€æœ‰è€…æ‹¥æœ‰å¯¹æ–‡ä»¶çš„è¯»å’Œå†™æƒé™ï¼Œä½†æ˜¯æ²¡æœ‰æ‰§è¡Œæƒé™ï¼›æ‰€å±ç¾¤ç»„ä¸­çš„ç”¨æˆ·åªæ‹¥æœ‰è¯»æƒé™ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™éƒ¨åˆ†ç”¨æˆ·åªèƒ½è®¿é—®æ–‡ä»¶ï¼Œæ— æ³•ä¿®æ”¹æ–‡ä»¶ï¼›å…¶ä»–äººä¹Ÿæ˜¯åªèƒ½è®¿é—®æ–‡ä»¶ã€‚\nLinux ç³»ç»Ÿä¸­ï¼Œå¤šæ•°æ–‡ä»¶çš„æ–‡ä»¶æ‰€æœ‰è€…å’Œæ‰€å±ç¾¤ç»„éƒ½æ˜¯ rootï¼ˆéƒ½æ˜¯ root è´¦æˆ·åˆ›å»ºçš„ï¼‰ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆï¼Œroot ç”¨æˆ·æ˜¯è¶…çº§ç®¡ç†å‘˜ï¼Œæƒé™è¶³å¤Ÿå¤§çš„åŸå› ã€‚\n4. Linuxè¯»å†™æ‰§è¡Œæƒé™ï¼ˆ-rã€-wã€-xï¼‰çš„çœŸæ­£å«ä¹‰ rwx æƒé™å¯¹æ–‡ä»¶çš„ä½œç”¨\næ–‡ä»¶ï¼Œæ˜¯ç³»ç»Ÿä¸­ç”¨æ¥å­˜å‚¨æ•°æ®çš„ï¼ŒåŒ…æ‹¬æ™®é€šçš„æ–‡æœ¬æ–‡ä»¶ã€æ•°æ®åº“æ–‡ä»¶ã€äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ï¼Œç­‰ç­‰ã€‚ä¸åŒçš„æƒé™å¯¹æ–‡ä»¶çš„å«ä¹‰å¦‚è¡¨ 1 æ‰€ç¤ºã€‚\n   rwxæƒé™ å¯¹æ–‡ä»¶çš„ä½œç”¨     è¯»æƒé™ï¼ˆrï¼‰ è¡¨ç¤ºå¯è¯»å–æ­¤æ–‡ä»¶ä¸­çš„å®é™…å†…å®¹ï¼Œä¾‹å¦‚ï¼Œå¯ä»¥å¯¹æ–‡ä»¶æ‰§è¡Œ catã€moreã€lessã€headã€tail ç­‰æ–‡ä»¶æŸ¥çœ‹å‘½ä»¤ã€‚   å†™æƒé™ï¼ˆwï¼‰ è¡¨ç¤ºå¯ä»¥ç¼–è¾‘ã€æ–°å¢æˆ–è€…ä¿®æ”¹æ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œä¾‹å¦‚ï¼Œå¯ä»¥å¯¹æ–‡ä»¶æ‰§è¡Œ vimã€echo ç­‰ä¿®æ”¹æ–‡ä»¶æ•°æ®çš„å‘½ä»¤ã€‚æ³¨æ„ï¼Œæ— æƒé™ä¸èµ‹äºˆç”¨æˆ·åˆ é™¤æ–‡ä»¶çš„æƒåˆ©ï¼Œé™¤éç”¨æˆ·å¯¹æ–‡ä»¶çš„ä¸Šçº§ç›®å½•æ‹¥æœ‰å†™æƒé™æ‰å¯ä»¥ã€‚   æ‰§è¡Œæƒé™ï¼ˆxï¼‰ è¡¨ç¤ºè¯¥æ–‡ä»¶å…·æœ‰è¢«ç³»ç»Ÿæ‰§è¡Œçš„æƒé™ã€‚Windowç³»ç»Ÿä¸­æŸ¥çœ‹ä¸€ä¸ªæ–‡ä»¶æ˜¯å¦ä¸ºå¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ˜¯é€šè¿‡æ‰©å±•åï¼ˆ.exeã€.bat ç­‰ï¼‰ï¼Œä½†åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œæ–‡ä»¶æ˜¯å¦èƒ½è¢«æ‰§è¡Œï¼Œæ˜¯é€šè¿‡çœ‹æ­¤æ–‡ä»¶æ˜¯å¦å…·æœ‰ x æƒé™æ¥å†³å®šçš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦æ–‡ä»¶æ‹¥æœ‰ x æƒé™ï¼Œåˆ™æ­¤æ–‡ä»¶å°±æ˜¯å¯æ‰§è¡Œæ–‡ä»¶ã€‚ä½†æ˜¯ï¼Œæ–‡ä»¶åˆ°åº•èƒ½å¤Ÿæ­£ç¡®è¿è¡Œï¼Œè¿˜è¦çœ‹æ–‡ä»¶ä¸­çš„ä»£ç æ˜¯å¦æ­£ç¡®ã€‚    rwx æƒé™å¯¹ç›®å½•çš„ä½œç”¨ ç›®å½•ï¼Œä¸»è¦ç”¨æ¥è®°å½•æ–‡ä»¶ååˆ—è¡¨ï¼Œä¸åŒçš„æƒé™å¯¹ç›®å½•çš„ä½œç”¨å¦‚è¡¨ 2 æ‰€ç¤ºã€‚\n   rwxæƒé™ å¯¹ç›®å½•çš„ä½œç”¨     è¯»æƒé™ï¼ˆrï¼‰ è¡¨ç¤ºå…·æœ‰è¯»å–ç›®å½•ç»“æ„åˆ—è¡¨çš„æƒé™ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥çœ‹åˆ°ç›®å½•ä¸­æœ‰å“ªäº›æ–‡ä»¶å’Œå­ç›®å½•ã€‚ä¸€æ—¦å¯¹ç›®å½•æ‹¥æœ‰ r æƒé™ï¼Œå°±å¯ä»¥åœ¨æ­¤ç›®å½•ä¸‹æ‰§è¡Œ ls å‘½ä»¤ï¼ŒæŸ¥çœ‹ç›®å½•ä¸­çš„å†…å®¹ã€‚   å†™æƒé™ï¼ˆwï¼‰ å¯¹äºç›®å½•æ¥è¯´ï¼Œw æƒé™æ˜¯æœ€é«˜æƒé™ã€‚å¯¹ç›®å½•æ‹¥æœ‰ w æƒé™ï¼Œè¡¨ç¤ºå¯ä»¥å¯¹ç›®å½•åšä»¥ä¸‹æ“ä½œï¼š     åœ¨æ­¤ç›®å½•ä¸­å»ºç«‹æ–°çš„æ–‡ä»¶æˆ–å­ç›®å½•ï¼› åˆ é™¤å·²å­˜åœ¨çš„æ–‡ä»¶å’Œç›®å½•ï¼ˆæ— è®ºå­æ–‡ä»¶æˆ–å­ç›®å½•çš„æƒé™æ˜¯æ€æ ·çš„ï¼‰ï¼› å¯¹å·²å­˜åœ¨çš„æ–‡ä»¶æˆ–ç›®å½•åšæ›´åæ“ä½œï¼› ç§»åŠ¨æ­¤ç›®å½•ä¸‹çš„æ–‡ä»¶å’Œç›®å½•çš„ä½ç½®. ä¸€æ—¦å¯¹ç›®å½•æ‹¥æœ‰ w æƒé™ï¼Œå°±å¯ä»¥åœ¨ç›®å½•ä¸‹æ‰§è¡Œ touchã€rmã€cpã€mv ç­‰å‘½ä»¤ã€‚|     rwxæƒé™ å¯¹ç›®å½•çš„ä½œç”¨     æ‰§è¡Œæƒé™ï¼ˆxï¼‰ ç›®å½•æ˜¯ä¸èƒ½ç›´æ¥è¿è¡Œçš„ï¼Œå¯¹ç›®å½•èµ‹äºˆ x æƒé™ï¼Œä»£è¡¨ç”¨æˆ·å¯ä»¥è¿›å…¥ç›®å½•ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œèµ‹äºˆ x æƒé™çš„ç”¨æˆ·æˆ–ç¾¤ç»„å¯ä»¥ä½¿ç”¨ cd å‘½ä»¤ã€‚    å¯¹ç›®å½•æ¥è¯´ï¼Œå¦‚æœåªèµ‹äºˆ r æƒé™ï¼Œåˆ™æ­¤ç›®å½•æ˜¯æ— æ³•ä½¿ç”¨çš„ã€‚å¾ˆç®€å•ï¼Œåªæœ‰ r æƒé™çš„ç›®å½•ï¼Œç”¨æˆ·åªèƒ½æŸ¥çœ‹ç›®å½•ç»“æ„ï¼Œæ ¹æœ¬æ— æ³•è¿›å…¥ç›®å½•ï¼ˆéœ€è¦ç”¨ x æƒé™ï¼‰ï¼Œæ›´ä¸ç”¨è¯´ä½¿ç”¨äº†ã€‚\nå› æ­¤ï¼Œå¯¹äºç›®å½•æ¥è¯´ï¼Œå¸¸ç”¨æ¥è®¾å®šç›®å½•çš„æƒé™å…¶å®åªæœ‰ 0ï¼ˆ\u0026mdash;ï¼‰ã€5ï¼ˆr-xï¼‰ã€7ï¼ˆrwxï¼‰è¿™ 3 ç§ã€‚\nã€ä¾‹ 1ã€‘ æŸç›®å½•çš„æƒé™å¦‚ä¸‹æ‰€ç¤ºï¼š\ndrwxr--r--. 3 root root 4096 Jun 25 08:35 .ssh ç³»ç»Ÿæœ‰ä¸ªè´¦å·åç§°ä¸º vbirdï¼Œæ­¤è´¦æˆ·å¹¶ä¸åŒ…å«åœ¨ root ç¾¤ç»„ä¸­ï¼Œè¯·é—® vbird å¯¹è¿™ä¸ªç›®å½•æœ‰ä½•æƒé™ï¼Ÿæ˜¯å¦å¯åˆ‡æ¢åˆ°æ­¤ç›®å½•ä¸­ï¼Ÿ\n ç­”æ¡ˆï¼švbird å¯¹æ­¤ç›®å½•ä»…å…·æœ‰ r çš„æƒé™ï¼Œå› æ­¤ vbird å¯ä»¥æŸ¥è¯¢æ­¤ç›®å½•ä¸‹çš„æ–‡ä»¶ååˆ—è¡¨ã€‚å› ä¸º vbird ä¸å…·æœ‰ x çš„æƒé™ï¼Œå› æ­¤ vbird å¹¶ä¸èƒ½åˆ‡æ¢åˆ°æ­¤ç›®å½•å†…ã€‚\n ã€ä¾‹ 2ã€‘ å‡è®¾æœ‰ä¸ªè´¦å·åç§°ä¸ºdmtsaiï¼Œä»–çš„ä¸»ç›®å½•åœ¨/home/dmtsai/ï¼Œdmtsaiå¯¹æ­¤ç›®å½•å…·æœ‰[rwx]çš„æƒé™ã€‚è‹¥åœ¨æ­¤ç›®å½•ä¸‹æœ‰ä¸ªåä¸º the_root.data çš„æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶çš„æƒé™å¦‚ä¸‹ï¼š\n-rwx------. 1 root root 4365 Sep 19 23:20 the_root.data è¯·é—® dmtsai å¯¹æ­¤æ–‡ä»¶çš„æƒé™ä¸ºä½•ï¼Ÿå¯å¦åˆ é™¤æ­¤æ–‡ä»¶ï¼Ÿ\n ç­”æ¡ˆï¼šç”±äº dmtsai å¯¹æ­¤æ–‡ä»¶æ¥è¯´æ˜¯å…¶ä»–äººçš„èº«ä»½ï¼Œå› æ­¤è¿™ä¸ªæ–‡ä»¶ä»–æ— æ³•è¯»ã€æ— æ³•ç¼–è¾‘ä¹Ÿæ— æ³•æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä»–æ— æ³•å˜åŠ¨è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹å°±æ˜¯äº†ã€‚ä½†æ˜¯ç”±äºè¿™ä¸ªæ–‡ä»¶åœ¨ä»–çš„ä¸»ç›®å½•ä¸‹ï¼Œä»–åœ¨æ­¤ç›®å½•ä¸‹å…·æœ‰ rwx çš„å®Œæ•´æƒé™ï¼Œå› æ­¤å¯¹äº the_root.data è¿™ä¸ªæ–‡ä»¶æ¥è¯´ï¼Œæ˜¯èƒ½å¤Ÿåˆ é™¤çš„ã€‚\n 5. Linux chmodå‘½ä»¤ï¼šä¿®æ”¹æ–‡ä»¶æˆ–ç›®å½•çš„æƒé™ æ—¢ç„¶æˆ‘ä»¬å·²ç»çŸ¥é“æ–‡ä»¶æƒé™å¯¹äºä¸€ä¸ªç³»ç»Ÿçš„é‡è¦æ€§ï¼Œä¹ŸçŸ¥é“æ¯ä¸ªæ–‡ä»¶éƒ½è®¾å®šäº†é’ˆå¯¹ä¸åŒç”¨æˆ·çš„è®¿é—®æƒé™ï¼Œé‚£ä¹ˆï¼Œæ˜¯å¦å¯ä»¥æ‰‹åŠ¨ä¿®æ”¹æ–‡ä»¶çš„è®¿é—®æƒé™å‘¢ï¼Ÿ\nå¯ä»¥ï¼Œé€šè¿‡ chmod å‘½ä»¤å³å¯ã€‚chmod å‘½ä»¤è®¾å®šæ–‡ä»¶æƒé™çš„æ–¹å¼æœ‰ 2 ç§ï¼Œåˆ†åˆ«å¯ä»¥ä½¿ç”¨æ•°å­—æˆ–è€…ç¬¦å·æ¥è¿›è¡Œæƒé™çš„å˜æ›´ã€‚ chmodå‘½ä»¤ä½¿ç”¨æ•°å­—ä¿®æ”¹æ–‡ä»¶æƒé™ Linux ç³»ç»Ÿä¸­ï¼Œæ–‡ä»¶çš„åŸºæœ¬æƒé™ç”± 9 ä¸ªå­—ç¬¦ç»„æˆï¼Œä»¥ rwxrw-r-x ä¸ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ•°å­—æ¥ä»£è¡¨å„ä¸ªæƒé™ï¼Œå„ä¸ªæƒé™ä¸æ•°å­—çš„å¯¹åº”å…³ç³»å¦‚ä¸‹ï¼š\n r \u0026ndash;\u0026gt; 4 w \u0026ndash;\u0026gt; 2 x \u0026ndash;\u0026gt; 1  ç”±äºè¿™ 9 ä¸ªå­—ç¬¦åˆ†å± 3 ç±»ç”¨æˆ·ï¼Œå› æ­¤æ¯ç§ç”¨æˆ·èº«ä»½åŒ…å« 3 ä¸ªæƒé™ï¼ˆrã€wã€xï¼‰ï¼Œé€šè¿‡å°† 3 ä¸ªæƒé™å¯¹åº”çš„æ•°å­—ç´¯åŠ ï¼Œæœ€ç»ˆå¾—åˆ°çš„å€¼å³å¯ä½œä¸ºæ¯ç§ç”¨æˆ·æ‰€å…·æœ‰çš„æƒé™ã€‚\næ‹¿ rwxrw-r-x æ¥è¯´ï¼Œæ‰€æœ‰è€…ã€æ‰€å±ç»„å’Œå…¶ä»–äººåˆ†åˆ«å¯¹åº”çš„æƒé™å€¼ä¸ºï¼š\n æ‰€æœ‰è€… = rwx = 4+2+1 = 7 æ‰€å±ç»„ = rw- = 4+2 = 6 å…¶ä»–äºº = r-x = 4+1 = 5  æ‰€ä»¥ï¼Œæ­¤æƒé™å¯¹åº”çš„æƒé™å€¼å°±æ˜¯ 765ã€‚\nä½¿ç”¨æ•°å­—ä¿®æ”¹æ–‡ä»¶æƒé™çš„ chmod å‘½ä»¤åŸºæœ¬æ ¼å¼ä¸ºï¼š\n[root@localhost ~]# chmod [-R] æƒé™å€¼ æ–‡ä»¶å -Rï¼ˆæ³¨æ„æ˜¯å¤§å†™ï¼‰é€‰é¡¹è¡¨ç¤ºè¿åŒå­ç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶ï¼Œä¹Ÿéƒ½ä¿®æ”¹è®¾å®šçš„æƒé™ã€‚\nä¾‹å¦‚ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼Œå³å¯å®Œæˆå¯¹ .bashrc ç›®å½•æ–‡ä»¶çš„æƒé™ä¿®æ”¹ï¼š\n[root@localhost ~]# ls -al .bashrc -rw-r--r--. 1 root root 176 Sep 22 2004 .bashrc [root@localhost ~]# chmod 777 .bashrc [root@localhost ~]# ls -al .bashrc -rwxrwxrwx. 1 root root 176 Sep 22 2004 .bashrc å†ä¸¾ä¸ªä¾‹å­ï¼Œé€šå¸¸æˆ‘ä»¬ä»¥ Vim ç¼–è¾‘ Shell æ–‡ä»¶æ‰¹å¤„ç†æ–‡ä»¶åï¼Œæ–‡ä»¶æƒé™é€šå¸¸æ˜¯ rw-rw-r\u0026ndash;ï¼ˆ644ï¼‰ï¼Œé‚£ä¹ˆï¼Œå¦‚æœè¦å°†è¯¥æ–‡ä»¶å˜æˆå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶ä¸”ä¸è®©å…¶ä»–äººä¿®æ”¹æ­¤æ–‡ä»¶ï¼Œåˆ™åªéœ€å°†æ­¤æ–‡ä»¶çš„æƒé™è¯¥ä¸º rwxr-xr-xï¼ˆ755ï¼‰å³å¯ã€‚\nchmodå‘½ä»¤ä½¿ç”¨å­—æ¯ä¿®æ”¹æ–‡ä»¶æƒé™\næ—¢ç„¶æ–‡ä»¶çš„åŸºæœ¬æƒé™å°±æ˜¯ 3 ç§ç”¨æˆ·èº«ä»½ï¼ˆæ‰€æœ‰è€…ã€æ‰€å±ç»„å’Œå…¶ä»–äººï¼‰æ­é… 3 ç§æƒé™ï¼ˆrwxï¼‰ï¼Œchmod å‘½ä»¤ä¸­ç”¨ uã€gã€o åˆ†åˆ«ä»£è¡¨ 3 ç§èº«ä»½ï¼Œè¿˜ç”¨ a è¡¨ç¤ºå…¨éƒ¨çš„èº«ä»½ï¼ˆall çš„ç¼©å†™ï¼‰ã€‚å¦å¤–ï¼Œchmod å‘½ä»¤ä»ä½¿ç”¨ rã€wã€x åˆ†åˆ«è¡¨ç¤ºè¯»ã€å†™ã€æ‰§è¡Œæƒé™ã€‚\nä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬è¦è®¾å®š .bashrc æ–‡ä»¶çš„æƒé™ä¸º rwxr-xr-xï¼Œåˆ™å¯æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š\n[root@localhost ~]# chmod u=rwx,go=rx .bashrc [root@localhost ~]# ls -al .bashrc -rwxr-xr-x. 1 root root 176 Sep 22 2004 .bashrc å†ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœæƒ³è¦å¢åŠ  .bashrc æ–‡ä»¶çš„æ¯ç§ç”¨æˆ·éƒ½å¯åšå†™æ“ä½œçš„æƒé™ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š\n[root@localhost ~]# ls -al .bashrc -rwxr-xr-x. 1 root root 176 Sep 22 2004 .bashrc [root@localhost ~]# chmod a+w .bashrc [root@localhost ~]# ls -al .bashrc -rwxrwxrwx. 1 root root 176 Sep 22 2004 .bashrc 6. Linux umaskè¯¦è§£ï¼šä»¤æ–°å»ºæ–‡ä»¶å’Œç›®å½•æ‹¥æœ‰é»˜è®¤æƒé™ Linux æ˜¯æ³¨é‡å®‰å…¨æ€§çš„æ“ä½œç³»ç»Ÿï¼Œè€Œå®‰å…¨çš„åŸºç¡€åœ¨äºå¯¹æƒé™çš„è®¾å®šï¼Œä¸ä»…æ‰€æœ‰å·²å­˜åœ¨çš„æ–‡ä»¶å’Œç›®å½•è¦è®¾å®šå¿…è¦çš„è®¿é—®æƒé™ï¼Œåˆ›å»ºæ–°çš„æ–‡ä»¶å’Œç›®å½•æ—¶ï¼Œä¹Ÿè¦è®¾å®šå¿…è¦çš„åˆå§‹æƒé™ã€‚\nWindows ç³»ç»Ÿä¸­ï¼Œæ–°å»ºçš„æ–‡ä»¶å’Œç›®å½•æ—¶é€šè¿‡ç»§æ‰¿ä¸Šçº§ç›®å½•çš„æƒé™è·å¾—çš„åˆå§‹æƒé™ï¼Œè€Œ Linux ä¸åŒï¼Œå®ƒæ˜¯é€šè¿‡ä½¿ç”¨ umask é»˜è®¤æƒé™æ¥ç»™æ‰€æœ‰æ–°å»ºçš„æ–‡ä»¶å’Œç›®å½•èµ‹äºˆåˆå§‹æƒé™çš„ã€‚\né‚£ä¹ˆï¼Œæˆ‘ä»¬å¦‚ä½•å¾—çŸ¥ umask é»˜è®¤æƒé™çš„å€¼å‘¢ï¼Ÿç›´æ¥é€šè¿‡ umask å‘½ä»¤å³å¯ï¼š\n[root@localhost ~]# umask 0022 #rootç”¨æˆ·é»˜è®¤æ˜¯0022ï¼Œæ™®é€šç”¨æˆ·é»˜è®¤æ˜¯ 0002 å¤§å®¶å¯èƒ½ä¼šé—®ï¼Œä¸åº”è¯¥åªæœ‰ 3 ä¸ªæ•°å­—ï¼ˆåˆ†åˆ«å¯¹åº” 3 ç§ç”¨æˆ·èº«ä»½ï¼‰å—ï¼Œä¸ºä»€ä¹ˆæœ‰ 4 ä¸ªï¼Ÿ umask é»˜è®¤æƒé™ç¡®å®ç”± 4 ä¸ªå…«è¿›åˆ¶æ•°ç»„æˆï¼Œä½†ç¬¬ 1 ä¸ªæ•°ä»£è¡¨çš„æ˜¯æ–‡ä»¶æ‰€å…·æœ‰çš„ç‰¹æ®Šæƒé™ï¼ˆSetUIDã€SetGIDã€Sticky BITï¼‰ï¼Œæ­¤éƒ¨åˆ†å†…å®¹æ”¾åˆ°åç»­ç« èŠ‚ä¸­è®²è§£ï¼Œç°åœ¨å…ˆä¸è®¨è®ºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå 3 ä½æ•°å­— \u0026ldquo;022\u0026rdquo; æ‰æ˜¯æœ¬èŠ‚çœŸæ­£è¦ç”¨åˆ°çš„ umask æƒé™å€¼ï¼Œå°†å…¶è½¬å˜ä¸ºå­—æ¯å½¢å¼ä¸º \u0026mdash;-w\u0026ndash;w-ã€‚\næ³¨æ„ï¼Œè™½ç„¶ umask é»˜è®¤æƒé™æ˜¯ç”¨æ¥è®¾å®šæ–‡ä»¶æˆ–ç›®å½•çš„åˆå§‹æƒé™ï¼Œä½†å¹¶ä¸æ˜¯ç›´æ¥å°† umask é»˜è®¤æƒé™ä½œä¸ºæ–‡ä»¶æˆ–ç›®å½•çš„åˆå§‹æƒé™ï¼Œè¿˜è¦å¯¹å…¶è¿›è¡Œ \u0026ldquo;å†åŠ å·¥\u0026rdquo;ã€‚\næ–‡ä»¶å’Œç›®å½•çš„çœŸæ­£åˆå§‹æƒé™ï¼Œå¯é€šè¿‡ä»¥ä¸‹çš„è®¡ç®—å¾—åˆ°ï¼š æ–‡ä»¶ï¼ˆæˆ–ç›®å½•ï¼‰çš„åˆå§‹æƒé™ = æ–‡ä»¶ï¼ˆæˆ–ç›®å½•ï¼‰çš„æœ€å¤§é»˜è®¤æƒé™ - umaskæƒé™\nå¦‚æœæŒ‰ç…§å®˜æ–¹çš„æ ‡å‡†ç®—æ³•ï¼Œéœ€è¦å°† umask é»˜è®¤æƒé™ä½¿ç”¨äºŒè¿›åˆ¶å¹¶ç»è¿‡é€»è¾‘ä¸å’Œé€»è¾‘éè¿ç®—åï¼Œæ‰èƒ½å¾—åˆ°æœ€ç»ˆæ–‡ä»¶æˆ–ç›®å½•çš„åˆå§‹æƒé™ï¼Œè®¡ç®—è¿‡ç¨‹æ¯”è¾ƒå¤æ‚ï¼Œä¸”å®¹æ˜“å‡ºé”™ï¼Œå› æ­¤æœ¬èŠ‚ç»™å¤§å®¶ä»‹ç»äº†æ›´ç®€å•çš„è®¡ç®—æ–¹å¼ã€‚\næ˜¾ç„¶ï¼Œå¦‚æœæƒ³æœ€ç»ˆå¾—åˆ°æ–‡ä»¶æˆ–ç›®å½•çš„åˆå§‹æƒé™å€¼ï¼Œæˆ‘ä»¬è¿˜éœ€è¦äº†è§£æ–‡ä»¶å’Œç›®å½•çš„æœ€å¤§é»˜è®¤æƒé™å€¼ã€‚åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œæ–‡ä»¶å’Œç›®å½•çš„æœ€å¤§é»˜è®¤æƒé™æ˜¯ä¸ä¸€æ ·çš„ï¼š å¯¹æ–‡ä»¶æ¥è®²ï¼Œå…¶å¯æ‹¥æœ‰çš„æœ€å¤§é»˜è®¤æƒé™æ˜¯ 666ï¼Œå³ rw-rw-rw-ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½¿ç”¨æ–‡ä»¶çš„ä»»ä½•ç”¨æˆ·éƒ½æ²¡æœ‰æ‰§è¡Œï¼ˆxï¼‰æƒé™ã€‚åŸå› å¾ˆç®€å•ï¼Œæ‰§è¡Œæƒé™æ˜¯æ–‡ä»¶çš„æœ€é«˜æƒé™ï¼Œèµ‹äºˆæ—¶ç»å¯¹è¦æ…é‡ï¼Œå› æ­¤ç»ä¸èƒ½åœ¨æ–°å»ºæ–‡ä»¶çš„æ—¶å€™å°±é»˜è®¤èµ‹äºˆï¼Œåªèƒ½é€šè¿‡ç”¨æˆ·æ‰‹å·¥èµ‹äºˆã€‚ å¯¹ç›®å½•æ¥è®²ï¼Œå…¶å¯æ‹¥æœ‰çš„æœ€å¤§é»˜è®¤æƒé™æ˜¯ 777ï¼Œå³ rwxrwxrwxã€‚\næ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ©ç”¨å­—æ¯æƒé™çš„æ–¹å¼è®¡ç®—æ–‡ä»¶æˆ–ç›®å½•çš„åˆå§‹æƒé™ã€‚ä»¥ umask å€¼ä¸º 022 ä¸ºä¾‹ï¼Œåˆ†åˆ«è®¡ç®—æ–°å»ºæ–‡ä»¶å’Œç›®å½•çš„åˆå§‹æƒé™ï¼š æ–‡ä»¶çš„æœ€å¤§é»˜è®¤æƒé™æ˜¯ 666ï¼Œæ¢ç®—æˆå­—æ¯å°±æ˜¯ \u0026ldquo;-rw-rw-rw-\u0026quot;ï¼Œumask çš„å€¼æ˜¯ 022ï¼Œæ¢ç®—æˆå­—æ¯ä¸º \u0026ldquo;\u0026mdash;\u0026ndash;w\u0026ndash;w-\u0026quot;ã€‚æŠŠä¸¤ä¸ªå­—æ¯æƒé™ç›¸å‡ï¼Œå¾—åˆ° (-rw-rw-rw-) - (\u0026mdash;\u0026ndash;w\u0026ndash;w-) = (-rw-r\u0026ndash;r\u0026ndash;)ï¼Œè¿™å°±æ˜¯æ–°å»ºæ–‡ä»¶çš„åˆå§‹æƒé™ã€‚æˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹ï¼š\n[root@localhost ~]# umask 0022 #é»˜è®¤umaskçš„å€¼æ˜¯0022 [root@localhost ~]# touch file \u0026lt;--æ–°å»ºfileç©ºæ–‡ä»¶ [root@localhost ~]# ll -d file -rw-r--r--. 1 root root 0 Apr 18 02:36 file ç›®å½•çš„é»˜è®¤æƒé™æœ€å¤§å¯ä»¥æ˜¯ 777ï¼Œæ¢ç®—æˆå­—æ¯å°±æ˜¯ \u0026ldquo;drwxrwxrwx\u0026rdquo;ï¼Œumask çš„å€¼æ˜¯ 022ï¼Œä¹Ÿå°±æ˜¯ \u0026ldquo;\u0026mdash;\u0026ndash;w\u0026ndash;w-\u0026quot;ã€‚æŠŠä¸¤ä¸ªå­—æ¯æƒé™ç›¸å‡ï¼Œå¾—åˆ°çš„å°±æ˜¯æ–°å»ºç›®å½•çš„é»˜è®¤æƒé™ï¼Œå³ (drwxrwxrwx) - (\u0026mdash;\u0026ndash;w\u0026ndash;w-) = (drwxr-xr-x)ã€‚æˆ‘ä»¬å†æ¥æµ‹è¯•ä¸€ä¸‹ï¼š\n[root@localhost ~]# umask 0022 [root@localhost ~]# mkdir catalog \u0026lt;--æ–°å»ºcatalogç›®å½• [root@localhost ~]# ll -d catalog drwxr-xr-x. 2 root root 4096 Apr 18 02:36 catalog æ³¨æ„ï¼Œåœ¨è®¡ç®—æ–‡ä»¶æˆ–ç›®å½•çš„åˆå§‹æƒé™æ—¶ï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨æœ€å¤§é»˜è®¤æƒé™å’Œ umask æƒé™çš„æ•°å­—å½¢å¼åšå‡æ³•ï¼Œè¿™æ˜¯ä¸å¯¹çš„ã€‚ä¾‹å¦‚ï¼Œè‹¥ umask é»˜è®¤æƒé™çš„å€¼ä¸º 033ï¼ŒæŒ‰ç…§æ•°å­—å½¢å¼è®¡ç®—æ–‡ä»¶çš„åˆå§‹æƒé™ï¼Œ666-033=633ï¼Œä½†æˆ‘ä»¬æŒ‰ç…§å­—æ¯çš„å½¢å¼è®¡ç®—ä¼šå¾—åˆ° ï¼ˆrw-rw-rw-) - (\u0026mdash;-wx-wx) = (rw-r\u0026ndash;r\u0026ndash;)ï¼Œæ¢ç®—æˆæ•°å­—å½¢å¼æ˜¯ 644ã€‚ è¿™é‡Œçš„å‡æ³•ï¼Œå…¶å®æ˜¯â€œé®ç›–â€çš„æ„æ€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæœ€å¤§é»˜è®¤æƒé™ä¸­å’Œ umask æƒé™å…¬å…±çš„éƒ¨åˆ†ï¼Œé€šè¿‡å‡æ³•è¿ç®—ä¼šè¢«é®ç›–æ‰ï¼Œæœ€ç»ˆå‰©ä¸‹çš„â€œæœ€å¤§é»˜è®¤æƒé™â€ï¼Œæ‰æ˜¯æœ€ç»ˆèµ‹äºˆæ–‡ä»¶æˆ–ç›®å½•çš„åˆå§‹æƒé™ã€‚\numaské»˜è®¤æƒé™çš„ä¿®æ”¹æ–¹æ³• umask æƒé™å€¼å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤ç›´æ¥ä¿®æ”¹ï¼š\n[root@localhost ~]# umask 002 [root@localhost ~]# umask 0002 [root@localhost ~]# umask 033 [root@localhost ~]# umask 0033 ä¸è¿‡ï¼Œè¿™ç§æ–¹å¼ä¿®æ”¹çš„ umask åªæ˜¯ä¸´æ—¶æœ‰æ•ˆï¼Œä¸€æ—¦é‡å¯æˆ–é‡æ–°ç™»é™†ç³»ç»Ÿï¼Œå°±ä¼šå¤±æ•ˆã€‚å¦‚æœæƒ³è®©ä¿®æ”¹æ°¸ä¹…ç”Ÿæ•ˆï¼Œåˆ™éœ€è¦ä¿®æ”¹å¯¹åº”çš„ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶ /etc/profileã€‚ä¾‹å¦‚ï¼š\n[root@localhost ~]# vim /etc/profile ...çœç•¥éƒ¨åˆ†å†…å®¹... if [ $UID -gt 199]\u0026amp;\u0026amp;[ \u0026#34;\u0026#39;id -gn\u0026#39;\u0026#34; = \u0026#34;\u0026#39;id -un\u0026#39;\u0026#34; ]; then umask 002 #å¦‚æœUIDå¤§äº199ï¼ˆæ™®é€šç”¨æˆ·ï¼‰ï¼Œåˆ™ä½¿ç”¨æ­¤umaskå€¼ else umask 022 #å¦‚æœUIDå°äº199ï¼ˆè¶…çº§ç”¨æˆ·ï¼‰ï¼Œåˆ™ä½¿ç”¨æ­¤umaskå€¼ fi ...çœç•¥éƒ¨åˆ†å†…å®¹... è¿™æ˜¯ä¸€æ®µ Shell è„šæœ¬ç¨‹åºï¼Œä¸æ‡‚ä¹Ÿæ²¡å…³ç³»ï¼Œå¤§å®¶åªéœ€è¦çŸ¥é“ï¼Œæ™®é€šç”¨æˆ·çš„ umask ç”± if è¯­å¥çš„ç¬¬ä¸€æ®µå®šä¹‰ï¼Œè€Œè¶…çº§ç”¨æˆ· root çš„ umask å€¼ç”± else è¯­å¥å®šä¹‰å³å¯ã€‚ ä¿®æ”¹æ­¤æ–‡ä»¶ï¼Œåˆ™ umask å€¼å°±ä¼šæ°¸ä¹…ç”Ÿæ•ˆã€‚\n7. ACLæƒé™æ˜¯ä»€ä¹ˆï¼ŒLinux ACLè®¿é—®æ§åˆ¶æƒé™ï¼ˆåŒ…å«å¼€å¯æ–¹å¼ï¼‰ Linux ç³»ç»Ÿä¼ ç»Ÿçš„æƒé™æ§åˆ¶æ–¹å¼ï¼Œæ— éæ˜¯åˆ©ç”¨ 3 ç§èº«ä»½ï¼ˆæ–‡ä»¶æ‰€æœ‰è€…ï¼Œæ‰€å±ç¾¤ç»„ï¼Œå…¶ä»–ç”¨æˆ·ï¼‰ï¼Œå¹¶åˆ†åˆ«æ­é… 3 ç§æƒé™ï¼ˆè¯» rï¼Œå†™ wï¼Œè®¿é—® xï¼‰ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ ls -l å‘½ä»¤æŸ¥çœ‹å½“å‰ç›®å½•ä¸­æ‰€æœ‰æ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯ï¼Œå…¶ä¸­å°±åŒ…å«å¯¹å„æ–‡ä»¶çš„æƒé™è®¾ç½®ï¼š\n[root@localhost ~]# ls -l total 36 drwxr-xr-x. 2 root root 4096 Apr 15 16:33 Desktop drwxr-xr-x. 2 root root 4096 Apr 15 16:33 Documents ... -rwxr-xr-x. 2 root root 4096 Apr 15 16:33 post-install ... ä»¥ä¸Šè¾“å‡ºä¿¡æ¯ä¸­ï¼Œâ€œrwxr-xr-xâ€å°±æŒ‡æ˜äº†ä¸åŒç”¨æˆ·è®¿é—®æ–‡ä»¶çš„æƒé™ï¼Œå³æ–‡ä»¶æ‰€æœ‰è€…æ‹¥æœ‰å¯¹æ–‡ä»¶çš„è¯»ã€å†™ã€è®¿é—®æƒé™ï¼ˆrwxï¼‰ï¼Œæ–‡ä»¶æ‰€å±ç¾¤ç»„æ‹¥æœ‰å¯¹æ–‡ä»¶çš„è¯»ã€è®¿é—®æƒé™ï¼ˆr-xï¼‰ï¼Œå…¶ä»–ç”¨æˆ·æ‹¥æœ‰å¯¹æ–‡ä»¶çš„è¯»ã€è®¿é—®æƒé™ï¼ˆr-xï¼‰ã€‚ æƒé™å‰çš„å­—ç¬¦ï¼Œè¡¨ç¤ºæ–‡ä»¶çš„å…·ä½“ç±»å‹ï¼Œæ¯”å¦‚ d è¡¨ç¤ºç›®å½•ï¼Œ- è¡¨ç¤ºæ™®é€šæ–‡ä»¶ï¼Œl è¡¨ç¤ºè¿æ¥æ–‡ä»¶ï¼Œb è¡¨ç¤ºè®¾å¤‡æ–‡ä»¶ï¼Œç­‰ç­‰ã€‚\nä½†åœ¨å®é™…åº”ç”¨ä¸­ï¼Œä»¥ä¸Šè¿™ 3 ç§èº«ä»½æ ¹æœ¬ä¸å¤Ÿç”¨ï¼Œç»™å¤§å®¶ä¸¾ä¸ªä¾‹å­ã€‚ ä¸Šå›¾çš„æ ¹ç›®å½•ä¸­æœ‰ä¸€ä¸ª /project ç›®å½•ï¼Œè¿™æ˜¯ç­çº§çš„é¡¹ç›®ç›®å½•ã€‚ç­çº§ä¸­çš„æ¯ä¸ªå­¦å‘˜éƒ½å¯ä»¥è®¿é—®å’Œä¿®æ”¹è¿™ä¸ªç›®å½•ï¼Œè€å¸ˆéœ€è¦æ‹¥æœ‰å¯¹è¯¥ç›®å½•çš„æœ€é«˜æƒé™ï¼Œå…¶ä»–ç­çº§çš„å­¦å‘˜å½“ç„¶ä¸èƒ½è®¿é—®è¿™ä¸ªç›®å½•ã€‚\néœ€è¦æ€ä¹ˆè§„åˆ’è¿™ä¸ªç›®å½•çš„æƒé™å‘¢ï¼Ÿåº”è¯¥è¿™æ ·ï¼Œè€å¸ˆä½¿ç”¨ root ç”¨æˆ·ï¼Œä½œä¸ºè¿™ä¸ªç›®å½•çš„å±ä¸»ï¼Œæƒé™ä¸º rwxï¼›ç­çº§æ‰€æœ‰çš„å­¦å‘˜éƒ½åŠ å…¥ tgroup ç»„ï¼Œä½¿ tgroup ç»„ä½œä¸º /project ç›®å½•çš„å±ç»„ï¼Œæƒé™æ˜¯ rwxï¼›å…¶ä»–äººçš„æƒé™è®¾å®šä¸º 0ï¼ˆä¹Ÿå°±æ˜¯ \u0026mdash;ï¼‰ã€‚è¿™æ ·ä¸€æ¥ï¼Œè®¿é—®æ­¤ç›®å½•çš„æƒé™å°±ç¬¦åˆæˆ‘ä»¬çš„è¦æ±‚äº†ã€‚\næœ‰ä¸€å¤©ï¼Œç­é‡Œæ¥äº†ä¸€ä½è¯•å¬çš„å­¦å‘˜ stï¼Œå¥¹å¿…é¡»èƒ½å¤Ÿè®¿é—® /project ç›®å½•ï¼Œæ‰€ä»¥å¿…é¡»å¯¹è¿™ä¸ªç›®å½•æ‹¥æœ‰ r å’Œ x æƒé™ï¼›ä½†æ˜¯å¥¹åˆæ²¡æœ‰å­¦ä¹ è¿‡ä»¥å‰çš„è¯¾ç¨‹ï¼Œæ‰€ä»¥ä¸èƒ½èµ‹äºˆå¥¹ w æƒé™ï¼Œæ€•å¥¹æ”¹é”™äº†ç›®å½•ä¸­çš„å†…å®¹ï¼Œæ‰€ä»¥å­¦å‘˜ st çš„æƒé™å°±æ˜¯ r-xã€‚å¯æ˜¯å¦‚ä½•åˆ†é…å¥¹çš„èº«ä»½å‘¢ï¼Ÿå˜ä¸ºå±ä¸»ï¼Ÿå½“ç„¶ä¸è¡Œï¼Œè¦ä¸ root è¯¥æ”¾å“ªé‡Œï¼ŸåŠ å…¥ tgroup ç»„ï¼Ÿä¹Ÿä¸è¡Œï¼Œå› ä¸º tgroup ç»„çš„æƒé™æ˜¯ rwxï¼Œè€Œæˆ‘ä»¬è¦æ±‚å­¦å‘˜ st çš„æƒé™æ˜¯ r-xã€‚å¦‚æœæŠŠå…¶ä»–äººçš„æƒé™æ”¹ä¸º r-x å‘¢ï¼Ÿè¿™æ ·ä¸€æ¥ï¼Œå…¶ä»–ç­çº§çš„æ‰€æœ‰å­¦å‘˜éƒ½å¯ä»¥è®¿é—® /project ç›®å½•äº†ã€‚\næ˜¾ç„¶ï¼Œæ™®é€šæƒé™çš„ä¸‰ç§èº«ä»½ä¸å¤Ÿç”¨äº†ï¼Œæ— æ³•å®ç°å¯¹æŸä¸ªå•ç‹¬çš„ç”¨æˆ·è®¾å®šè®¿é—®æƒé™ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå°±éœ€è¦ä½¿ç”¨ ACL è®¿é—®æ§åˆ¶æƒé™ã€‚\nACLï¼Œæ˜¯ Access Control Listï¼ˆè®¿é—®æ§åˆ¶åˆ—è¡¨ï¼‰çš„ç¼©å†™ï¼Œåœ¨ Linux ç³»ç»Ÿä¸­ï¼Œ ACL å¯å®ç°å¯¹å•ä¸€ç”¨æˆ·è®¾å®šè®¿é—®æ–‡ä»¶çš„æƒé™ã€‚ä¹Ÿå¯ä»¥è¿™ä¹ˆè¯´ï¼Œè®¾å®šæ–‡ä»¶çš„è®¿é—®æƒé™ï¼Œé™¤äº†ç”¨ä¼ ç»Ÿæ–¹å¼ï¼ˆ3 ç§èº«ä»½æ­é… 3 ç§æƒé™ï¼‰ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ ACL è¿›è¡Œè®¾å®šã€‚æ‹¿æœ¬ä¾‹ä¸­çš„ st å­¦å‘˜æ¥è¯´ï¼Œæ—¢ç„¶èµ‹äºˆå®ƒä¼ ç»Ÿçš„ 3 ç§èº«ä»½ï¼Œæ— æ³•è§£å†³é—®é¢˜ï¼Œå°±å¯ä»¥è€ƒè™‘ä½¿ç”¨ ACL æƒé™æ§åˆ¶çš„æ–¹å¼ï¼Œç›´æ¥å¯¹ st ç”¨æˆ·è®¾å®šè®¿é—®æ–‡ä»¶çš„ r-x æƒé™ã€‚\nå¼€å¯ ACL æƒé™\nCentOS 6.x ç³»ç»Ÿä¸­ï¼ŒACL æƒé™é»˜è®¤å¤„äºå¼€å¯çŠ¶æ€ï¼Œæ— éœ€æ‰‹å·¥å¼€å¯ã€‚ä½†å¦‚æœä½ çš„æ“ä½œç³»ç»Ÿä¸æ˜¯ CentOS 6.xï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼æŸ¥çœ‹ACLæƒé™æ˜¯å¦å¼€å¯ï¼š\n[root@localhost ~]# mount /dev/sda1 on /boot type ext4 (rw) /dev/sda3 on I type ext4 (rw) â€¦çœç•¥éƒ¨åˆ†è¾“å‡ºâ€¦ #ä½¿ç”¨mountå‘½ä»¤å¯ä»¥çœ‹åˆ°ç³»ç»Ÿä¸­å·²ç»æŒ‚è½½çš„åˆ†åŒºï¼Œä½†æ˜¯å¹¶æ²¡æœ‰çœ‹åˆ°ACLæƒé™çš„è®¾ç½® [root@localhost ~]# dumpe2fs -h /dev/sda3 #dumpe2fsæ˜¯æŸ¥è¯¢æŒ‡å®šåˆ†åŒºæ–‡ä»¶ç³»ç»Ÿè¯¦ç»†ä¿¡æ¯çš„å‘½ä»¤ â€¦çœç•¥éƒ¨åˆ†è¾“å‡ºâ€¦ Default mount options: user_xattr acl â€¦çœç•¥éƒ¨åˆ†è¾“å‡ºâ€¦ å…¶ä¸­ï¼Œdumpe2fs å‘½ä»¤çš„ -h é€‰é¡¹è¡¨ç¤ºä»…æ˜¾ç¤ºè¶…çº§å—ä¸­çš„ä¿¡æ¯ï¼Œè€Œä¸æ˜¾ç¤ºç£ç›˜å—ç»„çš„è¯¦ç»†ä¿¡æ¯ï¼›\nä½¿ç”¨ mount å‘½ä»¤å¯ä»¥æŸ¥çœ‹åˆ°ç³»ç»Ÿä¸­å·²ç»æŒ‚è½½çš„åˆ†åŒºï¼Œè€Œä½¿ç”¨ dumpe2fs å‘½ä»¤å¯ä»¥æŸ¥çœ‹åˆ°è¿™ä¸ªåˆ†åŒºæ–‡ä»¶ç³»ç»Ÿçš„è¯¦ç»†ä¿¡æ¯ã€‚å¤§å®¶å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬çš„ ACL æƒé™æ˜¯ /dev/sda3 åˆ†åŒºçš„é»˜è®¤æŒ‚è½½é€‰é¡¹ï¼Œæ‰€ä»¥ä¸éœ€è¦æ‰‹å·¥æŒ‚è½½ã€‚ å¦‚æœ Linux ç³»ç»Ÿå¦‚æœæ²¡æœ‰é»˜è®¤æŒ‚è½½ï¼Œå¯ä»¥æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å®ç°æ‰‹åŠ¨æŒ‚è½½ï¼š\n[root@localhost ~]# mount -o remount,acl /  #é‡æ–°æŒ‚è½½æ ¹åˆ†åŒºï¼Œå¹¶åŠ å…¥ACLæƒé™  ä½¿ç”¨ mount å‘½ä»¤é‡æ–°æŒ‚è½½ï¼Œå¹¶åŠ å…¥ ACL æƒé™ã€‚ä½†ä½¿ç”¨æ­¤å‘½ä»¤åªæ˜¯ä¸´æ—¶ç”Ÿæ•ˆï¼Œè¦æƒ³æ°¸ä¹…ç”Ÿæ•ˆï¼Œéœ€è¦ä¿®æ”¹ /etc/fstab æ–‡ä»¶ï¼Œä¿®æ”¹æ–¹æ³•å¦‚ä¸‹ï¼š\n[root@localhost ~]#vi /etc/fstab UUID=c2ca6f57-b15c-43ea-bca0-f239083d8bd2 /ext4 defaults,acl 1 1 #åŠ å…¥ACLæƒé™ [root@localhost ~]# mount -o remount / #é‡æ–°æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿæˆ–é‡å¯ç³»ç»Ÿï¼Œä½¿ä¿®æ”¹ç”Ÿæ•ˆ åœ¨ä½ éœ€è¦å¼€å¯ ACL æƒé™çš„åˆ†åŒºè¡Œä¸Šï¼ˆä¹Ÿå°±æ˜¯è¯´ ACL æƒé™é’ˆå¯¹çš„æ˜¯åˆ†åŒºï¼‰ï¼Œæ‰‹å·¥åœ¨ defaults åé¢åŠ å…¥ \u0026ldquo;ï¼Œacl\u0026rdquo; å³å¯æ°¸ä¹…åœ¨æ­¤åˆ†åŒºä¸­å¼€å¯ ACL æƒé™ã€‚\n8. Linux ACLæƒé™è®¾ç½®ï¼ˆsetfaclå’Œgetfaclï¼‰ é€šè¿‡ä¸Šä¸€èŠ‚çš„å­¦ä¹ ï¼Œæˆ‘ä»¬çŸ¥é“äº†ä»€ä¹ˆæ˜¯ ACL æƒé™ï¼Œä¹Ÿäº†è§£äº†å¦‚ä½•é…ç½® Linux ç³»ç»Ÿä½¿å…¶å¼€å¯ ACL æƒé™ï¼Œæœ¬èŠ‚æ¥å­¦ä¹  ACL è®¾å®šæ–‡ä»¶è®¿é—®æƒé™çš„å…·ä½“æ–¹æ³•ã€‚\nè®¾å®š ACl æƒé™ï¼Œå¸¸ç”¨å‘½ä»¤æœ‰ 2 ä¸ªï¼Œåˆ†åˆ«æ˜¯ setfacl å’Œ getfacl å‘½ä»¤ï¼Œå‰è€…ç”¨äºç»™æŒ‡å®šæ–‡ä»¶æˆ–ç›®å½•è®¾å®š ACL æƒé™ï¼Œåè€…ç”¨äºæŸ¥çœ‹æ˜¯å¦é…ç½®æˆåŠŸã€‚\ngetfacl å‘½ä»¤ç”¨äºæŸ¥çœ‹æ–‡ä»¶æˆ–ç›®å½•å½“å‰è®¾å®šçš„ ACL æƒé™ä¿¡æ¯ã€‚è¯¥å‘½ä»¤çš„åŸºæœ¬æ ¼å¼ä¸ºï¼š\n[root@localhost ~]# getfacl æ–‡ä»¶å getfacl å‘½ä»¤çš„ä½¿ç”¨éå¸¸ç®€å•ï¼Œä¸”å¸¸å’Œ setfacl å‘½ä»¤ä¸€èµ·æ­é…ä½¿ç”¨ã€‚\nsetfacl å‘½ä»¤å¯ç›´æ¥è®¾å®šç”¨æˆ·æˆ–ç¾¤ç»„å¯¹æŒ‡å®šæ–‡ä»¶çš„è®¿é—®æƒé™ã€‚æ­¤å‘½ä»¤çš„åŸºæœ¬æ ¼å¼ä¸ºï¼š\n[root@localhost ~]# setfacl é€‰é¡¹ æ–‡ä»¶å è¡¨ 1 ç½—åˆ—å‡ºäº†è¯¥å‘½ä»¤å¯ä»¥ä½¿ç”¨çš„æ‰€ç”¨é€‰é¡¹åŠåŠŸèƒ½ã€‚\nè¡¨ 1 setfacl å‘½ä»¤é€‰é¡¹åŠç”¨æ³•\n   é€‰é¡¹ åŠŸèƒ½     -m å‚æ•° è®¾å®š ACL æƒé™ã€‚å¦‚æœæ˜¯ç»™äºˆç”¨æˆ· ACL æƒé™ï¼Œå‚æ•°åˆ™ä½¿ç”¨ \u0026ldquo;u:ç”¨æˆ·å:æƒé™\u0026rdquo; çš„æ ¼å¼ï¼Œä¾‹å¦‚ setfacl -m u:st:rx /project è¡¨ç¤ºè®¾å®š st ç”¨æˆ·å¯¹ project ç›®å½•å…·æœ‰ rx æƒé™ï¼›å¦‚æœæ˜¯ç»™äºˆç»„ ACL æƒé™ï¼Œå‚æ•°åˆ™ä½¿ç”¨ \u0026ldquo;g:ç»„å:æƒé™\u0026rdquo; æ ¼å¼ï¼Œä¾‹å¦‚ setfacl -m g:tgroup:rx /project è¡¨ç¤ºè®¾å®šç¾¤ç»„ tgroup å¯¹ project ç›®å½•å…·æœ‰ rx æƒé™ã€‚   -x å‚æ•° åˆ é™¤æŒ‡å®šç”¨æˆ·ï¼ˆå‚æ•°ä½¿ç”¨ u:ç”¨æˆ·åï¼‰æˆ–ç¾¤ç»„ï¼ˆå‚æ•°ä½¿ç”¨ g:ç¾¤ç»„åï¼‰çš„ ACL æƒé™ï¼Œä¾‹å¦‚ setfacl -x u:st /project è¡¨ç¤ºåˆ é™¤ st ç”¨æˆ·å¯¹ project ç›®å½•çš„ ACL æƒé™ã€‚   -b åˆ é™¤æ‰€æœ‰çš„ ACL æƒé™ï¼Œä¾‹å¦‚ setfacl -b /project è¡¨ç¤ºåˆ é™¤æœ‰å…³ project ç›®å½•çš„æ‰€æœ‰ ACL æƒé™ã€‚   -d è®¾å®šé»˜è®¤ ACL æƒé™ï¼Œå‘½ä»¤æ ¼å¼ä¸º \u0026ldquo;setfacl -m d:u:ç”¨æˆ·å:æƒé™ æ–‡ä»¶å\u0026rdquo;ï¼ˆå¦‚æœæ˜¯ç¾¤ç»„ï¼Œåˆ™ä½¿ç”¨ d:g:ç¾¤ç»„å:æƒé™ï¼‰ï¼Œåªå¯¹ç›®å½•ç”Ÿæ•ˆï¼ŒæŒ‡ç›®å½•ä¸­æ–°å»ºç«‹çš„æ–‡ä»¶æ‹¥æœ‰æ­¤é»˜è®¤æƒé™ï¼Œä¾‹å¦‚ setfacl -m d:u:st:rx /project è¡¨ç¤º st ç”¨æˆ·å¯¹ project ç›®å½•ä¸­æ–°å»ºç«‹çš„æ–‡ä»¶æ‹¥æœ‰ rx æƒé™ã€‚   -R é€’å½’è®¾å®š ACL æƒé™ï¼ŒæŒ‡è®¾å®šçš„ ACL æƒé™ä¼šå¯¹ç›®å½•ä¸‹çš„æ‰€æœ‰å­æ–‡ä»¶ç”Ÿæ•ˆï¼Œå‘½ä»¤æ ¼å¼ä¸º \u0026ldquo;setfacl -m u:ç”¨æˆ·å:æƒé™ -R æ–‡ä»¶å\u0026rdquo;ï¼ˆç¾¤ç»„ä½¿ç”¨ g:ç¾¤ç»„å:æƒé™ï¼‰ï¼Œä¾‹å¦‚ setfacl -m u:st:rx -R /project è¡¨ç¤º st ç”¨æˆ·å¯¹å·²å­˜åœ¨äº project ç›®å½•ä¸­çš„å­æ–‡ä»¶å’Œå­ç›®å½•æ‹¥æœ‰ rx æƒé™ã€‚   -k åˆ é™¤é»˜è®¤ ACL æƒé™ã€‚    setfacl -mï¼šç»™ç”¨æˆ·æˆ–ç¾¤ç»„æ·»åŠ  ACL æƒé™ å›å½’ä¸Šä¸€èŠ‚æ¡ˆä¾‹ï¼Œè§£å†³æ–¹æ¡ˆå¦‚ä¸‹ï¼š\n è€å¸ˆä½¿ç”¨ root ç”¨æˆ·ï¼Œå¹¶ä½œä¸º /project çš„æ‰€æœ‰è€…ï¼Œå¯¹ project ç›®å½•æ‹¥æœ‰ rwx æƒé™ï¼› æ–°å»º tgroup ç¾¤ç»„ï¼Œå¹¶ä½œä¸º project ç›®å½•çš„æ‰€å±ç»„ï¼ŒåŒ…å«æœ¬ç­æ‰€æœ‰çš„ç­çº§å­¦å‘˜ï¼ˆå‡å®šåªæœ‰ zhangsan å’Œ lisiï¼‰ï¼Œæ‹¥æœ‰å¯¹ project çš„ rwx æƒé™ï¼› å°†å…¶ä»–ç”¨æˆ·è®¿é—® project ç›®å½•çš„æƒé™è®¾å®šä¸º 0ï¼ˆä¹Ÿå°±æ˜¯ \u0026mdash;ï¼‰ã€‚ å¯¹äºè¯•å¬å­¦å‘˜ st æ¥è¯´ï¼Œæˆ‘ä»¬å¯¹å…¶è®¾å®š ACL æƒé™ï¼Œä»¤è¯¥ç”¨æˆ·å¯¹ project æ‹¥æœ‰ rx æƒé™ã€‚  å…·ä½“çš„è®¾ç½®å‘½ä»¤å¦‚ä¸‹ï¼š\n[root@localhost ~]# useradd zhangsan [root@localhost ~]# useradd lisi [root@localhost ~]# useradd st [root@localhost ~]# groupadd tgroup \u0026lt;-- æ·»åŠ éœ€è¦è¯•éªŒçš„ç”¨æˆ·å’Œç”¨æˆ·ç»„ï¼Œçœç•¥è®¾å®šå¯†ç çš„è¿‡ç¨‹ [root@localhost ~]# mkdir /project \u0026lt;-- å»ºç«‹éœ€è¦åˆ†é…æƒé™çš„ç›®å½• [root@localhost ~]# chown root:tgroup /project \u0026lt;-- æ”¹å˜/projectç›®å½•çš„æ‰€æœ‰è€…å’Œæ‰€å±ç»„ [root@localhost ~]# chmod 770 /project \u0026lt;-- æŒ‡å®š/projectç›®å½•çš„æƒé™ [root@localhost ~]# ll -d /project drwxrwx---. 2 root tgroup 4096 Apr 16 12:55 /project #è¿™æ—¶stå­¦å‘˜æ¥è¯•å¬äº†ï¼Œå¦‚ä½•ç»™å¥¹åˆ†é…æƒé™ [root@localhost ~]# setfacl -m u:st:rx /project #ç»™ç”¨æˆ·stèµ‹äºˆr-xæƒé™ï¼Œä½¿ç”¨\u0026#34;u:ç”¨æˆ·åï¼šæƒé™\u0026#34; æ ¼å¼ [root@localhost /]# cd / [root@localhost /]# ll -d /project drwxrwx---+ 2 root tgroup 4096 Apr 16 12:55 /project #å¦‚æœæŸ¥è¯¢æ—¶ä¼šå‘ç°ï¼Œåœ¨æƒé™ä½åé¢å¤šäº†ä¸€ä¸ª\u0026#34;+\u0026#34;ï¼Œè¡¨ç¤ºæ­¤ç›®å½•æ‹¥æœ‰ACLæƒé™ [root@localhost /]# getfacl project #æŸ¥çœ‹/prpjectç›®å½•çš„ACLæƒé™ #file:project \u0026lt;--æ–‡ä»¶å #owner:root \u0026lt;--æ–‡ä»¶çš„æ‰€æœ‰è€… #group:tgroup \u0026lt;--æ–‡ä»¶çš„æ‰€å±ç»„ user::rwx \u0026lt;--ç”¨æˆ·åæ æ˜¯ç©ºçš„ï¼Œè¯´æ˜æ˜¯æ‰€æœ‰è€…çš„æƒé™ user:st:r-x \u0026lt;--ç”¨æˆ·stçš„æƒé™ group::rwx \u0026lt;--ç»„åæ æ˜¯ç©ºçš„ï¼Œè¯´æ˜æ˜¯æ‰€å±ç»„çš„æƒé™ mask::rwx \u0026lt;--maskæƒé™ other::--- \u0026lt;--å…¶ä»–äººçš„æƒé™ å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡è®¾å®š ACL æƒé™ï¼Œæˆ‘ä»¬å¯ä»¥å•ç‹¬ç»™ st ç”¨æˆ·åˆ†é… r-x æƒé™ï¼Œè€Œæ— éœ€ç»™ st ç”¨æˆ·è®¾å®šä»»ä½•èº«ä»½ã€‚\nåŒæ ·çš„é“ç†ï¼Œä¹Ÿå¯ä»¥ç»™ç”¨æˆ·ç»„è®¾å®š ACL æƒé™ï¼Œä¾‹å¦‚ï¼š\n[root@localhost /]# groupadd tgroup2 #æ·»åŠ æ–°ç¾¤ç»„ [root@localhost /]# setfacl -m g:tgroup2:rwx project #ä¸ºç»„tgroup2çº·é…ACLæƒé™ [root@localhost /]# ll -d project drwxrwx---+ 2 root tgroup 4096 1æœˆ19 04:21 project #å±ç»„å¹¶æ²¡æœ‰æ›´æ”¹ [root@localhost /]# getfacl project #file: project #owner: root #group: tgroup user::rwx user:st:r-x group::rwx group:tgroup2:rwx \u0026lt;-ç”¨æˆ·ç»„tgroup2æ‹¥æœ‰äº†rwxæƒé™ mask::rwx other::--- setfacl -dï¼šè®¾å®šé»˜è®¤ ACL æƒé™ æ—¢ç„¶å·²ç»å¯¹ project ç›®å½•è®¾å®šäº† ACL æƒé™ï¼Œé‚£ä¹ˆï¼Œå¦‚æœåœ¨è¿™ä¸ªç›®å½•ä¸­æ–°å»ºä¸€äº›å­æ–‡ä»¶å’Œå­ç›®å½•ï¼Œè¿™äº›æ–‡ä»¶æ˜¯å¦ä¼šç»§æ‰¿çˆ¶ç›®å½•çš„ ACL æƒé™å‘¢ï¼Ÿæ‰§è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡ŒéªŒè¯ï¼š\n[root@localhost /]# cd project [root@localhost project]# touch abc [root@localhost project]# mkdir d1 #åœ¨/projectç›®å½•ä¸­æ–°å»ºäº†abcæ–‡ä»¶å’Œd1ç›®å½• [root@localhost project]#ll æ€»ç”¨é‡4 -rw-r--r-- 1 root root 01æœˆ19 05:20 abc drwxr-xr-x 2 root root 4096 1æœˆ19 05:20 d1 å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸¤ä¸ªæ–°å»ºç«‹çš„æ–‡ä»¶æƒé™ä½åé¢å¹¶æ²¡æœ‰ \u0026ldquo;+\u0026quot;ï¼Œè¡¨ç¤ºå®ƒä»¬æ²¡æœ‰ç»§æ‰¿ ACL æƒé™ã€‚è¿™è¯´æ˜ï¼Œåå»ºç«‹çš„å­æ–‡ä»¶æˆ–å­ç›®å½•ï¼Œå¹¶ä¸ä¼šç»§æ‰¿çˆ¶ç›®å½•çš„ ACL æƒé™ã€‚\nå½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹å·¥ç»™è¿™ä¸¤ä¸ªæ–‡ä»¶åˆ†é… ACL æƒé™ï¼Œä½†æ˜¯å¦‚æœåœ¨ç›®å½•ä¸­å†æ–°å»ºæ–‡ä»¶ï¼Œéƒ½è¦æ‰‹å·¥æŒ‡å®šï¼Œåˆ™æ˜¾å¾—è¿‡äºéº»çƒ¦ã€‚è¿™æ—¶å°±éœ€è¦ç”¨åˆ°é»˜è®¤ ACL æƒé™ã€‚\né»˜è®¤ ACL æƒé™çš„ä½œç”¨æ˜¯ï¼Œå¦‚æœç»™çˆ¶ç›®å½•è®¾å®šäº†é»˜è®¤ ACL æƒé™ï¼Œé‚£ä¹ˆçˆ¶ç›®å½•ä¸­æ‰€æœ‰æ–°å»ºçš„å­æ–‡ä»¶éƒ½ä¼šç»§æ‰¿çˆ¶ç›®å½•çš„ ACL æƒé™ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé»˜è®¤ ACL æƒé™åªå¯¹ç›®å½•ç”Ÿæ•ˆã€‚\nä¾‹å¦‚ï¼Œç»™ project æ–‡ä»¶è®¾å®š st ç”¨æˆ·è®¿é—® rx çš„é»˜è®¤ ACL æƒé™ï¼Œå¯æ‰§è¡Œå¦‚ä¸‹æŒ‡ä»¤ï¼š\n[root@localhost /]# setfacl -m d:u:st:rx project [root@localhost project]# getfacl project # file: project # owner: root # group: tgroup user:: rwx user:st:r-x group::rwx group:tgroup2:rwx mask::rwx other::--- default:user::rwx \u0026lt;--å¤šå‡ºäº†defaultå­—æ®µ default:user:st:r-x default:group::rwx default:mask::rwx default:other::--- [root@localhost /]# cd project [root@localhost project]# touch bcd [root@localhost project]# mkdir d2 #æ–°å»ºå­æ–‡ä»¶å’Œå­ç›®å½• [root@localhost project]# ll æ€»ç”¨é‡8 -rw-r--r-- 1 root root 01æœˆ19 05:20 abc -rw-rw----+ 1 root root 01æœˆ19 05:33 bcd drwxr-xr-x 2 root root 4096 1æœˆ19 05:20 d1 drwxrwx---+ 2 root root 4096 1æœˆ19 05:33 d2 #æ–°å»ºçš„bcdå’Œd2å·²ç»ç»§æ‰¿äº†çˆ¶ç›®å½•çš„ACLæƒé™ å¤§å®¶å‘ç°äº†å—ï¼ŸåŸå…ˆçš„ abc å’Œ d1 è¿˜æ˜¯æ²¡æœ‰ ACL æƒé™ï¼Œå› ä¸ºé»˜è®¤ ACL æƒé™æ˜¯é’ˆå¯¹æ–°å»ºç«‹çš„æ–‡ä»¶ç”Ÿæ•ˆçš„ã€‚\nå¯¹ç›®å½•è®¾å®šçš„é»˜è®¤ ACL æƒé™ï¼Œå¯ç›´æ¥ä½¿ç”¨ setfacl -k å‘½ä»¤åˆ é™¤ã€‚ä¾‹å¦‚ï¼š\n[root@localhost /]# setfacl -k project é€šè¿‡æ­¤å‘½ä»¤ï¼Œå³å¯åˆ é™¤ project ç›®å½•çš„é»˜è®¤ ACL æƒé™ï¼Œè¯»è€…å¯è‡ªè¡Œé€šè¿‡ getfacl å‘½ä»¤æŸ¥çœ‹ã€‚ setfacl -Rï¼šè®¾å®šé€’å½’ ACL æƒé™ é€’å½’ ACL æƒé™æŒ‡çš„æ˜¯çˆ¶ç›®å½•åœ¨è®¾å®š ACL æƒé™æ—¶ï¼Œæ‰€æœ‰çš„å­æ–‡ä»¶å’Œå­ç›®å½•ä¹Ÿä¼šæ‹¥æœ‰ç›¸åŒçš„ ACL æƒé™ã€‚\nä¾‹å¦‚ï¼Œç»™ project ç›®å½•è®¾å®š st ç”¨æˆ·è®¿é—®æƒé™ä¸º rx çš„é€’å½’ ACL æƒé™ï¼Œæ‰§è¡Œå‘½ä»¤å¦‚ä¸‹ï¼š\n[root@localhost project]# setfacl -m u:st:rx -R project [root@localhost project]# ll æ€»ç”¨é‡ 8 -rw-r-xr--+ 1 root root 01æœˆ19 05:20 abc -rw-rwx--+ 1 root root 01æœˆ19 05:33 bcd drwxr-xr-x+ 2 root root 4096 1æœˆ19 05:20 d1 drwxrwx---+ 2 root root 4096 1æœˆ19 05:33 d2 #abcå’Œd1ä¹Ÿæ‹¥æœ‰äº†ACLæƒé™ æ³¨æ„ï¼Œé»˜è®¤ ACL æƒé™æŒ‡çš„æ˜¯é’ˆå¯¹çˆ¶ç›®å½•ä¸­åç»­å»ºç«‹çš„æ–‡ä»¶å’Œç›®å½•ä¼šç»§æ‰¿çˆ¶ç›®å½•çš„ ACL æƒé™ï¼›é€’å½’ ACL æƒé™æŒ‡çš„æ˜¯é’ˆå¯¹çˆ¶ç›®å½•ä¸­å·²ç»å­˜åœ¨çš„æ‰€æœ‰å­æ–‡ä»¶å’Œå­ç›®å½•ä¼šç»§æ‰¿çˆ¶ç›®å½•çš„ ACL æƒé™ã€‚ setfacl -xï¼šåˆ é™¤æŒ‡å®šçš„ ACL æƒé™ ä½¿ç”¨ setfacl -x å‘½ä»¤ï¼Œå¯ä»¥åˆ é™¤æŒ‡å®šçš„ ACL æƒé™ï¼Œä¾‹å¦‚ï¼Œåˆ é™¤å‰é¢å»ºç«‹çš„ st ç”¨æˆ·å¯¹ project ç›®å½•çš„ ACL æƒé™ï¼Œæ‰§è¡Œå‘½ä»¤å¦‚ä¸‹ï¼š\n[root@localhost /]# setfacl -x u:st project #åˆ é™¤æŒ‡å®šç”¨æˆ·å’Œç”¨æˆ·ç»„çš„ACLæƒé™ [root@localhost /]# getfacl project # file:project # owner: root # group: tgroup user::rwx group::rwx group:tgroup2:rwx mask::rwx other::--- #stç”¨æˆ·çš„æƒé™å·²è¢«åˆ é™¤ setfacl -bï¼šåˆ é™¤æŒ‡å®šæ–‡ä»¶çš„æ‰€æœ‰ ACL æƒé™ æ­¤å‘½ä»¤å¯åˆ é™¤æ‰€æœ‰ä¸æŒ‡å®šæ–‡ä»¶æˆ–ç›®å½•ç›¸å…³çš„ ACL æƒé™ã€‚ä¾‹å¦‚ï¼Œç°åœ¨æˆ‘ä»¬åˆ é™¤ä¸€åˆ‡ä¸ project ç›®å½•ç›¸å…³çš„ ACL æƒé™ï¼Œæ‰§è¡Œå‘½ä»¤å¦‚ä¸‹ï¼š\n[root@localhost /]# setfacl -b project #ä¼šåˆ é™¤æ–‡ä»¶çš„æ‰€æœ‰ACLæƒé™ [root@localhost /]# getfacl project #file: project #owner: root # group: tgroup user::rwx group::rwx other::--- #æ‰€æœ‰ACLæƒé™å·²è¢«åˆ é™¤ 9. Linux maskæœ‰æ•ˆæƒé™è¯¦è§£ å‰é¢ï¼Œæˆ‘ä»¬å·²ç»å­¦ä¹ å¦‚ä½•ä½¿ç”¨ setfacl å’Œ getfacl ä¸ºç”¨æˆ·æˆ–ç¾¤ç»„æ·»åŠ é’ˆå¯¹æŸç›®å½•æˆ–æ–‡ä»¶çš„ ACL æƒé™ã€‚ä¾‹å¦‚ï¼š\n[root@localhost /]# getfacl project #file: project \u0026lt;-æ–‡ä»¶å #owner: root \u0026lt;-æ–‡ä»¶çš„å±ä¸» #group: tgroup \u0026lt;-æ–‡ä»¶çš„å±ç»„ user::rwx \u0026lt;-ç”¨æˆ·åæ æ˜¯ç©ºçš„ï¼Œè¯´æ˜æ˜¯æ‰€æœ‰è€…çš„æƒé™ group::rwx \u0026lt;-ç»„åæ æ˜¯ç©ºçš„ï¼Œè¯´æ˜æ˜¯æ‰€å±ç»„çš„æƒé™ other::--- \u0026lt;-å…¶ä»–äººçš„æƒé™ [root@localhost ~]# setfacl -m u:st:rx /project #ç»™ç”¨æˆ·stè®¾å®šé’ˆå¯¹projectç›®å½•çš„rxæƒé™ [root@localhost /]# getfacl project #file: project  #owner: root #group: tgroup  user::rwx user:st:r-x \u0026lt;-ç”¨æˆ· st çš„æƒé™ group::rwx mask::rwx \u0026lt;-mask æƒé™ other::--- å¯¹æ¯”æ·»åŠ  ACL æƒé™å‰å getfacl å‘½ä»¤çš„è¾“å‡ºä¿¡æ¯ï¼Œåè€…å¤šäº† 2 è¡Œä¿¡æ¯ï¼Œä¸€è¡Œæ˜¯æˆ‘ä»¬å¯¹ st ç”¨æˆ·è®¾å®šçš„ r-x æƒé™ï¼Œå¦ä¸€è¡Œå°±æ˜¯ mask æƒé™ã€‚\nmask æƒé™ï¼ŒæŒ‡çš„æ˜¯ç”¨æˆ·æˆ–ç¾¤ç»„èƒ½æ‹¥æœ‰çš„æœ€å¤§ ACL æƒé™ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç»™ç”¨æˆ·æˆ–ç¾¤ç»„è®¾å®šçš„ ACL æƒé™ä¸èƒ½è¶…è¿‡ mask è§„å®šçš„æƒé™èŒƒå›´ï¼Œè¶…å‡ºéƒ¨åˆ†åšæ— æ•ˆå¤„ç†ã€‚\nä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœåƒä¸Šé¢å‘½ä»¤é‚£æ ·ï¼Œç»™ st ç”¨æˆ·èµ‹äºˆè®¿é—® project ç›®å½•çš„ r-x æƒé™ï¼Œæ­¤æ—¶å¹¶ä¸èƒ½è¯´æ˜ st ç”¨æˆ·å°±æ‹¥æœ‰äº†å¯¹è¯¥ç›®å½•çš„è¯»å’Œè®¿é—®æƒé™ï¼Œè¿˜éœ€è¦å’Œ mask æƒé™å¯¹æ¯”ï¼Œr-x ç¡®å®æ˜¯åœ¨ rwx èŒƒå›´å†…ï¼Œè¿™æ—¶æ‰èƒ½è¯´ st ç”¨æˆ·æ‹¥æœ‰ r-x æƒé™ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œå°†æƒé™è¿›è¡Œå¯¹æ¯”çš„è¿‡ç¨‹ï¼Œå®åˆ™æ˜¯å°†ä¸¤æƒé™åšâ€œæŒ‰ä½ç›¸ä¸â€è¿ç®—ï¼Œæœ€ç»ˆå¾—å‡ºçš„å€¼ï¼Œå³ä¸º st ç”¨æˆ·æœ‰æ•ˆçš„ ACL æƒé™ã€‚è¿™é‡Œä»¥è¯»ï¼ˆrï¼‰æƒé™ä¸ºä¾‹ï¼Œåšç›¸ä¸æ“ä½œçš„ç»“æœå¦‚è¡¨ 1 æ‰€ç¤ºï¼š\nè¡¨ 1 è¯»æƒé™åšç›¸ä¸æ“ä½œ\n   A B and     r r r   r - -   - r -   - - -    ä½†æ˜¯ï¼Œå¦‚æœæŠŠ mask æƒé™æ”¹ä¸º r\u0026ndash;ï¼Œå†å’Œ st ç”¨æˆ·çš„æƒé™ r-x æ¯”å¯¹ï¼ˆr\u0026ndash; å’Œ r-w åšä¸è¿ç®—ï¼‰ï¼Œç”±äº r-w è¶…å‡º r\u0026ndash; çš„æƒé™èŒƒå›´ï¼Œå› æ­¤ st ç”¨æˆ·æœ€ç»ˆåªæœ‰ r æƒé™ï¼Œæ‰‹åŠ¨èµ‹äºˆçš„ w æƒé™æ— æ•ˆã€‚è¿™å°±æ˜¯åœ¨è®¾å®š ACL æƒé™æ—¶ mask æƒé™çš„ä½œç”¨ã€‚\nå¤§å®¶å¯ä»¥è¿™æ ·ç†è§£ mask æƒé™çš„åŠŸèƒ½ï¼Œå®ƒå°†ç”¨æˆ·æˆ–ç¾¤ç»„æ‰€è®¾å®šçš„ ACL æƒé™é™åˆ¶åœ¨ mask è§„å®šçš„èŒƒå›´å†…ï¼Œè¶…å‡ºéƒ¨åˆ†ç›´æ¥å¤±æ•ˆã€‚\nmask æƒé™å¯ä»¥ä½¿ç”¨ setfacl å‘½ä»¤æ‰‹åŠ¨æ›´æ”¹ï¼Œæ¯”å¦‚ï¼Œæ›´æ”¹ project ç›®å½• mask æƒé™å€¼ä¸º r-xï¼Œå¯æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š\n[root@localhost ~]# setfacl -m m:rx /project #è®¾å®šmaskæƒé™ä¸ºr-xï¼Œä½¿ç”¨\u0026#34;m:æƒé™\u0026#34;æ ¼å¼ [root@localhost ~]# getfacl /project #fileï¼šproject #ownerï¼šroot #groupï¼štgroup user::rwx group::rwx mask::r-x \u0026lt;--maskæƒé™å˜ä¸ºr-x other::--- ä¸è¿‡ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¸æ›´æ”¹ mask æƒé™ï¼Œåªè¦èµ‹äºˆ mask æœ€å¤§æƒé™ï¼ˆä¹Ÿå°±æ˜¯ rwxï¼‰ï¼Œåˆ™ç»™ç”¨æˆ·æˆ–ç¾¤ç»„è®¾å®šçš„ ACL æƒé™æœ¬èº«å°±æ˜¯æœ‰æ•ˆçš„ã€‚\n10. Linux SetUIDï¼ˆSUIDï¼‰æ–‡ä»¶ç‰¹æ®Šæƒé™ç”¨æ³•è¯¦è§£ åœ¨è®²è§£ã€Šæƒé™ä½ã€‹ä¸€èŠ‚æ—¶æåˆ°è¿‡ï¼Œå…¶å®é™¤äº† rwx æƒé™ï¼Œè¿˜ä¼šç”¨åˆ° s æƒé™ï¼Œä¾‹å¦‚ï¼š\n[root@localhost ~]# ls -l /usr/bin/passwd -rwsr-xr-x. 1 root root 22984 Jan 7 2007 /usr/bin/passwd å¯ä»¥çœ‹åˆ°ï¼ŒåŸæœ¬è¡¨ç¤ºæ–‡ä»¶æ‰€æœ‰è€…æƒé™ä¸­çš„ x æƒé™ä½ï¼Œå´å‡ºç°äº† s æƒé™ï¼Œæ­¤ç§æƒé™é€šå¸¸ç§°ä¸º SetUIDï¼Œç®€ç§° SUID ç‰¹æ®Šæƒé™ã€‚\nSUID ç‰¹æ®Šæƒé™ä»…é€‚ç”¨äºå¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ‰€å…·æœ‰çš„åŠŸèƒ½æ˜¯ï¼Œåªè¦ç”¨æˆ·å¯¹è®¾æœ‰ SUID çš„æ–‡ä»¶æœ‰æ‰§è¡Œæƒé™ï¼Œé‚£ä¹ˆå½“ç”¨æˆ·æ‰§è¡Œæ­¤æ–‡ä»¶æ—¶ï¼Œä¼šä»¥æ–‡ä»¶æ‰€æœ‰è€…çš„èº«ä»½å»æ‰§è¡Œæ­¤æ–‡ä»¶ï¼Œä¸€æ—¦æ–‡ä»¶æ‰§è¡Œç»“æŸï¼Œèº«ä»½çš„åˆ‡æ¢ä¹Ÿéšä¹‹æ¶ˆå¤±ã€‚\nä¸¾ä¸€ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒLinux ç³»ç»Ÿä¸­æ‰€æœ‰ç”¨æˆ·çš„å¯†ç æ•°æ®éƒ½è®°å½•åœ¨ /etc/shadow è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œé€šè¿‡ ll /etc/shadow å‘½ä»¤å¯ä»¥çœ‹åˆ°ï¼Œæ­¤æ–‡ä»¶çš„æƒé™æ˜¯ 0ï¼ˆ\u0026mdash;\u0026mdash;\u0026mdash;ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ™®é€šç”¨æˆ·å¯¹æ­¤æ–‡ä»¶æ²¡æœ‰ä»»ä½•æ“ä½œæƒé™ã€‚\nè¿™å°±ä¼šäº§ç”Ÿä¸€ä¸ªé—®é¢˜ï¼Œä¸ºä»€ä¹ˆæ™®é€šç”¨æˆ·å¯ä»¥ä½¿ç”¨ passwd å‘½ä»¤ä¿®æ”¹è‡ªå·±çš„å¯†ç å‘¢ï¼Ÿ\næœ¬èŠ‚å¼€å¤´å·²ç»æ˜¾ç¤ºäº† passwd å‘½ä»¤çš„æƒé™é…ç½®ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œæ­¤å‘½ä»¤æ‹¥æœ‰ SUID ç‰¹æ®Šæƒé™ï¼Œè€Œä¸”å…¶ä»–äººå¯¹æ­¤æ–‡ä»¶ä¹Ÿæœ‰æ‰§è¡Œæƒé™ï¼Œè¿™å°±æ„å‘³ç€ï¼Œä»»ä½•ä¸€ä¸ªç”¨æˆ·éƒ½å¯ä»¥ç”¨æ–‡ä»¶æ‰€æœ‰è€…ï¼Œä¹Ÿå°±æ˜¯ root çš„èº«ä»½å»æ‰§è¡Œ passwd å‘½ä»¤ã€‚ Linux ç³»ç»Ÿä¸­ï¼Œç»å¯¹å¤šæ•°å‘½ä»¤çš„æ–‡ä»¶æ‰€æœ‰è€…é»˜è®¤éƒ½æ˜¯ rootã€‚\næ¢å¥è¯è¯´ï¼Œå½“æ™®é€šç”¨æˆ·ä½¿ç”¨ passwd å‘½ä»¤å°è¯•æ›´æ”¹è‡ªå·±çš„å¯†ç æ—¶ï¼Œå®é™…ä¸Šæ˜¯åœ¨ä»¥ root çš„èº«ä»½æ‰§è¡Œpasswdå‘½ä»¤ï¼Œæ­£å› ä¸º root å¯ä»¥å°†å¯†ç å†™å…¥ /etc/shadow æ–‡ä»¶ï¼Œæ‰€ä»¥æ™®é€šç”¨æˆ·ä¹Ÿèƒ½åšåˆ°ã€‚åªä¸è¿‡ï¼Œä¸€æ—¦å‘½ä»¤æ‰§è¡Œå®Œæˆï¼Œæ™®é€šç”¨æˆ·æ‰€å…·æœ‰çš„ rootèº«ä»½ä¹Ÿéšä¹‹æ¶ˆå¤±ã€‚\nå¦‚æœæˆ‘ä»¬æ‰‹åŠ¨å°† /usr/bin/passwd æ–‡ä»¶çš„ SUID æƒé™å–æ¶ˆï¼Œä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿè§‚å¯Ÿå¦‚ä¸‹å‘½ä»¤çš„æ‰§è¡Œè¿‡ç¨‹ï¼š\n[root@localhost ~]# chmod u-s /usr/bin/passwd #å±ä¸»å–æ¶ˆSetUIDæƒé™ [root@localhost ~]# ll /usr/bin/passwd -rwxr-xr-x. 1 root root 30768 Feb 22 2012 /usr/bin/passwd [root@localhost ~]# su - lamp [lamp@localhost ~]$ passwd Changing password for user lamp. Changing password for user. (current) UNIX password: #çœ‹èµ·æ¥æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ New passwor: Retype new password: password:Authentication token manipulation error \u0026lt;--é‰´å®šä»¤ç‰Œæ“ä½œé”™è¯¯ #æœ€åå¯†ç æ²¡æœ‰ç”Ÿæ•ˆ æ˜¾ç„¶ï¼Œè™½ç„¶ç”¨æˆ·æœ‰æ‰§è¡Œ passwd å‘½ä»¤çš„æƒé™ï¼Œä½†æ— ä¿®æ”¹ /etc/shadow æ–‡ä»¶çš„æƒé™ï¼Œå› æ­¤æœ€ç»ˆå¯†ç ä¿®æ”¹å¤±è´¥ã€‚ æ³¨æ„ï¼Œå®éªŒå®Œæˆåï¼Œä¸€å®šè¦å†æŠŠ /usr/bin/passwd æ–‡ä»¶çš„ SetUID æƒé™åŠ ä¸Šã€‚\né‚£ä¹ˆï¼Œæ™®é€šç”¨æˆ·å¯ä»¥ä½¿ç”¨ cat å‘½ä»¤æŸ¥çœ‹ /etc/shadow æ–‡ä»¶å—ï¼Ÿç­”æ¡ˆçš„å¦å®šçš„ï¼Œå› ä¸º cat ä¸å…·æœ‰ SUID æƒé™ï¼Œå› æ­¤æ™®é€šç”¨æˆ·åœ¨æ‰§è¡Œ cat /etc/shadow å‘½ä»¤æ—¶ï¼Œæ— æ³•ä»¥ root çš„èº«ä»½ï¼Œåªèƒ½ä»¥æ™®é€šç”¨æˆ·çš„èº«ä»½ï¼Œå› æ­¤æ— æ³•æˆåŠŸè¯»å–ã€‚\næˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢è¿™å¼ å›¾æ¥æè¿°ä¸Šè¿°è¿‡ç¨‹ï¼š ç”±æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æ€»ç»“å‡ºï¼ŒSUID ç‰¹æ®Šæƒé™å…·æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š åªæœ‰å¯æ‰§è¡Œæ–‡ä»¶æ‰èƒ½è®¾å®š SetUID æƒé™ï¼Œå¯¹ç›®å½•è®¾å®š SUIDï¼Œæ˜¯æ— æ•ˆçš„ã€‚ ç”¨æˆ·è¦å¯¹è¯¥æ–‡ä»¶æ‹¥æœ‰ xï¼ˆæ‰§è¡Œï¼‰æƒé™ã€‚ ç”¨æˆ·åœ¨æ‰§è¡Œè¯¥æ–‡ä»¶æ—¶ï¼Œä¼šä»¥æ–‡ä»¶æ‰€æœ‰è€…çš„èº«ä»½æ‰§è¡Œã€‚ SetUID æƒé™åªåœ¨æ–‡ä»¶æ‰§è¡Œè¿‡ç¨‹ä¸­æœ‰æ•ˆï¼Œä¸€æ—¦æ‰§è¡Œå®Œæ¯•ï¼Œèº«ä»½çš„åˆ‡æ¢ä¹Ÿéšä¹‹æ¶ˆå¤±ã€‚\n11. SetUIDï¼ˆSUIDï¼‰åƒä¸‡ä¸è¦èƒ¡ä¹±ä½¿ç”¨ï¼ SetUIDæƒé™è®¾ç½®ä¸å½“ï¼Œä¼šç»™ Linux ç³»ç»Ÿé€ æˆé‡å¤§å®‰å…¨éšæ‚£ã€‚\nå‰é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬è¯•éªŒäº†å°† passwd å‘½ä»¤å–æ¶ˆ SUID æƒé™ï¼Œè¿™ä¼šå¯¼è‡´ passwd å‘½ä»¤çš„åŠŸèƒ½å¤±æ•ˆã€‚é‚£ä¹ˆï¼Œå¦‚æœæˆ‘ä»¬æ‰‹åŠ¨ç»™é»˜è®¤æ—  SetUID æƒé™çš„ç³»ç»Ÿå‘½ä»¤èµ‹äºˆ SetUID æƒé™ï¼Œä¼šå‡ºç°ä»€ä¹ˆæƒ…å†µå‘¢ï¼Ÿ\næ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬å°è¯•ç»™ Vim èµ‹äºˆ SetUID æƒé™ï¼š\n[root@localhost ~]# chmod u+s /usr/bin/vim [root@localhost ~]# ll /usr/bin/vim -rwsr-xr-x. 1 root root 1847752 Apr 5 2012 /usr/bin/vim æ­¤æ—¶ä½ ä¼šå‘ç°ï¼Œå³ä¾¿æ˜¯æ™®é€šç”¨æˆ·ä½¿ç”¨ vim å‘½ä»¤ï¼Œéƒ½ä¼šæš‚æ—¶è·å¾— root çš„èº«ä»½å’Œæƒé™ï¼Œä¾‹å¦‚ï¼Œå¾ˆå¤šåŸæœ¬æ™®é€šç”¨æˆ·ä¸èƒ½æŸ¥çœ‹å’Œä¿®æ”¹çš„æ–‡ä»¶ï¼Œç«Ÿç„¶å¯ä»¥æŸ¥çœ‹äº†ï¼Œä»¥ /etc/passwd å’Œ /etc/shadow æ–‡ä»¶ä¸ºä¾‹ï¼Œæ™®é€šç”¨æˆ·ä¹Ÿå¯ä»¥å°†è‡ªå·±çš„ UID æ‰‹åŠ¨ä¿®æ”¹ä¸º 0ï¼Œè¿™æ„å‘³ç€ï¼Œæ­¤ç”¨æˆ·å‡çº§æˆä¸ºäº†è¶…çº§ç”¨æˆ·ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæ™®é€šç”¨æˆ·è¿˜å¯ä»¥ä¿®æ”¹ä¾‹å¦‚ /etc/inittab å’Œ /etc/fstab è¿™æ ·é‡è¦çš„ç³»ç»Ÿæ–‡ä»¶ï¼Œå¯ä»¥è½»æ˜“åœ°ä½¿ç³»ç»Ÿç˜«ç—ªã€‚\nå…¶å®ï¼Œä»»ä½•åªæœ‰ç®¡ç†å‘˜å¯ä»¥æ‰§è¡Œçš„å‘½ä»¤ï¼Œå¦‚æœè¢«èµ‹äºˆäº† SetUID æƒé™ï¼Œé‚£ä¹ˆåæœéƒ½æ˜¯ç¾éš¾æ€§çš„ã€‚æ™®é€šç”¨æˆ·å¯ä»¥éšæ—¶é‡å¯æœåŠ¡å™¨ã€éšæ—¶å…³é—­çœ‹å¾—ä¸é¡ºçœ¼çš„æœåŠ¡ã€éšæ—¶æ·»åŠ å…¶ä»–æ™®é€šç”¨æˆ·çš„æœåŠ¡å™¨ï¼Œå¯ä»¥æƒ³è±¡æ˜¯ä»€ä¹ˆæ ·å­ã€‚æ‰€ä»¥ï¼ŒSetUID æƒé™ä¸èƒ½éšä¾¿è®¾ç½®ã€‚\næœ‰è¯»è€…å¯èƒ½ä¼šé—®ï¼Œå¦‚ä½•é˜²æ­¢ä»–äººï¼ˆä¾‹å¦‚é»‘å®¢ï¼‰å¯¹ SetUID æƒé™çš„æ¶æ„ç¯¡æ”¹å‘¢ï¼Ÿè¿™é‡Œï¼Œç»™å¤§å®¶æä¾›ä»¥ä¸‹å‡ ç‚¹å»ºè®®ï¼š å…³é”®ç›®å½•è¦ä¸¥æ ¼æ§åˆ¶å†™æƒé™ï¼Œæ¯”å¦‚ \u0026ldquo;/\u0026quot;ã€\u0026quot;/usr\u0026rdquo; ç­‰ã€‚ ç”¨æˆ·çš„å¯†ç è®¾ç½®è¦ä¸¥æ ¼éµå®ˆå¯†ç è§„èŒƒã€‚ å¯¹ç³»ç»Ÿä¸­é»˜è®¤åº”è¯¥æœ‰ SetUID æƒé™çš„æ–‡ä»¶åˆ¶ä½œä¸€å¼ åˆ—è¡¨ï¼Œå®šæ—¶æ£€æŸ»æœ‰æ²¡æœ‰åˆ—è¡¨ä¹‹å¤–çš„æ–‡ä»¶è¢«è®¾ç½®äº† SetUID æƒé™ã€‚\nå‰é¢ 2 ç‚¹ä¸å†åšè¿‡å¤šè§£é‡Šï¼Œè¿™é‡Œå°±æœ€åä¸€ç‚¹ï¼Œç»™å¤§å®¶æä¾›ä¸€ä¸ªè„šæœ¬ï¼Œä»…ä¾›å‚è€ƒã€‚\né¦–å…ˆï¼Œåœ¨æœåŠ¡å™¨ç¬¬ä¸€æ¬¡å®‰è£…å®Œæˆåï¼Œé©¬ä¸ŠæŸ¥æ‰¾ç³»ç»Ÿä¸­æ‰€æœ‰æ‹¥æœ‰ SetUID å’Œ SetGID æƒé™çš„æ–‡ä»¶ï¼ŒæŠŠå®ƒä»¬è®°å½•ä¸‹æ¥ï¼Œä½œä¸ºæ‰«æçš„å‚è€ƒæ¨¡æ¿ã€‚å¦‚æœæŸæ¬¡æ‰«æçš„ç»“æœå’Œæœ¬æ¬¡ä¿å­˜ä¸‹æ¥çš„æ¨¡æ¿ä¸ä¸€è‡´ï¼Œå°±è¯´æ˜æœ‰æ–‡ä»¶è¢«ä¿®æ”¹äº† SetUID å’Œ SetGID æƒé™ã€‚å‘½ä»¤å¦‚ä¸‹ï¼š\n[root@localhost ~]# find / -perm -4000 -o -perm -2000 \u0026gt; /root/suid.list #-permå®‰è£…æƒé™æŸ»æ‰¾ã€‚-4000å¯¹åº”çš„æ˜¯SetUIDæƒé™ï¼Œ-2000å¯¹åº”çš„æ˜¯SetGIDæƒé™ #-oæ˜¯é€»è¾‘æˆ–\u0026#34;or\u0026#34;çš„æ„æ€ã€‚å¹¶æŠŠå‘½ä»¤æœç´¢çš„ç»“æœæ”¾åœ¨/root/suid.listæ–‡ä»¶ä¸­ æ¥ä¸‹æ¥ï¼Œåªè¦å®šæ—¶æ‰«æç³»ç»Ÿï¼Œç„¶åå’Œæ¨¡æ¿æ–‡ä»¶æ¯”å¯¹å°±å¯ä»¥äº†ã€‚è„šæœ¬å¦‚ä¸‹ï¼š\n[root@localhost ~]#vi suidcheck.sh #!/bin/bash find / -perm -4000 -o -perm -2000 \u0026gt; /tmp/setuid.check #æœç´¢ç³»ç»Ÿä¸­æ‰€æœ‰æ‹¥æœ‰SetUIDå’ŒSetGIDæƒé™çš„æ–‡ä»¶ï¼Œå¹¶ä¿å­˜åˆ°ä¸´æ—¶ç›®å½•ä¸­ for i in $(cat /tmp/setuid.check) #å¾ªç¯ï¼Œæ¯æ¬¡å¾ªç¯éƒ½å–å‡ºä¸´æ—¶æ–‡ä»¶ä¸­çš„æ–‡ä»¶å do grep $i /root/suid.list \u0026gt; /dev/null #æ¯”å¯¹è¿™ä¸ªæ–‡ä»¶åæ˜¯å¦åœ¨æ¨¡æ¿æ–‡ä»¶ä¸­ if [\u0026#34;$?\u0026#34;!=\u0026#34;o\u0026#34;] #æ£€æµ‹æµ‹ä¸Šä¸€æ¡å‘½ä»¤çš„è¿”å›å€¼ï¼Œå¦‚æœä¸ä¸º0ï¼Œåˆ™è¯æ˜ä¸Šä¸€æ¡å‘½ä»¤æŠ¥é”™ then echo \u0026#34;$iisn\u0026#39;t in listfile! \u0026#34; \u0026gt;\u0026gt;/root/suid_log_$(date +%F) #å¦‚æœæ–‡ä»¶åä¸åœ¨æ¨¡æ¿æ–‡ä»¶ä¸­ï¼Œåˆ™è¾“å‡ºé”™è¯¯ä¿¡æ¯ï¼Œå¹¶æŠŠæŠ¥é”™å†™å…¥æ—¥å¿—ä¸­ fi done rm -rf/tmp/setuid.check #åˆ é™¤ä¸´æ—¶æ–‡ä»¶ [root@localhost ~]# chmod u+s /bin/vi #æ‰‹å·¥ç»™viåŠ å…¥SetUIDæƒé™ [root@localhost ~]# ./suidcheck.sh #æ‰§è¡Œæ£€æµ‹è„šæœ¬ [root@localhost ~]# cat suid_log_2013-01-20 /bin/vi isn\u0026#39;t in listfile! #æŠ¥é”™äº†ï¼Œviä¸åœ¨æ¨¡æ¿æ–‡ä»¶ä¸­ã€‚ä»£è¡¨viè¢«ä¿®æ”¹äº†SetUIDæƒé™ è¿™ä¸ªè„šæœ¬æˆåŠŸçš„å…³é”®åœ¨äºæ¨¡æ¿æ–‡ä»¶æ˜¯å¦æ­£å¸¸ã€‚æ‰€ä»¥ä¸€å®šè¦å®‰è£…å®Œç³»ç»Ÿå°±é©¬ä¸Šå»ºç«‹æ¨¡æ¿æ–‡ä»¶ï¼Œå¹¶ä¿è¯æ¨¡æ¿æ–‡ä»¶çš„å®‰å…¨ã€‚\næ³¨æ„ï¼Œé™¤éç‰¹æ®Šæƒ…å†µï¼Œå¦åˆ™ä¸è¦æ‰‹å·¥ä¿®æ”¹ SetUID å’Œ SetGID æƒé™ï¼Œè¿™æ ·åšéå¸¸ä¸å®‰å…¨ã€‚è€Œä¸”å°±ç®—æˆ‘ä»¬åšå®éªŒä¿®æ”¹äº† SetUID å’Œ SetGID æƒé™ï¼Œä¹Ÿè¦é©¬ä¸Šä¿®æ”¹å›æ¥ï¼Œä»¥å…é€ æˆå®‰å…¨éšæ‚£ã€‚ SetGID ç‰¹æ®Šæƒé™çš„ç›¸å…³å†…å®¹ï¼Œä¸‹èŠ‚ä¼šåšè¯¦ç»†ä»‹ç»ã€‚\n12. Linux SetGIDï¼ˆSGIDï¼‰æ–‡ä»¶ç‰¹æ®Šæƒé™ç”¨æ³•è¯¦è§£ å‰é¢å­¦ä¹ äº† SetUIDï¼Œé‚£ä¹ˆï¼Œä»€ä¹ˆæ˜¯ SetGID å‘¢ï¼Ÿå¾ˆç®€å•ï¼Œå½“ s æƒé™ä½äºæ‰€å±ç»„çš„ x æƒé™ä½æ—¶ï¼Œå°±è¢«ç§°ä¸º SetGIDï¼Œç®€ç§° SGID ç‰¹æ®Šæƒé™ã€‚ä¾‹å¦‚ï¼š\n[root@localhost ~]# ll /usr/bin/locate -rwx--s--x. 1 root slocate 35612 8æœˆ24 2010 /usr/bin/locate ä¸ SUID ä¸åŒçš„æ˜¯ï¼ŒSGID æ—¢å¯ä»¥å¯¹æ–‡ä»¶è¿›è¡Œé…ç½®ï¼Œä¹Ÿå¯ä»¥å¯¹ç›®å½•è¿›è¡Œé…ç½®ã€‚ SetGIDï¼ˆSGIDï¼‰å¯¹æ–‡ä»¶çš„ä½œç”¨ åŒ SUID ç±»ä¼¼ï¼Œå¯¹äºæ–‡ä»¶æ¥è¯´ï¼ŒSGID å…·æœ‰å¦‚ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š SGID åªé’ˆå¯¹å¯æ‰§è¡Œæ–‡ä»¶æœ‰æ•ˆï¼Œæ¢å¥è¯è¯´ï¼Œåªæœ‰å¯æ‰§è¡Œæ–‡ä»¶æ‰å¯ä»¥è¢«èµ‹äºˆ SGID æƒé™ï¼Œæ™®é€šæ–‡ä»¶èµ‹äºˆ SGID æ²¡æœ‰æ„ä¹‰ã€‚ ç”¨æˆ·éœ€è¦å¯¹æ­¤å¯æ‰§è¡Œæ–‡ä»¶æœ‰ x æƒé™ï¼› ç”¨æˆ·åœ¨æ‰§è¡Œå…·æœ‰ SGID æƒé™çš„å¯æ‰§è¡Œæ–‡ä»¶æ—¶ï¼Œç”¨æˆ·çš„ç¾¤ç»„èº«ä»½ä¼šå˜ä¸ºæ–‡ä»¶æ‰€å±ç¾¤ç»„ï¼› SGID æƒé™èµ‹äºˆç”¨æˆ·æ”¹å˜ç»„èº«ä»½çš„æ•ˆæœï¼Œåªåœ¨å¯æ‰§è¡Œæ–‡ä»¶è¿è¡Œè¿‡ç¨‹ä¸­æœ‰æ•ˆï¼› å…¶å®ï¼ŒSGID å’Œ SUID çš„ä¸åŒä¹‹å¤„å°±åœ¨äºï¼ŒSUID èµ‹äºˆç”¨æˆ·çš„æ˜¯æ–‡ä»¶æ‰€æœ‰è€…çš„æƒé™ï¼Œè€Œ SGID èµ‹äºˆç”¨æˆ·çš„æ˜¯æ–‡ä»¶æ‰€å±ç»„çš„æƒé™ï¼Œå°±è¿™ä¹ˆç®€å•ã€‚\nå°±ä»¥æœ¬èŠ‚å¼€å¤´çš„ locate å‘½ä»¤ä¸ºä¾‹ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œ/usr/bin/locate æ–‡ä»¶è¢«èµ‹äºˆäº† SGID çš„ç‰¹æ®Šæƒé™ï¼Œè¿™å°±æ„å‘³ç€ï¼Œå½“æ™®é€šç”¨æˆ·ä½¿ç”¨ locate å‘½ä»¤æ—¶ï¼Œè¯¥ç”¨æˆ·çš„æ‰€å±ç»„ä¼šç›´æ¥å˜ä¸º locate å‘½ä»¤çš„æ‰€å±ç»„ï¼Œä¹Ÿå°±æ˜¯ slocateã€‚\næˆ‘ä»¬çŸ¥é“ï¼Œlocate å‘½ä»¤æ˜¯ç”¨äºåœ¨ç³»ç»Ÿä¸­æŒ‰ç…§æ–‡ä»¶åæŸ¥æ‰¾ç¬¦åˆæ¡ä»¶çš„æ–‡ä»¶çš„ï¼Œå½“æ‰§è¡Œæœç´¢æ“ä½œæ—¶ï¼Œå®ƒä¼šé€šè¿‡æœç´¢ /var/lib/mlocate/mlocate.db è¿™ä¸ªæ•°æ®åº“ä¸­çš„æ•°æ®æ‰¾åˆ°ç­”æ¡ˆï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æ­¤æ•°æ®åº“çš„æƒé™ï¼š\n[root@localhost ~]# ll /var/lib/mlocate/mlocate.db -rw-r-----. 1 root slocate 1838850 1æœˆ20 04:29 /var/lib/mlocate/mlocate.db å¯ä»¥çœ‹åˆ°ï¼Œmlocate.db æ–‡ä»¶çš„æ‰€å±ç»„ä¸º slocateï¼Œè™½ç„¶å¯¹æ–‡ä»¶åªæ‹¥æœ‰ r æƒé™ï¼Œä½†å¯¹äºæ™®é€šç”¨æˆ·æ‰§è¡Œ locate å‘½ä»¤æ¥è¯´ï¼Œå·²ç»è¶³å¤Ÿäº†ã€‚ä¸€æ–¹é¢ï¼Œæ™®é€šç”¨æˆ·å¯¹ locateå‘½ä»¤æ‹¥æœ‰æ‰§è¡Œæƒé™ï¼Œå…¶æ¬¡ï¼Œlocate å‘½ä»¤æ‹¥æœ‰ SGID æƒé™ï¼Œè¿™ä½¿å¾—æ™®é€šç”¨æˆ·åœ¨æ‰§è¡Œ locate å‘½ä»¤æ—¶ï¼Œæ‰€å±ç»„èº«ä»½ä¼šå˜ä¸º slocateï¼Œè€Œ slocate å¯¹ mlocate.db æ•°æ®åº“æ–‡ä»¶æ‹¥æœ‰ r æƒé™ï¼Œæ‰€ä»¥å³ä¾¿æ˜¯æ™®é€šç”¨æˆ·ï¼Œä¹Ÿå¯ä»¥æˆåŠŸæ‰§è¡Œ locate å‘½ä»¤ã€‚ å†æ¬¡å¼ºè°ƒï¼Œæ— è®ºæ˜¯ SUIDï¼Œè¿˜æ˜¯ SGIDï¼Œå®ƒä»¬å¯¹ç”¨æˆ·èº«ä»½çš„è½¬æ¢ï¼Œåªæœ‰åœ¨å‘½ä»¤æ‰§è¡Œçš„è¿‡ç¨‹ä¸­æœ‰æ•ˆï¼Œä¸€æ—¦å‘½ä»¤æ‰§è¡Œå®Œæ¯•ï¼Œèº«ä»½è½¬æ¢ä¹Ÿéšä¹‹å¤±æ•ˆã€‚\nSetGIDï¼ˆSGIDï¼‰å¯¹ç›®å½•çš„ä½œç”¨ äº‹å®ä¸Šï¼ŒSGID ä¹Ÿèƒ½ä½œç”¨äºç›®å½•ï¼Œä¸”è¿™ç§ç”¨æ³•å¾ˆå¸¸è§ã€‚\nå½“ä¸€ä¸ªç›®å½•è¢«èµ‹äºˆ SGID æƒé™åï¼Œè¿›å…¥æ­¤ç›®å½•çš„æ™®é€šç”¨æˆ·ï¼Œå…¶æœ‰æ•ˆç¾¤ç»„ä¼šå˜ä¸ºè¯¥ç›®å½•çš„æ‰€å±ç»„ï¼Œä¼šå°±ä½¿å¾—ç”¨æˆ·åœ¨åˆ›å»ºæ–‡ä»¶ï¼ˆæˆ–ç›®å½•ï¼‰æ—¶ï¼Œè¯¥æ–‡ä»¶ï¼ˆæˆ–ç›®å½•ï¼‰çš„æ‰€å±ç»„å°†ä¸å†æ˜¯ç”¨æˆ·çš„æ‰€å±ç»„ï¼Œè€Œä½¿ç”¨çš„æ˜¯ç›®å½•çš„æ‰€å±ç»„ã€‚\nä¹Ÿå°±æ˜¯è¯´ï¼Œåªæœ‰å½“æ™®é€šç”¨æˆ·å¯¹å…·æœ‰ SGID æƒé™çš„ç›®å½•æœ‰ rwx æƒé™æ—¶ï¼ŒSGID çš„åŠŸèƒ½æ‰èƒ½å®Œå…¨å‘æŒ¥ã€‚æ¯”å¦‚è¯´ï¼Œå¦‚æœç”¨æˆ·å¯¹è¯¥ç›®å½•ä»…æœ‰ rx æƒé™ï¼Œåˆ™ç”¨æˆ·è¿›å…¥æ­¤ç›®å½•åï¼Œè™½ç„¶å…¶æœ‰æ•ˆç¾¤ç»„å˜ä¸ºæ­¤ç›®å½•çš„æ‰€å±ç»„ï¼Œä½†ç”±äºæ²¡æœ‰ x æƒé™ï¼Œç”¨æˆ·æ— æ³•åœ¨ç›®å½•ä¸­åˆ›å»ºæ–‡ä»¶æˆ–ç›®å½•ï¼ŒSGID æƒé™ä¹Ÿå°±æ— æ³•å‘æŒ¥å®ƒçš„ä½œç”¨ã€‚\nä¸¾ä¸ªä¾‹å­ï¼š\n[root@localhost ~]# cd /tmp #è¿›å…¥ä¸´æ—¶ç›®å½•åšæ­¤å®éªŒã€‚å› ä¸ºåªæœ‰ä¸´æ—¶ç›®å½•æ‰å…è®¸æ™®é€šç”¨æˆ·ä¿®æ”¹ [root@localhost tmp]# mkdir dtest #å»ºç«‹æµ‹è¯•ç›®å½• [root@localhost tmp]# chmod g+s dtest #ç»™æµ‹è¯•ç›®å½•èµ‹äºˆSetGIDæƒé™ [root@localhost tmp]# ll -d dtest drwxr-sr-x 2 root root 4096 Apr 19 06:04 dtest #SetGIDæƒé™å·²ç»ç”Ÿæ•ˆ [root@localhost tmp]# chmod 777 dtest #ç»™æµ‹è¯•ç›®å½•èµ‹äºˆ777æƒé™ï¼Œè®©æ™®é€šç”¨æˆ·å¯ä»¥å†™ [root@localhost tmp]# su - lamp [lamp@localhost ~]# grep lamp /etc/passwd /etc/group /etc/passwd:lamp:x:501:501::/home/lamp:/bin/bash /etc/group:lamp:x:501: #åˆ‡æ¢æˆæ™®é€šç”¨æˆ·lampï¼Œæ­¤ç”¨æˆ·çš„æ‰€å±ç¾¤ç»„ä¸º lamp [lamp@localhost ~]$ cd /tmp/dtest/ #æ™®é€šç”¨æˆ·è¿›å…¥æµ‹è¯•ç›®å½• [lamp@localhost dtest]$ touch abc [lamp@localhost dtest]$ mkdir zimulu #åœ¨æ­¤ç›®å½•ä¸­åˆ›å»ºæ–°çš„æ–‡ä»¶ abc å’Œå­ç›®å½• zimulu [lamp@localhost dtest]$ ll total 0 -rw-rw-r--. 1 lamp root 0 Apr 19 06:07 abc drwxrwsr-x. 2 lamp root 40 Apr 19 06:07 zimulu å¯ä»¥çœ‹åˆ°ï¼Œè™½ç„¶æ˜¯ lamp ç”¨æˆ·åˆ›å»ºçš„ abc æ–‡ä»¶å’Œ zimulu ç›®å½•ï¼Œä½†å®ƒä»¬çš„æ‰€å±ç»„éƒ½ä¸æ˜¯ lampï¼ˆlamp ç”¨æˆ·çš„æ‰€å±ç»„ï¼‰ï¼Œè€Œæ˜¯ rootï¼ˆdtest ç›®å½•çš„æ‰€å±ç»„ï¼‰ã€‚\n13. Linux Stick BITï¼ˆSBITï¼‰æ–‡ä»¶ç‰¹æ®Šæƒé™ç”¨æ³•è¯¦è§£ Sticky BITï¼Œç®€ç§° SBIT ç‰¹æ®Šæƒé™ï¼Œå¯æ„ä¸ºç²˜ç€ä½ã€ç²˜æ»ä½ã€é˜²åˆ é™¤ä½ç­‰ã€‚\nSBIT æƒé™ä»…å¯¹ç›®å½•æœ‰æ•ˆï¼Œä¸€æ—¦ç›®å½•è®¾å®šäº† SBIT æƒé™ï¼Œåˆ™ç”¨æˆ·åœ¨æ­¤ç›®å½•ä¸‹åˆ›å»ºçš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œå°±åªæœ‰è‡ªå·±å’Œ root æ‰æœ‰æƒåˆ©ä¿®æ”¹æˆ–åˆ é™¤è¯¥æ–‡ä»¶ã€‚\nä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ç”²ç”¨æˆ·ä»¥ç›®å½•æ‰€å±ç»„æˆ–å…¶ä»–äººçš„èº«ä»½è¿›å…¥ A ç›®å½•æ—¶ï¼Œå¦‚æœç”²å¯¹è¯¥ç›®å½•æœ‰ w æƒé™ï¼Œåˆ™è¡¨ç¤ºå¯¹äº A ç›®å½•ä¸­ä»»ä½•ç”¨æˆ·åˆ›å»ºçš„æ–‡ä»¶æˆ–å­ç›®å½•ï¼Œç”²éƒ½å¯ä»¥è¿›è¡Œä¿®æ”¹ç”šè‡³åˆ é™¤ç­‰æ“ä½œã€‚ä½†æ˜¯ï¼Œå¦‚æœ A ç›®å½•è®¾å®šæœ‰ SBIT æƒé™ï¼Œé‚£å°±å¤§ä¸ä¸€æ ·å•¦ï¼Œç”²ç”¨æˆ·åªèƒ½æ“ä½œè‡ªå·±åˆ›å»ºçš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œè€Œæ— æ³•ä¿®æ”¹ç”šè‡³åˆ é™¤å…¶ä»–ç”¨æˆ·åˆ›å»ºçš„æ–‡ä»¶æˆ–ç›®å½•ã€‚\nä¸¾ä¸ªä¾‹å­ï¼ŒLinux ç³»ç»Ÿä¸­ï¼Œå­˜å‚¨ä¸´æ—¶æ–‡ä»¶çš„ /tmp ç›®å½•å°±è®¾å®šæœ‰ SBIT æƒé™ï¼š\n[root@localhost ~]# ll -d /tmp drwxrwxrwt. 4 root root 4096 Apr 19 06:17 /tmp å¯ä»¥çœ‹åˆ°ï¼Œåœ¨å…¶ä»–äººèº«ä»½çš„æƒé™è®¾å®šä¸­ï¼ŒåŸæ¥çš„ x æƒé™ä½è¢« t æƒé™å ç”¨äº†ï¼Œè¿™å°±è¡¨ç¤ºæ­¤ç›®å½•æ‹¥æœ‰ SBIT æƒé™ã€‚é€šè¿‡ä¸‹é¢ä¸€ç³»åˆ—çš„å‘½ä»¤æ“ä½œï¼Œæˆ‘ä»¬æ¥å…·ä½“çœ‹çœ‹ SBIT æƒé™å¯¹ /tmp ç›®å½•çš„ä½œç”¨ã€‚ [root@localhost ~]# useradd lamp [root@localhost ~]# useradd lamp1 #å»ºç«‹æµ‹è¯•ç”¨æˆ·lampå’Œlamp1ï¼Œçœç•¥è®¾ç½®å¯†ç è¿‡ç¨‹ [root@localhost ~]# su -lamp #åˆ‡æ¢ä¸ºlampç”¨æˆ· [lamp@localhost ~]$ cd /tmp [lamp@localhost tmp]$ touch ftest #å»ºç«‹æµ‹è¯•æ–‡ä»¶ [lamp@localhost tmp]$ll ftest -rw-rw-r-- 1 lamp lamp Apr 19 06:36 ftest [lamp@localhost tmp]$ su - lamp1 #çœç•¥è¾“å…¥lamp1ç”¨æˆ·å¯†ç çš„è¿‡ç¨‹ï¼Œåˆ‡æ¢æˆlamp1ç”¨æˆ· [lamp1 @localhost ~]$ cd /tmp/ [lamp1 @localhost tmp]$ rm -rf ftest rm:cannot remove \u0026#39;ftest\u0026#39;:Operation not permitted å¯ä»¥çœ‹åˆ°ï¼Œè™½ç„¶ /tmp ç›®å½•çš„æƒé™è®¾å®šæ˜¯ 777ï¼Œä½†ç”±äºå…¶å…·æœ‰ SBIT æƒé™ï¼Œå› æ­¤ lamp ç”¨æˆ·åœ¨æ­¤ç›®å½•åˆ›å»ºçš„æ–‡ä»¶ ftestï¼Œlamp1 ç”¨æˆ·åˆ é™¤å¤±è´¥ã€‚\n14. Linuxæ–‡ä»¶ç‰¹æ®Šæƒé™ï¼ˆSUIDã€SGIDå’ŒSBITï¼‰è®¾ç½®è¯¦è§£ å‰é¢å·²ç»å­¦ä¹  SUIDã€SGIDã€SBIT ç‰¹æ®Šæƒé™ï¼Œä»¥åŠå„è‡ªçš„å«ä¹‰å’ŒåŠŸèƒ½ï¼Œé‚£ä¹ˆï¼Œå¦‚ä½•ç»™æ–‡ä»¶æˆ–ç›®å½•æ‰‹åŠ¨è®¾å®šè¿™äº›ç‰¹æ®Šæƒé™å‘¢ï¼Ÿ\nè¿˜æ˜¯è¦ä¾èµ– chmod å‘½ä»¤ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œä½¿ç”¨ chmod å‘½ä»¤ç»™æ–‡ä»¶æˆ–ç›®å½•è®¾å®šæƒé™ï¼Œæœ‰ 2 ç§æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯ä½¿ç”¨æ•°å­—å½¢å¼å’Œå­—æ¯å½¢å¼ã€‚ä¾‹å¦‚ï¼š\n#æ•°å­—å½¢å¼ [root@localhost ~]# chmod 755 ftest #å­—æ¯å½¢å¼ [root@localhost ~]# chmod u=rwx,go=rx ftest ç»™æ–‡ä»¶æˆ–ç›®å½•è®¾å®š SUIDã€SGID å’Œ SBIT ç‰¹æ®Šæƒé™ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è¿™ 2 ç§å½¢å¼ã€‚\næˆ‘ä»¬çŸ¥é“ï¼Œç»™ chmod å‘½ä»¤ä¼ é€’ 3 ä¸ªæ•°å­—ï¼Œå³å¯å®ç°ç»™æ–‡ä»¶æˆ–ç›®å½•è®¾å®šæ™®é€šæƒé™ã€‚æ¯”å¦‚è¯´ï¼Œ\u0026ldquo;755\u0026rdquo; è¡¨ç¤ºæ‰€æœ‰è€…æ‹¥æœ‰ rwx æƒé™ï¼Œæ‰€å±ç»„æ‹¥æœ‰ rx æƒé™ï¼Œå…¶ä»–äººæ‹¥æœ‰ tx æƒé™ã€‚\nç»™æ–‡ä»¶æˆ–ç›®å½•è®¾å®šç‰¹æ®Šæƒé™ï¼Œåªéœ€åœ¨è¿™ 3 ä¸ªæ•°å­—ä¹‹å‰å¢åŠ ä¸€ä¸ªæ•°å­—ä½ï¼Œç”¨æ¥æ”¾ç½®ç»™æ–‡ä»¶æˆ–ç›®å½•è®¾å®šçš„ç‰¹æ®Šæƒé™ï¼Œå°±è¿™ä¹ˆç®€å•ã€‚\nå› æ­¤ï¼Œæˆ‘ä»¬æœ‰å¿…è¦çŸ¥é“ SUIDã€SGIDã€SBIT åˆ†åˆ«å¯¹åº”çš„æ•°å­—ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n 4 \u0026ndash;\u0026gt; SUID 2 \u0026ndash;\u0026gt; SGID 1 \u0026ndash;\u0026gt; SBIT  ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœè¦å°†ä¸€ä¸ªæ–‡ä»¶æƒé™è®¾ç½®ä¸º -rwsr-xr-xï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿæ­¤æ–‡ä»¶çš„æ™®é€šæƒé™ä¸º 755ï¼Œå¦å¤–ï¼Œæ­¤æ–‡ä»¶è¿˜æœ‰ SUID æƒé™ï¼Œå› æ­¤åªéœ€åœ¨ 755 çš„å‰é¢ï¼ŒåŠ ä¸Š SUID å¯¹åº”çš„æ•°å­— 4 å³å¯ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåªéœ€æ‰§è¡Œchmod 4755 æ–‡ä»¶åå‘½ä»¤ï¼Œå°±å®Œæˆäº†-rwsr-xr-x æƒé™çš„è®¾å®šã€‚ å…³äº -rwsr-xr-x çš„æ™®é€šæƒé™æ˜¯ 755ï¼Œä½ å¯ä»¥è¿™æ ·ç†è§£ï¼Œæ ‡è®°æœ‰ s å’Œ t çš„æƒé™ä½ï¼Œéšè—æœ‰ x æƒé™ï¼Œå¯¹æ­¤ï¼Œæœ¬èŠ‚åç»­ä¼šç»™å‡ºæ›´è¯¦ç»†çš„è§£é‡Šã€‚\nåŒæ ·çš„é“ç†ï¼Œå¦‚æœæŸæ–‡ä»¶æ‹¥æœ‰ SUID å’Œ SGID æƒé™ï¼Œåˆ™åªéœ€è¦ç»™ chmod å‘½ä»¤ä¼ é€’ 6\u0026mdash;ï¼ˆ- è¡¨ç¤ºæ•°å­—ï¼‰å³å¯ï¼›å¦‚æœæŸç›®å½•æ‹¥æœ‰ SGID å’Œ SBITï¼Œåªéœ€è¦ç»™ chmod å‘½ä»¤ä¼ é€’ 3\u0026mdash; å³å¯ã€‚\næ³¨æ„ï¼Œä¸åŒçš„ç‰¹æ®Šæƒé™ï¼Œä½œç”¨çš„å¯¹è±¡æ˜¯ä¸åŒçš„ï¼ŒSUID åªå¯¹å¯æ‰§è¡Œæ–‡ä»¶æœ‰æ•ˆï¼›SGID å¯¹å¯æ‰§è¡Œæ–‡ä»¶å’Œç›®å½•éƒ½æœ‰æ•ˆï¼›SBIT åªå¯¹ç›®å½•æœ‰æ•ˆã€‚å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥ç»™æ–‡ä»¶è®¾ç½® 7\u0026mdash;ï¼Œä¹Ÿå°±æ˜¯å°† SUIDã€SGIDã€SBITèµ‹äºˆä¸€ä¸ªæ–‡ä»¶æˆ–ç›®å½•ï¼Œä¾‹å¦‚ï¼š\n[root@localhost ~]# chmod 7777 ftest #ä¸€æ¬¡èµ‹äºˆSetUIDã€SetGIDå’ŒSBITæƒé™ [root@localhost ~]# ll ftest -rwsrwsrwt. 1 root root Apr 19 23:54 ftest æ‰§è¡Œè¿‡ç¨‹è™½ç„¶æ²¡æœ‰æŠ¥é”™ï¼Œä½†è¿™æ ·åšï¼Œæ²¡æœ‰ä»»ä½•å®é™…æ„ä¹‰ã€‚\né™¤äº†èµ‹äºˆ chmod å‘½ä»¤ 4 ä¸ªæ•°å­—è®¾å®šç‰¹æ®Šæƒé™ï¼Œè¿˜å¯ä»¥ä½¿ç”¨å­—æ¯çš„å½¢å¼ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥é€šè¿‡ \u0026ldquo;u+s\u0026rdquo; ç»™æ–‡ä»¶èµ‹äºˆ SUID æƒé™ï¼›é€šè¿‡ \u0026ldquo;g+s\u0026rdquo; ç»™æ–‡ä»¶æˆ–ç›®å½•èµ‹äºˆ SGID æƒé™ï¼›é€šè¿‡ \u0026ldquo;o+t\u0026rdquo; ç»™ç›®å½•èµ‹äºˆ SBIT æƒé™ã€‚\nä¸¾ä¸€ä¸ªä¾‹å­ï¼š\n[root@localhost ~]#chmod u+s, g+s, o+t ftest #è®¾ç½®ç‰¹æ®Šæƒé™ [root@localhost ~]# ll ftest -rwsr-sr-t. 1 root root Apr 19 23:54 ftest [root@localhost ~]# chmod u-s, g-s, o-t ftest #å–æ¶ˆç‰¹æ®Šæƒé™ [root@localhost ~]# ll ftest -rwxr-xr-x. 1 root root Apr 19 23:54 ftest ä¾‹å­ä¸­ï¼Œé€šè¿‡å­—æ¯çš„å½¢å¼æˆåŠŸç»™ ftest æ–‡ä»¶èµ‹äºˆäº† 3 ç§ç‰¹æ®Šæƒé™ï¼Œæ­¤åšæ³•ä»…ä¸ºéªŒè¯å­—æ¯å½¢å¼çš„å¯è¡Œæ€§ï¼Œå¯¹ ftest æ–‡ä»¶æ¥è¯´ï¼Œå¹¶æ— å®é™…æ„ä¹‰ã€‚\nç»†å¿ƒçš„è¯»è€…å¯èƒ½å‘ç°è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼Œä½¿ç”¨ chmod å‘½ä»¤ç»™æ–‡ä»¶æˆ–ç›®å½•èµ‹äºˆç‰¹æ®Šæƒé™æ—¶ï¼ŒåŸæ–‡ä»¶æˆ–ç›®å½•ä¸­å­˜åœ¨çš„ x æƒé™ä¼šè¢«æ›¿æ¢æˆ s æˆ– tï¼Œè€Œå½“æˆ‘ä»¬ä½¿ç”¨ chmod å‘½ä»¤æ¶ˆé™¤æ–‡ä»¶æˆ–ç›®å½•çš„ç‰¹æ®Šæƒé™æ—¶ï¼ŒåŸæœ¬æ¶ˆå¤±çš„ x æƒé™åˆä¼šæ˜¾ç°å‡ºæ¥ã€‚\nè¿™æ˜¯å› ä¸ºï¼Œæ— è®ºæ˜¯ SUIDã€SGID è¿˜æ˜¯ SBITï¼Œå®ƒä»¬åªé’ˆå¯¹å…·æœ‰ x æƒé™çš„æ–‡ä»¶æˆ–ç›®å½•æœ‰æ•ˆã€‚æ²¡æœ‰ x æƒé™çš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œå³ä¾¿èµ‹äºˆç‰¹æ®Šæƒé™ï¼Œä¹Ÿæ— æ³•å‘æŒ¥å®ƒä»¬çš„åŠŸèƒ½ï¼Œæ²¡æœ‰ä»»ä½•æ„ä¹‰ã€‚\nä¾‹å¦‚ï¼Œæˆ‘ä»¬å°±æ˜¯è¦ç»™ä¸å…·æœ‰ x æƒé™çš„æ–‡ä»¶æˆ–ç›®å½•èµ‹äºˆç‰¹æ®Šæƒé™ï¼Œçœ‹çœ‹æœ‰ä»€ä¹ˆæ•ˆæœï¼š\n[root@localhost ~]# chmod 7666 ftest [root@localhost ~]# ll ftest -rwSrwSrwT. 1 root root Apr 23:54 ftest å¯ä»¥çœ‹åˆ°ï¼Œç›¸åº”çš„æƒé™ä½ä¼šè¢«æ ‡è®°ä¸º Sï¼ˆå¤§å†™ï¼‰å’Œ Tï¼ˆå¤§å†™ï¼‰ï¼ŒæŒ‡çš„å°±æ˜¯è®¾ç½®çš„ SUIDã€SGID å’Œ SBIT æƒé™æ²¡æœ‰æ„ä¹‰ã€‚\n15. Linux chattrå‘½ä»¤è¯¦è§£ï¼šä¿®æ”¹æ–‡ä»¶ç³»ç»Ÿçš„æƒé™å±æ€§ ç®¡ç† Linux ç³»ç»Ÿä¸­çš„æ–‡ä»¶å’Œç›®å½•ï¼Œé™¤äº†å¯ä»¥è®¾å®šæ™®é€šæƒé™å’Œç‰¹æ®Šæƒé™å¤–ï¼Œè¿˜å¯ä»¥åˆ©ç”¨æ–‡ä»¶å’Œç›®å½•å…·æœ‰çš„ä¸€äº›éšè—å±æ€§ã€‚\nchattr å‘½ä»¤ï¼Œä¸“é—¨ç”¨æ¥ä¿®æ”¹æ–‡ä»¶æˆ–ç›®å½•çš„éšè—å±æ€§ï¼Œåªæœ‰ root ç”¨æˆ·å¯ä»¥ä½¿ç”¨ã€‚è¯¥å‘½ä»¤çš„åŸºæœ¬æ ¼å¼ä¸ºï¼š\n[root@localhost ~]# chattr [+-=] [å±æ€§] æ–‡ä»¶æˆ–ç›®å½•å  è¡¨ç¤ºç»™æ–‡ä»¶æˆ–ç›®å½•æ·»åŠ å±æ€§ï¼Œ- è¡¨ç¤ºç§»é™¤æ–‡ä»¶æˆ–ç›®å½•æ‹¥æœ‰çš„æŸäº›å±æ€§ï¼Œ= è¡¨ç¤ºç»™æ–‡ä»¶æˆ–ç›®å½•è®¾å®šä¸€äº›å±æ€§ã€‚  è¡¨ 1 åˆ—å‡ºäº†å¸¸ç”¨çš„ä¸€äº›å±æ€§åŠåŠŸèƒ½ã€‚ è¡¨ 1 chattr å‘½ä»¤å¸¸ç”¨çš„å±æ€§é€‰é¡¹åŠåŠŸèƒ½\n   å±æ€§é€‰é¡¹ åŠŸèƒ½     i å¦‚æœå¯¹æ–‡ä»¶è®¾ç½® i å±æ€§ï¼Œé‚£ä¹ˆä¸å…è®¸å¯¹æ–‡ä»¶è¿›è¡Œåˆ é™¤ã€æ”¹åï¼Œä¹Ÿä¸èƒ½æ·»åŠ å’Œä¿®æ”¹æ•°æ®ï¼›å¦‚æœå¯¹ç›®å½•è®¾ç½® i å±æ€§ï¼Œé‚£ä¹ˆåªèƒ½ä¿®æ”¹ç›®å½•ä¸‹æ–‡ä»¶ä¸­çš„æ•°æ®ï¼Œä½†ä¸å…è®¸å»ºç«‹å’Œåˆ é™¤æ–‡ä»¶ï¼›   a å¦‚æœå¯¹æ–‡ä»¶è®¾ç½® a å±æ€§ï¼Œé‚£ä¹ˆåªèƒ½åœ¨æ–‡ä»¶ä¸­å¢—åŠ æ•°æ®ï¼Œä½†æ˜¯ä¸èƒ½åˆ é™¤å’Œä¿®æ”¹æ•°æ®ï¼› å¦‚æœå¯¹ç›®å½•è®¾ç½® a å±æ€§ï¼Œé‚£ä¹ˆåªå…è®¸åœ¨ç›®å½•ä¸­å»ºç«‹å’Œä¿®æ”¹æ–‡ä»¶ï¼Œä½†æ˜¯ä¸å…è®¸åˆ é™¤æ–‡ä»¶ï¼›   u è®¾ç½®æ­¤å±æ€§çš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œåœ¨åˆ é™¤æ—¶ï¼Œå…¶å†…å®¹ä¼šè¢«ä¿å­˜ï¼Œä»¥ä¿è¯åæœŸèƒ½å¤Ÿæ¢å¤ï¼Œå¸¸ç”¨æ¥é˜²æ­¢æ„å¤–åˆ é™¤æ–‡ä»¶æˆ–ç›®å½•ã€‚   s å’Œ u ç›¸åï¼Œåˆ é™¤æ–‡ä»¶æˆ–ç›®å½•æ—¶ï¼Œä¼šè¢«å½»åº•åˆ é™¤ï¼ˆç›´æ¥ä»ç¡¬ç›˜ä¸Šåˆ é™¤ï¼Œç„¶åç”¨ 0 å¡«å……æ‰€å ç”¨çš„åŒºåŸŸï¼‰ï¼Œä¸å¯æ¢å¤ã€‚    ã€ä¾‹ 1ã€‘ ç»™æ–‡ä»¶èµ‹äºˆ i å±æ€§ã€‚\n[root@localhost ~]# touch ftest #å»ºç«‹æµ‹è¯•æ–‡ä»¶ [root@localhost ~]# chattr +i ftest [root@localhost ~]# rm -rf ftest rm:cannot remove \u0026#39;ftest\u0026#39;:Operation not permitted #æ— æ³•åˆ é™¤\u0026#34;ftesr\u0026#34;ï¼Œæ“ä½œä¸å…è®¸ #è¢«èµ‹äºˆiå±æ€§åï¼Œrootä¸èƒ½åˆ é™¤ [root@localhost ~]# echo 111\u0026gt;\u0026gt;ftest bash:ftest:Permission denied #æƒé™ä¸å¤Ÿï¼Œä¸èƒ½ä¿®æ”¹æ–‡ä»¶ä¸­çš„æ•°æ® å¯ä»¥çœ‹åˆ°ï¼Œè®¾ç½®æœ‰ i å±æ€§çš„æ–‡ä»¶ï¼Œå³ä¾¿æ˜¯ root ç”¨æˆ·ï¼Œä¹Ÿæ— æ³•åˆ é™¤å’Œä¿®æ”¹æ•°æ®ã€‚\nã€ä¾‹ 2ã€‘ä¸ºç›®å½•èµ‹äºˆ i å±æ€§ã€‚\n[root@localhost ~]# mkdir dtest #å»ºç«‹æµ‹è¯•ç›®å½• [root@localhost dtest]# touch dtest/abc #å†å»ºç«‹ä¸€ä¸ªæµ‹è¯•æ–‡ä»¶abc [root@localhost ~]# chattr +i dtest #ç»™ç›®å½•èµ‹äºˆiå±æ€§ [root@localhost ~]# cd dtest [root@localhost dtest]# touch bed touch: cannot touch \u0026#39;bed\u0026#39;:Permission denied #æ— æ³•åˆ›å»º\u0026#34;bcd\u0026#34;ï¼Œæƒé™ä¸å¤Ÿï¼Œdtestç›®å½•ä¸èƒ½æ–°å»ºæ–‡ä»¶ [root@localhost dtest]# echo 11\u0026gt;\u0026gt;abc [root@localhost dtest]# cat abc 11 #å¯ä»¥ä¿®æ”¹æ–‡ä»¶å†…å®¹ [root@localhost dtest]# rm -rf abc rm: cannot remove \u0026#39;abc\u0026#39;: Permission denied #æ— æ³•åˆ é™¤\u0026#34;abc\u0026#34;ï¼Œæƒé™ä¸å¤Ÿ ä¸€æ—¦ç»™ç›®å½•è®¾ç½® i å±æ€§ï¼Œå³ä½¿æ˜¯ root ç”¨æˆ·ï¼Œä¹Ÿæ— æ³•åœ¨ç›®å½•å†…éƒ¨æ–°å»ºæˆ–åˆ é™¤æ–‡ä»¶ï¼Œä½†å¯ä»¥ä¿®æ”¹æ–‡ä»¶å†…å®¹ã€‚ ç»™è®¾ç½®æœ‰ i å±æ€§çš„æ–‡ä»¶åˆ é™¤æ­¤å±æ€§ä¹Ÿå¾ˆç®€å•ï¼Œåªéœ€å°† chattr å‘½ä»¤ä¸­ + æ”¹ä¸º - å³å¯ã€‚\nã€ä¾‹ 3ã€‘æ¼”ç¤º a å±æ€§çš„ä½œç”¨ã€‚ å‡è®¾æœ‰è¿™æ ·ä¸€ç§åº”ç”¨ï¼Œæˆ‘ä»¬æ¯å¤©è‡ªåŠ¨å®ç°æŠŠæœåŠ¡å™¨çš„æ—¥å¿—å¤‡ä»½åˆ°æŒ‡å®šç›®å½•ï¼Œå¤‡ä»½ç›®å½•å¯è®¾ç½® a å±æ€§ï¼Œå˜ä¸ºåªå¯åˆ›å»ºæ–‡ä»¶è€Œä¸å¯åˆ é™¤ã€‚å‘½ä»¤å¦‚ä¸‹ï¼š\n[root@localhost ~]# mkdir -p /back/log #å»ºç«‹å¤‡ä»½ç›®å½• [root@localhost ~]# chattr +a /back/log #èµ‹äºˆaå±æ€§ [root@localhost ~]# cp /var/log/messages /back/log #å¯ä»¥å¤åˆ¶æ–‡ä»¶å’Œæ–°å»ºæ–‡ä»¶åˆ°æŒ‡å®šç›®å½•ä¸­ [root@localhost ~]# rm -rf /back/log/messages rm: cannot remove \u0026#39;/back/log/messages\u0026#39;: Permission denied #æ— æ³•åˆ é™¤ /back/log/messagesï¼Œæ“ä½œä¸å…è®¸ æ³¨æ„ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œä¸è¦ä½¿ç”¨ chattr å‘½ä»¤ä¿®æ”¹ /ã€/dev/ã€/tmp/ã€/var/ ç­‰ç›®å½•çš„éšè—å±æ€§ï¼Œå¾ˆå®¹æ˜“å¯¼è‡´ç³»ç»Ÿæ— æ³•å¯åŠ¨ã€‚å¦å¤–ï¼Œchatrr å‘½ä»¤å¸¸ä¸ lsattr å‘½ä»¤åˆç”¨ï¼Œå‰è€…ä¿®æ”¹æ–‡ä»¶æˆ–ç›®å½•çš„éšè—å±æ€§ï¼Œåè€…ç”¨äºæŸ¥çœ‹æ˜¯å¦ä¿®æ”¹æˆåŠŸã€‚æœ‰å…³ lsattr å‘½ä»¤ï¼Œæ”¾åˆ°ä¸‹èŠ‚è®²è§£ã€‚\n16. Linux lsattrå‘½ä»¤ï¼šæŸ¥çœ‹æ–‡ä»¶ç³»ç»Ÿå±æ€§ ä½¿ç”¨ chattr å‘½ä»¤é…ç½®æ–‡ä»¶æˆ–ç›®å½•çš„éšè—å±æ€§åï¼Œå¯ä»¥ä½¿ç”¨ lsattr å‘½ä»¤æŸ¥çœ‹ã€‚\nlsattr å‘½ä»¤ï¼Œç”¨äºæ˜¾ç¤ºæ–‡ä»¶æˆ–ç›®å½•çš„éšè—å±æ€§ï¼Œå…¶åŸºæœ¬æ ¼å¼å¦‚ä¸‹ï¼š\n[root@localhost ~]# lsattr [é€‰é¡¹] æ–‡ä»¶æˆ–ç›®å½•å å¸¸ç”¨é€‰é¡¹æœ‰ä»¥ä¸‹ 3 ç§ï¼š\n -aï¼šåé¢ä¸å¸¦æ–‡ä»¶æˆ–ç›®å½•åï¼Œè¡¨ç¤ºæ˜¾ç¤ºæ‰€æœ‰æ–‡ä»¶å’Œç›®å½•ï¼ˆåŒ…æ‹¬éšè—æ–‡ä»¶å’Œç›®å½•ï¼‰ -dï¼šå¦‚æœç›®æ ‡æ˜¯ç›®å½•ï¼Œåªä¼šåˆ—å‡ºç›®å½•æœ¬èº«çš„éšè—å±æ€§ï¼Œè€Œä¸ä¼šåˆ—å‡ºæ‰€å«æ–‡ä»¶æˆ–å­ç›®å½•çš„éšè—å±æ€§ä¿¡æ¯ï¼› -Rï¼šå’Œ -d æ°å¥½ç›¸åï¼Œä½œç”¨äºç›®å½•æ—¶ï¼Œä¼šè¿åŒå­ç›®å½•çš„éšè—ä¿¡æ¯æ•°æ®ä¹Ÿä¸€å¹¶æ˜¾ç¤ºå‡ºæ¥ã€‚  ã€ä¾‹ 1ã€‘\n[root@localhost ~]# touch attrtest -----------e- attrtest [root@localhost ~]# chattr +aij attrtest [root@localhost ~]# lsattr attrtest ----ia---j-e- attrtest æ³¨æ„ï¼Œä¸ä½¿ç”¨ä»»ä½•é€‰é¡¹ï¼Œä»…ç”¨äºæ˜¾ç¤ºæ–‡ä»¶çš„éšè—ä¿¡æ¯ï¼Œä¸é€‚ç”¨äºç›®å½•ã€‚\nã€ä¾‹ 2ã€‘\n[root@localhost ~]#lsattr -a -----------e- ./. ------------- ./.. -----------e- ./.gconfd -----------e- ./.bashrc ã€ä¾‹ 3ã€‘\n[root@localhost ~]#lsattr -d /back/log -----a------e- /back/log #æŸ¥çœ‹/back/logç›®å½•ï¼Œå…¶æ‹¥æœ‰aå’Œeå±æ€§ 17. Linux sudoå‘½ä»¤ç”¨æ³•è¯¦è§£ï¼šç³»ç»Ÿæƒé™ç®¡ç† æˆ‘ä»¬çŸ¥é“ï¼Œä½¿ç”¨ su å‘½ä»¤å¯ä»¥è®©æ™®é€šç”¨æˆ·åˆ‡æ¢åˆ° root èº«ä»½å»æ‰§è¡ŒæŸäº›ç‰¹æƒå‘½ä»¤ï¼Œä½†å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚è¯´ï¼š ä»…ä»…ä¸ºäº†ä¸€ä¸ªç‰¹æƒæ“ä½œå°±ç›´æ¥èµ‹äºˆæ™®é€šç”¨æˆ·æ§åˆ¶ç³»ç»Ÿçš„å®Œæ•´æƒé™ï¼› å½“å¤šäººä½¿ç”¨åŒä¸€å°ä¸»æœºæ—¶ï¼Œå¦‚æœå¤§å®¶éƒ½è¦ä½¿ç”¨ su å‘½ä»¤åˆ‡æ¢åˆ° root èº«ä»½ï¼Œé‚£åŠ¿å¿…å°±éœ€è¦ root çš„å¯†ç ï¼Œè¿™å°±å¯¼è‡´å¾ˆå¤šäººéƒ½çŸ¥é“ root çš„å¯†ç ï¼›\nè€ƒè™‘åˆ°ä½¿ç”¨ su å‘½ä»¤å¯èƒ½å¯¹ç³»ç»Ÿå®‰è£…é€ æˆçš„éšæ‚£ï¼Œæœ€å¸¸è§çš„è§£å†³æ–¹æ³•æ˜¯ä½¿ç”¨ sudo å‘½ä»¤ï¼Œæ­¤å‘½ä»¤ä¹Ÿå¯ä»¥è®©ä½ åˆ‡æ¢è‡³å…¶ä»–ç”¨æˆ·çš„èº«ä»½å»æ‰§è¡Œå‘½ä»¤ã€‚\nç›¸å¯¹äºä½¿ç”¨ su å‘½ä»¤è¿˜éœ€è¦æ–°åˆ‡æ¢ç”¨æˆ·çš„å¯†ç ï¼Œsudo å‘½ä»¤çš„è¿è¡Œåªéœ€è¦çŸ¥é“è‡ªå·±çš„å¯†ç å³å¯ï¼Œç”šè‡³äºï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰‹åŠ¨ä¿®æ”¹ sudo çš„é…ç½®æ–‡ä»¶ï¼Œä½¿å…¶æ— éœ€ä»»ä½•å¯†ç å³å¯è¿è¡Œã€‚\nsudo å‘½ä»¤é»˜è®¤åªæœ‰ root ç”¨æˆ·å¯ä»¥è¿è¡Œï¼Œè¯¥å‘½ä»¤çš„åŸºæœ¬æ ¼å¼ä¸ºï¼š\n[root@localhost ~]# sudo [-b] [-u æ–°ä½¿ç”¨è€…è´¦å·] è¦æ‰§è¡Œçš„å‘½ä»¤ å¸¸ç”¨çš„é€‰é¡¹ä¸å‚æ•°ï¼š\n -b ï¼šå°†åç»­çš„å‘½ä»¤æ”¾åˆ°èƒŒæ™¯ä¸­è®©ç³»ç»Ÿè‡ªè¡Œè¿è¡Œï¼Œä¸å¯¹å½“å‰çš„ shell ç¯å¢ƒäº§ç”Ÿå½±å“ã€‚ -u ï¼šåé¢å¯ä»¥æ¥æ¬²åˆ‡æ¢çš„ç”¨æˆ·åï¼Œè‹¥æ— æ­¤é¡¹åˆ™ä»£è¡¨åˆ‡æ¢èº«ä»½ä¸º root ã€‚ -lï¼šæ­¤é€‰é¡¹çš„ç”¨æ³•ä¸º sudo -lï¼Œç”¨äºæ˜¾ç¤ºå½“å‰ç”¨æˆ·å¯ä»¥ç”¨ sudo æ‰§è¡Œé‚£äº›å‘½ä»¤ã€‚  ã€ä¾‹ 1ã€‘\n[root@localhost ~]# grep sshd /etc/passwd sshd:x:74:74:privilege-separated SSH:/var/empty/sshd:/sbin.nologin [root@localhost ~]# sudo -u sshd touch /tmp/mysshd [root@localhost ~]# ll /tmp/mysshd -rw-r--r-- 1 sshd sshd 0 Feb 28 17:42 /tmp/mysshd æœ¬ä¾‹ä¸­ï¼Œæ— æ³•ä½¿ç”¨ su - sshd çš„æ–¹å¼æˆåŠŸåˆ‡æ¢åˆ° sshd è´¦æˆ·ä¸­ï¼Œå› ä¸ºæ­¤ç”¨æˆ·çš„é»˜è®¤ Shell æ˜¯ /sbin/nologinã€‚è¿™æ—¶å°±æ˜¾ç°å‡º sudo çš„ä¼˜åŠ¿ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ sudo ä»¥ sshd çš„èº«ä»½åœ¨ /tmp ç›®å½•ä¸‹åˆ›å»º mysshd æ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œæ–°åˆ›å»ºçš„ mysshd æ–‡ä»¶çš„æ‰€æœ‰è€…ç¡®å®æ˜¯ sshdã€‚\nã€ä¾‹ 2ã€‘\n[root@localhost ~]# sudo -u vbird1 sh -c \u0026#34;mkdir ~vbird1/www; cd ~vbird1/www; \\ \u0026gt; echo \u0026#39;This is index.html file\u0026#39; \u0026gt; index.html\u0026#34; [root@localhost ~]# ll -a ~vbird1/www drwxr-xr-x 2 vbird1 vbird1 4096 Feb 28 17:51 . drwx------ 5 vbird1 vbird1 4096 Feb 28 17:51 .. -rw-r--r-- 1 vbird1 vbird1 24 Feb 28 17:51 index.html è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½¿ç”¨ sudo å‘½ä»¤åˆ‡æ¢è‡³ vbird1 èº«ä»½ï¼Œå¹¶è¿è¡Œ sh -c çš„æ–¹å¼æ¥è¿è¡Œä¸€è¿ä¸²çš„å‘½ä»¤ã€‚\nå‰é¢è¯´è¿‡ï¼Œé»˜è®¤æƒ…å†µä¸‹ sudo å‘½ä»¤ï¼Œåªæœ‰ root èº«ä»½å¯ä»¥ä½¿ç”¨ï¼Œé‚£ä¹ˆï¼Œå¦‚ä½•è®©æ™®é€šç”¨æˆ·ä¹Ÿèƒ½ä½¿ç”¨å®ƒå‘¢ï¼Ÿ\nè§£å†³è¿™ä¸ªé—®é¢˜ä¹‹å‰ï¼Œå…ˆç»™å¤§å®¶åˆ†æä¸€ä¸‹ sudo å‘½ä»¤çš„æ‰§è¡Œè¿‡ç¨‹ã€‚sudoå‘½ä»¤çš„è¿è¡Œï¼Œéœ€ç»å†å¦‚ä¸‹å‡ æ­¥ï¼š å½“ç”¨æˆ·è¿è¡Œ sudo å‘½ä»¤æ—¶ï¼Œç³»ç»Ÿä¼šå…ˆé€šè¿‡ /etc/sudoers æ–‡ä»¶ï¼ŒéªŒè¯è¯¥ç”¨æˆ·æ˜¯å¦æœ‰è¿è¡Œ sudo çš„æƒé™ï¼› ç¡®å®šç”¨æˆ·å…·æœ‰ä½¿ç”¨ sudo å‘½ä»¤çš„æƒé™åï¼Œè¿˜è¦è®©ç”¨æˆ·è¾“å…¥è‡ªå·±çš„å¯†ç è¿›è¡Œç¡®è®¤ã€‚å‡ºäºå¯¹ç³»ç»Ÿå®‰å…¨æ€§çš„è€ƒè™‘ï¼Œå¦‚æœç”¨æˆ·åœ¨é»˜è®¤æ—¶é—´å†…ï¼ˆé»˜è®¤æ˜¯ 5 åˆ†é’Ÿï¼‰ä¸ä½¿ç”¨ sudo å‘½ä»¤ï¼Œæ­¤åä½¿ç”¨æ—¶éœ€è¦å†æ¬¡è¾“å…¥å¯†ç ï¼› å¯†ç è¾“å…¥æˆåŠŸåï¼Œæ‰ä¼šæ‰§è¡Œ sudo å‘½ä»¤åæ¥çš„å‘½ä»¤ã€‚\næ˜¾ç„¶ï¼Œèƒ½å¦ä½¿ç”¨ sudo å‘½ä»¤ï¼Œå–å†³äºå¯¹ /etc/sudoers æ–‡ä»¶çš„é…ç½®ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼Œæ­¤æ–‡ä»¶ä¸­åªé…ç½®æœ‰ root ç”¨æˆ·ï¼‰ã€‚æ‰€ä»¥æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å­¦ä¹ å¯¹ /etc/sudoers æ–‡ä»¶è¿›è¡Œåˆç†çš„ä¿®æ”¹ã€‚ sudoå‘½ä»¤çš„é…ç½®æ–‡ä»¶/etc/sudoers ä¿®æ”¹ /etc/sudoersï¼Œä¸å»ºè®®ç›´æ¥ä½¿ç”¨ vimï¼Œè€Œæ˜¯ä½¿ç”¨ visudoã€‚å› ä¸ºä¿®æ”¹ /etc/sudoers æ–‡ä»¶éœ€éµå¾ªä¸€å®šçš„è¯­æ³•è§„åˆ™ï¼Œä½¿ç”¨ visudo çš„å¥½å¤„å°±åœ¨äºï¼Œå½“ä¿®æ”¹å®Œæ¯• /etc/sudoers æ–‡ä»¶ï¼Œç¦»å¼€ä¿®æ”¹é¡µé¢æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªè¡Œæ£€éªŒ /etc/sudoers æ–‡ä»¶çš„è¯­æ³•ã€‚\nå› æ­¤ï¼Œä¿®æ”¹ /etc/sudoers æ–‡ä»¶çš„å‘½ä»¤å¦‚ä¸‹ï¼š\n[root@localhost ~]# visudo â€¦çœç•¥éƒ¨åˆ†è¾“å‡ºâ€¦ root ALL=(ALL) ALL \u0026lt;--å¤§çº¦ 76 è¡Œçš„ä½ç½® # %wheel ALL=(ALL) ALL \u0026lt;--å¤§çº¦84è¡Œçš„ä½ç½® #è¿™ä¸¤è¡Œæ˜¯ç³»ç»Ÿä¸ºæˆ‘ä»¬æä¾›çš„æ¨¡æ¿ï¼Œæˆ‘ä»¬å‚ç…§å®ƒå†™è‡ªå·±çš„å°±å¯ä»¥äº† â€¦çœç•¥éƒ¨åˆ†è¾“å‡ºâ€¦ é€šè¿‡ visudo å‘½ä»¤ï¼Œæˆ‘ä»¬å°±æ‰“å¼€äº† /etc/sudoers æ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸Šæ˜¾ç¤ºçš„ 2 è¡Œä¿¡æ¯ï¼Œè¿™æ˜¯ç³»ç»Ÿç»™æˆ‘ä»¬æä¾›çš„ 2 ä¸ªæ¨¡æ¿ï¼Œåˆ†åˆ«ç”¨äºæ·»åŠ ç”¨æˆ·å’Œç¾¤ç»„ï¼Œä½¿å…¶èƒ½å¤Ÿä½¿ç”¨ sudo å‘½ä»¤ã€‚\nè¿™ä¸¤è¡Œæ¨¡æ¿çš„å«ä¹‰åˆ†ä¸ºæ˜¯ï¼š\nroot ALL=(ALL) ALL #ç”¨æˆ·å è¢«ç®¡ç†ä¸»æœºçš„åœ°å€=(å¯ä½¿ç”¨çš„èº«ä»½) æˆæƒå‘½ä»¤(ç»å¯¹è·¯å¾„) #%wheel ALL=(ALL) ALL #%ç»„å è¢«ç®¡ç†ä¸»æœºçš„åœ°å€=(å¯ä½¿ç”¨çš„èº«ä»½) æˆæƒå‘½ä»¤(ç»å¯¹è·¯å¾„) è¡¨ 1 å¯¹ä»¥ä¸Š 2 ä¸ªæ¨¡æ¿çš„å„éƒ¨åˆ†è¿›è¡Œè¯¦ç»†çš„è¯´æ˜ã€‚ è¡¨ 1 /etc/sudoers ç”¨æˆ·å’Œç¾¤ç»„æ¨¡æ¿çš„å«ä¹‰\n   æ¨¡å— å«ä¹‰     ç”¨æˆ·åæˆ–ç¾¤ç»„å è¡¨ç¤ºç³»ç»Ÿä¸­çš„é‚£ä¸ªç”¨æˆ·æˆ–ç¾¤ç»„ï¼Œå¯ä»¥ä½¿ç”¨ sudo è¿™ä¸ªå‘½ä»¤ã€‚   è¢«ç®¡ç†ä¸»æœºçš„åœ°å€ ç”¨æˆ·å¯ä»¥ç®¡ç†æŒ‡å®š IP åœ°å€çš„æœåŠ¡å™¨ã€‚è¿™é‡Œå¦‚æœå†™ ALLï¼Œåˆ™ä»£è¡¨ç”¨æˆ·å¯ä»¥ç®¡ç†ä»»ä½•ä¸»æœºï¼›å¦‚æœå†™å›ºå®š IPï¼Œåˆ™ä»£è¡¨ç”¨æˆ·å¯ä»¥ç®¡ç†æŒ‡å®šçš„æœåŠ¡å™¨ã€‚å¦‚æœæˆ‘ä»¬åœ¨è¿™é‡Œå†™æœ¬æœºçš„ IP åœ°å€ï¼Œä¸ä»£è¡¨åªå…è®¸æœ¬æœºçš„ç”¨æˆ·ä½¿ç”¨æŒ‡å®šå‘½ä»¤ï¼Œè€Œæ˜¯ä»£è¡¨æŒ‡å®šçš„ç”¨æˆ·å¯ä»¥ä»ä»»ä½• IP åœ°å€æ¥ç®¡ç†å½“å‰æœåŠ¡å™¨ã€‚   å¯ä½¿ç”¨çš„èº«ä»½ å°±æ˜¯æŠŠæ¥æºç”¨æˆ·åˆ‡æ¢æˆä»€ä¹ˆèº«ä»½ä½¿ç”¨ï¼Œï¼ˆALLï¼‰ä»£è¡¨å¯ä»¥åˆ‡æ¢æˆä»»æ„èº«ä»½ã€‚è¿™ä¸ªå­—æ®µå¯ä»¥çœç•¥ã€‚   æˆæƒå‘½ä»¤ è¡¨ç¤º root æŠŠä»€ä¹ˆå‘½ä»¤å‘½ä»¤æˆæƒç»™ç”¨æˆ·ï¼Œæ¢å¥è¯è¯´ï¼Œå¯ä»¥ç”¨åˆ‡æ¢çš„èº«ä»½æ‰§è¡Œä»€ä¹ˆå‘½ä»¤ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ­¤å‘½ä»¤å¿…é¡»ä½¿ç”¨ç»å¯¹è·¯å¾„å†™ã€‚é»˜è®¤å€¼æ˜¯ ALLï¼Œè¡¨ç¤ºå¯ä»¥æ‰§è¡Œä»»ä½•å‘½ä»¤ã€‚    ã€ä¾‹ 3ã€‘ æˆæƒç”¨æˆ· lamp å¯ä»¥é‡å¯æœåŠ¡å™¨ï¼Œç”± root ç”¨æˆ·æ·»åŠ ï¼Œå¯ä»¥åœ¨ /etc/sudoers æ¨¡æ¿ä¸‹æ·»åŠ å¦‚ä¸‹è¯­å¥ï¼š\n[root@localhost ~]# visudo lamp ALL=/sbin/shutdown -r now æ³¨æ„ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥å†™å¤šä¸ªæˆæƒå‘½ä»¤ï¼Œä¹‹é—´ç”¨é€—å·åˆ†éš”ã€‚ç”¨æˆ· lamp å¯ä»¥ä½¿ç”¨ sudo -l æŸ¥çœ‹æˆæƒçš„å‘½ä»¤åˆ—è¡¨ï¼š\n[root@localhost ~]# su - lamp #åˆ‡æ¢æˆlampç”¨æˆ· [lamp@localhost ~]$ sudo -l [sudo] password for lamp: #éœ€è¦è¾“å…¥lampç”¨æˆ·çš„å¯†ç  User lamp may run the following commands on this host: (root) /sbin/shutdown -r now å¯ä»¥çœ‹åˆ°ï¼Œlamp ç”¨æˆ·æ‹¥æœ‰äº† shutdown -r now çš„æƒé™ã€‚è¿™æ—¶ï¼Œlamp ç”¨æˆ·å°±å¯ä»¥ä½¿ç”¨ sudo æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤é‡å¯æœåŠ¡å™¨ï¼š\n[lamp@localhost ~]$ sudo /sbin/shutdown -r now å†æ¬¡å¼ºè°ƒï¼Œæˆæƒå‘½ä»¤è¦ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼ˆæˆ–è€…æŠŠ /sbin è·¯å¾„å¯¼å…¥æ™®é€šç”¨æˆ· PATH è·¯å¾„ä¸­ï¼Œä¸æ¨èä½¿ç”¨æ­¤æ–¹å¼ï¼‰ï¼Œå¦åˆ™æ— æ³•æ‰§è¡Œã€‚\nã€ä¾‹ 4ã€‘ å‡è®¾ç°åœ¨æœ‰ pro1ï¼Œpro2ï¼Œpro3 è¿™ 3 ä¸ªç”¨æˆ·ï¼Œè¿˜æœ‰ä¸€ä¸ª group ç¾¤ç»„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ /etc/sudoers æ–‡ä»¶é…ç½® wheel ç¾¤ç»„ä¿¡æ¯ï¼Œä»¤è¿™ 3 ä¸ªç”¨æˆ·åŒæ—¶æ‹¥æœ‰ç®¡ç†ç³»ç»Ÿçš„æƒé™ã€‚\né¦–å…ˆï¼Œå‘ /etc/sudoers æ–‡ä»¶ä¸­æ·»åŠ ç¾¤ç»„é…ç½®ä¿¡æ¯ï¼š\n[root@localhost ~]# visudo ....(å‰é¢çœç•¥).... %group ALL=(ALL) ALL #åœ¨ 84 è¡Œ#wheelè¿™ä¸€è¡Œåé¢å†™å…¥ æ­¤é…ç½®ä¿¡æ¯è¡¨ç¤ºï¼Œgroup è¿™ä¸ªç¾¤ç»„ä¸­çš„æ‰€æœ‰ç”¨æˆ·éƒ½èƒ½å¤Ÿä½¿ç”¨ sudo åˆ‡æ¢ä»»ä½•èº«ä»½ï¼Œæ‰§è¡Œä»»ä½•å‘½ä»¤ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨ usermod å‘½ä»¤å°† pro1 åŠ å…¥ group ç¾¤ç»„ï¼Œçœ‹çœ‹æœ‰ä»€ä¹ˆæ•ˆæœï¼š\n[root@localhost ~]# usermod -a -G group pro1 [pro1@localhost ~]# sudo tail -n 1 /etc/shadow \u0026lt;==æ³¨æ„èº«ä»½æ˜¯ pro1 ....(å‰é¢çœç•¥).... Password: \u0026lt;==è¾“å…¥ pro1 çš„å£ä»¤å–”ï¼ pro3:$1$GfinyJgZ$9J8IdrBXXMwZIauANg7tW0:14302:0:99999:7::: [pro2@localhost ~]# sudo tail -n 1 /etc/shadow \u0026lt;==æ³¨æ„èº«ä»½æ˜¯ pro2 Password: pro2 is not in the sudoers file. This incident will be reported. #æ­¤é”™è¯¯ä¿¡æ¯è¡¨ç¤º pro2 ä¸åœ¨ /etc/sudoers çš„é…ç½®ä¸­ã€‚ å¯ä»¥çœ‹åˆ°ï¼Œç”±äº pro1 åŠ å…¥åˆ°äº† group ç¾¤ç»„ï¼Œå› æ­¤ pro1 å°±å¯ä»¥ä½¿ç”¨ sudo å‘½ä»¤ï¼Œè€Œ pro2 ä¸è¡Œã€‚åŒæ ·çš„é“ç†ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è®© pro3 ä¹Ÿå¯ä»¥ä½¿ç”¨ sudo å‘½ä»¤ï¼Œä¸ç”¨å†ä¿®æ”¹ /etc/sudoers æ–‡ä»¶ï¼Œåªéœ€è¦å°† pro3 åŠ å…¥ group ç¾¤ç»„å³å¯ã€‚\n","permalink":"http://yangchnet.github.io/Dessert/posts/linux/linux%E4%B8%8B%E7%9A%84%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86/","summary":"Linuxä¸‹çš„æƒé™ç®¡ç† Linux ç³»ç»Ÿä¸­ä¸ºä»€ä¹ˆéœ€è¦è®¾å®šä¸åŒçš„æƒé™ï¼Œæ‰€æœ‰ç”¨æˆ·éƒ½ç›´æ¥ä½¿ç”¨ç®¡ç†å‘˜ï¼ˆrootï¼‰èº«ä»½ä¸å¥½å—ï¼Ÿ\n ç”±äºç»å¤§å¤šæ•°ç”¨æˆ·ä½¿ç”¨çš„æ˜¯ä¸ªäººè®¡ç®—æœºï¼Œä½¿ç”¨è€…ä¸€èˆ¬éƒ½æ˜¯è¢«ä¿¡ä»»çš„äººï¼ˆå¦‚å®¶äººã€æœ‹å‹ç­‰ï¼‰ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¤§å®¶éƒ½å¯ä»¥ä½¿ç”¨ç®¡ç†å‘˜èº«ä»½ç›´æ¥ç™»å½•ã€‚ä½†åœ¨æœåŠ¡å™¨ä¸Šå°±ä¸æ˜¯è¿™ç§æƒ…å†µäº†ï¼Œå¾€å¾€è¿è¡Œçš„æ•°æ®è¶Šé‡è¦ï¼ˆå¦‚æ¸¸æˆæ•°æ®ï¼‰ï¼Œä»·å€¼è¶Šé«˜ï¼ˆå¦‚ç”µå­å•†åŸæ•°æ®ã€é“¶è¡Œæ•°æ®ï¼‰ï¼Œåˆ™æœåŠ¡å™¨ä¸­å¯¹æƒé™çš„è®¾å®šå°±è¦è¶Šè¯¦ç»†ï¼Œç”¨æˆ·çš„åˆ†çº§ä¹Ÿè¦è¶Šæ˜ç¡®ã€‚\nå’Œ Windows ç³»ç»Ÿä¸åŒï¼ŒLinux ç³»ç»Ÿä¸ºæ¯ä¸ªæ–‡ä»¶éƒ½æ·»åŠ äº†å¾ˆå¤šçš„å±æ€§ï¼Œæœ€å¤§çš„ä½œç”¨å°±æ˜¯ç»´æŠ¤æ•°æ®çš„å®‰å…¨ã€‚ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œåœ¨ä½ çš„ Linux ç³»ç»Ÿä¸­ï¼Œå’Œç³»ç»ŸæœåŠ¡ç›¸å…³çš„æ–‡ä»¶é€šå¸¸åªæœ‰ root ç”¨æˆ·æ‰èƒ½è¯»æˆ–å†™ï¼Œå°±æ‹¿ /etc/shadow è¿™ä¸ªæ–‡ä»¶æ¥è¯´ï¼Œæ­¤æ–‡ä»¶è®°å½•äº†ç³»ç»Ÿä¸­æ‰€æœ‰ç”¨æˆ·çš„å¯†ç æ•°æ®ï¼Œéå¸¸é‡è¦ï¼Œå› æ­¤ç»ä¸èƒ½è®©ä»»ä½•äººè¯»å–ï¼ˆå¦åˆ™å¯†ç æ•°æ®ä¼šè¢«çªƒå–ï¼‰ï¼Œåªæœ‰ root æ‰å¯ä»¥æœ‰è¯»å–æƒé™ã€‚ æ­¤å¤–ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ªè½¯ä»¶å¼€å‘å›¢é˜Ÿï¼Œä½ å¸Œæœ›å›¢é˜Ÿä¸­çš„æ¯ä¸ªäººéƒ½å¯ä»¥ä½¿ç”¨æŸä¸€äº›ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œè€Œéå›¢é˜Ÿçš„å…¶ä»–äººåˆ™ä¸äºˆä»¥å¼€æ”¾ã€‚é€šè¿‡å‰é¢ç« èŠ‚çš„å­¦ä¹ æˆ‘ä»¬çŸ¥é“ï¼Œåªéœ€è¦å°†å›¢é˜Ÿä¸­çš„æ‰€æœ‰äººåŠ å…¥æ–°çš„ç¾¤ç»„ï¼Œå¹¶èµ‹äºˆæ­¤ç¾¤ç»„è¯»å†™ç›®å½•çš„æƒé™ï¼Œå³å¯å®ç°è¦æ±‚ã€‚åä¹‹ï¼Œå¦‚æœä½ çš„ç›®å½•æƒé™æ²¡æœ‰åšå¥½ï¼Œå°±å¾ˆéš¾é˜²æ­¢å…¶ä»–äººåœ¨ä½ çš„ç³»ç»Ÿä¸­ä¹±æã€‚ æ¯”å¦‚è¯´ï¼Œæœ¬æ¥ root ç”¨æˆ·æ‰èƒ½åšçš„å¼€å…³æœºã€ADSL æ‹¨æ¥ç¨‹åºï¼Œæ–°å¢æˆ–åˆ é™¤ç”¨æˆ·ç­‰å‘½ä»¤ï¼Œä¸€æ—¦å…è®¸ä»»ä½•äººæ‹¥æœ‰è¿™äº›æƒé™ï¼Œç³»ç»Ÿå¾ˆå¯èƒ½ä¼šç»å¸¸è«åå…¶å¦™çš„æŒ‚æ‰ã€‚è€Œä¸”ï¼Œä¸‡ä¸€ root ç”¨æˆ·çš„å¯†ç è¢«å…¶ä»–äººè·å–ï¼Œä»–ä»¬å°±å¯ä»¥ç™»å½•ä½ çš„ç³»ç»Ÿï¼Œä»äº‹ä¸€äº›åªæœ‰ root ç”¨æˆ·æ‰èƒ½æ‰§è¡Œçš„æ“ä½œï¼Œè¿™æ˜¯ç»å¯¹ä¸å…è®¸å‘ç”Ÿçš„ã€‚ å› æ­¤ï¼Œåœ¨æœåŠ¡å™¨ä¸Šï¼Œç»å¯¹ä¸æ˜¯æ‰€æœ‰çš„ç”¨æˆ·éƒ½ä½¿ç”¨ root èº«ä»½ç™»å½•ï¼Œè€Œè¦æ ¹æ®ä¸åŒçš„å·¥ä½œéœ€è¦å’ŒèŒä½éœ€è¦ï¼Œåˆç†åˆ†é…ç”¨æˆ·ç­‰çº§å’Œæƒé™ç­‰çº§ã€‚\n Linux ç³»ç»Ÿä¸­ï¼Œæ–‡ä»¶æˆ–ç›®å½•çš„æƒé™ä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨ ls å‘½ä»¤æŸ¥çœ‹ï¼Œä¾‹å¦‚ï¼š\n[root@localhost ~]# ls -al total 156 drwxr-x---. 4 root root 4096 Sep 8 14:06 . drwxr-xr-x. 23 root root 4096 Sep 8 14:21 .. -rw-------. 1 root root 1474 Sep 4 18:27 anaconda-ks.cfg -rw-------. 1 root root 199 Sep 8 17:14 .","title":"Linuxä¸‹çš„æƒé™ç®¡ç†"},{"content":"Linuxåå°è¿è¡Œç¨‹åº ä½¿ç”¨screen\nscreenä»‹ç» Screenæ˜¯ä¸€ä¸ªæ§åˆ¶å°åº”ç”¨ç¨‹åºï¼Œå…è®¸æ‚¨åœ¨ä¸€ä¸ªçª—å£ä¸­ä½¿ç”¨å¤šä¸ªç»ˆç«¯ä¼šè¯ã€‚è¯¥ç¨‹åºåœ¨shellä¼šè¯ä¸­è¿è¡Œï¼Œå¹¶å……å½“å…¶ä»–ç»ˆç«¯ä¼šè¯çš„å®¹å™¨å’Œç®¡ç†å™¨ï¼Œç±»ä¼¼äºçª—å£ç®¡ç†å™¨ç®¡ç†çª—å£çš„æ–¹å¼ã€‚\nåœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œåˆ›å»ºå¤šä¸ªç»ˆç«¯çª—å£æ˜¯ä¸å¯èƒ½æˆ–ä¸ç†æƒ³çš„ã€‚æ‚¨å¯èƒ½éœ€è¦åœ¨æ²¡æœ‰è¿è¡ŒXæœåŠ¡å™¨çš„æƒ…å†µä¸‹ç®¡ç†å¤šä¸ªæ§åˆ¶å°ä¼šè¯ï¼Œæ‚¨å¯èƒ½éœ€è¦è½»æ¾è®¿é—®è®¸å¤šè¿œç¨‹äº‘æœåŠ¡å™¨ï¼Œæˆ–è€…æ‚¨å¯èƒ½éœ€è¦åœ¨å¤„ç†å…¶ä»–ä»»åŠ¡æ—¶ç›‘è§†æ­£åœ¨è¿è¡Œçš„ç¨‹åºçš„è¾“å‡ºã€‚æ‰€æœ‰éœ€æ±‚éƒ½å¯ä»¥é€šè¿‡å±å¹•çš„å¼ºå¤§åŠŸèƒ½è½»æ¾è§£å†³ã€‚\nå®‰è£…srceen ubuntuä¸‹\nsudo apt-get install screen manjaroä¸‹\nsudo pacman -S screen åŸºæœ¬ä½¿ç”¨æ–¹æ³• ä½¿ç”¨screenå‘½ä»¤æ‰“å¼€ä¸€ä¸ªæ–°çš„çª—å£ï¼Œåœ¨å…¶ä¸­è¿è¡Œä½ æƒ³è¿è¡Œçš„è„šæœ¬ã€‚\nå¼€å§‹è¿è¡Œåï¼Œ æŒ‰ctrl+adé€€å‡ºçª—å£\nä½¿ç”¨screen -ré‡æ–°è¿›å…¥çª—å£\né™„ï¼šé‡å®šå‘    å‘½ä»¤ è¯´æ˜     command \u0026gt; file å°†è¾“å‡ºé‡å®šå‘åˆ° fileã€‚   command \u0026lt; file å°†è¾“å…¥é‡å®šå‘åˆ° fileã€‚   command \u0026raquo; file å°†è¾“å‡ºä»¥è¿½åŠ çš„æ–¹å¼é‡å®šå‘åˆ° fileã€‚   n \u0026gt; file å°†æ–‡ä»¶æè¿°ç¬¦ä¸º n çš„æ–‡ä»¶é‡å®šå‘åˆ° fileã€‚   n \u0026raquo; file å°†æ–‡ä»¶æè¿°ç¬¦ä¸º n çš„æ–‡ä»¶ä»¥è¿½åŠ çš„æ–¹å¼é‡å®šå‘åˆ° fileã€‚   n \u0026gt;\u0026amp; m å°†è¾“å‡ºæ–‡ä»¶ m å’Œ n åˆå¹¶ã€‚   n \u0026lt;\u0026amp; m å°†è¾“å…¥æ–‡ä»¶ m å’Œ n åˆå¹¶ã€‚   \u0026laquo; tag å°†å¼€å§‹æ ‡è®° tag å’Œç»“æŸæ ‡è®° tag ä¹‹é—´çš„å†…å®¹ä½œä¸ºè¾“å…¥ã€‚    Edited by Li Chang\n","permalink":"http://yangchnet.github.io/Dessert/posts/linux/linux%E5%90%8E%E5%8F%B0%E8%BF%90%E8%A1%8C%E7%A8%8B%E5%BA%8F/","summary":"Linuxåå°è¿è¡Œç¨‹åº ä½¿ç”¨screen\nscreenä»‹ç» Screenæ˜¯ä¸€ä¸ªæ§åˆ¶å°åº”ç”¨ç¨‹åºï¼Œå…è®¸æ‚¨åœ¨ä¸€ä¸ªçª—å£ä¸­ä½¿ç”¨å¤šä¸ªç»ˆç«¯ä¼šè¯ã€‚è¯¥ç¨‹åºåœ¨shellä¼šè¯ä¸­è¿è¡Œï¼Œå¹¶å……å½“å…¶ä»–ç»ˆç«¯ä¼šè¯çš„å®¹å™¨å’Œç®¡ç†å™¨ï¼Œç±»ä¼¼äºçª—å£ç®¡ç†å™¨ç®¡ç†çª—å£çš„æ–¹å¼ã€‚\nåœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œåˆ›å»ºå¤šä¸ªç»ˆç«¯çª—å£æ˜¯ä¸å¯èƒ½æˆ–ä¸ç†æƒ³çš„ã€‚æ‚¨å¯èƒ½éœ€è¦åœ¨æ²¡æœ‰è¿è¡ŒXæœåŠ¡å™¨çš„æƒ…å†µä¸‹ç®¡ç†å¤šä¸ªæ§åˆ¶å°ä¼šè¯ï¼Œæ‚¨å¯èƒ½éœ€è¦è½»æ¾è®¿é—®è®¸å¤šè¿œç¨‹äº‘æœåŠ¡å™¨ï¼Œæˆ–è€…æ‚¨å¯èƒ½éœ€è¦åœ¨å¤„ç†å…¶ä»–ä»»åŠ¡æ—¶ç›‘è§†æ­£åœ¨è¿è¡Œçš„ç¨‹åºçš„è¾“å‡ºã€‚æ‰€æœ‰éœ€æ±‚éƒ½å¯ä»¥é€šè¿‡å±å¹•çš„å¼ºå¤§åŠŸèƒ½è½»æ¾è§£å†³ã€‚\nå®‰è£…srceen ubuntuä¸‹\nsudo apt-get install screen manjaroä¸‹\nsudo pacman -S screen åŸºæœ¬ä½¿ç”¨æ–¹æ³• ä½¿ç”¨screenå‘½ä»¤æ‰“å¼€ä¸€ä¸ªæ–°çš„çª—å£ï¼Œåœ¨å…¶ä¸­è¿è¡Œä½ æƒ³è¿è¡Œçš„è„šæœ¬ã€‚\nå¼€å§‹è¿è¡Œåï¼Œ æŒ‰ctrl+adé€€å‡ºçª—å£\nä½¿ç”¨screen -ré‡æ–°è¿›å…¥çª—å£\né™„ï¼šé‡å®šå‘    å‘½ä»¤ è¯´æ˜     command \u0026gt; file å°†è¾“å‡ºé‡å®šå‘åˆ° fileã€‚   command \u0026lt; file å°†è¾“å…¥é‡å®šå‘åˆ° fileã€‚   command \u0026raquo; file å°†è¾“å‡ºä»¥è¿½åŠ çš„æ–¹å¼é‡å®šå‘åˆ° fileã€‚   n \u0026gt; file å°†æ–‡ä»¶æè¿°ç¬¦ä¸º n çš„æ–‡ä»¶é‡å®šå‘åˆ° fileã€‚   n \u0026raquo; file å°†æ–‡ä»¶æè¿°ç¬¦ä¸º n çš„æ–‡ä»¶ä»¥è¿½åŠ çš„æ–¹å¼é‡å®šå‘åˆ° fileã€‚   n \u0026gt;\u0026amp; m å°†è¾“å‡ºæ–‡ä»¶ m å’Œ n åˆå¹¶ã€‚   n \u0026lt;\u0026amp; m å°†è¾“å…¥æ–‡ä»¶ m å’Œ n åˆå¹¶ã€‚   \u0026laquo; tag å°†å¼€å§‹æ ‡è®° tag å’Œç»“æŸæ ‡è®° tag ä¹‹é—´çš„å†…å®¹ä½œä¸ºè¾“å…¥ã€‚    Edited by Li Chang","title":"Linuxåå°è¿è¡Œç¨‹åº"},{"content":"manjaroæ¢æº æœ‰å…³manjaroæ¢æºçš„æ–‡ä»¶ï¼š\n/etc/pacman.d/mirrorlist\nç½‘ä¸Šæ•™ç¨‹ï¼š\nsudo pacman-mirrors -gb testing -c China //é€‰æ‹©ä¸­å›½æºå¹¶æ›´æ–° sudo pacman -Syyu //æ›´æ–°ç³»ç»Ÿ manjaroæ›´æ–°\npacman -Sc //æ¸…ç©ºå¹¶ä¸”ä¸‹è½½æ–°æ•°æ® pacman-mirrors -gb testing -c China //æ›´æ–°æº or pacman-mirrors -c China -g //æ›´æ–°æº pacman -Syu //æ›´æ–° pacman -Syy //æ›´æ–°æºæ•°æ®åº“ pacman -Syyu //å®‰è£…æ›´æ–° ","permalink":"http://yangchnet.github.io/Dessert/posts/linux/manjaro%E6%8D%A2%E6%BA%90/","summary":"manjaroæ¢æº æœ‰å…³manjaroæ¢æºçš„æ–‡ä»¶ï¼š\n/etc/pacman.d/mirrorlist\nç½‘ä¸Šæ•™ç¨‹ï¼š\nsudo pacman-mirrors -gb testing -c China //é€‰æ‹©ä¸­å›½æºå¹¶æ›´æ–° sudo pacman -Syyu //æ›´æ–°ç³»ç»Ÿ manjaroæ›´æ–°\npacman -Sc //æ¸…ç©ºå¹¶ä¸”ä¸‹è½½æ–°æ•°æ® pacman-mirrors -gb testing -c China //æ›´æ–°æº or pacman-mirrors -c China -g //æ›´æ–°æº pacman -Syu //æ›´æ–° pacman -Syy //æ›´æ–°æºæ•°æ®åº“ pacman -Syyu //å®‰è£…æ›´æ–° ","title":"manjaroæ¢æº"},{"content":"1. å®‰è£…mysql sudo apt update sudo apt install mysql-server 2. é…ç½®mysql è¿è¡Œ security script\nsudo mysql_secure_installation æ ¹æ®æç¤ºè¿›è¡Œä¸€äº›å¿…è¦çš„é…ç½®\nè¿›å…¥mysql\nsudo mysql æ¥ä¸‹æ¥ï¼Œé€šè¿‡ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥æ¯ä¸ª MySQL ç”¨æˆ·å¸æˆ·ä½¿ç”¨çš„è®¤è¯æ–¹æ³•ï¼š\nSELECT user,authentication_string,plugin,host FROM mysql.user; åœ¨è¾“å‡ºä¸­\n+------------------+-------------------------------------------+-----------------------+-----------+ | user | authentication_string | plugin | host | +------------------+-------------------------------------------+-----------------------+-----------+ | root | | auth_socket | localhost | | mysql.session | *THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE | mysql_native_password | localhost | | mysql.sys | *THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE | mysql_native_password | localhost | | debian-sys-maint | *E6CD266C880D217453293A0247D0142C9CF52730 | mysql_native_password | localhost | +------------------+-------------------------------------------+-----------------------+-----------+ å¯ä»¥çœ‹å‡ºï¼Œrootç”¨æˆ·ä½¿ç”¨æ’ä»¶è¿›è¡Œèº«ä»½éªŒè¯ï¼ˆè¿›å…¥æ—¶ä¸éœ€è¦è¾“å…¥å¯†ç ï¼‰ã€‚å¦‚æœæƒ³è¦rootç”¨æˆ·ä½¿ç”¨å¯†ç ç™»é™†ï¼Œå¯ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡Œé…ç½®ï¼š\nALTER USER \u0026#39;root\u0026#39;@\u0026#39;localhost\u0026#39; IDENTIFIED WITH mysql_native_password BY \u0026#39;password\u0026#39;;  å°†ä¸Šé¢çš„passwordæ›´æ”¹ä¸ºä½ æƒ³è¦è®¾ç½®çš„å¯†ç \n è¿™æ¡å‘½ä»¤å®Œæˆåï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤é‡æ–°åˆ·æ–°é…ç½®ï¼š\nFLUSH PRIVILEGES; å†æ¬¡æ£€æŸ¥ç”¨æˆ·è®¤è¯æ–¹æ³•\nSELECT user,authentication_string,plugin,host FROM mysql.user; è¾“å‡ºä¸ºï¼š\n+------------------+-------------------------------------------+-----------------------+-----------+ | user | authentication_string | plugin | host | +------------------+-------------------------------------------+-----------------------+-----------+ | root | *35235E6B287036E68CD22314AFE8D80A0BB26D79 | mysql_native_password | localhost | | mysql.session | *THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE | mysql_native_password | localhost | | mysql.sys | *THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE | mysql_native_password | localhost | | debian-sys-maint | *E6CD266C880D217453293A0247D0142C9CF52730 | mysql_native_password | localhost | +------------------+-------------------------------------------+-----------------------+-----------+ 3. æ–°å»ºä¸€ä¸ªç”¨æˆ· æ–°å»ºä¸€ä¸ªç”¨æˆ·\nCREATE USER \u0026#39;sammy\u0026#39;@\u0026#39;localhost\u0026#39; IDENTIFIED BY \u0026#39;password\u0026#39;;  localhostè¡¨ç¤ºåªå…è®¸æœ¬åœ°è®¿é—®ï¼Œå¦‚æœæƒ³è¦å…è®¸è¿œç¨‹è®¿é—®ï¼Œå¯ä½¿ç”¨\u0026rsquo;user'@'%'ï¼Œ %è¡¨ç¤ºæ‰€æœ‰ç½‘ç»œã€‚\n æ›´æ”¹ç”¨æˆ·æƒé™\nGRANT ALL PRIVILEGES ON *.* TO \u0026#39;sammy\u0026#39;@\u0026#39;localhost\u0026#39; WITH GRANT OPTION;  è¿™é‡Œéœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œæˆ‘ä»¬ä¸éœ€è¦å†ä½¿ç”¨FLUSH PRIVILEGES;æ¥åˆ·æ–°é…ç½®ï¼Œå› ä¸ºåªæœ‰åœ¨grantè¡¨ä¸Šè¿›è¡Œè¿‡INSERT, UPDATE, æˆ–è€…DELETEä¹‹åæ‰éœ€è¦ç”¨åˆ°FLUSH PRIVILEGES;ã€‚Because you created a new user, instead of modifying an existing one, FLUSH PRIVILEGES is unnecessary here.\n é€€å‡º\nexit 4. Test Mysql æ£€æŸ¥mysqlæœåŠ¡çŠ¶æ€\nsystemctl status mysql.service è¾“å‡ºä¸ºï¼š\nâ— mysql.service - MySQL Community Server Loaded: loaded (/lib/systemd/system/mysql.service; enabled; vendor preset: enabled) Active: active (running) since Sat 2021-02-20 16:09:11 CST; 27min ago Process: 31328 ExecStart=/usr/sbin/mysqld --daemonize --pid-file=/run/mysqld/mysqld.pid (code=exited, status=0/SUCCESS) Process: 31319 ExecStartPre=/usr/share/mysql/mysql-systemd-start pre (code=exited, status=0/SUCCESS) Main PID: 31330 (mysqld) Tasks: 28 (limit: 2341) CGroup: /system.slice/mysql.service â””â”€31330 /usr/sbin/mysqld --daemonize --pid-file=/run/mysqld/mysqld.pid ","permalink":"http://yangchnet.github.io/Dessert/posts/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql%E5%AE%89%E8%A3%85linux/","summary":"1. å®‰è£…mysql sudo apt update sudo apt install mysql-server 2. é…ç½®mysql è¿è¡Œ security script\nsudo mysql_secure_installation æ ¹æ®æç¤ºè¿›è¡Œä¸€äº›å¿…è¦çš„é…ç½®\nè¿›å…¥mysql\nsudo mysql æ¥ä¸‹æ¥ï¼Œé€šè¿‡ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥æ¯ä¸ª MySQL ç”¨æˆ·å¸æˆ·ä½¿ç”¨çš„è®¤è¯æ–¹æ³•ï¼š\nSELECT user,authentication_string,plugin,host FROM mysql.user; åœ¨è¾“å‡ºä¸­\n+------------------+-------------------------------------------+-----------------------+-----------+ | user | authentication_string | plugin | host | +------------------+-------------------------------------------+-----------------------+-----------+ | root | | auth_socket | localhost | | mysql.session | *THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE | mysql_native_password | localhost | | mysql.sys | *THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE | mysql_native_password | localhost | | debian-sys-maint | *E6CD266C880D217453293A0247D0142C9CF52730 | mysql_native_password | localhost | +------------------+-------------------------------------------+-----------------------+-----------+ å¯ä»¥çœ‹å‡ºï¼Œrootç”¨æˆ·ä½¿ç”¨æ’ä»¶è¿›è¡Œèº«ä»½éªŒè¯ï¼ˆè¿›å…¥æ—¶ä¸éœ€è¦è¾“å…¥å¯†ç ï¼‰ã€‚å¦‚æœæƒ³è¦rootç”¨æˆ·ä½¿ç”¨å¯†ç ç™»é™†ï¼Œå¯ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡Œé…ç½®ï¼š","title":"MySqlå®‰è£…å’Œé…ç½®"},{"content":"Mysqlæ— æ³•è¿œç¨‹è®¿é—® åœ¨ä½¿ç”¨navicatè¿œç¨‹è¿æ¥é˜¿é‡Œäº‘çš„æ—¶å€™ï¼Œå‡ºç°â€œ2003 can t connect to mysql server on 10061â€é”™è¯¯\nç»è¿‡è‰°éš¾çš„è°·æ­Œç™¾åº¦stackflowåï¼Œå‘ç°æ˜¯3306ç«¯å£æ²¡æœ‰ç›‘å¬å¤–éƒ¨è¿æ¥ï¼Œåªæ¥æ”¶å†…éƒ¨ipè®¿é—®ã€‚\nè§£å†³æ–¹æ¡ˆ  é¦–å…ˆä¿è¯é˜¿é‡Œäº‘æœåŠ¡å™¨3306ç«¯å£å¼€æ”¾ ä½¿ç”¨netstat -ntpl |grep 3306å‘½ä»¤æŸ¥çœ‹3306ç«¯å£çŠ¶æ€ tcp 0 0 127.0.0.1:22 0.0.0.0:* LISTEN - å¯çœ‹å‡ºåªæ¥æ”¶å†…éƒ¨è®¿é—® æ‰“å¼€/etc/mysql/mysql.conf.d/mysqld.cnf(ç½‘ä¸Šå¤§éƒ¨åˆ†è¯´æ˜¯:/etc/mysql/my.cnf) å°†bind-address = 127.0.0.1æ”¹æˆbind-address = 0.0.0.0 å†æ¬¡ä½¿ç”¨netstat -ntpl |grep 3306å‘½ä»¤æŸ¥çœ‹ tcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN - æ­¤æ—¶3306ç«¯å£å¼€å§‹ç›‘å¬æ‰€æœ‰ç½‘ç»œè®¿é—® **å¦‚æœæ˜¯ipv6ä¸»æœºï¼Œåˆ™æ”¹ä¸º bind-address = :: ,è¡¨ç¤ºç›‘å¬æ‰€æœ‰ç½‘ç»œ**  ä¸»æœº\u0026rsquo;xxx.xx.xxx.xxx\u0026rsquo;ä¸å…è®¸è¿æ¥åˆ°æ­¤MySQLæœåŠ¡å™¨ åœ¨è¿›è¡Œè¿æ¥ipv6ä¸»æœºçš„æ—¶å€™å‡ºç°äº†å¦‚ä¸‹é—®é¢˜ï¼šdjango.db.utils.InternalError: (1130, \u0026ldquo;Host \u0026lsquo;2409:8930:1450:316:6179:c54:5901:2f2b\u0026rsquo; is not allowed to connect to this MySQL server\u0026rdquo;) è§£å†³æ–¹æ³•å¦‚ä¸‹ï¼š\nmysql\u0026gt; CREATE USER \u0026#39;monty\u0026#39;@\u0026#39;localhost\u0026#39; IDENTIFIED BY \u0026#39;some_pass\u0026#39;; mysql\u0026gt; GRANT ALL PRIVILEGES ON *.* TO \u0026#39;monty\u0026#39;@\u0026#39;localhost\u0026#39; -\u0026gt; WITH GRANT OPTION; mysql\u0026gt; CREATE USER \u0026#39;monty\u0026#39;@\u0026#39;%\u0026#39; IDENTIFIED BY \u0026#39;some_pass\u0026#39;; mysql\u0026gt; GRANT ALL PRIVILEGES ON *.* TO \u0026#39;monty\u0026#39;@\u0026#39;%\u0026#39; -\u0026gt; WITH GRANT OPTION; \u0026lsquo;user\u0026rsquo;@'%\u0026lsquo;åé¢çš„ç™¾åˆ†å·ä»£è¡¨æ‰€æœ‰ç½‘ç»œ\næœ‰æ—¶å€™ç”¨rootç”¨æˆ·è¿˜ä¸è¡Œï¼Œè¦é‡æ–°å»ºä¸€ä¸ªç”¨æˆ· ","permalink":"http://yangchnet.github.io/Dessert/posts/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql%E6%97%A0%E6%B3%95%E8%BF%9C%E7%A8%8B%E8%AE%BF%E9%97%AE/","summary":"Mysqlæ— æ³•è¿œç¨‹è®¿é—® åœ¨ä½¿ç”¨navicatè¿œç¨‹è¿æ¥é˜¿é‡Œäº‘çš„æ—¶å€™ï¼Œå‡ºç°â€œ2003 can t connect to mysql server on 10061â€é”™è¯¯\nç»è¿‡è‰°éš¾çš„è°·æ­Œç™¾åº¦stackflowåï¼Œå‘ç°æ˜¯3306ç«¯å£æ²¡æœ‰ç›‘å¬å¤–éƒ¨è¿æ¥ï¼Œåªæ¥æ”¶å†…éƒ¨ipè®¿é—®ã€‚\nè§£å†³æ–¹æ¡ˆ  é¦–å…ˆä¿è¯é˜¿é‡Œäº‘æœåŠ¡å™¨3306ç«¯å£å¼€æ”¾ ä½¿ç”¨netstat -ntpl |grep 3306å‘½ä»¤æŸ¥çœ‹3306ç«¯å£çŠ¶æ€ tcp 0 0 127.0.0.1:22 0.0.0.0:* LISTEN - å¯çœ‹å‡ºåªæ¥æ”¶å†…éƒ¨è®¿é—® æ‰“å¼€/etc/mysql/mysql.conf.d/mysqld.cnf(ç½‘ä¸Šå¤§éƒ¨åˆ†è¯´æ˜¯:/etc/mysql/my.cnf) å°†bind-address = 127.0.0.1æ”¹æˆbind-address = 0.0.0.0 å†æ¬¡ä½¿ç”¨netstat -ntpl |grep 3306å‘½ä»¤æŸ¥çœ‹ tcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN - æ­¤æ—¶3306ç«¯å£å¼€å§‹ç›‘å¬æ‰€æœ‰ç½‘ç»œè®¿é—® **å¦‚æœæ˜¯ipv6ä¸»æœºï¼Œåˆ™æ”¹ä¸º bind-address = :: ,è¡¨ç¤ºç›‘å¬æ‰€æœ‰ç½‘ç»œ**  ä¸»æœº\u0026rsquo;xxx.xx.xxx.xxx\u0026rsquo;ä¸å…è®¸è¿æ¥åˆ°æ­¤MySQLæœåŠ¡å™¨ åœ¨è¿›è¡Œè¿æ¥ipv6ä¸»æœºçš„æ—¶å€™å‡ºç°äº†å¦‚ä¸‹é—®é¢˜ï¼šdjango.db.utils.InternalError: (1130, \u0026ldquo;Host \u0026lsquo;2409:8930:1450:316:6179:c54:5901:2f2b\u0026rsquo; is not allowed to connect to this MySQL server\u0026rdquo;) è§£å†³æ–¹æ³•å¦‚ä¸‹ï¼š\nmysql\u0026gt; CREATE USER \u0026#39;monty\u0026#39;@\u0026#39;localhost\u0026#39; IDENTIFIED BY \u0026#39;some_pass\u0026#39;; mysql\u0026gt; GRANT ALL PRIVILEGES ON *.","title":"Mysqlæ— æ³•è¿œç¨‹è®¿é—®"},{"content":"Nginxè´Ÿè½½å‡è¡¡é…ç½®\u0026ndash;ç®€ä»‹  åœ¨ä½¿ç”¨tomcatéƒ¨ç½²é™æ€ç½‘ç«™çš„æ—¶å€™ï¼Œç”±äºæœåŠ¡å™¨æ¯”è¾ƒåƒåœ¾ï¼Œæ‰€ä»¥å¦‚æœå¤šäººåŒæ—¶è®¿é—®çš„è¯ï¼Œå¯èƒ½ä¼šé€ æˆå¡é¡¿ï¼Œå½±å“ç”¨æˆ·ä½“éªŒã€‚æ‰€ä»¥æƒ³åˆ°äº†ä½¿ç”¨è´Ÿè½½å‡è¡¡ã€‚\n 1. ä»€ä¹ˆæ˜¯è´Ÿè½½å‡è¡¡ è´Ÿè½½å¹³è¡¡æ˜¯é«˜å¯ç”¨æ€§åŸºç¡€æ¶æ„çš„å…³é”®ç»„ä»¶ï¼Œé€šå¸¸ç”¨äºé€šè¿‡åœ¨å¤šä¸ªæœåŠ¡å™¨ä¹‹é—´åˆ†é…å·¥ä½œè´Ÿè½½æ¥æé«˜ç½‘ç«™ï¼Œåº”ç”¨ç¨‹åºï¼Œæ•°æ®åº“å’Œå…¶ä»–æœåŠ¡çš„æ€§èƒ½å’Œå¯é æ€§ã€‚\næ²¡æœ‰è´Ÿè½½å¹³è¡¡çš„WebåŸºç¡€ç»“æ„å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š\nåœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œç”¨æˆ·ç›´æ¥è¿æ¥åˆ°webæœåŠ¡å™¨yourdomain.comã€‚å¦‚æœæ­¤å•ä¸ªWebæœåŠ¡å™¨å‡ºç°æ•…éšœï¼Œç”¨æˆ·å°†æ— æ³•å†è®¿é—®è¯¥ç½‘ç«™ã€‚æ­¤å¤–ï¼Œå¦‚æœè®¸å¤šç”¨æˆ·å°è¯•åŒæ—¶è®¿é—®æœåŠ¡å™¨å¹¶ä¸”æ— æ³•å¤„ç†è´Ÿè½½ï¼Œåˆ™å¯èƒ½ä¼šé‡åˆ°åŠ è½½æ—¶é—´ç¼“æ…¢æˆ–æ ¹æœ¬æ— æ³•è¿æ¥çš„æƒ…å†µã€‚\né€šè¿‡åœ¨åç«¯å¼•å…¥è´Ÿè½½å‡è¡¡å™¨å’Œè‡³å°‘ä¸€ä¸ªé¢å¤–çš„WebæœåŠ¡å™¨ï¼Œå¯ä»¥å‡è½»æ­¤å•ç‚¹æ•…éšœã€‚é€šå¸¸ï¼Œæ‰€æœ‰åç«¯æœåŠ¡å™¨éƒ½å°†æä¾›ç›¸åŒçš„å†…å®¹ï¼Œä»¥ä¾¿ç”¨æˆ·æ— è®ºå“ªä¸ªæœåŠ¡å™¨å“åº”éƒ½ä¼šæ”¶åˆ°ä¸€è‡´çš„å†…å®¹ã€‚ åœ¨ä¸Šé¢è¯´æ˜çš„ç¤ºä¾‹ä¸­ï¼Œç”¨æˆ·è®¿é—®è´Ÿè½½å‡è¡¡å™¨ï¼Œè´Ÿè½½å‡è¡¡å™¨å°†ç”¨æˆ·çš„è¯·æ±‚è½¬å‘åˆ°åç«¯æœåŠ¡å™¨ï¼Œåç«¯æœåŠ¡å™¨ç„¶åç›´æ¥å“åº”ç”¨æˆ·çš„è¯·æ±‚ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå•ç‚¹æ•…éšœç°åœ¨æ˜¯è´Ÿè½½å¹³è¡¡å™¨æœ¬èº«ã€‚è¿™å¯ä»¥é€šè¿‡å¼•å…¥ç¬¬äºŒä¸ªè´Ÿè½½å‡è¡¡å™¨æ¥ç¼“è§£.\n2. è´Ÿè½½å‡è¡¡å™¨å¯ä»¥å¤„ç†ä»€ä¹ˆæ ·çš„æµé‡   HTTP - æ ‡å‡†HTTPå¹³è¡¡åŸºäºæ ‡å‡†HTTPæœºåˆ¶å®šå‘è¯·æ±‚ã€‚è´Ÿè½½å‡è¡¡å™¨è®¾ç½®X-Forwarded-Forï¼ŒX-Forwarded-Protoä»¥åŠX-Forwarded-Portå¤´ï¼Œæä¾›æœ‰å…³åŸå§‹è¯·æ±‚çš„åç«¯ä¿¡æ¯ã€‚\n  HTTPS - HTTPSå¹³è¡¡åŠŸèƒ½ä¸HTTPå¹³è¡¡åŠŸèƒ½ç›¸åŒï¼Œä½†å¢åŠ äº†åŠ å¯†åŠŸèƒ½ã€‚åŠ å¯†ä»¥ä¸¤ç§æ–¹å¼ä¹‹ä¸€å¤„ç†ï¼šä½¿ç”¨SSLç›´é€šï¼Œä¸€ç›´ä¿æŒåŠ å¯†åˆ°åç«¯ï¼Œæˆ–è€…ä½¿ç”¨SSLç»ˆæ­¢ï¼Œå°†è§£å¯†è´Ÿæ‹…æ”¾åœ¨è´Ÿè½½å‡è¡¡å™¨ä¸Šï¼Œä½†å°†æœªåŠ å¯†çš„æµé‡å‘é€åˆ°åç«¯ã€‚\n  TCP - å¯¹äºä¸ä½¿ç”¨HTTPæˆ–HTTPSçš„åº”ç”¨ç¨‹åºï¼Œä¹Ÿå¯ä»¥å¹³è¡¡TCPæµé‡ã€‚ä¾‹å¦‚ï¼Œæ•°æ®åº“é›†ç¾¤çš„æµé‡å¯ä»¥åˆ†å¸ƒåœ¨æ‰€æœ‰æœåŠ¡å™¨ä¸Šã€‚\n  UDP\u0026ndash;æœ€è¿‘ï¼Œä¸€äº›è´Ÿè½½å‡è¡¡å™¨å¢åŠ äº†å¯¹ä½¿ç”¨UDPçš„æ ¸å¿ƒäº’è”ç½‘åè®®ï¼ˆå¦‚DNSå’Œsyslogdï¼‰çš„è´Ÿè½½å¹³è¡¡çš„æ”¯æŒã€‚\n  è¿™äº›è½¬å‘è§„åˆ™å°†å®šä¹‰è´Ÿè½½å‡è¡¡å™¨æœ¬èº«çš„åè®®å’Œç«¯å£ï¼Œå¹¶å°†å®ƒä»¬æ˜ å°„åˆ°è´Ÿè½½å‡è¡¡å™¨å°†ç”¨äºå°†æµé‡è·¯ç”±åˆ°åç«¯çš„åè®®å’Œç«¯å£ã€‚\n3. è´Ÿè½½å‡è¡¡å™¨å¦‚ä½•é€‰æ‹©åç«¯æœåŠ¡å™¨ è´Ÿè½½å‡è¡¡å™¨æ ¹æ®ä¸¤ä¸ªå› ç´ çš„ç»„åˆé€‰æ‹©å°†è¯·æ±‚è½¬å‘åˆ°å“ªä¸ªæœåŠ¡å™¨ã€‚ä»–ä»¬å°†é¦–å…ˆç¡®ä¿ä»–ä»¬å¯ä»¥é€‰æ‹©çš„ä»»ä½•æœåŠ¡å™¨å®é™…ä¸Šå¯¹è¯·æ±‚åšå‡ºé€‚å½“çš„å“åº”ï¼Œç„¶åä½¿ç”¨é¢„å…ˆé…ç½®çš„è§„åˆ™ä»è¯¥å¥åº·æ± ä¸­è¿›è¡Œé€‰æ‹©ã€‚\n3.1 å¥åº·æ£€æŸ¥ è´Ÿè½½å‡è¡¡å™¨åº”ä»…å°†æµé‡è½¬å‘åˆ°â€œå¥åº·â€çš„åç«¯æœåŠ¡å™¨ã€‚è¦ç›‘è§†åç«¯æœåŠ¡å™¨çš„è¿è¡ŒçŠ¶å†µï¼Œè¿è¡ŒçŠ¶å†µæ£€æŸ¥ä¼šå®šæœŸå°è¯•ä½¿ç”¨è½¬å‘è§„åˆ™å®šä¹‰çš„åè®®å’Œç«¯å£è¿æ¥åˆ°åç«¯æœåŠ¡å™¨ï¼Œä»¥ç¡®ä¿æœåŠ¡å™¨æ­£åœ¨ä¾¦å¬ã€‚å¦‚æœæœåŠ¡å™¨æœªé€šè¿‡è¿è¡ŒçŠ¶å†µæ£€æŸ¥ï¼Œå› æ­¤æ— æ³•æä¾›è¯·æ±‚ï¼Œåˆ™ä¼šè‡ªåŠ¨å°†å…¶ä»æ± ä¸­åˆ é™¤ï¼Œå¹¶ä¸”åœ¨å†æ¬¡å“åº”è¿è¡ŒçŠ¶å†µæ£€æŸ¥ä¹‹å‰ï¼Œæµé‡å°†ä¸ä¼šè½¬å‘ç»™å®ƒã€‚\n3.2 è´Ÿè½½å¹³è¡¡ç®—æ³• ä½¿ç”¨çš„è´Ÿè½½å¹³è¡¡ç®—æ³•ç¡®å®šå°†é€‰æ‹©åç«¯ä¸­çš„å“ªäº›æ­£å¸¸æœåŠ¡å™¨ã€‚ä¸€äº›å¸¸ç”¨çš„ç®—æ³•æ˜¯ï¼š\n  Round Robin - Round Robinæ„å‘³ç€å°†æŒ‰é¡ºåºé€‰æ‹©æœåŠ¡å™¨ã€‚è´Ÿè½½å‡è¡¡å™¨å°†åœ¨å…¶åˆ—è¡¨ä¸­ä¸ºç¬¬ä¸€ä¸ªè¯·æ±‚é€‰æ‹©ç¬¬ä¸€ä¸ªæœåŠ¡å™¨ï¼Œç„¶åæŒ‰é¡ºåºå‘ä¸‹ç§»åŠ¨åˆ—è¡¨ï¼Œå½“å®ƒåˆ°è¾¾ç»“å°¾æ—¶ä»é¡¶éƒ¨å¼€å§‹ã€‚\n  least_conn - least_connæ„å‘³ç€è´Ÿè½½å‡è¡¡å™¨å°†é€‰æ‹©è¿æ¥æœ€å°‘çš„æœåŠ¡å™¨ï¼Œå¹¶ä¸”å½“æµé‡å¯¼è‡´æ›´é•¿çš„ä¼šè¯æ—¶å»ºè®®ä½¿ç”¨ã€‚\n  ip_hashï¼šæ­¤å¹³è¡¡ç®—æ³•æ ¹æ®å®¢æˆ·ç«¯çš„IPåœ°å€å°†è¯·æ±‚åˆ†å‘åˆ°ä¸åŒçš„æœåŠ¡å™¨ã€‚å‰ä¸‰ä¸ªå…«ä½å­—èŠ‚ç”¨ä½œå†³å®šæœåŠ¡å™¨å¤„ç†è¯·æ±‚çš„å¯†é’¥ã€‚ç»“æœæ˜¯å®¢æˆ·ç«¯æ¯æ¬¡éƒ½å€¾å‘äºç”±åŒä¸€æœåŠ¡å™¨æä¾›æœåŠ¡ï¼Œè¿™æœ‰åŠ©äºä¼šè¯ä¸€è‡´æ€§ã€‚\n  hashï¼šæ­¤å¹³è¡¡ç®—æ³•ä¸»è¦ç”¨äºmemcachedä»£ç†ã€‚åŸºäºä»»æ„æä¾›çš„æ•£åˆ—å¯†é’¥çš„å€¼æ¥åˆ’åˆ†æœåŠ¡å™¨ã€‚è¿™å¯ä»¥æ˜¯æ–‡æœ¬ï¼Œå˜é‡æˆ–ç»„åˆã€‚è¿™æ˜¯å”¯ä¸€éœ€è¦ç”¨æˆ·æä¾›æ•°æ®çš„å¹³è¡¡æ–¹æ³•ï¼Œè¿™æ˜¯åº”è¯¥ç”¨äºå“ˆå¸Œçš„å¯†é’¥ã€‚\n  ç®¡ç†å‘˜å¯ç”¨çš„ç®—æ³•å–å†³äºæ‰€ä½¿ç”¨çš„ç‰¹å®šè´Ÿè½½å¹³è¡¡æŠ€æœ¯ã€‚\n3.3 è´Ÿè½½å¹³è¡¡å™¨å¦‚ä½•å¤„ç†çŠ¶æ€ æŸäº›åº”ç”¨ç¨‹åºè¦æ±‚ç”¨æˆ·ç»§ç»­è¿æ¥åˆ°åŒä¸€åç«¯æœåŠ¡å™¨ã€‚Sourceç®—æ³•æ ¹æ®å®¢æˆ·ç«¯IPä¿¡æ¯åˆ›å»ºå…³è”ã€‚åœ¨Webåº”ç”¨ç¨‹åºçº§åˆ«å®ç°æ­¤ç›®çš„çš„å¦ä¸€ç§æ–¹æ³•æ˜¯é€šè¿‡ç²˜æ€§ä¼šè¯ï¼Œå…¶ä¸­è´Ÿè½½å¹³è¡¡å™¨è®¾ç½®cookieï¼Œå¹¶ä¸”æ¥è‡ªè¯¥ä¼šè¯çš„æ‰€æœ‰è¯·æ±‚éƒ½å®šå‘åˆ°åŒä¸€ç‰©ç†æœåŠ¡å™¨ã€‚\n4. å†—ä½™è´Ÿè½½å‡è¡¡å™¨ è¦å°†è´Ÿè½½å‡è¡¡å™¨ä½œä¸ºå•ç‚¹æ•…éšœç§»é™¤ï¼Œå¯ä»¥å°†ç¬¬äºŒä¸ªè´Ÿè½½å‡è¡¡å™¨è¿æ¥åˆ°ç¬¬ä¸€ä¸ªè´Ÿè½½å‡è¡¡å™¨ä»¥å½¢æˆä¸€ä¸ªé›†ç¾¤ï¼Œå…¶ä¸­æ¯ä¸ªè´Ÿè½½å‡è¡¡å™¨ç›‘æ§å…¶ä»–è´Ÿè½½å¹³è¡¡å™¨çš„è¿è¡ŒçŠ¶å†µã€‚æ¯ä¸ªäººéƒ½å…·æœ‰åŒæ ·çš„æ•…éšœæ£€æµ‹å’Œæ¢å¤èƒ½åŠ›ã€‚å¦‚æœä¸»è´Ÿè½½å‡è¡¡å™¨å‘ç”Ÿæ•…éšœï¼ŒDNSå¿…é¡»å°†ç”¨æˆ·å¸¦åˆ°ç¬¬äºŒä¸ªè´Ÿè½½å‡è¡¡å™¨ã€‚ç”±äºDNSæ›´æ”¹å¯èƒ½éœ€è¦èŠ±è´¹å¤§é‡æ—¶é—´åœ¨Internetä¸Šä¼ æ’­å¹¶è‡ªåŠ¨è¿›è¡Œæ­¤æ•…éšœè½¬ç§»ï¼Œå› æ­¤è®¸å¤šç®¡ç†å‘˜å°†ä½¿ç”¨å…è®¸çµæ´»IPåœ°å€é‡æ–°æ˜ å°„çš„ç³»ç»Ÿï¼Œä¾‹å¦‚æµ®åŠ¨IPã€‚æŒ‰éœ€IPåœ°å€é‡æ–°æ˜ å°„é€šè¿‡æä¾›å¯åœ¨éœ€è¦æ—¶è½»æ¾é‡æ–°æ˜ å°„çš„é™æ€IPåœ°å€ï¼Œæ¶ˆé™¤äº†DNSæ›´æ”¹ä¸­å›ºæœ‰çš„ä¼ æ’­å’Œç¼“å­˜é—®é¢˜ã€‚åŸŸåå¯ä»¥ä¿æŒä¸ç›¸åŒçš„IPåœ°å€å…³è”ï¼Œè€ŒIPåœ°å€æœ¬èº«åœ¨æœåŠ¡å™¨ä¹‹é—´ç§»åŠ¨ã€‚\nè¿™å°±æ˜¯ä½¿ç”¨æµ®åŠ¨IPçš„é«˜å¯ç”¨æ€§åŸºç¡€æ¶æ„çš„å¤–è§‚ï¼š ä½¿ç”¨ 1. ä¸€èˆ¬ä»£ç†ä¿¡æ¯ å¦‚æœæ‚¨è¿‡å»ä»…ä½¿ç”¨WebæœåŠ¡å™¨è¿›è¡Œç®€å•çš„å•æœåŠ¡å™¨é…ç½®ï¼Œæ‚¨å¯èƒ½æƒ³çŸ¥é“ä¸ºä»€ä¹ˆéœ€è¦ä»£ç†è¯·æ±‚ã€‚\nä»Nginxä»£ç†å…¶ä»–æœåŠ¡å™¨çš„ä¸€ä¸ªåŸå› æ˜¯èƒ½å¤Ÿæ‰©å±•æ‚¨çš„åŸºç¡€æ¶æ„ã€‚æ„å»ºNginxæ˜¯ä¸ºäº†åŒæ—¶å¤„ç†è®¸å¤šå¹¶å‘è¿æ¥ã€‚è¿™ä½¿å…¶æˆä¸ºå®¢æˆ·è”ç³»ç‚¹çš„ç†æƒ³é€‰æ‹©ã€‚æœåŠ¡å™¨å¯ä»¥å°†è¯·æ±‚ä¼ é€’ç»™ä»»æ„æ•°é‡çš„åç«¯æœåŠ¡å™¨ï¼Œä»¥å¤„ç†å¤§éƒ¨åˆ†å·¥ä½œï¼Œä»è€Œåœ¨æ•´ä¸ªåŸºç¡€æ¶æ„ä¸­åˆ†æ•£è´Ÿè½½ã€‚æ­¤è®¾è®¡è¿˜ä¸ºæ‚¨æä¾›äº†è½»æ¾æ·»åŠ åç«¯æœåŠ¡å™¨æˆ–æ ¹æ®ç»´æŠ¤éœ€è¦å°†å…¶ä¸‹è½½çš„çµæ´»æ€§ã€‚\nhttpä»£ç†å¯èƒ½æœ‰ç”¨çš„å¦ä¸€ä¸ªå®ä¾‹æ˜¯ä½¿ç”¨å¯èƒ½æ— æ³•æ„å»ºçš„åº”ç”¨ç¨‹åºæœåŠ¡å™¨æ¥ç›´æ¥å¤„ç†æ¥è‡ªç”Ÿäº§ç¯å¢ƒä¸­çš„å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚è®¸å¤šæ¡†æ¶éƒ½åŒ…å«WebæœåŠ¡å™¨ï¼Œä½†å¤§å¤šæ•°æ¡†æ¶éƒ½ä¸å¦‚Nginxç­‰é«˜æ€§èƒ½æœåŠ¡å™¨é‚£ä¹ˆå¼ºå¤§ã€‚å°†Nginxæ”¾åœ¨è¿™äº›æœåŠ¡å™¨ä¹‹å‰å¯ä»¥ä¸ºç”¨æˆ·å¸¦æ¥æ›´å¥½çš„ä½“éªŒå¹¶æé«˜å®‰å…¨æ€§ã€‚\nåœ¨Nginxä¸­ä»£ç†æ˜¯é€šè¿‡æ“çºµé’ˆå¯¹NginxæœåŠ¡å™¨çš„è¯·æ±‚å¹¶å°†å…¶ä¼ é€’ç»™å…¶ä»–æœåŠ¡å™¨ä»¥è¿›è¡Œå®é™…å¤„ç†æ¥å®Œæˆçš„ã€‚è¯·æ±‚çš„ç»“æœå°†ä¼ é€’å›Nginxï¼Œç„¶åNginxå°†ä¿¡æ¯ä¸­ç»§åˆ°å®¢æˆ·ç«¯ã€‚æ­¤å®ä¾‹ä¸­çš„å…¶ä»–æœåŠ¡å™¨å¯ä»¥æ˜¯è¿œç¨‹è®¡ç®—æœºï¼Œæœ¬åœ°æœåŠ¡å™¨ï¼Œç”šè‡³æ˜¯Nginxä¸­å®šä¹‰çš„å…¶ä»–è™šæ‹ŸæœåŠ¡å™¨ã€‚Nginxä»£ç†è¯·æ±‚çš„æœåŠ¡å™¨ç§°ä¸ºä¸Šæ¸¸æœåŠ¡å™¨ã€‚\nNginxå¯ä»¥å°†è¯·æ±‚ä»£ç†åˆ°ä½¿ç”¨httpï¼ˆsï¼‰ï¼ŒFastCGIï¼ŒSCGIå’Œuwsgiæˆ–memcachedåè®®é€šè¿‡æ¯ç§ä»£ç†ç±»å‹çš„å•ç‹¬æŒ‡ä»¤é›†è¿›è¡Œé€šä¿¡çš„æœåŠ¡å™¨ã€‚åœ¨æœ¬æŒ‡å—ä¸­ï¼Œæˆ‘ä»¬å°†é‡ç‚¹å…³æ³¨httpåè®®ã€‚Nginxå®ä¾‹è´Ÿè´£ä¼ é€’è¯·æ±‚å¹¶å°†ä»»ä½•æ¶ˆæ¯ç»„ä»¶æŒ‰æ‘©æˆä¸Šæ¸¸æœåŠ¡å™¨å¯ä»¥ç†è§£çš„æ ¼å¼ã€‚\n2. è§£æ„åŸºæœ¬HTTPä»£ç†é€šè¡Œè¯ æœ€ç›´æ¥çš„ä»£ç†ç±»å‹æ¶‰åŠå°†è¯·æ±‚åˆ‡æ¢åˆ°å¯ä»¥ä½¿ç”¨httpè¿›è¡Œé€šä¿¡çš„å•ä¸ªæœåŠ¡å™¨ã€‚è¿™ç§ç±»å‹çš„ä»£ç†ç§°ä¸ºé€šç”¨â€œä»£ç†ä¼ é€’â€ï¼Œç”±é€‚å½“å‘½åçš„proxy_passæŒ‡ä»¤å¤„ç†ã€‚\nè¯¥proxy_passæŒ‡ä»¤ä¸»è¦åœ¨ä½ç½®ä¸Šä¸‹æ–‡ä¸­æ‰¾åˆ°ã€‚å®ƒifåœ¨ä½ç½®ä¸Šä¸‹æ–‡å’Œlimit_exceptä¸Šä¸‹æ–‡ä¸­çš„å—ä¸­ä¹Ÿæ˜¯æœ‰æ•ˆçš„ã€‚å½“è¯·æ±‚ä¸å…·æœ‰proxy_passæŒ‡ä»¤çš„ä½ç½®åŒ¹é…æ—¶ï¼Œè¯·æ±‚å°†è½¬å‘åˆ°æŒ‡ä»¤ç»™å‡ºçš„URLã€‚\næˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š\n# server context location /match/here { proxy_pass http://example.com; } . . . åœ¨ä¸Šé¢çš„é…ç½®ä»£ç æ®µä¸­ï¼Œproxy_passå®šä¹‰ä¸­æœåŠ¡å™¨æœ«å°¾æ²¡æœ‰ç»™å‡ºURI ã€‚å¯¹äºç¬¦åˆæ­¤æ¨¡å¼çš„å®šä¹‰ï¼Œå®¢æˆ·ç«¯è¯·æ±‚çš„URIå°†æŒ‰åŸæ ·ä¼ é€’åˆ°ä¸Šæ¸¸æœåŠ¡å™¨ã€‚\nä¾‹å¦‚ï¼Œå½“/match/here/pleaseæ­¤å—å¤„ç†è¯·æ±‚æ—¶ï¼Œè¯·æ±‚URIå°†ä½œä¸ºå‘é€åˆ°example.comæœåŠ¡å™¨http://example.com/match/here/pleaseã€‚\næˆ‘ä»¬æ¥çœ‹çœ‹æ›¿ä»£æ–¹æ¡ˆï¼š\n# server context location /match/here { proxy_pass http://example.com/new/prefix; } . . . åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œä»£ç†æœåŠ¡å™¨åœ¨endï¼ˆ/new/prefixï¼‰ä¸Šå®šä¹‰äº†ä¸€ä¸ªURIæ®µã€‚å½“åœ¨proxy_passå®šä¹‰ä¸­ç»™å‡ºURIæ—¶ï¼Œåœ¨ä¼ é€’æœŸé—´ï¼Œè¯·æ±‚çš„ä¸ä½ç½®å®šä¹‰åŒ¹é…çš„éƒ¨åˆ†å°†è¢«æ­¤URIæ›¿æ¢ã€‚\nä¾‹å¦‚ï¼Œ/match/here/pleaseNginxæœåŠ¡å™¨ä¸Šçš„è¯·æ±‚å°†ä½œä¸ºä¼ é€’ç»™ä¸Šæ¸¸æœåŠ¡å™¨http://example.com/new/prefix/please è¯¥/match/hereæ‰€å–ä»£/new/prefixã€‚è¿™æ˜¯ä¸€ä¸ªè¦è®°ä½çš„é‡ç‚¹ã€‚\næœ‰æ—¶ï¼Œè¿™ç§æ›¿æ¢æ˜¯ä¸å¯èƒ½çš„ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œå°†proxy_passå¿½ç•¥å®šä¹‰æœ«å°¾çš„URIï¼Œå¹¶ä¸”å®¢æˆ·ç«¯çš„åŸå§‹URIæˆ–å…¶ä»–æŒ‡ä»¤ä¿®æ”¹çš„URIå°†ä¼ é€’ç»™ä¸Šæ¸¸æœåŠ¡å™¨ã€‚\nä¾‹å¦‚ï¼Œå½“ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ä½ç½®æ—¶ï¼ŒNginxæ— æ³•ç¡®å®šURIçš„å“ªä¸ªéƒ¨åˆ†ä¸è¡¨è¾¾å¼åŒ¹é…ï¼Œå› æ­¤å®ƒå‘é€åŸå§‹å®¢æˆ·ç«¯è¯·æ±‚URIã€‚å¦ä¸€ä¸ªä¾‹å­æ˜¯åœ¨åŒä¸€ä½ç½®ä½¿ç”¨é‡å†™æŒ‡ä»¤æ—¶ï¼Œå¯¼è‡´å®¢æˆ·ç«¯URIè¢«é‡å†™ï¼Œä½†ä»ç„¶åœ¨åŒä¸€ä¸ªå—ä¸­å¤„ç†ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°†ä¼ é€’é‡å†™çš„URIã€‚\n3. äº†è§£Nginxå¦‚ä½•å¤„ç†Headers æœ‰ä¸€ç‚¹å¯èƒ½ä¸ä¼šç«‹å³æ˜ç¡®çš„æ˜¯ï¼Œå¦‚æœæ‚¨å¸Œæœ›ä¸Šæ¸¸æœåŠ¡å™¨æ­£ç¡®å¤„ç†è¯·æ±‚ï¼Œåˆ™ä¼ é€’çš„ä¸ä»…ä»…æ˜¯URIã€‚ä»£è¡¨å®¢æˆ·ç«¯æ¥è‡ªNginxçš„è¯·æ±‚ä¸ç›´æ¥æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚çœ‹èµ·æ¥ä¸åŒã€‚å…¶ä¸­å¾ˆå¤§ä¸€éƒ¨åˆ†æ˜¯ä¸è¯·æ±‚ä¸€èµ·å‡ºç°çš„æ ‡å¤´ã€‚\nå½“Nginxä»£ç†è¯·æ±‚æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨å¯¹ä»å®¢æˆ·ç«¯æ”¶åˆ°çš„è¯·æ±‚æ ‡å¤´è¿›è¡Œä¸€äº›è°ƒæ•´ï¼š\nNginxæ‘†è„±ä»»ä½•ç©ºå¤´ã€‚æ²¡æœ‰å¿…è¦å°†ç©ºå€¼ä¼ é€’ç»™å¦ä¸€å°æœåŠ¡å™¨; å®ƒåªä¼šä½¿è¯·æ±‚è†¨èƒ€ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒNginxä¼šå°†åŒ…å«ä¸‹åˆ’çº¿çš„ä»»ä½•æ ‡å¤´è§†ä¸ºæ— æ•ˆã€‚å®ƒå°†ä»ä»£ç†è¯·æ±‚ä¸­åˆ é™¤å®ƒä»¬ã€‚å¦‚æœä½ å¸Œæœ›Nginxå°†è¿™äº›è§£é‡Šä¸ºæœ‰æ•ˆï¼Œä½ å¯ä»¥å°†underscores_in_headersæŒ‡ä»¤è®¾ç½®ä¸ºâ€œonâ€ï¼Œå¦åˆ™ä½ çš„æ ‡é¢˜æ°¸è¿œä¸ä¼šè¿›å…¥åç«¯æœåŠ¡å™¨ã€‚ â€œHostâ€å¤´è¢«é‡å†™ä¸º$proxy_host å˜é‡å®šä¹‰çš„å€¼ã€‚è¿™å°†æ˜¯ä¸Šæ¸¸çš„IPåœ°å€æˆ–åç§°å’Œç«¯å£å·ï¼Œç›´æ¥ç”±proxy_passæŒ‡ä»¤å®šä¹‰ã€‚ â€œè¿æ¥â€æ ‡é¢˜æ›´æ”¹ä¸ºâ€œå…³é—­â€ã€‚è¯¥æ ‡å¤´ç”¨äºè¡¨ç¤ºå…³äºåŒæ–¹ä¹‹é—´å»ºç«‹çš„ç‰¹å®šè¿æ¥çš„ä¿¡æ¯ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒNginxå°†å…¶è®¾ç½®ä¸ºâ€œå…³é—­â€ä»¥å‘ä¸Šæ¸¸æœåŠ¡å™¨æŒ‡ç¤ºä¸€æ—¦åŸå§‹è¯·æ±‚è¢«å“åº”ï¼Œè¯¥è¿æ¥å°†è¢«å…³é—­ã€‚ä¸Šæ¸¸ä¸åº”æœŸæœ›è¿™ç§è¿æ¥æ˜¯æŒä¹…çš„ã€‚ æˆ‘ä»¬å¯ä»¥ä»ä¸Šé¢æ¨æ–­çš„ç¬¬ä¸€ç‚¹æ˜¯ï¼Œæ‚¨ä¸å¸Œæœ›ä¼ é€’çš„ä»»ä½•å¤´åº”è¯¥è®¾ç½®ä¸ºç©ºå­—ç¬¦ä¸²ã€‚å…·æœ‰ç©ºå€¼çš„æ ‡å¤´å°†ä»ä¼ é€’çš„è¯·æ±‚ä¸­å®Œå…¨åˆ é™¤ã€‚\nä»ä¸Šè¿°ä¿¡æ¯ä¸­æ”¶é›†çš„ä¸‹ä¸€ä¸ªè¦ç‚¹æ˜¯ï¼Œå¦‚æœæ‚¨çš„åç«¯åº”ç”¨ç¨‹åºå°†å¤„ç†éæ ‡å‡†æ ‡å¤´ï¼Œåˆ™å¿…é¡»ç¡®ä¿å®ƒä»¬æ²¡æœ‰ä¸‹åˆ’çº¿ã€‚å¦‚æœéœ€è¦ä½¿ç”¨ä¸‹åˆ’çº¿çš„æ ‡å¤´ï¼Œå¯ä»¥underscores_in_headersåœ¨é…ç½®ä¸­å°†æŒ‡ä»¤è®¾ç½®ä¸ºâ€œonâ€ï¼ˆåœ¨httpä¸Šä¸‹æ–‡æˆ–IPåœ°å€/ç«¯å£ç»„åˆçš„é»˜è®¤æœåŠ¡å™¨å£°æ˜çš„ä¸Šä¸‹æ–‡ä¸­æœ‰æ•ˆï¼‰ã€‚å¦‚æœä¸è¿™æ ·åšï¼ŒNginxä¼šå°†è¿™äº›æ ‡å¤´æ ‡è®°ä¸ºæ— æ•ˆï¼Œå¹¶åœ¨ä¼ é€’ç»™æ‚¨çš„ä¸Šæ¸¸ä¹‹å‰é™é»˜åˆ é™¤å®ƒä»¬ã€‚\nâ€œä¸»æœºâ€æ ‡å¤´åœ¨å¤§å¤šæ•°ä»£ç†æ–¹æ¡ˆä¸­ç‰¹åˆ«é‡è¦ã€‚å¦‚ä¸Šæ‰€è¿°ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™å°†è®¾ç½®ä¸º$proxy_host ä¸€ä¸ªå˜é‡çš„å€¼ï¼Œè¯¥å˜é‡å°†åŒ…å«ç›´æ¥ä»proxy_passå®šä¹‰ä¸­è·å–çš„åŸŸåæˆ–IPåœ°å€å’Œç«¯å£ã€‚è¿™æ˜¯é»˜è®¤æƒ…å†µä¸‹é€‰æ‹©çš„ï¼Œå› ä¸ºå®ƒæ˜¯Nginxå¯ä»¥ç¡®å®šä¸Šæ¸¸æœåŠ¡å™¨å“åº”çš„å”¯ä¸€åœ°å€ï¼ˆå› ä¸ºå®ƒæ˜¯ç›´æ¥ä»è¿æ¥ä¿¡æ¯ä¸­æå–çš„ï¼‰ã€‚\nâ€œHostâ€æ ‡å¤´çš„æœ€å¸¸è§å€¼å¦‚ä¸‹ï¼š\n  $proxy_hostï¼šè¿™å°†â€œä¸»æœºâ€æ ‡å¤´è®¾ç½®ä¸ºä»proxy_passå®šä¹‰ä¸­è·å–çš„åŸŸåæˆ–IPåœ°å€å’Œç«¯å£ç»„åˆã€‚ä»Nginxçš„è§’åº¦æ¥çœ‹ï¼Œè¿™æ˜¯é»˜è®¤çš„â€œå®‰å…¨â€ï¼Œä½†é€šå¸¸ä¸æ˜¯ä»£ç†æœåŠ¡å™¨æ­£ç¡®å¤„ç†è¯·æ±‚æ‰€éœ€è¦çš„ã€‚\n  $http_hostï¼š å°†â€œHostâ€æ ‡å¤´è®¾ç½®ä¸ºå®¢æˆ·ç«¯è¯·æ±‚çš„â€œHostâ€æ ‡å¤´ã€‚å®¢æˆ·ç«¯å‘é€çš„æ ‡å¤´å§‹ç»ˆåœ¨Nginxä¸­ä½œä¸ºå˜é‡æä¾›ã€‚å˜é‡å°†ä»¥$http_å‰ç¼€å¼€å¤´ï¼Œåè·Ÿå°å†™çš„æ ‡é¢˜åç§°ï¼Œä»»ä½•çŸ­åˆ’çº¿éƒ½ç”¨ä¸‹åˆ’çº¿æ›¿æ¢ã€‚å°½ç®¡$http_hostå˜é‡åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½æœ‰æ•ˆï¼Œä½†æ˜¯å½“å®¢æˆ·ç«¯è¯·æ±‚æ²¡æœ‰æœ‰æ•ˆçš„â€œä¸»æœºâ€æ ‡å¤´æ—¶ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ä¼ é€’å¤±è´¥ã€‚\n  $hostï¼šæ­¤å˜é‡æŒ‰ä¼˜å…ˆé¡ºåºè®¾ç½®ï¼šè¯·æ±‚è¡Œæœ¬èº«çš„ä¸»æœºåï¼Œå®¢æˆ·ç«¯è¯·æ±‚çš„â€œä¸»æœºâ€æ ‡å¤´æˆ–ä¸è¯·æ±‚åŒ¹é…çš„æœåŠ¡å™¨åç§°ã€‚\n  åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ‚¨éœ€è¦å°†â€œHostâ€æ ‡å¤´è®¾ç½®ä¸º$hostå˜é‡ã€‚å®ƒæ˜¯æœ€çµæ´»çš„ï¼Œé€šå¸¸ä¼šä¸ºä»£ç†æœåŠ¡å™¨æä¾›å°½å¯èƒ½å‡†ç¡®å¡«å†™çš„â€œä¸»æœºâ€æ ‡å¤´\n4. è®¾ç½®æˆ–é‡ç½®æ ‡é¢˜ è¦è°ƒæ•´æˆ–è®¾ç½®ä»£ç†è¿æ¥çš„æ ‡å¤´ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¯¥proxy_set_headeræŒ‡ä»¤ã€‚ä¾‹å¦‚ï¼Œè¦åƒæˆ‘ä»¬è®¨è®ºçš„é‚£æ ·æ›´æ”¹â€œHostâ€æ ‡å¤´ï¼Œå¹¶æ·»åŠ ä¸€äº›ä¸ä»£ç†è¯·æ±‚ç›¸åŒçš„å…¶ä»–æ ‡å¤´ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å†…å®¹ï¼š\n# server context location /match/here { proxy_set_header HOST $host; proxy_set_header X-Forwarded-Proto $scheme; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_pass http://example.com/new/prefix; } . . . ä¸Šè¿°è¯·æ±‚å°†â€œHostâ€æ ‡å¤´è®¾ç½®ä¸º$hostå˜é‡ï¼Œè¯¥å˜é‡åº”åŒ…å«æœ‰å…³æ‰€è¯·æ±‚çš„åŸå§‹ä¸»æœºçš„ä¿¡æ¯çš„X-Forwarded-ProtoæŠ¥å¤´ç»™å‡ºäº†å…³äºåŸå§‹å®¢æˆ·æœºè¯·æ±‚çš„æ¶æ„ä¸­çš„ä»£ç†çš„æœåŠ¡å™¨ä¿¡æ¯ï¼ˆå®ƒæ˜¯å¦æ˜¯ä¸€ä¸ªHTTPæˆ–HTTPSè¯·æ±‚ï¼‰ã€‚\nå°†X-Real-IPå…¶è®¾ç½®ä¸ºå®¢æˆ·ç«¯çš„IPåœ°å€ï¼Œä»¥ä¾¿ä»£ç†å¯ä»¥æ ¹æ®æ­¤ä¿¡æ¯æ­£ç¡®åœ°åšå‡ºå†³ç­–æˆ–è®°å½•ã€‚è¯¥X-Forwarded-Foræ ‡é¢˜æ˜¯åŒ…å«æ¯ä¸€ä¸ªå®¢æˆ·ç«¯å·²é€šè¿‡ä»£ç†åˆ°è¿™ä¸€ç‚¹çš„æœåŠ¡å™¨çš„IPåœ°å€çš„åˆ—è¡¨ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†å…¶è®¾ç½®ä¸º$proxy_add_x_forwarded_forå˜é‡ã€‚æ­¤å˜é‡X-Forwarded-Forè·å–ä»å®¢æˆ·ç«¯æ£€ç´¢çš„åŸå§‹æ ‡å¤´çš„å€¼ï¼Œå¹¶å°†NginxæœåŠ¡å™¨çš„IPåœ°å€æ·»åŠ åˆ°ç»“å°¾ã€‚\nå½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†proxy_set_headeræŒ‡ä»¤ç§»åˆ°æœåŠ¡å™¨æˆ–httpä¸Šä¸‹æ–‡ä¸­ï¼Œå…è®¸å®ƒåœ¨å¤šä¸ªä½ç½®å¼•ç”¨ï¼š\n# server context proxy_set_header HOST $host; proxy_set_header X-Forwarded-Proto $scheme; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; location /match/here { proxy_pass http://example.com/new/prefix; } location /different/match { proxy_pass http://example.com; } 5. ä¸ºè´Ÿè½½å¹³è¡¡ä»£ç†è¿æ¥å®šä¹‰ä¸Šæ¸¸ä¸Šä¸‹æ–‡ åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬æ¼”ç¤ºäº†å¦‚ä½•å¯¹å•ä¸ªåç«¯æœåŠ¡å™¨æ‰§è¡Œç®€å•çš„httpä»£ç†ã€‚Nginxå…è®¸æˆ‘ä»¬é€šè¿‡æŒ‡å®šå¯ä»¥ä¼ é€’è¯·æ±‚çš„æ•´ä¸ªåç«¯æœåŠ¡å™¨æ± æ¥è½»æ¾æ‰©å±•æ­¤é…ç½®ã€‚\næˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨è¯¥upstreamæŒ‡ä»¤æ¥å®šä¹‰æœåŠ¡å™¨æ± æ¥å®ç°æ­¤ç›®çš„ã€‚æ­¤é…ç½®å‡å®šæ‰€åˆ—å‡ºçš„ä»»ä½•ä¸€ä¸ªæœåŠ¡å™¨éƒ½èƒ½å¤Ÿå¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚è¿™ä½¿æˆ‘ä»¬å¯ä»¥æ¯«ä¸è´¹åŠ›åœ°æ‰©å±•æˆ‘ä»¬çš„åŸºç¡€è®¾æ–½ã€‚upstreamå¿…é¡»åœ¨Nginxé…ç½®çš„httpä¸Šä¸‹æ–‡ä¸­è®¾ç½®è¯¥æŒ‡ä»¤ã€‚\næˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š\n# http context upstream backend_hosts { server host1.example.com; server host2.example.com; server host3.example.com; } server { listen 80; server_name example.com; location /proxy-me { proxy_pass http://backend_hosts; } } åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬è®¾ç½®äº†ä¸€ä¸ªåä¸ºçš„ä¸Šæ¸¸ä¸Šä¸‹æ–‡backend_hostsã€‚ä¸€æ—¦å®šä¹‰ï¼Œæ­¤åç§°å°†å¯ç”¨äºä»£ç†ä¼ é€’ï¼Œå°±åƒå®ƒæ˜¯å¸¸è§„åŸŸåä¸€æ ·ã€‚å¦‚æ‚¨æ‰€è§ï¼Œåœ¨æˆ‘ä»¬çš„æœåŠ¡å™¨å—ä¸­ï¼Œæˆ‘ä»¬å°†ä»»ä½•è¯·æ±‚ä¼ é€’example.com/proxy-me/â€¦ç»™æˆ‘ä»¬ä¸Šé¢å®šä¹‰çš„æ± ã€‚åœ¨è¯¥æ± ä¸­ï¼Œé€šè¿‡åº”ç”¨å¯é…ç½®ç®—æ³•æ¥é€‰æ‹©ä¸»æœºã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™åªæ˜¯ä¸€ä¸ªç®€å•çš„å¾ªç¯é€‰æ‹©è¿‡ç¨‹ï¼ˆæ¯ä¸ªè¯·æ±‚å°†ä¾æ¬¡è·¯ç”±åˆ°ä¸åŒçš„ä¸»æœºï¼‰ã€‚\n5.1 æ”¹å˜ä¸Šæ¸¸å¹³è¡¡ç®—æ³• æ‚¨å¯ä»¥é€šè¿‡åœ¨ä¸Šæ¸¸ä¸Šä¸‹æ–‡ä¸­åŒ…å«æŒ‡ä»¤æˆ–æ ‡å¿—æ¥ä¿®æ”¹ä¸Šæ¸¸æ± ä½¿ç”¨çš„å¹³è¡¡ç®—æ³•ï¼š\nï¼ˆå¾ªç¯æ³•ï¼‰ï¼šå¦‚æœä¸å­˜åœ¨å…¶ä»–å¹³è¡¡æŒ‡ä»¤ï¼Œåˆ™ä½¿ç”¨é»˜è®¤çš„è´Ÿè½½å¹³è¡¡ç®—æ³•ã€‚åœ¨ä¸Šæ¸¸ä¸Šä¸‹æ–‡ä¸­å®šä¹‰çš„æ¯ä¸ªæœåŠ¡å™¨ä¾æ¬¡é¡ºåºä¼ é€’è¯·æ±‚ã€‚ least_connï¼šæŒ‡å®šåº”å§‹ç»ˆä¸ºå…·æœ‰æœ€å°‘æ´»åŠ¨è¿æ¥æ•°çš„åç«¯æä¾›æ–°è¿æ¥ã€‚åœ¨ä¸åç«¯çš„è¿æ¥å¯èƒ½æŒç»­ä¸€æ®µæ—¶é—´çš„æƒ…å†µä¸‹ï¼Œè¿™å°¤å…¶æœ‰ç”¨ã€‚ ip_hashï¼šæ­¤å¹³è¡¡ç®—æ³•æ ¹æ®å®¢æˆ·ç«¯çš„IPåœ°å€å°†è¯·æ±‚åˆ†å‘åˆ°ä¸åŒçš„æœåŠ¡å™¨ã€‚å‰ä¸‰ä¸ªå…«ä½å­—èŠ‚ç”¨ä½œå†³å®šæœåŠ¡å™¨å¤„ç†è¯·æ±‚çš„å¯†é’¥ã€‚ç»“æœæ˜¯å®¢æˆ·ç«¯æ¯æ¬¡éƒ½å€¾å‘äºç”±åŒä¸€æœåŠ¡å™¨æä¾›æœåŠ¡ï¼Œè¿™æœ‰åŠ©äºä¼šè¯ä¸€è‡´æ€§ã€‚ hashï¼šæ­¤å¹³è¡¡ç®—æ³•ä¸»è¦ç”¨äºmemcachedä»£ç†ã€‚åŸºäºä»»æ„æä¾›çš„æ•£åˆ—å¯†é’¥çš„å€¼æ¥åˆ’åˆ†æœåŠ¡å™¨ã€‚è¿™å¯ä»¥æ˜¯æ–‡æœ¬ï¼Œå˜é‡æˆ–ç»„åˆã€‚è¿™æ˜¯å”¯ä¸€éœ€è¦ç”¨æˆ·æä¾›æ•°æ®çš„å¹³è¡¡æ–¹æ³•ï¼Œè¿™æ˜¯åº”è¯¥ç”¨äºå“ˆå¸Œçš„å¯†é’¥ã€‚ æ›´æ”¹å¹³è¡¡ç®—æ³•æ—¶ï¼Œå—å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š\n# http context upstream backend_hosts { least_conn; server host1.example.com; server host2.example.com; server host3.example.com; } . . . åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œå°†æ ¹æ®å“ªä¸ªè¿æ¥æœ€å°‘æ¥é€‰æ‹©æœåŠ¡å™¨ã€‚è¯¥ip_hashæŒ‡ä»¤å¯ä»¥ä»¥ç›¸åŒçš„æ–¹å¼è®¾ç½®ä»¥è·å¾—ä¸€å®šé‡çš„ä¼šè¯â€œç²˜æ€§â€ã€‚\nè‡³äºhashæ–¹æ³•ï¼Œæ‚¨å¿…é¡»æä¾›å“ˆå¸Œçš„å¯†é’¥ã€‚è¿™å¯ä»¥æ˜¯ä½ æƒ³è¦çš„ä»»ä½•ä¸œè¥¿ï¼š\n# http context upstream backend_hosts { hash $remote_addr$remote_port consistent; server host1.example.com; server host2.example.com; server host3.example.com; } . . . ä¸Šé¢çš„ç¤ºä¾‹å°†æ ¹æ®å®¢æˆ·ç«¯IPåœ°å€å’Œç«¯å£çš„å€¼åˆ†å‘è¯·æ±‚ã€‚æˆ‘ä»¬è¿˜æ·»åŠ äº†å¯é€‰å‚æ•°consistentï¼Œè¯¥å‚æ•°å®ç°äº†ketamaä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ã€‚åŸºæœ¬ä¸Šï¼Œè¿™æ„å‘³ç€å¦‚æœæ‚¨çš„ä¸Šæ¸¸æœåŠ¡å™¨å‘ç”Ÿæ›´æ”¹ï¼Œåˆ™å¯¹ç¼“å­˜çš„å½±å“æœ€å°ã€‚\n5.2 è®¾ç½®æœåŠ¡å™¨æƒé‡ä»¥è¿›è¡Œå¹³è¡¡ åœ¨åç«¯æœåŠ¡å™¨çš„å£°æ˜ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªæœåŠ¡å™¨éƒ½æ˜¯â€œåŠ æƒâ€çš„ã€‚è¿™å‡è®¾æ¯ä¸ªæœåŠ¡å™¨å¯ä»¥å¹¶ä¸”åº”è¯¥å¤„ç†ç›¸åŒçš„è´Ÿè½½é‡ï¼ˆè€ƒè™‘åˆ°å¹³è¡¡ç®—æ³•çš„å½±å“ï¼‰ã€‚ä½†æ˜¯ï¼Œæ‚¨è¿˜å¯ä»¥åœ¨å£°æ˜æœŸé—´ä¸ºæœåŠ¡å™¨è®¾ç½®æ›¿ä»£æƒé‡ï¼š\n# http context upstream backend_hosts { server host1.example.com weight=3; server host2.example.com; server host3.example.com; } . . . åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œhost1.example.comå°†æ¥æ”¶ä¸‰å€äºå…¶ä»–ä¸¤ä¸ªæœåŠ¡å™¨çš„æµé‡ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸ºæ¯ä¸ªæœåŠ¡å™¨åˆ†é…æƒé‡1ã€‚\n6. ä½¿ç”¨ç¼“å†²åŒºé‡Šæ”¾åç«¯æœåŠ¡å™¨ æ¶‰åŠè®¸å¤šç”¨æˆ·çš„ä»£ç†é—®é¢˜æ˜¯å‘æµç¨‹æ·»åŠ å…¶ä»–æœåŠ¡å™¨å¯¹æ€§èƒ½çš„å½±å“ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåˆ©ç”¨Nginxçš„ç¼“å†²å’Œç¼“å­˜åŠŸèƒ½å¯ä»¥å¤§å¤§å‡è½»è¿™ç§å½±å“ã€‚\nä»£ç†åˆ°å¦ä¸€å°æœåŠ¡å™¨æ—¶ï¼Œä¸¤ä¸ªä¸åŒè¿æ¥çš„é€Ÿåº¦å°†å½±å“å®¢æˆ·ç«¯çš„ä½“éªŒï¼š\nä»å®¢æˆ·ç«¯åˆ°Nginxä»£ç†çš„è¿æ¥ã€‚ ä»Nginxä»£ç†åˆ°åç«¯æœåŠ¡å™¨çš„è¿æ¥ã€‚ Nginxèƒ½å¤Ÿæ ¹æ®æ‚¨å¸Œæœ›ä¼˜åŒ–çš„è¿™äº›è¿æ¥ä¸­çš„ä»»ä½•ä¸€ä¸ªæ¥è°ƒæ•´å…¶è¡Œä¸ºã€‚\næ²¡æœ‰ç¼“å†²åŒºï¼Œæ•°æ®ä»ä»£ç†æœåŠ¡å™¨å‘é€å¹¶ç«‹å³å¼€å§‹ä¼ è¾“åˆ°å®¢æˆ·ç«¯ã€‚å¦‚æœå‡è®¾å®¢æˆ·ç«¯é€Ÿåº¦å¾ˆå¿«ï¼Œåˆ™å¯ä»¥å…³é—­ç¼“å†²ï¼Œä»¥ä¾¿å°½å¿«å°†æ•°æ®ä¼ é€åˆ°å®¢æˆ·ç«¯ã€‚ä½¿ç”¨ç¼“å†²åŒºï¼ŒNginxä»£ç†å°†ä¸´æ—¶å­˜å‚¨åç«¯çš„å“åº”ï¼Œç„¶åå°†æ­¤æ•°æ®æä¾›ç»™å®¢æˆ·ç«¯ã€‚å¦‚æœå®¢æˆ·ç«¯å¾ˆæ…¢ï¼Œè¿™å…è®¸NginxæœåŠ¡å™¨æ›´å¿«åœ°å…³é—­åˆ°åç«¯çš„è¿æ¥ã€‚ç„¶åï¼Œå®ƒå¯ä»¥å¤„ç†ä»¥ä»»ä½•å¯èƒ½çš„é€Ÿåº¦å°†æ•°æ®åˆ†å‘ç»™å®¢æˆ·ç«¯ã€‚\nNginxé»˜è®¤é‡‡ç”¨ç¼“å†²è®¾è®¡ï¼Œå› ä¸ºå®¢æˆ·ç«¯çš„è¿æ¥é€Ÿåº¦å¾€å¾€å·®å¼‚å¾ˆå¤§ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤è°ƒæ•´ç¼“å†²è¡Œä¸ºã€‚è¿™äº›å¯ä»¥åœ¨httpï¼ŒæœåŠ¡å™¨æˆ–ä½ç½®ä¸Šä¸‹æ–‡ä¸­è®¾ç½®ã€‚é‡è¦çš„æ˜¯è¦è®°ä½ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½é…ç½®äº†å¤§å°è°ƒæ•´æŒ‡ä»¤ï¼Œå› æ­¤å½“æœ‰è®¸å¤šå®¢æˆ·ç«¯è¯·æ±‚æ—¶ï¼Œå¢åŠ å®ƒä»¬è¶…å‡ºæ‚¨çš„éœ€è¦ä¼šå½±å“æ‚¨çš„æ€§èƒ½ï¼š\nproxy_bufferingï¼šæ­¤æŒ‡ä»¤æ§åˆ¶æ˜¯å¦å¯ç”¨æ­¤ä¸Šä¸‹æ–‡å’Œå­ä¸Šä¸‹æ–‡çš„ç¼“å†²ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™æ˜¯â€œæ‰“å¼€â€ã€‚ proxy_buffersï¼šæ­¤æŒ‡ä»¤æ§åˆ¶ä»£ç†å“åº”çš„ç¼“å†²åŒºçš„æ•°é‡ï¼ˆç¬¬ä¸€ä¸ªå‚æ•°ï¼‰å’Œå¤§å°ï¼ˆç¬¬äºŒä¸ªå‚æ•°ï¼‰ã€‚é»˜è®¤è®¾ç½®æ˜¯é…ç½®8ä¸ªå¤§å°ç­‰äºä¸€ä¸ªå†…å­˜é¡µé¢çš„ç¼“å†²åŒºï¼ˆ4kæˆ–è€…8kï¼‰ã€‚å¢åŠ ç¼“å†²åŒºæ•°é‡å¯ä»¥è®©æ‚¨ç¼“å†²æ›´å¤šä¿¡æ¯ã€‚ proxy_buffer_sizeï¼šæ¥è‡ªåç«¯æœåŠ¡å™¨çš„å“åº”çš„åˆå§‹éƒ¨åˆ†ï¼ˆåŒ…å«æ ‡å¤´ï¼‰ä¸å“åº”çš„å…¶ä½™éƒ¨åˆ†åˆ†å¼€ç¼“å†²ã€‚è¯¥æŒ‡ä»¤è®¾ç½®å“åº”çš„è¿™ä¸€éƒ¨åˆ†çš„ç¼“å†²åŒºå¤§å°ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸å¤§å°ç›¸åŒproxy_buffersï¼Œä½†ç”±äºè¿™ç”¨äºæ ‡é¢˜ä¿¡æ¯ï¼Œå› æ­¤é€šå¸¸å¯ä»¥å°†å…¶è®¾ç½®ä¸ºè¾ƒä½çš„å€¼ã€‚ proxy_busy_buffers_sizeï¼šæ­¤æŒ‡ä»¤è®¾ç½®å¯ä»¥æ ‡è®°ä¸ºâ€œå®¢æˆ·ç«¯å°±ç»ªâ€å¹¶å› æ­¤å¿™ç¢Œçš„ç¼“å†²åŒºçš„æœ€å¤§å¤§å°ã€‚è™½ç„¶å®¢æˆ·ç«¯ä¸€æ¬¡åªèƒ½ä»ä¸€ä¸ªç¼“å†²åŒºè¯»å–æ•°æ®ï¼Œä½†ç¼“å†²åŒºæ”¾åœ¨é˜Ÿåˆ—ä¸­ä»¥ä¾¿ä»¥ä¸²è”å½¢å¼å‘é€åˆ°å®¢æˆ·ç«¯ã€‚è¯¥æŒ‡ä»¤æ§åˆ¶å…è®¸å¤„äºæ­¤çŠ¶æ€çš„ç¼“å†²åŒºç©ºé—´çš„å¤§å°ã€‚ proxy_max_temp_file_sizeï¼šè¿™æ˜¯ç£ç›˜ä¸Šä¸´æ—¶æ–‡ä»¶çš„æ¯ä¸ªè¯·æ±‚çš„æœ€å¤§å¤§å°ã€‚è¿™äº›æ˜¯åœ¨ä¸Šæ¸¸å“åº”å¤ªå¤§è€Œæ— æ³•æ”¾å…¥ç¼“å†²åŒºæ—¶åˆ›å»ºçš„ã€‚ proxy_temp_file_write_sizeï¼šè¿™æ˜¯å½“ä»£ç†æœåŠ¡å™¨çš„å“åº”å¯¹äºé…ç½®çš„ç¼“å†²åŒºè€Œè¨€å¤ªå¤§æ—¶ï¼ŒNginxå°†ä¸€æ¬¡å†™å…¥ä¸´æ—¶æ–‡ä»¶çš„æ•°æ®é‡ã€‚ proxy_temp_pathï¼šè¿™æ˜¯ç£ç›˜ä¸ŠåŒºåŸŸçš„è·¯å¾„ï¼Œå½“ä¸Šæ¸¸æœåŠ¡å™¨çš„å“åº”æ— æ³•å®¹çº³åˆ°é…ç½®çš„ç¼“å†²åŒºæ—¶ï¼ŒNginxåº”è¯¥å­˜å‚¨ä»»ä½•ä¸´æ—¶æ–‡ä»¶ã€‚ å¦‚æ‚¨æ‰€è§ï¼ŒNginxæä¾›äº†è®¸å¤šä¸åŒçš„æŒ‡ä»¤æ¥è°ƒæ•´ç¼“å†²è¡Œä¸ºã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ‚¨ä¸å¿…æ‹…å¿ƒå¤§å¤šæ•°è¿™äº›ï¼Œä½†è°ƒæ•´å…¶ä¸­ä¸€äº›å€¼å¯èƒ½å¾ˆæœ‰ç”¨ã€‚è°ƒæ•´æœ€æœ‰ç”¨çš„å¯èƒ½æ˜¯proxy_bufferså’Œproxy_buffer_sizeæŒ‡ä»¤ã€‚\nå¢åŠ æ¯ä¸ªä¸Šæ¸¸è¯·æ±‚çš„å¯ç”¨ä»£ç†ç¼“å†²åŒºæ•°é‡çš„ç¤ºä¾‹ï¼ŒåŒæ—¶å‡å°‘å¯èƒ½å­˜å‚¨æ ‡å¤´çš„ç¼“å†²åŒºå°†å¦‚ä¸‹æ‰€ç¤ºï¼š\n# server context proxy_buffering on; proxy_buffer_size 1k; proxy_buffers 24 4k; proxy_busy_buffers_size 8k; proxy_max_temp_file_size 2048m; proxy_temp_file_write_size 32k; location / { proxy_pass http://example.com; } ç›¸åï¼Œå¦‚æœæ‚¨æƒ³è¦ç«‹å³å‘å…¶æä¾›æ•°æ®çš„å¿«é€Ÿå®¢æˆ·ç«¯ï¼Œåˆ™å¯ä»¥å®Œå…¨å…³é—­ç¼“å†²ã€‚å¦‚æœä¸Šæ¸¸æ¯”å®¢æˆ·ç«¯æ›´å¿«ï¼ŒNginxå®é™…ä¸Šä»å°†ä½¿ç”¨ç¼“å†²åŒºï¼Œä½†å®ƒä¼šç«‹å³å°è¯•å°†æ•°æ®åˆ·æ–°åˆ°å®¢æˆ·ç«¯ï¼Œè€Œä¸æ˜¯ç­‰å¾…ç¼“å†²åŒºæ± ã€‚å¦‚æœå®¢æˆ·ç«¯é€Ÿåº¦å¾ˆæ…¢ï¼Œè¿™å¯èƒ½å¯¼è‡´ä¸Šæ¸¸è¿æ¥ä¿æŒæ‰“å¼€çŠ¶æ€ï¼Œç›´åˆ°å®¢æˆ·ç«¯èµ¶ä¸Šã€‚å½“ç¼“å†²â€œå…³é—­â€æ—¶ï¼Œä»…proxy_buffer_sizeä½¿ç”¨æŒ‡ä»¤å®šä¹‰çš„ç¼“å†²åŒºï¼š\n# server context proxy_buffering off; proxy_buffer_size 4k; location / { proxy_pass http://example.com; } 6.1 é«˜å¯ç”¨æ€§ï¼ˆå¯é€‰ï¼‰ é€šè¿‡æ·»åŠ ä¸€ç»„å†—ä½™çš„è´Ÿè½½å‡è¡¡å™¨ï¼Œå¯ä»¥ä½¿Nginxä»£ç†æ›´åŠ å¥å£®ï¼Œä»è€Œåˆ›å»ºé«˜å¯ç”¨æ€§åŸºç¡€æ¶æ„ã€‚\nç”²é«˜å¯ç”¨æ€§ï¼ˆHAï¼‰çš„è®¾ç½®æ˜¯æ— æ•…éšœçš„å•ä¸ªç‚¹å¤„çš„åŸºç¡€è®¾æ–½ï¼Œå’Œä½ çš„è´Ÿè½½å¹³è¡¡å™¨æ˜¯è¯¥æ„é€ çš„ä¸€éƒ¨åˆ†ã€‚é€šè¿‡ä½¿ç”¨å¤šä¸ªè´Ÿè½½å‡è¡¡å™¨ï¼Œå¯ä»¥é˜²æ­¢åœ¨è´Ÿè½½å‡è¡¡å™¨ä¸å¯ç”¨æˆ–éœ€è¦å°†å…¶å…³é—­è¿›è¡Œç»´æŠ¤æ—¶å¯èƒ½å¯¼è‡´çš„åœæœºã€‚\nä»¥ä¸‹æ˜¯åŸºæœ¬é«˜å¯ç”¨æ€§è®¾ç½®çš„å›¾è¡¨ï¼š åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæ‚¨æœ‰ä¸€ä¸ªé™æ€IPåœ°å€åé¢çš„å¤šä¸ªè´Ÿè½½å¹³è¡¡å™¨ï¼ˆä¸€ä¸ªæ´»åŠ¨å’Œä¸€ä¸ªæˆ–å¤šä¸ªè¢«åŠ¨ï¼‰ï¼Œå¯ä»¥ä»ä¸€ä¸ªæœåŠ¡å™¨é‡æ–°æ˜ å°„åˆ°å¦ä¸€ä¸ªæœåŠ¡å™¨ã€‚å®¢æˆ·ç«¯è¯·æ±‚ä»é™æ€IPè·¯ç”±åˆ°æ´»åŠ¨è´Ÿè½½å¹³è¡¡å™¨ï¼Œç„¶åè·¯ç”±åˆ°åç«¯æœåŠ¡å™¨ã€‚è¦äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·é˜…è¯»å¦‚ä½•ä½¿ç”¨æµ®åŠ¨IPçš„è¿™ä¸€èŠ‚ã€‚\n7. é…ç½®ä»£ç†ç¼“å­˜ä»¥å‡å°‘å“åº”æ—¶é—´ è™½ç„¶ç¼“å†²å¯ä»¥å¸®åŠ©é‡Šæ”¾åç«¯æœåŠ¡å™¨ä»¥å¤„ç†æ›´å¤šè¯·æ±‚ï¼Œä½†Nginxè¿˜æä¾›äº†ä¸€ç§ä»åç«¯æœåŠ¡å™¨ç¼“å­˜å†…å®¹çš„æ–¹æ³•ï¼Œä»è€Œæ— éœ€ä¸ºè®¸å¤šè¯·æ±‚è¿æ¥åˆ°ä¸Šæ¸¸ã€‚\n7.1 é…ç½®ä»£ç†ç¼“å­˜ è¦è®¾ç½®ç”¨äºä»£ç†å†…å®¹çš„ç¼“å­˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¯¥proxy_cache_pathæŒ‡ä»¤ã€‚è¿™å°†åˆ›å»ºä¸€ä¸ªåŒºåŸŸï¼Œå¯ä»¥ä¿ç•™ä»ä»£ç†æœåŠ¡å™¨è¿”å›çš„æ•°æ®ã€‚è¯¥proxy_cache_pathæŒ‡ä»¤å¿…é¡»åœ¨httpä¸Šä¸‹æ–‡ä¸­è®¾ç½®ã€‚\nåœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†é…ç½®æ­¤å‘½ä»¤å’Œä¸€äº›ç›¸å…³æŒ‡ä»¤æ¥è®¾ç½®æˆ‘ä»¬çš„ç¼“å­˜ç³»ç»Ÿã€‚\n# http context proxy_cache_path /var/lib/nginx/cache levels=1:2 keys_zone=backcache:8m max_size=50m; proxy_cache_key \u0026quot;$scheme$request_method$host$request_uri$is_args$args\u0026quot;; proxy_cache_valid 200 302 10m; proxy_cache_valid 404 1m; ä½¿ç”¨è¯¥proxy_cache_pathæŒ‡ä»¤ï¼Œæˆ‘ä»¬å·²ç»åœ¨æ–‡ä»¶ç³»ç»Ÿä¸Šå®šä¹‰äº†ä¸€ä¸ªç›®å½•ï¼Œæˆ‘ä»¬å¸Œæœ›å­˜å‚¨ç¼“å­˜ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é€‰æ‹©äº†/var/lib/nginx/cacheç›®å½•ã€‚å¦‚æœæ­¤ç›®å½•ä¸å­˜åœ¨ï¼Œæ‚¨å¯ä»¥é€šè¿‡é”®å…¥ä»¥ä¸‹å†…å®¹ä»¥æ­£ç¡®çš„æƒé™å’Œæ‰€æœ‰æƒåˆ›å»ºå®ƒï¼š\nsudo mkdir -p /var/lib/nginx/cache sudo chown www-data /var/lib/nginx/cache sudo chmod 700 /var/lib/nginx/cache è¯¥levels=å‚æ•°æŒ‡å®šç¼“å­˜çš„ç»„ç»‡æ–¹å¼ã€‚Nginxå°†é€šè¿‡æ•£åˆ—é”®çš„å€¼ï¼ˆä¸‹é¢é…ç½®ï¼‰æ¥åˆ›å»ºç¼“å­˜é”®ã€‚æˆ‘ä»¬åœ¨ä¸Šé¢é€‰æ‹©çš„çº§åˆ«è§„å®šå°†åˆ›å»ºä¸€ä¸ªå•ä¸ªå­—ç¬¦ç›®å½•ï¼ˆè¿™å°†æ˜¯æ•£åˆ—å€¼çš„æœ€åä¸€ä¸ªå­—ç¬¦ï¼‰ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªä¸¤ä¸ªå­—ç¬¦çš„å­ç›®å½•ï¼ˆå–è‡ªæ•£åˆ—å€¼æœ«å°¾çš„ä¸‹ä¸¤ä¸ªå­—ç¬¦ï¼‰ã€‚æ‚¨é€šå¸¸ä¸å¿…å…³å¿ƒæ­¤ç»†èŠ‚ï¼Œä½†å®ƒæœ‰åŠ©äºNginxå¿«é€Ÿæ‰¾åˆ°ç›¸å…³å€¼ã€‚\nè¯¥keys_zone=å‚æ•°å®šä¹‰äº†æˆ‘ä»¬è°ƒç”¨çš„æ­¤ç¼“å­˜åŒºçš„åç§°backcacheã€‚è¿™ä¹Ÿæ˜¯æˆ‘ä»¬å®šä¹‰è¦å­˜å‚¨å¤šå°‘å…ƒæ•°æ®çš„åœ°æ–¹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å­˜å‚¨8 MBçš„å¯†é’¥ã€‚å¯¹äºæ¯å…†å­—èŠ‚ï¼ŒNginxå¯ä»¥å­˜å‚¨å¤§çº¦8000ä¸ªæ¡ç›®ã€‚è¯¥max_sizeå‚æ•°è®¾ç½®å®é™…ç¼“å­˜æ•°æ®çš„æœ€å¤§å¤§å°ã€‚\næˆ‘ä»¬ä¸Šé¢ä½¿ç”¨çš„å¦ä¸€ä¸ªæŒ‡ä»¤æ˜¯proxy_cache_keyã€‚è¿™ç”¨äºè®¾ç½®å°†ç”¨äºå­˜å‚¨ç¼“å­˜å€¼çš„é”®ã€‚è¯¥ç›¸åŒå¯†é’¥ç”¨äºæ£€æŸ¥æ˜¯å¦å¯ä»¥ä»ç¼“å­˜æä¾›è¯·æ±‚ã€‚æˆ‘ä»¬å°†æ­¤è®¾ç½®ä¸ºæ–¹æ¡ˆï¼ˆhttpæˆ–httpsï¼‰ï¼ŒHTTPè¯·æ±‚æ–¹æ³•ä»¥åŠè¯·æ±‚çš„ä¸»æœºå’ŒURIçš„ç»„åˆã€‚\nè¯¥proxy_cache_validæŒ‡ä»¤å¯ä»¥å¤šæ¬¡æŒ‡å®šã€‚å®ƒå…è®¸æˆ‘ä»¬æ ¹æ®çŠ¶æ€ä»£ç é…ç½®å­˜å‚¨å€¼çš„æ—¶é—´é•¿åº¦ã€‚åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å­˜å‚¨æˆåŠŸå’Œé‡å®šå‘10åˆ†é’Ÿï¼Œå¹¶ä¸”æ¯åˆ†é’Ÿä½¿ç¼“å­˜è¿‡æœŸ404å“åº”ã€‚\nç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»é…ç½®äº†ç¼“å­˜åŒºåŸŸï¼Œä½†æˆ‘ä»¬ä»ç„¶éœ€è¦å‘Šè¯‰Nginxä½•æ—¶ä½¿ç”¨ç¼“å­˜ã€‚\nåœ¨æˆ‘ä»¬ä»£ç†åç«¯çš„ä½ç½®ï¼Œæˆ‘ä»¬å¯ä»¥é…ç½®æ­¤ç¼“å­˜çš„ä½¿ç”¨ï¼š\n# server context location /proxy-me { proxy_cache backcache; proxy_cache_bypass $http_cache_control; add_header X-Proxy-Cache $upstream_cache_status; proxy_pass http://backend; } . . . ä½¿ç”¨è¯¥proxy_cacheæŒ‡ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šbackcacheç¼“å­˜åŒºåŸŸåº”è¯¥ç”¨äºæ­¤ä¸Šä¸‹æ–‡ã€‚åœ¨ä¼ é€’åˆ°åç«¯ä¹‹å‰ï¼ŒNginxå°†åœ¨æ­¤å¤„æ£€æŸ¥æœ‰æ•ˆæ¡ç›®ã€‚\nè¯¥proxy_cache_bypassæŒ‡ä»¤è®¾ç½®ä¸º$http_cache_control å˜é‡ã€‚è¿™å°†åŒ…å«ä¸€ä¸ªæŒ‡ç¤ºå™¨ï¼ŒæŒ‡ç¤ºå®¢æˆ·ç«¯æ˜¯å¦æ˜ç¡®è¯·æ±‚èµ„æºçš„æ–°çš„éç¼“å­˜ç‰ˆæœ¬ã€‚è®¾ç½®æ­¤æŒ‡ä»¤å…è®¸Nginxæ­£ç¡®å¤„ç†è¿™äº›ç±»å‹çš„å®¢æˆ·ç«¯è¯·æ±‚ã€‚æ— éœ€è¿›ä¸€æ­¥é…ç½®ã€‚\næˆ‘ä»¬è¿˜æ·»åŠ äº†ä¸€ä¸ªåä¸ºçš„é¢å¤–æ ‡é¢˜X-Proxy-Cacheã€‚æˆ‘ä»¬å°†æ­¤æ ‡å¤´è®¾ç½®ä¸º$upstream_cache_statuså˜é‡çš„å€¼ã€‚åŸºæœ¬ä¸Šï¼Œè¿™ä¼šè®¾ç½®ä¸€ä¸ªæ ‡å¤´ï¼Œå…è®¸æˆ‘ä»¬æŸ¥çœ‹è¯·æ±‚æ˜¯å¦å¯¼è‡´ç¼“å­˜å‘½ä¸­ï¼Œç¼“å­˜æœªå‘½ä¸­ï¼Œæˆ–è€…æ˜¯å¦æ˜ç¡®ç»•è¿‡äº†ç¼“å­˜ã€‚è¿™å¯¹äºè°ƒè¯•å°¤å…¶æœ‰ç”¨ï¼Œä½†å¯¹äºå®¢æˆ·ç«¯ä¹Ÿæ˜¯æœ‰ç”¨çš„ä¿¡æ¯ã€‚\n7.2 æœ‰å…³ç¼“å­˜ç»“æœçš„è¯´æ˜ ç¼“å­˜å¯ä»¥æå¤§åœ°æé«˜ä»£ç†çš„æ€§èƒ½ã€‚ä½†æ˜¯ï¼Œé…ç½®ç¼“å­˜æ—¶å¿…é¡»ç‰¢è®°ä¸€äº›æ³¨æ„äº‹é¡¹ã€‚\né¦–å…ˆï¼Œä»»ä½•ç”¨æˆ·ç›¸å…³çš„æ•°æ®åº”è¯¥ä¸ä¼šè¢«ç¼“å­˜ã€‚è¿™å¯èƒ½å¯¼è‡´ä¸€ä¸ªç”¨æˆ·çš„æ•°æ®è¢«å‘ˆç°ç»™å¦ä¸€ä¸ªç”¨æˆ·ã€‚å¦‚æœæ‚¨çš„ç½‘ç«™å®Œå…¨æ˜¯é™æ€çš„ï¼Œè¿™å¯èƒ½ä¸æ˜¯é—®é¢˜ã€‚\nå¦‚æœæ‚¨çš„ç«™ç‚¹æœ‰ä¸€äº›åŠ¨æ€å…ƒç´ ï¼Œåˆ™å¿…é¡»åœ¨åç«¯æœåŠ¡å™¨ä¸­å¯¹æ­¤è¿›è¡Œè¯´æ˜ã€‚å¦‚ä½•å¤„ç†è¿™å–å†³äºå¤„ç†åç«¯å¤„ç†çš„åº”ç”¨ç¨‹åºæˆ–æœåŠ¡å™¨ã€‚å¯¹äºç§æœ‰å†…å®¹ï¼Œæ‚¨åº”å°†Cache-Controlæ ‡å¤´è®¾ç½®ä¸ºno-cacheï¼Œno-storeæˆ–privateï¼Œå…·ä½“å–å†³äºæ•°æ®çš„æ€§è´¨ï¼š no-cacheï¼šè¡¨ç¤ºå¦‚æœæ²¡æœ‰å…ˆæ£€æŸ¥åç«¯çš„æ•°æ®æ˜¯å¦æœªæ›´æ”¹ï¼Œåˆ™ä¸åº”å†æ¬¡æä¾›å“åº”ã€‚å¦‚æœæ•°æ®æ˜¯åŠ¨æ€ä¸”é‡è¦çš„ï¼Œåˆ™å¯ä»¥ä½¿ç”¨æ­¤æ–¹æ³•ã€‚åœ¨æ¯ä¸ªè¯·æ±‚ä¸Šæ£€æŸ¥ETagæ•£åˆ—å…ƒæ•°æ®å¤´ï¼Œå¹¶ä¸”å¦‚æœåç«¯è¿”å›ç›¸åŒçš„æ•£åˆ—å€¼ï¼Œåˆ™å¯ä»¥æä¾›å…ˆå‰çš„å€¼\nno-store ï¼šè¡¨ç¤ºåœ¨ä»»ä½•æ—¶å€™éƒ½ä¸åº”è¯¥ç¼“å­˜æ¥æ”¶åˆ°çš„æ•°æ®ã€‚è¿™æ˜¯ç§æœ‰æ•°æ®æœ€å®‰å…¨çš„é€‰é¡¹ï¼Œå› ä¸ºè¿™æ„å‘³ç€æ¯æ¬¡éƒ½å¿…é¡»ä»æœåŠ¡å™¨æ£€ç´¢æ•°æ®ã€‚\nprivateï¼šè¿™è¡¨ç¤ºæ²¡æœ‰å…±äº«ç¼“å­˜ç©ºé—´åº”è¯¥ç¼“å­˜æ­¤æ•°æ®ã€‚è¿™å¯ç”¨äºæŒ‡ç¤ºç”¨æˆ·çš„æµè§ˆå™¨å¯ä»¥ç¼“å­˜æ•°æ®ï¼Œä½†ä»£ç†æœåŠ¡å™¨ä¸åº”è®¤ä¸ºæ­¤æ•°æ®å¯¹åç»­è¯·æ±‚æœ‰æ•ˆã€‚\npublicï¼šè¿™è¡¨ç¤ºå“åº”æ˜¯å¯ä»¥åœ¨è¿æ¥ä¸­çš„ä»»ä½•ä½ç½®ç¼“å­˜çš„å…¬å…±æ•°æ®ã€‚\nå¯ä»¥æ§åˆ¶æ­¤è¡Œä¸ºçš„ç›¸å…³æ ‡å¤´æ˜¯max-ageæ ‡å¤´ï¼Œå®ƒæŒ‡ç¤ºåº”ç¼“å­˜ä»»ä½•èµ„æºçš„ç§’æ•°ã€‚\næ­£ç¡®è®¾ç½®è¿™äº›æ ‡é¢˜ï¼ˆå–å†³äºå†…å®¹çš„æ•æ„Ÿæ€§ï¼‰å°†æœ‰åŠ©äºæ‚¨åˆ©ç”¨ç¼“å­˜ï¼ŒåŒæ—¶ä¿æŠ¤æ‚¨çš„ç§äººæ•°æ®å®‰å…¨å¹¶ä½¿æ‚¨çš„åŠ¨æ€æ•°æ®ä¿æŒæ–°é²œã€‚\nå¦‚æœä½ çš„åç«¯ä¹Ÿä½¿ç”¨Nginxï¼Œä½ å¯ä»¥ä½¿ç”¨expiresæŒ‡ä»¤è®¾ç½®ä¸€äº›ï¼Œè¿™å°†è®¾ç½®max-ageä¸ºCache-Controlï¼š\nlocation / { expires 60m; } location /check-me { expires -1; } åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œç¬¬ä¸€ä¸ªå—å…è®¸å°†å†…å®¹ç¼“å­˜ä¸€å°æ—¶ã€‚ç¬¬äºŒä¸ªå—å°†Cache-Controlæ ‡å¤´è®¾ç½®ä¸ºâ€œno-cacheâ€ã€‚è¦è®¾ç½®å…¶ä»–å€¼ï¼Œå¯ä»¥ä½¿ç”¨è¯¥add_headeræŒ‡ä»¤ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\nlocation /private { expires -1; add_header Cache-Control \u0026quot;no-store\u0026quot;; } 8. ç»“è®º Nginxé¦–å…ˆæ˜¯ä¸€ä¸ªåå‘ä»£ç†ï¼Œå®ƒä¹Ÿæ°å¥½å…·æœ‰ä½œä¸ºWebæœåŠ¡å™¨å·¥ä½œçš„èƒ½åŠ›ã€‚ç”±äºæ­¤è®¾è®¡å†³ç­–ï¼Œå‘å…¶ä»–æœåŠ¡å™¨ä»£ç†è¯·æ±‚éå¸¸ç®€å•ã€‚Nginxéå¸¸çµæ´»ï¼Œå¦‚æœéœ€è¦ï¼Œå¯ä»¥å¯¹ä»£ç†é…ç½®è¿›è¡Œæ›´å¤æ‚çš„æ§åˆ¶\nåŸæ–‡åœ°å€\nå‚è€ƒ\n","permalink":"http://yangchnet.github.io/Dessert/posts/linux/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%85%A5%E9%97%A8/","summary":"Nginxè´Ÿè½½å‡è¡¡é…ç½®\u0026ndash;ç®€ä»‹  åœ¨ä½¿ç”¨tomcatéƒ¨ç½²é™æ€ç½‘ç«™çš„æ—¶å€™ï¼Œç”±äºæœåŠ¡å™¨æ¯”è¾ƒåƒåœ¾ï¼Œæ‰€ä»¥å¦‚æœå¤šäººåŒæ—¶è®¿é—®çš„è¯ï¼Œå¯èƒ½ä¼šé€ æˆå¡é¡¿ï¼Œå½±å“ç”¨æˆ·ä½“éªŒã€‚æ‰€ä»¥æƒ³åˆ°äº†ä½¿ç”¨è´Ÿè½½å‡è¡¡ã€‚\n 1. ä»€ä¹ˆæ˜¯è´Ÿè½½å‡è¡¡ è´Ÿè½½å¹³è¡¡æ˜¯é«˜å¯ç”¨æ€§åŸºç¡€æ¶æ„çš„å…³é”®ç»„ä»¶ï¼Œé€šå¸¸ç”¨äºé€šè¿‡åœ¨å¤šä¸ªæœåŠ¡å™¨ä¹‹é—´åˆ†é…å·¥ä½œè´Ÿè½½æ¥æé«˜ç½‘ç«™ï¼Œåº”ç”¨ç¨‹åºï¼Œæ•°æ®åº“å’Œå…¶ä»–æœåŠ¡çš„æ€§èƒ½å’Œå¯é æ€§ã€‚\næ²¡æœ‰è´Ÿè½½å¹³è¡¡çš„WebåŸºç¡€ç»“æ„å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š\nåœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œç”¨æˆ·ç›´æ¥è¿æ¥åˆ°webæœåŠ¡å™¨yourdomain.comã€‚å¦‚æœæ­¤å•ä¸ªWebæœåŠ¡å™¨å‡ºç°æ•…éšœï¼Œç”¨æˆ·å°†æ— æ³•å†è®¿é—®è¯¥ç½‘ç«™ã€‚æ­¤å¤–ï¼Œå¦‚æœè®¸å¤šç”¨æˆ·å°è¯•åŒæ—¶è®¿é—®æœåŠ¡å™¨å¹¶ä¸”æ— æ³•å¤„ç†è´Ÿè½½ï¼Œåˆ™å¯èƒ½ä¼šé‡åˆ°åŠ è½½æ—¶é—´ç¼“æ…¢æˆ–æ ¹æœ¬æ— æ³•è¿æ¥çš„æƒ…å†µã€‚\né€šè¿‡åœ¨åç«¯å¼•å…¥è´Ÿè½½å‡è¡¡å™¨å’Œè‡³å°‘ä¸€ä¸ªé¢å¤–çš„WebæœåŠ¡å™¨ï¼Œå¯ä»¥å‡è½»æ­¤å•ç‚¹æ•…éšœã€‚é€šå¸¸ï¼Œæ‰€æœ‰åç«¯æœåŠ¡å™¨éƒ½å°†æä¾›ç›¸åŒçš„å†…å®¹ï¼Œä»¥ä¾¿ç”¨æˆ·æ— è®ºå“ªä¸ªæœåŠ¡å™¨å“åº”éƒ½ä¼šæ”¶åˆ°ä¸€è‡´çš„å†…å®¹ã€‚ åœ¨ä¸Šé¢è¯´æ˜çš„ç¤ºä¾‹ä¸­ï¼Œç”¨æˆ·è®¿é—®è´Ÿè½½å‡è¡¡å™¨ï¼Œè´Ÿè½½å‡è¡¡å™¨å°†ç”¨æˆ·çš„è¯·æ±‚è½¬å‘åˆ°åç«¯æœåŠ¡å™¨ï¼Œåç«¯æœåŠ¡å™¨ç„¶åç›´æ¥å“åº”ç”¨æˆ·çš„è¯·æ±‚ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå•ç‚¹æ•…éšœç°åœ¨æ˜¯è´Ÿè½½å¹³è¡¡å™¨æœ¬èº«ã€‚è¿™å¯ä»¥é€šè¿‡å¼•å…¥ç¬¬äºŒä¸ªè´Ÿè½½å‡è¡¡å™¨æ¥ç¼“è§£.\n2. è´Ÿè½½å‡è¡¡å™¨å¯ä»¥å¤„ç†ä»€ä¹ˆæ ·çš„æµé‡   HTTP - æ ‡å‡†HTTPå¹³è¡¡åŸºäºæ ‡å‡†HTTPæœºåˆ¶å®šå‘è¯·æ±‚ã€‚è´Ÿè½½å‡è¡¡å™¨è®¾ç½®X-Forwarded-Forï¼ŒX-Forwarded-Protoä»¥åŠX-Forwarded-Portå¤´ï¼Œæä¾›æœ‰å…³åŸå§‹è¯·æ±‚çš„åç«¯ä¿¡æ¯ã€‚\n  HTTPS - HTTPSå¹³è¡¡åŠŸèƒ½ä¸HTTPå¹³è¡¡åŠŸèƒ½ç›¸åŒï¼Œä½†å¢åŠ äº†åŠ å¯†åŠŸèƒ½ã€‚åŠ å¯†ä»¥ä¸¤ç§æ–¹å¼ä¹‹ä¸€å¤„ç†ï¼šä½¿ç”¨SSLç›´é€šï¼Œä¸€ç›´ä¿æŒåŠ å¯†åˆ°åç«¯ï¼Œæˆ–è€…ä½¿ç”¨SSLç»ˆæ­¢ï¼Œå°†è§£å¯†è´Ÿæ‹…æ”¾åœ¨è´Ÿè½½å‡è¡¡å™¨ä¸Šï¼Œä½†å°†æœªåŠ å¯†çš„æµé‡å‘é€åˆ°åç«¯ã€‚\n  TCP - å¯¹äºä¸ä½¿ç”¨HTTPæˆ–HTTPSçš„åº”ç”¨ç¨‹åºï¼Œä¹Ÿå¯ä»¥å¹³è¡¡TCPæµé‡ã€‚ä¾‹å¦‚ï¼Œæ•°æ®åº“é›†ç¾¤çš„æµé‡å¯ä»¥åˆ†å¸ƒåœ¨æ‰€æœ‰æœåŠ¡å™¨ä¸Šã€‚\n  UDP\u0026ndash;æœ€è¿‘ï¼Œä¸€äº›è´Ÿè½½å‡è¡¡å™¨å¢åŠ äº†å¯¹ä½¿ç”¨UDPçš„æ ¸å¿ƒäº’è”ç½‘åè®®ï¼ˆå¦‚DNSå’Œsyslogdï¼‰çš„è´Ÿè½½å¹³è¡¡çš„æ”¯æŒã€‚\n  è¿™äº›è½¬å‘è§„åˆ™å°†å®šä¹‰è´Ÿè½½å‡è¡¡å™¨æœ¬èº«çš„åè®®å’Œç«¯å£ï¼Œå¹¶å°†å®ƒä»¬æ˜ å°„åˆ°è´Ÿè½½å‡è¡¡å™¨å°†ç”¨äºå°†æµé‡è·¯ç”±åˆ°åç«¯çš„åè®®å’Œç«¯å£ã€‚\n3. è´Ÿè½½å‡è¡¡å™¨å¦‚ä½•é€‰æ‹©åç«¯æœåŠ¡å™¨ è´Ÿè½½å‡è¡¡å™¨æ ¹æ®ä¸¤ä¸ªå› ç´ çš„ç»„åˆé€‰æ‹©å°†è¯·æ±‚è½¬å‘åˆ°å“ªä¸ªæœåŠ¡å™¨ã€‚ä»–ä»¬å°†é¦–å…ˆç¡®ä¿ä»–ä»¬å¯ä»¥é€‰æ‹©çš„ä»»ä½•æœåŠ¡å™¨å®é™…ä¸Šå¯¹è¯·æ±‚åšå‡ºé€‚å½“çš„å“åº”ï¼Œç„¶åä½¿ç”¨é¢„å…ˆé…ç½®çš„è§„åˆ™ä»è¯¥å¥åº·æ± ä¸­è¿›è¡Œé€‰æ‹©ã€‚\n3.1 å¥åº·æ£€æŸ¥ è´Ÿè½½å‡è¡¡å™¨åº”ä»…å°†æµé‡è½¬å‘åˆ°â€œå¥åº·â€çš„åç«¯æœåŠ¡å™¨ã€‚è¦ç›‘è§†åç«¯æœåŠ¡å™¨çš„è¿è¡ŒçŠ¶å†µï¼Œè¿è¡ŒçŠ¶å†µæ£€æŸ¥ä¼šå®šæœŸå°è¯•ä½¿ç”¨è½¬å‘è§„åˆ™å®šä¹‰çš„åè®®å’Œç«¯å£è¿æ¥åˆ°åç«¯æœåŠ¡å™¨ï¼Œä»¥ç¡®ä¿æœåŠ¡å™¨æ­£åœ¨ä¾¦å¬ã€‚å¦‚æœæœåŠ¡å™¨æœªé€šè¿‡è¿è¡ŒçŠ¶å†µæ£€æŸ¥ï¼Œå› æ­¤æ— æ³•æä¾›è¯·æ±‚ï¼Œåˆ™ä¼šè‡ªåŠ¨å°†å…¶ä»æ± ä¸­åˆ é™¤ï¼Œå¹¶ä¸”åœ¨å†æ¬¡å“åº”è¿è¡ŒçŠ¶å†µæ£€æŸ¥ä¹‹å‰ï¼Œæµé‡å°†ä¸ä¼šè½¬å‘ç»™å®ƒã€‚\n3.2 è´Ÿè½½å¹³è¡¡ç®—æ³• ä½¿ç”¨çš„è´Ÿè½½å¹³è¡¡ç®—æ³•ç¡®å®šå°†é€‰æ‹©åç«¯ä¸­çš„å“ªäº›æ­£å¸¸æœåŠ¡å™¨ã€‚ä¸€äº›å¸¸ç”¨çš„ç®—æ³•æ˜¯ï¼š\n  Round Robin - Round Robinæ„å‘³ç€å°†æŒ‰é¡ºåºé€‰æ‹©æœåŠ¡å™¨ã€‚è´Ÿè½½å‡è¡¡å™¨å°†åœ¨å…¶åˆ—è¡¨ä¸­ä¸ºç¬¬ä¸€ä¸ªè¯·æ±‚é€‰æ‹©ç¬¬ä¸€ä¸ªæœåŠ¡å™¨ï¼Œç„¶åæŒ‰é¡ºåºå‘ä¸‹ç§»åŠ¨åˆ—è¡¨ï¼Œå½“å®ƒåˆ°è¾¾ç»“å°¾æ—¶ä»é¡¶éƒ¨å¼€å§‹ã€‚\n  least_conn - least_connæ„å‘³ç€è´Ÿè½½å‡è¡¡å™¨å°†é€‰æ‹©è¿æ¥æœ€å°‘çš„æœåŠ¡å™¨ï¼Œå¹¶ä¸”å½“æµé‡å¯¼è‡´æ›´é•¿çš„ä¼šè¯æ—¶å»ºè®®ä½¿ç”¨ã€‚\n  ip_hashï¼šæ­¤å¹³è¡¡ç®—æ³•æ ¹æ®å®¢æˆ·ç«¯çš„IPåœ°å€å°†è¯·æ±‚åˆ†å‘åˆ°ä¸åŒçš„æœåŠ¡å™¨ã€‚å‰ä¸‰ä¸ªå…«ä½å­—èŠ‚ç”¨ä½œå†³å®šæœåŠ¡å™¨å¤„ç†è¯·æ±‚çš„å¯†é’¥ã€‚ç»“æœæ˜¯å®¢æˆ·ç«¯æ¯æ¬¡éƒ½å€¾å‘äºç”±åŒä¸€æœåŠ¡å™¨æä¾›æœåŠ¡ï¼Œè¿™æœ‰åŠ©äºä¼šè¯ä¸€è‡´æ€§ã€‚\n  hashï¼šæ­¤å¹³è¡¡ç®—æ³•ä¸»è¦ç”¨äºmemcachedä»£ç†ã€‚åŸºäºä»»æ„æä¾›çš„æ•£åˆ—å¯†é’¥çš„å€¼æ¥åˆ’åˆ†æœåŠ¡å™¨ã€‚è¿™å¯ä»¥æ˜¯æ–‡æœ¬ï¼Œå˜é‡æˆ–ç»„åˆã€‚è¿™æ˜¯å”¯ä¸€éœ€è¦ç”¨æˆ·æä¾›æ•°æ®çš„å¹³è¡¡æ–¹æ³•ï¼Œè¿™æ˜¯åº”è¯¥ç”¨äºå“ˆå¸Œçš„å¯†é’¥ã€‚\n  ç®¡ç†å‘˜å¯ç”¨çš„ç®—æ³•å–å†³äºæ‰€ä½¿ç”¨çš„ç‰¹å®šè´Ÿè½½å¹³è¡¡æŠ€æœ¯ã€‚\n3.3 è´Ÿè½½å¹³è¡¡å™¨å¦‚ä½•å¤„ç†çŠ¶æ€ æŸäº›åº”ç”¨ç¨‹åºè¦æ±‚ç”¨æˆ·ç»§ç»­è¿æ¥åˆ°åŒä¸€åç«¯æœåŠ¡å™¨ã€‚Sourceç®—æ³•æ ¹æ®å®¢æˆ·ç«¯IPä¿¡æ¯åˆ›å»ºå…³è”ã€‚åœ¨Webåº”ç”¨ç¨‹åºçº§åˆ«å®ç°æ­¤ç›®çš„çš„å¦ä¸€ç§æ–¹æ³•æ˜¯é€šè¿‡ç²˜æ€§ä¼šè¯ï¼Œå…¶ä¸­è´Ÿè½½å¹³è¡¡å™¨è®¾ç½®cookieï¼Œå¹¶ä¸”æ¥è‡ªè¯¥ä¼šè¯çš„æ‰€æœ‰è¯·æ±‚éƒ½å®šå‘åˆ°åŒä¸€ç‰©ç†æœåŠ¡å™¨ã€‚\n4. å†—ä½™è´Ÿè½½å‡è¡¡å™¨ è¦å°†è´Ÿè½½å‡è¡¡å™¨ä½œä¸ºå•ç‚¹æ•…éšœç§»é™¤ï¼Œå¯ä»¥å°†ç¬¬äºŒä¸ªè´Ÿè½½å‡è¡¡å™¨è¿æ¥åˆ°ç¬¬ä¸€ä¸ªè´Ÿè½½å‡è¡¡å™¨ä»¥å½¢æˆä¸€ä¸ªé›†ç¾¤ï¼Œå…¶ä¸­æ¯ä¸ªè´Ÿè½½å‡è¡¡å™¨ç›‘æ§å…¶ä»–è´Ÿè½½å¹³è¡¡å™¨çš„è¿è¡ŒçŠ¶å†µã€‚æ¯ä¸ªäººéƒ½å…·æœ‰åŒæ ·çš„æ•…éšœæ£€æµ‹å’Œæ¢å¤èƒ½åŠ›ã€‚å¦‚æœä¸»è´Ÿè½½å‡è¡¡å™¨å‘ç”Ÿæ•…éšœï¼ŒDNSå¿…é¡»å°†ç”¨æˆ·å¸¦åˆ°ç¬¬äºŒä¸ªè´Ÿè½½å‡è¡¡å™¨ã€‚ç”±äºDNSæ›´æ”¹å¯èƒ½éœ€è¦èŠ±è´¹å¤§é‡æ—¶é—´åœ¨Internetä¸Šä¼ æ’­å¹¶è‡ªåŠ¨è¿›è¡Œæ­¤æ•…éšœè½¬ç§»ï¼Œå› æ­¤è®¸å¤šç®¡ç†å‘˜å°†ä½¿ç”¨å…è®¸çµæ´»IPåœ°å€é‡æ–°æ˜ å°„çš„ç³»ç»Ÿï¼Œä¾‹å¦‚æµ®åŠ¨IPã€‚æŒ‰éœ€IPåœ°å€é‡æ–°æ˜ å°„é€šè¿‡æä¾›å¯åœ¨éœ€è¦æ—¶è½»æ¾é‡æ–°æ˜ å°„çš„é™æ€IPåœ°å€ï¼Œæ¶ˆé™¤äº†DNSæ›´æ”¹ä¸­å›ºæœ‰çš„ä¼ æ’­å’Œç¼“å­˜é—®é¢˜ã€‚åŸŸåå¯ä»¥ä¿æŒä¸ç›¸åŒçš„IPåœ°å€å…³è”ï¼Œè€ŒIPåœ°å€æœ¬èº«åœ¨æœåŠ¡å™¨ä¹‹é—´ç§»åŠ¨ã€‚","title":"Nginxè´Ÿè½½å‡è¡¡é…ç½®--ç®€ä»‹"},{"content":"pythonä¸å…¶ä»–è¯­è¨€çš„å¯¹æ¯”ï¼ˆhello worldï¼‰  Cè¯­è¨€\n include\u0026lt;stdio.h\u0026gt; int main() { printf(\u0026#34;hello world\u0026#34;); return 0; }  Javaè¯­è¨€\n public class HelloWorld{ public static void main(String[] args) { System.out.println(\u0026#34;Hello World!\u0026#34;); } }  Python\n print(\u0026#39;hello world\u0026#39;) pythonä¸­çš„å¸¸ç”¨æ•°æ®ç±»å‹  Number String List Tuple Dictionary  # Number a = 1 b = True c = 3.15 d = 1.1+2.2j # å­—ç¬¦ä¸² str1 = \u0026#39;hello\u0026#39; str1_1 = \u0026#34;hello\u0026#34; str2 = \u0026#34;world\u0026#34; print(str1==str1_1) # å­—ç¬¦ä¸²è¿æ¥ str3 = str1 + str2 print(str3) # è½¬ä¹‰å­—ç¬¦ str4 = \u0026#39;hello \\nworld\u0026#39; print(str4) str5 = \u0026#39;hello \\\\n world\u0026#39; print(str5) # æ ¼å¼åŒ–è¾“å‡º print(\u0026#39;str1:%s.\u0026#39;%str1) # åˆ‡ç‰‡ print(str1[1:4]) True helloworld hello world hello \\n world str1:hello. ell  # åˆ—è¡¨ list1 = [\u0026#39;google\u0026#39;, \u0026#39;alibaba\u0026#39;, 2001, 3.14] # é€šè¿‡ä¸‹æ ‡è®¿é—® print(list1[0]) # æ›´æ–°åˆ—è¡¨ list1[2] = \u0026#39;baidu\u0026#39; print(list1) # åˆ é™¤å…ƒç´  del list1[3] print(list1) # æ‹¼æ¥åˆ—è¡¨ list2 = [\u0026#39;microsoft\u0026#39;, \u0026#39;amazon\u0026#39;] list3 = list1 + list2 print(list3) # å¢æ·»åˆ—è¡¨é¡¹ list1.append(\u0026#39;jingdong\u0026#39;) print(list1) google ['google', 'alibaba', 'baidu', 3.14] ['google', 'alibaba', 'baidu'] ['google', 'alibaba', 'baidu', 'microsoft', 'amazon'] ['google', 'alibaba', 'baidu', 'jingdong']  # å…ƒç»„ï¼šç±»ä¼¼åˆ—è¡¨,æ˜¯ä¸€ç³»åˆ—å…ƒç´ çš„æœ‰åºé›†åˆ,ä½†å…ƒç»„ä¸­çš„å…ƒç´ æ— æ³•ä¿®æ”¹ tuple1 = (\u0026#39;google\u0026#39;, \u0026#39;alibaba\u0026#39;, \u0026#39;baidu\u0026#39;) tuple1[0] = \u0026#39;amazon\u0026#39; # ä¸èƒ½è¢«æ”¹å˜ --------------------------------------------------------------------------- TypeError Traceback (most recent call last) \u0026lt;ipython-input-23-4ed3e334c834\u0026gt; in \u0026lt;module\u0026gt; 1 # å…ƒç»„ï¼šç±»ä¼¼åˆ—è¡¨,æ˜¯ä¸€ç³»åˆ—å…ƒç´ çš„æœ‰åºé›†åˆ,ä½†å…ƒç»„ä¸­çš„å…ƒç´ æ— æ³•ä¿®æ”¹ 2 tuple1 = ('google', 'alibaba', 'baidu') ----\u0026gt; 3 tuple1[0] = 'amazon' TypeError: 'tuple' object does not support item assignment  # å­—å…¸ dict1 = { \u0026#39;color\u0026#39;: \u0026#39;green\u0026#39;, \u0026#39;points\u0026#39;: 5 } # è®¿é—®åˆ—è¡¨ä¸­çš„å€¼ print(dict1[\u0026#39;color\u0026#39;]) # å¢åŠ å­—å…¸ä¸­é”®å€¼å¯¹ dict1[\u0026#39;x_pos\u0026#39;] = 0 dict1[\u0026#39;y_pos\u0026#39;] =4 print(dict1) green {'color': 'green', 'points': 5, 'x_pos': 0, 'y_pos': 4}  pythonä¸­çš„ç»“æ„è¯­å¥ ifæ¡ä»¶è¯­å¥ car = \u0026#39;bmw\u0026#39; if car == \u0026#39;bmw\u0026#39;: print(car.upper()) # è¾“å‡ºcarçš„å¤§å†™ç‰ˆæœ¬ else: print(car.title()) # è¾“å‡ºcarçš„æ ‡é¢˜ç‰ˆæœ¬ Bmw  ç°å®ä¸–ç•Œä¸­,å¾ˆå¤šæƒ…å†µä¸‹éœ€è¦è€ƒè™‘çš„æƒ…å½¢éƒ½è¶…è¿‡ä¸¤ä¸ªã€‚ä¾‹å¦‚,æ¥çœ‹ä¸€ä¸ªæ ¹æ®å¹´é¾„æ®µæ”¶è´¹çš„ æ¸¸ä¹åœº:\n 4å²ä»¥ä¸‹å…è´¹; 4~18å²æ”¶è´¹5ç¾å…ƒ; 18å²(å«)ä»¥ä¸Šæ”¶è´¹10ç¾å…ƒã€‚   å¦‚æœåªä½¿ç”¨ä¸€æ¡ if è¯­å¥,å¦‚ä½•ç¡®å®šé—¨ç¥¨ä»·æ ¼å‘¢?ä¸‹é¢çš„ä»£ç ç¡®å®šä¸€ä¸ªäººæ‰€å±çš„å¹´é¾„æ®µ,å¹¶æ‰“å°ä¸€æ¡åŒ…å«é—¨ç¥¨ä»·æ ¼çš„æ¶ˆæ¯:\n age = 12 if age \u0026lt; 4: print(\u0026#34;Your admission cost is $0.\u0026#34;) elif age \u0026lt; 18: print(\u0026#34;Your admission cost is $5.\u0026#34;) else: print(\u0026#34;Your admission cost is $10.\u0026#34;) Your admission cost is $5.  forå¾ªç¯è¯­å¥ fruits = [\u0026#39;banana\u0026#39;, \u0026#39;apple\u0026#39;, \u0026#39;mango\u0026#39;] for fruit in fruits: print(\u0026#39;å½“å‰æ°´æœï¼š%s\u0026#39;%fruit) å½“å‰æ°´æœï¼šbanana å½“å‰æ°´æœï¼šapple å½“å‰æ°´æœï¼šmango  # range æ­¥é•¿ä¸º1 for i in range(0, 6): print(i) 1 2 3 4 5  # range æ­¥é•¿ä¸º2 for i in range(0, 6, 2): print(i) 0 2 4  # break å’Œ continue for i in range(0, 6): if i == 3: break print(i) for i in range(0, 6): if i == 3: continue print(i, end=\u0026#39;\u0026#39;) 0 1 2 01245  # whileå¾ªç¯ current_number = 1 while current_number \u0026lt;= 5: print(current_number) current_number += 1 1 2 3 4 5  å‡½æ•° def greet_user(username): \u0026#34;\u0026#34;\u0026#34; æ˜¾ç¤ºç®€å•çš„é—®å€™è¯­ \u0026#34;\u0026#34;\u0026#34; print(\u0026#34;Hello, \u0026#34; + username.title() + \u0026#34;!\u0026#34;) greet_user(\u0026#39;jesse\u0026#39;) greet_user(\u0026#39;jack\u0026#39;) Hello, Jesse! Hello, Jack!  # æœ‰è¿”å›å€¼çš„å‡½æ•° def add(a, b): return a+b print(\u0026#39;ç¬¬ä¸€ä¸ªå‡½æ•°ï¼š%d\u0026#39;%add(2, 3)) # åˆ—è¡¨ä½œä¸ºå‚æ•°çš„å‡½æ•° def add_l(mylist): result = 0 for l in mylist: result += l return result print(\u0026#39;ç¬¬äºŒä¸ªå‡½æ•°ï¼š%d\u0026#39;%add_l([1, 2, 3, 4])) # æœ‰å¤šä¸ªè¿”å›å€¼çš„å‡½æ•° def muti_re(mylist): a = max(mylist) b = min(mylist) return a, b a, b = muti_re([1, 2, 3, 4]) print(\u0026#39;ç¬¬ä¸‰ä¸ªå‡½æ•°, æœ€å¤§å€¼ï¼š%d, æœ€å°å€¼ï¼š%d\u0026#39;%(a,b)) ç¬¬ä¸€ä¸ªå‡½æ•°ï¼š5 ç¬¬äºŒä¸ªå‡½æ•°ï¼š10 ç¬¬ä¸‰ä¸ªå‡½æ•°, æœ€å¤§å€¼ï¼š4, æœ€å°å€¼ï¼š1  ","permalink":"http://yangchnet.github.io/Dessert/posts/django/python%E5%9F%BA%E7%A1%80/","summary":"pythonä¸å…¶ä»–è¯­è¨€çš„å¯¹æ¯”ï¼ˆhello worldï¼‰  Cè¯­è¨€\n include\u0026lt;stdio.h\u0026gt; int main() { printf(\u0026#34;hello world\u0026#34;); return 0; }  Javaè¯­è¨€\n public class HelloWorld{ public static void main(String[] args) { System.out.println(\u0026#34;Hello World!\u0026#34;); } }  Python\n print(\u0026#39;hello world\u0026#39;) pythonä¸­çš„å¸¸ç”¨æ•°æ®ç±»å‹  Number String List Tuple Dictionary  # Number a = 1 b = True c = 3.15 d = 1.1+2.2j # å­—ç¬¦ä¸² str1 = \u0026#39;hello\u0026#39; str1_1 = \u0026#34;hello\u0026#34; str2 = \u0026#34;world\u0026#34; print(str1==str1_1) # å­—ç¬¦ä¸²è¿æ¥ str3 = str1 + str2 print(str3) # è½¬ä¹‰å­—ç¬¦ str4 = \u0026#39;hello \\nworld\u0026#39; print(str4) str5 = \u0026#39;hello \\\\n world\u0026#39; print(str5) # æ ¼å¼åŒ–è¾“å‡º print(\u0026#39;str1:%s.","title":"pythonä¸å…¶ä»–è¯­è¨€çš„å¯¹æ¯”ï¼ˆhelloworldï¼‰"},{"content":"Pythonä¸­çš„æ‹·è´   ç›´æ¥èµ‹å€¼ï¼šå…¶å®å°±æ˜¯å¯¹è±¡çš„å¼•ç”¨ï¼ˆåˆ«åï¼‰.ä¸¤ä¸ªå¯¹è±¡æ˜¯å¼•ç”¨çš„åŒä¸€å—å†…å­˜åŒºåŸŸ\n  æµ…æ‹·è´(copy)ï¼šæ‹·è´çˆ¶å¯¹è±¡ï¼Œä¸ä¼šæ‹·è´å¯¹è±¡çš„å†…éƒ¨çš„å­å¯¹è±¡ã€‚\n  æ·±æ‹·è´(deepcopy)ï¼š copy æ¨¡å—çš„ deepcopy æ–¹æ³•ï¼Œå®Œå…¨æ‹·è´äº†çˆ¶å¯¹è±¡åŠå…¶å­å¯¹è±¡ã€‚\n  å¼•ç”¨ç¤ºä¾‹\na = [1,2,3,4] b = a a.append(5) print(a, b) [1, 2, 3, 4, 5] [1, 2, 3, 4, 5]  æµ…æ‹·è´ç¤ºä¾‹\nimport copy a = [1, 2, 3, 4, [\u0026#39;a\u0026#39;, \u0026#39;b\u0026#39;]] b = copy.copy(a) a.append(5) a[4].append(\u0026#39;c\u0026#39;) print(a) print(b) [1, 2, 3, 4, ['a', 'b', 'c'], 5] [1, 2, 3, 4, ['a', 'b', 'c']]  å¯ä»¥çœ‹åˆ°,çˆ¶å¯¹è±¡è¢«æ‹·è´äº†,å½“ç›´æ¥å¯¹çˆ¶å¯¹è±¡åšä¿®æ”¹æ—¶,æ‹·è´å€¼ä¹Ÿç›¸åº”çš„å¾—åˆ°äº†å˜åŒ–,ä½†æ˜¯å¯¹å­å¯¹è±¡ä¿®æ”¹æ—¶,æ‹·è´å€¼ä¸å˜\næ·±æ‹·è´ç¤ºä¾‹\nimport copy c = [1, 2, 3, 4, [\u0026#39;a\u0026#39;, \u0026#39;b\u0026#39;]] d = copy.deepcopy(a) c.append(5) c[4].append(\u0026#39;c\u0026#39;) print(c) print(d) [1, 2, 3, 4, ['a', 'b', 'c'], 5] [1, 2, 3, 4, ['a', 'b', 'c'], 5]  ","permalink":"http://yangchnet.github.io/Dessert/posts/python/%E6%B7%B1%E6%B5%85%E6%8B%B7%E8%B4%9D/","summary":"Pythonä¸­çš„æ‹·è´   ç›´æ¥èµ‹å€¼ï¼šå…¶å®å°±æ˜¯å¯¹è±¡çš„å¼•ç”¨ï¼ˆåˆ«åï¼‰.ä¸¤ä¸ªå¯¹è±¡æ˜¯å¼•ç”¨çš„åŒä¸€å—å†…å­˜åŒºåŸŸ\n  æµ…æ‹·è´(copy)ï¼šæ‹·è´çˆ¶å¯¹è±¡ï¼Œä¸ä¼šæ‹·è´å¯¹è±¡çš„å†…éƒ¨çš„å­å¯¹è±¡ã€‚\n  æ·±æ‹·è´(deepcopy)ï¼š copy æ¨¡å—çš„ deepcopy æ–¹æ³•ï¼Œå®Œå…¨æ‹·è´äº†çˆ¶å¯¹è±¡åŠå…¶å­å¯¹è±¡ã€‚\n  å¼•ç”¨ç¤ºä¾‹\na = [1,2,3,4] b = a a.append(5) print(a, b) [1, 2, 3, 4, 5] [1, 2, 3, 4, 5]  æµ…æ‹·è´ç¤ºä¾‹\nimport copy a = [1, 2, 3, 4, [\u0026#39;a\u0026#39;, \u0026#39;b\u0026#39;]] b = copy.copy(a) a.append(5) a[4].append(\u0026#39;c\u0026#39;) print(a) print(b) [1, 2, 3, 4, ['a', 'b', 'c'], 5] [1, 2, 3, 4, ['a', 'b', 'c']]  å¯ä»¥çœ‹åˆ°,çˆ¶å¯¹è±¡è¢«æ‹·è´äº†,å½“ç›´æ¥å¯¹çˆ¶å¯¹è±¡åšä¿®æ”¹æ—¶,æ‹·è´å€¼ä¹Ÿç›¸åº”çš„å¾—åˆ°äº†å˜åŒ–,ä½†æ˜¯å¯¹å­å¯¹è±¡ä¿®æ”¹æ—¶,æ‹·è´å€¼ä¸å˜","title":"Pythonä¸­çš„æ‹·è´"},{"content":"Pythonæ¢æº 1. ä¸´æ—¶æ¢æº å¯ä»¥åœ¨ä½¿ç”¨pipçš„æ—¶å€™åœ¨åé¢åŠ ä¸Š-iå‚æ•°ï¼ŒæŒ‡å®špipæº\npip install scrapy -i https://pypi.tuna.tsinghua.edu.cn/simple 2. æ°¸ä¹…æ¢æº æ°¸ä¹…ä¿®æ”¹ï¼š linux: ä¿®æ”¹ ~/.pip/pip.conf (æ²¡æœ‰å°±åˆ›å»ºä¸€ä¸ª)ï¼Œ å†…å®¹å¦‚ä¸‹ï¼š\n[global] index-url = https://pypi.tuna.tsinghua.edu.cn/simple ","permalink":"http://yangchnet.github.io/Dessert/posts/python/python%E6%8D%A2%E6%BA%90/","summary":"Pythonæ¢æº 1. ä¸´æ—¶æ¢æº å¯ä»¥åœ¨ä½¿ç”¨pipçš„æ—¶å€™åœ¨åé¢åŠ ä¸Š-iå‚æ•°ï¼ŒæŒ‡å®špipæº\npip install scrapy -i https://pypi.tuna.tsinghua.edu.cn/simple 2. æ°¸ä¹…æ¢æº æ°¸ä¹…ä¿®æ”¹ï¼š linux: ä¿®æ”¹ ~/.pip/pip.conf (æ²¡æœ‰å°±åˆ›å»ºä¸€ä¸ª)ï¼Œ å†…å®¹å¦‚ä¸‹ï¼š\n[global] index-url = https://pypi.tuna.tsinghua.edu.cn/simple ","title":"Pythonæ¢æº"},{"content":"python ç½‘ç»œç¼–ç¨‹ ä½¿ç”¨socketæ¨¡å—ï¼Œå³å¥—æ¥å­— ä½¿ç”¨socketæ¥åˆ›å»ºå¥—æ¥å­—çš„è¯­æ³•å¦‚ä¸‹ï¼š socket.socket(family[, type[, proto]])\n å‚æ•°è§£é‡Šï¼š\n  family: å¥—æ¥å­—å®¶æ—å¯ä»¥ä½¿AF_UNIXæˆ–è€…AF_INET type: å¥—æ¥å­—ç±»å‹å¯ä»¥æ ¹æ®æ˜¯é¢å‘è¿æ¥çš„è¿˜æ˜¯éè¿æ¥åˆ†ä¸ºSOCK_STREAMæˆ–SOCK_DGRAM protocolï¼šä¸€èˆ¬ä¸å¡«é»˜è®¤ä¸º0  socketå¯¹è±¡çš„æ–¹æ³•  s.bind() ç»‘å®šåœ°å€ï¼ˆhost,portï¼‰åˆ°å¥—æ¥å­—ï¼Œ åœ¨AF_INETä¸‹,ä»¥å…ƒç»„ï¼ˆhost,portï¼‰çš„å½¢å¼è¡¨ç¤ºåœ°å€ã€‚ s.listen() å¼€å§‹TCPç›‘å¬ã€‚backlogæŒ‡å®šåœ¨æ‹’ç»è¿æ¥ä¹‹å‰ï¼Œæ“ä½œç³»ç»Ÿå¯ä»¥æŒ‚èµ·çš„æœ€å¤§è¿æ¥æ•°é‡ã€‚è¯¥å€¼è‡³å°‘ä¸º1ï¼Œå¤§éƒ¨åˆ†åº”ç”¨ç¨‹åºè®¾ä¸º5å°±å¯ä»¥äº†ã€‚ s.accept() è¢«åŠ¨æ¥å—TCPå®¢æˆ·ç«¯è¿æ¥,(é˜»å¡å¼)ç­‰å¾…è¿æ¥çš„åˆ°æ¥ å®¢æˆ·ç«¯å¥—æ¥å­— s.connect() ä¸»åŠ¨åˆå§‹åŒ–TCPæœåŠ¡å™¨è¿æ¥ï¼Œã€‚ä¸€èˆ¬addressçš„æ ¼å¼ä¸ºå…ƒç»„ï¼ˆhostname,portï¼‰ï¼Œå¦‚æœè¿æ¥å‡ºé”™ï¼Œè¿”å›socket.erroré”™è¯¯ã€‚ s.connect_ex() connect()å‡½æ•°çš„æ‰©å±•ç‰ˆæœ¬,å‡ºé”™æ—¶è¿”å›å‡ºé”™ç ,è€Œä¸æ˜¯æŠ›å‡ºå¼‚å¸¸ å…¬å…±ç”¨é€”çš„å¥—æ¥å­—å‡½æ•° s.recv() æ¥æ”¶TCPæ•°æ®ï¼Œæ•°æ®ä»¥å­—ç¬¦ä¸²å½¢å¼è¿”å›ï¼ŒbufsizeæŒ‡å®šè¦æ¥æ”¶çš„æœ€å¤§æ•°æ®é‡ã€‚flagæä¾›æœ‰å…³æ¶ˆæ¯çš„å…¶ä»–ä¿¡æ¯ï¼Œé€šå¸¸å¯ä»¥å¿½ç•¥ã€‚ s.send() å‘é€TCPæ•°æ®ï¼Œå°†stringä¸­çš„æ•°æ®å‘é€åˆ°è¿æ¥çš„å¥—æ¥å­—ã€‚è¿”å›å€¼æ˜¯è¦å‘é€çš„å­—èŠ‚æ•°é‡ï¼Œè¯¥æ•°é‡å¯èƒ½å°äºstringçš„å­—èŠ‚å¤§å°ã€‚ s.sendall() å®Œæ•´å‘é€TCPæ•°æ®ï¼Œå®Œæ•´å‘é€TCPæ•°æ®ã€‚å°†stringä¸­çš„æ•°æ®å‘é€åˆ°è¿æ¥çš„å¥—æ¥å­—ï¼Œä½†åœ¨è¿”å›ä¹‹å‰ä¼šå°è¯•å‘é€æ‰€æœ‰æ•°æ®ã€‚æˆåŠŸè¿”å›Noneï¼Œå¤±è´¥åˆ™æŠ›å‡ºå¼‚å¸¸ã€‚ s.recvfrom() æ¥æ”¶UDPæ•°æ®ï¼Œä¸recv()ç±»ä¼¼ï¼Œä½†è¿”å›å€¼æ˜¯ï¼ˆdata,addressï¼‰ã€‚å…¶ä¸­dataæ˜¯åŒ…å«æ¥æ”¶æ•°æ®çš„å­—ç¬¦ä¸²ï¼Œaddressæ˜¯å‘é€æ•°æ®çš„å¥—æ¥å­—åœ°å€ã€‚ s.sendto() å‘é€UDPæ•°æ®ï¼Œå°†æ•°æ®å‘é€åˆ°å¥—æ¥å­—ï¼Œaddressæ˜¯å½¢å¼ä¸ºï¼ˆipaddrï¼Œportï¼‰çš„å…ƒç»„ï¼ŒæŒ‡å®šè¿œç¨‹åœ°å€ã€‚è¿”å›å€¼æ˜¯å‘é€çš„å­—èŠ‚æ•°ã€‚ s.close() å…³é—­å¥—æ¥å­— s.getpeername() è¿”å›è¿æ¥å¥—æ¥å­—çš„è¿œç¨‹åœ°å€ã€‚è¿”å›å€¼é€šå¸¸æ˜¯å…ƒç»„ï¼ˆipaddr,portï¼‰ã€‚ s.getsockname() è¿”å›å¥—æ¥å­—è‡ªå·±çš„åœ°å€ã€‚é€šå¸¸æ˜¯ä¸€ä¸ªå…ƒç»„(ipaddr,port) s.setsockopt(level,optname,value) è®¾ç½®ç»™å®šå¥—æ¥å­—é€‰é¡¹çš„å€¼ã€‚ s.getsockopt(level,optname[.buflen]) è¿”å›å¥—æ¥å­—é€‰é¡¹çš„å€¼ã€‚ s.settimeout(timeout) è®¾ç½®å¥—æ¥å­—æ“ä½œçš„è¶…æ—¶æœŸï¼Œtimeoutæ˜¯ä¸€ä¸ªæµ®ç‚¹æ•°ï¼Œå•ä½æ˜¯ç§’ã€‚å€¼ä¸ºNoneè¡¨ç¤ºæ²¡æœ‰è¶…æ—¶æœŸã€‚ä¸€èˆ¬ï¼Œè¶…æ—¶æœŸåº”è¯¥åœ¨åˆšåˆ›å»ºå¥—æ¥å­—æ—¶è®¾ç½®ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½ç”¨äºè¿æ¥çš„æ“ä½œï¼ˆå¦‚connect()ï¼‰ s.gettimeout() è¿”å›å½“å‰è¶…æ—¶æœŸçš„å€¼ï¼Œå•ä½æ˜¯ç§’ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®è¶…æ—¶æœŸï¼Œåˆ™è¿”å›Noneã€‚ s.fileno() è¿”å›å¥—æ¥å­—çš„æ–‡ä»¶æè¿°ç¬¦ã€‚ s.setblocking(flag) å¦‚æœflagä¸º0ï¼Œåˆ™å°†å¥—æ¥å­—è®¾ä¸ºéé˜»å¡æ¨¡å¼ï¼Œå¦åˆ™å°†å¥—æ¥å­—è®¾ä¸ºé˜»å¡æ¨¡å¼ï¼ˆé»˜è®¤å€¼ï¼‰ã€‚éé˜»å¡æ¨¡å¼ä¸‹ï¼Œå¦‚æœè°ƒç”¨recv()æ²¡æœ‰å‘ç°ä»»ä½•æ•°æ®ï¼Œæˆ–send()è°ƒç”¨æ— æ³•ç«‹å³å‘é€æ•°æ®ï¼Œé‚£ä¹ˆå°†å¼•èµ·socket.errorå¼‚å¸¸ã€‚ s.makefile() åˆ›å»ºä¸€ä¸ªä¸è¯¥å¥—æ¥å­—ç›¸å…³è¿çš„æ–‡ä»¶  ç½‘ç»œç¼–ç¨‹çš„åŸºæœ¬è®¾ç½®æ­¥éª¤ æœåŠ¡ç«¯é…ç½®  å¯¼å…¥socketæ¨¡å— ä½¿ç”¨bindæ–¹æ³•åˆ›å»ºå¥—æ¥å­— ä½¿ç”¨listenæ–¹æ³•ç­‰å¾…è¿æ¥ï¼Œ ä½¿ç”¨acceptæ–¹æ³•è¢«åŠ¨æ¥æ”¶tcpè¿æ¥ ä½¿ç”¨sendæˆ–recvæ–¹æ³•è¿›è¡Œæ”¶å‘  å®¢æˆ·ç«¯é…ç½®  å¯¼å…¥socketæ¨¡å— ä½¿ç”¨bindæ–¹æ³•åˆ›å»ºå¥—æ¥å­— ä½¿ç”¨connectæ–¹æ³•è¿›è¡Œä¸»åŠ¨tcpè¿æ¥ ä½¿ç”¨sendæˆ–recvæ–¹æ³•è¿›è¡Œæ”¶å‘  ","permalink":"http://yangchnet.github.io/Dessert/posts/python/python%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/","summary":"python ç½‘ç»œç¼–ç¨‹ ä½¿ç”¨socketæ¨¡å—ï¼Œå³å¥—æ¥å­— ä½¿ç”¨socketæ¥åˆ›å»ºå¥—æ¥å­—çš„è¯­æ³•å¦‚ä¸‹ï¼š socket.socket(family[, type[, proto]])\n å‚æ•°è§£é‡Šï¼š\n  family: å¥—æ¥å­—å®¶æ—å¯ä»¥ä½¿AF_UNIXæˆ–è€…AF_INET type: å¥—æ¥å­—ç±»å‹å¯ä»¥æ ¹æ®æ˜¯é¢å‘è¿æ¥çš„è¿˜æ˜¯éè¿æ¥åˆ†ä¸ºSOCK_STREAMæˆ–SOCK_DGRAM protocolï¼šä¸€èˆ¬ä¸å¡«é»˜è®¤ä¸º0  socketå¯¹è±¡çš„æ–¹æ³•  s.bind() ç»‘å®šåœ°å€ï¼ˆhost,portï¼‰åˆ°å¥—æ¥å­—ï¼Œ åœ¨AF_INETä¸‹,ä»¥å…ƒç»„ï¼ˆhost,portï¼‰çš„å½¢å¼è¡¨ç¤ºåœ°å€ã€‚ s.listen() å¼€å§‹TCPç›‘å¬ã€‚backlogæŒ‡å®šåœ¨æ‹’ç»è¿æ¥ä¹‹å‰ï¼Œæ“ä½œç³»ç»Ÿå¯ä»¥æŒ‚èµ·çš„æœ€å¤§è¿æ¥æ•°é‡ã€‚è¯¥å€¼è‡³å°‘ä¸º1ï¼Œå¤§éƒ¨åˆ†åº”ç”¨ç¨‹åºè®¾ä¸º5å°±å¯ä»¥äº†ã€‚ s.accept() è¢«åŠ¨æ¥å—TCPå®¢æˆ·ç«¯è¿æ¥,(é˜»å¡å¼)ç­‰å¾…è¿æ¥çš„åˆ°æ¥ å®¢æˆ·ç«¯å¥—æ¥å­— s.connect() ä¸»åŠ¨åˆå§‹åŒ–TCPæœåŠ¡å™¨è¿æ¥ï¼Œã€‚ä¸€èˆ¬addressçš„æ ¼å¼ä¸ºå…ƒç»„ï¼ˆhostname,portï¼‰ï¼Œå¦‚æœè¿æ¥å‡ºé”™ï¼Œè¿”å›socket.erroré”™è¯¯ã€‚ s.connect_ex() connect()å‡½æ•°çš„æ‰©å±•ç‰ˆæœ¬,å‡ºé”™æ—¶è¿”å›å‡ºé”™ç ,è€Œä¸æ˜¯æŠ›å‡ºå¼‚å¸¸ å…¬å…±ç”¨é€”çš„å¥—æ¥å­—å‡½æ•° s.recv() æ¥æ”¶TCPæ•°æ®ï¼Œæ•°æ®ä»¥å­—ç¬¦ä¸²å½¢å¼è¿”å›ï¼ŒbufsizeæŒ‡å®šè¦æ¥æ”¶çš„æœ€å¤§æ•°æ®é‡ã€‚flagæä¾›æœ‰å…³æ¶ˆæ¯çš„å…¶ä»–ä¿¡æ¯ï¼Œé€šå¸¸å¯ä»¥å¿½ç•¥ã€‚ s.send() å‘é€TCPæ•°æ®ï¼Œå°†stringä¸­çš„æ•°æ®å‘é€åˆ°è¿æ¥çš„å¥—æ¥å­—ã€‚è¿”å›å€¼æ˜¯è¦å‘é€çš„å­—èŠ‚æ•°é‡ï¼Œè¯¥æ•°é‡å¯èƒ½å°äºstringçš„å­—èŠ‚å¤§å°ã€‚ s.sendall() å®Œæ•´å‘é€TCPæ•°æ®ï¼Œå®Œæ•´å‘é€TCPæ•°æ®ã€‚å°†stringä¸­çš„æ•°æ®å‘é€åˆ°è¿æ¥çš„å¥—æ¥å­—ï¼Œä½†åœ¨è¿”å›ä¹‹å‰ä¼šå°è¯•å‘é€æ‰€æœ‰æ•°æ®ã€‚æˆåŠŸè¿”å›Noneï¼Œå¤±è´¥åˆ™æŠ›å‡ºå¼‚å¸¸ã€‚ s.recvfrom() æ¥æ”¶UDPæ•°æ®ï¼Œä¸recv()ç±»ä¼¼ï¼Œä½†è¿”å›å€¼æ˜¯ï¼ˆdata,addressï¼‰ã€‚å…¶ä¸­dataæ˜¯åŒ…å«æ¥æ”¶æ•°æ®çš„å­—ç¬¦ä¸²ï¼Œaddressæ˜¯å‘é€æ•°æ®çš„å¥—æ¥å­—åœ°å€ã€‚ s.sendto() å‘é€UDPæ•°æ®ï¼Œå°†æ•°æ®å‘é€åˆ°å¥—æ¥å­—ï¼Œaddressæ˜¯å½¢å¼ä¸ºï¼ˆipaddrï¼Œportï¼‰çš„å…ƒç»„ï¼ŒæŒ‡å®šè¿œç¨‹åœ°å€ã€‚è¿”å›å€¼æ˜¯å‘é€çš„å­—èŠ‚æ•°ã€‚ s.close() å…³é—­å¥—æ¥å­— s.getpeername() è¿”å›è¿æ¥å¥—æ¥å­—çš„è¿œç¨‹åœ°å€ã€‚è¿”å›å€¼é€šå¸¸æ˜¯å…ƒç»„ï¼ˆipaddr,portï¼‰ã€‚ s.getsockname() è¿”å›å¥—æ¥å­—è‡ªå·±çš„åœ°å€ã€‚é€šå¸¸æ˜¯ä¸€ä¸ªå…ƒç»„(ipaddr,port) s.setsockopt(level,optname,value) è®¾ç½®ç»™å®šå¥—æ¥å­—é€‰é¡¹çš„å€¼ã€‚ s.getsockopt(level,optname[.buflen]) è¿”å›å¥—æ¥å­—é€‰é¡¹çš„å€¼ã€‚ s.settimeout(timeout) è®¾ç½®å¥—æ¥å­—æ“ä½œçš„è¶…æ—¶æœŸï¼Œtimeoutæ˜¯ä¸€ä¸ªæµ®ç‚¹æ•°ï¼Œå•ä½æ˜¯ç§’ã€‚å€¼ä¸ºNoneè¡¨ç¤ºæ²¡æœ‰è¶…æ—¶æœŸã€‚ä¸€èˆ¬ï¼Œè¶…æ—¶æœŸåº”è¯¥åœ¨åˆšåˆ›å»ºå¥—æ¥å­—æ—¶è®¾ç½®ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½ç”¨äºè¿æ¥çš„æ“ä½œï¼ˆå¦‚connect()ï¼‰ s.gettimeout() è¿”å›å½“å‰è¶…æ—¶æœŸçš„å€¼ï¼Œå•ä½æ˜¯ç§’ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®è¶…æ—¶æœŸï¼Œåˆ™è¿”å›Noneã€‚ s.fileno() è¿”å›å¥—æ¥å­—çš„æ–‡ä»¶æè¿°ç¬¦ã€‚ s.setblocking(flag) å¦‚æœflagä¸º0ï¼Œåˆ™å°†å¥—æ¥å­—è®¾ä¸ºéé˜»å¡æ¨¡å¼ï¼Œå¦åˆ™å°†å¥—æ¥å­—è®¾ä¸ºé˜»å¡æ¨¡å¼ï¼ˆé»˜è®¤å€¼ï¼‰ã€‚éé˜»å¡æ¨¡å¼ä¸‹ï¼Œå¦‚æœè°ƒç”¨recv()æ²¡æœ‰å‘ç°ä»»ä½•æ•°æ®ï¼Œæˆ–send()è°ƒç”¨æ— æ³•ç«‹å³å‘é€æ•°æ®ï¼Œé‚£ä¹ˆå°†å¼•èµ·socket.errorå¼‚å¸¸ã€‚ s.makefile() åˆ›å»ºä¸€ä¸ªä¸è¯¥å¥—æ¥å­—ç›¸å…³è¿çš„æ–‡ä»¶  ç½‘ç»œç¼–ç¨‹çš„åŸºæœ¬è®¾ç½®æ­¥éª¤ æœåŠ¡ç«¯é…ç½®  å¯¼å…¥socketæ¨¡å— ä½¿ç”¨bindæ–¹æ³•åˆ›å»ºå¥—æ¥å­— ä½¿ç”¨listenæ–¹æ³•ç­‰å¾…è¿æ¥ï¼Œ ä½¿ç”¨acceptæ–¹æ³•è¢«åŠ¨æ¥æ”¶tcpè¿æ¥ ä½¿ç”¨sendæˆ–recvæ–¹æ³•è¿›è¡Œæ”¶å‘  å®¢æˆ·ç«¯é…ç½®  å¯¼å…¥socketæ¨¡å— ä½¿ç”¨bindæ–¹æ³•åˆ›å»ºå¥—æ¥å­— ä½¿ç”¨connectæ–¹æ³•è¿›è¡Œä¸»åŠ¨tcpè¿æ¥ ä½¿ç”¨sendæˆ–recvæ–¹æ³•è¿›è¡Œæ”¶å‘  ","title":"pythonç½‘ç»œç¼–ç¨‹"},{"content":"RESTful API å…¥é—¨ 1. ç®€ä»‹ è¡¨ç°å±‚çŠ¶æ€è½¬æ¢ï¼ˆè‹±è¯­ï¼šRepresentational State Transferï¼Œç¼©å†™ï¼šRESTï¼‰æ˜¯Roy Thomas Fieldingåšå£«äº2000å¹´åœ¨ä»–çš„åšå£«è®ºæ–‡ä¸­æå‡ºæ¥çš„ä¸€ç§ä¸‡ç»´ç½‘è½¯ä»¶æ¶æ„é£æ ¼ï¼Œç›®çš„æ˜¯ä¾¿äºä¸åŒè½¯ä»¶/ç¨‹åºåœ¨ç½‘ç»œï¼ˆä¾‹å¦‚äº’è”ç½‘ï¼‰ä¸­äº’ç›¸ä¼ é€’ä¿¡æ¯ã€‚è¡¨ç°å±‚çŠ¶æ€è½¬æ¢æ˜¯æ ¹åŸºäºè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼ˆHTTPï¼‰ä¹‹ä¸Šè€Œç¡®å®šçš„ä¸€ç»„çº¦æŸå’Œå±æ€§ï¼Œæ˜¯ä¸€ç§è®¾è®¡æä¾›ä¸‡ç»´ç½‘ç»œæœåŠ¡çš„è½¯ä»¶æ„å»ºé£æ ¼ã€‚ç¬¦åˆæˆ–å…¼å®¹äºè¿™ç§æ¶æ„é£æ ¼ï¼ˆç®€ç§°ä¸º REST æˆ– RESTfulï¼‰çš„ç½‘ç»œæœåŠ¡ï¼Œå…è®¸å®¢æˆ·ç«¯å‘å‡ºä»¥ç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦è®¿é—®å’Œæ“ä½œç½‘ç»œèµ„æºçš„è¯·æ±‚ï¼Œè€Œä¸é¢„å…ˆå®šä¹‰å¥½çš„æ— çŠ¶æ€æ“ä½œé›†ä¸€è‡´åŒ–ã€‚å› æ­¤è¡¨ç°å±‚çŠ¶æ€è½¬æ¢æä¾›äº†åœ¨äº’è”ç½‘ç»œçš„è®¡ç®—ç³»ç»Ÿä¹‹é—´ï¼Œå½¼æ­¤èµ„æºå¯äº¤äº’ä½¿ç”¨çš„åä½œæ€§è´¨ï¼ˆinteroperabilityï¼‰ã€‚ç›¸å¯¹äºå…¶å®ƒç§ç±»çš„ç½‘ç»œæœåŠ¡ï¼Œä¾‹å¦‚SOAPæœåŠ¡ï¼Œåˆ™æ˜¯ä»¥æœ¬èº«æ‰€å®šä¹‰çš„æ“ä½œé›†ï¼Œæ¥è®¿é—®ç½‘ç»œä¸Šçš„èµ„æºã€‚\n2. REST æ¶æ„çº¦æŸ   å®¢æˆ·ç«¯ï¼æœåŠ¡å™¨ ä»æœ¬è´¨ä¸Šè®²ï¼Œè¿™æ„å‘³ç€å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå’ŒæœåŠ¡å™¨åº”ç”¨ç¨‹åºå¿…é¡»èƒ½å¤Ÿç‹¬ç«‹å‘å±•è€Œå½¼æ­¤ä¹‹é—´æ²¡æœ‰ä»»ä½•ä¾èµ–å…³ç³»ã€‚å®¢æˆ·ç«¯åº”è¯¥åªçŸ¥é“èµ„æºURIï¼Œä»…æ­¤è€Œå·²ã€‚ä»Šå¤©ï¼Œè¿™æ˜¯Webå¼€å‘ä¸­çš„å¸¸è§„åšæ³•ï¼Œå› æ­¤æ‚¨ä¸éœ€è¦ä»»ä½•èŠ±å“¨ã€‚æŠŠäº‹æƒ…ç®€å•åŒ–ã€‚\n æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹Ÿå¯ä»¥ç‹¬ç«‹æ›¿æ¢å’Œå¼€å‘ï¼Œåªè¦å®ƒä»¬ä¹‹é—´çš„æ¥å£æ²¡æœ‰æ›´æ”¹å³å¯ã€‚\n   æ— çŠ¶æ€\nRoy fieldingçš„çµæ„Ÿæ¥è‡ªHTTPï¼Œå› æ­¤å®ƒåæ˜ äº†è¿™ä¸€çº¦æŸã€‚ä½¿æ‰€æœ‰å®¢æˆ·ç«¯-æœåŠ¡å™¨äº¤äº’éƒ½å˜ä¸ºæ— çŠ¶æ€ã€‚æœåŠ¡å™¨å°†ä¸å­˜å‚¨æœ‰å…³å®¢æˆ·ç«¯å‘å‡ºçš„æœ€æ–°HTTPè¯·æ±‚çš„ä»»ä½•å†…å®¹ã€‚å®ƒå°†æ¯ä¸ªè¯·æ±‚è§†ä¸ºæ–°è¯·æ±‚ã€‚æ²¡æœ‰ä¼šè®®ï¼Œæ²¡æœ‰å†å²ã€‚\nå¦‚æœå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºéœ€è¦æ˜¯æœ€ç»ˆç”¨æˆ·çš„æœ‰çŠ¶æ€åº”ç”¨ç¨‹åºï¼Œåˆ™ç”¨æˆ·å¿…é¡»ç™»å½•ä¸€æ¬¡å¹¶åœ¨æ­¤ä¹‹åæ‰§è¡Œå…¶ä»–æˆæƒæ“ä½œï¼Œåˆ™æ¥è‡ªå®¢æˆ·ç«¯çš„æ¯ä¸ªè¯·æ±‚éƒ½åº”åŒ…å«æœåŠ¡äºè¯¥è¯·æ±‚çš„æ‰€æœ‰å¿…è¦ä¿¡æ¯ï¼ŒåŒ…æ‹¬èº«ä»½éªŒè¯å’Œæˆæƒç»†èŠ‚ã€‚\n è¯·æ±‚ä¹‹é—´ä¸å¾—åœ¨æœåŠ¡å™¨ä¸Šå­˜å‚¨ä»»ä½•å®¢æˆ·ç«¯ä¸Šä¸‹æ–‡ã€‚å®¢æˆ·ç«¯è´Ÿè´£ç®¡ç†åº”ç”¨ç¨‹åºçš„çŠ¶æ€ã€‚\n   ç»Ÿä¸€çš„æ¥å£ åœ¨çº¦æŸåç§°æœ¬èº«é€‚ç”¨çš„æƒ…å†µä¸‹ï¼Œæ‚¨å¿…é¡»ä¸ºç³»ç»Ÿå†…éƒ¨æš´éœ²ç»™APIä½¿ç”¨è€…å¹¶è®¤çœŸéµå¾ªçš„èµ„æºç¡®å®šAPIæ¥å£ã€‚ç³»ç»Ÿä¸­çš„èµ„æºåº”ä»…å…·æœ‰ä¸€ä¸ªé€»è¾‘URIï¼Œå¹¶ä¸”åº”æä¾›ä¸€ç§è·å–ç›¸å…³æˆ–é™„åŠ æ•°æ®çš„æ–¹å¼ã€‚æœ€å¥½å°†èµ„æºä¸ç½‘é¡µåŒä¹‰ã€‚\nä»»ä½•å•ä¸ªèµ„æºéƒ½ä¸åº”å¤ªå¤§ï¼Œå¹¶åœ¨å…¶è¡¨ç¤ºä¸­åŒ…å«æ‰€æœ‰å†…å®¹ã€‚åªè¦ç›¸å…³ï¼Œèµ„æºåº”åŒ…å«æŒ‡å‘ç›¸å¯¹URIçš„é“¾æ¥ï¼ˆHATEOASï¼‰ï¼Œä»¥è·å–ç›¸å…³ä¿¡æ¯ã€‚\næ­¤å¤–ï¼Œæ•´ä¸ªç³»ç»Ÿä¸Šçš„èµ„æºè¡¨ç¤ºåº”éµå¾ªç‰¹å®šçš„å‡†åˆ™ï¼Œä¾‹å¦‚å‘½åçº¦å®šï¼Œé“¾æ¥æ ¼å¼æˆ–æ•°æ®æ ¼å¼ï¼ˆXMLæˆ–/å’ŒJSONï¼‰ã€‚\næ‰€æœ‰èµ„æºéƒ½åº”é€šè¿‡é€šç”¨æ–¹æ³•ï¼ˆä¾‹å¦‚HTTP GETï¼‰è¿›è¡Œè®¿é—®ï¼Œå¹¶ä½¿ç”¨ä¸€è‡´çš„æ–¹æ³•è¿›è¡Œç±»ä¼¼çš„ä¿®æ”¹ã€‚\n ä¸€æ—¦å¼€å‘äººå‘˜ç†Ÿæ‚‰æ‚¨çš„ä¸€ä¸ªAPIï¼Œä»–å°±åº”è¯¥èƒ½å¤Ÿå¯¹å…¶ä»–APIéµå¾ªç±»ä¼¼çš„æ–¹æ³•ã€‚\n   åˆ†å±‚ç³»ç»Ÿ\nRESTå…è®¸æ‚¨ä½¿ç”¨åˆ†å±‚çš„ç³»ç»Ÿæ¶æ„ï¼Œåœ¨è¯¥æ¶æ„ä¸­ï¼Œæ‚¨å¯ä»¥åœ¨æœåŠ¡å™¨Aä¸Šéƒ¨ç½²APIï¼Œå¹¶åœ¨æœåŠ¡å™¨Bä¸Šå­˜å‚¨æ•°æ®å¹¶åœ¨æœåŠ¡å™¨Cä¸­å¯¹è¯·æ±‚è¿›è¡Œèº«ä»½éªŒè¯ã€‚å®¢æˆ·ç«¯é€šå¸¸æ— æ³•ç¡®å®šå®ƒæ˜¯ç›´æ¥è¿æ¥åˆ°æœ€ç»ˆæœåŠ¡å™¨è¿˜æ˜¯ä¸­â€‹â€‹é—´è¿æ¥ã€‚\n  å¯ç¼“å­˜çš„\nåœ¨å½“ä»Šä¸–ç•Œä¸­ï¼Œç¼“å­˜æ•°æ®å’Œå“åº”åœ¨ä»»ä½•é€‚ç”¨/å¯èƒ½çš„åœ°æ–¹éƒ½è‡³å…³é‡è¦ã€‚æˆ‘ä»¬é˜…è¯»çš„ç½‘é¡µä¹Ÿæ˜¯HTMLé¡µé¢çš„ç¼“å­˜ç‰ˆæœ¬ã€‚ç¼“å­˜å¯ä»¥æé«˜å®¢æˆ·ç«¯çš„æ€§èƒ½ï¼Œå¹¶ä¸ºæœåŠ¡å™¨æä¾›æ›´å¥½çš„å¯ä¼¸ç¼©æ€§ã€‚\nåœ¨RESTä¸­ï¼Œç¼“å­˜åº”åœ¨é€‚ç”¨æ—¶åº”ç”¨äºèµ„æºï¼Œç„¶åè¿™äº›èµ„æºå¿…é¡»å£°æ˜è‡ªå·±å¯ç¼“å­˜ã€‚å¯ä»¥åœ¨æœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯ä¸Šå®ç°ç¼“å­˜ã€‚\n ç®¡ç†è‰¯å¥½çš„ç¼“å­˜éƒ¨åˆ†æˆ–å®Œå…¨æ¶ˆé™¤äº†æŸäº›å®¢æˆ·ç«¯-æœåŠ¡å™¨äº¤äº’ï¼Œä»è€Œè¿›ä¸€æ­¥æé«˜äº†å¯ä¼¸ç¼©æ€§å’Œæ€§èƒ½ã€‚\n   æŒ‰éœ€ä»£ç ï¼ˆå¯é€‰ï¼‰\nå¥½å§ï¼Œè¿™ä¸ªçº¦æŸæ˜¯å¯é€‰çš„ã€‚å¤§å¤šæ•°æ—¶å€™ï¼Œæ‚¨å°†ä»¥XMLæˆ–JSONçš„å½¢å¼å‘é€èµ„æºçš„é™æ€è¡¨ç¤ºã€‚ä½†æ˜¯ï¼Œå¦‚æœéœ€è¦ï¼Œæ‚¨å¯ä»¥è‡ªç”±åœ°return executable codeæ”¯æŒåº”ç”¨ç¨‹åºçš„ä¸€éƒ¨åˆ†ï¼Œä¾‹å¦‚ï¼Œå®¢æˆ·ç«¯å¯ä»¥è°ƒç”¨æ‚¨çš„APIæ¥è·å–UIå°éƒ¨ä»¶å‘ˆç°ä»£ç ã€‚è¿™æ˜¯å…è®¸çš„ã€‚\n ä»¥ä¸Šæ‰€æœ‰çº¦æŸæ¡ä»¶éƒ½å¯ä»¥å¸®åŠ©æ‚¨æ„å»ºçœŸæ­£çš„RESTful APIï¼Œå¹¶ä¸”åº”è¯¥éµå¾ªå®ƒä»¬ã€‚ä¸è¿‡ï¼Œæœ‰æ—¶æ‚¨å¯èƒ½ä¼šå‘ç°è‡ªå·±è¿åäº†ä¸€ä¸¤ä¸ªçº¦æŸã€‚åˆ«æ‹…å¿ƒ; æ‚¨ä»åœ¨åˆ¶ä½œRESTful APIï¼Œä½†ä¸æ˜¯â€œçœŸæ­£çš„RESTfulâ€ã€‚\n   3. RESTèµ„æºå‘½åæŒ‡å— åœ¨RESTä¸­ï¼Œä¸»è¦æ•°æ®è¡¨ç¤ºç§°ä¸ºResourceã€‚ä»é•¿è¿œæ¥çœ‹ï¼Œæ‹¥æœ‰ä¸€ä¸ªå¼ºå¤§ä¸”ä¸€è‡´çš„RESTèµ„æºå‘½åç­–ç•¥â€“æ— ç–‘å°†è¯æ˜æ˜¯æœ€ä½³çš„è®¾è®¡å†³ç­–ä¹‹ä¸€ã€‚\n RESTä¸­ä¿¡æ¯çš„å…³é”®æŠ½è±¡æ˜¯ä¸€ç§èµ„æºã€‚å¯ä»¥å‘½åçš„ä»»ä½•ä¿¡æ¯éƒ½å¯ä»¥æ˜¯èµ„æºï¼šæ–‡æ¡£æˆ–å›¾åƒï¼Œä¸´æ—¶æœåŠ¡ï¼ˆä¾‹å¦‚â€œæ´›æ‰çŸ¶ä»Šå¤©çš„å¤©æ°”â€ï¼‰ï¼Œå…¶ä»–èµ„æºçš„é›†åˆï¼Œéè™šæ‹Ÿå¯¹è±¡ï¼ˆä¾‹å¦‚äººï¼‰ç­‰ä¸Šã€‚æ¢å¥è¯è¯´ï¼Œä»»ä½•å¯èƒ½æˆä¸ºä½œè€…è¶…æ–‡æœ¬å¼•ç”¨ç›®æ ‡çš„æ¦‚å¿µéƒ½å¿…é¡»ç¬¦åˆèµ„æºçš„å®šä¹‰ã€‚èµ„æºæ˜¯åˆ°ä¸€ç»„å®ä½“çš„æ¦‚å¿µæ˜ å°„ï¼Œè€Œä¸æ˜¯åœ¨ä»»ä½•ç‰¹å®šæ—¶é—´ç‚¹å¯¹åº”äºè¯¥æ˜ å°„çš„å®ä½“ã€‚\n ä¸€ä¸ªèµ„æºå¯ä»¥æ˜¯å•ä¸ªçš„æˆ–ä¸€ä¸ªé›†åˆã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªé“¶è¡Œåº”ç”¨ä¸­ï¼Œcustomersä»£è¡¨ä¸€ä¸ªèµ„æºé›†åˆï¼Œcustomerä»£è¡¨å•ä¸ªèµ„æºã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨URL\u0026quot;/customers\u0026ldquo;æ¥æ ‡è®°customersï¼Œå¯ä»¥ä½¿ç”¨URL\u0026rdquo;/customers/{customerId}\u0026ldquo;æ¥æ ‡è®°customer\nä¸€ä¸ªèµ„æºå¯èƒ½åŒ…æ‹¬å¤šä¸ªå­èµ„æºã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªcustomerçš„å­èµ„æºaccountå¯ä»¥ä½¿ç”¨URL\u0026rdquo;/customers/{customerId}/accounts\u0026ldquo;æ¥æ ‡è®°ï¼›ç±»ä¼¼çš„ï¼Œaccountsçš„å­èµ„æºaccountå¯ä»¥æ ‡è®°å¦‚ä¸‹ï¼šURL\u0026rdquo;```/customers/{customerId}/accounts/{accountId}\n4. RESTèµ„æºå‘½åå®è·µ 4.1 ä½¿ç”¨åè¯æ¥è¡¨ç¤ºèµ„æº RESTful URIåº”è¯¥å¼•ç”¨ä½œä¸ºäº‹ç‰©ï¼ˆåè¯ï¼‰çš„èµ„æºï¼Œè€Œä¸æ˜¯å¼•ç”¨åŠ¨ä½œï¼ˆåŠ¨è¯ï¼‰ï¼Œå› ä¸ºåè¯å…·æœ‰åŠ¨è¯æ‰€æ²¡æœ‰çš„å±æ€§â€“ç±»ä¼¼äºèµ„æºå…·æœ‰å±æ€§ã€‚èµ„æºçš„ä¸€äº›ç¤ºä¾‹æ˜¯ï¼š\n Users of the system User Accounts Network Devices etc.  ä»–ä»¬çš„èµ„æºURLåº”è¯¥å¦‚ä¸‹ï¼š\n* http://api.example.com/device-management/managed-devices * http://api.example.com/device-management/managed-devices/{device-id} * http://api.example.com/user-management/users/ * http://api.example.com/user-management/users/{id} ä¸ºäº†æ›´åŠ æ¸…æ™°ï¼Œè®©æˆ‘ä»¬å°†èµ„æºåŸå‹åˆ†ä¸ºå››ç±»**ï¼ˆdocument, collection, store and controllerï¼‰**ï¼Œç„¶åæ‚¨å§‹ç»ˆåº”è¯¥ä»¥å°†èµ„æºæ”¾å…¥ä¸€ä¸ªåŸå‹ä¸ºç›®æ ‡ï¼Œç„¶åä¸€è‡´åœ°ä½¿ç”¨å…¶å‘½åçº¦å®šã€‚ä¸ºäº†ç»Ÿä¸€èµ·è§ï¼Œè¯·æŠµåˆ¶è®¾è®¡èµ„æºçš„è¯±æƒ‘ï¼Œè¿™äº›èµ„æºæ˜¯å¤šä¸ªåŸå‹çš„æ··åˆä½“ã€‚\n  Document\næ–‡æ¡£èµ„æºæ˜¯å•ä¸ªæ¦‚å¿µï¼Œç±»ä¼¼äºå¯¹è±¡å®ä¾‹æˆ–æ•°æ®åº“è®°å½•ã€‚åœ¨RESTä¸­ï¼Œæ‚¨å¯ä»¥å°†å…¶è§†ä¸ºèµ„æºé›†åˆä¸­çš„å•ä¸ªèµ„æºã€‚æ–‡æ¡£çš„çŠ¶æ€è¡¨ç¤ºå½¢å¼é€šå¸¸åŒ…æ‹¬å¸¦æœ‰å€¼çš„å­—æ®µä»¥åŠæŒ‡å‘å…¶ä»–ç›¸å…³èµ„æºçš„é“¾æ¥ã€‚\nä½¿ç”¨â€œå•æ•°â€åç§°è¡¨ç¤ºæ–‡æ¡£èµ„æºåŸå‹ã€‚\nhttp://api.example.com/device-management/managed-devices/{device-id} http://api.example.com/user-management/users/{id} http://api.example.com/user-management/users/admin   Collection\nCollectionèµ„æºæ˜¯æœåŠ¡å™¨ç®¡ç†çš„èµ„æºç›®å½•ã€‚å®¢æˆ·å¯ä»¥å»ºè®®å°†æ–°èµ„æºæ·»åŠ åˆ°Collectionä¸­ã€‚ä½†æ˜¯ï¼Œç”±Collectionå†³å®šæ˜¯å¦åˆ›å»ºæ–°èµ„æºã€‚Collectionèµ„æºé€‰æ‹©è¦åŒ…å«çš„å†…å®¹ï¼Œå¹¶ç¡®å®šæ¯ä¸ªåŒ…å«çš„èµ„æºçš„URIã€‚\nä½¿ç”¨å¤æ•°åç§°è¡¨ç¤ºCollectionèµ„æºåŸå‹ã€‚\nhttp://api.example.com/device-management/managed-devices http://api.example.com/user-management/users http://api.example.com/user-management/users/{id}/admin   Store\nStoreæ˜¯å®¢æˆ·ç«¯ç®¡ç†çš„èµ„æºå­˜å‚¨åº“ã€‚Storeèµ„æºå¯è®©APIå®¢æˆ·ç«¯æ”¾å…¥èµ„æºï¼Œå°†å…¶æ’¤å›å¹¶å†³å®šä½•æ—¶åˆ é™¤å®ƒä»¬ã€‚Storeæ°¸è¿œä¸ä¼šç”Ÿæˆæ–°çš„URIã€‚å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œæ¯ä¸ªå­˜å‚¨çš„èµ„æºéƒ½æœ‰ä¸€ä¸ªURIï¼Œè¯¥URIæ˜¯å®¢æˆ·ç«¯åœ¨æœ€åˆå°†å…¶æ”¾å…¥Storeæ—¶é€‰æ‹©çš„ã€‚\nä½¿ç”¨å¤æ•°åç§°è¡¨ç¤ºStoreèµ„æºåŸå‹ã€‚\nhttp://api.example.com/cart-management/users/{id}/carts http://api.example.com/song-management/users/{id}/accounts   Controller\nController èµ„æºä¸ºè¿‡ç¨‹æ¦‚å¿µå»ºæ¨¡ã€‚Controller èµ„æºå°±åƒå¯æ‰§è¡Œå‡½æ•°ä¸€æ ·ï¼Œå¸¦æœ‰å‚æ•°å’Œè¿”å›å€¼ã€‚è¾“å…¥å’Œè¾“å‡ºã€‚\nä½¿ç”¨åŠ¨è¯è¡¨ç¤ºæ§åˆ¶å™¨åŸå‹ã€‚\nhttp://api.example.com/cart-management/users/{id}/cart/checkout http://api.example.com/song-management/users/{id}/playlist/play   4.2. ä¸€è‡´æ€§æ˜¯å…³é”® ä½¿ç”¨ä¸€è‡´çš„èµ„æºå‘½åçº¦å®šå’ŒURIæ ¼å¼ï¼Œä»¥æœ€å¤§ç¨‹åº¦åœ°å‡å°‘æ­§ä¹‰å¹¶æœ€å¤§ç¨‹åº¦åœ°æé«˜å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚æ‚¨å¯ä»¥å®ç°ä»¥ä¸‹è®¾è®¡æç¤ºä»¥å®ç°ä¸€è‡´æ€§ï¼š\n  ä½¿ç”¨æ­£æ–œæ ï¼ˆ/ï¼‰è¡¨ç¤ºå±‚æ¬¡å…³ç³»\nURIçš„è·¯å¾„éƒ¨åˆ†ä½¿ç”¨æ­£æ–œæ ï¼ˆ/ï¼‰å­—ç¬¦è¡¨ç¤ºèµ„æºä¹‹é—´çš„å±‚æ¬¡å…³ç³»ã€‚ä¾‹å¦‚\nhttp://api.example.com/device-management http://api.example.com/device-management/managed-devices http://api.example.com/device-management/managed-devices/{id} http://api.example.com/device-management/managed-devices/{id}/scripts http://api.example.com/device-management/managed-devices/{id}/scripts/{id}   ä¸è¦åœ¨URIä¸­ä½¿ç”¨ç»“å°¾çš„æ­£æ–œæ (/)\nä½œä¸ºURIè·¯å¾„ä¸­çš„æœ€åä¸€ä¸ªå­—ç¬¦ï¼Œæ­£æ–œæ ï¼ˆ/ï¼‰ä¸æ·»åŠ è¯­ä¹‰å€¼ï¼Œå¹¶ä¸”å¯èƒ½å¼•èµ·æ··æ·†ã€‚æœ€å¥½å°†å®ƒä»¬å®Œå…¨åˆ é™¤ã€‚\nhttp://api.example.com/device-management/managed-devices/ http://api.example.com/device-management/managed-devices # è¿™æ˜¯æ›´å¥½çš„ç‰ˆæœ¬ ```   ä½¿ç”¨è¿å­—ç¬¦ï¼ˆ-ï¼‰æ¥æé«˜URIçš„å¯è¯»æ€§\nä¸ºäº†ä½¿ä½ çš„URIæ˜“äºäººä»¬æ‰«æå’Œè§£é‡Šï¼Œè¯·ä½¿ç”¨è¿å­—ç¬¦ï¼ˆ-ï¼‰æ¥æé«˜é•¿è·¯å¾„æ®µä¸­åç§°çš„å¯è¯»æ€§ã€‚\nhttp://api.example.com/inventory-management/managed-entities/{id}/install-script-location # å¯è¯»æ€§å¼º http://api.example.com/inventory-management/managedEntities/{id}/installScriptLocation # å¯è¯»æ€§è¾ƒä½   è¯·å‹¿ä½¿ç”¨ä¸‹åˆ’çº¿ï¼ˆ_ï¼‰\nå¯ä»¥ä½¿ç”¨ä¸‹åˆ’çº¿ä»£æ›¿è¿å­—ç¬¦ä½œä¸ºåˆ†éš”ç¬¦â€“ä½†æ˜¯ï¼Œæ ¹æ®åº”ç”¨ç¨‹åºçš„å­—ä½“ï¼Œä¸‹åˆ’çº¿ï¼ˆ_ï¼‰å­—ç¬¦å¯èƒ½ä¼šåœ¨æŸäº›æµè§ˆå™¨æˆ–å±å¹•ä¸­è¢«éƒ¨åˆ†é®ç›–æˆ–å®Œå…¨éšè—ã€‚\nä¸ºé¿å…è¿™ç§æ··æ·†ï¼Œè¯·ä½¿ç”¨è¿å­—ç¬¦ï¼ˆ-ï¼‰ä»£æ›¿ä¸‹åˆ’çº¿ï¼ˆ_ï¼‰ã€‚\nhttp://api.example.com/inventory-management/managed-entities/{id}/install-script-location # More readable http://api.example.com/inventory_management/managed_entities/{id}/install_script_location # More error prone   åœ¨URIä¸­ä½¿ç”¨å°å†™å­—æ¯\næ–¹ä¾¿æ—¶ï¼Œåœ¨URIè·¯å¾„ä¸­åº”å§‹ç»ˆé¦–é€‰å°å†™å­—æ¯ã€‚\nRFC 3986å°†URIå®šä¹‰ä¸ºåŒºåˆ†å¤§å°å†™ï¼Œä½†æ–¹æ¡ˆå’Œä¸»æœºç»„ä»¶é™¤å¤–ã€‚ä¾‹å¦‚\nhttp://api.example.org/my-folder/my-doc // 1 HTTP://API.EXAMPLE.ORG/my-folder/my-doc // 2 http://api.example.org/My-Folder/my-doc // 3 åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œ1å’Œ2ç›¸åŒï¼Œä½†3ä¸æ˜¯ï¼Œå› ä¸ºå®ƒä»¥å¤§å†™å­—æ¯ä½¿ç”¨My-Folderã€‚\n  ä¸è¦ä½¿ç”¨æ–‡ä»¶æ‰©å±•å\næ–‡ä»¶æ‰©å±•åçœ‹èµ·æ¥å¾ˆç³Ÿç³•ï¼Œå¹¶ä¸”æ²¡æœ‰ä»»ä½•ä¼˜åŠ¿ã€‚åˆ é™¤å®ƒä»¬ä¹Ÿä¼šå‡å°‘URIçš„é•¿åº¦ã€‚æ²¡æœ‰ç†ç”±ä¿ç•™å®ƒä»¬ã€‚\né™¤ä¸Šè¿°åŸå› å¤–ï¼Œå¦‚æœè¦ä½¿ç”¨æ–‡ä»¶æ‰©å±•åçªå‡ºæ˜¾ç¤ºAPIçš„åª’ä½“ç±»å‹ï¼Œåˆ™åº”ä¾é é€šè¿‡Content-Typeæ ‡å¤´ä¼ è¾¾çš„åª’ä½“ç±»å‹æ¥ç¡®å®šå¦‚ä½•å¤„ç†æ­£æ–‡å†…å®¹ã€‚\nhttp://api.example.com/device-management/managed-devices.xml # è¯·å‹¿ä½¿ç”¨ http://api.example.com/device-management/managed-devices # è¿™æ˜¯æ­£ç¡®çš„URI   5. ä¸è¦åœ¨URLä¸­ä½¿ç”¨CRUDå‡½æ•°åç§° URIä¸åº”ç”¨äºæŒ‡ç¤ºæ‰§è¡ŒCRUDåŠŸèƒ½ã€‚URIåº”è¯¥ç”¨äºå”¯ä¸€æ ‡è¯†èµ„æºï¼Œè€Œä¸æ˜¯å¯¹èµ„æºè¿›è¡Œä»»ä½•æ“ä½œã€‚åº”è¯¥ä½¿ç”¨HTTPè¯·æ±‚æ–¹æ³•æ¥æŒ‡ç¤ºæ‰§è¡Œäº†å“ªä¸ªCRUDåŠŸèƒ½ã€‚\nHTTP GET http://api.example.com/device-management/managed-devices //è·å–æ‰€æœ‰è®¾å¤‡ HTTP POST http://api.example.com/device-management/managed-devices //åˆ›å»ºæ–°è®¾å¤‡ HTTP GET http://api.example.com/device-management/managed-devices/{id} //è·å–ç»™å®šIDçš„è®¾å¤‡ HTTP PUT http://api.example.com/device-management/managed-devices/{id} //æ›´æ–°ç»™å®šIDçš„è®¾å¤‡ HTTP DELETE http://api.example.com/device-management/managed-devices/{id} //åˆ é™¤ç»™å®šIDçš„è®¾å¤‡ 6. ä½¿ç”¨æŸ¥è¯¢ç»„ä»¶è¿‡æ»¤URLé›†åˆ å¾ˆå¤šæ—¶å€™ï¼Œæ‚¨ä¼šé‡åˆ°éœ€æ±‚ï¼Œåœ¨è¿™äº›éœ€æ±‚ä¸­ï¼Œæ‚¨å°†éœ€è¦æ ¹æ®æŸäº›èµ„æºå±æ€§å¯¹èµ„æºè¿›è¡Œæ’åºï¼Œè¿‡æ»¤æˆ–é™åˆ¶çš„é›†åˆã€‚ä¸ºæ­¤ï¼Œè¯·å‹¿åˆ›å»ºæ–°çš„APIï¼Œè€Œåº”åœ¨èµ„æºæ”¶é›†APIä¸­å¯ç”¨æ’åºï¼Œè¿‡æ»¤å’Œåˆ†é¡µåŠŸèƒ½ï¼Œå¹¶å°†è¾“å…¥å‚æ•°ä½œä¸ºæŸ¥è¯¢å‚æ•°ä¼ é€’ã€‚ä¾‹å¦‚\nhttp://api.example.com/device-management/managed-devices http://api.example.com/device-management/managed-devices?region=USA http://api.example.com/device-management/managed-devices?region=USA\u0026amp;brand=XYZ http://api.example.com/device-management/managed-devices?region=USA\u0026amp;brand=XYZ\u0026amp;sort=installation-date 7. ä½¿ç”¨æ­£ç¡®çš„HTTP Status Codeè¡¨ç¤ºè®¿é—®çŠ¶æ€ 8. é”™è¯¯è¿”å›ä½¿ç”¨æ˜ç¡®æ˜“æ‡‚çš„æ–‡æœ¬ ","permalink":"http://yangchnet.github.io/Dessert/posts/net/restful-api/","summary":"RESTful API å…¥é—¨ 1. ç®€ä»‹ è¡¨ç°å±‚çŠ¶æ€è½¬æ¢ï¼ˆè‹±è¯­ï¼šRepresentational State Transferï¼Œç¼©å†™ï¼šRESTï¼‰æ˜¯Roy Thomas Fieldingåšå£«äº2000å¹´åœ¨ä»–çš„åšå£«è®ºæ–‡ä¸­æå‡ºæ¥çš„ä¸€ç§ä¸‡ç»´ç½‘è½¯ä»¶æ¶æ„é£æ ¼ï¼Œç›®çš„æ˜¯ä¾¿äºä¸åŒè½¯ä»¶/ç¨‹åºåœ¨ç½‘ç»œï¼ˆä¾‹å¦‚äº’è”ç½‘ï¼‰ä¸­äº’ç›¸ä¼ é€’ä¿¡æ¯ã€‚è¡¨ç°å±‚çŠ¶æ€è½¬æ¢æ˜¯æ ¹åŸºäºè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼ˆHTTPï¼‰ä¹‹ä¸Šè€Œç¡®å®šçš„ä¸€ç»„çº¦æŸå’Œå±æ€§ï¼Œæ˜¯ä¸€ç§è®¾è®¡æä¾›ä¸‡ç»´ç½‘ç»œæœåŠ¡çš„è½¯ä»¶æ„å»ºé£æ ¼ã€‚ç¬¦åˆæˆ–å…¼å®¹äºè¿™ç§æ¶æ„é£æ ¼ï¼ˆç®€ç§°ä¸º REST æˆ– RESTfulï¼‰çš„ç½‘ç»œæœåŠ¡ï¼Œå…è®¸å®¢æˆ·ç«¯å‘å‡ºä»¥ç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦è®¿é—®å’Œæ“ä½œç½‘ç»œèµ„æºçš„è¯·æ±‚ï¼Œè€Œä¸é¢„å…ˆå®šä¹‰å¥½çš„æ— çŠ¶æ€æ“ä½œé›†ä¸€è‡´åŒ–ã€‚å› æ­¤è¡¨ç°å±‚çŠ¶æ€è½¬æ¢æä¾›äº†åœ¨äº’è”ç½‘ç»œçš„è®¡ç®—ç³»ç»Ÿä¹‹é—´ï¼Œå½¼æ­¤èµ„æºå¯äº¤äº’ä½¿ç”¨çš„åä½œæ€§è´¨ï¼ˆinteroperabilityï¼‰ã€‚ç›¸å¯¹äºå…¶å®ƒç§ç±»çš„ç½‘ç»œæœåŠ¡ï¼Œä¾‹å¦‚SOAPæœåŠ¡ï¼Œåˆ™æ˜¯ä»¥æœ¬èº«æ‰€å®šä¹‰çš„æ“ä½œé›†ï¼Œæ¥è®¿é—®ç½‘ç»œä¸Šçš„èµ„æºã€‚\n2. REST æ¶æ„çº¦æŸ   å®¢æˆ·ç«¯ï¼æœåŠ¡å™¨ ä»æœ¬è´¨ä¸Šè®²ï¼Œè¿™æ„å‘³ç€å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå’ŒæœåŠ¡å™¨åº”ç”¨ç¨‹åºå¿…é¡»èƒ½å¤Ÿç‹¬ç«‹å‘å±•è€Œå½¼æ­¤ä¹‹é—´æ²¡æœ‰ä»»ä½•ä¾èµ–å…³ç³»ã€‚å®¢æˆ·ç«¯åº”è¯¥åªçŸ¥é“èµ„æºURIï¼Œä»…æ­¤è€Œå·²ã€‚ä»Šå¤©ï¼Œè¿™æ˜¯Webå¼€å‘ä¸­çš„å¸¸è§„åšæ³•ï¼Œå› æ­¤æ‚¨ä¸éœ€è¦ä»»ä½•èŠ±å“¨ã€‚æŠŠäº‹æƒ…ç®€å•åŒ–ã€‚\n æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹Ÿå¯ä»¥ç‹¬ç«‹æ›¿æ¢å’Œå¼€å‘ï¼Œåªè¦å®ƒä»¬ä¹‹é—´çš„æ¥å£æ²¡æœ‰æ›´æ”¹å³å¯ã€‚\n   æ— çŠ¶æ€\nRoy fieldingçš„çµæ„Ÿæ¥è‡ªHTTPï¼Œå› æ­¤å®ƒåæ˜ äº†è¿™ä¸€çº¦æŸã€‚ä½¿æ‰€æœ‰å®¢æˆ·ç«¯-æœåŠ¡å™¨äº¤äº’éƒ½å˜ä¸ºæ— çŠ¶æ€ã€‚æœåŠ¡å™¨å°†ä¸å­˜å‚¨æœ‰å…³å®¢æˆ·ç«¯å‘å‡ºçš„æœ€æ–°HTTPè¯·æ±‚çš„ä»»ä½•å†…å®¹ã€‚å®ƒå°†æ¯ä¸ªè¯·æ±‚è§†ä¸ºæ–°è¯·æ±‚ã€‚æ²¡æœ‰ä¼šè®®ï¼Œæ²¡æœ‰å†å²ã€‚\nå¦‚æœå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºéœ€è¦æ˜¯æœ€ç»ˆç”¨æˆ·çš„æœ‰çŠ¶æ€åº”ç”¨ç¨‹åºï¼Œåˆ™ç”¨æˆ·å¿…é¡»ç™»å½•ä¸€æ¬¡å¹¶åœ¨æ­¤ä¹‹åæ‰§è¡Œå…¶ä»–æˆæƒæ“ä½œï¼Œåˆ™æ¥è‡ªå®¢æˆ·ç«¯çš„æ¯ä¸ªè¯·æ±‚éƒ½åº”åŒ…å«æœåŠ¡äºè¯¥è¯·æ±‚çš„æ‰€æœ‰å¿…è¦ä¿¡æ¯ï¼ŒåŒ…æ‹¬èº«ä»½éªŒè¯å’Œæˆæƒç»†èŠ‚ã€‚\n è¯·æ±‚ä¹‹é—´ä¸å¾—åœ¨æœåŠ¡å™¨ä¸Šå­˜å‚¨ä»»ä½•å®¢æˆ·ç«¯ä¸Šä¸‹æ–‡ã€‚å®¢æˆ·ç«¯è´Ÿè´£ç®¡ç†åº”ç”¨ç¨‹åºçš„çŠ¶æ€ã€‚\n   ç»Ÿä¸€çš„æ¥å£ åœ¨çº¦æŸåç§°æœ¬èº«é€‚ç”¨çš„æƒ…å†µä¸‹ï¼Œæ‚¨å¿…é¡»ä¸ºç³»ç»Ÿå†…éƒ¨æš´éœ²ç»™APIä½¿ç”¨è€…å¹¶è®¤çœŸéµå¾ªçš„èµ„æºç¡®å®šAPIæ¥å£ã€‚ç³»ç»Ÿä¸­çš„èµ„æºåº”ä»…å…·æœ‰ä¸€ä¸ªé€»è¾‘URIï¼Œå¹¶ä¸”åº”æä¾›ä¸€ç§è·å–ç›¸å…³æˆ–é™„åŠ æ•°æ®çš„æ–¹å¼ã€‚æœ€å¥½å°†èµ„æºä¸ç½‘é¡µåŒä¹‰ã€‚\nä»»ä½•å•ä¸ªèµ„æºéƒ½ä¸åº”å¤ªå¤§ï¼Œå¹¶åœ¨å…¶è¡¨ç¤ºä¸­åŒ…å«æ‰€æœ‰å†…å®¹ã€‚åªè¦ç›¸å…³ï¼Œèµ„æºåº”åŒ…å«æŒ‡å‘ç›¸å¯¹URIçš„é“¾æ¥ï¼ˆHATEOASï¼‰ï¼Œä»¥è·å–ç›¸å…³ä¿¡æ¯ã€‚\næ­¤å¤–ï¼Œæ•´ä¸ªç³»ç»Ÿä¸Šçš„èµ„æºè¡¨ç¤ºåº”éµå¾ªç‰¹å®šçš„å‡†åˆ™ï¼Œä¾‹å¦‚å‘½åçº¦å®šï¼Œé“¾æ¥æ ¼å¼æˆ–æ•°æ®æ ¼å¼ï¼ˆXMLæˆ–/å’ŒJSONï¼‰ã€‚\næ‰€æœ‰èµ„æºéƒ½åº”é€šè¿‡é€šç”¨æ–¹æ³•ï¼ˆä¾‹å¦‚HTTP GETï¼‰è¿›è¡Œè®¿é—®ï¼Œå¹¶ä½¿ç”¨ä¸€è‡´çš„æ–¹æ³•è¿›è¡Œç±»ä¼¼çš„ä¿®æ”¹ã€‚\n ä¸€æ—¦å¼€å‘äººå‘˜ç†Ÿæ‚‰æ‚¨çš„ä¸€ä¸ªAPIï¼Œä»–å°±åº”è¯¥èƒ½å¤Ÿå¯¹å…¶ä»–APIéµå¾ªç±»ä¼¼çš„æ–¹æ³•ã€‚\n   åˆ†å±‚ç³»ç»Ÿ\nRESTå…è®¸æ‚¨ä½¿ç”¨åˆ†å±‚çš„ç³»ç»Ÿæ¶æ„ï¼Œåœ¨è¯¥æ¶æ„ä¸­ï¼Œæ‚¨å¯ä»¥åœ¨æœåŠ¡å™¨Aä¸Šéƒ¨ç½²APIï¼Œå¹¶åœ¨æœåŠ¡å™¨Bä¸Šå­˜å‚¨æ•°æ®å¹¶åœ¨æœåŠ¡å™¨Cä¸­å¯¹è¯·æ±‚è¿›è¡Œèº«ä»½éªŒè¯ã€‚å®¢æˆ·ç«¯é€šå¸¸æ— æ³•ç¡®å®šå®ƒæ˜¯ç›´æ¥è¿æ¥åˆ°æœ€ç»ˆæœåŠ¡å™¨è¿˜æ˜¯ä¸­â€‹â€‹é—´è¿æ¥ã€‚\n  å¯ç¼“å­˜çš„\nåœ¨å½“ä»Šä¸–ç•Œä¸­ï¼Œç¼“å­˜æ•°æ®å’Œå“åº”åœ¨ä»»ä½•é€‚ç”¨/å¯èƒ½çš„åœ°æ–¹éƒ½è‡³å…³é‡è¦ã€‚æˆ‘ä»¬é˜…è¯»çš„ç½‘é¡µä¹Ÿæ˜¯HTMLé¡µé¢çš„ç¼“å­˜ç‰ˆæœ¬ã€‚ç¼“å­˜å¯ä»¥æé«˜å®¢æˆ·ç«¯çš„æ€§èƒ½ï¼Œå¹¶ä¸ºæœåŠ¡å™¨æä¾›æ›´å¥½çš„å¯ä¼¸ç¼©æ€§ã€‚\nåœ¨RESTä¸­ï¼Œç¼“å­˜åº”åœ¨é€‚ç”¨æ—¶åº”ç”¨äºèµ„æºï¼Œç„¶åè¿™äº›èµ„æºå¿…é¡»å£°æ˜è‡ªå·±å¯ç¼“å­˜ã€‚å¯ä»¥åœ¨æœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯ä¸Šå®ç°ç¼“å­˜ã€‚\n ç®¡ç†è‰¯å¥½çš„ç¼“å­˜éƒ¨åˆ†æˆ–å®Œå…¨æ¶ˆé™¤äº†æŸäº›å®¢æˆ·ç«¯-æœåŠ¡å™¨äº¤äº’ï¼Œä»è€Œè¿›ä¸€æ­¥æé«˜äº†å¯ä¼¸ç¼©æ€§å’Œæ€§èƒ½ã€‚\n   æŒ‰éœ€ä»£ç ï¼ˆå¯é€‰ï¼‰\nå¥½å§ï¼Œè¿™ä¸ªçº¦æŸæ˜¯å¯é€‰çš„ã€‚å¤§å¤šæ•°æ—¶å€™ï¼Œæ‚¨å°†ä»¥XMLæˆ–JSONçš„å½¢å¼å‘é€èµ„æºçš„é™æ€è¡¨ç¤ºã€‚ä½†æ˜¯ï¼Œå¦‚æœéœ€è¦ï¼Œæ‚¨å¯ä»¥è‡ªç”±åœ°return executable codeæ”¯æŒåº”ç”¨ç¨‹åºçš„ä¸€éƒ¨åˆ†ï¼Œä¾‹å¦‚ï¼Œå®¢æˆ·ç«¯å¯ä»¥è°ƒç”¨æ‚¨çš„APIæ¥è·å–UIå°éƒ¨ä»¶å‘ˆç°ä»£ç ã€‚è¿™æ˜¯å…è®¸çš„ã€‚\n ä»¥ä¸Šæ‰€æœ‰çº¦æŸæ¡ä»¶éƒ½å¯ä»¥å¸®åŠ©æ‚¨æ„å»ºçœŸæ­£çš„RESTful APIï¼Œå¹¶ä¸”åº”è¯¥éµå¾ªå®ƒä»¬ã€‚ä¸è¿‡ï¼Œæœ‰æ—¶æ‚¨å¯èƒ½ä¼šå‘ç°è‡ªå·±è¿åäº†ä¸€ä¸¤ä¸ªçº¦æŸã€‚åˆ«æ‹…å¿ƒ; æ‚¨ä»åœ¨åˆ¶ä½œRESTful APIï¼Œä½†ä¸æ˜¯â€œçœŸæ­£çš„RESTfulâ€ã€‚\n   3. RESTèµ„æºå‘½åæŒ‡å— åœ¨RESTä¸­ï¼Œä¸»è¦æ•°æ®è¡¨ç¤ºç§°ä¸ºResourceã€‚ä»é•¿è¿œæ¥çœ‹ï¼Œæ‹¥æœ‰ä¸€ä¸ªå¼ºå¤§ä¸”ä¸€è‡´çš„RESTèµ„æºå‘½åç­–ç•¥â€“æ— ç–‘å°†è¯æ˜æ˜¯æœ€ä½³çš„è®¾è®¡å†³ç­–ä¹‹ä¸€ã€‚","title":"RESTfulAPIå…¥é—¨"},{"content":"Simple Support Vector Machine First we will import numpy to easily manage linear algebra and calculus operations in python. To plot the learning progress later on, we will use matplotlib.\nimport numpy as np from matplotlib import pyplot as plt %matplotlib inline Stochastic Gradient Descent The svm will learn using the stochastic gradient descent algorithm (SGD). Gradient Descent minimizes a function by following the gradients of the cost function.\nCalculating the Error To calculate the error of a prediction we first need to define the objective function of the svm.\nHinge Loss Function To do this, we need to define the loss function, to calculate the prediction error. We will use hinge loss for our perceptron:\n$$c(x, y, f(x)) = (1 - y * f(x))_+$$\n$c$ is the loss function, $x$ the sample, $y$ is the true label, $f(x)$ the predicted label.\nThis means the following: $$ c(x, y, f(x))= \\begin{cases} 0,\u0026amp; \\text{if } yf(x)\\geq 1\\\n1-yf(x), \u0026amp; \\text{else} \\end{cases} $$\nSo consider, if y and f(x) are signed values $(+1,-1)$:\nObjective Function As we defined the loss function, we can now define the objective function for the svm:\n$$\\underset{w}{min}\\ \\lambda\\parallel w\\parallel^2 + \\ \\sum_{i=1}^n\\big(1-y_i \\langle x_i,w \\rangle\\big)_+$$\nAs you can see, our objective of a svm consists of two terms. The first term is a regularizer, the second term the loss. The regularizer balances between margin maximization and loss. To get more informations I advice you the tutorial introduction of the above adviced SchÃ¶lkopf \u0026amp; Smola book.\nDerive the Objective Function To minimize this function, we need the gradients of this function.\nAs we have two terms, we will derive them seperately using the sum rule in differentiation.\n$$ \\frac{\\delta}{\\delta w_k} \\lambda\\parallel w\\parallel^2 \\ = 2 \\lambda w_k $$\n$$ \\frac{\\delta}{\\delta w_k} \\big(1-y_i \\langle x_i,w \\rangle\\big)+ \\ = \\begin{cases} 0,\u0026amp; \\text{if } y_i \\langle x_i,w \\rangle\\geq 1\\\n-y_ix{ik}, \u0026amp; \\text{else} \\end{cases} $$\nThis means, if we have a misclassified sample $x_i$, respectively $y_i \\langle x_i,w \\rangle \\ \u0026lt; \\ 1$, we update the weight vector w using the gradients of both terms, if $y_i \\langle x_i,w \\rangle \\geq 1$ we just update w by the gradient of the regularizer. To sum it up, our stochastic gradient descent for the svm looks like this:\nif $y_iâŸ¨x_i,wâŸ© \u0026lt; 1$: $$ w = w + \\eta (y_ix_i - 2\\lambda w) $$ else: $$ w = w + \\eta (-2\\lambda w) $$\nOur Data Set First we need to define a labeled data set. If you read the perceptron tutorial you will already know it.\nX = np.array([ [-2, 4], [4, 1], [1, 6], [2, 4], [6, 2] ]) y = np.array([-1,-1,1,1,1]) For simplicity\u0026rsquo;s sake we again fold the bias term into the data set:\nX = np.array([ [-2,4,-1], [4,1,-1], [1, 6, -1], [2, 4, -1], [6, 2, -1], ]) y = np.array([-1,-1,1,1,1]) This small toy data set contains two samples labeled with $-1$ and three samples labeled with $+1$. This means we have a binary classification problem, as the data set contains two sample classes. Lets plot the dataset to see, that is is linearly seperable:\nfor d, sample in enumerate(X): # Plot the negative samples if d \u0026lt; 2: plt.scatter(sample[0], sample[1], s=120, marker=\u0026#39;_\u0026#39;, linewidths=2) # Plot the positive samples else: plt.scatter(sample[0], sample[1], s=120, marker=\u0026#39;+\u0026#39;, linewidths=2) # Print a possible hyperplane, that is seperating the two classes. plt.plot([-2,6],[6,0.5]) [\u0026lt;matplotlib.lines.Line2D at 0x7f4b846e42e8\u0026gt;]  Lets Start implementing Stochastic Gradient Descent Finally we can code our SGD algorithm using our update rules. In opposite to the perceptrons objective function, we use a regularizer in our algorithm. As we have a small data set, which is easily lineary seperable, this is actually not needed and our stochastic gradient descent algorithm would probably converge faster without it. To give you a more powerfull code at hand, I will keep it in the following algorithm.\nTo keep it simple, we will linearly loop over the sample set. For larger data sets it makes sence, to randomly pick a sample during each iteration in the for-loop.\ndef svm_sgd(X, Y): w = np.zeros(len(X[0])) eta = 1 epochs = 100000 for epoch in range(1,n): for i, x in enumerate(X): if (Y[i]*np.dot(X[i], w)) \u0026lt; 1: w = w + eta * ( (X[i] * Y[i]) + (-2 *(1/epoch)* w) ) else: w = w + eta * (-2 *(1/epoch)* w) return w We will run the sgd $100000$ times. Our learning parameter eta is set to $1$. As a regulizing parameter we choose $1/t$, so this parameter will decrease, as the number of epochs increases.\nCode Description Line by Line line 2: Initialize the weight vector for the perceptron with zerosline 3: Set the learning rate to 1line 4: Set the number of epochsline 6: Iterate n times over the whole data set. The Iterator is begins with $1$ to avoid division by zero during regularization parameter calculationline 7: Iterate over each sample in the data set. line 8: Misclassification condition $y_i \\langle x_i,w \\rangle \u0026lt; 1$line 9: Update rule for the weights $w = w + \\eta (y_ix_i - 2\\lambda w)$ including the learning rate $\\eta$ and the regularizer $\\lambda$line 11: If classified correctly just update the weight vector by the derived regularizer term $w = w + \\eta (-2\\lambda w)$.Let the SVM learn! Next we can execute our code, to calculate the proper weight vector, which fits out training data. If there are misclassified samples we will print the number of misclassified and correctly classified samples.\ndef svm_sgd_plot(X, Y): w = np.zeros(len(X[0])) eta = 1 epochs = 100000 errors = [] for epoch in range(1,epochs): error = 0 for i, x in enumerate(X): if (Y[i]*np.dot(X[i], w)) \u0026lt; 1: w = w + eta * ( (X[i] * Y[i]) + (-2 *(1/epoch)* w) ) error = 1 else: w = w + eta * (-2 *(1/epoch)* w) errors.append(error) print(w) plt.plot(errors, \u0026#39;|\u0026#39;) plt.ylim(0.5,1.5) plt.axes().set_yticklabels([]) plt.xlabel(\u0026#39;Epoch\u0026#39;) plt.ylabel(\u0026#39;Misclassified\u0026#39;) plt.show() svm_sgd_plot(X,y) [ 1.58876117 3.17458055 11.11863105] /usr/lib/python3.7/site-packages/matplotlib/figure.py:98: MatplotlibDeprecationWarning: Adding an axes using the same arguments as a previous axes currently reuses the earlier instance. In a future version, a new instance will always be created and returned. Meanwhile, this warning can be suppressed, and the future behavior ensured, by passing a unique label to each axes instance. \u0026quot;Adding an axes using the same arguments as a previous axes \u0026quot;  Homework Complete your own Support Vector Machine!\n","permalink":"http://yangchnet.github.io/Dessert/posts/dlml/svm-primal/","summary":"Simple Support Vector Machine First we will import numpy to easily manage linear algebra and calculus operations in python. To plot the learning progress later on, we will use matplotlib.\nimport numpy as np from matplotlib import pyplot as plt %matplotlib inline Stochastic Gradient Descent The svm will learn using the stochastic gradient descent algorithm (SGD). Gradient Descent minimizes a function by following the gradients of the cost function.\nCalculating the Error To calculate the error of a prediction we first need to define the objective function of the svm.","title":"SimpleSupportVectorMachine"},{"content":"import tensorflow as tf import numpy as np from IPython.display import Image tf.ones_like() åˆ›å»ºä¸€ä¸ªæ‰€æœ‰å…ƒç´ è®¾ç½®ä¸º1çš„tensor\ntf.subtract() ä¸¤ä¸ªçŸ©é˜µç›¸å‡\n decision_p_comp = tf.subtract(tf.ones_like(decision_p), decision_p)\n  è¿™ä¸€å¥è®¡ç®—å‡º1-d\n tf.stack çŸ©é˜µæ‹¼æ¥ï¼Œä¾‹å¦‚\na = tf.constant([1,2,3]) b = tf.constant([4,5,6]) c = tf.stack([a, b], axis = 0) d = tf.stack([a, b], axis = 1) sess = tf.Session() print(sess.run(c)) print(sess.run(d)) [[1 2 3] [4 5 6]] [[1 4] [2 5] [3 6]]  tf.expand_dims åœ¨axisä½ç½®å¢åŠ ä¸€ä¸ªç»´åº¦\ntf.tile åœ¨åŒä¸€ç»´åº¦ä¸Šè¿›è¡Œå¤åˆ¶\nwith tf.Graph().as_default(): a = tf.constant([1,2],name=\u0026#39;a\u0026#39;) b = tf.tile(a,[3]) sess = tf.Session() print(sess.run(b)) [1 2 1 2 1 2]  axis 0 ä»£è¡¨è¡Œ 1 ä»£è¡¨åˆ—\ntf.reduce_mean è®¡ç®—å¼ é‡çš„å„ä¸ªç»´åº¦ä¸Šçš„å…ƒç´ çš„å¹³å‡å€¼ã€‚\nx = tf.constant([[1., 1.], [2., 2.]]) tf.reduce_mean(x) # 1.5 tf.reduce_mean(x, 0) # [1.5, 1.5] tf.reduce_mean(x, 1) # [1., 2.] \u0026lt;tf.Tensor 'Mean_2:0' shape=(2,) dtype=float32\u0026gt;  tf.nn.dropout dropoutçš„ä½œç”¨æ˜¯ä¸ºäº†é˜²æ­¢æˆ–å‡è½»è¿‡æ‹Ÿåˆï¼Œå®ƒä¸€èˆ¬ç”¨åœ¨å…¨è¿æ¥å±‚ é€šè¿‡åœ¨ä¸åŒçš„è®­ç»ƒè¿‡ç¨‹ä¸­éšæœºæ‰”æ‰ä¸€éƒ¨åˆ†ç¥ç»å…ƒï¼Œä¹Ÿå°±æ˜¯è®©æŸä¸ªç¥ç»å…ƒçš„æ¿€æ´»å€¼ä»¥ä¸€å®šçš„æ¦‚ç‡p, è®©å…¶åœæ­¢å·¥ä½œï¼Œè¿™æ¬¡è®­ç»ƒè¿‡ç¨‹ä¸­ä¸æ›´æ–°æƒå€¼ï¼Œä¹Ÿä¸å‚åŠ ç¥ç»ç½‘ç»œçš„è®¡ç®—ï¼Œä½†æ˜¯ä»–çš„æƒé‡å¾—ä¿å­˜ä¸‹æ¥ï¼Œå¾…ä¸‹æ¬¡æ ·æœ¬è¾“å…¥æ—¶å¯èƒ½ä¼šé‡æ–°å·¥ä½œã€‚ å…¶å‡½æ•°åŸå‹ï¼š tf.nn.dropout(x, keep_prob, noise_shape=None, seed=None,name=None) ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè¾“å…¥ï¼Œç¬¬äºŒä¸ªå‚æ•°è®¾ç½®ç¥ç»å…ƒè¢«é€‰ä¸­çš„æ¦‚ç‡ï¼Œ\ntf.gather æ ¹æ®ç´¢å¼•ï¼Œä»è¾“å…¥å¼ é‡ä¸­ä¾æ¬¡å–å…ƒç´ ï¼Œæ„æˆä¸€ä¸ªæ–°çš„å¼ é‡\n","permalink":"http://yangchnet.github.io/Dessert/posts/dlml/tensorflowapi/","summary":"import tensorflow as tf import numpy as np from IPython.display import Image tf.ones_like() åˆ›å»ºä¸€ä¸ªæ‰€æœ‰å…ƒç´ è®¾ç½®ä¸º1çš„tensor\ntf.subtract() ä¸¤ä¸ªçŸ©é˜µç›¸å‡\n decision_p_comp = tf.subtract(tf.ones_like(decision_p), decision_p)\n  è¿™ä¸€å¥è®¡ç®—å‡º1-d\n tf.stack çŸ©é˜µæ‹¼æ¥ï¼Œä¾‹å¦‚\na = tf.constant([1,2,3]) b = tf.constant([4,5,6]) c = tf.stack([a, b], axis = 0) d = tf.stack([a, b], axis = 1) sess = tf.Session() print(sess.run(c)) print(sess.run(d)) [[1 2 3] [4 5 6]] [[1 4] [2 5] [3 6]]  tf.expand_dims åœ¨axisä½ç½®å¢åŠ ä¸€ä¸ªç»´åº¦\ntf.tile åœ¨åŒä¸€ç»´åº¦ä¸Šè¿›è¡Œå¤åˆ¶\nwith tf.","title":"tf.ones_like()"},{"content":"ubuntuä¸­å¢åŠ ç”¨æˆ· sudo useradd -m [username] -s /bin/bash #åˆ›å»ºè´¦æˆ·ï¼Œä½¿ç”¨/bin/bashä½œä¸ºshell sudo passwd [username] #è®¾ç½®å¯†ç  sudo adduser [username] sudo #æ·»åŠ ç®¡ç†å‘˜æƒé™ su [username]#åˆ‡æ¢ç”¨æˆ· ","permalink":"http://yangchnet.github.io/Dessert/posts/linux/ubuntu%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7/","summary":"ubuntuä¸­å¢åŠ ç”¨æˆ· sudo useradd -m [username] -s /bin/bash #åˆ›å»ºè´¦æˆ·ï¼Œä½¿ç”¨/bin/bashä½œä¸ºshell sudo passwd [username] #è®¾ç½®å¯†ç  sudo adduser [username] sudo #æ·»åŠ ç®¡ç†å‘˜æƒé™ su [username]#åˆ‡æ¢ç”¨æˆ· ","title":"ubuntuä¸­å¢åŠ ç”¨æˆ·"},{"content":"Ubuntuå®Œå…¨åˆ é™¤nginx 1. å¸è½½nginxåŠç›¸å…³è½¯ä»¶  å¸è½½nginx  sudo apt-get --purge remove nginx  ç§»é™¤å…¨éƒ¨æ— ç”¨åŒ…  sudo apt-get autoremove  åˆ—å‡ºä¸nginxç›¸å…³çš„è½¯ä»¶  dpkg --get-selections | grep nginx  åˆ é™¤ä¹‹  sudo apt-get --purge remove nginx-common sudo apt-get --purge remove nginx-core 2. åœæ­¢æ‰€æœ‰ä¸nginxæœ‰å…³çš„è¿›ç¨‹  æŸ¥çœ‹ç›¸å…³è¿›ç¨‹  ps -ef | grep nginx  åœæ­¢è¿™äº›è¿›ç¨‹  sudo kill -9 {process_id}  00:00:00 grep \u0026ndash;color=auto nginx è¿™ä¸ªä¸æ˜¯\n 3. æŸ¥æ‰¾ä¸»æœºä¸­ä¸nginxç›¸å…³çš„æ–‡ä»¶ ä½¿ç”¨å‘½ä»¤ï¼š\nsudo find / -name nginx* åˆ é™¤ä¹‹\nsudo rm -rf {dir} 4. ç°åœ¨å¯ä»¥é‡æ–°å®‰è£…nginx sudo apt-get update sudo apt-get install nginx ","permalink":"http://yangchnet.github.io/Dessert/posts/linux/%E5%AE%8C%E5%85%A8%E5%88%A0%E9%99%A4nginx/","summary":"Ubuntuå®Œå…¨åˆ é™¤nginx 1. å¸è½½nginxåŠç›¸å…³è½¯ä»¶  å¸è½½nginx  sudo apt-get --purge remove nginx  ç§»é™¤å…¨éƒ¨æ— ç”¨åŒ…  sudo apt-get autoremove  åˆ—å‡ºä¸nginxç›¸å…³çš„è½¯ä»¶  dpkg --get-selections | grep nginx  åˆ é™¤ä¹‹  sudo apt-get --purge remove nginx-common sudo apt-get --purge remove nginx-core 2. åœæ­¢æ‰€æœ‰ä¸nginxæœ‰å…³çš„è¿›ç¨‹  æŸ¥çœ‹ç›¸å…³è¿›ç¨‹  ps -ef | grep nginx  åœæ­¢è¿™äº›è¿›ç¨‹  sudo kill -9 {process_id}  00:00:00 grep \u0026ndash;color=auto nginx è¿™ä¸ªä¸æ˜¯\n 3. æŸ¥æ‰¾ä¸»æœºä¸­ä¸nginxç›¸å…³çš„æ–‡ä»¶ ä½¿ç”¨å‘½ä»¤ï¼š\nsudo find / -name nginx* åˆ é™¤ä¹‹","title":"Ubuntuå®Œå…¨åˆ é™¤nginx"},{"content":"Vueä¸­çš„æŒ‡ä»¤ä»‹ç» æŒ‡ä»¤  è§£é‡Šï¼šæŒ‡ä»¤ (Directives) æ˜¯å¸¦æœ‰ v- å‰ç¼€çš„ç‰¹æ®Šå±æ€§ ä½œç”¨ï¼šå½“è¡¨è¾¾å¼çš„å€¼æ”¹å˜æ—¶ï¼Œå°†å…¶äº§ç”Ÿçš„è¿å¸¦å½±å“ï¼Œå“åº”å¼åœ°ä½œç”¨äº DOM  v-text è§£é‡Šï¼šæ›´æ–°å…ƒç´ çš„ textContent\n\u0026lt;h1 v-text=\u0026#34;msg\u0026#34;\u0026gt;\u0026lt;/h1\u0026gt; v-html è§£é‡Šï¼šæ›´æ–°å…ƒç´ çš„ innerHTML\n\u0026lt;h1 v-html=\u0026#34;msg\u0026#34;\u0026gt;\u0026lt;/h1\u0026gt; v-bind ä½œç”¨ï¼šå½“è¡¨è¾¾å¼çš„å€¼æ”¹å˜æ—¶ï¼Œå°†å…¶äº§ç”Ÿçš„è¿å¸¦å½±å“ï¼Œå“åº”å¼åœ°ä½œç”¨äº DOM.å“åº”å¼åœ°æ›´æ–° HTML attributeï¼š è¯­æ³•ï¼šv-bind:title=\u0026quot;msg\u0026quot; ç®€å†™ï¼š:title=\u0026quot;msg\u0026quot;\n\u0026lt;!-- å®Œæ•´è¯­æ³• --\u0026gt; \u0026lt;a v-bind:href=\u0026#34;url\u0026#34;\u0026gt;\u0026lt;/a\u0026gt; \u0026lt;!-- ç¼©å†™ --\u0026gt; \u0026lt;a :href=\u0026#34;url\u0026#34;\u0026gt;\u0026lt;/a\u0026gt; \u0026lt;script\u0026gt; // 2 åˆ›å»º Vue çš„å®ä¾‹å¯¹è±¡  var vm = new Vue({ // el ç”¨æ¥æŒ‡å®švueæŒ‚è½½åˆ°é¡µé¢ä¸­çš„å…ƒç´ ï¼Œå€¼æ˜¯ï¼šé€‰æ‹©å™¨  // ç†è§£ï¼šç”¨æ¥æŒ‡å®švueç®¡ç†çš„HTMLåŒºåŸŸ  el: \u0026#39;#app\u0026#39;, // æ•°æ®å¯¹è±¡ï¼Œç”¨æ¥ç»™è§†å›¾ä¸­æä¾›æ•°æ®çš„  data: { url: \u0026#39;http://www.baidu.com\u0026#39; } }) \u0026lt;/script\u0026gt; v-on ä½œç”¨ï¼šç»‘å®šäº‹ä»¶ è¯­æ³•ï¼šv-on:click=\u0026quot;say\u0026quot; or v-on:click=\u0026quot;say('å‚æ•°', $event)\u0026quot; ç®€å†™ï¼š@click=\u0026quot;say\u0026quot; è¯´æ˜ï¼šç»‘å®šçš„äº‹ä»¶ä»methodsä¸­è·å–\n\u0026lt;!-- å®Œæ•´è¯­æ³• --\u0026gt; \u0026lt;a v-on:click=\u0026#34;doSomething\u0026#34;\u0026gt;\u0026lt;/a\u0026gt; \u0026lt;!-- ç¼©å†™ --\u0026gt; \u0026lt;a @click=\u0026#34;doSomething\u0026#34;\u0026gt;\u0026lt;/a\u0026gt; \u0026lt;!-- æ–¹æ³•ä¼ å‚ --\u0026gt; \u0026lt;a @click=\u0026#34;doSomethingï¼ˆâ€œ123â€ï¼‰\u0026#34;\u0026gt;\u0026lt;/a\u0026gt; \u0026lt;script\u0026gt; // 2 åˆ›å»º Vue çš„å®ä¾‹å¯¹è±¡  var vm = new Vue({ el: \u0026#39;#app\u0026#39;, // methodså±æ€§ç”¨æ¥ç»™vueå®ä¾‹æä¾›æ–¹æ³•ï¼ˆäº‹ä»¶ï¼‰  methods: { doSomething: function(str) { //æ¥å—å‚æ•°ï¼Œå¹¶è¾“å‡º  console.log(str); } } }) \u0026lt;/script\u0026gt; äº‹ä»¶ä¿®é¥°ç¬¦  .stop é˜»æ­¢å†’æ³¡ï¼Œè°ƒç”¨ event.stopPropagation() .prevent é˜»æ­¢é»˜è®¤äº‹ä»¶ï¼Œè°ƒç”¨ event.preventDefault() .capture æ·»åŠ äº‹ä»¶ä¾¦å¬å™¨æ—¶ä½¿ç”¨äº‹ä»¶æ•è·æ¨¡å¼ .self åªå½“äº‹ä»¶åœ¨è¯¥å…ƒç´ æœ¬èº«ï¼ˆæ¯”å¦‚ä¸æ˜¯å­å…ƒç´ ï¼‰è§¦å‘æ—¶è§¦å‘å›è°ƒ .once äº‹ä»¶åªè§¦å‘ä¸€æ¬¡  v-model ä½œç”¨ï¼šåœ¨è¡¨å•å…ƒç´ ä¸Šåˆ›å»ºåŒå‘æ•°æ®ç»‘å®š è¯´æ˜ï¼šç›‘å¬ç”¨æˆ·çš„è¾“å…¥äº‹ä»¶ä»¥æ›´æ–°æ•°æ®\n\u0026lt;input v-model=\u0026#34;message\u0026#34; placeholder=\u0026#34;edit me\u0026#34;\u0026gt; \u0026lt;p\u0026gt;Message is: {{ message }}\u0026lt;/p\u0026gt; v-for ä½œç”¨ï¼šåŸºäºæºæ•°æ®å¤šæ¬¡æ¸²æŸ“å…ƒç´ æˆ–æ¨¡æ¿å—\n\u0026lt;!-- 1 åŸºç¡€ç”¨æ³• --\u0026gt; \u0026lt;div v-for=\u0026#34;item in items\u0026#34;\u0026gt; {{ item.text }} \u0026lt;/div\u0026gt; \u0026lt;!-- item ä¸ºå½“å‰é¡¹ï¼Œindex ä¸ºç´¢å¼• --\u0026gt; \u0026lt;p v-for=\u0026#34;(item, index) in list\u0026#34;\u0026gt;{{item}} -- {{index}}\u0026lt;/p\u0026gt; \u0026lt;!-- item ä¸ºå€¼ï¼Œkey ä¸ºé”®ï¼Œindex ä¸ºç´¢å¼• --\u0026gt; \u0026lt;p v-for=\u0026#34;(item, key, index) in obj\u0026#34;\u0026gt;{{item}} -- {{key}}\u0026lt;/p\u0026gt; \u0026lt;p v-for=\u0026#34;item in 10\u0026#34;\u0026gt;{{item}}\u0026lt;/p\u0026gt; keyå±æ€§ æ¨èï¼šä½¿ç”¨ v-for çš„æ—¶å€™æä¾› key å±æ€§ï¼Œä»¥è·å¾—æ€§èƒ½æå‡ã€‚ è¯´æ˜ï¼šä½¿ç”¨ keyï¼ŒVUEä¼šåŸºäº key çš„å˜åŒ–é‡æ–°æ’åˆ—å…ƒç´ é¡ºåºï¼Œå¹¶ä¸”ä¼šç§»é™¤ key ä¸å­˜åœ¨çš„å…ƒç´ ã€‚\n\u0026lt;div v-for=\u0026#34;item in items\u0026#34; :key=\u0026#34;item.id\u0026#34;\u0026gt; \u0026lt;!-- å†…å®¹ --\u0026gt; \u0026lt;/div\u0026gt; æ ·å¼å¤„ç† classå’Œstyle è¯´æ˜ï¼šè¿™ä¸¤ä¸ªéƒ½æ˜¯HTMLå…ƒç´ çš„å±æ€§ï¼Œä½¿ç”¨v-bindï¼Œåªéœ€è¦é€šè¿‡è¡¨è¾¾å¼è®¡ç®—å‡ºå­—ç¬¦ä¸²ç»“æœå³å¯ è¡¨è¾¾å¼çš„ç±»å‹ï¼šå­—ç¬¦ä¸²ã€æ•°ç»„ã€å¯¹è±¡ è¯­æ³•ï¼š\n\u0026lt;!-- 1 --\u0026gt; \u0026lt;div v-bind:class=\u0026#34;{ active: true }\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; ===\u0026gt; \u0026lt;div class=\u0026#34;active\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;!-- 2 --\u0026gt; \u0026lt;div :class=\u0026#34;[\u0026#39;active\u0026#39;, \u0026#39;text-danger\u0026#39;]\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; ===\u0026gt; \u0026lt;div class=\u0026#34;active text-danger\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;!-- 3 --\u0026gt; \u0026lt;div v-bind:class=\u0026#34;[{ active: true }, errorClass]\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; ===\u0026gt; \u0026lt;div class=\u0026#34;active text-danger\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; --- style --- \u0026lt;!-- 1 --\u0026gt; \u0026lt;div v-bind:style=\u0026#34;{ color: activeColor, fontSize: fontSize + \u0026#39;px\u0026#39; }\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;!-- 2 å°†å¤šä¸ª æ ·å¼å¯¹è±¡ åº”ç”¨åˆ°ä¸€ä¸ªå…ƒç´ ä¸Š--\u0026gt; \u0026lt;div v-bind:style=\u0026#34;[baseStyles, overridingStyles]\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; v-if å’Œ v-show*  æ¡ä»¶æ¸²æŸ“ v-ifï¼šæ ¹æ®è¡¨è¾¾å¼çš„å€¼çš„çœŸå‡æ¡ä»¶ï¼Œé”€æ¯æˆ–é‡å»ºå…ƒç´  v-showï¼šæ ¹æ®è¡¨è¾¾å¼ä¹‹çœŸå‡å€¼ï¼Œåˆ‡æ¢å…ƒç´ çš„ display CSS å±æ€§  æå‡ç”¨æˆ·ä½“éªŒï¼šv-cloak è¿™ä¸ªæŒ‡ä»¤ä¿æŒåœ¨å…ƒç´ ä¸Šç›´åˆ°å…³è”å®ä¾‹ç»“æŸç¼–è¯‘ã€‚å’Œ CSS è§„åˆ™å¦‚ [v-cloak] { display: none } ä¸€èµ·ç”¨æ—¶ï¼Œè¿™ä¸ªæŒ‡ä»¤å¯ä»¥éšè—æœªç¼–è¯‘çš„ Mustache æ ‡ç­¾ç›´åˆ°å®ä¾‹å‡†å¤‡å®Œæ¯•ã€‚ é˜²æ­¢åˆ·æ–°é¡µé¢ï¼Œç½‘é€Ÿæ…¢çš„æƒ…å†µä¸‹å‡ºç°{{ message }}ç­‰æ•°æ®æ ¼å¼\n\u0026lt;div v-cloak\u0026gt; {{ message }} \u0026lt;/div\u0026gt; æå‡æ€§èƒ½ï¼šv-pre è¯´æ˜ï¼šè·³è¿‡è¿™ä¸ªå…ƒç´ å’Œå®ƒçš„å­å…ƒç´ çš„ç¼–è¯‘è¿‡ç¨‹ã€‚å¯ä»¥ç”¨æ¥æ˜¾ç¤ºåŸå§‹ Mustache æ ‡ç­¾ã€‚è·³è¿‡å¤§é‡æ²¡æœ‰æŒ‡ä»¤çš„èŠ‚ç‚¹ä¼šåŠ å¿«ç¼–è¯‘ã€‚\n\u0026lt;span vpre\u0026gt;{{ this will not be compiled }}\u0026lt;/span\u0026gt; æå‡æ€§èƒ½ï¼šv-once è¯´æ˜ï¼šåªæ¸²æŸ“å…ƒç´ å’Œç»„ä»¶ä¸€æ¬¡ã€‚éšåçš„é‡æ–°æ¸²æŸ“ï¼Œå…ƒç´ /ç»„ä»¶åŠå…¶æ‰€æœ‰çš„å­èŠ‚ç‚¹å°†è¢«è§†ä¸ºé™æ€å†…å®¹å¹¶è·³è¿‡ã€‚è¿™å¯ä»¥ç”¨äºä¼˜åŒ–æ›´æ–°æ€§èƒ½ã€‚\n\u0026lt;span v-once\u0026gt;This will never change: {{msg}}\u0026lt;/span\u0026gt; ","permalink":"http://yangchnet.github.io/Dessert/posts/%E5%89%8D%E7%AB%AF/vue%E6%8C%87%E4%BB%A4/","summary":"Vueä¸­çš„æŒ‡ä»¤ä»‹ç» æŒ‡ä»¤  è§£é‡Šï¼šæŒ‡ä»¤ (Directives) æ˜¯å¸¦æœ‰ v- å‰ç¼€çš„ç‰¹æ®Šå±æ€§ ä½œç”¨ï¼šå½“è¡¨è¾¾å¼çš„å€¼æ”¹å˜æ—¶ï¼Œå°†å…¶äº§ç”Ÿçš„è¿å¸¦å½±å“ï¼Œå“åº”å¼åœ°ä½œç”¨äº DOM  v-text è§£é‡Šï¼šæ›´æ–°å…ƒç´ çš„ textContent\n\u0026lt;h1 v-text=\u0026#34;msg\u0026#34;\u0026gt;\u0026lt;/h1\u0026gt; v-html è§£é‡Šï¼šæ›´æ–°å…ƒç´ çš„ innerHTML\n\u0026lt;h1 v-html=\u0026#34;msg\u0026#34;\u0026gt;\u0026lt;/h1\u0026gt; v-bind ä½œç”¨ï¼šå½“è¡¨è¾¾å¼çš„å€¼æ”¹å˜æ—¶ï¼Œå°†å…¶äº§ç”Ÿçš„è¿å¸¦å½±å“ï¼Œå“åº”å¼åœ°ä½œç”¨äº DOM.å“åº”å¼åœ°æ›´æ–° HTML attributeï¼š è¯­æ³•ï¼šv-bind:title=\u0026quot;msg\u0026quot; ç®€å†™ï¼š:title=\u0026quot;msg\u0026quot;\n\u0026lt;!-- å®Œæ•´è¯­æ³• --\u0026gt; \u0026lt;a v-bind:href=\u0026#34;url\u0026#34;\u0026gt;\u0026lt;/a\u0026gt; \u0026lt;!-- ç¼©å†™ --\u0026gt; \u0026lt;a :href=\u0026#34;url\u0026#34;\u0026gt;\u0026lt;/a\u0026gt; \u0026lt;script\u0026gt; // 2 åˆ›å»º Vue çš„å®ä¾‹å¯¹è±¡  var vm = new Vue({ // el ç”¨æ¥æŒ‡å®švueæŒ‚è½½åˆ°é¡µé¢ä¸­çš„å…ƒç´ ï¼Œå€¼æ˜¯ï¼šé€‰æ‹©å™¨  // ç†è§£ï¼šç”¨æ¥æŒ‡å®švueç®¡ç†çš„HTMLåŒºåŸŸ  el: \u0026#39;#app\u0026#39;, // æ•°æ®å¯¹è±¡ï¼Œç”¨æ¥ç»™è§†å›¾ä¸­æä¾›æ•°æ®çš„  data: { url: \u0026#39;http://www.baidu.com\u0026#39; } }) \u0026lt;/script\u0026gt; v-on ä½œç”¨ï¼šç»‘å®šäº‹ä»¶ è¯­æ³•ï¼šv-on:click=\u0026quot;say\u0026quot; or v-on:click=\u0026quot;say('å‚æ•°', $event)\u0026quot; ç®€å†™ï¼š@click=\u0026quot;say\u0026quot; è¯´æ˜ï¼šç»‘å®šçš„äº‹ä»¶ä»methodsä¸­è·å–","title":"Vueä¸­çš„æŒ‡ä»¤ä»‹ç»"},{"content":"Windowsè£…ç³»ç»Ÿé‡åˆ°çš„é—®é¢˜ 1. é—®é¢˜æè¿° windowsæ— æ³•å®‰è£…åˆ°è¿™ä¸ªç£ç›˜ï¼Œé€‰ä¸­çš„ç£ç›˜å…·æœ‰MBRåˆ†åŒºè¡¨ã€‚åœ¨EFIç³»ç»Ÿä¸Šï¼ŒWindowsåªèƒ½å®‰è£…åˆ°GPTç£ç›˜\n2. è§£å†³åŠæ³•   é¦–å…ˆé€‰æ‹©Uç›˜å®‰è£…ï¼Œè¿›å…¥å®‰è£…ç•Œé¢\n  æŒ‰shift+F10æ‰“å¼€å‘½ä»¤è¡Œ\n  è¾“å…¥diskpartå¹¶å›è½¦\n  è¾“å…¥list diskæŸ¥çœ‹ç£ç›˜ï¼Œä¸€èˆ¬ä¼šå‡ºç°ä¸¤ä¸ªç£ç›˜ï¼Œä¸€ä¸ªæ˜¯æœºå™¨æœ¬èº«çš„ç£ç›˜ï¼Œç¼–å·ä¸º0ï¼Œå¦ä¸€ä¸ªä¸ºUç›˜ï¼Œç¼–å·ä¸º1\n  è¾“å…¥select disk xï¼ˆxä¸ºè¦é€‰æ‹©çš„ç£ç›˜ç¼–å·ï¼‰ cmdä¼šæç¤ºå½“å‰é€‰æ‹©çš„ç£ç›˜ä¸ºx\n  æ‰§è¡Œcleanå‘½ä»¤æ¸…é™¤è¯¥ç£ç›˜ä¸Šæ‰€æœ‰åˆ†åŒºä¿¡æ¯ï¼Œå¹¶ä¸”ä¼šæ¸…ç©ºæ‰€æœ‰ç¡¬ç›˜æ•°æ®\n  æ‰§è¡Œconvert gptï¼Œå°†è¯¥ç¡¬ç›˜è½¬åŒ–ä¸ºGPTæ ¼å¼\n  å®Œæˆï¼Œç»§ç»­å®‰è£…ç³»ç»Ÿ\n  ","permalink":"http://yangchnet.github.io/Dessert/posts/windows/mbr-gpt/","summary":"Windowsè£…ç³»ç»Ÿé‡åˆ°çš„é—®é¢˜ 1. é—®é¢˜æè¿° windowsæ— æ³•å®‰è£…åˆ°è¿™ä¸ªç£ç›˜ï¼Œé€‰ä¸­çš„ç£ç›˜å…·æœ‰MBRåˆ†åŒºè¡¨ã€‚åœ¨EFIç³»ç»Ÿä¸Šï¼ŒWindowsåªèƒ½å®‰è£…åˆ°GPTç£ç›˜\n2. è§£å†³åŠæ³•   é¦–å…ˆé€‰æ‹©Uç›˜å®‰è£…ï¼Œè¿›å…¥å®‰è£…ç•Œé¢\n  æŒ‰shift+F10æ‰“å¼€å‘½ä»¤è¡Œ\n  è¾“å…¥diskpartå¹¶å›è½¦\n  è¾“å…¥list diskæŸ¥çœ‹ç£ç›˜ï¼Œä¸€èˆ¬ä¼šå‡ºç°ä¸¤ä¸ªç£ç›˜ï¼Œä¸€ä¸ªæ˜¯æœºå™¨æœ¬èº«çš„ç£ç›˜ï¼Œç¼–å·ä¸º0ï¼Œå¦ä¸€ä¸ªä¸ºUç›˜ï¼Œç¼–å·ä¸º1\n  è¾“å…¥select disk xï¼ˆxä¸ºè¦é€‰æ‹©çš„ç£ç›˜ç¼–å·ï¼‰ cmdä¼šæç¤ºå½“å‰é€‰æ‹©çš„ç£ç›˜ä¸ºx\n  æ‰§è¡Œcleanå‘½ä»¤æ¸…é™¤è¯¥ç£ç›˜ä¸Šæ‰€æœ‰åˆ†åŒºä¿¡æ¯ï¼Œå¹¶ä¸”ä¼šæ¸…ç©ºæ‰€æœ‰ç¡¬ç›˜æ•°æ®\n  æ‰§è¡Œconvert gptï¼Œå°†è¯¥ç¡¬ç›˜è½¬åŒ–ä¸ºGPTæ ¼å¼\n  å®Œæˆï¼Œç»§ç»­å®‰è£…ç³»ç»Ÿ\n  ","title":"Windowsè£…ç³»ç»Ÿé‡åˆ°çš„é—®é¢˜"},{"content":"WordPresså®‰è£…è¸©å‘ 1. ç¬¬ä¸€ä¸ªå‘ï¼Œå¿˜äº†å®‰è£…PHPã€‚ã€‚ã€‚ 2. ç¬¬äºŒä¸ªå‘ï¼Œè®¿é—®é¡µé¢not found å‘ç°æ˜¯å› ä¸ºåŒæ—¶å¼€äº†apache2å’Œnginx,å¯¼è‡´å†²çªäº†ï¼ŒæŠŠnginxå…³æ‰å°±å¥½äº†\n3. ç¬¬ä¸‰ä¸ªå‘ï¼Œæ‰“å¼€é¡µé¢å…¨æ˜¯æºä»£ç   æ‰“å¼€/etc/apache2/apache2.confï¼Œå°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ°æ–‡ä»¶çš„åº•éƒ¨ï¼š  \u0026lt;FilesMatch \\ .php $\u0026gt; SetHandler application / x-httpd-php \u0026lt;/ FilesMatch\u0026gt; ä¸ºäº†ä½¿PHPæ­£å¸¸è¿è¡Œï¼Œæ‚¨å¿…é¡»ç¦ç”¨mpm_eventæ¨¡å—å¹¶å¯ç”¨mpm_preforkå’Œphp7æ¨¡å—ã€‚ä¸ºæ­¤ï¼Œè¯·è¿”å›æ‚¨çš„ç»ˆç«¯çª—å£å¹¶å‘å‡ºå‘½ä»¤ï¼š  sudo a2dismod mpm_event \u0026amp;\u0026amp; sudo a2enmod mpm_prefork \u0026amp;\u0026amp; sudo a2enmod php7.0 4. åœ¨æ‰§è¡Œä¸Šé¢çš„å‘½ä»¤æ—¶ï¼Œé‡åˆ°äº†ç¬¬å››ä¸ªå‘ ERROR: Module php7.0 does not exist! è§£å†³åŠæ³•\nsudo apt-get install libapache2-mod-php7.0 5. æ‚¨çš„PHPä¼¼ä¹æ²¡æœ‰å®‰è£…è¿è¡ŒWordPressæ‰€å¿…éœ€çš„MySQLæ‰©å±•ã€‚ sudo apt-get install php-mysql çˆ¬å‡ºæ¥äº†ã€‚ã€‚\n","permalink":"http://yangchnet.github.io/Dessert/posts/linux/wordpress%E5%AE%89%E8%A3%85%E8%B8%A9%E5%9D%91/","summary":"WordPresså®‰è£…è¸©å‘ 1. ç¬¬ä¸€ä¸ªå‘ï¼Œå¿˜äº†å®‰è£…PHPã€‚ã€‚ã€‚ 2. ç¬¬äºŒä¸ªå‘ï¼Œè®¿é—®é¡µé¢not found å‘ç°æ˜¯å› ä¸ºåŒæ—¶å¼€äº†apache2å’Œnginx,å¯¼è‡´å†²çªäº†ï¼ŒæŠŠnginxå…³æ‰å°±å¥½äº†\n3. ç¬¬ä¸‰ä¸ªå‘ï¼Œæ‰“å¼€é¡µé¢å…¨æ˜¯æºä»£ç   æ‰“å¼€/etc/apache2/apache2.confï¼Œå°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ°æ–‡ä»¶çš„åº•éƒ¨ï¼š  \u0026lt;FilesMatch \\ .php $\u0026gt; SetHandler application / x-httpd-php \u0026lt;/ FilesMatch\u0026gt; ä¸ºäº†ä½¿PHPæ­£å¸¸è¿è¡Œï¼Œæ‚¨å¿…é¡»ç¦ç”¨mpm_eventæ¨¡å—å¹¶å¯ç”¨mpm_preforkå’Œphp7æ¨¡å—ã€‚ä¸ºæ­¤ï¼Œè¯·è¿”å›æ‚¨çš„ç»ˆç«¯çª—å£å¹¶å‘å‡ºå‘½ä»¤ï¼š  sudo a2dismod mpm_event \u0026amp;\u0026amp; sudo a2enmod mpm_prefork \u0026amp;\u0026amp; sudo a2enmod php7.0 4. åœ¨æ‰§è¡Œä¸Šé¢çš„å‘½ä»¤æ—¶ï¼Œé‡åˆ°äº†ç¬¬å››ä¸ªå‘ ERROR: Module php7.0 does not exist! è§£å†³åŠæ³•\nsudo apt-get install libapache2-mod-php7.0 5. æ‚¨çš„PHPä¼¼ä¹æ²¡æœ‰å®‰è£…è¿è¡ŒWordPressæ‰€å¿…éœ€çš„MySQLæ‰©å±•ã€‚ sudo apt-get install php-mysql çˆ¬å‡ºæ¥äº†ã€‚ã€‚","title":"WordPresså®‰è£…è¸©å‘"},{"content":"ä½¿ç”¨sklearnçš„è´å¶æ–¯åˆ†ç±»å™¨è¿›è¡Œæ–‡æœ¬åˆ†ç±» 1ã€sklearnç®€ä»‹ sklearnæ˜¯ä¸€ä¸ªPythonç¬¬ä¸‰æ–¹æä¾›çš„éå¸¸å¼ºåŠ›çš„æœºå™¨å­¦ä¹ åº“ï¼Œå®ƒåŒ…å«äº†ä»æ•°æ®é¢„å¤„ç†åˆ°è®­ç»ƒæ¨¡å‹çš„å„ä¸ªæ–¹é¢ã€‚åœ¨å®æˆ˜ä½¿ç”¨scikit-learnä¸­å¯ä»¥æå¤§çš„èŠ‚çœæˆ‘ä»¬ç¼–å†™ä»£ç çš„æ—¶é—´ä»¥åŠå‡å°‘æˆ‘ä»¬çš„ä»£ç é‡ï¼Œä½¿æˆ‘ä»¬æœ‰æ›´å¤šçš„ç²¾åŠ›å»åˆ†ææ•°æ®åˆ†å¸ƒï¼Œè°ƒæ•´æ¨¡å‹å’Œä¿®æ”¹è¶…å‚ã€‚\n2ã€æœ´ç´ è´å¶æ–¯åœ¨æ–‡æœ¬åˆ†ç±»ä¸­çš„å¸¸ç”¨æ¨¡å‹ï¼šå¤šé¡¹å¼ã€ä¼¯åŠªåˆ© æœ´ç´ è´å¶æ–¯åˆ†ç±»å™¨æ˜¯ä¸€ç§æœ‰ç›‘ç£å­¦ä¹ ï¼Œå¸¸è§æœ‰ä¸¤ç§æ¨¡å‹ï¼Œå¤šé¡¹å¼æ¨¡å‹(multinomial model)å³ä¸ºè¯é¢‘å‹å’Œä¼¯åŠªåˆ©æ¨¡(Bernoulli model)å³æ–‡æ¡£å‹ã€‚äºŒè€…çš„è®¡ç®—ç²’åº¦ä¸ä¸€æ ·ï¼Œå¤šé¡¹å¼æ¨¡å‹ä»¥å•è¯ä¸ºç²’åº¦ï¼Œä¼¯åŠªåˆ©æ¨¡å‹ä»¥æ–‡ä»¶ä¸ºç²’åº¦ï¼Œå› æ­¤äºŒè€…çš„å…ˆéªŒæ¦‚ç‡å’Œç±»æ¡ä»¶æ¦‚ç‡çš„è®¡ç®—æ–¹æ³•éƒ½ä¸åŒã€‚è®¡ç®—åéªŒæ¦‚ç‡æ—¶ï¼Œå¯¹äºä¸€ä¸ªæ–‡æ¡£dï¼Œå¤šé¡¹å¼æ¨¡å‹ä¸­ï¼Œåªæœ‰åœ¨dä¸­å‡ºç°è¿‡çš„å•è¯ï¼Œæ‰ä¼šå‚ä¸åéªŒæ¦‚ç‡è®¡ç®—ï¼Œä¼¯åŠªåˆ©æ¨¡å‹ä¸­ï¼Œæ²¡æœ‰åœ¨dä¸­å‡ºç°ï¼Œä½†æ˜¯åœ¨å…¨å±€å•è¯è¡¨ä¸­å‡ºç°çš„å•è¯ï¼Œä¹Ÿä¼šå‚ä¸è®¡ç®—ï¼Œä¸è¿‡æ˜¯ä½œä¸ºâ€œåæ–¹â€å‚ä¸çš„ã€‚è¿™é‡Œæš‚ä¸è™‘ç‰¹å¾æŠ½å–ã€ä¸ºé¿å…æ¶ˆé™¤æµ‹è¯•æ–‡æ¡£æ—¶ç±»æ¡ä»¶æ¦‚ç‡ä¸­æœ‰ä¸º0ç°è±¡è€Œåšçš„å–å¯¹æ•°ç­‰é—®é¢˜ã€‚\n2.1ã€å¤šé¡¹å¼æ¨¡å‹ 2.2ã€ä¼¯åŠªåˆ©æ¨¡å‹ 2.3ã€ä¸¤ä¸ªæ¨¡å‹çš„åŒºåˆ« 3ã€å®æˆ˜æ¼”ç»ƒ ä½¿ç”¨åœ¨åº·å¥ˆå°”å¤§å­¦ä¸‹è½½çš„2Må½±è¯„ä½œä¸ºè®­ç»ƒæ•°æ®å’Œæµ‹è¯•æ•°æ®ï¼Œé‡Œé¢å…±åŒã€å…±æœ‰1400æ¡ï¼Œå¥½è¯„å’Œå·®è¯„å„è‡ª700æ¡ï¼Œæˆ‘é€‰æ‹©æ€»æ•°çš„70%ä½œä¸ºè®­ç»ƒæ•°æ®ï¼Œ30%ä½œä¸ºæµ‹è¯•æ•°æ®ï¼Œæ¥æ£€æµ‹sklearnè‡ªå¸¦çš„è´å¶æ–¯åˆ†ç±»å™¨çš„åˆ†ç±»æ•ˆæœã€‚\n  è¯»å–å…¨éƒ¨æ•°æ®ï¼Œå¹¶éšæœºæ‰“ä¹±\n import os import random def get_dataset(): data = [] for root, dirs, files in os.walk(\u0026#39;../dataset/aclImdb/neg\u0026#39;): for file in files: realpath = os.path.join(root, file) with open(realpath, errors=\u0026#39;ignore\u0026#39;) as f: data.append((f.read(), 0)) for root, dirs, files in os.walk(r\u0026#39;../dataset/aclImdb/pos\u0026#39;): for file in files: realpath = os.path.join(root, file) with open(realpath, errors=\u0026#39;ignore\u0026#39;) as f: data.append((f.read(), 1)) random.shuffle(data) return data data = get_dataset() data[:2] [(\u0026quot;Being a fan of Andy Goldsworthy's art for a while now, and owning some of his books, I had some expectations of what I would see. What I got was something completely satisfying, and quite a bit more than I expected. Being an artist myself (I work in clay), finding inspiration within our surroundings to make good art is imperative, and it is something Andy Goldsworthy has mastered. Following him over the course of a year, the director captures the spontaneous energy, skill, and devotion to the artists connection with nature with dratic inspiring flair. The music set to the film is embracing and intoxicating. If you are an artist in need of inspiration, or anyone else in need of an uplifting experience, then SEE THIS MOVIE. I for one am glad to know that Andy is somewhere out there. Creating, dancing, wrestling with the forces of nature to make our world more beautiful.\u0026quot;, 1), (\u0026quot;A film I expected very little from, and only watched to pass a quiet hour - but what an hour it turned out to be. Roll is an excellent if none-too-serious little story of 'country-boy-lost-in-the-big-city-makes-good', it is funny throughout, the characters are endearing and the pace is just right.\u0026lt;br /\u0026gt;\u0026lt;br /\u0026gt;Toby Malone is the true star of the film with his endearing portrayal of Matt, said country boy and local Aussie Rules football hero come to the big city to try out for one of the big teams. He is supported superbly by John Batchelor as local gangster Tiny. Watch out for these two.\u0026lt;br /\u0026gt;\u0026lt;br /\u0026gt;Highly recommended.\u0026quot;, 1)]    æŒ‰ç…§7:3çš„æ¯”ä¾‹åˆ’åˆ†è®­ç»ƒé›†å’Œæµ‹è¯•é›†\n def train_and_test_data(data_): filesize = int(0.7 * len(data_)) # è®­ç»ƒé›†å’Œæµ‹è¯•é›†çš„æ¯”ä¾‹ä¸º7:3 train_data_ = [each[0] for each in data_[:filesize]] train_target_ = [each[1] for each in data_[:filesize]] test_data_ = [each[0] for each in data_[filesize:]] test_target_ = [each[1] for each in data_[filesize:]] return train_data_, train_target_, test_data_, test_target_ train_data, train_target, test_data, test_target = train_and_test_data(data)   ä½¿ç”¨å¤šé¡¹å¼è´å¶æ–¯åˆ†ç±»å™¨\n from sklearn.naive_bayes import MultinomialNB from sklearn.pipeline import Pipeline from sklearn.feature_extraction.text import TfidfVectorizer, HashingVectorizer, CountVectorizer from sklearn import metrics from sklearn.naive_bayes import BernoulliNB nbc = Pipeline([ (\u0026#39;vect\u0026#39;, TfidfVectorizer()), (\u0026#39;clf\u0026#39;, MultinomialNB(alpha=1.0)), ]) nbc.fit(train_data, train_target) #è®­ç»ƒæˆ‘ä»¬çš„å¤šé¡¹å¼æ¨¡å‹è´å¶æ–¯åˆ†ç±»å™¨ predict = nbc.predict(test_data) #åœ¨æµ‹è¯•é›†ä¸Šé¢„æµ‹ç»“æœ y_score = nbc.fit(train_data, train_target).predict_proba(test_data) print(y_score) count = 0 #ç»Ÿè®¡é¢„æµ‹æ­£ç¡®çš„ç»“æœä¸ªæ•° for left , right in zip(predict, test_target): if left == right: count += 1 print(count/len(test_target)) [[0.21379806 0.78620194] [0.61108605 0.38891395] [0.25629837 0.74370163] ... [0.33889503 0.66110497] [0.73665026 0.26334974] [0.1870178 0.8129822 ]] 0.8596    ä½¿ç”¨ä¼¯åŠªåˆ©æ¨¡å‹åˆ†ç±»å™¨\n nbc_1= Pipeline([ (\u0026#39;vect\u0026#39;, TfidfVectorizer()), (\u0026#39;clf\u0026#39;, BernoulliNB(alpha=0.1)), ]) nbc_1.fit(train_data, train_target) predict = nbc_1.predict(test_data) #åœ¨æµ‹è¯•é›†ä¸Šé¢„æµ‹ç»“æœ count = 0 #ç»Ÿè®¡é¢„æµ‹æ­£ç¡®çš„ç»“æœä¸ªæ•° for left , right in zip(predict, test_target): if left == right: count += 1 print(count/len(test_target)) 0.8818635607321131   ä»åˆ†ç±»ç»“æœå¯ä»¥çœ‹å‡ºï¼Œå’Œå¤šé¡¹å¼æ¨¡å‹ç›¸æ¯”ï¼Œä½¿ç”¨ä¼¯åŠªåˆ©æ¨¡å‹çš„è´å¶æ–¯åˆ†ç±»å™¨ï¼Œåœ¨æ–‡æœ¬åˆ†ç±»æ–¹é¢çš„ç²¾åº¦ç›¸æ¯”ï¼Œå·®åˆ«ä¸å¤§ï¼Œæˆ‘ä»¬å¯ä»¥é’ˆå¯¹æˆ‘ä»¬é¢å¯¹çš„å…·ä½“é—®é¢˜ï¼Œè¿›è¡Œå®éªŒï¼Œé€‰æ‹©æœ€ä¸ºåˆé€‚çš„åˆ†ç±»å™¨ã€‚\nä½œä¸š sklearnä¸­ä¸€å…±æä¾›äº†å››ç§è´å¶æ–¯åˆ†ç±»å™¨ï¼š\n é«˜æ–¯æœ´ç´ è´å¶æ–¯ å¤šé¡¹å¼æœ´ç´ è´å¶æ–¯ è¡¥å……æœ´ç´ è´å¶æ–¯ ä¼¯åŠªåˆ©æœ´ç´ è´å¶æ–¯  ä»å››ç§è´å¶æ–¯åˆ†ç±»å™¨æ¨¡å‹ä¸­æ‰¾å‡ºå…·æœ‰æœ€ä½³åˆ†ç±»æ•ˆæœçš„åˆ†ç±»å™¨ï¼Œå¹¶ç”¨ç›´æ–¹å›¾ç›´è§‚è¡¨ç¤ºå…¶åˆ†ç±»å‡†ç¡®ç‡ã€‚\nå‚è€ƒèµ„æ–™ sklearnå®˜æ–¹ç½‘ç«™\nhttps://scikit-learn.org/stable/index.html\nsklearn:æœ´ç´ è´å¶æ–¯ https://scikit-learn.org/stable/modules/naive_bayes.html#naive-bayes\n","permalink":"http://yangchnet.github.io/Dessert/posts/dlml/sklearn_%E8%B4%9D%E5%8F%B6%E6%96%AF/","summary":"ä½¿ç”¨sklearnçš„è´å¶æ–¯åˆ†ç±»å™¨è¿›è¡Œæ–‡æœ¬åˆ†ç±» 1ã€sklearnç®€ä»‹ sklearnæ˜¯ä¸€ä¸ªPythonç¬¬ä¸‰æ–¹æä¾›çš„éå¸¸å¼ºåŠ›çš„æœºå™¨å­¦ä¹ åº“ï¼Œå®ƒåŒ…å«äº†ä»æ•°æ®é¢„å¤„ç†åˆ°è®­ç»ƒæ¨¡å‹çš„å„ä¸ªæ–¹é¢ã€‚åœ¨å®æˆ˜ä½¿ç”¨scikit-learnä¸­å¯ä»¥æå¤§çš„èŠ‚çœæˆ‘ä»¬ç¼–å†™ä»£ç çš„æ—¶é—´ä»¥åŠå‡å°‘æˆ‘ä»¬çš„ä»£ç é‡ï¼Œä½¿æˆ‘ä»¬æœ‰æ›´å¤šçš„ç²¾åŠ›å»åˆ†ææ•°æ®åˆ†å¸ƒï¼Œè°ƒæ•´æ¨¡å‹å’Œä¿®æ”¹è¶…å‚ã€‚\n2ã€æœ´ç´ è´å¶æ–¯åœ¨æ–‡æœ¬åˆ†ç±»ä¸­çš„å¸¸ç”¨æ¨¡å‹ï¼šå¤šé¡¹å¼ã€ä¼¯åŠªåˆ© æœ´ç´ è´å¶æ–¯åˆ†ç±»å™¨æ˜¯ä¸€ç§æœ‰ç›‘ç£å­¦ä¹ ï¼Œå¸¸è§æœ‰ä¸¤ç§æ¨¡å‹ï¼Œå¤šé¡¹å¼æ¨¡å‹(multinomial model)å³ä¸ºè¯é¢‘å‹å’Œä¼¯åŠªåˆ©æ¨¡(Bernoulli model)å³æ–‡æ¡£å‹ã€‚äºŒè€…çš„è®¡ç®—ç²’åº¦ä¸ä¸€æ ·ï¼Œå¤šé¡¹å¼æ¨¡å‹ä»¥å•è¯ä¸ºç²’åº¦ï¼Œä¼¯åŠªåˆ©æ¨¡å‹ä»¥æ–‡ä»¶ä¸ºç²’åº¦ï¼Œå› æ­¤äºŒè€…çš„å…ˆéªŒæ¦‚ç‡å’Œç±»æ¡ä»¶æ¦‚ç‡çš„è®¡ç®—æ–¹æ³•éƒ½ä¸åŒã€‚è®¡ç®—åéªŒæ¦‚ç‡æ—¶ï¼Œå¯¹äºä¸€ä¸ªæ–‡æ¡£dï¼Œå¤šé¡¹å¼æ¨¡å‹ä¸­ï¼Œåªæœ‰åœ¨dä¸­å‡ºç°è¿‡çš„å•è¯ï¼Œæ‰ä¼šå‚ä¸åéªŒæ¦‚ç‡è®¡ç®—ï¼Œä¼¯åŠªåˆ©æ¨¡å‹ä¸­ï¼Œæ²¡æœ‰åœ¨dä¸­å‡ºç°ï¼Œä½†æ˜¯åœ¨å…¨å±€å•è¯è¡¨ä¸­å‡ºç°çš„å•è¯ï¼Œä¹Ÿä¼šå‚ä¸è®¡ç®—ï¼Œä¸è¿‡æ˜¯ä½œä¸ºâ€œåæ–¹â€å‚ä¸çš„ã€‚è¿™é‡Œæš‚ä¸è™‘ç‰¹å¾æŠ½å–ã€ä¸ºé¿å…æ¶ˆé™¤æµ‹è¯•æ–‡æ¡£æ—¶ç±»æ¡ä»¶æ¦‚ç‡ä¸­æœ‰ä¸º0ç°è±¡è€Œåšçš„å–å¯¹æ•°ç­‰é—®é¢˜ã€‚\n2.1ã€å¤šé¡¹å¼æ¨¡å‹ 2.2ã€ä¼¯åŠªåˆ©æ¨¡å‹ 2.3ã€ä¸¤ä¸ªæ¨¡å‹çš„åŒºåˆ« 3ã€å®æˆ˜æ¼”ç»ƒ ä½¿ç”¨åœ¨åº·å¥ˆå°”å¤§å­¦ä¸‹è½½çš„2Må½±è¯„ä½œä¸ºè®­ç»ƒæ•°æ®å’Œæµ‹è¯•æ•°æ®ï¼Œé‡Œé¢å…±åŒã€å…±æœ‰1400æ¡ï¼Œå¥½è¯„å’Œå·®è¯„å„è‡ª700æ¡ï¼Œæˆ‘é€‰æ‹©æ€»æ•°çš„70%ä½œä¸ºè®­ç»ƒæ•°æ®ï¼Œ30%ä½œä¸ºæµ‹è¯•æ•°æ®ï¼Œæ¥æ£€æµ‹sklearnè‡ªå¸¦çš„è´å¶æ–¯åˆ†ç±»å™¨çš„åˆ†ç±»æ•ˆæœã€‚\n  è¯»å–å…¨éƒ¨æ•°æ®ï¼Œå¹¶éšæœºæ‰“ä¹±\n import os import random def get_dataset(): data = [] for root, dirs, files in os.walk(\u0026#39;../dataset/aclImdb/neg\u0026#39;): for file in files: realpath = os.path.join(root, file) with open(realpath, errors=\u0026#39;ignore\u0026#39;) as f: data.append((f.read(), 0)) for root, dirs, files in os.walk(r\u0026#39;../dataset/aclImdb/pos\u0026#39;): for file in files: realpath = os.path.join(root, file) with open(realpath, errors=\u0026#39;ignore\u0026#39;) as f: data.append((f.read(), 1)) random.shuffle(data) return data data = get_dataset() data[:2] [(\u0026quot;Being a fan of Andy Goldsworthy's art for a while now, and owning some of his books, I had some expectations of what I would see.","title":"ä½¿ç”¨sklearnçš„è´å¶æ–¯åˆ†ç±»å™¨è¿›è¡Œæ–‡æœ¬åˆ†ç±»"},{"content":"åˆ†ç±»æŒ‡æ ‡ä½œä¸šï¼ˆç¬¬äºŒé¢˜ï¼‰ é¢˜ç›® ç»™å®šå®Œæ•´æ•°æ®é›†ï¼Œåˆ†åˆ«è®¡ç®—åœ¨ä½¿ç”¨å®Œæ•´æ•°æ®é›†çš„10%,30%,50%,80%,100%æ•°æ®æ—¶çš„æŸ¥å‡†ç‡ã€æŸ¥å…¨ç‡ï¼Œf1åº¦é‡å’ŒROCï¼Œä½¿ç”¨æŠ˜çº¿å›¾è¡¨ç°å‡ºè¿™äº›æŒ‡æ ‡çš„å˜åŒ–æƒ…å†µï¼Œå¹¶ç”»å‡ºåœ¨ä¸åŒæ•°æ®é‡ä¸‹çš„ROCæ›²çº¿\nåŠ è½½æ•°æ®é›† import os import random def get_dataset(): data = [] for root, dirs, files in os.walk(\u0026#39;../dataset/aclImdb/neg\u0026#39;): for file in files: realpath = os.path.join(root, file) with open(realpath, errors=\u0026#39;ignore\u0026#39;) as f: data.append((f.read(), 0)) for root, dirs, files in os.walk(r\u0026#39;../dataset/aclImdb/pos\u0026#39;): for file in files: realpath = os.path.join(root, file) with open(realpath, errors=\u0026#39;ignore\u0026#39;) as f: data.append((f.read(), 1)) random.shuffle(data) return data data = get_dataset() data[:2] [('Unless you are between the ages of 10 and 14 (except for the R rating), there are very few things to like here. One or two lines from Kenan Thompson, David Koechner (we really should see him more) and Sam Jackson are humorous and Julianna Margulies is as good as she can be considering her surroundings, but sadly, that\\'s it. Poor plot. Poor acting. Worse writing and delivery. The special effects are dismal. As much as the entire situation is an odd and awful joke, the significant individual embedded situations are all equally terrible. If we consider the action portions, well there are unbelievable action sequences in some films that make you giddy and there are some that make you groan. This movie only contains the latter kind. This leaves little left. I\\'m so glad I did not pay for this.\u0026lt;br /\u0026gt;\u0026lt;br /\u0026gt;Despite any hype, I can read and think, so as I sat down to watch, I did not expect anything good. I had no expectations, but was somewhat worried going in. Yet, like a train wreck, one cannot merely look away. And even with no expectations, I was let down. Bad. Not even \\'so bad, it\\'s good\\' material. I\\'m _very_ tolerant of bad movies, but this makes \u0026quot;Six String Samurai\u0026quot; (which I liked) Oscar worthy.\u0026lt;br /\u0026gt;\u0026lt;br /\u0026gt;No, this piece of over CGI\\'d rubbish is in the same company as Battlefield Earth, Little Man and Gigli. How this is currently rated a 7.2 completely mystifies me. Brainwashing or somehow stacking the voting system is all that I can think of as answers.\u0026lt;br /\u0026gt;\u0026lt;br /\u0026gt;I could go on and on but suffice to say that tonight, I witnessed a train wreck. I need to go wash my eyes. 1 of 10', 0), (\u0026quot;BEFORE THE DEVIL KNOWS YOU'RE DEAD starts off promisingly, setting up a simple heist that goes awry, told from varying perspectives (in RASHOMON style). At around the hour mark, Sidney Lumet transforms this film into something that is so much more than the sum of its parts; it eventually morphs into a multi-faceted family drama, exploring the full realm of human emotions/relations, as the story comes to its chilling climax.\u0026lt;br /\u0026gt;\u0026lt;br /\u0026gt;As is the case with Lumet, he manages to coax exceptional performances out of his star-studded cast, without any notion of over-acting or hyperbole. Philip Seymour Hoffman, in one of his best roles, is a complex, mysterious, and interesting character, and oftentimes dwarfs Ethan Hawke, who plays his brother, Hank. That's not to say that Hawke is not bad; in fact he is quite above adequate, in a troubled role that suits his style. Marisa Tomei is excellent for her relatively short appearance (the fact that she bares her flesh adds to this). Albert Finney's character (Andy and Hank's father) is the most intriguing, and in my opinion, he deserved a bit more screen-time. Amy Ryan also performs her job adequately.\u0026lt;br /\u0026gt;\u0026lt;br /\u0026gt;BEFORE THE DEVIL KNOWS YOU'RE DEAD is not an exceptional movie, but it proves that Lumet is still near the top of his game at the (apparent) twilight of an illustrious career. Many of his characteristics and trademarks appear here, not least of which involves the use of his characters. Infused with a killer script (no pun intended), smart dialogue and pacing, and a decent score, BEFORE THE DEVIL KNOWS YOU'RE DEAD is a must-see. A truly underrated gem. 8/10. 3 stars (out of 4). Should just enter my Top 250 at 248. Highly recommended.\u0026quot;, 1)]  æŒ‰7ï¼š3åˆ’åˆ†æ•°æ®é›† def train_and_test_data(data_): filesize = int(0.7 * len(data_)) # è®­ç»ƒé›†å’Œæµ‹è¯•é›†çš„æ¯”ä¾‹ä¸º7:3 train_data_ = [each[0] for each in data_[:filesize]] train_target_ = [each[1] for each in data_[:filesize]] test_data_ = [each[0] for each in data_[filesize:]] test_target_ = [each[1] for each in data_[filesize:]] return train_data_, train_target_, test_data_, test_target_ train_data, train_target, test_data, test_target = train_and_test_data(data) å®šä¹‰åˆ†ç±»å™¨ from sklearn.naive_bayes import MultinomialNB from sklearn.pipeline import Pipeline from sklearn.feature_extraction.text import TfidfVectorizer, HashingVectorizer, CountVectorizer from sklearn import metrics from sklearn.naive_bayes import BernoulliNB nbc = Pipeline([ (\u0026#39;vect\u0026#39;, TfidfVectorizer()), (\u0026#39;clf\u0026#39;, MultinomialNB(alpha=1.0)), ]) nbc.fit(train_data, train_target) #è®­ç»ƒæˆ‘ä»¬çš„å¤šé¡¹å¼æ¨¡å‹è´å¶æ–¯åˆ†ç±»å™¨ predict = nbc.predict(test_data) #åœ¨æµ‹è¯•é›†ä¸Šé¢„æµ‹ç»“æœ y_score = nbc.fit(train_data, train_target).predict_proba(test_data) print(y_score) count = 0 #ç»Ÿè®¡é¢„æµ‹æ­£ç¡®çš„ç»“æœä¸ªæ•° for left , right in zip(predict, test_target): if left == right: count += 1 print(count/len(test_target)) [[0.51083071 0.48916929] [0.73102053 0.26897947] [0.30725664 0.69274336] ... [0.7051641 0.2948359 ] [0.95670055 0.04329945] [0.96212725 0.03787275]] 0.8618666666666667  from sklearn.naive_bayes import MultinomialNB from sklearn.pipeline import Pipeline from sklearn.feature_extraction.text import TfidfVectorizer, HashingVectorizer, CountVectorizer from sklearn import metrics from sklearn.naive_bayes import BernoulliNB from sklearn.metrics import roc_curve, auc import matplotlib.pyplot as plt from itertools import cycle nbc = Pipeline([ (\u0026#39;vect\u0026#39;, TfidfVectorizer()), (\u0026#39;clf\u0026#39;, MultinomialNB(alpha=1.0)), ]) fpr = [] tpr = [] roc_auc = [] for k, v in enumerate([0.1, 0.3, 0.5, 0.8, 1]): train_data_ = train_data[0: int(len(train_data)*v)] train_target_ = train_target[0: int(len(train_data)*v)] test_data_ = test_data[0: int(len(train_data)*v)] test_target_ = test_target[0: int(len(train_data)*v)] nbc.fit(train_data_, train_target_) predict = nbc.predict(test_data_) y_score = nbc.fit(train_data_, train_target_).predict_proba(test_data_) print(y_score) f, t , _ = roc_curve(test_target_, y_score[:, 1]) fpr.append(f) tpr.append(t) roc_auc.append(auc(fpr[k], tpr[k])) plt.figure(figsize=(8,6), dpi=200) colors = cycle([\u0026#39;aqua\u0026#39;, \u0026#39;darkorange\u0026#39;, \u0026#39;cornflowerblue\u0026#39;, \u0026#39;navy\u0026#39;, \u0026#39;green\u0026#39;]) for i, color in zip(range(5), colors): plt.plot(fpr[i], tpr[i], color=color, lw=lw, label=\u0026#39;ROC curve of {0} (area = {1:0.2f})\u0026#39; \u0026#39;\u0026#39;.format([0.1, 0.3, 0.5, 0.8, 1][i], roc_auc[i])) plt.plot([0, 1], [0, 1], color=\u0026#39;black\u0026#39;, lw=lw, linestyle=\u0026#39;--\u0026#39;) plt.xlim([0.0, 1.0]) plt.ylim([0.0, 1.05]) plt.xlabel(\u0026#39;False Positive Rate\u0026#39;) plt.ylabel(\u0026#39;True Positive Rate\u0026#39;) plt.title(\u0026#39;Receiver operating characteristic example\u0026#39;) plt.legend(loc=\u0026#34;lower right\u0026#34;) plt.show() [[0.52592994 0.47407006] [0.50514363 0.49485637] [0.38757784 0.61242216] ... [0.56621401 0.43378599] [0.35758914 0.64241086] [0.31767289 0.68232711]] [[0.49465951 0.50534049] [0.70456524 0.29543476] [0.42657598 0.57342402] ... [0.49094946 0.50905054] [0.92783796 0.07216204] [0.8024358 0.1975642 ]] [[0.49445208 0.50554792] [0.72624226 0.27375774] [0.35817261 0.64182739] ... [0.72512198 0.27487802] [0.95407643 0.04592357] [0.95014618 0.04985382]] [[0.47846521 0.52153479] [0.74802248 0.25197752] [0.30833458 0.69166542] ... [0.7419486 0.2580514 ] [0.95732057 0.04267943] [0.95765587 0.04234413]] [[0.51083071 0.48916929] [0.73102053 0.26897947] [0.30725664 0.69274336] ... [0.7051641 0.2948359 ] [0.95670055 0.04329945] [0.96212725 0.03787275]]  ","permalink":"http://yangchnet.github.io/Dessert/posts/dlml/%E5%88%86%E7%B1%BB%E6%8C%87%E6%A0%87%E4%BD%9C%E4%B8%9A%E7%AC%AC%E4%BA%8C%E9%A2%98/","summary":"åˆ†ç±»æŒ‡æ ‡ä½œä¸šï¼ˆç¬¬äºŒé¢˜ï¼‰ é¢˜ç›® ç»™å®šå®Œæ•´æ•°æ®é›†ï¼Œåˆ†åˆ«è®¡ç®—åœ¨ä½¿ç”¨å®Œæ•´æ•°æ®é›†çš„10%,30%,50%,80%,100%æ•°æ®æ—¶çš„æŸ¥å‡†ç‡ã€æŸ¥å…¨ç‡ï¼Œf1åº¦é‡å’ŒROCï¼Œä½¿ç”¨æŠ˜çº¿å›¾è¡¨ç°å‡ºè¿™äº›æŒ‡æ ‡çš„å˜åŒ–æƒ…å†µï¼Œå¹¶ç”»å‡ºåœ¨ä¸åŒæ•°æ®é‡ä¸‹çš„ROCæ›²çº¿\nåŠ è½½æ•°æ®é›† import os import random def get_dataset(): data = [] for root, dirs, files in os.walk(\u0026#39;../dataset/aclImdb/neg\u0026#39;): for file in files: realpath = os.path.join(root, file) with open(realpath, errors=\u0026#39;ignore\u0026#39;) as f: data.append((f.read(), 0)) for root, dirs, files in os.walk(r\u0026#39;../dataset/aclImdb/pos\u0026#39;): for file in files: realpath = os.path.join(root, file) with open(realpath, errors=\u0026#39;ignore\u0026#39;) as f: data.append((f.read(), 1)) random.shuffle(data) return data data = get_dataset() data[:2] [('Unless you are between the ages of 10 and 14 (except for the R rating), there are very few things to like here.","title":"åˆ†ç±»æŒ‡æ ‡ä½œä¸šï¼ˆç¬¬äºŒé¢˜ï¼‰"},{"content":"åˆ é™¤WordPress  åˆ é™¤ç½‘ç»œæ–‡ä»¶ï¼š  rm -Rf /var/www/html/* åˆ é™¤æ•°æ®åº“ã€‚é¦–å…ˆè·å–mysqlçš„rootå¯†ç ï¼ˆé€šè¿‡sshç™»å½•æ—¶æ˜¾ç¤ºåœ¨MOTDä¸­ï¼‰ã€‚  mysql -uroot -p è¾“å…¥å¯†ç åä½¿ç”¨è¯­å¥ï¼š\nDROP DATABASE wordpress; åˆ é™¤WordPressæ•°æ®åº“\nexit; ","permalink":"http://yangchnet.github.io/Dessert/posts/linux/%E5%88%A0%E9%99%A4wordpress/","summary":"åˆ é™¤WordPress  åˆ é™¤ç½‘ç»œæ–‡ä»¶ï¼š  rm -Rf /var/www/html/* åˆ é™¤æ•°æ®åº“ã€‚é¦–å…ˆè·å–mysqlçš„rootå¯†ç ï¼ˆé€šè¿‡sshç™»å½•æ—¶æ˜¾ç¤ºåœ¨MOTDä¸­ï¼‰ã€‚  mysql -uroot -p è¾“å…¥å¯†ç åä½¿ç”¨è¯­å¥ï¼š\nDROP DATABASE wordpress; åˆ é™¤WordPressæ•°æ®åº“\nexit; ","title":"åˆ é™¤WordPress"},{"content":"å››ç§å¸¸è§çš„POSTç±»å‹ 1. application/x-www-form-urlencoded è¿™åº”è¯¥æ˜¯æœ€å¸¸è§çš„ POST æäº¤æ•°æ®çš„æ–¹å¼äº†ã€‚æµè§ˆå™¨çš„åŸç”Ÿ è¡¨å•ï¼Œå¦‚æœä¸è®¾ç½® enctype å±æ€§ï¼Œé‚£ä¹ˆæœ€ç»ˆå°±ä¼šä»¥ application/x-www-form-urlencoded æ–¹å¼æäº¤æ•°æ®ã€‚è¯·æ±‚ç±»ä¼¼äºä¸‹é¢è¿™æ ·ï¼ˆæ— å…³çš„è¯·æ±‚å¤´åœ¨æœ¬æ–‡ä¸­éƒ½çœç•¥æ‰äº†ï¼‰ï¼š\nPOST http://www.example.com HTTP/1.1 Content-Type: application/x-www-form-urlencoded;charset=utf-8 title=test\u0026amp;sub%5B%5D=1\u0026amp;sub%5B%5D=2\u0026amp;sub%5B%5D=3 é¦–å…ˆï¼ŒContent-Type è¢«æŒ‡å®šä¸º application/x-www-form-urlencodedï¼›å…¶æ¬¡ï¼Œæäº¤çš„æ•°æ®æŒ‰ç…§ key1=val1\u0026amp;key2=val2 çš„æ–¹å¼è¿›è¡Œç¼–ç ï¼Œkey å’Œ val éƒ½è¿›è¡Œäº† URL è½¬ç ã€‚å¤§éƒ¨åˆ†æœåŠ¡ç«¯è¯­è¨€éƒ½å¯¹è¿™ç§æ–¹å¼æœ‰å¾ˆå¥½çš„æ”¯æŒã€‚ä¾‹å¦‚ PHP ä¸­ï¼Œ$_POST[\u0026lsquo;title\u0026rsquo;] å¯ä»¥è·å–åˆ° title çš„å€¼ï¼Œ$_POST[\u0026lsquo;sub\u0026rsquo;] å¯ä»¥å¾—åˆ° sub æ•°ç»„ã€‚\nå¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬ç”¨ Ajax æäº¤æ•°æ®æ—¶ï¼Œä¹Ÿæ˜¯ä½¿ç”¨è¿™ç§æ–¹å¼ã€‚ä¾‹å¦‚ JQuery å’Œ QWrap çš„ Ajaxï¼ŒContent-Type é»˜è®¤å€¼éƒ½æ˜¯ã€Œapplication/x-www-form-urlencoded;charset=utf-8ã€ã€‚\n2. multipart/form-data è¿™åˆæ˜¯ä¸€ä¸ªå¸¸è§çš„ POST æ•°æ®æäº¤çš„æ–¹å¼ã€‚æˆ‘ä»¬ä½¿ç”¨è¡¨å•ä¸Šä¼ æ–‡ä»¶æ—¶ï¼Œå¿…é¡»è®© \u0026lt;form\u0026gt; è¡¨å•çš„ enctype ç­‰äº multipart/form-dataã€‚ç›´æ¥æ¥çœ‹ä¸€ä¸ªè¯·æ±‚ç¤ºä¾‹ï¼š\nPOST http://www.example.com HTTP/1.1 Content-Type:multipart/form-data; boundary=----WebKitFormBoundaryrGKCBY7qhFd3TrwA ------WebKitFormBoundaryrGKCBY7qhFd3TrwA Content-Disposition: form-data; name=\u0026#34;text\u0026#34; title ------WebKitFormBoundaryrGKCBY7qhFd3TrwA Content-Disposition: form-data; name=\u0026#34;file\u0026#34;; filename=\u0026#34;chrome.png\u0026#34; Content-Type: image/png PNG ... content of chrome.png ... ------WebKitFormBoundaryrGKCBY7qhFd3TrwA-- è¿™ä¸ªä¾‹å­ç¨å¾®å¤æ‚ç‚¹ã€‚é¦–å…ˆç”Ÿæˆäº†ä¸€ä¸ª boundary ç”¨äºåˆ†å‰²ä¸åŒçš„å­—æ®µï¼Œä¸ºäº†é¿å…ä¸æ­£æ–‡å†…å®¹é‡å¤ï¼Œboundary å¾ˆé•¿å¾ˆå¤æ‚ã€‚ç„¶å Content-Type é‡ŒæŒ‡æ˜äº†æ•°æ®æ˜¯ä»¥ multipart/form-data æ¥ç¼–ç ï¼Œæœ¬æ¬¡è¯·æ±‚çš„ boundary æ˜¯ä»€ä¹ˆå†…å®¹ã€‚æ¶ˆæ¯ä¸»ä½“é‡ŒæŒ‰ç…§å­—æ®µä¸ªæ•°åˆåˆ†ä¸ºå¤šä¸ªç»“æ„ç±»ä¼¼çš„éƒ¨åˆ†ï¼Œæ¯éƒ¨åˆ†éƒ½æ˜¯ä»¥ \u0026ndash;boundary å¼€å§‹ï¼Œç´§æ¥ç€æ˜¯å†…å®¹æè¿°ä¿¡æ¯ï¼Œç„¶åæ˜¯å›è½¦ï¼Œæœ€åæ˜¯å­—æ®µå…·ä½“å†…å®¹ï¼ˆæ–‡æœ¬æˆ–äºŒè¿›åˆ¶ï¼‰ã€‚å¦‚æœä¼ è¾“çš„æ˜¯æ–‡ä»¶ï¼Œè¿˜è¦åŒ…å«æ–‡ä»¶åå’Œæ–‡ä»¶ç±»å‹ä¿¡æ¯ã€‚æ¶ˆæ¯ä¸»ä½“æœ€åä»¥ \u0026ndash;boundary\u0026ndash; æ ‡ç¤ºç»“æŸã€‚å…³äº multipart/form-data çš„è¯¦ç»†å®šä¹‰ï¼Œè¯·å‰å¾€ rfc1867 æŸ¥çœ‹ã€‚\nè¿™ç§æ–¹å¼ä¸€èˆ¬ç”¨æ¥ä¸Šä¼ æ–‡ä»¶ï¼Œå„å¤§æœåŠ¡ç«¯è¯­è¨€å¯¹å®ƒä¹Ÿæœ‰ç€è‰¯å¥½çš„æ”¯æŒã€‚\nä¸Šé¢æåˆ°çš„è¿™ä¸¤ç§ POST æ•°æ®çš„æ–¹å¼ï¼Œéƒ½æ˜¯æµè§ˆå™¨åŸç”Ÿæ”¯æŒçš„ï¼Œè€Œä¸”ç°é˜¶æ®µæ ‡å‡†ä¸­åŸç”Ÿ \u0026lt;form\u0026gt; è¡¨å•ä¹Ÿåªæ”¯æŒè¿™ä¸¤ç§æ–¹å¼ï¼ˆé€šè¿‡ \u0026lt;form\u0026gt; å…ƒç´ çš„ enctype å±æ€§æŒ‡å®šï¼Œé»˜è®¤ä¸º application/x-www-form-urlencodedã€‚å…¶å® enctype è¿˜æ”¯æŒ text/plainï¼Œä¸è¿‡ç”¨å¾—éå¸¸å°‘ï¼‰ã€‚\néšç€è¶Šæ¥è¶Šå¤šçš„ Web ç«™ç‚¹ï¼Œå°¤å…¶æ˜¯ WebAppï¼Œå…¨éƒ¨ä½¿ç”¨ Ajax è¿›è¡Œæ•°æ®äº¤äº’ä¹‹åï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥å®šä¹‰æ–°çš„æ•°æ®æäº¤æ–¹å¼ï¼Œç»™å¼€å‘å¸¦æ¥æ›´å¤šä¾¿åˆ©ã€‚\n3. application/json application/json è¿™ä¸ª Content-Type ä½œä¸ºå“åº”å¤´å¤§å®¶è‚¯å®šä¸é™Œç”Ÿã€‚å®é™…ä¸Šï¼Œç°åœ¨è¶Šæ¥è¶Šå¤šçš„äººæŠŠå®ƒä½œä¸ºè¯·æ±‚å¤´ï¼Œç”¨æ¥å‘Šè¯‰æœåŠ¡ç«¯æ¶ˆæ¯ä¸»ä½“æ˜¯åºåˆ—åŒ–åçš„ JSON å­—ç¬¦ä¸²ã€‚ç”±äº JSON è§„èŒƒçš„æµè¡Œï¼Œé™¤äº†ä½ç‰ˆæœ¬ IE ä¹‹å¤–çš„å„å¤§æµè§ˆå™¨éƒ½åŸç”Ÿæ”¯æŒ JSON.stringifyï¼ŒæœåŠ¡ç«¯è¯­è¨€ä¹Ÿéƒ½æœ‰å¤„ç† JSON çš„å‡½æ•°ï¼Œä½¿ç”¨ JSON ä¸ä¼šé‡ä¸Šä»€ä¹ˆéº»çƒ¦ã€‚\nJSON æ ¼å¼æ”¯æŒæ¯”é”®å€¼å¯¹å¤æ‚å¾—å¤šçš„ç»“æ„åŒ–æ•°æ®ï¼Œè¿™ä¸€ç‚¹ä¹Ÿå¾ˆæœ‰ç”¨ã€‚è®°å¾—æˆ‘å‡ å¹´å‰åšä¸€ä¸ªé¡¹ç›®æ—¶ï¼Œéœ€è¦æäº¤çš„æ•°æ®å±‚æ¬¡éå¸¸æ·±ï¼Œæˆ‘å°±æ˜¯æŠŠæ•°æ® JSON åºåˆ—åŒ–ä¹‹åæ¥æäº¤çš„ã€‚ä¸è¿‡å½“æ—¶æˆ‘æ˜¯æŠŠ JSON å­—ç¬¦ä¸²ä½œä¸º valï¼Œä»ç„¶æ”¾åœ¨é”®å€¼å¯¹é‡Œï¼Œä»¥ x-www-form-urlencoded æ–¹å¼æäº¤ã€‚\nGoogle çš„ AngularJS ä¸­çš„ Ajax åŠŸèƒ½ï¼Œé»˜è®¤å°±æ˜¯æäº¤ JSON å­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ä¸‹é¢è¿™æ®µä»£ç ï¼š\nvar data = {\u0026#39;title\u0026#39;:\u0026#39;test\u0026#39;, \u0026#39;sub\u0026#39; : [1,2,3]}; $http.post(url, data).success(function(result) { ... }); æœ€ç»ˆå‘é€çš„è¯·æ±‚æ˜¯ï¼š\nPOST http://www.example.com HTTP/1.1 Content-Type: application/json;charset=utf-8 {\u0026#34;title\u0026#34;:\u0026#34;test\u0026#34;,\u0026#34;sub\u0026#34;:[1,2,3]}\\ è¿™ç§æ–¹æ¡ˆï¼Œå¯ä»¥æ–¹ä¾¿çš„æäº¤å¤æ‚çš„ç»“æ„åŒ–æ•°æ®ï¼Œç‰¹åˆ«é€‚åˆ RESTful çš„æ¥å£ã€‚å„å¤§æŠ“åŒ…å·¥å…·å¦‚ Chrome è‡ªå¸¦çš„å¼€å‘è€…å·¥å…·ã€Firebugã€Fiddlerï¼Œéƒ½ä¼šä»¥æ ‘å½¢ç»“æ„å±•ç¤º JSON æ•°æ®ï¼Œéå¸¸å‹å¥½ã€‚ä½†ä¹Ÿæœ‰äº›æœåŠ¡ç«¯è¯­è¨€è¿˜æ²¡æœ‰æ”¯æŒè¿™ç§æ–¹å¼ï¼Œä¾‹å¦‚ php å°±æ— æ³•é€šè¿‡ $_POST å¯¹è±¡ä»ä¸Šé¢çš„è¯·æ±‚ä¸­è·å¾—å†…å®¹ã€‚è¿™æ—¶å€™ï¼Œéœ€è¦è‡ªå·±åŠ¨æ‰‹å¤„ç†ä¸‹ï¼šåœ¨è¯·æ±‚å¤´ä¸­ Content-Type ä¸º application/json æ—¶ï¼Œä» php://input é‡Œè·å¾—åŸå§‹è¾“å…¥æµï¼Œå† json_decode æˆå¯¹è±¡ã€‚ä¸€äº› php æ¡†æ¶å·²ç»å¼€å§‹è¿™ä¹ˆåšäº†ã€‚\n4. text/xml XML-RPCï¼ˆXML Remote Procedure Callï¼‰æ˜¯ä¸€ç§ä½¿ç”¨ HTTP ä½œä¸ºä¼ è¾“åè®®ï¼ŒXML ä½œä¸ºç¼–ç æ–¹å¼çš„è¿œç¨‹è°ƒç”¨è§„èŒƒã€‚å…¸å‹çš„ XML-RPC è¯·æ±‚æ˜¯è¿™æ ·çš„ï¼š\nPOST http://www.example.com HTTP/1.1 Content-Type: text/xml \u0026lt;?xml version=\u0026#34;1.0\u0026#34;?\u0026gt; \u0026lt;methodCall\u0026gt; \u0026lt;methodName\u0026gt;examples.getStateName\u0026lt;/methodName\u0026gt; \u0026lt;params\u0026gt; \u0026lt;param\u0026gt; \u0026lt;value\u0026gt;\u0026lt;i4\u0026gt;41\u0026lt;/i4\u0026gt;\u0026lt;/value\u0026gt; \u0026lt;/param\u0026gt; \u0026lt;/params\u0026gt; \u0026lt;/methodCall\u0026gt; XML-RPC åè®®ç®€å•ã€åŠŸèƒ½å¤Ÿç”¨ï¼Œå„ç§è¯­è¨€çš„å®ç°éƒ½æœ‰ã€‚å®ƒçš„ä½¿ç”¨ä¹Ÿå¾ˆå¹¿æ³›ï¼Œå¦‚ WordPress çš„ XML-RPC Apiï¼Œæœç´¢å¼•æ“çš„ ping æœåŠ¡ç­‰ç­‰ã€‚JavaScript ä¸­ï¼Œä¹Ÿæœ‰ç°æˆçš„åº“æ”¯æŒä»¥è¿™ç§æ–¹å¼è¿›è¡Œæ•°æ®äº¤äº’ï¼Œèƒ½å¾ˆå¥½çš„æ”¯æŒå·²æœ‰çš„ XML-RPC æœåŠ¡ã€‚\n","permalink":"http://yangchnet.github.io/Dessert/posts/net/%E5%9B%9B%E7%A7%8D%E5%B8%B8%E8%A7%81%E7%9A%84post%E7%B1%BB%E5%9E%8B/","summary":"å››ç§å¸¸è§çš„POSTç±»å‹ 1. application/x-www-form-urlencoded è¿™åº”è¯¥æ˜¯æœ€å¸¸è§çš„ POST æäº¤æ•°æ®çš„æ–¹å¼äº†ã€‚æµè§ˆå™¨çš„åŸç”Ÿ è¡¨å•ï¼Œå¦‚æœä¸è®¾ç½® enctype å±æ€§ï¼Œé‚£ä¹ˆæœ€ç»ˆå°±ä¼šä»¥ application/x-www-form-urlencoded æ–¹å¼æäº¤æ•°æ®ã€‚è¯·æ±‚ç±»ä¼¼äºä¸‹é¢è¿™æ ·ï¼ˆæ— å…³çš„è¯·æ±‚å¤´åœ¨æœ¬æ–‡ä¸­éƒ½çœç•¥æ‰äº†ï¼‰ï¼š\nPOST http://www.example.com HTTP/1.1 Content-Type: application/x-www-form-urlencoded;charset=utf-8 title=test\u0026amp;sub%5B%5D=1\u0026amp;sub%5B%5D=2\u0026amp;sub%5B%5D=3 é¦–å…ˆï¼ŒContent-Type è¢«æŒ‡å®šä¸º application/x-www-form-urlencodedï¼›å…¶æ¬¡ï¼Œæäº¤çš„æ•°æ®æŒ‰ç…§ key1=val1\u0026amp;key2=val2 çš„æ–¹å¼è¿›è¡Œç¼–ç ï¼Œkey å’Œ val éƒ½è¿›è¡Œäº† URL è½¬ç ã€‚å¤§éƒ¨åˆ†æœåŠ¡ç«¯è¯­è¨€éƒ½å¯¹è¿™ç§æ–¹å¼æœ‰å¾ˆå¥½çš„æ”¯æŒã€‚ä¾‹å¦‚ PHP ä¸­ï¼Œ$_POST[\u0026lsquo;title\u0026rsquo;] å¯ä»¥è·å–åˆ° title çš„å€¼ï¼Œ$_POST[\u0026lsquo;sub\u0026rsquo;] å¯ä»¥å¾—åˆ° sub æ•°ç»„ã€‚\nå¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬ç”¨ Ajax æäº¤æ•°æ®æ—¶ï¼Œä¹Ÿæ˜¯ä½¿ç”¨è¿™ç§æ–¹å¼ã€‚ä¾‹å¦‚ JQuery å’Œ QWrap çš„ Ajaxï¼ŒContent-Type é»˜è®¤å€¼éƒ½æ˜¯ã€Œapplication/x-www-form-urlencoded;charset=utf-8ã€ã€‚\n2. multipart/form-data è¿™åˆæ˜¯ä¸€ä¸ªå¸¸è§çš„ POST æ•°æ®æäº¤çš„æ–¹å¼ã€‚æˆ‘ä»¬ä½¿ç”¨è¡¨å•ä¸Šä¼ æ–‡ä»¶æ—¶ï¼Œå¿…é¡»è®© \u0026lt;form\u0026gt; è¡¨å•çš„ enctype ç­‰äº multipart/form-dataã€‚ç›´æ¥æ¥çœ‹ä¸€ä¸ªè¯·æ±‚ç¤ºä¾‹ï¼š\nPOST http://www.example.com HTTP/1.1 Content-Type:multipart/form-data; boundary=----WebKitFormBoundaryrGKCBY7qhFd3TrwA ------WebKitFormBoundaryrGKCBY7qhFd3TrwA Content-Disposition: form-data; name=\u0026#34;text\u0026#34; title ------WebKitFormBoundaryrGKCBY7qhFd3TrwA Content-Disposition: form-data; name=\u0026#34;file\u0026#34;; filename=\u0026#34;chrome.png\u0026#34; Content-Type: image/png PNG .","title":"å››ç§å¸¸è§çš„POSTç±»å‹"},{"content":"åœ¨dockerä¸­æ„å»ºdjangoé¡¹ç›® ï¼ˆéœ€å®‰è£…docker-compose, å®‰è£…æ•™ç¨‹ï¼‰\n1. å®šä¹‰é¡¹ç›®ç»„ä»¶ å¯¹äºæ­¤é¡¹ç›®ï¼Œæ‚¨éœ€è¦åˆ›å»ºDockerfileï¼ŒPythonä¾èµ–é¡¹æ–‡ä»¶å’Œdocker-compose.ymlæ–‡ä»¶ã€‚ï¼ˆæ‚¨å¯ä»¥ä½¿ç”¨æ­¤æ–‡ä»¶çš„æ‰©å±•å.ymlæˆ–.yamlæ‰©å±•åã€‚ï¼‰\n1.1. åˆ›å»ºä¸€ä¸ªç©ºç›®å½• è¯¥ç›®å½•åº”ä»…åŒ…å«æ„å»ºè¯¥æ˜ åƒçš„èµ„æºã€‚\n1.2 åˆ›å»ºDockerfile å†…å®¹å¦‚ä¸‹ï¼š\nFROM python:3 ENV PYTHONUNBUFFERED 1 RUN mkdir /code WORKDIR /code COPY requirements.txt /code/ RUN pip install -r requirements.txt COPY . /code/ å¯¹äºDockerFileçš„è§£é‡Š\n1.3 åˆ›å»ºrequirements.txt å†…å®¹å¦‚ä¸‹ï¼š\ndjango django-ckeditor pillow numpy 1.4 åˆ›å»ºdocker-compose.yml è¯¥docker-compose.ymlæ–‡ä»¶æè¿°äº†æ„æˆåº”ç”¨ç¨‹åºçš„æœåŠ¡ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œè¿™äº›æœåŠ¡æ˜¯WebæœåŠ¡å™¨å’Œæ•°æ®åº“ã€‚æ’°å†™æ–‡ä»¶è¿˜æè¿°äº†è¿™äº›æœåŠ¡ä½¿ç”¨å“ªäº›Dockeræ˜ åƒï¼Œå®ƒä»¬å¦‚ä½•é“¾æ¥åœ¨ä¸€èµ·ï¼Œä»¥åŠå®ƒä»¬å¯èƒ½éœ€è¦å®‰è£…åœ¨å®¹å™¨å†…çš„ä»»ä½•å·ã€‚æœ€åï¼Œè¯¥docker-compose.ymlæ–‡ä»¶æè¿°äº†è¿™äº›æœåŠ¡å…¬å¼€çš„ç«¯å£ã€‚æœ‰å…³æ­¤æ–‡ä»¶å¦‚ä½•å·¥ä½œçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…docker-compose.ymlå‚è€ƒã€‚ å†…å®¹å¦‚ä¸‹ï¼š\nversion: \u0026#39;3\u0026#39; services: db: image: postgres web: build: . command: python manage.py runserver 0.0.0.0:8000 volumes: - .:/code ports: - \u0026#34;8000:8000\u0026#34; depends_on: - db 2 åˆ›å»ºdjangoé¡¹ç›®  åˆ‡æ¢åˆ°é¡¹ç›®è·Ÿç›®å½•ã€‘ é€šè¿‡è¿è¡Œdocker-compose run å‘½ä»¤åˆ›å»ºdjangoé¡¹ç›®  sudo docker-compose run web django-admin startproject mysite . æŸ¥çœ‹é¡¹ç›®å†…å®¹\nls -l æ›´æ”¹æ–‡ä»¶æ‰€æœ‰æƒ  sudo chown -R $USER:$USER . 3 è¿æ¥æ•°æ®åº“  æ‰“å¼€mysite/setting.py\næ”¹ä¸ºï¼š  DATABASES = { \u0026#39;default\u0026#39;: { \u0026#39;ENGINE\u0026#39;: \u0026#39;django.db.backends.postgresql\u0026#39;, \u0026#39;NAME\u0026#39;: \u0026#39;postgres\u0026#39;, \u0026#39;USER\u0026#39;: \u0026#39;postgres\u0026#39;, \u0026#39;HOST\u0026#39;: \u0026#39;db\u0026#39;, \u0026#39;PORT\u0026#39;: 5432, } } ä»é¡¹ç›®çš„é¡¶çº§ç›®å½•è¿è¡Œ docker-compose upå‘½ä»¤  ","permalink":"http://yangchnet.github.io/Dessert/posts/container/%E5%9C%A8docker%E4%B8%AD%E6%9E%84%E5%BB%BAdjango%E9%A1%B9%E7%9B%AE/","summary":"åœ¨dockerä¸­æ„å»ºdjangoé¡¹ç›® ï¼ˆéœ€å®‰è£…docker-compose, å®‰è£…æ•™ç¨‹ï¼‰\n1. å®šä¹‰é¡¹ç›®ç»„ä»¶ å¯¹äºæ­¤é¡¹ç›®ï¼Œæ‚¨éœ€è¦åˆ›å»ºDockerfileï¼ŒPythonä¾èµ–é¡¹æ–‡ä»¶å’Œdocker-compose.ymlæ–‡ä»¶ã€‚ï¼ˆæ‚¨å¯ä»¥ä½¿ç”¨æ­¤æ–‡ä»¶çš„æ‰©å±•å.ymlæˆ–.yamlæ‰©å±•åã€‚ï¼‰\n1.1. åˆ›å»ºä¸€ä¸ªç©ºç›®å½• è¯¥ç›®å½•åº”ä»…åŒ…å«æ„å»ºè¯¥æ˜ åƒçš„èµ„æºã€‚\n1.2 åˆ›å»ºDockerfile å†…å®¹å¦‚ä¸‹ï¼š\nFROM python:3 ENV PYTHONUNBUFFERED 1 RUN mkdir /code WORKDIR /code COPY requirements.txt /code/ RUN pip install -r requirements.txt COPY . /code/ å¯¹äºDockerFileçš„è§£é‡Š\n1.3 åˆ›å»ºrequirements.txt å†…å®¹å¦‚ä¸‹ï¼š\ndjango django-ckeditor pillow numpy 1.4 åˆ›å»ºdocker-compose.yml è¯¥docker-compose.ymlæ–‡ä»¶æè¿°äº†æ„æˆåº”ç”¨ç¨‹åºçš„æœåŠ¡ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œè¿™äº›æœåŠ¡æ˜¯WebæœåŠ¡å™¨å’Œæ•°æ®åº“ã€‚æ’°å†™æ–‡ä»¶è¿˜æè¿°äº†è¿™äº›æœåŠ¡ä½¿ç”¨å“ªäº›Dockeræ˜ åƒï¼Œå®ƒä»¬å¦‚ä½•é“¾æ¥åœ¨ä¸€èµ·ï¼Œä»¥åŠå®ƒä»¬å¯èƒ½éœ€è¦å®‰è£…åœ¨å®¹å™¨å†…çš„ä»»ä½•å·ã€‚æœ€åï¼Œè¯¥docker-compose.ymlæ–‡ä»¶æè¿°äº†è¿™äº›æœåŠ¡å…¬å¼€çš„ç«¯å£ã€‚æœ‰å…³æ­¤æ–‡ä»¶å¦‚ä½•å·¥ä½œçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…docker-compose.ymlå‚è€ƒã€‚ å†…å®¹å¦‚ä¸‹ï¼š\nversion: \u0026#39;3\u0026#39; services: db: image: postgres web: build: . command: python manage.py runserver 0.0.0.0:8000 volumes: - .:/code ports: - \u0026#34;8000:8000\u0026#34; depends_on: - db 2 åˆ›å»ºdjangoé¡¹ç›®  åˆ‡æ¢åˆ°é¡¹ç›®è·Ÿç›®å½•ã€‘ é€šè¿‡è¿è¡Œdocker-compose run å‘½ä»¤åˆ›å»ºdjangoé¡¹ç›®  sudo docker-compose run web django-admin startproject mysite .","title":"åœ¨dockerä¸­æ„å»ºdjangoé¡¹ç›®"},{"content":"åŸºäºå·ç§¯ç¥ç»ç½‘ç»œå’Œå†³ç­–æ ‘çš„ä½“åŸŸç½‘æ•°æ®èåˆæ–¹æ³• ç°é˜¶æ®µæƒ³æ³•:åœ¨softmaxå±‚åæ¥éšæœºæ£®æ—ï¼Œé€šè¿‡ç§æ ‘å¢åŠ åˆ†ç±»å‡†ç¡®ç‡\nimport tensorflow as tf import numpy as np import tensorflow.examples.tutorials.mnist.input_data as input_data import scipy as sp %matplotlib inline sess = tf.Session() DEPTH = 3 # Depth of a tree N_LEAF = 2 ** (DEPTH + 1) # Number of leaf node N_LABEL = 10 # Number of classes N_TREE = 5 # Number of trees (ensemble) N_BATCH = 128 # Number of data points per mini-batch åˆ†æ‰¹è®­ç»ƒï¼Œæ¯ä¸€æ‰¹128ä¸ª  åˆå§‹åŒ–çŸ©é˜µ def init_weights(shape): return tf.Variable(tf.random_normal(shape, stddev=0.01)) def init_prob_weights(shape, minval=-5, maxval=5): return tf.Variable(tf.random_uniform(shape, minval, maxval))  å®šä¹‰æ¨¡å‹  aè¡¨ç¤ºalive,æ¿€æ´»ä¹‹æ„ï¼Œeg:l1a,è¡¨ç¤ºlayer_1_aliveï¼Œç¬¬ä¸€ä¸ªæ¿€æ´»å±‚ wè¡¨ç¤ºweight,æƒé‡  def model(X, w, w2, w3, w4_e, w_d_e, w_l_e, p_keep_conv, p_keep_hidden): # æ¿€æ´»å±‚1 \u0026amp; æ± åŒ–å±‚1 \u0026amp; dropout l1a = tf.nn.relu(tf.nn.conv2d(X, w, [1, 1, 1, 1], \u0026#39;SAME\u0026#39;)) l1 = tf.nn.max_pool(l1a, ksize=[1, 2, 2, 1], strides=[1, 2, 2, 1], padding=\u0026#39;SAME\u0026#39;) l1 = tf.nn.dropout(l1, p_keep_conv) # æ¿€æ´»å±‚2 \u0026amp; æ± åŒ–å±‚ \u0026amp; dropout l2a = tf.nn.relu(tf.nn.conv2d(l1, w2, [1, 1, 1, 1], \u0026#39;SAME\u0026#39;)) l2 = tf.nn.max_pool(l2a, ksize=[1, 2, 2, 1], strides=[1, 2, 2, 1], padding=\u0026#39;SAME\u0026#39;) l2 = tf.nn.dropout(l2, p_keep_conv) # æ¿€æ´»å±‚3 \u0026amp; æ± åŒ–å±‚ \u0026amp; full connected layer \u0026amp; dropout l3a = tf.nn.relu(tf.nn.conv2d(l2, w3, [1, 1, 1, 1], \u0026#39;SAME\u0026#39;)) l3 = tf.nn.max_pool(l3a, ksize=[1, 2, 2, 1], strides=[1, 2, 2, 1], padding=\u0026#39;SAME\u0026#39;) l3 = tf.reshape(l3, [-1, w4_e[0].get_shape().as_list()[0]]) l3 = tf.nn.dropout(l3, p_keep_conv) # decision node \u0026amp; prediction node (leaf node) decision_p_e = [] leaf_p_e = [] for w4, w_d, w_l in zip(w4_e, w_d_e, w_l_e): l4 = tf.nn.relu(tf.matmul(l3, w4)) l4 = tf.nn.dropout(l4, p_keep_conv) decision_p = tf.nn.sigmoid(tf.matmul(l4, w_d)) # ä»è¿™ä¸€å¥çœ‹ï¼Œå¥½åƒå¶å­èŠ‚ç‚¹ä¸ä¸å†³ç­–èŠ‚ç‚¹ç›¸å…³ leaf_p = tf.nn.softmax(w_l) decision_p_e.append(decision_p) leaf_p_e.append(leaf_p) return decision_p_e, leaf_p_e åˆ›å»ºå ä½ç¬¦ä½œä¸ºè¾“å…¥ X = tf.placeholder(\u0026#34;float\u0026#34;, [N_BATCH, 28, 28, 1]) Y = tf.placeholder(\u0026#34;float\u0026#34;, [N_BATCH, N_LABEL]) åˆå§‹åŒ–å‚æ•° w = init_weights([3, 3, 1, 32]) w2 = init_weights([3, 3, 32, 64]) w3 = init_weights([3, 3, 64, 128]) w4_ensemble = [] w_d_ensemble = [] w_l_ensemble = [] for i in range(N_TREE): w4_ensemble.append(init_weights([128*4*4, 625])) w_d_ensemble.append(init_prob_weights([625, N_LEAF], -1, 1)) w_l_ensemble.append(init_prob_weights([N_LEAF, N_LABEL], -2, 2)) p_keep_conv = tf.placeholder(\u0026#34;float\u0026#34;) p_keep_hidden = tf.placeholder(\u0026#34;float\u0026#34;) å®šä¹‰ä¸€ä¸ªå®Œå…¨å¯å¾®deep-ndf decision_p_e, leaf_p_e = model(X, w, w2, w3, w4_ensemble, w_d_ensemble, w_l_ensemble, p_keep_conv, p_keep_hidden) flat_decision_p_e = [] for decision_p in decision_p_e: # decision_pæ˜¯d, decision_p_compæ˜¯1-d decision_p_comp = tf.subtract(tf.ones_like(decision_p), decision_p) decision_p_pack = tf.stack([decision_p, decision_p_comp]) flat_decision_p = tf.reshape(decision_p_pack, [-1]) flat_decision_p_e.append(flat_decision_p) batch_0_indices = \\ tf.tile(tf.expand_dims(tf.range(0, N_BATCH * N_LEAF, N_LEAF), 1), [1, N_LEAF])  sess = tf.Session() sess.run(batch_0_indices) array([[ 0, 0, 0, ..., 0, 0, 0], [ 16, 16, 16, ..., 16, 16, 16], [ 32, 32, 32, ..., 32, 32, 32], ..., [2000, 2000, 2000, ..., 2000, 2000, 2000], [2016, 2016, 2016, ..., 2016, 2016, 2016], [2032, 2032, 2032, ..., 2032, 2032, 2032]], dtype=int32)  batch_0_indices.shape = 128 * 16\nin_repeat = N_LEAF / 2 out_repeat = N_BATCH batch_complement_indices = \\ np.array([[0] * int(in_repeat), [N_BATCH * N_LEAF] \\ * int(in_repeat)] * out_repeat).reshape(N_BATCH, N_LEAF) print(batch_complement_indices) [[ 0 0 0 ... 2048 2048 2048] [ 0 0 0 ... 2048 2048 2048] [ 0 0 0 ... 2048 2048 2048] ... [ 0 0 0 ... 2048 2048 2048] [ 0 0 0 ... 2048 2048 2048] [ 0 0 0 ... 2048 2048 2048]]  sess.run(tf.add(batch_0_indices, batch_complement_indices)) array([[ 0, 0, 0, ..., 2048, 2048, 2048], [ 16, 16, 16, ..., 2064, 2064, 2064], [ 32, 32, 32, ..., 2080, 2080, 2080], ..., [2000, 2000, 2000, ..., 4048, 4048, 4048], [2016, 2016, 2016, ..., 4064, 4064, 4064], [2032, 2032, 2032, ..., 4080, 4080, 4080]], dtype=int32)  ","permalink":"http://yangchnet.github.io/Dessert/posts/dlml/dnf/","summary":"åŸºäºå·ç§¯ç¥ç»ç½‘ç»œå’Œå†³ç­–æ ‘çš„ä½“åŸŸç½‘æ•°æ®èåˆæ–¹æ³• ç°é˜¶æ®µæƒ³æ³•:åœ¨softmaxå±‚åæ¥éšæœºæ£®æ—ï¼Œé€šè¿‡ç§æ ‘å¢åŠ åˆ†ç±»å‡†ç¡®ç‡\nimport tensorflow as tf import numpy as np import tensorflow.examples.tutorials.mnist.input_data as input_data import scipy as sp %matplotlib inline sess = tf.Session() DEPTH = 3 # Depth of a tree N_LEAF = 2 ** (DEPTH + 1) # Number of leaf node N_LABEL = 10 # Number of classes N_TREE = 5 # Number of trees (ensemble) N_BATCH = 128 # Number of data points per mini-batch åˆ†æ‰¹è®­ç»ƒï¼Œæ¯ä¸€æ‰¹128ä¸ª  åˆå§‹åŒ–çŸ©é˜µ def init_weights(shape): return tf.","title":"åŸºäºå·ç§¯ç¥ç»ç½‘ç»œå’Œå†³ç­–æ ‘çš„ä½“åŸŸç½‘æ•°æ®èåˆæ–¹æ³•"},{"content":"åŸºæœ¬è®¡ç®—æŒ‡ä»¤  è¿™é‡Œçš„æ±‡ç¼–æŒ‡ä»¤å‡åŸºäºx86-64æ¶æ„\n 0. å…ˆéªŒçŸ¥è¯† 0.1 å¯„å­˜å™¨è®¾ç½® ä¸€ä¸ªx86-64çš„ä¸­å¤®å¤„ç†å•å…ƒåŒ…å«ä¸€ç»„16ä¸ª64ä½é€šç”¨ç›®çš„å¯„å­˜å™¨ã€‚è¿™äº›å¯„å­˜å™¨ç”¨æ¥å­˜å‚¨æ•´æ•°æ•°æ®å’ŒæŒ‡é’ˆã€‚æŒ‡ä»¤å¯ä»¥å¯¹è¿™16ä¸ªå¯„å­˜å™¨çš„ä½ä½å­—èŠ‚ä¸­å­˜æ”¾çš„ä¸åŒå¤§å°çš„æ•°æ®è¿›è¡Œæ“ä½œã€‚å­—èŠ‚çº§æ“ä½œå¯ä»¥è®¿é—®æœ€ä½çš„å­—èŠ‚ï¼Œ16ä½æ“ä½œå¯ä»¥è®¿é—®æœ€ä½çš„2ä¸ªå­—èŠ‚ï¼Œ32ä½æ“ä½œå¯ä»¥è®¿é—®æœ€ä½çš„4ä¸ªå­—èŠ‚ï¼Œè€Œ64ä½æ“ä½œå¯ä»¥è®¿é—®æ•´ä¸ªå¯„å­˜å™¨ã€‚\n3. å¯»å€æ–¹å¼ 1. æ•°æ®ä¼ é€æŒ‡ä»¤ æœ€ç®€å•å½¢å¼çš„æ•°æ®ä¼ é€æŒ‡ä»¤\u0026ndash;movç±»ã€‚è¿™äº›æŒ‡ä»¤æŠŠæ•°æ®ä»æºä½ç½®å¤åˆ¶åˆ°ç›®çš„ä½ç½®ï¼Œä¸åšä»»ä½•å˜åŒ–ã€‚movç±»æŒ‡ä»¤ç”±å››æ¡æŒ‡ä»¤ç»„æˆï¼šmovb, movw, movl,movq.è¿™äº›æŒ‡ä»¤éƒ½æ‰§è¡Œç›¸åŒçš„æ“ä½œï¼ŒåŒºåˆ«åœ¨äºå®ƒä»¬æ“ä½œçš„æ•°æ®å¤§å°ä¸åŒï¼šåˆ†åˆ«æ˜¯1ï¼Œ2ï¼Œ4ï¼Œ8å­—èŠ‚ã€‚\n ç”±äºå†å²åŸå› ï¼ŒIntelå¤„ç†å™¨å°†16ä½ä½œä¸ºä¸€ä¸ªå­—ï¼ˆwï¼‰ï¼Œ8ä½ä¸ºä¸€ä¸ªå­—èŠ‚(b)ï¼Œ32ä½ä¸ºåŒå­—(l),64ä½ä¸º4å­—ï¼ˆqï¼‰\n    æŒ‡ä»¤ æ•ˆæœ æè¿°     MOV S D D \u0026lt;- S ä¼ é€   movb  ä¼ é€å­—èŠ‚   movw  ä¼ é€å­—   movl  ä¼ é€åŒå­—   movq  ä¼ é€å››å­—   movabsq I, R  ä¼ é€ç»å¯¹çš„å››å­—    ä¼ é€æŒ‡ä»¤çš„ä¸¤ä¸ªæ“ä½œæ•°ä¸èƒ½éƒ½æŒ‡å‘å†…å­˜ä½ç½®ã€‚å°†ä¸€ä¸ªå€¼ä»ä¸€ä¸ªå†…å­˜ä½ç½®å¤åˆ¶åˆ°å¦ä¸€ä¸ªå†…å­˜ä½ç½®éœ€è¦ä¸¤ä¸ªæ­¥éª¤ï¼Œç¬¬ä¸€ä¸ªæŒ‡ä»¤å°†æºå€¼åŠ è½½åˆ°å¯„å­˜å™¨ï¼Œç¬¬äºŒæ¡æŒ‡ä»¤å°†è¯¥å¯„å­˜å™¨å†™å…¥ç›®çš„ä½ç½®ã€‚\nexample\n C code\n long exchange(lone *xp, long y){ long x = *xp; *xp = y; return x; }  æ±‡ç¼–ä»£ç \n exchange: movq (%rdi), %rax get x at xp, Set as return value movq %rsi, (%rdi) Store y at xp. ret 2. å‹æ ˆå’Œå‡ºæ ˆ åœ¨x86-64ä¸­ï¼Œç¨‹åºæ ˆå­˜æ”¾åœ¨å†…å­˜ä¸­æŸä¸ªåŒºåŸŸï¼Œæ ˆå‘ä¸‹å¢é•¿ï¼Œè¿™æ ·ï¼Œæ ˆé¡¶å…ƒç´ çš„åœ°å€æ˜¯æ‰€æœ‰æ ˆä¸­å…ƒç´ åœ°å€æœ€ä½çš„ã€‚æ ˆæŒ‡é’ˆ%rspä¿å­˜ç€æ ˆé¡¶å…ƒç´ çš„åœ°å€ã€‚\npushqæŒ‡ä»¤çš„åŠŸèƒ½æ˜¯æŠŠæ•°æ®å‹å…¥åˆ°æ ˆä¸Šï¼Œè€ŒpopqæŒ‡ä»¤æ˜¯å¼¹å‡ºæ•°æ®ã€‚è¿™äº›æŒ‡ä»¤éƒ½åªæœ‰ä¸€ä¸ªæ“ä½œæ•°\u0026ndash;å‹å…¥çš„æ•°æ®æºå’Œå¼¹å‡ºçš„æ•°æ®ç›®çš„ã€‚\nå°†ä¸€ä¸ªå››å­—å€¼å‹å…¥æ ˆä¸­ï¼Œé¦–å…ˆè¦å°†æ ˆæŒ‡é’ˆå‡8ï¼Œç„¶åå†å°†å€¼å†™å…¥åˆ°æ–°çš„æ ˆé¡¶åœ°å€ã€‚å› æ­¤ï¼Œpushq %rbpçš„è¡Œä¸ºç­‰ä»·äºä¸‹é¢ä¸¤æ¡å‘½ä»¤ï¼š\nsubq $8, %rsp Decrement stack pointer movq %rbp, (%rsp) Store %rbp on stack å¼¹å‡ºä¸€ä¸ªå››å­—çš„æ“ä½œåŒ…æ‹¬ä»æ ˆé¡¶ä½ç½®è¯»å‡ºæ•°æ®ï¼Œç„¶åå°†æ ˆæŒ‡é’ˆåŠ 8ï¼Œå› æ­¤ï¼ŒæŒ‡ä»¤popq %raxç­‰ä»·äºä¸‹é¢ä¸¤æ¡æŒ‡ä»¤ï¼š\nmovq (%rsp) , %rax Read %rax from stack addq $8, %rsp Increment stack pointer example 3. ç®—æœ¯å’Œé€»è¾‘æ“ä½œ  æ¯ä¸ªæŒ‡ä»¤ç±»éƒ½æœ‰b, w, l, qè¿™å››ç§ä¸åŒå¤§å°çš„æŒ‡ä»¤\n ç®—æœ¯å’Œé€»è¾‘æ“ä½œæŒ‡ä»¤\n3.1 åŠ è½½æœ‰æ•ˆåœ°å€ åŠ è½½æœ‰æ•ˆåœ°å€ï¼ˆload effective addressï¼‰æŒ‡ä»¤leaqå®é™…ä¸Šæ˜¯movqæŒ‡ä»¤çš„å˜å½¢ã€‚å®ƒçš„æŒ‡ä»¤å½¢å¼æ˜¯ä»å†…å­˜è¯»æ•°æ®åˆ°å¯„å­˜å™¨ï¼Œä½†å®é™…ä¸Šå®ƒæ ¹æœ¬å°±æ²¡æœ‰å¼•ç”¨å†…å­˜ã€‚å®ƒçš„ç¬¬ä¸€ä¸ªæ“ä½œæ•°çœ‹ä¸Šå»æ˜¯ä¸€ä¸ªå†…å­˜å¼•ç”¨ï¼Œä½†è¯¥æŒ‡ä»¤å¹¶ä¸æ˜¯ä»æŒ‡å®šçš„ä½ç½®è¯»å…¥æ•°æ®ï¼Œè€Œæ˜¯å°†æœ‰æ•ˆåœ°å€å†™å…¥åˆ°ç›®çš„æ“ä½œæ•°ã€‚\nleaè¿˜å¯ä»¥ç®€æ´çš„æè¿°æ™®é€šçš„ç®—æœ¯æ“ä½œã€‚ä¾‹å¦‚ï¼Œå¦‚æœå¯„å­˜å™¨%rdxçš„å€¼ä¸ºxï¼Œ é‚£ä¹ˆæŒ‡ä»¤leaq 7(%rdx, %rdx, 4),%raxå°†è®¾ç½®å¯„å­˜å™¨%raxçš„å€¼ä¸º5x+7\nexample\n c code\n long scale(long x, long y, long z){ long t = x + 4 * y + 12 * z; return t; }  æ±‡ç¼–æŒ‡ä»¤\n lone scale(long x, long y, long z) x in %rdi, y in %rsi, z in %rdx scale: leaq (%rdi, %rsi, 4), %rax x + 4 * y leaq (%rdx, %rdx, 2), %rax z + 2 * z = 3 * z leaq (%rax, %rdx, 4), %rax (x+4Ã—y) + 4*(3*z) = x + 4*y + 12*z ret 3.2 ä¸€å…ƒå’ŒäºŒå…ƒæ“ä½œ ä¸Šè¡¨ä¸­çš„ç¬¬äºŒç»„ä¸­çš„æ“ä½œæ˜¯ä¸€å…ƒæ“ä½œï¼Œåªæœ‰ä¸€ä¸ªæ“ä½œæ•°ï¼Œæ—¢æ˜¯æºåˆæ˜¯ç›®çš„ã€‚è¿™ä¸ªæ“ä½œæ•°å¯ä»¥æ˜¯å¯„å­˜å™¨ï¼Œä¹Ÿå¯ä»¥æ˜¯å†…å­˜ä½ç½®ã€‚æ¯”å¦‚è¯´ï¼ŒæŒ‡ä»¤incq (%rsp)ä¼šä½¿æ ˆé¡¶çš„8å­—èŠ‚å…ƒç´ +1.\nç¬¬ä¸‰ç»„æ˜¯äºŒå…ƒæ“ä½œï¼Œå…¶ä¸­ç¬¬äºŒä¸ªæ“ä½œæ•°æ—¢æ˜¯æºåˆæ˜¯ç›®çš„ã€‚ä¸è¿‡ï¼Œè¦æ³¨æ„ï¼Œæºæ“ä½œæ•°æ˜¯ç¬¬ä¸€ä¸ªï¼Œç›®çš„æ“ä½œæ•°æ˜¯ç¬¬äºŒä¸ªï¼Œå¯¹äºä¸å¯äº¤æ¢æ¥è¯´ï¼Œè¿™çœ‹ä¸Šå»å¾ˆå¥‡ç‰¹ã€‚ä¾‹å¦‚ï¼ŒæŒ‡ä»¤subq %rax, %rdxä½¿å¯„å­˜å™¨%rdxçš„å€¼å‡å»%raxä¸­çš„å€¼ã€‚\n3.3 ç§»ä½æ“ä½œ æœ€åä¸€ç»„æ˜¯ç§»ä½æ“ä½œï¼Œå…ˆç»™å‡ºç§»ä½é‡ï¼Œç„¶åç¬¬äºŒé¡¹ç»™å‡ºçš„æ˜¯è¦ç§»ä½çš„æ•°ã€‚å¯ä»¥è¿›è¡Œç®—æœ¯å’Œé€»è¾‘å³ç§»ã€‚ç§»ä½é‡å¯ä»¥æ˜¯ä¸€ä¸ªç«‹å³æ•°ï¼Œæˆ–è€…æ”¾åœ¨å•å­—èŠ‚å¯„å­˜å™¨%clä¸­ã€‚\nå·¦ç§»æŒ‡ä»¤æœ‰ä¸¤ä¸ªåå­—ï¼šsalå’Œshlã€‚äºŒè€…çš„æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯å°†å³è¾¹å¡«ä¸Š0.å³ç§»æŒ‡ä»¤ä¸åŒï¼Œsaræ‰§è¡Œç®—æœ¯ç§»ä½ï¼ˆå¡«ä¸Šç¬¦å·ä½ï¼‰ï¼Œè€Œshræ‰§è¡Œé€»è¾‘ç§»ä½ï¼ˆå¡«ä¸Š0ï¼‰.\n å½“å¯„å­˜å™¨%clçš„åå…­è¿›åˆ¶å€¼ä¸º0xFFæ—¶ï¼ŒæŒ‡ä»¤salbä¼šç§»7ä½ï¼Œsalwä¼šç§»15ä¸ºï¼Œsallä¼šç§»31ä½ï¼Œsalqä¼šç§»63ä½`\n 3.4 ç‰¹æ®Šçš„ç®—æœ¯æ“ä½œ ä¸¤ä¸ª64ä½æœ‰ç¬¦å·æˆ–æ— ç¬¦å·æ•´æ•°ç›¸ä¹˜å¾—åˆ°çš„ä¹˜ç§¯éœ€è¦128ä½æ¥è¡¨ç¤ºã€‚intelæŠŠ16å­—èŠ‚çš„æ•°æˆä¸ºå…«å­—ï¼ˆoct wordï¼‰.\n ç‰¹æ®Šçš„ç®—æœ¯æ“ä½œ\n example: å¦‚ä½•ä»ä¸¤ä¸ªæ— ç¬¦å·64ä½æ•°å­—xå’Œyç”Ÿæˆ128ä½çš„ä¹˜ç§¯\n c code\n #include\u0026lt;inttypes.h\u0026gt; typedef unsigned __int128 uint128_t void store_uprod(uint128_t *dest, uint64_t x, uint64_t y){ *dest = x * (uint128_t) y; }  æ±‡ç¼–ä»£ç \n dest in %rdi, x in %rsi, y in %rdx store_uprod: movq %rsi, %rax copy x to multiplicand mulq %rdx multiply by y movq %rax, (%rdi) store lower 8 bytes at dest movq %rdx, 8(%rdi) store upper 8 bytes at dest+8 ret exampleï¼š å¦‚ä½•å®ç°é™¤æ³•\n c code\n void remdiv(long x, long y, long *qp, long *rp){ long q = x/y; long r = x%y; *qp = q; *rp = r; }  æ±‡ç¼–ä»£ç \n x in %rdi, y in %rsi, qp in %rdx, rp in %rcx remdiv: movq %rdx, %r8 copy qp movq %rdi, %rax mov x to lower 8 bytes of divident cqto idivq %rsi divide by y movq %rax, (%r8) store quotient at qp movq %rdx, (%rcx) store remainder at rp  cqtoæŒ‡ä»¤ä¸éœ€è¦æ“ä½œæ•°ï¼Œå®ƒéšå«è¯»å‡º%raxçš„ç¬¦å·ä½ï¼Œå¹¶å°†å®ƒå¤åˆ¶åˆ°%rdxçš„æ‰€æœ‰ä½\n ","permalink":"http://yangchnet.github.io/Dessert/posts/%E6%B1%87%E7%BC%96/%E5%9F%BA%E6%9C%AC%E8%AE%A1%E7%AE%97%E6%8C%87%E4%BB%A4/","summary":"åŸºæœ¬è®¡ç®—æŒ‡ä»¤  è¿™é‡Œçš„æ±‡ç¼–æŒ‡ä»¤å‡åŸºäºx86-64æ¶æ„\n 0. å…ˆéªŒçŸ¥è¯† 0.1 å¯„å­˜å™¨è®¾ç½® ä¸€ä¸ªx86-64çš„ä¸­å¤®å¤„ç†å•å…ƒåŒ…å«ä¸€ç»„16ä¸ª64ä½é€šç”¨ç›®çš„å¯„å­˜å™¨ã€‚è¿™äº›å¯„å­˜å™¨ç”¨æ¥å­˜å‚¨æ•´æ•°æ•°æ®å’ŒæŒ‡é’ˆã€‚æŒ‡ä»¤å¯ä»¥å¯¹è¿™16ä¸ªå¯„å­˜å™¨çš„ä½ä½å­—èŠ‚ä¸­å­˜æ”¾çš„ä¸åŒå¤§å°çš„æ•°æ®è¿›è¡Œæ“ä½œã€‚å­—èŠ‚çº§æ“ä½œå¯ä»¥è®¿é—®æœ€ä½çš„å­—èŠ‚ï¼Œ16ä½æ“ä½œå¯ä»¥è®¿é—®æœ€ä½çš„2ä¸ªå­—èŠ‚ï¼Œ32ä½æ“ä½œå¯ä»¥è®¿é—®æœ€ä½çš„4ä¸ªå­—èŠ‚ï¼Œè€Œ64ä½æ“ä½œå¯ä»¥è®¿é—®æ•´ä¸ªå¯„å­˜å™¨ã€‚\n3. å¯»å€æ–¹å¼ 1. æ•°æ®ä¼ é€æŒ‡ä»¤ æœ€ç®€å•å½¢å¼çš„æ•°æ®ä¼ é€æŒ‡ä»¤\u0026ndash;movç±»ã€‚è¿™äº›æŒ‡ä»¤æŠŠæ•°æ®ä»æºä½ç½®å¤åˆ¶åˆ°ç›®çš„ä½ç½®ï¼Œä¸åšä»»ä½•å˜åŒ–ã€‚movç±»æŒ‡ä»¤ç”±å››æ¡æŒ‡ä»¤ç»„æˆï¼šmovb, movw, movl,movq.è¿™äº›æŒ‡ä»¤éƒ½æ‰§è¡Œç›¸åŒçš„æ“ä½œï¼ŒåŒºåˆ«åœ¨äºå®ƒä»¬æ“ä½œçš„æ•°æ®å¤§å°ä¸åŒï¼šåˆ†åˆ«æ˜¯1ï¼Œ2ï¼Œ4ï¼Œ8å­—èŠ‚ã€‚\n ç”±äºå†å²åŸå› ï¼ŒIntelå¤„ç†å™¨å°†16ä½ä½œä¸ºä¸€ä¸ªå­—ï¼ˆwï¼‰ï¼Œ8ä½ä¸ºä¸€ä¸ªå­—èŠ‚(b)ï¼Œ32ä½ä¸ºåŒå­—(l),64ä½ä¸º4å­—ï¼ˆqï¼‰\n    æŒ‡ä»¤ æ•ˆæœ æè¿°     MOV S D D \u0026lt;- S ä¼ é€   movb  ä¼ é€å­—èŠ‚   movw  ä¼ é€å­—   movl  ä¼ é€åŒå­—   movq  ä¼ é€å››å­—   movabsq I, R  ä¼ é€ç»å¯¹çš„å››å­—    ä¼ é€æŒ‡ä»¤çš„ä¸¤ä¸ªæ“ä½œæ•°ä¸èƒ½éƒ½æŒ‡å‘å†…å­˜ä½ç½®ã€‚å°†ä¸€ä¸ªå€¼ä»ä¸€ä¸ªå†…å­˜ä½ç½®å¤åˆ¶åˆ°å¦ä¸€ä¸ªå†…å­˜ä½ç½®éœ€è¦ä¸¤ä¸ªæ­¥éª¤ï¼Œç¬¬ä¸€ä¸ªæŒ‡ä»¤å°†æºå€¼åŠ è½½åˆ°å¯„å­˜å™¨ï¼Œç¬¬äºŒæ¡æŒ‡ä»¤å°†è¯¥å¯„å­˜å™¨å†™å…¥ç›®çš„ä½ç½®ã€‚\nexample\n C code","title":"åŸºæœ¬è®¡ç®—æŒ‡ä»¤"},{"content":"å¤„ç†æ–‡æœ¬æ•°æ® 1. å•è¯å’Œå­—ç¬¦çš„one-hotç¼–ç  one-hotç¼–ç æ˜¯å°†æ ‡è®°è½¬æ¢ä¸ºå‘é‡çš„æœ€å¸¸ç”¨ï¼Œæœ€åŸºæœ¬çš„æ–¹æ³•ã€‚å®ƒå°†æ¯ä¸ªå•è¯ä¸ä¸€ä¸ªå”¯ä¸€çš„æ•´æ•°ç´¢å¼•ç›¸å…³è”ï¼Œç„¶åå°†è¿™ä¸ªæ•´æ•°ç´¢å¼•iè½¬æ¢ä¸ºé•¿åº¦ä¸ºNçš„äºŒè¿›åˆ¶å‘é‡ï¼ˆNæ˜¯è¯è¡¨å¤§å°ï¼‰ï¼Œè¿™ä¸ªå‘é‡åªæœ‰ç¬¬iä¸ªå…ƒç´ æ˜¯1ï¼Œå…¶ä½™å…ƒç´ éƒ½æ˜¯0.\nå½“ç„¶ï¼Œä¹Ÿå¯ä»¥è¿›è¡Œå­—ç¬¦çº§çš„one-hotç¼–ç ã€‚\n1.1. å•è¯çº§çš„one-hotç¼–ç  import numpy as np samples = [\u0026#39;The cat sat on the mat.\u0026#39;, \u0026#39;The dog ate my homework.\u0026#39;] token_index = {} for sample in samples: for word in sample.split(): if word not in token_index: token_index[word] = len(token_index) + 1 # ä¸ºæ¯ä¸ªå”¯ä¸€å•è¯æŒ‡å®šä¸€ä¸ªå”¯ä¸€ç´¢å¼•ï¼Œæ²¡æœ‰ä¸º0ç´¢å¼•æŒ‡å®šå•è¯ max_length = 10 results = np.zeros(shape=(len(samples), max_length, max(token_index.values())+1)) for i, sample in enumerate(samples): for j, word in list(enumerate(sample.split()))[:max_length]: index = token_index.get(word) results[i, j, index] = 1 results array([[[0., 1., 0., 0., 0., 0., 0., 0., 0., 0., 0.], [0., 0., 1., 0., 0., 0., 0., 0., 0., 0., 0.], [0., 0., 0., 1., 0., 0., 0., 0., 0., 0., 0.], [0., 0., 0., 0., 1., 0., 0., 0., 0., 0., 0.], [0., 0., 0., 0., 0., 1., 0., 0., 0., 0., 0.], [0., 0., 0., 0., 0., 0., 1., 0., 0., 0., 0.], [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.], [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.], [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.], [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.]], [[0., 1., 0., 0., 0., 0., 0., 0., 0., 0., 0.], [0., 0., 0., 0., 0., 0., 0., 1., 0., 0., 0.], [0., 0., 0., 0., 0., 0., 0., 0., 1., 0., 0.], [0., 0., 0., 0., 0., 0., 0., 0., 0., 1., 0.], [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 1.], [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.], [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.], [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.], [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.], [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.]]])  1.2. å­—ç¬¦çº§çš„one-hotç¼–ç  import string samples = [\u0026#39;The cat sat on the mat.\u0026#39;, \u0026#39;The dog ate my homework.\u0026#39;] characters = string.printable # å¯æ‰“å°çš„æ‰€æœ‰å­—ç¬¦ï¼Œå…±101ä¸ª token_index = dict(zip(range(1, len(characters) + 1), characters)) max_length = 50 results = np.zeros((len(samples), max_length, max(token_index.keys()) + 1)) for i, sample in enumerate(samples): for j, character in enumerate(sample): index = token_index.get(character) results[i, j, index] = 1 results.shape (2, 50, 101)  1.3. ä½¿ç”¨kerasçš„å†…ç½®å‡½æ•°å®ç°one-hotç¼–ç  Kerasçš„å†…ç½®å‡½æ•°å¯ä»¥å¯¹åŸå§‹æ–‡æœ¬æ•°æ®è¿›è¡Œå•è¯çº§æˆ–å­—ç¬¦çº§çš„one-hotç¼–ç ã€‚æˆ‘ä»¬åº”è¯¥ä½¿ç”¨è¿™äº›å‡½æ•°ï¼Œå®ƒä»¬å®ç°äº†è®¸å¤šé‡è¦çš„ç‰¹æ€§ï¼Œæ¯”å¦‚ä»å­—ç¬¦ä¸²ä¸­å»é™¤ç‰¹æ®Šå­—ç¬¦ã€åªè€ƒè™‘æ•°æ®é›†ä¸­å‰Nä¸ªå¸¸è§çš„å•è¯ç­‰ã€‚\nfrom keras.preprocessing.text import Tokenizer samples = [\u0026#39;The cat sat on the mat.\u0026#39;, \u0026#39;The dog ate my homework.\u0026#39;] tokenizer = Tokenizer(num_words=1000) # åˆ›å»ºä¸€ä¸ªåˆ†è¯å™¨ï¼Œåªè€ƒè™‘å‰1000ä¸ªå•è¯ tokenizer.fit_on_texts(samples) sequences = tokenizer.texts_to_sequences(samples) # å°†å­—ç¬¦ä¸²è½¬åŒ–ä¸ºæ•´æ•°ç´¢å¼•æ„å»ºçš„åˆ—è¡¨ one_hot_results = tokenizer.texts_to_matrix(samples, mode=\u0026#39;binary\u0026#39;) word_index = tokenizer.word_index # æ‰¾å›å•è¯ç´¢å¼• print(\u0026#39;Found %sunique tokens.\u0026#39; % len(word_index)) one_hot_results.shape Found 9 unique tokens. (2, 1000)  1.4. one-hotæ•£åˆ—æŠ€å·§ æ‰€è°“çš„one-hotæ•£åˆ—æŠ€å·§æ˜¯one-hotç¼–ç çš„ä¸€ç§å˜ä½“ï¼Œå¦‚æœè¯è¡¨ä¸­å”¯ä¸€æ ‡è®°çš„æ•°é‡å¤ªå¤§è€Œæ— æ³•ç›´æ¥å¤„ç†ï¼Œå°±å¯ä»¥ä½¿ç”¨è¿™ç§æŠ€å·§ã€‚è¿™ç§æ–¹æ³•æ²¡æœ‰ä¸ºæ¯ä¸ªå•è¯æ˜¾å¼åˆ†é…ä¸€ä¸ªç´¢å¼•å¹¶å°†è¿™äº›ç´¢å¼•ä¿å­˜åœ¨ä¸€ä¸ªå­—å…¸ä¸­ï¼Œè€Œæ˜¯å°†å•è¯æ•£åˆ—ç¼–ç ä¸ºå›ºå®šé•¿åº¦çš„å‘é‡ï¼Œé€šå¸¸ç”¨ä¸€ä¸ªéå¸¸ç®€å•çš„æ•£åˆ—å‡½æ•°æ¥å®ç°ã€‚è¿™ç§æ–¹æ³•çš„ä¸»è¦ä¼˜ç‚¹åœ¨äºï¼Œå®ƒé¿å…äº†ç»´æŠ¤ä¸€ä¸ªæ˜¾å¼çš„å•è¯ç´¢å¼•ï¼Œä»è€ŒèŠ‚çœå†…å­˜å¹¶å…è®¸æ•°æ®çš„åœ¨çº¿ç¼–ç ï¼ˆåœ¨è¯»å–å®Œæ‰€æœ‰æ•°æ®ä¹‹å‰ï¼Œä½ å°±å¯ä»¥ç«‹åˆ»ç”Ÿæˆæ ‡è®°å‘é‡ï¼‰ã€‚\nè¿™ç§æ–¹æ³•æœ‰ä¸ªç¼ºç‚¹ï¼Œå°±æ˜¯å¯èƒ½ä¼šå‡ºç°æ•£åˆ—å†²çªï¼Œå³ä¸¤ä¸ªä¸åŒçš„å•è¯å¯èƒ½å…·æœ‰ç›¸åŒçš„æ•£åˆ—å€¼ï¼Œéšåä»»ä½•æœºå™¨å­¦ä¹ æ¨¡å‹è§‚å¯Ÿè¿™äº›æ•£åˆ—å€¼ï¼Œéƒ½æ— æ³•åŒºåˆ†å®ƒä»¬å¯¹åº”çš„å•è¯ã€‚å¦‚æœæ•£åˆ—ç©ºé—´çš„ç»´åº¦è¿œå¤§äºéœ€è¦æ•£åˆ—çš„å”¯ä¸€æ ‡è®°çš„ä¸ªæ•°ï¼Œæ•£åˆ—å†²çªçš„å¯èƒ½æ€§ä¼šå‡å°ã€‚\n# ä½¿ç”¨æ•£åˆ—æŠ€å·§çš„å•è¯çº§çš„one-hotç¼–ç  samples = [\u0026#39;The cat sat on the mat.\u0026#39;, \u0026#39;The dog ate my homework.\u0026#39;] dimensionality = 1000 max_length = 10 results = np.zeros((len(samples), max_length, dimensionality)) for i, sample in enumerate(samples): for j, word in list(enumerate(sample.split()))[:max_length]: index = abs(hash(word)) % dimensionality # å°†å•è¯æ•£åˆ—ä¸º0-1000èŒƒå›´å†…çš„ä¸€ä¸ªéšæœºæ•´æ•°ç´¢å¼•ã€‚ results[i, j, index] = 1 results.shape (2, 10, 1000)  2. ä½¿ç”¨è¯åµŒå…¥ å¯†é›†çš„è¯å‘é‡ï¼Œä¹Ÿå«è¯åµŒå…¥ã€‚one-hotç¼–ç å¾—åˆ°çš„å‘é‡æ˜¯äºŒè¿›åˆ¶çš„ã€ç¨€ç–çš„ï¼ˆç»å¤§éƒ¨åˆ†å…ƒç´ éƒ½æ˜¯0ï¼‰ç»´åº¦å¾ˆé«˜çš„ï¼ˆç»´åº¦å¤§å°ç­‰äºè¯è¡¨ä¸­çš„å•è¯ä¸ªæ•°ï¼‰ï¼Œè€Œè¯åµŒå…¥æ˜¯ä½ç»´çš„æµ®ç‚¹æ•°å‘é‡ï¼ˆå³å¯†é›†å‘é‡ã€ä¸ç¨€ç–å‘é‡ç›¸å¯¹ï¼‰ã€‚ä¸one-hotç¼–ç å¾—åˆ°çš„è¯å‘é‡ä¸åŒï¼Œè¯åµŒå…¥æ˜¯ä»æ•°æ®ä¸­å­¦ä¹ å¾—åˆ°çš„ã€‚å¸¸è§çš„è¯å‘é‡ç»´åº¦æ˜¯256ï¼Œ 512æˆ–1024ï¼ˆå¤„ç†éå¸¸å¤§çš„è¯è¡¨æ—¶ï¼‰ã€‚äºæ­¤ç›¸å¯¹ï¼Œone-hotç¼–ç çš„è¯å‘é‡ç»´åº¦é€šå¸¸ä¸º20000æˆ–æ›´é«˜ï¼ˆå¯¹åº”åŒ…å«20000ä¸ªæ ‡è®°çš„è¯è¡¨ï¼‰ï¼Œå› æ­¤è¯å‘é‡å¯ä»¥å°†æ›´å¤šçš„ä¿¡æ¯å¡å…¥æ›´ä½çš„ç»´åº¦ä¸­\nè·å–è¯åµŒå…¥æœ‰ä¸¤ç§æ–¹æ³•:\n åœ¨å®Œæˆä¸»ä»»åŠ¡ï¼ˆæ¯”å¦‚æ–‡æ¡£åˆ†ç±»æˆ–æƒ…æ„Ÿé¢„æµ‹ï¼‰çš„åŒæ—¶å­¦ä¹ è¯åµŒå…¥ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸€å¼€å§‹æ˜¯éšæœºçš„è¯å‘é‡ï¼Œç„¶åå¯¹è¿™äº›è¯å‘é‡è¿›è¡Œå­¦ä¹ ï¼Œå…¶å­¦ä¹ æ–¹å¼ä¸å­¦ä¹ ç¥ç»ç½‘ç»œçš„æƒé‡ç›¸åŒã€‚ åœ¨ä¸åŒäºå¾…è§£å†³é—®é¢˜çš„æœºå™¨å­¦ä¹ ä»»åŠ¡ä¸Šé¢„è®¡ç®—å¥½è¯åµŒå…¥ï¼Œç„¶åå°†å…¶åŠ è½½åˆ°æ¨¡å‹ä¸­ã€‚è¿™äº›è¯åµŒå…¥å«åšé¢„è®­ç»ƒè¯åµŒå…¥  2.1. åˆ©ç”¨Embeddingå±‚å­¦ä¹ è¯åµŒå…¥ è¦å°†ä¸€ä¸ªè¯ä¸ä¸€ä¸ªå¯†é›†å‘é‡ç›¸å…³è”ï¼Œæœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯éšæœºé€‰æ‹©å‘é‡ã€‚è¿™ç§æ–¹æ³•çš„é—®é¢˜åœ¨äºï¼Œå¾—åˆ°çš„åµŒå…¥ç©ºé—´æ²¡æœ‰ä»»ä½•ç»“æ„ã€‚è¯´çš„æ›´æŠ½è±¡ä¸€ç‚¹ï¼Œè¯å‘é‡ä¹‹é—´çš„å‡ ä½•å…³ç³»åº”è¯¥è¡¨ç¤ºè¿™äº›è¯ä¹‹é—´çš„è¯­ä¹‰å…³ç³»ã€‚è¯åµŒå…¥çš„ä½œç”¨åº”è¯¥æ˜¯å°†äººç±»çš„è¯­è¨€æ˜ å°„åˆ°å‡ ä½•ç©ºé—´ä¸­ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªåˆç†çš„åµŒå…¥ç©ºé—´ä¸­ï¼ŒåŒä¹‰è¯åº”è¯¥è¢«åµŒå…¥åˆ°ç›¸ä¼¼çš„è¯å‘é‡ä¸­ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œä»»æ„ä¸¤ä¸ªè¯å‘é‡ä¹‹é—´çš„å‡ ä½•è·ç¦»ï¼ˆæ¯”å¦‚L2è·ç¦»ï¼‰åº”è¯¥å’Œè¿™ä¸¤ä¸ªè¯çš„è¯­ä¹‰è·ç¦»æœ‰å…³ã€‚.\nä¸€ä¸ªå¥½çš„è¯åµŒå…¥ç©ºé—´åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºä½ çš„ä»»åŠ¡ï¼ŒæŸäº›è¯­ä¹‰å…³ç³»çš„é‡è¦æ€§å› ä»»åŠ¡è€Œå¼‚ã€‚å› æ­¤ï¼Œåˆç†çš„åšæ³•æ˜¯å¯¹æ¯ä¸ªæ–°ä»»åŠ¡éƒ½å­¦ä¹ ä¸€ä¸ªæ–°çš„åµŒå…¥ç©ºé—´ã€‚\n# å°†ä¸€ä¸ªEmbedding å±‚å®ä¾‹åŒ– from keras.layers import Embedding embedding_layer = Embedding(1000, 64) #(æ ‡è®°çš„ä¸ªæ•°ï¼Œ åµŒå…¥çš„ç»´åº¦) å¯ä»¥å°†Embeddingå±‚ç†è§£ä¸ºä¸€ä¸ªå­—å…¸ï¼Œå°†æ•´æ•°ç´¢å¼•ï¼ˆè¡¨ç¤ºç‰¹å®šå•è¯ï¼‰æ˜ å°„ä¸ºå¯†é›†å‘é‡ã€‚å®ƒæ¥æ”¶æ•´æ•°ä½œä¸ºè¾“å…¥ï¼Œå¹¶åœ¨å†…éƒ¨å­—å…¸ä¸­æŸ¥æ‰¾è¿™äº›æ•´æ•°ï¼Œç„¶åè¿”å›ç›¸å…³è”çš„å‘é‡ã€‚Embeddingå®é™…ä¸Šæ˜¯ä¸€ç§å­—å…¸æŸ¥æ‰¾ã€‚\n# åŠ è½½IMDBæ•°æ®ï¼Œå‡†å¤‡ç”¨äºEmbeddingå±‚ from keras.datasets import imdb from keras import preprocessing max_features = 10000 #ä½œä¸ºç‰¹å¾çš„å•è¯ä¸ªæ•° maxlen = 20 # è¿™ä¹ˆå¤šå•è¯åæˆªæ–­æ–‡æœ¬ # å°†æ•°æ®åŠ è½½ä¸ºæ•´æ•°åˆ—è¡¨ (x_train, y_train), (x_test, y_test) = imdb.load_data(num_words=max_features) x_train[0:2] array([list([1, 14, 22, 16, 43, 530, 973, 1622, 1385, 65, 458, 4468, 66, 3941, 4, 173, 36, 256, 5, 25, 100, 43, 838, 112, 50, 670, 2, 9, 35, 480, 284, 5, 150, 4, 172, 112, 167, 2, 336, 385, 39, 4, 172, 4536, 1111, 17, 546, 38, 13, 447, 4, 192, 50, 16, 6, 147, 2025, 19, 14, 22, 4, 1920, 4613, 469, 4, 22, 71, 87, 12, 16, 43, 530, 38, 76, 15, 13, 1247, 4, 22, 17, 515, 17, 12, 16, 626, 18, 2, 5, 62, 386, 12, 8, 316, 8, 106, 5, 4, 2223, 5244, 16, 480, 66, 3785, 33, 4, 130, 12, 16, 38, 619, 5, 25, 124, 51, 36, 135, 48, 25, 1415, 33, 6, 22, 12, 215, 28, 77, 52, 5, 14, 407, 16, 82, 2, 8, 4, 107, 117, 5952, 15, 256, 4, 2, 7, 3766, 5, 723, 36, 71, 43, 530, 476, 26, 400, 317, 46, 7, 4, 2, 1029, 13, 104, 88, 4, 381, 15, 297, 98, 32, 2071, 56, 26, 141, 6, 194, 7486, 18, 4, 226, 22, 21, 134, 476, 26, 480, 5, 144, 30, 5535, 18, 51, 36, 28, 224, 92, 25, 104, 4, 226, 65, 16, 38, 1334, 88, 12, 16, 283, 5, 16, 4472, 113, 103, 32, 15, 16, 5345, 19, 178, 32]), list([1, 194, 1153, 194, 8255, 78, 228, 5, 6, 1463, 4369, 5012, 134, 26, 4, 715, 8, 118, 1634, 14, 394, 20, 13, 119, 954, 189, 102, 5, 207, 110, 3103, 21, 14, 69, 188, 8, 30, 23, 7, 4, 249, 126, 93, 4, 114, 9, 2300, 1523, 5, 647, 4, 116, 9, 35, 8163, 4, 229, 9, 340, 1322, 4, 118, 9, 4, 130, 4901, 19, 4, 1002, 5, 89, 29, 952, 46, 37, 4, 455, 9, 45, 43, 38, 1543, 1905, 398, 4, 1649, 26, 6853, 5, 163, 11, 3215, 2, 4, 1153, 9, 194, 775, 7, 8255, 2, 349, 2637, 148, 605, 2, 8003, 15, 123, 125, 68, 2, 6853, 15, 349, 165, 4362, 98, 5, 4, 228, 9, 43, 2, 1157, 15, 299, 120, 5, 120, 174, 11, 220, 175, 136, 50, 9, 4373, 228, 8255, 5, 2, 656, 245, 2350, 5, 4, 9837, 131, 152, 491, 18, 2, 32, 7464, 1212, 14, 9, 6, 371, 78, 22, 625, 64, 1382, 9, 8, 168, 145, 23, 4, 1690, 15, 16, 4, 1355, 5, 28, 6, 52, 154, 462, 33, 89, 78, 285, 16, 145, 95])], dtype=object)  #å°†æ•´æ•°åˆ—è¡¨è½¬æ¢æˆå½¢çŠ¶ä¸ºï¼ˆsamples, maxlenï¼‰çš„äºŒç»´æ•´æ•°å¼ é‡ x_train = preprocessing.sequence.pad_sequences(x_train, maxlen=maxlen) x_test = preprocessing.sequence.pad_sequences(x_test, maxlen=maxlen) x_train[0:2] array([[ 65, 16, 38, 1334, 88, 12, 16, 283, 5, 16, 4472, 113, 103, 32, 15, 16, 5345, 19, 178, 32], [ 23, 4, 1690, 15, 16, 4, 1355, 5, 28, 6, 52, 154, 462, 33, 89, 78, 285, 16, 145, 95]], dtype=int32)  y_train.shape (25000,)  # åœ¨IMDBæ•°æ®é›†ä¸Šä½¿ç”¨Embeddingå±‚å’Œåˆ†ç±»å™¨ from keras.models import Sequential from keras.layers import Flatten, Dense, Embedding model = Sequential() model.add(Embedding(10000, 8, input_length=maxlen)) model.add(Flatten()) model.add(Dense(1, activation=\u0026#39;sigmoid\u0026#39;)) model.compile(optimizer=\u0026#39;rmsprop\u0026#39;, loss=\u0026#39;binary_crossentropy\u0026#39;, metrics=[\u0026#39;acc\u0026#39;]) model.summary() history = model.fit(x_train, y_train, epochs=10, batch_size=32, validation_split=0.2) Model: \u0026quot;sequential_2\u0026quot; _________________________________________________________________ Layer (type) Output Shape Param # ================================================================= embedding_3 (Embedding) (None, 20, 8) 80000 _________________________________________________________________ flatten_2 (Flatten) (None, 160) 0 _________________________________________________________________ dense_1 (Dense) (None, 1) 161 ================================================================= Total params: 80,161 Trainable params: 80,161 Non-trainable params: 0 _________________________________________________________________ /usr/lib/python3.7/site-packages/tensorflow/python/ops/gradients_util.py:93: UserWarning: Converting sparse IndexedSlices to a dense Tensor of unknown shape. This may consume a large amount of memory. \u0026quot;Converting sparse IndexedSlices to a dense Tensor of unknown shape. \u0026quot; Train on 20000 samples, validate on 5000 samples Epoch 1/10 20000/20000 [==============================] - 3s 146us/step - loss: 0.6799 - acc: 0.5913 - val_loss: 0.6468 - val_acc: 0.6846 Epoch 2/10 20000/20000 [==============================] - 2s 103us/step - loss: 0.5643 - acc: 0.7456 - val_loss: 0.5399 - val_acc: 0.7220 Epoch 3/10 20000/20000 [==============================] - 2s 97us/step - loss: 0.4697 - acc: 0.7858 - val_loss: 0.5068 - val_acc: 0.7436 Epoch 4/10 20000/20000 [==============================] - 2s 100us/step - loss: 0.4239 - acc: 0.8084 - val_loss: 0.4975 - val_acc: 0.7500 Epoch 5/10 20000/20000 [==============================] - 2s 98us/step - loss: 0.3931 - acc: 0.8238 - val_loss: 0.4984 - val_acc: 0.7560 Epoch 6/10 20000/20000 [==============================] - 2s 97us/step - loss: 0.3684 - acc: 0.8400 - val_loss: 0.4990 - val_acc: 0.7558 Epoch 7/10 20000/20000 [==============================] - 2s 115us/step - loss: 0.3462 - acc: 0.8519 - val_loss: 0.5049 - val_acc: 0.7554 Epoch 8/10 20000/20000 [==============================] - 2s 97us/step - loss: 0.3268 - acc: 0.8640 - val_loss: 0.5121 - val_acc: 0.7556 Epoch 9/10 20000/20000 [==============================] - 2s 98us/step - loss: 0.3082 - acc: 0.8734 - val_loss: 0.5203 - val_acc: 0.7528 Epoch 10/10 20000/20000 [==============================] - 2s 102us/step - loss: 0.2905 - acc: 0.8841 - val_loss: 0.5298 - val_acc: 0.7506  2.2. ä½¿ç”¨é¢„è®­ç»ƒçš„è¯åµŒå…¥ ","permalink":"http://yangchnet.github.io/Dessert/posts/dlml/%E5%A4%84%E7%90%86%E6%96%87%E6%9C%AC%E6%95%B0%E6%8D%AE/","summary":"å¤„ç†æ–‡æœ¬æ•°æ® 1. å•è¯å’Œå­—ç¬¦çš„one-hotç¼–ç  one-hotç¼–ç æ˜¯å°†æ ‡è®°è½¬æ¢ä¸ºå‘é‡çš„æœ€å¸¸ç”¨ï¼Œæœ€åŸºæœ¬çš„æ–¹æ³•ã€‚å®ƒå°†æ¯ä¸ªå•è¯ä¸ä¸€ä¸ªå”¯ä¸€çš„æ•´æ•°ç´¢å¼•ç›¸å…³è”ï¼Œç„¶åå°†è¿™ä¸ªæ•´æ•°ç´¢å¼•iè½¬æ¢ä¸ºé•¿åº¦ä¸ºNçš„äºŒè¿›åˆ¶å‘é‡ï¼ˆNæ˜¯è¯è¡¨å¤§å°ï¼‰ï¼Œè¿™ä¸ªå‘é‡åªæœ‰ç¬¬iä¸ªå…ƒç´ æ˜¯1ï¼Œå…¶ä½™å…ƒç´ éƒ½æ˜¯0.\nå½“ç„¶ï¼Œä¹Ÿå¯ä»¥è¿›è¡Œå­—ç¬¦çº§çš„one-hotç¼–ç ã€‚\n1.1. å•è¯çº§çš„one-hotç¼–ç  import numpy as np samples = [\u0026#39;The cat sat on the mat.\u0026#39;, \u0026#39;The dog ate my homework.\u0026#39;] token_index = {} for sample in samples: for word in sample.split(): if word not in token_index: token_index[word] = len(token_index) + 1 # ä¸ºæ¯ä¸ªå”¯ä¸€å•è¯æŒ‡å®šä¸€ä¸ªå”¯ä¸€ç´¢å¼•ï¼Œæ²¡æœ‰ä¸º0ç´¢å¼•æŒ‡å®šå•è¯ max_length = 10 results = np.zeros(shape=(len(samples), max_length, max(token_index.values())+1)) for i, sample in enumerate(samples): for j, word in list(enumerate(sample.split()))[:max_length]: index = token_index.get(word) results[i, j, index] = 1 results array([[[0.","title":"å¤„ç†æ–‡æœ¬æ•°æ®"},{"content":"å¤šè¾“å…¥æ¨¡å‹ å‡½æ•°å¼APIå¯ä»¥ç”¨äºæ„å»ºå…·æœ‰å¤šä¸ªè¾“å…¥çš„æ¨¡å‹ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œè¿™ç§æ¨¡å‹ä¼šåœ¨æŸä¸€æ—¶åˆ»ç”¨ä¸€ä¸ªå¯ä»¥ç»„åˆå¤šä¸ªå¼ é‡çš„å±‚å°†ä¸åŒçš„è¾“å…¥åˆ†æ”¯åˆå¹¶ï¼Œå¼ é‡ç»„åˆæ–¹å¼å¯èƒ½æ˜¯ç›¸åŠ ï¼Œè¿æ¥ç­‰ã€‚è¿™é€šå¸¸åˆ©ç”¨Kerasçš„åˆå¹¶è¿ç®—æ¥å®ç°ï¼Œæ¯”å¦‚keras.layers.add, keras.layers.concatenateç­‰ã€‚\nä¸‹é¢æ¥çœ‹ä¸€ä¸ªéå¸¸ç®€å•çš„å¤šè¾“å…¥æ¨¡å‹ç¤ºä¾‹ï¼šä¸€ä¸ªé—®ç­”æ¨¡å‹\nå…¸å‹çš„é—®ç­”æ¨¡å‹æœ‰ä¸¤ä¸ªè¾“å…¥ï¼Œä¸€ä¸ªè‡ªç„¶è¯­è¨€æè¿°çš„é—®é¢˜å’Œä¸€ä¸ªæ–‡æœ¬ç‰‡æ®µï¼ˆæ¯”å¦‚æ–°é—»æ–‡ç« ï¼‰ï¼Œåè€…æä¾›ç”¨äºå›ç­”é—®é¢˜çš„ä¿¡æ¯ã€‚ç„¶åæ¨¡å‹è¦ç”Ÿæˆä¸€ä¸ªå›ç­”ï¼Œåœ¨æœ€ç®€å•çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªå›ç­”åªåŒ…å«ä¸€ä¸ªè¯ï¼Œå¯ä»¥é€šè¿‡å¯¹æŸä¸ªé¢„å®šä¹‰çš„è¯è¡¨åšsoftmaxå¾—åˆ°ã€‚\n# å…·æœ‰ä¸¤ä¸ªè¾“å…¥çš„æ¨¡å‹ from keras.models import Model from keras import layers from keras import Input text_vocabulary_size = 10000 question_vocabulary_size = 10000 answer_vocabulary_size = 500 text_input = Input(shape=(None, ), dtype=\u0026#39;int32\u0026#39;, name=\u0026#39;text\u0026#39;) embedded_text = layers.Embedding( text_vocabulary_size, 64) (text_input) # å°†è¾“å…¥åµŒå…¥åˆ°é•¿åº¦ä¸º64çš„å‘é‡ encoded_text = layers.LSTM(32)(embedded_text) # å¯¹é—®é¢˜è¿›è¡Œç›¸åŒçš„å¤„ç†ï¼Œä½¿ç”¨ä¸åŒçš„å±‚å®ä¾‹ question_input = Input(shape=(None, ), dtype=\u0026#39;int32\u0026#39;, name=\u0026#39;question\u0026#39;) embedded_question = layers.Embedding( question_vocabulary_size, 32)(question_input) encoded_question = layers.LSTM(16)(embedded_question) # å°†ç¼–ç åçš„é—®é¢˜å’Œæ–‡æœ¬è¿æ¥èµ·æ¥ concatenated = layers.concatenate([encoded_text, encoded_question], axis=-1) # åœ¨ä¸Šé¢æ·»åŠ ä¸€ä¸ªsoftmaxåˆ†ç±»å™¨ answer = layers.Dense(answer_vocabulary_size, activation=\u0026#39;softmax\u0026#39;)(concatenated) model = Model([text_input, question_input], answer) model.compile(optimizer=\u0026#39;rmsprop\u0026#39;, loss=\u0026#39;categorical_crossentropy\u0026#39;, metrics=[\u0026#39;acc\u0026#39;]) Using TensorFlow backend. /usr/lib/python3.7/site-packages/tensorflow/python/framework/dtypes.py:523: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'. _np_qint8 = np.dtype([(\u0026quot;qint8\u0026quot;, np.int8, 1)]) /usr/lib/python3.7/site-packages/tensorflow/python/framework/dtypes.py:524: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'. _np_quint8 = np.dtype([(\u0026quot;quint8\u0026quot;, np.uint8, 1)]) /usr/lib/python3.7/site-packages/tensorflow/python/framework/dtypes.py:525: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'. _np_qint16 = np.dtype([(\u0026quot;qint16\u0026quot;, np.int16, 1)]) /usr/lib/python3.7/site-packages/tensorflow/python/framework/dtypes.py:526: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'. _np_quint16 = np.dtype([(\u0026quot;quint16\u0026quot;, np.uint16, 1)]) /usr/lib/python3.7/site-packages/tensorflow/python/framework/dtypes.py:527: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'. _np_qint32 = np.dtype([(\u0026quot;qint32\u0026quot;, np.int32, 1)]) /usr/lib/python3.7/site-packages/tensorflow/python/framework/dtypes.py:532: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'. np_resource = np.dtype([(\u0026quot;resource\u0026quot;, np.ubyte, 1)])  ","permalink":"http://yangchnet.github.io/Dessert/posts/dlml/%E5%A4%9A%E8%BE%93%E5%85%A5%E6%A8%A1%E5%9E%8B/","summary":"å¤šè¾“å…¥æ¨¡å‹ å‡½æ•°å¼APIå¯ä»¥ç”¨äºæ„å»ºå…·æœ‰å¤šä¸ªè¾“å…¥çš„æ¨¡å‹ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œè¿™ç§æ¨¡å‹ä¼šåœ¨æŸä¸€æ—¶åˆ»ç”¨ä¸€ä¸ªå¯ä»¥ç»„åˆå¤šä¸ªå¼ é‡çš„å±‚å°†ä¸åŒçš„è¾“å…¥åˆ†æ”¯åˆå¹¶ï¼Œå¼ é‡ç»„åˆæ–¹å¼å¯èƒ½æ˜¯ç›¸åŠ ï¼Œè¿æ¥ç­‰ã€‚è¿™é€šå¸¸åˆ©ç”¨Kerasçš„åˆå¹¶è¿ç®—æ¥å®ç°ï¼Œæ¯”å¦‚keras.layers.add, keras.layers.concatenateç­‰ã€‚\nä¸‹é¢æ¥çœ‹ä¸€ä¸ªéå¸¸ç®€å•çš„å¤šè¾“å…¥æ¨¡å‹ç¤ºä¾‹ï¼šä¸€ä¸ªé—®ç­”æ¨¡å‹\nå…¸å‹çš„é—®ç­”æ¨¡å‹æœ‰ä¸¤ä¸ªè¾“å…¥ï¼Œä¸€ä¸ªè‡ªç„¶è¯­è¨€æè¿°çš„é—®é¢˜å’Œä¸€ä¸ªæ–‡æœ¬ç‰‡æ®µï¼ˆæ¯”å¦‚æ–°é—»æ–‡ç« ï¼‰ï¼Œåè€…æä¾›ç”¨äºå›ç­”é—®é¢˜çš„ä¿¡æ¯ã€‚ç„¶åæ¨¡å‹è¦ç”Ÿæˆä¸€ä¸ªå›ç­”ï¼Œåœ¨æœ€ç®€å•çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªå›ç­”åªåŒ…å«ä¸€ä¸ªè¯ï¼Œå¯ä»¥é€šè¿‡å¯¹æŸä¸ªé¢„å®šä¹‰çš„è¯è¡¨åšsoftmaxå¾—åˆ°ã€‚\n# å…·æœ‰ä¸¤ä¸ªè¾“å…¥çš„æ¨¡å‹ from keras.models import Model from keras import layers from keras import Input text_vocabulary_size = 10000 question_vocabulary_size = 10000 answer_vocabulary_size = 500 text_input = Input(shape=(None, ), dtype=\u0026#39;int32\u0026#39;, name=\u0026#39;text\u0026#39;) embedded_text = layers.Embedding( text_vocabulary_size, 64) (text_input) # å°†è¾“å…¥åµŒå…¥åˆ°é•¿åº¦ä¸º64çš„å‘é‡ encoded_text = layers.LSTM(32)(embedded_text) # å¯¹é—®é¢˜è¿›è¡Œç›¸åŒçš„å¤„ç†ï¼Œä½¿ç”¨ä¸åŒçš„å±‚å®ä¾‹ question_input = Input(shape=(None, ), dtype=\u0026#39;int32\u0026#39;, name=\u0026#39;question\u0026#39;) embedded_question = layers.Embedding( question_vocabulary_size, 32)(question_input) encoded_question = layers.LSTM(16)(embedded_question) # å°†ç¼–ç åçš„é—®é¢˜å’Œæ–‡æœ¬è¿æ¥èµ·æ¥ concatenated = layers.concatenate([encoded_text, encoded_question], axis=-1) # åœ¨ä¸Šé¢æ·»åŠ ä¸€ä¸ªsoftmaxåˆ†ç±»å™¨ answer = layers.","title":"å¤šè¾“å…¥æ¨¡å‹"},{"content":"å®‰è£…å®Œvirtualboxåï¼Œæç¤ºå†…æ ¸é—®é¢˜ è§£å†³æ–¹æ³• å®‰è£…å†…æ ¸åŒ¹é…ç‰ˆæœ¬ sudo pacman -S linux419-virtualbox-host-modules\né‡æ–°åŠ è½½å†…æ ¸æ¨¡å— sudo /sbin/rcvboxdrv ç„¶åé‡å¯å³å¯\n","permalink":"http://yangchnet.github.io/Dessert/posts/linux/virtualbox%E7%9A%84%E5%AE%89%E8%A3%85%E9%97%AE%E9%A2%98/","summary":"å®‰è£…å®Œvirtualboxåï¼Œæç¤ºå†…æ ¸é—®é¢˜ è§£å†³æ–¹æ³• å®‰è£…å†…æ ¸åŒ¹é…ç‰ˆæœ¬ sudo pacman -S linux419-virtualbox-host-modules\né‡æ–°åŠ è½½å†…æ ¸æ¨¡å— sudo /sbin/rcvboxdrv ç„¶åé‡å¯å³å¯","title":"å®‰è£…å®Œvirtualboxåï¼Œæç¤ºå†…æ ¸é—®é¢˜"},{"content":"å¿«é€Ÿå…¥é—¨Matplotlibæ•™ç¨‹ ä»‹ç» Matplotlib å¯èƒ½æ˜¯ Python 2D-ç»˜å›¾é¢†åŸŸä½¿ç”¨æœ€å¹¿æ³›çš„å¥—ä»¶ã€‚å®ƒèƒ½è®©ä½¿ç”¨è€…å¾ˆè½»æ¾åœ°å°†æ•°æ®å›¾å½¢åŒ–ï¼Œå¹¶ä¸”æä¾›å¤šæ ·åŒ–çš„è¾“å‡ºæ ¼å¼ã€‚\npylab pylab æ˜¯ matplotlib é¢å‘å¯¹è±¡ç»˜å›¾åº“çš„ä¸€ä¸ªæ¥å£ã€‚å®ƒçš„è¯­æ³•å’Œ Matlab ååˆ†ç›¸è¿‘ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä¸»è¦çš„ç»˜å›¾å‘½ä»¤å’Œ Matlab å¯¹åº”çš„å‘½ä»¤æœ‰ç›¸ä¼¼çš„å‚æ•°ã€‚\nåˆçº§ç»˜åˆ¶ è¿™ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä»ç®€åˆ°ç¹ï¼šå…ˆå°è¯•ç”¨é»˜è®¤é…ç½®åœ¨åŒä¸€å¼ å›¾ä¸Šç»˜åˆ¶æ­£å¼¦å’Œä½™å¼¦å‡½æ•°å›¾åƒï¼Œç„¶åé€æ­¥ç¾åŒ–å®ƒã€‚\nç¬¬ä¸€æ­¥ï¼Œæ˜¯å–å¾—æ­£å¼¦å‡½æ•°å’Œä½™å¼¦å‡½æ•°çš„å€¼ï¼š\nimport numpy as np X = np.linspace(-np.pi, np.pi, 256,endpoint=True) C,S = np.cos(X), np.sin(X) X æ˜¯ä¸€ä¸ª numpy æ•°ç»„ï¼ŒåŒ…å«äº†ä» âˆ’Ï€âˆ’Ï€ åˆ° +Ï€+Ï€ ç­‰é—´éš”çš„ 256 ä¸ªå€¼ã€‚Cå’Œ S åˆ™åˆ†åˆ«æ˜¯è¿™ 256 ä¸ªå€¼å¯¹åº”çš„ä½™å¼¦å’Œæ­£å¼¦å‡½æ•°å€¼ç»„æˆçš„ numpy æ•°ç»„ã€‚\nnp.linspace\nä½¿ç”¨é»˜è®¤é…ç½® Matplotlib çš„é»˜è®¤é…ç½®éƒ½å…è®¸ç”¨æˆ·è‡ªå®šä¹‰ã€‚ä½ å¯ä»¥è°ƒæ•´å¤§å¤šæ•°çš„é»˜è®¤é…ç½®ï¼šå›¾ç‰‡å¤§å°å’Œåˆ†è¾¨ç‡ï¼ˆdpiï¼‰ã€çº¿å®½ã€é¢œè‰²ã€é£æ ¼ã€åæ ‡è½´ã€åæ ‡è½´ä»¥åŠç½‘æ ¼çš„å±æ€§ã€æ–‡å­—ä¸å­—ä½“å±æ€§ç­‰ã€‚ä¸è¿‡ï¼Œmatplotlib çš„é»˜è®¤é…ç½®åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹å·²ç»åšå¾—è¶³å¤Ÿå¥½ï¼Œä½ å¯èƒ½åªåœ¨å¾ˆå°‘çš„æƒ…å†µä¸‹æ‰ä¼šæƒ³æ›´æ”¹è¿™äº›é»˜è®¤é…ç½®ã€‚\nplotå‡½æ•°è¯¦è§£\nfrom pylab import * plot(X,C) plot(X,S) show() \u0026lt;Figure size 640x480 with 1 Axes\u0026gt;  é»˜è®¤é…ç½®çš„å…·ä½“å†…å®¹ ä¸‹é¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å±•ç°äº† matplotlib çš„é»˜è®¤é…ç½®å¹¶è¾…ä»¥æ³¨é‡Šè¯´æ˜ï¼Œè¿™éƒ¨åˆ†é…ç½®åŒ…å«äº†æœ‰å…³ç»˜å›¾æ ·å¼çš„æ‰€æœ‰é…ç½®ã€‚ä»£ç ä¸­çš„é…ç½®ä¸é»˜è®¤é…ç½®å®Œå…¨ç›¸åŒï¼Œä½ å¯ä»¥åœ¨äº¤äº’æ¨¡å¼ä¸­ä¿®æ”¹å…¶ä¸­çš„å€¼æ¥è§‚å¯Ÿæ•ˆæœã€‚\n# å¯¼å…¥ matplotlib çš„æ‰€æœ‰å†…å®¹ï¼ˆnympy å¯ä»¥ç”¨ np è¿™ä¸ªåå­—æ¥ä½¿ç”¨ï¼‰ from pylab import * # åˆ›å»ºä¸€ä¸ª 8 * 6 ç‚¹ï¼ˆpointï¼‰çš„å›¾ï¼Œå¹¶è®¾ç½®åˆ†è¾¨ç‡ä¸º 80 figure(figsize=(8,6), dpi=80) # åˆ›å»ºä¸€ä¸ªæ–°çš„ 1 * 1 çš„å­å›¾ï¼Œæ¥ä¸‹æ¥çš„å›¾æ ·ç»˜åˆ¶åœ¨å…¶ä¸­çš„ç¬¬ 1 å—ï¼ˆä¹Ÿæ˜¯å”¯ä¸€çš„ä¸€å—ï¼‰ subplot(1,1,1) X = np.linspace(-np.pi, np.pi, 256,endpoint=True) C,S = np.cos(X), np.sin(X) # ç»˜åˆ¶ä½™å¼¦æ›²çº¿ï¼Œä½¿ç”¨è“è‰²çš„ã€è¿ç»­çš„ã€å®½åº¦ä¸º 1 ï¼ˆåƒç´ ï¼‰çš„çº¿æ¡ plot(X, C, color=\u0026#34;blue\u0026#34;, linewidth=1.0, linestyle=\u0026#34;-\u0026#34;) # ç»˜åˆ¶æ­£å¼¦æ›²çº¿ï¼Œä½¿ç”¨ç»¿è‰²çš„ã€è¿ç»­çš„ã€å®½åº¦ä¸º 1 ï¼ˆåƒç´ ï¼‰çš„çº¿æ¡ plot(X, S, color=\u0026#34;green\u0026#34;, linewidth=1.0, linestyle=\u0026#34;-\u0026#34;) # è®¾ç½®æ¨ªè½´çš„ä¸Šä¸‹é™ xlim(-4.0,4.0) # è®¾ç½®æ¨ªè½´è®°å· xticks(np.linspace(-4,4,9,endpoint=True)) # è®¾ç½®çºµè½´çš„ä¸Šä¸‹é™ ylim(-1.0,1.0) # è®¾ç½®çºµè½´è®°å· yticks(np.linspace(-1,1,5,endpoint=True)) # ä»¥åˆ†è¾¨ç‡ 72 æ¥ä¿å­˜å›¾ç‰‡ # savefig(\u0026#34;exercice_2.png\u0026#34;,dpi=72) # åœ¨å±å¹•ä¸Šæ˜¾ç¤º show() \u0026lt;Figure size 640x480 with 1 Axes\u0026gt;  æ”¹å˜çº¿æ¡çš„é¢œè‰²å’Œç²—ç»† figure(figsize=(10,6), dpi=80) plot(X, C, color=\u0026#34;blue\u0026#34;, linewidth=10, linestyle=\u0026#34;-\u0026#34;) plot(X, S, color=\u0026#34;red\u0026#34;, linewidth=2.5, linestyle=\u0026#34;-\u0026#34;) [\u0026lt;matplotlib.lines.Line2D at 0x7f6c66774470\u0026gt;]  è®¾ç½®å›¾ç‰‡è¾¹ç•Œ å½“å‰çš„å›¾ç‰‡è¾¹ç•Œè®¾ç½®å¾—ä¸å¥½ï¼Œæ‰€ä»¥æœ‰äº›åœ°æ–¹çœ‹å¾—ä¸æ˜¯å¾ˆæ¸…æ¥šã€‚\nfrom pylab import * figure(figsize=(8,6), dpi=80) subplot(1,1,1) X = np.linspace(-np.pi, np.pi, 256,endpoint=True) C,S = np.cos(X), np.sin(X) plot(X, C, color=\u0026#34;blue\u0026#34;, linewidth=1.0, linestyle=\u0026#34;-\u0026#34;) plot(X, S, color=\u0026#34;green\u0026#34;, linewidth=1.0, linestyle=\u0026#34;-\u0026#34;) xticks(np.linspace(-4,4,9,endpoint=True)) xlim(X.min()*1.1, X.max()*1.1) # æ­¤å¤„å‘ç”Ÿæ”¹å˜ ylim(C.min()*1.1, C.max()*1.1) # æ­¤å¤„å‘ç”Ÿæ”¹å˜ yticks(np.linspace(-1,1,5,endpoint=True)) show() è®¾ç½®è®°å· æˆ‘ä»¬è®¨è®ºæ­£å¼¦å’Œä½™å¼¦å‡½æ•°çš„æ—¶å€™ï¼Œé€šå¸¸å¸Œæœ›çŸ¥é“å‡½æ•°åœ¨ $Â±Ï€Â±Ï€$ å’Œ $Â±Ï€/2Â±Ï€/2$ çš„å€¼ã€‚è¿™æ ·çœ‹æ¥ï¼Œå½“å‰çš„è®¾ç½®å°±ä¸é‚£ä¹ˆç†æƒ³äº†ã€‚\nfrom pylab import * figure(figsize=(8,6), dpi=80) subplot(1,1,1) X = np.linspace(-np.pi, np.pi, 256,endpoint=True) C,S = np.cos(X), np.sin(X) plot(X, C, color=\u0026#34;blue\u0026#34;, linewidth=1.0, linestyle=\u0026#34;-\u0026#34;) plot(X, S, color=\u0026#34;green\u0026#34;, linewidth=1.0, linestyle=\u0026#34;-\u0026#34;) xlim(X.min()*1.1, X.max()*1.1) ylim(C.min()*1.1, C.max()*1.1) xticks( [-np.pi, -np.pi/2, 0, np.pi/2, np.pi]) # æ­¤å¤„å‘ç”Ÿæ”¹å˜ yticks([-1, 0, +1]) # æ­¤å¤„å‘ç”Ÿæ”¹å˜ show() è®¾ç½®è®°å·çš„æ ‡ç­¾ è®°å·ç°åœ¨æ²¡é—®é¢˜äº†ï¼Œä¸è¿‡æ ‡ç­¾å´ä¸å¤§ç¬¦åˆæœŸæœ›ã€‚æˆ‘ä»¬å¯ä»¥æŠŠ 3.142 å½“åšæ˜¯ $Ï€$ï¼Œä½†æ¯•ç«Ÿä¸å¤Ÿç²¾ç¡®ã€‚å½“æˆ‘ä»¬è®¾ç½®è®°å·çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥åŒæ—¶è®¾ç½®è®°å·çš„æ ‡ç­¾ã€‚æ³¨æ„è¿™é‡Œä½¿ç”¨äº† LaTeXã€‚(ä»¥åä¼šè®²LaTeX)\nfrom pylab import * figure(figsize=(8,6), dpi=80) subplot(1,1,1) X = np.linspace(-np.pi, np.pi, 256,endpoint=True) C,S = np.cos(X), np.sin(X) plot(X, C, color=\u0026#34;blue\u0026#34;, linewidth=1.0, linestyle=\u0026#34;-\u0026#34;) plot(X, S, color=\u0026#34;green\u0026#34;, linewidth=1.0, linestyle=\u0026#34;-\u0026#34;) xlim(X.min()*1.1, X.max()*1.1) ylim(C.min()*1.1, C.max()*1.1) plt.xticks([-np.pi, -np.pi/2, 0, np.pi/2, np.pi],[r\u0026#39;$-\\pi$\u0026#39;, r\u0026#39;$-\\pi/2$\u0026#39;, r\u0026#39;$0$\u0026#39;, r\u0026#39;$+\\pi/2$\u0026#39;, r\u0026#39;$+\\pi$\u0026#39;]) # æ­¤å¤„å‘ç”Ÿæ”¹å˜ plt.yticks([-1, 0, +1],[r\u0026#39;$-1$\u0026#39;, r\u0026#39;$0$\u0026#39;, r\u0026#39;$+1$\u0026#39;]) # æ­¤å¤„å‘ç”Ÿæ”¹å˜ show() ç§»åŠ¨è„ŠæŸ± åæ ‡è½´çº¿å’Œä¸Šé¢çš„è®°å·è¿åœ¨ä¸€èµ·å°±å½¢æˆäº†è„ŠæŸ±ï¼ˆSpinesï¼Œä¸€æ¡çº¿æ®µä¸Šæœ‰ä¸€ç³»åˆ—çš„å‡¸èµ·ï¼Œæ˜¯ä¸æ˜¯å¾ˆåƒè„ŠæŸ±éª¨å•Š~ï¼‰ï¼Œå®ƒè®°å½•äº†æ•°æ®åŒºåŸŸçš„èŒƒå›´ã€‚å®ƒä»¬å¯ä»¥æ”¾åœ¨ä»»æ„ä½ç½®ï¼Œä¸è¿‡è‡³ä»Šä¸ºæ­¢ï¼Œæˆ‘ä»¬éƒ½æŠŠå®ƒæ”¾åœ¨å›¾çš„å››è¾¹ã€‚\nå®é™…ä¸Šæ¯å¹…å›¾æœ‰å››æ¡è„ŠæŸ±ï¼ˆä¸Šä¸‹å·¦å³ï¼‰ï¼Œä¸ºäº†å°†è„ŠæŸ±æ”¾åœ¨å›¾çš„ä¸­é—´ï¼Œæˆ‘ä»¬å¿…é¡»å°†å…¶ä¸­çš„ä¸¤æ¡ï¼ˆä¸Šå’Œå³ï¼‰è®¾ç½®ä¸ºæ— è‰²ï¼Œç„¶åè°ƒæ•´å‰©ä¸‹çš„ä¸¤æ¡åˆ°åˆé€‚çš„ä½ç½®â€”â€”æ•°æ®ç©ºé—´çš„ 0 ç‚¹ã€‚\nfrom pylab import * figure(figsize=(8,6), dpi=80) subplot(1,1,1) X = np.linspace(-np.pi, np.pi, 256,endpoint=True) C,S = np.cos(X), np.sin(X) plot(X, C, color=\u0026#34;blue\u0026#34;, linewidth=1.0, linestyle=\u0026#34;-\u0026#34;) plot(X, S, color=\u0026#34;green\u0026#34;, linewidth=1.0, linestyle=\u0026#34;-\u0026#34;) xlim(X.min()*1.1, X.max()*1.1) plt.xticks([-np.pi, -np.pi/2, 0, np.pi/2, np.pi],[r\u0026#39;$-\\pi$\u0026#39;, r\u0026#39;$-\\pi/2$\u0026#39;, r\u0026#39;$0$\u0026#39;, r\u0026#39;$+\\pi/2$\u0026#39;, r\u0026#39;$+\\pi$\u0026#39;]) ylim(C.min()*1.1, C.max()*1.1) plt.yticks([-1, 0, +1],[r\u0026#39;$-1$\u0026#39;, r\u0026#39;$0$\u0026#39;, r\u0026#39;$+1$\u0026#39;]) # ç§»åŠ¨è„ŠæŸ± ax = plt.gca() ax.spines[\u0026#39;right\u0026#39;].set_color(\u0026#39;none\u0026#39;) ax.spines[\u0026#39;top\u0026#39;].set_color(\u0026#39;none\u0026#39;) ax.xaxis.set_ticks_position(\u0026#39;bottom\u0026#39;) ax.spines[\u0026#39;bottom\u0026#39;].set_position((\u0026#39;data\u0026#39;,0)) ax.yaxis.set_ticks_position(\u0026#39;left\u0026#39;) ax.spines[\u0026#39;left\u0026#39;].set_position((\u0026#39;data\u0026#39;,0)) show() æ·»åŠ å›¾ä¾‹ æˆ‘ä»¬åœ¨å›¾çš„å·¦ä¸Šè§’æ·»åŠ ä¸€ä¸ªå›¾ä¾‹ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨ plot å‡½æ•°é‡Œä»¥ã€Œé”® - å€¼ã€çš„å½¢å¼å¢åŠ ä¸€ä¸ªå‚æ•°ã€‚\nfrom pylab import * figure(figsize=(8,6), dpi=80) subplot(1,1,1) X = np.linspace(-np.pi, np.pi, 256,endpoint=True) C,S = np.cos(X), np.sin(X) plot(X, C, color=\u0026#34;blue\u0026#34;, linewidth=1.0, linestyle=\u0026#34;-\u0026#34;) plot(X, S, color=\u0026#34;green\u0026#34;, linewidth=1.0, linestyle=\u0026#34;-\u0026#34;) xlim(X.min()*1.1, X.max()*1.1) plt.xticks([-np.pi, -np.pi/2, 0, np.pi/2, np.pi],[r\u0026#39;$-\\pi$\u0026#39;, r\u0026#39;$-\\pi/2$\u0026#39;, r\u0026#39;$0$\u0026#39;, r\u0026#39;$+\\pi/2$\u0026#39;, r\u0026#39;$+\\pi$\u0026#39;]) ylim(C.min()*1.1, C.max()*1.1) plt.yticks([-1, 0, +1],[r\u0026#39;$-1$\u0026#39;, r\u0026#39;$0$\u0026#39;, r\u0026#39;$+1$\u0026#39;]) # ç§»åŠ¨è„ŠæŸ± ax = plt.gca() ax.spines[\u0026#39;right\u0026#39;].set_color(\u0026#39;none\u0026#39;) ax.spines[\u0026#39;top\u0026#39;].set_color(\u0026#39;none\u0026#39;) ax.xaxis.set_ticks_position(\u0026#39;bottom\u0026#39;) ax.spines[\u0026#39;bottom\u0026#39;].set_position((\u0026#39;data\u0026#39;,0)) ax.yaxis.set_ticks_position(\u0026#39;left\u0026#39;) ax.spines[\u0026#39;left\u0026#39;].set_position((\u0026#39;data\u0026#39;,0)) # å¢åŠ å›¾ä¾‹ plt.plot(X, C, color=\u0026#34;blue\u0026#34;, linewidth=2.5, linestyle=\u0026#34;-\u0026#34;, label=\u0026#34;cosine\u0026#34;) plt.plot(X, S, color=\u0026#34;red\u0026#34;, linewidth=2.5, linestyle=\u0026#34;-\u0026#34;, label=\u0026#34;sine\u0026#34;) plt.legend(loc=\u0026#39;upper left\u0026#39;, frameon=False) show() å…¶ä»–ç±»å‹çš„å›¾ æ™®é€šå›¾ import numpy as np import matplotlib.pyplot as plt n = 256 X = np.linspace(-np.pi,np.pi,n,endpoint=True) Y = np.sin(2*X) plt.axes([0.025,0.025,0.95,0.95]) plt.plot (X, Y+1, color=\u0026#39;blue\u0026#39;, alpha=1.00) plt.fill_between(X, 1, Y+1, color=\u0026#39;blue\u0026#39;, alpha=.25) plt.plot (X, Y-1, color=\u0026#39;blue\u0026#39;, alpha=1.00) plt.fill_between(X, -1, Y-1, (Y-1) \u0026gt; -1, color=\u0026#39;blue\u0026#39;, alpha=.25) plt.fill_between(X, -1, Y-1, (Y-1) \u0026lt; -1, color=\u0026#39;red\u0026#39;, alpha=.25) plt.xlim(-np.pi,np.pi), plt.xticks([]) plt.ylim(-2.5,2.5), plt.yticks([]) # savefig(\u0026#39;../figures/plot_ex.png\u0026#39;,dpi=48) plt.show() æ•£ç‚¹å›¾ import numpy as np import matplotlib.pyplot as plt n = 1024 X = np.random.normal(0,1,n) Y = np.random.normal(0,1,n) T = np.arctan2(Y,X) plt.axes([0.025,0.025,0.95,0.95]) plt.scatter(X,Y, s=75, c=T, alpha=.5) plt.xlim(-1.5,1.5), plt.xticks([]) plt.ylim(-1.5,1.5), plt.yticks([]) # savefig(\u0026#39;../figures/scatter_ex.png\u0026#39;,dpi=48) plt.show() æ¡å½¢å›¾ import numpy as np import matplotlib.pyplot as plt n = 12 X = np.arange(n) Y1 = (1-X/float(n)) * np.random.uniform(0.5,1.0,n) Y2 = (1-X/float(n)) * np.random.uniform(0.5,1.0,n) plt.axes([0.025,0.025,0.95,0.95]) plt.bar(X, +Y1, facecolor=\u0026#39;#9999ff\u0026#39;, edgecolor=\u0026#39;white\u0026#39;) plt.bar(X, -Y2, facecolor=\u0026#39;#ff9999\u0026#39;, edgecolor=\u0026#39;white\u0026#39;) for x,y in zip(X,Y1): plt.text(x+0.4, y+0.05, \u0026#39;%.2f\u0026#39; % y, ha=\u0026#39;center\u0026#39;, va= \u0026#39;bottom\u0026#39;) for x,y in zip(X,Y2): plt.text(x+0.4, -y-0.05, \u0026#39;%.2f\u0026#39; % y, ha=\u0026#39;center\u0026#39;, va= \u0026#39;top\u0026#39;) plt.xlim(-.5,n), plt.xticks([]) plt.ylim(-1.25,+1.25), plt.yticks([]) # savefig(\u0026#39;../figures/bar_ex.png\u0026#39;, dpi=48) plt.show() ç­‰é«˜çº¿å›¾ import numpy as np import matplotlib.pyplot as plt def f(x,y): return (1-x/2+x**5+y**3)*np.exp(-x**2-y**2) n = 256 x = np.linspace(-3,3,n) y = np.linspace(-3,3,n) X,Y = np.meshgrid(x,y) plt.axes([0.025,0.025,0.95,0.95]) plt.contourf(X, Y, f(X,Y), 8, alpha=.75, cmap=plt.cm.hot) C = plt.contour(X, Y, f(X,Y), 8, colors=\u0026#39;black\u0026#39;, linewidth=.5) plt.clabel(C, inline=1, fontsize=10) plt.xticks([]), plt.yticks([]) # savefig(\u0026#39;../figures/contour_ex.png\u0026#39;,dpi=48) plt.show() /usr/lib/python3.7/site-packages/matplotlib/contour.py:1000: UserWarning: The following kwargs were not used by contour: 'linewidth' s)  ç°åº¦å›¾ import numpy as np import matplotlib.pyplot as plt def f(x,y): return (1-x/2+x**5+y**3)*np.exp(-x**2-y**2) n = 10 x = np.linspace(-3,3,3.5*n) y = np.linspace(-3,3,3.0*n) X,Y = np.meshgrid(x,y) Z = f(X,Y) plt.axes([0.025,0.025,0.95,0.95]) plt.imshow(Z,interpolation=\u0026#39;bicubic\u0026#39;, cmap=\u0026#39;bone\u0026#39;, origin=\u0026#39;lower\u0026#39;) plt.colorbar(shrink=.92) plt.xticks([]), plt.yticks([]) # savefig(\u0026#39;../figures/imshow_ex.png\u0026#39;, dpi=48) plt.show() /usr/lib/python3.7/site-packages/ipykernel_launcher.py:8: DeprecationWarning: object of type \u0026lt;class 'float'\u0026gt; cannot be safely interpreted as an integer. /usr/lib/python3.7/site-packages/ipykernel_launcher.py:9: DeprecationWarning: object of type \u0026lt;class 'float'\u0026gt; cannot be safely interpreted as an integer. if __name__ == '__main__':  é¥¼çŠ¶å›¾ import numpy as np import matplotlib.pyplot as plt n = 20 Z = np.ones(n) Z[-1] *= 2 plt.axes([0.025, 0.025, 0.95, 0.95]) plt.pie(Z, explode=Z*.05, colors=[\u0026#39;%f\u0026#39; % (i/float(n)) for i in range(n)], wedgeprops={\u0026#34;linewidth\u0026#34;: 1, \u0026#34;edgecolor\u0026#34;: \u0026#34;black\u0026#34;}) plt.gca().set_aspect(\u0026#39;equal\u0026#39;) plt.xticks([]), plt.yticks([]) # savefig(\u0026#39;../figures/pie_ex.png\u0026#39;,dpi=48) plt.show() æè½´å›¾ import numpy as np import matplotlib.pyplot as plt ax = plt.axes([0.025,0.025,0.95,0.95], polar=True) N = 20 theta = np.arange(0.0, 2*np.pi, 2*np.pi/N) radii = 10*np.random.rand(N) width = np.pi/4*np.random.rand(N) bars = plt.bar(theta, radii, width=width, bottom=0.0) for r,bar in zip(radii, bars): bar.set_facecolor( plt.cm.jet(r/10.)) bar.set_alpha(0.5) ax.set_xticklabels([]) ax.set_yticklabels([]) # savefig(\u0026#39;../figures/polar_ex.png\u0026#39;,dpi=48) plt.show() 3Då›¾ import numpy as np import matplotlib.pyplot as plt from mpl_toolkits.mplot3d import Axes3D fig = plt.figure() ax = Axes3D(fig) X = np.arange(-4, 4, 0.25) Y = np.arange(-4, 4, 0.25) X, Y = np.meshgrid(X, Y) R = np.sqrt(X**2 + Y**2) Z = np.sin(R) ax.plot_surface(X, Y, Z, rstride=1, cstride=1, cmap=plt.cm.hot) ax.contourf(X, Y, Z, zdir=\u0026#39;z\u0026#39;, offset=-2, cmap=plt.cm.hot) ax.set_zlim(-2,2) # savefig(\u0026#39;../figures/plot3d_ex.png\u0026#39;,dpi=48) plt.show() ä½œä¸š ç†Ÿæ‚‰ä»¥ä¸Šç”»å›¾æ–¹æ³•ï¼Œä»å…¶å®˜æ–¹æ–‡æ¡£ä¸­äº†è§£â€œå­å›¾â€çš„æ¦‚å¿µï¼Œå°†[æ•£ç‚¹å›¾ï¼Œ æ¡å½¢å›¾ï¼Œ ç­‰é«˜çº¿å›¾ï¼Œ ç°åº¦å›¾ï¼Œ é¥¼çŠ¶å›¾ï¼Œ æè½´å›¾ï¼Œ 3Då›¾]æ”¾åœ¨ä¸€å¼ $3*2$çš„å­å›¾ä¸­\né™„ï¼šå‚è€ƒèµ„æ–™  matplotlibå®˜æ–¹æ–‡æ¡£ matplotlibä¸­æ–‡æ–‡æ¡£ matplotlibå®˜æ–¹æ•™ç¨‹ è¯¦è§£å›¾åƒå„ä¸ªéƒ¨åˆ† matplotlib  np.linspace numpy.linspace(start, stop, num=50, endpoint=True, retstep=False, dtype=None)\nåœ¨æŒ‡å®šçš„é—´éš”å†…è¿”å›å‡åŒ€é—´éš”çš„æ•°å­—ã€‚\nè¿”å›numå‡åŒ€åˆ†å¸ƒçš„æ ·æœ¬ï¼Œåœ¨[start, stop]ã€‚\nè¿™ä¸ªåŒºé—´çš„ç«¯ç‚¹å¯ä»¥ä»»æ„çš„è¢«æ’é™¤åœ¨å¤–ã€‚\n å‚æ•°ï¼š   start ï¼š array_like\nåºåˆ—çš„èµ·å§‹å€¼ã€‚\n  stop ï¼š array_like åºåˆ—çš„ç»“æŸå€¼ï¼Œé™¤éç«¯ç‚¹è®¾ç½®ä¸ºFalseã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåºåˆ—ç”±é™¤ å‡åŒ€é—´éš”çš„æ ·æœ¬ä¹‹å¤–çš„æ‰€æœ‰æ ·æœ¬ç»„æˆï¼Œå› æ­¤ä¸åŒ…æ‹¬åœæ­¢ã€‚è¯·æ³¨æ„ï¼Œå½“ç«¯ç‚¹ä¸ºFalse æ—¶ï¼Œæ­¥é•¿ä¼šå‘ç”Ÿå˜åŒ–ã€‚num + 1\n  num ï¼š intï¼Œå¯é€‰ è¦ç”Ÿæˆçš„æ ·æœ¬æ•°ã€‚é»˜è®¤å€¼ä¸º50.å¿…é¡»ä¸ºéè´Ÿæ•°ã€‚\n  endpoint ï¼š boolï¼Œå¯é€‰ å¦‚æœä¸ºTrueï¼Œåˆ™stopæ˜¯æœ€åä¸€ä¸ªæ ·æœ¬ã€‚å¦åˆ™ï¼Œå®ƒä¸åŒ…æ‹¬åœ¨å†…ã€‚é»˜è®¤ä¸ºTrueã€‚\n  retstep ï¼š boolï¼Œå¯é€‰ å¦‚æœä¸ºTrueï¼Œåˆ™è¿”å›ï¼ˆsamplesï¼Œstepï¼‰ï¼Œå…¶ä¸­stepæ˜¯æ ·æœ¬ä¹‹é—´çš„é—´è·ã€‚\n  dtype ï¼š dtypeï¼Œå¯é€‰ è¾“å‡ºæ•°ç»„çš„ç±»å‹ã€‚å¦‚æœdtypeæœªç»™å‡ºï¼Œåˆ™ä»å…¶ä»–è¾“å…¥å‚æ•°æ¨æ–­æ•°æ®ç±»å‹ã€‚\n   è¿”å›   samples : ndarray æœ‰NUMåŒæ ·åœ¨é—­åŒºé—´éš”å¼€çš„æ ·å“ æˆ–åŠå¼€é—´éš” ï¼ˆå–å†³äºæ˜¯å¦ç«¯ç‚¹æ˜¯çœŸæˆ–å‡ï¼‰ã€‚[start, stop][start, stop)\n  step : float, optional ä»…åœ¨retstepä¸ºTrue æ—¶æ‰è¿”å›æ ·æœ¬ä¹‹é—´çš„é—´è·å¤§å°ã€‚\n    è¿”å›åˆçº§é…ç½®\n","permalink":"http://yangchnet.github.io/Dessert/posts/python/matplotlib%E5%88%9D%E7%BA%A7%E6%95%99%E7%A8%8B/","summary":"å¿«é€Ÿå…¥é—¨Matplotlibæ•™ç¨‹ ä»‹ç» Matplotlib å¯èƒ½æ˜¯ Python 2D-ç»˜å›¾é¢†åŸŸä½¿ç”¨æœ€å¹¿æ³›çš„å¥—ä»¶ã€‚å®ƒèƒ½è®©ä½¿ç”¨è€…å¾ˆè½»æ¾åœ°å°†æ•°æ®å›¾å½¢åŒ–ï¼Œå¹¶ä¸”æä¾›å¤šæ ·åŒ–çš„è¾“å‡ºæ ¼å¼ã€‚\npylab pylab æ˜¯ matplotlib é¢å‘å¯¹è±¡ç»˜å›¾åº“çš„ä¸€ä¸ªæ¥å£ã€‚å®ƒçš„è¯­æ³•å’Œ Matlab ååˆ†ç›¸è¿‘ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä¸»è¦çš„ç»˜å›¾å‘½ä»¤å’Œ Matlab å¯¹åº”çš„å‘½ä»¤æœ‰ç›¸ä¼¼çš„å‚æ•°ã€‚\nåˆçº§ç»˜åˆ¶ è¿™ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä»ç®€åˆ°ç¹ï¼šå…ˆå°è¯•ç”¨é»˜è®¤é…ç½®åœ¨åŒä¸€å¼ å›¾ä¸Šç»˜åˆ¶æ­£å¼¦å’Œä½™å¼¦å‡½æ•°å›¾åƒï¼Œç„¶åé€æ­¥ç¾åŒ–å®ƒã€‚\nç¬¬ä¸€æ­¥ï¼Œæ˜¯å–å¾—æ­£å¼¦å‡½æ•°å’Œä½™å¼¦å‡½æ•°çš„å€¼ï¼š\nimport numpy as np X = np.linspace(-np.pi, np.pi, 256,endpoint=True) C,S = np.cos(X), np.sin(X) X æ˜¯ä¸€ä¸ª numpy æ•°ç»„ï¼ŒåŒ…å«äº†ä» âˆ’Ï€âˆ’Ï€ åˆ° +Ï€+Ï€ ç­‰é—´éš”çš„ 256 ä¸ªå€¼ã€‚Cå’Œ S åˆ™åˆ†åˆ«æ˜¯è¿™ 256 ä¸ªå€¼å¯¹åº”çš„ä½™å¼¦å’Œæ­£å¼¦å‡½æ•°å€¼ç»„æˆçš„ numpy æ•°ç»„ã€‚\nnp.linspace\nä½¿ç”¨é»˜è®¤é…ç½® Matplotlib çš„é»˜è®¤é…ç½®éƒ½å…è®¸ç”¨æˆ·è‡ªå®šä¹‰ã€‚ä½ å¯ä»¥è°ƒæ•´å¤§å¤šæ•°çš„é»˜è®¤é…ç½®ï¼šå›¾ç‰‡å¤§å°å’Œåˆ†è¾¨ç‡ï¼ˆdpiï¼‰ã€çº¿å®½ã€é¢œè‰²ã€é£æ ¼ã€åæ ‡è½´ã€åæ ‡è½´ä»¥åŠç½‘æ ¼çš„å±æ€§ã€æ–‡å­—ä¸å­—ä½“å±æ€§ç­‰ã€‚ä¸è¿‡ï¼Œmatplotlib çš„é»˜è®¤é…ç½®åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹å·²ç»åšå¾—è¶³å¤Ÿå¥½ï¼Œä½ å¯èƒ½åªåœ¨å¾ˆå°‘çš„æƒ…å†µä¸‹æ‰ä¼šæƒ³æ›´æ”¹è¿™äº›é»˜è®¤é…ç½®ã€‚\nplotå‡½æ•°è¯¦è§£\nfrom pylab import * plot(X,C) plot(X,S) show() \u0026lt;Figure size 640x480 with 1 Axes\u0026gt;  é»˜è®¤é…ç½®çš„å…·ä½“å†…å®¹ ä¸‹é¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å±•ç°äº† matplotlib çš„é»˜è®¤é…ç½®å¹¶è¾…ä»¥æ³¨é‡Šè¯´æ˜ï¼Œè¿™éƒ¨åˆ†é…ç½®åŒ…å«äº†æœ‰å…³ç»˜å›¾æ ·å¼çš„æ‰€æœ‰é…ç½®ã€‚ä»£ç ä¸­çš„é…ç½®ä¸é»˜è®¤é…ç½®å®Œå…¨ç›¸åŒï¼Œä½ å¯ä»¥åœ¨äº¤äº’æ¨¡å¼ä¸­ä¿®æ”¹å…¶ä¸­çš„å€¼æ¥è§‚å¯Ÿæ•ˆæœã€‚","title":"å¿«é€Ÿå…¥é—¨Matplotlibæ•™ç¨‹"},{"content":"æœ´ç´ è´å¶æ–¯ 1ã€ç†è®ºéƒ¨åˆ† 1.1ã€è´å¶æ–¯å…¬å¼ $$P(c|x)=\\frac{P(c)P(x|c)}{P(x)}\\qquad\\dots(1)$$\nå…¶ä¸­ï¼Œ$P(c)$æ˜¯ç±»â€œå…ˆéªŒæ¦‚ç‡â€ï¼›$P(x|c)$æ˜¯æ ·æœ¬$x$ç›¸å¯¹äºç±»æ ‡è®°$c$çš„ç±»æ¡ä»¶æ¦‚ç‡ï¼Œæˆ–ç§°ä¸ºâ€œä¼¼ç„¶â€ï¼›$P(x)$æ˜¯ç”¨äºå½’ä¸€åŒ–çš„â€œè¯æ®å› å­â€ã€‚å¯¹ç»™å®šæ ·æœ¬$x$ï¼Œè¯æ®å› å­$P(x)$ä¸ç±»æ ‡è®°æ— å…³ï¼Œå› æ­¤ä¼°è®¡$P(c|x)$çš„é—®é¢˜å°±è½¬åŒ–ä¸ºå¦‚ä½•åŸºäºè®­ç»ƒæ•°æ®$D$æ¥ä¼°è®¡å…ˆéªŒ$P(c)$å’Œä¼¼ç„¶$P(x|c)$\nç±»å…ˆéªŒæ¦‚ç‡$P(c)$è¡¨è¾¾äº†æ ·æœ¬ç©ºé—´ä¸­å„ç±»æ ·æœ¬æ‰€å çš„æ¯”ä¾‹ï¼Œæ ¹æ®å¤§æ•°å®šå¾‹ï¼Œå½“è®­ç»ƒé›†åŒ…å«å……è¶³çš„ç‹¬ç«‹åŒåˆ†å¸ƒæ ·æœ¬æ—¶ï¼Œ$P(c)$å¯é€šè¿‡å„ç±»æ ·æœ¬å‡ºç°çš„é¢‘ç‡æ¥è¿›è¡Œä¼°è®¡ã€‚\nå¯¹ç±»æ¡ä»¶æ¦‚ç‡$(P(x|c))$æ¥è¯´ï¼Œç”±äºå®ƒæ¶‰åŠå…³äº$x$æ‰€æœ‰å±æ€§çš„è”åˆæ¦‚ç‡ï¼Œç›´æ¥æ ¹æ®æ ·æœ¬å‡ºç°çš„é¢‘ç‡æ¥ä¼°è®¡å°†ä¼šé‡åˆ°ä¸¥é‡çš„å›°éš¾ã€‚ä¸ºé¿å¼€è¿™ä¸ªéšœç¢ï¼Œæœ´ç´ è´å¶æ–¯åˆ†ç±»å™¨é‡‡ç”¨äº†â€œå±æ€§æ¡ä»¶ç‹¬ç«‹æ€§å‡è®¾â€ï¼›å¯¹å·²çŸ¥ç±»åˆ«ï¼Œå‡è®¾æ‰€æœ‰å±æ€§ç›¸äº’ç‹¬ç«‹ã€‚æ¢è¨€ä¹‹ï¼Œå‡è®¾æ¯ä¸ªå±æ€§ç‹¬ç«‹çš„å¯¹åˆ†ç±»ç»“æœäº§ç”Ÿå½±å“ã€‚\nåŸºäºå±æ€§æ¡ä»¶ç‹¬ç«‹æ€§å‡è®¾ï¼Œè´å¶æ–¯å…¬å¼å¯é‡å†™ä¸ºï¼š $$P(c|x)=\\frac{P(c)P(x|c)}{P(x)}\\qquad=\\frac{P(c)}{P(x)}\\prod_{i=1}^d{P(x_i|c)}\\dots(2)$$ å…¶ä¸­$d$ä¸ºå±æ€§æ•°ç›®ï¼Œ$x_i$ä¸º$x$åœ¨ç¬¬iä¸ªå±æ€§ä¸Šçš„å–å€¼\nç”±äºå¯¹äºæ‰€æœ‰ç±»åˆ«æ¥è¯´$P(x)$ç›¸åŒï¼Œå› æ­¤è´å¶æ–¯åˆ¤å®šå‡†åˆ™ï¼š$$h_{nb}(x)=arg max_{c\\in y}P(c)\\prod_{i=1}^d{P(x_i|c)}\\dots(3)$$\næ˜¾ç„¶ï¼Œæœ´ç´ è´å¶æ–¯åˆ†ç±»å™¨çš„è®­ç»ƒè¿‡ç¨‹å°±æ˜¯åŸºäºè®­ç»ƒé›†$D$æ¥ä¼°è®¡ç±»å…ˆéªŒæ¦‚ç‡$P(c)$ï¼Œå¹¶ä¸ºæ¯ä¸ªå±æ€§ä¼°è®¡æ¡ä»¶æ¦‚ç‡$P(x_i|c)$\nä»¤$D_c$è¡¨ç¤ºè®­ç»ƒé›†$D$ä¸­ç¬¬$c$ç±»æ ·æœ¬ç»„æˆçš„é›†åˆï¼Œè‹¥æœ‰å……è¶³çš„ç‹¬ç«‹åŒåˆ†å¸ƒæ ·æœ¬ï¼Œåˆ™å¯å®¹æ˜“çš„ä¼°è®¡å‡ºå…ˆéªŒæ¦‚ç‡ï¼š$$P(c)=\\frac{|D_c|}{|D|}\\dots(4)$$\nå¯¹ç¦»æ•£å±æ€§è€Œè¨€ï¼Œä»¤$D_{c,x_i}$è¡¨ç¤º$D_c$ä¸­åœ¨ç¬¬$i$ä¸ªå±æ€§ä¸Šå–å€¼ä¸º$x_i$çš„æ ·æœ¬ç»„æˆçš„é›†åˆï¼Œåˆ™æ¡ä»¶æ¦‚ç‡$P(x_i|c)$å¯ä¼°è®¡ä¸º$$P(x_i|c)=\\frac{|D_{c,x_i}|}{|D_c|}\\qquad\\dots(5)$$ ä¸ºäº†é¿å…å…¶ä»–å±æ€§æºå¸¦çš„ä¿¡æ¯è¢«è®­ç»ƒé›†ä¸­æœªå‡ºç°çš„å±æ€§å€¼æŠ¹å»ï¼Œåœ¨ä¼°è®¡æ¦‚ç‡å€¼æ—¶é€šå¸¸è¦è¿›è¡Œâ€œå¹³æ»‘â€ï¼Œå¸¸ç”¨â€œæ‹‰æ™®æ‹‰æ–¯ä¿®æ­£â€ã€‚å…·ä½“æ¥è¯´ï¼Œä»¤$N$è¡¨ç¤ºè®­ç»ƒé›†$D$ä¸­å¯èƒ½çš„ç±»åˆ«æ•°ï¼Œ$N_i$è¡¨ç¤ºç¬¬$i$ä¸ªå±æ€§å¯èƒ½çš„å–å€¼æ•°ï¼Œåˆ™(4)(5)ä¸¤å¼åˆ†åˆ«ä¿®æ­£ä¸ºï¼š$$\\hat{P}(c)=\\frac{D_c+1}{|D|+N}\\qquad\\dots(6)$$ $$\\hat{P}(x_i|c)=\\frac{D_{c,x_i}+1}{|D|+N}\\qquad\\dots(7)$$\n2ã€å®æˆ˜æ¼”ç»ƒ 2.1ã€åŠ è½½æ•°æ®é›† import numpy as np def loadDataSet(): \u0026#34;\u0026#34;\u0026#34; å¯¼å…¥æ•°æ®ï¼Œ 1ä»£è¡¨è„è¯ @ return postingList: æ•°æ®é›† @ return classVec: åˆ†ç±»å‘é‡ \u0026#34;\u0026#34;\u0026#34; postingList = [[\u0026#39;my\u0026#39;, \u0026#39;dog\u0026#39;, \u0026#39;has\u0026#39;, \u0026#39;flea\u0026#39;, \u0026#39;problems\u0026#39;, \u0026#39;help\u0026#39;, \u0026#39;please\u0026#39;], [\u0026#39;maybe\u0026#39;, \u0026#39;not\u0026#39;, \u0026#39;take\u0026#39;, \u0026#39;him\u0026#39;, \u0026#39;to\u0026#39;, \u0026#39;dog\u0026#39;, \u0026#39;park\u0026#39;, \u0026#39;stupid\u0026#39;], [\u0026#39;my\u0026#39;, \u0026#39;dalmation\u0026#39;, \u0026#39;is\u0026#39;, \u0026#39;so\u0026#39;, \u0026#39;cute\u0026#39;, \u0026#39;I\u0026#39;, \u0026#39;love\u0026#39;, \u0026#39;him\u0026#39;], [\u0026#39;stop\u0026#39;, \u0026#39;posting\u0026#39;, \u0026#39;stupid\u0026#39;, \u0026#39;worthless\u0026#39;, \u0026#39;garbage\u0026#39;], [\u0026#39;mr\u0026#39;, \u0026#39;licks\u0026#39;, \u0026#39;ate\u0026#39;, \u0026#39;my\u0026#39;, \u0026#39;steak\u0026#39;, \u0026#39;how\u0026#39;, \u0026#39;to\u0026#39;, \u0026#39;stop\u0026#39;, \u0026#39;him\u0026#39;], [\u0026#39;quit\u0026#39;, \u0026#39;buying\u0026#39;, \u0026#39;worthless\u0026#39;, \u0026#39;dog\u0026#39;, \u0026#39;food\u0026#39;, \u0026#39;stupid\u0026#39;]] classVec = [0, 1, 0, 1, 0, 1] return postingList, classVec å¯¼å…¥è®­ç»ƒé›†åŠå…¶åˆ†ç±»ï¼Œ1ä»£è¡¨æ˜¯è„è¯ï¼Œ0ä»£è¡¨ä¸æ˜¯\nloadDataSet() ([['my', 'dog', 'has', 'flea', 'problems', 'help', 'please'], ['maybe', 'not', 'take', 'him', 'to', 'dog', 'park', 'stupid'], ['my', 'dalmation', 'is', 'so', 'cute', 'I', 'love', 'him'], ['stop', 'posting', 'stupid', 'worthless', 'garbage'], ['mr', 'licks', 'ate', 'my', 'steak', 'how', 'to', 'stop', 'him'], ['quit', 'buying', 'worthless', 'dog', 'food', 'stupid']], [0, 1, 0, 1, 0, 1])  2.2ã€åˆ›å»ºå•è¯è¡¨ å°†è®­ç»ƒæ•°æ®ä¸­çš„æ¯ä¸€ä¸ªè¯éƒ½å­˜å‚¨åˆ°è¯åº“ä¸­ã€‚\ndef createVocabList(dataSet): \u0026#34;\u0026#34;\u0026#34; åˆ›å»ºè¯åº“ @ param dataSet: æ•°æ®é›† @ return vocabSet: è¯åº“ \u0026#34;\u0026#34;\u0026#34; vocabSet = set([]) for document in dataSet: # æ±‚å¹¶é›† vocabSet = vocabSet | set(document) return list(vocabSet) listOPosts, listClasses = loadDataSet() myVocabList = createVocabList(listOPosts) myVocabList ['quit', 'how', 'problems', 'mr', 'dalmation', 'garbage', 'love', 'stop', 'maybe', 'him', 'take', 'to', 'stupid', 'food', 'not', 'cute', 'buying', 'flea', 'park', 'help', 'ate', 'dog', 'licks', 'please', 'so', 'has', 'my', 'is', 'posting', 'I', 'steak', 'worthless']  2.3ã€ç”Ÿæˆè¯å‘é‡ def setOfWords2Vec(vocabList, inputSet): \u0026#34;\u0026#34;\u0026#34; æ–‡æœ¬è¯å‘é‡.è¯åº“ä¸­æ¯ä¸ªè¯å½“ä½œä¸€ä¸ªç‰¹å¾ï¼Œæ–‡æœ¬ä¸­æœ‰è¯¥è¯ï¼Œè¯¥è¯ç‰¹å¾å°±æ˜¯1ï¼Œæ²¡æœ‰å°±æ˜¯0 @ param vocabList: è¯è¡¨ @ param inputSet: è¾“å…¥çš„æ•°æ®é›† @ return returnVec: è¿”å›çš„å‘é‡ \u0026#34;\u0026#34;\u0026#34; returnVec = [0] * len(vocabList) for word in inputSet: if word in vocabList: returnVec[vocabList.index(word)] = 1 else: print(\u0026#34;å•è¯: %sä¸åœ¨è¯åº“ä¸­!\u0026#34; % word) return returnVec testEntry = [\u0026#39;love\u0026#39;, \u0026#39;my\u0026#39;, \u0026#39;dalmation\u0026#39;] thisDoc = np.array(setOfWords2Vec(myVocabList, testEntry)) thisDoc array([0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0])  2.4ã€è®­ç»ƒåˆ†ç±»å™¨ def trainNB0(trainMatrix, trainCategory): \u0026#34;\u0026#34;\u0026#34; è®­ç»ƒ @ param trainMatrix: è®­ç»ƒé›† @ param trainCategory: åˆ†ç±» \u0026#34;\u0026#34;\u0026#34; numTrainDocs = len(trainMatrix) # è®­ç»ƒæ•°æ®çš„é•¿åº¦ numWords = len(trainMatrix[0]) # è®­ç»ƒæ•°æ®çš„è¯æ±‡é‡ pAbusive = sum(trainCategory) / float(numTrainDocs) # é˜²æ­¢æŸä¸ªç±»åˆ«è®¡ç®—å‡ºçš„æ¦‚ç‡ä¸º0ï¼Œå¯¼è‡´æœ€åç›¸ä¹˜éƒ½ä¸º0ï¼Œæ‰€ä»¥åˆå§‹è¯éƒ½èµ‹å€¼1ï¼Œåˆ†æ¯èµ‹å€¼ä¸º2. æ‹‰æ™®æ‹‰æ–¯ä¿®æ­£ p0Num = np.ones(numWords) # åˆ†å­ p1Num = np.ones(numWords) p0Denom = 2 # åˆ†æ¯ p1Denom = 2 for i in range(numTrainDocs): if trainCategory[i] == 1: p1Num += trainMatrix[i] p1Denom += sum(trainMatrix[i]) else: p0Num += trainMatrix[i] p0Denom += sum(trainMatrix[i]) # è¿™é‡Œä½¿ç”¨logå‡½æ•°ï¼Œæ–¹ä¾¿è®¡ç®—ï¼Œå› ä¸ºæœ€åæ˜¯æ¯”è¾ƒå¤§å°ï¼Œæ‰€æœ‰å¯¹ç»“æœæ²¡æœ‰å½±å“ã€‚ p1Vect = np.log(p1Num / p1Denom) # P^(x_1|c) p0Vect = np.log(p0Num / p0Denom) # P^(x_2|c) return p0Vect, p1Vect, pAbusive 2.5ã€ è¿›è¡Œåˆ†ç±» def classifyNB(vec2Classify, p0Vec, p1Vec, pClass1): \u0026#34;\u0026#34;\u0026#34; åˆ¤æ–­å¤§å° \u0026#34;\u0026#34;\u0026#34; p1 = sum(vec2Classify * p1Vec) # P(c)*P(x_1|c) p0 = sum(vec2Classify * p0Vec) # P(c)*P(x_2|c) if p1 \u0026gt; p0: return 1 else: return 0 2.6ã€æµ‹è¯• def testingNB(): listOPosts, listClasses = loadDataSet() myVocabList = createVocabList(listOPosts) trainMat = [] for postinDoc in listOPosts: trainMat.append(setOfWords2Vec(myVocabList, postinDoc)) print(trainMat) # æŸ¥çœ‹è®­ç»ƒé›†çŸ©é˜µ p0V, p1V, pAb = trainNB0(np.array(trainMat), np.array(listClasses)) testEntry = [\u0026#39;love\u0026#39;, \u0026#39;my\u0026#39;, \u0026#39;dalmation\u0026#39;] thisDoc = np.array(setOfWords2Vec(myVocabList, testEntry)) print(testEntry, \u0026#39;classified as: \u0026#39;, classifyNB(thisDoc, p0V, p1V, pAb)) testEntry = [\u0026#39;stupid\u0026#39;, \u0026#39;garbage\u0026#39;] thisDoc = np.array(setOfWords2Vec(myVocabList, testEntry)) print(testEntry, \u0026#39;classified as: \u0026#39;, classifyNB(thisDoc, p0V, p1V, pAb)) testingNB() [[0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 1, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0], [0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1], [0, 1, 0, 1, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0], [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]] ['love', 'my', 'dalmation'] classified as: 0 ['stupid', 'garbage'] classified as: 1  ","permalink":"http://yangchnet.github.io/Dessert/posts/dlml/%E6%9C%B4%E7%B4%A0%E8%B4%9D%E5%8F%B6%E6%96%AF/","summary":"æœ´ç´ è´å¶æ–¯ 1ã€ç†è®ºéƒ¨åˆ† 1.1ã€è´å¶æ–¯å…¬å¼ $$P(c|x)=\\frac{P(c)P(x|c)}{P(x)}\\qquad\\dots(1)$$\nå…¶ä¸­ï¼Œ$P(c)$æ˜¯ç±»â€œå…ˆéªŒæ¦‚ç‡â€ï¼›$P(x|c)$æ˜¯æ ·æœ¬$x$ç›¸å¯¹äºç±»æ ‡è®°$c$çš„ç±»æ¡ä»¶æ¦‚ç‡ï¼Œæˆ–ç§°ä¸ºâ€œä¼¼ç„¶â€ï¼›$P(x)$æ˜¯ç”¨äºå½’ä¸€åŒ–çš„â€œè¯æ®å› å­â€ã€‚å¯¹ç»™å®šæ ·æœ¬$x$ï¼Œè¯æ®å› å­$P(x)$ä¸ç±»æ ‡è®°æ— å…³ï¼Œå› æ­¤ä¼°è®¡$P(c|x)$çš„é—®é¢˜å°±è½¬åŒ–ä¸ºå¦‚ä½•åŸºäºè®­ç»ƒæ•°æ®$D$æ¥ä¼°è®¡å…ˆéªŒ$P(c)$å’Œä¼¼ç„¶$P(x|c)$\nç±»å…ˆéªŒæ¦‚ç‡$P(c)$è¡¨è¾¾äº†æ ·æœ¬ç©ºé—´ä¸­å„ç±»æ ·æœ¬æ‰€å çš„æ¯”ä¾‹ï¼Œæ ¹æ®å¤§æ•°å®šå¾‹ï¼Œå½“è®­ç»ƒé›†åŒ…å«å……è¶³çš„ç‹¬ç«‹åŒåˆ†å¸ƒæ ·æœ¬æ—¶ï¼Œ$P(c)$å¯é€šè¿‡å„ç±»æ ·æœ¬å‡ºç°çš„é¢‘ç‡æ¥è¿›è¡Œä¼°è®¡ã€‚\nå¯¹ç±»æ¡ä»¶æ¦‚ç‡$(P(x|c))$æ¥è¯´ï¼Œç”±äºå®ƒæ¶‰åŠå…³äº$x$æ‰€æœ‰å±æ€§çš„è”åˆæ¦‚ç‡ï¼Œç›´æ¥æ ¹æ®æ ·æœ¬å‡ºç°çš„é¢‘ç‡æ¥ä¼°è®¡å°†ä¼šé‡åˆ°ä¸¥é‡çš„å›°éš¾ã€‚ä¸ºé¿å¼€è¿™ä¸ªéšœç¢ï¼Œæœ´ç´ è´å¶æ–¯åˆ†ç±»å™¨é‡‡ç”¨äº†â€œå±æ€§æ¡ä»¶ç‹¬ç«‹æ€§å‡è®¾â€ï¼›å¯¹å·²çŸ¥ç±»åˆ«ï¼Œå‡è®¾æ‰€æœ‰å±æ€§ç›¸äº’ç‹¬ç«‹ã€‚æ¢è¨€ä¹‹ï¼Œå‡è®¾æ¯ä¸ªå±æ€§ç‹¬ç«‹çš„å¯¹åˆ†ç±»ç»“æœäº§ç”Ÿå½±å“ã€‚\nåŸºäºå±æ€§æ¡ä»¶ç‹¬ç«‹æ€§å‡è®¾ï¼Œè´å¶æ–¯å…¬å¼å¯é‡å†™ä¸ºï¼š $$P(c|x)=\\frac{P(c)P(x|c)}{P(x)}\\qquad=\\frac{P(c)}{P(x)}\\prod_{i=1}^d{P(x_i|c)}\\dots(2)$$ å…¶ä¸­$d$ä¸ºå±æ€§æ•°ç›®ï¼Œ$x_i$ä¸º$x$åœ¨ç¬¬iä¸ªå±æ€§ä¸Šçš„å–å€¼\nç”±äºå¯¹äºæ‰€æœ‰ç±»åˆ«æ¥è¯´$P(x)$ç›¸åŒï¼Œå› æ­¤è´å¶æ–¯åˆ¤å®šå‡†åˆ™ï¼š$$h_{nb}(x)=arg max_{c\\in y}P(c)\\prod_{i=1}^d{P(x_i|c)}\\dots(3)$$\næ˜¾ç„¶ï¼Œæœ´ç´ è´å¶æ–¯åˆ†ç±»å™¨çš„è®­ç»ƒè¿‡ç¨‹å°±æ˜¯åŸºäºè®­ç»ƒé›†$D$æ¥ä¼°è®¡ç±»å…ˆéªŒæ¦‚ç‡$P(c)$ï¼Œå¹¶ä¸ºæ¯ä¸ªå±æ€§ä¼°è®¡æ¡ä»¶æ¦‚ç‡$P(x_i|c)$\nä»¤$D_c$è¡¨ç¤ºè®­ç»ƒé›†$D$ä¸­ç¬¬$c$ç±»æ ·æœ¬ç»„æˆçš„é›†åˆï¼Œè‹¥æœ‰å……è¶³çš„ç‹¬ç«‹åŒåˆ†å¸ƒæ ·æœ¬ï¼Œåˆ™å¯å®¹æ˜“çš„ä¼°è®¡å‡ºå…ˆéªŒæ¦‚ç‡ï¼š$$P(c)=\\frac{|D_c|}{|D|}\\dots(4)$$\nå¯¹ç¦»æ•£å±æ€§è€Œè¨€ï¼Œä»¤$D_{c,x_i}$è¡¨ç¤º$D_c$ä¸­åœ¨ç¬¬$i$ä¸ªå±æ€§ä¸Šå–å€¼ä¸º$x_i$çš„æ ·æœ¬ç»„æˆçš„é›†åˆï¼Œåˆ™æ¡ä»¶æ¦‚ç‡$P(x_i|c)$å¯ä¼°è®¡ä¸º$$P(x_i|c)=\\frac{|D_{c,x_i}|}{|D_c|}\\qquad\\dots(5)$$ ä¸ºäº†é¿å…å…¶ä»–å±æ€§æºå¸¦çš„ä¿¡æ¯è¢«è®­ç»ƒé›†ä¸­æœªå‡ºç°çš„å±æ€§å€¼æŠ¹å»ï¼Œåœ¨ä¼°è®¡æ¦‚ç‡å€¼æ—¶é€šå¸¸è¦è¿›è¡Œâ€œå¹³æ»‘â€ï¼Œå¸¸ç”¨â€œæ‹‰æ™®æ‹‰æ–¯ä¿®æ­£â€ã€‚å…·ä½“æ¥è¯´ï¼Œä»¤$N$è¡¨ç¤ºè®­ç»ƒé›†$D$ä¸­å¯èƒ½çš„ç±»åˆ«æ•°ï¼Œ$N_i$è¡¨ç¤ºç¬¬$i$ä¸ªå±æ€§å¯èƒ½çš„å–å€¼æ•°ï¼Œåˆ™(4)(5)ä¸¤å¼åˆ†åˆ«ä¿®æ­£ä¸ºï¼š$$\\hat{P}(c)=\\frac{D_c+1}{|D|+N}\\qquad\\dots(6)$$ $$\\hat{P}(x_i|c)=\\frac{D_{c,x_i}+1}{|D|+N}\\qquad\\dots(7)$$\n2ã€å®æˆ˜æ¼”ç»ƒ 2.1ã€åŠ è½½æ•°æ®é›† import numpy as np def loadDataSet(): \u0026#34;\u0026#34;\u0026#34; å¯¼å…¥æ•°æ®ï¼Œ 1ä»£è¡¨è„è¯ @ return postingList: æ•°æ®é›† @ return classVec: åˆ†ç±»å‘é‡ \u0026#34;\u0026#34;\u0026#34; postingList = [[\u0026#39;my\u0026#39;, \u0026#39;dog\u0026#39;, \u0026#39;has\u0026#39;, \u0026#39;flea\u0026#39;, \u0026#39;problems\u0026#39;, \u0026#39;help\u0026#39;, \u0026#39;please\u0026#39;], [\u0026#39;maybe\u0026#39;, \u0026#39;not\u0026#39;, \u0026#39;take\u0026#39;, \u0026#39;him\u0026#39;, \u0026#39;to\u0026#39;, \u0026#39;dog\u0026#39;, \u0026#39;park\u0026#39;, \u0026#39;stupid\u0026#39;], [\u0026#39;my\u0026#39;, \u0026#39;dalmation\u0026#39;, \u0026#39;is\u0026#39;, \u0026#39;so\u0026#39;, \u0026#39;cute\u0026#39;, \u0026#39;I\u0026#39;, \u0026#39;love\u0026#39;, \u0026#39;him\u0026#39;], [\u0026#39;stop\u0026#39;, \u0026#39;posting\u0026#39;, \u0026#39;stupid\u0026#39;, \u0026#39;worthless\u0026#39;, \u0026#39;garbage\u0026#39;], [\u0026#39;mr\u0026#39;, \u0026#39;licks\u0026#39;, \u0026#39;ate\u0026#39;, \u0026#39;my\u0026#39;, \u0026#39;steak\u0026#39;, \u0026#39;how\u0026#39;, \u0026#39;to\u0026#39;, \u0026#39;stop\u0026#39;, \u0026#39;him\u0026#39;], [\u0026#39;quit\u0026#39;, \u0026#39;buying\u0026#39;, \u0026#39;worthless\u0026#39;, \u0026#39;dog\u0026#39;, \u0026#39;food\u0026#39;, \u0026#39;stupid\u0026#39;]] classVec = [0, 1, 0, 1, 0, 1] return postingList, classVec å¯¼å…¥è®­ç»ƒé›†åŠå…¶åˆ†ç±»ï¼Œ1ä»£è¡¨æ˜¯è„è¯ï¼Œ0ä»£è¡¨ä¸æ˜¯","title":"æœ´ç´ è´å¶æ–¯"},{"content":"æ£€æŸ¥Apacheé…ç½®æ–‡ä»¶è¯­æ³•é”™è¯¯ åœ¨/etc/apache2ç›®å½•ä¸‹è¾“å…¥apache2ctl configtestå³å¯æ£€æŸ¥é”™è¯¯\n","permalink":"http://yangchnet.github.io/Dessert/posts/linux/%E6%A3%80%E6%9F%A5apache%E7%9A%84%E6%96%87%E4%BB%B6%E9%85%8D%E7%BD%AE%E8%AF%AD%E6%B3%95%E9%94%99%E8%AF%AF/","summary":"æ£€æŸ¥Apacheé…ç½®æ–‡ä»¶è¯­æ³•é”™è¯¯ åœ¨/etc/apache2ç›®å½•ä¸‹è¾“å…¥apache2ctl configtestå³å¯æ£€æŸ¥é”™è¯¯","title":"æ£€æŸ¥Apacheé…ç½®æ–‡ä»¶è¯­æ³•é”™è¯¯"},{"content":"æ£€æŸ¥nginxçš„è¯­æ³•é”™è¯¯ ä½¿ç”¨nginx -t\n","permalink":"http://yangchnet.github.io/Dessert/posts/linux/%E6%A3%80%E6%9F%A5nginx%E7%9A%84%E8%AF%AD%E6%B3%95%E9%94%99%E8%AF%AF/","summary":"æ£€æŸ¥nginxçš„è¯­æ³•é”™è¯¯ ä½¿ç”¨nginx -t","title":"æ£€æŸ¥nginxçš„è¯­æ³•é”™è¯¯"},{"content":"æ¨¡å‹è¯„ä¼° æ­¤èŠ‚å†…å®¹åªé’ˆå¯¹åˆ†ç±»æ¨¡å‹ï¼Œä½¿ç”¨sklearnåº“\n1ã€å‡†ç¡®ç‡ accuracy_scoreå‡½æ•°è®¡ç®—ç²¾åº¦ï¼Œåœ¨å¤šæ ‡ç­¾åˆ†ç±»ä¸­ï¼Œè¯¥å‡½æ•°è¿”å›å­é›†ç²¾åº¦ã€‚å¦‚æœæ ·æœ¬çš„æ•´ä¸ªé¢„æµ‹æ ‡ç­¾é›†ä¸çœŸå®çš„æ ‡ç­¾é›†ä¸¥æ ¼åŒ¹é…ï¼Œåˆ™å­é›†ç²¾åº¦ä¸º1.0; å¦åˆ™å®ƒæ˜¯0.0ã€‚å¦‚æœ$\\hat{y}i$æ˜¯ç¬¬$i$ç±»æ ·æœ¬é¢„æµ‹å€¼ï¼Œ$y_i$æ˜¯ç›¸åº”çš„çœŸå€¼ï¼Œé‚£ä¹ˆæ­£ç¡®é¢„æµ‹çš„åˆ†æ•°$n\\text{samples}$è¢«å®šä¹‰ä¸º$$\\texttt{accuracy}(y, \\hat{y}) = \\frac{1}{n_\\text{samples}} \\sum_{i=0}^{n_\\text{samples}-1} 1(\\hat{y}_i = y_i)$$\nimport numpy as np from sklearn.metrics import accuracy_score y_pred = [0, 2, 1, 3] y_true = [0, 1, 2, 3] accuracy_score(y_true, y_pred) 0.5  accuracy_score(y_true, y_pred, normalize=False) # è‹¥normalizeä¸ºFalse,åˆ™è¿”å›æ­£ç¡®åˆ†ç±»çš„æ ·æœ¬æ•° 2  2ã€æ··æ·†çŸ©é˜µ è¯¥confusion_matrixå‡½æ•°é€šè¿‡è®¡ç®—æ··æ·†çŸ©é˜µæ¥è¯„ä¼°åˆ†ç±»å‡†ç¡®æ€§ï¼Œè¡Œå¯¹åº”äºçœŸæ­£çš„ç±»ï¼Œåˆ—è¡¨ç¤ºé¢„æµ‹å€¼ã€‚\nfrom sklearn.metrics import confusion_matrix y_true = [2, 0, 2, 2, 0, 1] y_pred = [0, 0, 2, 2, 0, 2] confusion_matrix(y_true, y_pred) array([[2, 0, 0], [0, 0, 1], [1, 0, 2]])  3ã€æ±‰æ˜æŸå¤± å¦‚æœ$\\hat{y}j$æ˜¯é¢„æµ‹ä¸ºç¬¬$j$ç±»çš„æ ·æœ¬ï¼Œ$y_j$æ˜¯çœŸå€¼ï¼Œ$n\\text{labels}$æ˜¯ç±»åˆ«çš„æ•°ç›®ï¼Œåˆ™ä¸¤ä¸ªæ ·æœ¬ä¹‹é—´çš„æ±‰æ˜æŸå¤±å®šä¹‰ä¸ºï¼š$$L_{Hamming}(y, \\hat{y}) = \\frac{1}{n_\\text{labels}} \\sum_{j=0}^{n_\\text{labels} - 1} 1(\\hat{y}_j \\not= y_j)$$ $1(x)$æ˜¯æŒ‡æ ‡å‡½æ•°\nfrom sklearn.metrics import hamming_loss y_pred = [1, 2, 3, 4] y_true = [2, 2, 3, 4] hamming_loss(y_true, y_pred) 0.25  4ã€æŸ¥å‡†ç‡ã€æŸ¥å…¨ç‡å’Œf1åº¦é‡ åœ¨äºŒå…ƒåˆ†ç±»ä»»åŠ¡ä¸­ï¼Œæœ¯è¯­â€œæ­£â€å’Œâ€œè´Ÿâ€æŒ‡çš„æ˜¯åˆ†ç±»å™¨çš„é¢„æµ‹ï¼Œæœ¯è¯­â€œçœŸâ€å’Œâ€œå‡â€æŒ‡çš„æ˜¯è¯¥é¢„æµ‹æ˜¯å¦ä¸å¤–éƒ¨åˆ¤æ–­ç›¸å¯¹åº”ã€‚\n   ã€‚ å®é™…ç±»åˆ« ã€‚     é¢„æµ‹ç±»åˆ« tp(çœŸ æ­£) fp(å‡ æ­£)   - fn(å‡ è´Ÿ) tn(çœŸ è´Ÿ)    åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰æŸ¥å‡†ç‡ï¼ŒæŸ¥å…¨ç‡å’Œf1åº¦é‡çš„æ¦‚å¿µï¼š $$\\text{precision} = \\frac{tp}{tp + fp},$$ $$\\text{recall} = \\frac{tp}{tp + fn},$$ $$F_\\beta = (1 + \\beta^2) \\frac{\\text{precision} \\times \\text{recall}}{\\beta^2 \\text{precision} + \\text{recall}}.$$\næŸ¥å‡†ç‡ä¸æŸ¥å…¨ç‡æ˜¯ä¸€å¯¹çŸ›ç›¾çš„åº¦é‡ã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒæŸ¥å‡†ç‡é«˜æ—¶ï¼ŒæŸ¥å…¨ç‡å¾€å¾€åä½ï¼›è€ŒæŸ¥å…¨ç‡é«˜æ—¶ï¼ŒæŸ¥å‡†ç‡å¾€å¾€åä½ã€‚ä¾‹å¦‚ï¼šè‹¥å¸Œæœ›å°†æ­£æ ·æœ¬å°½å¯èƒ½å¤šçš„é€‰å‡ºæ¥ï¼Œåˆ™å¯é€šè¿‡å¢åŠ é€‰æ‹©æ ·æœ¬çš„æ•°é‡æ¥å®ç°ï¼Œå¦‚æœå°†æ‰€æœ‰çš„æ ·æœ¬éƒ½é€‰ä¸­ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„æ­£æ ·æœ¬ä¹Ÿå¿…ç„¶éƒ½è¢«é€‰ä¸Šäº†ï¼Œä½†è¿™æ ·æŸ¥å‡†ç‡å°±ä¼šè¾ƒä½ï¼›è‹¥å¸Œæœ›é€‰å‡ºçš„æ ·æœ¬ä¸­æ­£æ ·æœ¬æ¯”ä¾‹å°½å¯èƒ½é«˜ï¼Œåˆ™å¯åªæŒ‘é€‰æœ€æœ‰æŠŠæ¡çš„æ ·æœ¬ï¼Œä½†è¿™æ ·éš¾å…å°±ä¼šæ¼æ‰ä¸å°‘æ­£æ ·æœ¬ï¼Œä½¿å¾—æŸ¥å…¨ç‡è¾ƒä½ã€‚é€šå¸¸åªæœ‰åœ¨ä¸€äº›ç®€å•ä»»åŠ¡ä¸­ï¼Œæ‰å¯èƒ½ä½¿æŸ¥å…¨ç‡å’ŒæŸ¥å‡†ç‡éƒ½å¾ˆé«˜ã€‚f1åº¦é‡çš„ä¸€èˆ¬å½¢å¼\u0026mdash;$F_\\beta$ï¼Œèƒ½è®©æˆ‘ä»¬è¡¨è¾¾å‡ºå¯¹æŸ¥å‡†ç‡/æŸ¥å…¨ç‡çš„ä¸åŒåå¥½ã€‚\n è¯¦æƒ…å¯å‚è€ƒå‘¨å¿—åã€Šæœºå™¨å­¦ä¹ ã€‹P30-P32\n from sklearn import metrics y_pred = [0, 1, 0, 0] y_true = [0, 1, 0, 1] metrics.precision_score(y_true, y_pred) 1.0   metrics.recall_score(y_true, y_pred) 0.5   metrics.f1_score(y_true, y_pred) 0.6666666666666666   metrics.fbeta_score(y_true, y_pred, beta=0.5) 0.8333333333333334   metrics.fbeta_score(y_true, y_pred, beta=1) 0.6666666666666666   metrics.fbeta_score(y_true, y_pred, beta=2) 0.5555555555555556   metrics.precision_recall_fscore_support(y_true, y_pred, beta=0.5) (array([0.66666667, 1. ]), array([1. , 0.5]), array([0.71428571, 0.83333333]), array([2, 2]))  precision_recall_fscore_supportè®¡ç®—æ¯ä¸ªç±»çš„æŸ¥å‡†ç‡ï¼ŒæŸ¥å…¨ç‡ã€f1åº¦é‡å’Œsupportï¼Œè¿”å›å€¼ï¼špresion, recall, fbeta_score, support(æ¯ä¸ªæ ‡ç­¾å‡ºç°çš„æ¬¡æ•°)\n 5ã€åˆ†ç±»æŠ¥å‘Š è¯¥classification_reportå‡½æ•°æ„å»ºä¸€ä¸ªæ˜¾ç¤ºä¸»è¦åˆ†ç±»æŒ‡æ ‡çš„æ–‡æœ¬æŠ¥å‘Š\nfrom sklearn.metrics import classification_report y_true = [0, 1, 2, 2, 0] y_pred = [0, 0, 2, 1, 0] target_names = [\u0026#39;class 0\u0026#39;, \u0026#39;class 1\u0026#39;, \u0026#39;class 2\u0026#39;] print(classification_report(y_true, y_pred, target_names=target_names))  precision recall f1-score support class 0 0.67 1.00 0.80 2 class 1 0.00 0.00 0.00 1 class 2 1.00 0.50 0.67 2 micro avg 0.60 0.60 0.60 5 macro avg 0.56 0.50 0.49 5 weighted avg 0.67 0.60 0.59 5  6ã€ ROCæ›²çº¿ ROCå…¨ç§°æ˜¯â€œå—è¯•è€…å·¥ä½œç‰¹å¾â€ï¼Œæ ¹æ®å­¦ä¹ å™¨çš„é¢„æµ‹ç»“æœå¯¹æ ·ä¾‹è¿›è¡Œæ’åºï¼ŒæŒ‰æ­¤é¡ºåºæŠŠæ ·æœ¬ä½œä¸ºæ­£ä¾‹è¿›è¡Œé¢„æµ‹ï¼Œæ¯æ¬¡è®¡ç®—å‡ºä¸¤ä¸ªé‡è¦çš„å€¼ï¼Œåˆ†åˆ«ä»¥å®ƒä»¬ä¸ºæ¨ªçºµåæ ‡ä½œå›¾ï¼Œå°±å¾—åˆ°äº†ROCæ›²çº¿ã€‚ROCæ›²çº¿çš„çºµè½´æ˜¯â€œçœŸæ­£ä¾‹ç‡ï¼ˆTPRï¼‰â€ï¼Œæ¨ªè½´æ˜¯â€œå‡æ­£ä¾‹ç‡ï¼ˆFPRï¼‰â€ï¼ŒäºŒè€…å®šä¹‰ä¸ºï¼š$$\\text{TPR} = \\frac{tp}{tp + fn}$$, $$\\text{FPR} = \\frac{fp}{tn + fp}$$\nROCæ›²çº¿é€šå¸¸åœ¨Yè½´ä¸Šå…·æœ‰çœŸæ­£ä¾‹ç‡ï¼Œåœ¨Xè½´ä¸Šå…·æœ‰å‡æ­£ä¾‹ç‡ï¼Œè¿™æ„å‘³ç€å›¾çš„å·¦ä¸Šè§’æ˜¯â€œç†æƒ³â€ç‚¹-å‡é˜³æ€§ç‡ä¸ºé›¶ï¼ŒçœŸé˜³æ€§ç‡ä¸º1ã€‚å› æ­¤ï¼Œæ›²çº¿ä¸‹é¢ç§¯è¶Šå¤§è¶Šå¥½ï¼ŒThe â€œsteepnessâ€ of ROC curves is also important, since it is ideal to maximize the true positive rate while minimizing the false positive rate.\nimport numpy as np # from pylab import * from sklearn.metrics import roc_curve, roc_auc_score y = np.array([1, 1, 2, 2]) scores = np.array([0.1, 0.4, 0.35, 0.8]) fpr, tpr, thresholds = roc_curve(y, scores, pos_label=2) roc_auc = roc_auc_score(y, scores) plt.figure() lw = 2 plt.plot(fpr, tpr, color=\u0026#39;darkorange\u0026#39;, lw=lw, label=\u0026#39;ROC curve (area = %0.2f)\u0026#39; % roc_auc) plt.plot([0, 1], [0, 1], color=\u0026#39;navy\u0026#39;, lw=lw, linestyle=\u0026#39;--\u0026#39;) plt.xlim([0.0, 1.0]) plt.ylim([0.0, 1.05]) plt.xlabel(\u0026#39;False Positive Rate\u0026#39;) plt.ylabel(\u0026#39;True Positive Rate\u0026#39;) plt.title(\u0026#39;Receiver operating characteristic example\u0026#39;) plt.legend(loc=\u0026#34;lower right\u0026#34;) plt.show()  ç”±äºæ•°æ®è¿‡äºç®€å•ï¼Œå› æ­¤ç”»å‡ºçš„å›¾å½¢ä¹Ÿæ¯”è¾ƒç®€å•ï¼š(\n ä½œä¸š  åœ¨ä¸ŠèŠ‚è¯¾å®éªŒçš„åŸºç¡€ä¸Šï¼Œè®¡ç®—å‡ºæœ´ç´ è´å¶æ–¯é’ˆå¯¹æ‰€ç»™æ•°æ®é›†çš„å‡†ç¡®ç‡ï¼Œæ±‰æ˜æŸå¤±ï¼Œæ··æ·†çŸ©é˜µï¼ŒæŸ¥å‡†ç‡ã€æŸ¥å…¨ç‡ï¼Œf1åº¦é‡å’ŒROCï¼Œå¹¶ç”»å‡ºROCæ›²çº¿ ç»™å®šå®Œæ•´æ•°æ®é›†ï¼Œåˆ†åˆ«è®¡ç®—åœ¨ä½¿ç”¨å®Œæ•´æ•°æ®é›†çš„10%,30%,50%,80%,100%æ•°æ®æ—¶çš„æŸ¥å‡†ç‡ã€æŸ¥å…¨ç‡ï¼Œf1åº¦é‡å’ŒROCï¼Œä½¿ç”¨æŠ˜çº¿å›¾è¡¨ç°å‡ºè¿™äº›æŒ‡æ ‡çš„å˜åŒ–æƒ…å†µï¼Œå¹¶ç”»å‡ºåœ¨ä¸åŒæ•°æ®é‡ä¸‹çš„ROCæ›²çº¿  ","permalink":"http://yangchnet.github.io/Dessert/posts/dlml/%E5%88%86%E7%B1%BB%E6%8C%87%E6%A0%87/","summary":"æ¨¡å‹è¯„ä¼° æ­¤èŠ‚å†…å®¹åªé’ˆå¯¹åˆ†ç±»æ¨¡å‹ï¼Œä½¿ç”¨sklearnåº“\n1ã€å‡†ç¡®ç‡ accuracy_scoreå‡½æ•°è®¡ç®—ç²¾åº¦ï¼Œåœ¨å¤šæ ‡ç­¾åˆ†ç±»ä¸­ï¼Œè¯¥å‡½æ•°è¿”å›å­é›†ç²¾åº¦ã€‚å¦‚æœæ ·æœ¬çš„æ•´ä¸ªé¢„æµ‹æ ‡ç­¾é›†ä¸çœŸå®çš„æ ‡ç­¾é›†ä¸¥æ ¼åŒ¹é…ï¼Œåˆ™å­é›†ç²¾åº¦ä¸º1.0; å¦åˆ™å®ƒæ˜¯0.0ã€‚å¦‚æœ$\\hat{y}i$æ˜¯ç¬¬$i$ç±»æ ·æœ¬é¢„æµ‹å€¼ï¼Œ$y_i$æ˜¯ç›¸åº”çš„çœŸå€¼ï¼Œé‚£ä¹ˆæ­£ç¡®é¢„æµ‹çš„åˆ†æ•°$n\\text{samples}$è¢«å®šä¹‰ä¸º$$\\texttt{accuracy}(y, \\hat{y}) = \\frac{1}{n_\\text{samples}} \\sum_{i=0}^{n_\\text{samples}-1} 1(\\hat{y}_i = y_i)$$\nimport numpy as np from sklearn.metrics import accuracy_score y_pred = [0, 2, 1, 3] y_true = [0, 1, 2, 3] accuracy_score(y_true, y_pred) 0.5  accuracy_score(y_true, y_pred, normalize=False) # è‹¥normalizeä¸ºFalse,åˆ™è¿”å›æ­£ç¡®åˆ†ç±»çš„æ ·æœ¬æ•° 2  2ã€æ··æ·†çŸ©é˜µ è¯¥confusion_matrixå‡½æ•°é€šè¿‡è®¡ç®—æ··æ·†çŸ©é˜µæ¥è¯„ä¼°åˆ†ç±»å‡†ç¡®æ€§ï¼Œè¡Œå¯¹åº”äºçœŸæ­£çš„ç±»ï¼Œåˆ—è¡¨ç¤ºé¢„æµ‹å€¼ã€‚\nfrom sklearn.metrics import confusion_matrix y_true = [2, 0, 2, 2, 0, 1] y_pred = [0, 0, 2, 2, 0, 2] confusion_matrix(y_true, y_pred) array([[2, 0, 0], [0, 0, 1], [1, 0, 2]])  3ã€æ±‰æ˜æŸå¤± å¦‚æœ$\\hat{y}j$æ˜¯é¢„æµ‹ä¸ºç¬¬$j$ç±»çš„æ ·æœ¬ï¼Œ$y_j$æ˜¯çœŸå€¼ï¼Œ$n\\text{labels}$æ˜¯ç±»åˆ«çš„æ•°ç›®ï¼Œåˆ™ä¸¤ä¸ªæ ·æœ¬ä¹‹é—´çš„æ±‰æ˜æŸå¤±å®šä¹‰ä¸ºï¼š$$L_{Hamming}(y, \\hat{y}) = \\frac{1}{n_\\text{labels}} \\sum_{j=0}^{n_\\text{labels} - 1} 1(\\hat{y}_j \\not= y_j)$$ $1(x)$æ˜¯æŒ‡æ ‡å‡½æ•°","title":"æ¨¡å‹è¯„ä¼°"},{"content":"æ­£åˆ™è¡¨è¾¾å¼ 1ã€ä»€ä¹ˆæ˜¯æ­£åˆ™è¡¨è¾¾å¼ æ­£åˆ™è¡¨è¾¾å¼ï¼Œåˆç§°è§„åˆ™è¡¨è¾¾å¼ã€‚ï¼ˆè‹±è¯­ï¼šRegular Expressionï¼Œåœ¨ä»£ç ä¸­å¸¸ç®€å†™ä¸ºregexã€regexpæˆ–REï¼‰ï¼Œè®¡ç®—æœºç§‘å­¦çš„ä¸€ä¸ªæ¦‚å¿µã€‚æ­£åˆ™è¡¨è¾¾å¼é€šå¸¸è¢«ç”¨æ¥æ£€ç´¢ã€æ›¿æ¢é‚£äº›ç¬¦åˆæŸä¸ªæ¨¡å¼(è§„åˆ™)çš„æ–‡æœ¬ã€‚ï¼ˆæ‘˜è‡ªç™¾åº¦ç™¾ç§‘ï¼‰\nä½ å¯èƒ½ç†Ÿæ‚‰æ–‡æœ¬æŸ¥æ‰¾,å³æŒ‰ä¸‹ Ctrl-F,è¾“å…¥ä½ è¦æŸ¥æ‰¾çš„è¯ã€‚â€œæ­£åˆ™è¡¨è¾¾å¼â€æ›´è¿›ä¸€æ­¥,å®ƒä»¬è®©ä½ æŒ‡å®šè¦æŸ¥æ‰¾çš„â€œæ¨¡å¼â€ã€‚ä½ ä¹Ÿè®¸ä¸çŸ¥é“ä¸€å®¶å…¬å¸çš„å‡†ç¡®ç”µè¯å·ç ,ä½†å¦‚æœä½ ä½åœ¨ç¾å›½æˆ–åŠ æ‹¿å¤§,ä½ å°±çŸ¥é“æœ‰3 ä½æ•°å­—,ç„¶åæ˜¯ä¸€ä¸ªçŸ­æ¨ªçº¿,ç„¶åæ˜¯ 4 ä½æ•°å­—(æœ‰æ—¶å€™ä»¥ 3 ä½åŒºå·å¼€å§‹)ã€‚å› æ­¤ä½œä¸ºä¸€ä¸ªäºº,ä½ çœ‹åˆ°ä¸€ä¸ªç”µè¯å·ç å°±çŸ¥é“:415-555-1234 æ˜¯ç”µè¯å·ç ,ä½† 4,155,551,234 ä¸æ˜¯ã€‚ æ­£åˆ™è¡¨è¾¾å¼å¾ˆæœ‰ç”¨,ä½†å¦‚æœä¸æ˜¯ç¨‹åºå‘˜,å¾ˆå°‘ä¼šæœ‰äººäº†è§£,å®ƒ,å°½ç®¡å¤§å¤šæ•°ç°ä»£æ–‡æœ¬ç¼–è¾‘å™¨å’Œæ–‡å­—å¤„ç†å™¨(è¯¸å¦‚å¾®è½¯çš„ Word æˆ– OpenOffice)éƒ½æœ‰æŸ¥æ‰¾å’ŒæŸ¥æ‰¾æ›¿æ¢åŠŸèƒ½,å¯ä»¥æ ¹æ®æ­£åˆ™è¡¨è¾¾å¼æŸ¥æ‰¾ã€‚æ­£åˆ™è¡¨è¾¾å¼å¯ä»¥èŠ‚çº¦å¤§é‡æ—¶é—´,ä¸ä»…é€‚ç”¨äºè½¯ä»¶ç”¨æˆ·,ä¹Ÿé€‚ç”¨äºç¨‹åºå‘˜ã€‚å®é™…ä¸Š,æŠ€æœ¯ä½œå®¶ Cory Doctorow å£°ç§°,ç”šè‡³åº”è¯¥åœ¨æ•™æˆç¼–ç¨‹ä¹‹å‰,å…ˆæ•™æˆæ­£åˆ™è¡¨è¾¾å¼: â€œçŸ¥é“[æ­£åˆ™è¡¨è¾¾å¼]å¯èƒ½æ„å‘³ç€ç”¨ 3 æ­¥è§£å†³ä¸€ä¸ªé—®é¢˜,è€Œä¸æ˜¯ç”¨ 3000 æ­¥ã€‚å¦‚æœä½ æ˜¯ä¸€ä¸ªæŠ€æœ¯æ€ªä¾ ,åˆ«å¿˜äº†ä½ ç”¨å‡ æ¬¡å‡»é”®å°±èƒ½è§£å†³çš„é—®é¢˜,å…¶ä»–äººéœ€è¦æ•°å¤©çš„çƒ¦çå·¥ä½œæ‰èƒ½è§£å†³,è€Œä¸”ä»–ä»¬å®¹æ˜“çŠ¯é”™ã€‚â€ 1 (æ‘˜è‡ªã€ŠPythonç¼–ç¨‹å¿«é€Ÿä¸Šæ‰‹â€”è®©ç¹çå·¥ä½œè‡ªåŠ¨åŒ–ã€‹)\n2ã€ä¸ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥æŸ¥æ‰¾æ–‡æœ¬æ¨¡å¼ å‡è®¾ä½ å¸Œæœ›åœ¨å­—ç¬¦ä¸²ä¸­æŸ¥æ‰¾ç”µè¯å·ç ã€‚ä½ çŸ¥é“æ¨¡å¼:3 ä¸ªæ•°å­—,ä¸€ä¸ªçŸ­æ¨ªçº¿,3 ä¸ªæ•°å­—,ä¸€ä¸ªçŸ­æ¨ªçº¿,å†æ˜¯ 4 ä¸ªæ•°å­—ã€‚ä¾‹å¦‚:415-555-4242ã€‚ å‡å®šæˆ‘ä»¬ç”¨ä¸€ä¸ªåä¸º isPhoneNumber()çš„å‡½æ•°,æ¥æ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦åŒ¹é…æ¨¡å¼,å®ƒ è¿”å› True æˆ– Falseã€‚\ndef isPhoneNumber(text): if len(text) != 12: return False for i in range(0, 3): if not text[i].isdecimal(): return False if text[3] != \u0026#39;-\u0026#39;: return False for i in range(4, 7): if not text[i].isdecimal(): return False if text[7] != \u0026#39;-\u0026#39;: return False for i in range(8, 12): if not text[i].isdecimal(): return False return True print(\u0026#39;415-555-4242 is a phone number:\u0026#39;) print(isPhoneNumber(\u0026#39;415-555-4242\u0026#39;)) print(\u0026#39;Moshi moshi is a phone number:\u0026#39;) print(isPhoneNumber(\u0026#39;Moshi moshi\u0026#39;)) 415-555-4242 is a phone number: True Moshi moshi is a phone number: False  æ·»åŠ æ›´å¤šä»£ç ,æ‰èƒ½åœ¨æ›´é•¿çš„å­—ç¬¦ä¸²ä¸­å¯»æ‰¾è¿™ç§æ–‡æœ¬æ¨¡å¼\nmessage = \u0026#39;Call me at 415-555-1011 tomorrow. 415-555-9999 is my office.\u0026#39; for i in range(len(message)): chunk = message[i:i+12] if isPhoneNumber(chunk): print(\u0026#39;Phone number found: \u0026#39; + chunk) print(\u0026#39;Done\u0026#39;) Phone number found: 415-555-1011 Phone number found: 415-555-9999 Done  3ã€ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡ŒåŒ¹é… 3.1ã€ åˆ›å»ºæ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡ # å¯¼å…¥reæ¨¡å—æ¥ä½¿ç”¨æ­£åˆ™ import re # åˆ›å»ºæ­£åˆ™è¡¨è¾¾å¼ phoneNumRegex = re.compile(r\u0026#39;\\d\\d\\d-\\d\\d\\d-\\d\\d\\d\\d\u0026#39;) 3.2ã€ä½¿ç”¨æ­£åˆ™è¿›è¡ŒæŸ¥è¯¢ phoneNumRegex = re.compile(r\u0026#39;\\d\\d\\d-\\d\\d\\d-\\d\\d\\d\\d\u0026#39;) mo = phoneNumRegex.search(\u0026#39;My number is 415-555-4242.\u0026#39;) print(\u0026#39;Phone number found: \u0026#39; + mo.group()) Phone number found: 415-555-4242  3.3ã€åˆ©ç”¨æ‹¬å·åˆ†ç»„ å‡å®šæƒ³è¦å°†åŒºå·ä»ç”µè¯å·ç ä¸­åˆ†ç¦»ã€‚æ·»åŠ æ‹¬å·å°†åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­åˆ›å»ºâ€œåˆ†ç»„â€(\\d\\d\\d)-(\\d\\d\\d-\\d\\d\\d\\d)ã€‚ç„¶åå¯ä»¥ä½¿ç”¨ group()åŒ¹é…å¯¹è±¡æ–¹æ³•,ä»ä¸ªåˆ†ç»„ä¸­è·å–åŒ¹é…çš„æ–‡æœ¬ã€‚æ­£åˆ™è¡¨è¾¾å¼å­—ç¬¦ä¸²ä¸­çš„ç¬¬ä¸€å¯¹æ‹¬å·æ˜¯ç¬¬ 1 ç»„ã€‚ç¬¬äºŒå¯¹æ‹¬å·æ˜¯ç¬¬ 2 ç»„ã€‚å‘ group()åŒ¹é…å¯¹è±¡æ–¹æ³•ä¼ å…¥æ•´æ•° 1 æˆ– 2,å°±å¯ä»¥å–å¾—åŒ¹é…æ–‡æœ¬çš„ä¸åŒéƒ¨åˆ†ã€‚å‘ group()æ–¹æ³•ä¼ å…¥ 0 æˆ–ä¸ä¼ å…¥å‚æ•°,å°†è¿”å›æ•´ä¸ªåŒ¹é…çš„æ–‡æœ¬\nphoneNumRegex = re.compile(r\u0026#39;(\\d\\d\\d)-(\\d\\d\\d-\\d\\d\\d\\d)\u0026#39;) mo = phoneNumRegex.search(\u0026#39;My number is 415-555-4242.\u0026#39;) # ç¬¬ä¸€ä¸ªåˆ†ç»„ mo.group(1) # ç¬¬äºŒä¸ªåˆ†ç»„ # mo.group(2) # å…¨éƒ¨ # mo.group(0) # mo.group() '415'  3.4ã€ç”¨ç®¡é“åŒ¹é…å¤šä¸ªåˆ†ç»„ å­—ç¬¦|ç§°ä¸ºâ€œç®¡é“â€æ­£åˆ™è¡¨è¾¾å¼ r\u0026rsquo;Batman|Tina Fey\u0026rsquo;å°†åŒ¹é…\u0026rsquo;Batman\u0026rsquo;æˆ–\u0026rsquo;Tina Fey'ã€‚å¦‚æœ Batman å’Œ Tina Fey éƒ½å‡ºç°åœ¨è¢«æŸ¥æ‰¾çš„å­—ç¬¦ä¸²ä¸­,ç¬¬ä¸€æ¬¡å‡ºç°çš„åŒ¹é…æ–‡æœ¬,å°†ä½œä¸º Match å¯¹è±¡è¿”å›\nheroRegex = re.compile (r\u0026#39;Batman|Tina Fey\u0026#39;) mo1 = heroRegex.search(\u0026#39;Batman and Tina Fey.\u0026#39;) mo1.group() 'Tina Fey'  mo2 = heroRegex.search(\u0026#39;Tina Fey and Batman.\u0026#39;) mo2.group() 'Tina Fey'  3.5ã€ ç”¨é—®å·å®ç°å¯é€‰åŒ¹é… æœ‰æ—¶å€™,æƒ³åŒ¹é…çš„æ¨¡å¼æ˜¯å¯é€‰çš„ã€‚å°±æ˜¯è¯´,ä¸è®ºè¿™æ®µæ–‡æœ¬åœ¨ä¸åœ¨,æ­£åˆ™è¡¨è¾¾å¼éƒ½ä¼šè®¤ä¸ºåŒ¹é…ã€‚å­—ç¬¦?è¡¨æ˜å®ƒå‰é¢çš„åˆ†ç»„åœ¨è¿™ä¸ªæ¨¡å¼ä¸­æ˜¯å¯é€‰çš„ã€‚\nbatRegex = re.compile(r\u0026#39;Bat(wo)?man\u0026#39;) mo1 = batRegex.search(\u0026#39;The Adventures of Batman\u0026#39;) mo1.group() 'Batwoman'  mo2 = batRegex.search(\u0026#39;The Adventures of Batwoman\u0026#39;) mo2.group() 'Batwoman'  3.6ã€ ç”¨æ˜Ÿå·åŒ¹é…é›¶æ¬¡æˆ–å¤šæ¬¡ *(ç§°ä¸ºæ˜Ÿå·)æ„å‘³ç€â€œåŒ¹é…é›¶æ¬¡æˆ–å¤šæ¬¡â€,å³æ˜Ÿå·ä¹‹å‰çš„åˆ†ç»„,å¯ä»¥åœ¨æ–‡æœ¬ä¸­å‡ºç°ä»»æ„æ¬¡ã€‚å®ƒå¯ä»¥å®Œå…¨ä¸å­˜åœ¨,æˆ–ä¸€æ¬¡åˆä¸€æ¬¡åœ°é‡å¤ã€‚\nbatRegex = re.compile(r\u0026#39;Bat(wo)*man\u0026#39;) mo1 = batRegex.search(\u0026#39;The Adventures of Batman\u0026#39;) mo1.group() 'Batman'  mo2 = batRegex.search(\u0026#39;The Adventures of Batwoman\u0026#39;) mo2.group() 'Batwoman'  mo3 = batRegex.search(\u0026#39;The Adventures of Batwowowowoman\u0026#39;) mo3.group() 'Batwowowowoman'  3.7ã€ ç”¨åŠ å·åŒ¹é…ä¸€æ¬¡æˆ–å¤šæ¬¡ *æ„å‘³ç€â€œåŒ¹é…é›¶æ¬¡æˆ–å¤šæ¬¡â€,+(åŠ å·)åˆ™æ„å‘³ç€â€œåŒ¹é…ä¸€æ¬¡æˆ–å¤šæ¬¡â€ã€‚æ˜Ÿå·ä¸è¦æ±‚åˆ†ç»„å‡ºç°åœ¨åŒ¹é…çš„å­—ç¬¦ä¸²ä¸­,ä½†åŠ å·ä¸åŒ,åŠ å·å‰é¢çš„åˆ†ç»„å¿…é¡»â€œè‡³å°‘å‡ºç°ä¸€æ¬¡â€ã€‚è¿™ä¸æ˜¯å¯é€‰çš„ã€‚\nbatRegex = re.compile(r\u0026#39;Bat(wo)+man\u0026#39;) mo1 = batRegex.search(\u0026#39;The Adventures of Batwoman\u0026#39;) mo1.group() 'Batwoman'  mo2 = batRegex.search(\u0026#39;The Adventures of Batwowowowoman\u0026#39;) mo2.group() 'Batwowowowoman'  mo3 = batRegex.search(\u0026#39;The Adventures of Batman\u0026#39;) mo3 == None True   æœªå®Œå¾…ç»­\n ","permalink":"http://yangchnet.github.io/Dessert/posts/python/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/","summary":"æ­£åˆ™è¡¨è¾¾å¼ 1ã€ä»€ä¹ˆæ˜¯æ­£åˆ™è¡¨è¾¾å¼ æ­£åˆ™è¡¨è¾¾å¼ï¼Œåˆç§°è§„åˆ™è¡¨è¾¾å¼ã€‚ï¼ˆè‹±è¯­ï¼šRegular Expressionï¼Œåœ¨ä»£ç ä¸­å¸¸ç®€å†™ä¸ºregexã€regexpæˆ–REï¼‰ï¼Œè®¡ç®—æœºç§‘å­¦çš„ä¸€ä¸ªæ¦‚å¿µã€‚æ­£åˆ™è¡¨è¾¾å¼é€šå¸¸è¢«ç”¨æ¥æ£€ç´¢ã€æ›¿æ¢é‚£äº›ç¬¦åˆæŸä¸ªæ¨¡å¼(è§„åˆ™)çš„æ–‡æœ¬ã€‚ï¼ˆæ‘˜è‡ªç™¾åº¦ç™¾ç§‘ï¼‰\nä½ å¯èƒ½ç†Ÿæ‚‰æ–‡æœ¬æŸ¥æ‰¾,å³æŒ‰ä¸‹ Ctrl-F,è¾“å…¥ä½ è¦æŸ¥æ‰¾çš„è¯ã€‚â€œæ­£åˆ™è¡¨è¾¾å¼â€æ›´è¿›ä¸€æ­¥,å®ƒä»¬è®©ä½ æŒ‡å®šè¦æŸ¥æ‰¾çš„â€œæ¨¡å¼â€ã€‚ä½ ä¹Ÿè®¸ä¸çŸ¥é“ä¸€å®¶å…¬å¸çš„å‡†ç¡®ç”µè¯å·ç ,ä½†å¦‚æœä½ ä½åœ¨ç¾å›½æˆ–åŠ æ‹¿å¤§,ä½ å°±çŸ¥é“æœ‰3 ä½æ•°å­—,ç„¶åæ˜¯ä¸€ä¸ªçŸ­æ¨ªçº¿,ç„¶åæ˜¯ 4 ä½æ•°å­—(æœ‰æ—¶å€™ä»¥ 3 ä½åŒºå·å¼€å§‹)ã€‚å› æ­¤ä½œä¸ºä¸€ä¸ªäºº,ä½ çœ‹åˆ°ä¸€ä¸ªç”µè¯å·ç å°±çŸ¥é“:415-555-1234 æ˜¯ç”µè¯å·ç ,ä½† 4,155,551,234 ä¸æ˜¯ã€‚ æ­£åˆ™è¡¨è¾¾å¼å¾ˆæœ‰ç”¨,ä½†å¦‚æœä¸æ˜¯ç¨‹åºå‘˜,å¾ˆå°‘ä¼šæœ‰äººäº†è§£,å®ƒ,å°½ç®¡å¤§å¤šæ•°ç°ä»£æ–‡æœ¬ç¼–è¾‘å™¨å’Œæ–‡å­—å¤„ç†å™¨(è¯¸å¦‚å¾®è½¯çš„ Word æˆ– OpenOffice)éƒ½æœ‰æŸ¥æ‰¾å’ŒæŸ¥æ‰¾æ›¿æ¢åŠŸèƒ½,å¯ä»¥æ ¹æ®æ­£åˆ™è¡¨è¾¾å¼æŸ¥æ‰¾ã€‚æ­£åˆ™è¡¨è¾¾å¼å¯ä»¥èŠ‚çº¦å¤§é‡æ—¶é—´,ä¸ä»…é€‚ç”¨äºè½¯ä»¶ç”¨æˆ·,ä¹Ÿé€‚ç”¨äºç¨‹åºå‘˜ã€‚å®é™…ä¸Š,æŠ€æœ¯ä½œå®¶ Cory Doctorow å£°ç§°,ç”šè‡³åº”è¯¥åœ¨æ•™æˆç¼–ç¨‹ä¹‹å‰,å…ˆæ•™æˆæ­£åˆ™è¡¨è¾¾å¼: â€œçŸ¥é“[æ­£åˆ™è¡¨è¾¾å¼]å¯èƒ½æ„å‘³ç€ç”¨ 3 æ­¥è§£å†³ä¸€ä¸ªé—®é¢˜,è€Œä¸æ˜¯ç”¨ 3000 æ­¥ã€‚å¦‚æœä½ æ˜¯ä¸€ä¸ªæŠ€æœ¯æ€ªä¾ ,åˆ«å¿˜äº†ä½ ç”¨å‡ æ¬¡å‡»é”®å°±èƒ½è§£å†³çš„é—®é¢˜,å…¶ä»–äººéœ€è¦æ•°å¤©çš„çƒ¦çå·¥ä½œæ‰èƒ½è§£å†³,è€Œä¸”ä»–ä»¬å®¹æ˜“çŠ¯é”™ã€‚â€ 1 (æ‘˜è‡ªã€ŠPythonç¼–ç¨‹å¿«é€Ÿä¸Šæ‰‹â€”è®©ç¹çå·¥ä½œè‡ªåŠ¨åŒ–ã€‹)\n2ã€ä¸ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥æŸ¥æ‰¾æ–‡æœ¬æ¨¡å¼ å‡è®¾ä½ å¸Œæœ›åœ¨å­—ç¬¦ä¸²ä¸­æŸ¥æ‰¾ç”µè¯å·ç ã€‚ä½ çŸ¥é“æ¨¡å¼:3 ä¸ªæ•°å­—,ä¸€ä¸ªçŸ­æ¨ªçº¿,3 ä¸ªæ•°å­—,ä¸€ä¸ªçŸ­æ¨ªçº¿,å†æ˜¯ 4 ä¸ªæ•°å­—ã€‚ä¾‹å¦‚:415-555-4242ã€‚ å‡å®šæˆ‘ä»¬ç”¨ä¸€ä¸ªåä¸º isPhoneNumber()çš„å‡½æ•°,æ¥æ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦åŒ¹é…æ¨¡å¼,å®ƒ è¿”å› True æˆ– Falseã€‚\ndef isPhoneNumber(text): if len(text) != 12: return False for i in range(0, 3): if not text[i].isdecimal(): return False if text[3] != \u0026#39;-\u0026#39;: return False for i in range(4, 7): if not text[i].","title":"æ­£åˆ™è¡¨è¾¾å¼"},{"content":"æ¸©åº¦é¢„æµ‹ 1. è§‚å¯Ÿè€¶æ‹¿å¤©æ°”æ•°æ®é›†çš„æ•°æ® import os fname = \u0026#39;./data/jena_climate_2009_2016.csv\u0026#39; f = open(fname) data = f.read() f.close() lines = data.split(\u0026#39;\\n\u0026#39;) header = lines[0].split(\u0026#39;,\u0026#39;) lines = lines[1:] print(header) print(len(lines)) ['\u0026quot;Date Time\u0026quot;', '\u0026quot;p (mbar)\u0026quot;', '\u0026quot;T (degC)\u0026quot;', '\u0026quot;Tpot (K)\u0026quot;', '\u0026quot;Tdew (degC)\u0026quot;', '\u0026quot;rh (%)\u0026quot;', '\u0026quot;VPmax (mbar)\u0026quot;', '\u0026quot;VPact (mbar)\u0026quot;', '\u0026quot;VPdef (mbar)\u0026quot;', '\u0026quot;sh (g/kg)\u0026quot;', '\u0026quot;H2OC (mmol/mol)\u0026quot;', '\u0026quot;rho (g/m**3)\u0026quot;', '\u0026quot;wv (m/s)\u0026quot;', '\u0026quot;max. wv (m/s)\u0026quot;', '\u0026quot;wd (deg)\u0026quot;'] 420551  # è§£ææ•°æ® import numpy as np float_data = np.zeros((len(lines), len(header) - 1)) for i, line in enumerate(lines): values = [float(x) for x in line.split(\u0026#39;,\u0026#39;)[1:]] float_data[i, :] = values # ç»˜åˆ¶æ¸©åº¦æ—¶é—´åºåˆ— from matplotlib import pyplot as plt temp = float_data[:, 1] # æ¸©åº¦ï¼ˆæ‘„æ°åº¦ï¼‰ plt.plot(range(len(temp)), temp) plt.show() plt.plot(range(1440), temp[:1440]) [\u0026lt;matplotlib.lines.Line2D at 0x7f596ff56978\u0026gt;]  2. å‡†å¤‡æ•°æ® é—®é¢˜æè¿°ï¼šä¸€ä¸ªæ—¶é—´æ­¥æ˜¯10åˆ†é’Ÿï¼Œæ²¡stepsä¸ªæ—¶é—´æ­¥é‡‡æ ·ä¸€æ¬¡æ•°æ®ï¼Œç»™å®šè¿‡å»lookbackä¸ªæ—¶é—´æ­¥ä¹‹å†…çš„æ•°æ®ï¼Œèƒ½å¦é¢„æµ‹delayä¸ªæ—¶é—´æ­¥ä¹‹åçš„æ¸©åº¦ï¼Ÿç”¨åˆ°çš„å‚æ•°å¦‚ä¸‹:\nlookback = 720 # ç»™å®šè¿‡å»5å¤©å†…çš„è§‚æµ‹æ•°æ®\nsteps = 6 # è§‚æµ‹æ•°æ®çš„é‡‡æ ·é¢‘ç‡æ˜¯æ¯å°æ—¶ä¸€ä¸ªæ•°æ®ç‚¹\ndelay = 144 # ç›®æ ‡æ˜¯æœªæ¥24å°æ—¶ä¹‹åçš„æ•°æ®\næ•°æ®æ ‡å‡†åŒ–\nmean = float_data[:200000].mean(axis=0) float_data -= mean std = float_data[:200000].std(axis=0) float_data /= std ä¸‹é¢è¿™ä¸ªç”Ÿæˆå™¨ä»¥å½“å‰çš„æµ®ç‚¹æ•°æ•°ç»„ä½œä¸ºè¾“å…¥ï¼Œå¹¶ä»æœ€è¿‘çš„æ•°æ®ä¸­ç”Ÿæˆæ•°æ®æ‰¹é‡ï¼ŒåŒæ—¶ç”Ÿæˆæœªæ¥çš„ç›®æ ‡æ¸©åº¦ã€‚sampleæ˜¯è¾“å…¥æ•°æ®çš„ä¸€ä¸ªæ‰¹é‡ï¼Œtargetsæ˜¯å¯¹åº”çš„ç›®æ ‡æ¸©åº¦æ•°ç»„\ndef generator(data, lookback, delay, min_index, max_index, shuffle=False, batch_size=128, step=6): \u0026#39;\u0026#39;\u0026#39; data:æµ®ç‚¹æ•°æ®ç»„æˆçš„åŸå§‹æ•°ç»„ lookback: è¾“å…¥æ•°æ®åº”è¯¥åŒ…æ‹¬è¿‡å»å¤šå°‘ä¸ªæ—¶é—´æ­¥ delayï¼šç›®æ ‡åº”è¯¥åœ¨æœªæ¥å¤šå°‘ä¸ªæ—¶é—´å min_index å’Œ max_index: dataæ•°ç»„ä¸­çš„ç´¢å¼•ï¼Œç”¨äºç•Œå®šéœ€è¦æŠ½å–é‚£äº›æ—¶é—´æ­¥ã€‚ shuffle: æ˜¯æ‰“ä¹±æ ·æœ¬ï¼Œè¿˜æ˜¯æŒ‰é¡ºåºæŠ½å–æ ·æœ¬ batch_size:æ¯ä¸ªæ‰¹é‡çš„æ ·æœ¬æ•° step:æ•°æ®é‡‡æ ·çš„å‘¨æœŸã€‚ \u0026#39;\u0026#39;\u0026#39; if max_index is None: max_index = len(data) - delay - 1 i = min_index + lookback while 1: if shuffle: rows = np.random.randint( min_index + lookback, max_index, size=batch_size) else: if i + batch_size \u0026gt;= max_index: i = min_index + lookback rows = np.arange(i, min(i + batch_size, max_index)) i += len(rows) samples = np.zeros((len(rows), lookback // step, data.shape[-1])) targets = np.zeros((len(rows),)) for j, row in enumerate(rows): indices = range(rows[j] - lookback, rows[j], step) samples[j] = data[indices] targets[j] = data[rows[j] + delay][1] yield samples, targets å‡†å¤‡è®­ç»ƒç”Ÿæˆå™¨ã€éªŒè¯ç”Ÿæˆå™¨å’Œæµ‹è¯•ç”Ÿæˆå™¨\nlookback = 1440 step = 6 delay = 144 batch_size = 128 train_gen = generator(float_data, lookback=lookback, delay=delay, min_index=0, max_index=200000, shuffle=True, step=step, batch_size=batch_size) val_gen = generator(float_data, lookback=lookback, delay=delay, min_index=2000001, max_index=3000000, step=step, batch_size=batch_size) test_gen = generator(float_data, lookback=lookback, delay=delay, min_index=3000001, max_index=None, step=step, batch_size=batch_size) val_steps = (300000 - 200001 - lookback) // batch_size # ä¸ºäº†æŸ¥çœ‹æ•´ä¸ªéªŒè¯é›†ï¼Œéœ€è¦ä»val_genä¸­æŠ½å–å¤šå°‘æ¬¡ test_steps = (len(float_data) - 300001 - lookback) // batch_size # ä¸ºäº†æŸ¥çœ‹æ•´ä¸ªæµ‹è¯•é›†ï¼Œéœ€è¦ä»test_genä¸­æŠ½å–å¤šå°‘æ¬¡ 3. ä¸€ç§åŸºæœ¬çš„æœºå™¨å­¦ä¹ æ–¹æ³• åœ¨å°è¯•æœºå™¨å­¦ä¹ æ–¹æ³•ä¹‹å‰ï¼Œå»ºç«‹ä¸€ä¸ªåŸºäºå¸¸è¯†çš„åŸºå‡†æ–¹æ³•æ˜¯å¾ˆæœ‰ç”¨çš„ï¼›åŒæ ·ï¼Œåœ¨å¼€å§‹ç ”ç©¶å¤æ‚ä¸”è®¡ç®—ä»£ä»·å¾ˆé«˜çš„æ¨¡å‹ï¼ˆå¦‚RNNï¼‰ä¹‹å‰ï¼Œå°è¯•ä½¿ç”¨ç®€å•ä¸”è®¡ç®—ä»£ä»·ä½çš„æœºå™¨å­¦ä¹ æ¨¡å‹ä¹Ÿæ˜¯å¾ˆæœ‰ç”¨çš„ï¼Œæ¯”å¦‚å°å‹çš„å¯†é›†è¿æ¥ç½‘ç»œã€‚è¿™å¯ä»¥ä¿è¯è¿›ä¸€æ­¥å¢åŠ é—®é¢˜çš„å¤æ‚åº¦æ˜¯åˆç†çš„ï¼Œå¹¶ä¸”ä¼šå¸¦æ¥çœŸæ­£çš„å¥½å¤„\n# è®­ç»ƒå¹¶è¯„ä¼°ä¸€ä¸ªå¯†é›†è¿æ¥æ¨¡å‹ from keras.models import Sequential from keras import layers from keras.optimizers import RMSprop model = Sequential() model.add(layers.Flatten(input_shape=(lookback // step, float_data.shape[-1]))) model.add(layers.Dense(32, activation=\u0026#39;relu\u0026#39;)) model.add(layers.Dense(1)) model.compile(optimizer=RMSprop(), loss=\u0026#39;mae\u0026#39;) history = model.fit_generator(train_gen, steps_per_epoch=500, epochs=20, validation_data=val_gen, validation_steps=val_steps) ","permalink":"http://yangchnet.github.io/Dessert/posts/dlml/%E6%B8%A9%E5%BA%A6%E9%A2%84%E6%B5%8B/","summary":"æ¸©åº¦é¢„æµ‹ 1. è§‚å¯Ÿè€¶æ‹¿å¤©æ°”æ•°æ®é›†çš„æ•°æ® import os fname = \u0026#39;./data/jena_climate_2009_2016.csv\u0026#39; f = open(fname) data = f.read() f.close() lines = data.split(\u0026#39;\\n\u0026#39;) header = lines[0].split(\u0026#39;,\u0026#39;) lines = lines[1:] print(header) print(len(lines)) ['\u0026quot;Date Time\u0026quot;', '\u0026quot;p (mbar)\u0026quot;', '\u0026quot;T (degC)\u0026quot;', '\u0026quot;Tpot (K)\u0026quot;', '\u0026quot;Tdew (degC)\u0026quot;', '\u0026quot;rh (%)\u0026quot;', '\u0026quot;VPmax (mbar)\u0026quot;', '\u0026quot;VPact (mbar)\u0026quot;', '\u0026quot;VPdef (mbar)\u0026quot;', '\u0026quot;sh (g/kg)\u0026quot;', '\u0026quot;H2OC (mmol/mol)\u0026quot;', '\u0026quot;rho (g/m**3)\u0026quot;', '\u0026quot;wv (m/s)\u0026quot;', '\u0026quot;max. wv (m/s)\u0026quot;', '\u0026quot;wd (deg)\u0026quot;'] 420551  # è§£ææ•°æ® import numpy as np float_data = np.zeros((len(lines), len(header) - 1)) for i, line in enumerate(lines): values = [float(x) for x in line.","title":"æ¸©åº¦é¢„æµ‹"},{"content":"ç†è§£LSTMå±‚ä¸GRUå±‚  SimpleRNNçš„é—®é¢˜åœ¨äºï¼Œåœ¨æ—¶åˆ»tï¼Œç†è®ºä¸Šæ¥è¯´ï¼Œå®ƒåº”è¯¥èƒ½å¤Ÿè®°ä½è®¸å¤šæ—¶é—´éƒ¨ä¹‹å‰è§è¿‡çš„å„ç§ä¿¡æ¯ï¼Œä½†å®é™…ä¸Šå®ƒæ˜¯ä¸å¯èƒ½å­¦åˆ°è¿™ç§é•¿æœŸä¾èµ–çš„ã€‚å…¶åŸå› åœ¨äºâ€œæ¢¯åº¦æ¶ˆå¤±â€é—®é¢˜ï¼Œè¿™ä¸€æ•ˆåº”ç±»ä¼¼äºåœ¨å±‚æ•°è¾ƒå¤šçš„éå¾ªç¯ç½‘ç»œä¸­è§‚å¯Ÿåˆ°çš„æ•ˆåº”ï¼Œéšç€å±‚æ•°çš„å¢åŠ ï¼Œç½‘ç»œæœ€ç»ˆå˜å¾—æ— æ³•è®­ç»ƒã€‚\n 1. LSTMå±‚ LSTMå±‚æ˜¯SimpleRNNçš„ä¸€ç§å˜ä½“ï¼Œå®ƒå¢åŠ äº†ä¸€ç§æºå¸¦ä¿¡æ¯è·¨è¶Šå¤šä¸ªæ—¶é—´æ­¥çš„æ–¹æ³•ã€‚å‡è®¾æœ‰ä¸€æ¡ä¼ é€å¸¦ï¼Œå…¶è¿è¡Œæ–¹å‘å¹³è¡Œäºä½ æ‰€å¤„ç†çš„åºåˆ—ã€‚åºåˆ—ä¸­çš„ä¿¡æ¯å¯ä»¥åœ¨ä»»æ„ä½ç½®è·³ä¸Šä¼ é€å¸¦ï¼Œç„¶åè¢«ä¼ é€åˆ°æ›´æ™šçš„æ—¶é—´æ­¥ï¼Œå¹¶åœ¨éœ€è¦æ—¶åŸå°ä¸åŠ¨åœ°è·³å›æ¥ã€‚è¿™å®é™…ä¸Šå°±æ˜¯LSTMçš„åŸç†ï¼šå®ƒä¿å­˜ä¿¡æ¯ä»¥ä¾¿åé¢ä½¿ç”¨ï¼Œä»è€Œé˜²æ­¢è¾ƒæ—©æœŸçš„ä¿¡å·åœ¨å¤„ç†è¿‡ç¨‹ä¸­é€æ¸æ¶ˆå¤±ã€‚\n1.1 Keras ä¸­ä¸€ä¸ªLSTMçš„ä¾‹å­ # å‡†å¤‡æ•°æ® from keras.datasets import imdb from keras.preprocessing import sequence max_features = 10000 maxlen = 500 batch_size = 32 print(\u0026#39;Loading data...\u0026#39;) (input_train, y_train), (input_test, y_test) = imdb.load_data(num_words=max_features) print(len(input_train), \u0026#39;train_sequences\u0026#39;) print(len(input_test), \u0026#39;test sequences\u0026#39;) print(\u0026#39;Pad sequences (samples x time)\u0026#39;) input_train = sequence.pad_sequences(input_train, maxlen=maxlen) input_test = sequence.pad_sequences(input_test, maxlen=maxlen) print(\u0026#39;input_train shape: \u0026#39;, input_train.shape) print(\u0026#39;input_test shape:\u0026#39;, input_test.shape) Loading data... 25000 train_sequences 25000 test sequences Pad sequences (samples x time) input_train shape: (25000, 500) input_test shape: (25000, 500)  # ä½¿ç”¨Kerasä¸­çš„LSTMå±‚ from keras.layers import LSTM, Dense from keras.models import Sequential from keras.layers import Embedding, SimpleRNN max_features = 10000 model = Sequential() model.add(Embedding(max_features, 32)) model.add(LSTM(32)) model.add(Dense(1, activation=\u0026#39;sigmoid\u0026#39;)) model.compile(optimizer=\u0026#39;rmsprop\u0026#39;, loss=\u0026#39;binary_crossentropy\u0026#39;, metrics=[\u0026#39;acc\u0026#39;]) history = model.fit(input_train, y_train, epochs=10, batch_size=128, validation_split=0.2) /usr/lib/python3.7/site-packages/tensorflow/python/ops/gradients_util.py:93: UserWarning: Converting sparse IndexedSlices to a dense Tensor of unknown shape. This may consume a large amount of memory. \u0026quot;Converting sparse IndexedSlices to a dense Tensor of unknown shape. \u0026quot; Train on 20000 samples, validate on 5000 samples Epoch 1/10 20000/20000 [==============================] - 487s 24ms/step - loss: 0.5123 - acc: 0.7542 - val_loss: 0.4508 - val_acc: 0.7902 Epoch 2/10 20000/20000 [==============================] - 489s 24ms/step - loss: 0.2947 - acc: 0.8866 - val_loss: 0.2914 - val_acc: 0.8816 Epoch 3/10 20000/20000 [==============================] - 482s 24ms/step - loss: 0.2368 - acc: 0.9094 - val_loss: 0.3113 - val_acc: 0.8738 Epoch 4/10 20000/20000 [==============================] - 530s 26ms/step - loss: 0.2033 - acc: 0.9258 - val_loss: 0.3399 - val_acc: 0.8534 Epoch 5/10 20000/20000 [==============================] - 480s 24ms/step - loss: 0.1735 - acc: 0.9384 - val_loss: 0.5543 - val_acc: 0.8110 Epoch 6/10 20000/20000 [==============================] - 465s 23ms/step - loss: 0.1608 - acc: 0.9438 - val_loss: 0.2991 - val_acc: 0.8796 Epoch 7/10 20000/20000 [==============================] - 454s 23ms/step - loss: 0.1406 - acc: 0.9494 - val_loss: 0.3217 - val_acc: 0.8870 Epoch 8/10 20000/20000 [==============================] - 448s 22ms/step - loss: 0.1361 - acc: 0.9531 - val_loss: 0.6040 - val_acc: 0.8540 Epoch 9/10 20000/20000 [==============================] - 449s 22ms/step - loss: 0.1270 - acc: 0.9553 - val_loss: 0.4197 - val_acc: 0.8782 Epoch 10/10 20000/20000 [==============================] - 448s 22ms/step - loss: 0.1165 - acc: 0.9596 - val_loss: 0.3421 - val_acc: 0.8856  ","permalink":"http://yangchnet.github.io/Dessert/posts/dlml/lstm/","summary":"ç†è§£LSTMå±‚ä¸GRUå±‚  SimpleRNNçš„é—®é¢˜åœ¨äºï¼Œåœ¨æ—¶åˆ»tï¼Œç†è®ºä¸Šæ¥è¯´ï¼Œå®ƒåº”è¯¥èƒ½å¤Ÿè®°ä½è®¸å¤šæ—¶é—´éƒ¨ä¹‹å‰è§è¿‡çš„å„ç§ä¿¡æ¯ï¼Œä½†å®é™…ä¸Šå®ƒæ˜¯ä¸å¯èƒ½å­¦åˆ°è¿™ç§é•¿æœŸä¾èµ–çš„ã€‚å…¶åŸå› åœ¨äºâ€œæ¢¯åº¦æ¶ˆå¤±â€é—®é¢˜ï¼Œè¿™ä¸€æ•ˆåº”ç±»ä¼¼äºåœ¨å±‚æ•°è¾ƒå¤šçš„éå¾ªç¯ç½‘ç»œä¸­è§‚å¯Ÿåˆ°çš„æ•ˆåº”ï¼Œéšç€å±‚æ•°çš„å¢åŠ ï¼Œç½‘ç»œæœ€ç»ˆå˜å¾—æ— æ³•è®­ç»ƒã€‚\n 1. LSTMå±‚ LSTMå±‚æ˜¯SimpleRNNçš„ä¸€ç§å˜ä½“ï¼Œå®ƒå¢åŠ äº†ä¸€ç§æºå¸¦ä¿¡æ¯è·¨è¶Šå¤šä¸ªæ—¶é—´æ­¥çš„æ–¹æ³•ã€‚å‡è®¾æœ‰ä¸€æ¡ä¼ é€å¸¦ï¼Œå…¶è¿è¡Œæ–¹å‘å¹³è¡Œäºä½ æ‰€å¤„ç†çš„åºåˆ—ã€‚åºåˆ—ä¸­çš„ä¿¡æ¯å¯ä»¥åœ¨ä»»æ„ä½ç½®è·³ä¸Šä¼ é€å¸¦ï¼Œç„¶åè¢«ä¼ é€åˆ°æ›´æ™šçš„æ—¶é—´æ­¥ï¼Œå¹¶åœ¨éœ€è¦æ—¶åŸå°ä¸åŠ¨åœ°è·³å›æ¥ã€‚è¿™å®é™…ä¸Šå°±æ˜¯LSTMçš„åŸç†ï¼šå®ƒä¿å­˜ä¿¡æ¯ä»¥ä¾¿åé¢ä½¿ç”¨ï¼Œä»è€Œé˜²æ­¢è¾ƒæ—©æœŸçš„ä¿¡å·åœ¨å¤„ç†è¿‡ç¨‹ä¸­é€æ¸æ¶ˆå¤±ã€‚\n1.1 Keras ä¸­ä¸€ä¸ªLSTMçš„ä¾‹å­ # å‡†å¤‡æ•°æ® from keras.datasets import imdb from keras.preprocessing import sequence max_features = 10000 maxlen = 500 batch_size = 32 print(\u0026#39;Loading data...\u0026#39;) (input_train, y_train), (input_test, y_test) = imdb.load_data(num_words=max_features) print(len(input_train), \u0026#39;train_sequences\u0026#39;) print(len(input_test), \u0026#39;test sequences\u0026#39;) print(\u0026#39;Pad sequences (samples x time)\u0026#39;) input_train = sequence.pad_sequences(input_train, maxlen=maxlen) input_test = sequence.pad_sequences(input_test, maxlen=maxlen) print(\u0026#39;input_train shape: \u0026#39;, input_train.shape) print(\u0026#39;input_test shape:\u0026#39;, input_test.shape) Loading data... 25000 train_sequences 25000 test sequences Pad sequences (samples x time) input_train shape: (25000, 500) input_test shape: (25000, 500)  # ä½¿ç”¨Kerasä¸­çš„LSTMå±‚ from keras.","title":"ç†è§£LSTMå±‚ä¸GRUå±‚"},{"content":"ç†è§£å¾ªç¯ç¥ç»ç½‘ç»œ 1. ç®€å•çš„å¾ªç¯ç¥ç»ç½‘ç»œ RNNä»¥æ¸è¿›çš„æ–¹å¼å¤„ç†ä¿¡æ¯ï¼ŒåŒæ—¶ä¿å­˜ä¸€ä¸ªå…³äºæ‰€å¤„ç†å†…å®¹çš„å†…éƒ¨æ¨¡å‹ï¼Œè¿™ä¸ªæ¨¡å‹æ˜¯æ ¹æ®è¿‡å»çš„ä¿¡æ¯æ„å»ºçš„ï¼Œå¹¶éšç€æ–°ä¿¡æ¯çš„è¿›å…¥è€Œä¸æ–­æ›´æ–°ã€‚\nRNNå¤„ç†åºåˆ—çš„æ–¹å¼æ˜¯ï¼šéå†æ‰€æœ‰åºåˆ—å…ƒç´ ï¼Œå¹¶ä¿å­˜ä¸€ä¸ªçŠ¶æ€ï¼ˆStateï¼‰ï¼Œå…¶ä¸­åŒ…å«ä¸å·²æŸ¥çœ‹å†…å®¹ç›¸å…³çš„ä¿¡æ¯ã€‚\nRNNçš„ä¼ªä»£ç ï¼š\nstate_t = 0 for input_t in input_sequence: output_t = f(input_t, state_t) state_t = output_t å¯ä»¥ç»™å‡ºå…·ä½“çš„å‡½æ•°f,ä»è¾“å…¥å’ŒçŠ¶æ€åˆ°è¾“å‡ºçš„å˜æ¢ï¼Œå…¶å‚æ•°åŒ…æ‹¬ä¸¤ä¸ªçŸ©é˜µï¼ˆWå’ŒUï¼‰å’Œä¸€ä¸ªåç½®å‘é‡ã€‚å®ƒç±»ä¼¼äºå‰é¦ˆç½‘ç»œä¸­å¯†é›†è¿æ¥å±‚æ‰€åšçš„å˜æ¢ã€‚\nstate_t = 0 for input_t in input_sequence: output_t = activation(dot(W, input_t) + dot(U, state_t) + b) state_t = output_t # ç®€å•RNNçš„numpyå®ç° import numpy as np timesteps = 100 # è¾“å…¥åºåˆ—çš„æ—¶é—´æ­¥æ•° input_features = 32 # è¾“å…¥ç‰¹å¾ç©ºé—´çš„ç»´åº¦ output_features = 64 # è¾“å‡ºç‰¹å¾ç©ºé—´çš„ç»´åº¦ inputs = np.random.random((timesteps, input_features)) # è¾“å…¥æ•°æ®ï¼šéšæœºå™ªå£°ï¼Œä»…ä½œä¸ºç¤ºä¾‹ state_t = np.zeros((output_features,)) # åˆè¯•çŠ¶æ€ï¼šå…¨é›¶å‘é‡ # åˆ›å»ºéšæœºçš„æƒé‡çŸ©é˜µ W = np.random.random((output_features, input_features)) U = np.random.random((output_features, output_features)) b = np.random.random((output_features, )) successive_outputs = [] for input_t in inputs: # input_tæ˜¯å½¢çŠ¶ä¸ºï¼ˆinput_features, )çš„å‘é‡ output_t = np.tanh(np.dot(W, input_t) + np.dot(U, state_t) + b) # ç”±è¾“å…¥å’Œå½“å‰çŠ¶æ€è®¡ç®—å¾—åˆ°å½“å‰è¾“å‡º successive_outputs.append(output_t) # å°†è¿™ä¸ªè¾“å‡ºä¿å­˜åˆ°ä¸€ä¸ªåˆ—è¡¨ä¸­ state_t = output_t # æ›´æ–°ç½‘ç»œçš„çŠ¶æ€ï¼Œç”¨äºä¸‹ä¸€ä¸ªæ—¶é—´æ­¥ # æœ€ç»ˆè¾“å‡ºæ˜¯ä¸€ä¸ªå½¢çŠ¶ä¸ºï¼ˆtimesteps, output_featuresï¼‰çš„äºŒç»´å¼ é‡ final_output_sequence = np.stack(successive_outputs, axis=0) final_output_sequence array([[0.99999999, 0.99999995, 0.99999999, ..., 0.99999999, 0.9999997 , 0.99999992], [1. , 1. , 1. , ..., 1. , 1. , 1. ], [1. , 1. , 1. , ..., 1. , 1. , 1. ], ..., [1. , 1. , 1. , ..., 1. , 1. , 1. ], [1. , 1. , 1. , ..., 1. , 1. , 1. ], [1. , 1. , 1. , ..., 1. , 1. , 1. ]])  2. Keras ä¸­çš„å¾ªç¯å±‚ ä¸Šé¢numpyçš„ç®€å•å®ç°ï¼Œå¯¹åº”ä¸€ä¸ªå®é™…çš„Keraså±‚ï¼Œå³SimpleRNNå±‚ã€‚\nfrom keras.layers import SimpleRNN ä¸Kerasä¸­æ‰€æœ‰çš„å¾ªç¯å±‚ä¸€æ ·ï¼ŒSimpleRNNå¯ä»¥åœ¨ä¸¤ç§ä¸åŒçš„æ¨¡å¼ä¸‹è¿è¡Œï¼šä¸€ç§æ˜¯è¿”å›æ¯ä¸ªæ—¶é—´æ­¥è¿ç»­è¾“å‡ºçš„å®Œæ•´åºåˆ—ï¼Œå³å½¢çŠ¶ä¸ºï¼ˆbatch_size, timesteps, output_featuresï¼‰çš„ä¸‰ç»´å¼ é‡ï¼›å¦ä¸€ç§æ˜¯åªè¿”å›æ¯ä¸ªè¾“å…¥ç³»åˆ—çš„æœ€ç»ˆè¾“å‡ºï¼Œå³å½¢çŠ¶ä¸º(batch_size, output_featrues)çš„äºŒç»´å¼ é‡ã€‚è¿™ä¸ªä¸¤ç§æ¨¡å¼ç”±return_sequencesè¿™ä¸ªæ„é€ å‡½æ•°å‚æ•°æ¥æ§åˆ¶ã€‚\nfrom keras.models import Sequential from keras.layers import Embedding, SimpleRNN model = Sequential() model.add(Embedding(10000, 32)) model.add(SimpleRNN(32)) #` åªè¿”å›æœ€åä¸€ä¸ªæ—¶é—´æ­¥çš„è¾“å‡º model.summary() Model: \u0026quot;sequential_2\u0026quot; _________________________________________________________________ Layer (type) Output Shape Param # ================================================================= embedding_2 (Embedding) (None, None, 32) 320000 _________________________________________________________________ simple_rnn_2 (SimpleRNN) (None, 32) 2080 ================================================================= Total params: 322,080 Trainable params: 322,080 Non-trainable params: 0 _________________________________________________________________  from keras.models import Sequential from keras.layers import Embedding, SimpleRNN model = Sequential() model.add(Embedding(10000, 32)) model.add(SimpleRNN(32, return_sequences=True)) # è¿”å›å®Œæ•´çš„çŠ¶æ€åºåˆ— model.summary() Model: \u0026quot;sequential_3\u0026quot; _________________________________________________________________ Layer (type) Output Shape Param # ================================================================= embedding_3 (Embedding) (None, None, 32) 320000 _________________________________________________________________ simple_rnn_3 (SimpleRNN) (None, 32) 2080 ================================================================= Total params: 322,080 Trainable params: 322,080 Non-trainable params: 0 _________________________________________________________________  ä¸ºäº†æé«˜ç½‘ç»œçš„è¡¨ç¤ºèƒ½åŠ›ï¼Œå°†å¤šä¸ªå¾ªç¯å±‚é€ä¸ªå †å æœ‰æ—¶ä¹Ÿæ˜¯å¾ˆæœ‰ç”¨çš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ éœ€è¦è®©æ‰€æœ‰ä¸­é—´å±‚éƒ½è¿”å›å®Œæ•´çš„è¾“å‡ºåºåˆ—ã€‚\nmodel = Sequential() model.add(Embedding(10000, 32)) model.add(SimpleRNN(32, return_sequences=True)) model.add(SimpleRNN(32, return_sequences=True)) model.add(SimpleRNN(32, return_sequences=True)) model.add(SimpleRNN(32)) model.summary() Model: \u0026quot;sequential_4\u0026quot; _________________________________________________________________ Layer (type) Output Shape Param # ================================================================= embedding_4 (Embedding) (None, None, 32) 320000 _________________________________________________________________ simple_rnn_4 (SimpleRNN) (None, None, 32) 2080 _________________________________________________________________ simple_rnn_5 (SimpleRNN) (None, None, 32) 2080 _________________________________________________________________ simple_rnn_6 (SimpleRNN) (None, None, 32) 2080 _________________________________________________________________ simple_rnn_7 (SimpleRNN) (None, 32) 2080 ================================================================= Total params: 328,320 Trainable params: 328,320 Non-trainable params: 0 _________________________________________________________________  3. å°†RNNåº”ç”¨äºIMDBæ•°æ®é›† 3.1 å‡†å¤‡æ•°æ® from keras.datasets import imdb from keras.preprocessing import sequence max_features = 10000 maxlen = 500 batch_size = 32 print(\u0026#39;Loading data...\u0026#39;) (input_train, y_train), (input_test, y_test) = imdb.load_data(num_words=max_features) print(len(input_train), \u0026#39;train_sequences\u0026#39;) print(len(input_test), \u0026#39;test sequences\u0026#39;) print(\u0026#39;Pad sequences (samples x time)\u0026#39;) input_train = sequence.pad_sequences(input_train, maxlen=maxlen) input_test = sequence.pad_sequences(input_test, maxlen=maxlen) print(\u0026#39;input_train shape: \u0026#39;, input_train.shape) print(\u0026#39;input_test shape:\u0026#39;, input_test.shape) Loading data... 25000 train_sequences 25000 test sequences Pad sequences (samples x time) input_train shape: (25000, 500) input_test shape: (25000, 500)  # ç”¨Embeddingå±‚å’ŒSimpleRNNå±‚æ¥è®­ç»ƒæ¨¡å‹ from keras.layers import Dense model = Sequential() model.add(Embedding(max_features, 32)) model.add(SimpleRNN(32)) model.add(Dense(1, activation=\u0026#39;sigmoid\u0026#39;)) model.compile(optimizer=\u0026#39;rmsprop\u0026#39;, loss=\u0026#39;binary_crossentropy\u0026#39;, metrics=[\u0026#39;acc\u0026#39;]) history = model.fit(input_train, y_train, epochs=10, batch_size=10, validation_split=0.2) /usr/lib/python3.7/site-packages/tensorflow/python/ops/gradients_util.py:93: UserWarning: Converting sparse IndexedSlices to a dense Tensor of unknown shape. This may consume a large amount of memory. \u0026quot;Converting sparse IndexedSlices to a dense Tensor of unknown shape. \u0026quot; Train on 20000 samples, validate on 5000 samples Epoch 1/10 20000/20000 [==============================] - 4783s 239ms/step - loss: 0.5510 - acc: 0.7012 - val_loss: 0.4217 - val_acc: 0.8162 Epoch 2/10 1080/20000 [\u0026gt;.............................] - ETA: 1:14:34 - loss: 0.3898 - acc: 0.8250 --------------------------------------------------------------------------- KeyboardInterrupt Traceback (most recent call last) \u0026lt;ipython-input-10-a41d37bef560\u0026gt; in \u0026lt;module\u0026gt; 8 9 model.compile(optimizer='rmsprop', loss='binary_crossentropy', metrics=['acc']) ---\u0026gt; 10 history = model.fit(input_train, y_train, epochs=10, batch_size=10, validation_split=0.2) /usr/lib/python3.7/site-packages/keras/engine/training.py in fit(self, x, y, batch_size, epochs, verbose, callbacks, validation_split, validation_data, shuffle, class_weight, sample_weight, initial_epoch, steps_per_epoch, validation_steps, validation_freq, max_queue_size, workers, use_multiprocessing, **kwargs) 1237 steps_per_epoch=steps_per_epoch, 1238 validation_steps=validation_steps, -\u0026gt; 1239 validation_freq=validation_freq) 1240 1241 def evaluate(self, /usr/lib/python3.7/site-packages/keras/engine/training_arrays.py in fit_loop(model, fit_function, fit_inputs, out_labels, batch_size, epochs, verbose, callbacks, val_function, val_inputs, shuffle, initial_epoch, steps_per_epoch, validation_steps, validation_freq) 194 ins_batch[i] = ins_batch[i].toarray() 195 --\u0026gt; 196 outs = fit_function(ins_batch) 197 outs = to_list(outs) 198 for l, o in zip(out_labels, outs): /usr/lib/python3.7/site-packages/tensorflow/python/keras/backend.py in __call__(self, inputs) 3215 value = math_ops.cast(value, tensor.dtype) 3216 converted_inputs.append(value) -\u0026gt; 3217 outputs = self._graph_fn(*converted_inputs) 3218 return nest.pack_sequence_as(self._outputs_structure, 3219 [x.numpy() for x in outputs]) /usr/lib/python3.7/site-packages/tensorflow/python/eager/function.py in __call__(self, *args, **kwargs) 556 raise TypeError(\u0026quot;Keyword arguments {} unknown. Expected {}.\u0026quot;.format( 557 list(kwargs.keys()), list(self._arg_keywords))) --\u0026gt; 558 return self._call_flat(args) 559 560 def _filtered_call(self, args, kwargs): /usr/lib/python3.7/site-packages/tensorflow/python/eager/function.py in _call_flat(self, args) 625 # Only need to override the gradient in graph mode and when we have outputs. 626 if context.executing_eagerly() or not self.outputs: --\u0026gt; 627 outputs = self._inference_function.call(ctx, args) 628 else: 629 self._register_gradient() /usr/lib/python3.7/site-packages/tensorflow/python/eager/function.py in call(self, ctx, args) 413 attrs=(\u0026quot;executor_type\u0026quot;, executor_type, 414 \u0026quot;config_proto\u0026quot;, config), --\u0026gt; 415 ctx=ctx) 416 # Replace empty list with None 417 outputs = outputs or None /usr/lib/python3.7/site-packages/tensorflow/python/eager/execute.py in quick_execute(op_name, num_outputs, inputs, attrs, ctx, name) 58 tensors = pywrap_tensorflow.TFE_Py_Execute(ctx._handle, device_name, 59 op_name, inputs, attrs, ---\u0026gt; 60 num_outputs) 61 except core._NotOkStatusException as e: 62 if name is not None: KeyboardInterrupt:  import matplotlib.pyplot as plt acc = history.history[\u0026#39;acc\u0026#39;] val_acc = history.history[\u0026#39;val_acc\u0026#39;] loss = history.history[\u0026#39;loss\u0026#39;] val_loss = history.history[\u0026#39;val_loss\u0026#39;] epochs = range(1, len(acc)+1) plt.plot(epochs, acc, \u0026#39;bo\u0026#39;, label=\u0026#39;Training acc\u0026#39;) plt.plot(epochs, val, \u0026#39;b\u0026#39;, label=\u0026#39;Validation acc\u0026#39;) plt.title(\u0026#34;Trainging and validation accuracy\u0026#34;) plt.legend() plt.figure() plt.plot(epochs, loss, \u0026#39;bo\u0026#39;, label=\u0026#39;Training loss\u0026#39;) plt.plot(epochs, val_loss, \u0026#39;b\u0026#39;, label=\u0026#39;Validation loss\u0026#39;) plt.title(\u0026#39;Training and validation loss\u0026#39;) plt.legend() plt.show() ","permalink":"http://yangchnet.github.io/Dessert/posts/dlml/%E7%90%86%E8%A7%A3rnn/","summary":"ç†è§£å¾ªç¯ç¥ç»ç½‘ç»œ 1. ç®€å•çš„å¾ªç¯ç¥ç»ç½‘ç»œ RNNä»¥æ¸è¿›çš„æ–¹å¼å¤„ç†ä¿¡æ¯ï¼ŒåŒæ—¶ä¿å­˜ä¸€ä¸ªå…³äºæ‰€å¤„ç†å†…å®¹çš„å†…éƒ¨æ¨¡å‹ï¼Œè¿™ä¸ªæ¨¡å‹æ˜¯æ ¹æ®è¿‡å»çš„ä¿¡æ¯æ„å»ºçš„ï¼Œå¹¶éšç€æ–°ä¿¡æ¯çš„è¿›å…¥è€Œä¸æ–­æ›´æ–°ã€‚\nRNNå¤„ç†åºåˆ—çš„æ–¹å¼æ˜¯ï¼šéå†æ‰€æœ‰åºåˆ—å…ƒç´ ï¼Œå¹¶ä¿å­˜ä¸€ä¸ªçŠ¶æ€ï¼ˆStateï¼‰ï¼Œå…¶ä¸­åŒ…å«ä¸å·²æŸ¥çœ‹å†…å®¹ç›¸å…³çš„ä¿¡æ¯ã€‚\nRNNçš„ä¼ªä»£ç ï¼š\nstate_t = 0 for input_t in input_sequence: output_t = f(input_t, state_t) state_t = output_t å¯ä»¥ç»™å‡ºå…·ä½“çš„å‡½æ•°f,ä»è¾“å…¥å’ŒçŠ¶æ€åˆ°è¾“å‡ºçš„å˜æ¢ï¼Œå…¶å‚æ•°åŒ…æ‹¬ä¸¤ä¸ªçŸ©é˜µï¼ˆWå’ŒUï¼‰å’Œä¸€ä¸ªåç½®å‘é‡ã€‚å®ƒç±»ä¼¼äºå‰é¦ˆç½‘ç»œä¸­å¯†é›†è¿æ¥å±‚æ‰€åšçš„å˜æ¢ã€‚\nstate_t = 0 for input_t in input_sequence: output_t = activation(dot(W, input_t) + dot(U, state_t) + b) state_t = output_t # ç®€å•RNNçš„numpyå®ç° import numpy as np timesteps = 100 # è¾“å…¥åºåˆ—çš„æ—¶é—´æ­¥æ•° input_features = 32 # è¾“å…¥ç‰¹å¾ç©ºé—´çš„ç»´åº¦ output_features = 64 # è¾“å‡ºç‰¹å¾ç©ºé—´çš„ç»´åº¦ inputs = np.random.random((timesteps, input_features)) # è¾“å…¥æ•°æ®ï¼šéšæœºå™ªå£°ï¼Œä»…ä½œä¸ºç¤ºä¾‹ state_t = np.zeros((output_features,)) # åˆè¯•çŠ¶æ€ï¼šå…¨é›¶å‘é‡ # åˆ›å»ºéšæœºçš„æƒé‡çŸ©é˜µ W = np.","title":"ç†è§£å¾ªç¯ç¥ç»ç½‘ç»œ"},{"content":"ç±»å‹æ–­è¨€ ç±»å‹æ–­è¨€æ˜¯ä¸€ä¸ªä½¿ç”¨åœ¨æ¥å£ä¸Šçš„æ“ä½œï¼Œè¯­æ³•ä¸Šçœ‹èµ·æ¥åƒæ˜¯x.(T)ï¼Œå› æ­¤è¢«ç§°ä¸ºæ–­è¨€ç±»å‹ï¼Œè¿™é‡Œxæ˜¯æ¥å£ï¼ŒTæ˜¯ç±»å‹ã€‚ä¸€ä¸ªç±»å‹æ–­è¨€æ£€æŸ¥å®ƒæ“ä½œå¯¹è±¡çš„åŠ¨æ€ç±»å‹æ˜¯å¦å’Œæ–­è¨€çš„ç±»å‹åŒ¹é…ã€‚\nè¿™é‡Œæœ‰ä¸¤ç§å¯èƒ½ï¼š\n å¦‚æœæ–­è¨€çš„ç±»å‹Tæ˜¯ä¸€ä¸ªå…·ä½“ç±»å‹\nç±»å‹æ–­è¨€æ£€æŸ¥xçš„åŠ¨æ€ç±»å‹æ˜¯å¦å’ŒTç›¸åŒã€‚å¦‚æœæ£€æŸ¥æˆåŠŸäº†ï¼Œç±»å‹æ–­è¨€çš„ç»“æœæ˜¯xçš„åŠ¨æ€å€¼ï¼Œå³Tã€‚æ¢å¥è¯è¯´ï¼Œå…·ä½“ç±»å‹çš„ç±»å‹æ–­è¨€ä»å®ƒçš„æ“ä½œå¯¹è±¡ä¸­è·å¾—å…·ä½“çš„å€¼ã€‚å¦‚æœæ£€æŸ¥å¤±è´¥ï¼Œæ¥ä¸‹æ¥è¿™ä¸ªæ“ä½œä¼španicã€‚  import ( \u0026#34;io\u0026#34; \u0026#34;os\u0026#34; \u0026#34;bytes\u0026#34; \u0026#34;fmt\u0026#34; ) var w io.Writer w = os.Stdout f := w.(*os.File) // ç±»å‹æ£€æŸ¥æˆåŠŸäº†ï¼Œæ‰€ä»¥fçš„å€¼ä¸ºos.Stdout f == os.Stdout // true fmt.Printf(\u0026#34;%p\u0026#34;, f)  è¾“å‡º\n 0xc0004560c0\n c := w.(*bytes.Buffer) // ç±»å‹æ£€æŸ¥å¤±è´¥  è¾“å‡º\n interface conversion: \u0026lt;io.Writer\u0026gt; is \u0026lt;*os.File\u0026gt;, not \u0026lt;*bytes.Buffer\u0026gt; æ–­è¨€çš„ç±»å‹Tæ˜¯ä¸€ä¸ªæ¥å£ç±»å‹  t, ok := i.(T) å¦‚æœiæ˜¯ç±»å‹Tï¼ˆå®ç°äº†Tæ¥å£ï¼‰ï¼Œå³æ£€æŸ¥æˆåŠŸäº†ï¼Œé‚£ä¹ˆtå°†æ˜¯içš„åŸå€¼ï¼Œokä¸ºtrueï¼›å¦‚æœæ£€æŸ¥å¤±è´¥äº†ï¼Œtå°†ä¸ºTç±»å‹çš„é›¶å€¼ï¼Œokä¸ºfalseï¼Œå¹¶ä¸”ä¸å¼•å‘panicã€‚\nå¯¹ä¸€ä¸ªæ¥å£ç±»å‹çš„ç±»å‹æ–­è¨€æ”¹å˜äº†ç±»å‹çš„è¡¨è¿°æ–¹å¼ï¼Œæ”¹å˜äº†å¯ä»¥è·å–çš„æ–¹æ³•é›†åˆï¼ˆé€šå¸¸æ›´å¤§ï¼‰ï¼Œ ä½†æ˜¯å®ƒä¿æŠ¤äº†æ¥å£å€¼å†…éƒ¨çš„åŠ¨æ€ç±»å‹å’Œå€¼çš„éƒ¨åˆ†ã€‚\nvar w io Wirter w = os.Stdout rw := w.(io.ReadWriter) w = new(ByterCounter) rw = w.(io.ReadWriter)  è¾“å‡º\n repl.go:1:10: expected \u0026lsquo;;\u0026rsquo;, found \u0026lsquo;IDENT\u0026rsquo; Wirterå¦‚æœæ–­è¨€æ“ä½œçš„å¯¹è±¡æ˜¯ä¸€ä¸ªnilæ¥å£å€¼ï¼Œé‚£ä¹ˆä¸è®ºè¢«æ–­è¨€çš„æ˜¯ä»€ä¹ˆç±»å‹ï¼Œæ–­è¨€éƒ½ä¼šå¤±è´¥ã€‚\nå¯¹ä¸€ä¸ªæ›´å°‘é™åˆ¶æ€§çš„æ¥å£ç±»å‹ï¼ˆæ›´å°‘çš„æ–¹æ³•é›†åˆï¼‰åšæ–­è¨€ï¼Œå› ä¸ºå®ƒè¡¨ç°çš„å°±åƒèµ‹å€¼æ“ä½œä¸€æ ·ï¼Œé™¤äº†å¯¹äºnilæ¥å£å€¼çš„æƒ…å†µã€‚\n","permalink":"http://yangchnet.github.io/Dessert/posts/golang/go%E4%B8%AD%E7%9A%84%E7%B1%BB%E5%9E%8B%E6%96%AD%E8%A8%80-unc/","summary":"ç±»å‹æ–­è¨€ ç±»å‹æ–­è¨€æ˜¯ä¸€ä¸ªä½¿ç”¨åœ¨æ¥å£ä¸Šçš„æ“ä½œï¼Œè¯­æ³•ä¸Šçœ‹èµ·æ¥åƒæ˜¯x.(T)ï¼Œå› æ­¤è¢«ç§°ä¸ºæ–­è¨€ç±»å‹ï¼Œè¿™é‡Œxæ˜¯æ¥å£ï¼ŒTæ˜¯ç±»å‹ã€‚ä¸€ä¸ªç±»å‹æ–­è¨€æ£€æŸ¥å®ƒæ“ä½œå¯¹è±¡çš„åŠ¨æ€ç±»å‹æ˜¯å¦å’Œæ–­è¨€çš„ç±»å‹åŒ¹é…ã€‚\nè¿™é‡Œæœ‰ä¸¤ç§å¯èƒ½ï¼š\n å¦‚æœæ–­è¨€çš„ç±»å‹Tæ˜¯ä¸€ä¸ªå…·ä½“ç±»å‹\nç±»å‹æ–­è¨€æ£€æŸ¥xçš„åŠ¨æ€ç±»å‹æ˜¯å¦å’ŒTç›¸åŒã€‚å¦‚æœæ£€æŸ¥æˆåŠŸäº†ï¼Œç±»å‹æ–­è¨€çš„ç»“æœæ˜¯xçš„åŠ¨æ€å€¼ï¼Œå³Tã€‚æ¢å¥è¯è¯´ï¼Œå…·ä½“ç±»å‹çš„ç±»å‹æ–­è¨€ä»å®ƒçš„æ“ä½œå¯¹è±¡ä¸­è·å¾—å…·ä½“çš„å€¼ã€‚å¦‚æœæ£€æŸ¥å¤±è´¥ï¼Œæ¥ä¸‹æ¥è¿™ä¸ªæ“ä½œä¼španicã€‚  import ( \u0026#34;io\u0026#34; \u0026#34;os\u0026#34; \u0026#34;bytes\u0026#34; \u0026#34;fmt\u0026#34; ) var w io.Writer w = os.Stdout f := w.(*os.File) // ç±»å‹æ£€æŸ¥æˆåŠŸäº†ï¼Œæ‰€ä»¥fçš„å€¼ä¸ºos.Stdout f == os.Stdout // true fmt.Printf(\u0026#34;%p\u0026#34;, f)  è¾“å‡º\n 0xc0004560c0\n c := w.(*bytes.Buffer) // ç±»å‹æ£€æŸ¥å¤±è´¥  è¾“å‡º\n interface conversion: \u0026lt;io.Writer\u0026gt; is \u0026lt;*os.File\u0026gt;, not \u0026lt;*bytes.Buffer\u0026gt; æ–­è¨€çš„ç±»å‹Tæ˜¯ä¸€ä¸ªæ¥å£ç±»å‹  t, ok := i.(T) å¦‚æœiæ˜¯ç±»å‹Tï¼ˆå®ç°äº†Tæ¥å£ï¼‰ï¼Œå³æ£€æŸ¥æˆåŠŸäº†ï¼Œé‚£ä¹ˆtå°†æ˜¯içš„åŸå€¼ï¼Œokä¸ºtrueï¼›å¦‚æœæ£€æŸ¥å¤±è´¥äº†ï¼Œtå°†ä¸ºTç±»å‹çš„é›¶å€¼ï¼Œokä¸ºfalseï¼Œå¹¶ä¸”ä¸å¼•å‘panicã€‚\nå¯¹ä¸€ä¸ªæ¥å£ç±»å‹çš„ç±»å‹æ–­è¨€æ”¹å˜äº†ç±»å‹çš„è¡¨è¿°æ–¹å¼ï¼Œæ”¹å˜äº†å¯ä»¥è·å–çš„æ–¹æ³•é›†åˆï¼ˆé€šå¸¸æ›´å¤§ï¼‰ï¼Œ ä½†æ˜¯å®ƒä¿æŠ¤äº†æ¥å£å€¼å†…éƒ¨çš„åŠ¨æ€ç±»å‹å’Œå€¼çš„éƒ¨åˆ†ã€‚\nvar w io Wirter w = os.Stdout rw := w.","title":"ç±»å‹æ–­è¨€"},{"content":"ç½‘é¡µé™æ€æ–‡ä»¶æ‰¾ä¸åˆ° åœ¨19-2-18çš„å¼€å§‹ï¼Œçªç„¶å‘ç°ç½‘é¡µçš„é™æ€æ–‡ä»¶æ‰¾ä¸åˆ°äº† åœ¨å°†staticç›®å½•ç§»åŠ¨åˆ°appç›®å½•å†…ä¹‹åï¼Œå‘ç°ç½‘é¡µå¯ä»¥æ­£å¸¸æ˜¾ç¤ºã€‚\n åŸæ¥staticç›®å½•æ˜¯å’Œappç›®å½•ä¸€ä¸ªå±‚çº§\n é’ˆå¯¹æ­¤é—®é¢˜çš„æ€è€ƒ STATIC_URL = \u0026lsquo;/static/\u0026rsquo; æ³¨æ„æ­¤å¤„æ˜¯urlï¼Œå³å¯¹äºé™æ€æ–‡ä»¶çš„å®šä½ï¼Œè¿™æ˜¯å¿…è¦çš„å‰æé…ç½® STATIC_URLçš„å®šä¹‰åˆ¶å®šäº†é™æ€èµ„æºçš„urlï¼Œå…·ä½“æŒ‡å„ä¸ªappä¸‹çš„staticç›®å½•  STATIC_ROOT = os.path.join(BASE_DIR, \u0026ldquo;static\u0026rdquo;) STATIC_ROOTæ˜¯æ€»çš„staticç›®å½•ï¼Œä¸»è¦ç”¨äºåœ¨è¿è¡Œ collectstaticå‘½ä»¤æ—¶å­˜å‚¨æ‰€æœ‰çš„é™æ€æ–‡ä»¶  STATICFILES_DIRS = [os.path.join(BASE_DIR, \u0026ldquo;static\u0026rdquo;), \u0026lsquo;mysite/static\u0026rsquo;,]  STATICFILES_DIRSæ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œå­˜æ”¾å„ä¸ªappçš„staticç›®å½•åŠå…¬å…±çš„staticç›®å½•  â€‹\nå®˜ç½‘é…ç½®   ç¡®ä¿django.contrib.staticfilesåŒ…å«åœ¨æ‚¨çš„ INSTALLED_APPSã€‚\n  åœ¨æ‚¨çš„è®¾ç½®æ–‡ä»¶ä¸­ï¼Œå®šä¹‰STATIC_URLï¼Œä¾‹å¦‚ï¼š\n  STATIC_URL = \u0026#39;/static/\u0026#39; åœ¨æ¨¡æ¿ä¸­ï¼Œä½¿ç”¨staticæ¨¡æ¿æ ‡è®°ä½¿ç”¨å·²é…ç½®çš„ç›¸å¯¹è·¯å¾„æ„å»ºURL STATICFILES_STORAGEã€‚  {% load static %} \u0026lt;img src=\u0026#34;{% static \u0026#34;my_app/example.jpg\u0026#34; %}\u0026#34; alt=\u0026#34;My image\u0026#34;/\u0026gt; å°†é™æ€æ–‡ä»¶å­˜å‚¨staticåœ¨åº”ç”¨ç¨‹åºä¸­è°ƒç”¨çš„æ–‡ä»¶å¤¹ä¸­ã€‚ä¾‹å¦‚my_app/static/my_app/example.jpgã€‚  å¯¹äºæ¨¡æ¿ä¸­çš„{% load static%} å½“åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨è¿‡load staticä¹‹åï¼Œå†æ¬¡ä½¿ç”¨staticæ—¶ï¼Œå°†ä¼šä½¿ç”¨STATICFILES_FINDERSå¯»æ‰¾é™æ€æ–‡ä»¶ï¼Œå…¶é»˜è®¤å€¼ä¸ºï¼š\n[ \u0026#39;django.contrib.staticfiles.finders.FileSystemFinder\u0026#39;, \u0026#39;django.contrib.staticfiles.finders.AppDirectoriesFinder\u0026#39;, ] å¯¹æ­¤çš„è§£é‡Šæ˜¯ï¼Œå°†ä¼šä»STATICFILES_DIRSçš„ç›®å½•ä¸­ä»¥åŠæ¯ä¸ªappä¸‹çš„staticç›®å½•ä¸­å¯»æ‰¾é™æ€æ–‡ä»¶ã€‚\nåœ¨urlååŠ å…¥+ static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)\nï¼ˆè¦åœ¨settingå®šä¹‰ MEDIA_URL MEDIA_ROOTï¼‰\n","permalink":"http://yangchnet.github.io/Dessert/posts/django/%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6%E6%89%BE%E4%B8%8D%E5%88%B0/","summary":"ç½‘é¡µé™æ€æ–‡ä»¶æ‰¾ä¸åˆ° åœ¨19-2-18çš„å¼€å§‹ï¼Œçªç„¶å‘ç°ç½‘é¡µçš„é™æ€æ–‡ä»¶æ‰¾ä¸åˆ°äº† åœ¨å°†staticç›®å½•ç§»åŠ¨åˆ°appç›®å½•å†…ä¹‹åï¼Œå‘ç°ç½‘é¡µå¯ä»¥æ­£å¸¸æ˜¾ç¤ºã€‚\n åŸæ¥staticç›®å½•æ˜¯å’Œappç›®å½•ä¸€ä¸ªå±‚çº§\n é’ˆå¯¹æ­¤é—®é¢˜çš„æ€è€ƒ STATIC_URL = \u0026lsquo;/static/\u0026rsquo; æ³¨æ„æ­¤å¤„æ˜¯urlï¼Œå³å¯¹äºé™æ€æ–‡ä»¶çš„å®šä½ï¼Œè¿™æ˜¯å¿…è¦çš„å‰æé…ç½® STATIC_URLçš„å®šä¹‰åˆ¶å®šäº†é™æ€èµ„æºçš„urlï¼Œå…·ä½“æŒ‡å„ä¸ªappä¸‹çš„staticç›®å½•  STATIC_ROOT = os.path.join(BASE_DIR, \u0026ldquo;static\u0026rdquo;) STATIC_ROOTæ˜¯æ€»çš„staticç›®å½•ï¼Œä¸»è¦ç”¨äºåœ¨è¿è¡Œ collectstaticå‘½ä»¤æ—¶å­˜å‚¨æ‰€æœ‰çš„é™æ€æ–‡ä»¶  STATICFILES_DIRS = [os.path.join(BASE_DIR, \u0026ldquo;static\u0026rdquo;), \u0026lsquo;mysite/static\u0026rsquo;,]  STATICFILES_DIRSæ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œå­˜æ”¾å„ä¸ªappçš„staticç›®å½•åŠå…¬å…±çš„staticç›®å½•  â€‹\nå®˜ç½‘é…ç½®   ç¡®ä¿django.contrib.staticfilesåŒ…å«åœ¨æ‚¨çš„ INSTALLED_APPSã€‚\n  åœ¨æ‚¨çš„è®¾ç½®æ–‡ä»¶ä¸­ï¼Œå®šä¹‰STATIC_URLï¼Œä¾‹å¦‚ï¼š\n  STATIC_URL = \u0026#39;/static/\u0026#39; åœ¨æ¨¡æ¿ä¸­ï¼Œä½¿ç”¨staticæ¨¡æ¿æ ‡è®°ä½¿ç”¨å·²é…ç½®çš„ç›¸å¯¹è·¯å¾„æ„å»ºURL STATICFILES_STORAGEã€‚  {% load static %} \u0026lt;img src=\u0026#34;{% static \u0026#34;my_app/example.jpg\u0026#34; %}\u0026#34; alt=\u0026#34;My image\u0026#34;/\u0026gt; å°†é™æ€æ–‡ä»¶å­˜å‚¨staticåœ¨åº”ç”¨ç¨‹åºä¸­è°ƒç”¨çš„æ–‡ä»¶å¤¹ä¸­ã€‚ä¾‹å¦‚my_app/static/my_app/example.jpgã€‚  å¯¹äºæ¨¡æ¿ä¸­çš„{% load static%} å½“åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨è¿‡load staticä¹‹åï¼Œå†æ¬¡ä½¿ç”¨staticæ—¶ï¼Œå°†ä¼šä½¿ç”¨STATICFILES_FINDERSå¯»æ‰¾é™æ€æ–‡ä»¶ï¼Œå…¶é»˜è®¤å€¼ä¸ºï¼š\n[ \u0026#39;django.contrib.staticfiles.finders.FileSystemFinder\u0026#39;, \u0026#39;django.contrib.staticfiles.finders.AppDirectoriesFinder\u0026#39;, ] å¯¹æ­¤çš„è§£é‡Šæ˜¯ï¼Œå°†ä¼šä»STATICFILES_DIRSçš„ç›®å½•ä¸­ä»¥åŠæ¯ä¸ªappä¸‹çš„staticç›®å½•ä¸­å¯»æ‰¾é™æ€æ–‡ä»¶ã€‚\nåœ¨urlååŠ å…¥+ static(settings.MEDIA_URL, document_root=settings.","title":"ç½‘é¡µé™æ€æ–‡ä»¶æ‰¾ä¸åˆ°"},{"content":"è®°ä½è´¦å·å¯†ç  git config --global credential.helper store ç„¶åå†è¿è¡Œä¸€égit pullæˆ–git pushå°±å¯ä»¥äº†\nä½¿ç”¨å¯†é’¥éªŒè¯(æ¨è) å‚è€ƒä¸»æœºä¸Šè®¾ç½®ä¸¤ä¸ªgitè´¦å·\n","permalink":"http://yangchnet.github.io/Dessert/posts/git/git%E6%AF%8F%E6%AC%A1%E9%83%BD%E8%A6%81%E8%BE%93%E5%85%A5%E5%AF%86%E7%A0%81/","summary":"è®°ä½è´¦å·å¯†ç  git config --global credential.helper store ç„¶åå†è¿è¡Œä¸€égit pullæˆ–git pushå°±å¯ä»¥äº†\nä½¿ç”¨å¯†é’¥éªŒè¯(æ¨è) å‚è€ƒä¸»æœºä¸Šè®¾ç½®ä¸¤ä¸ªgitè´¦å·","title":"è§£å†³githubæ¯æ¬¡pushéƒ½è¦è¾“å…¥å¯†ç "},{"content":"é¸­å­ç±»å‹ 1. ä»€ä¹ˆæ˜¯é¸­å­ç±»å‹ åªè¦èµ°èµ·è·¯æ¥åƒé¸­å­ï¼Œå«èµ·æ¥åƒé¸­å­ï¼Œå°±å¯ä»¥è®¤ä¸ºæ˜¯é¸­å­ã€‚è¿™å°±æ˜¯é¸­å­ç±»å‹\n2. é¸­å­ç±»å‹æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ å¯¹åº”äºgolangä¸­çš„æ¥å£çš„æ¦‚å¿µï¼Œä¸€ä¸ªæ¥å£å®šä¹‰äº†ä¸€ç»„æ“ä½œï¼Œè¿™ç»„æ“ä½œå¯ä»¥çœ‹åšæ˜¯é¸­å­çš„èµ°è·¯ï¼Œå«ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦ä»»ä½•ç±»å‹æ»¡è¶³äº†è¿™ç»„æ–¹æ³•ï¼Œé‚£ä¹ˆå°±å¯ä»¥çœ‹åšæ˜¯é¸­å­\u0026ndash;å³æ»¡è¶³äº†è¿™ä¸ªæ¥å£ï¼Œå¯ä»¥çœ‹åšæ˜¯è¿™ä¸ªæ¥å£ç±»å‹ã€‚\n","permalink":"http://yangchnet.github.io/Dessert/posts/golang/%E9%B8%AD%E5%AD%90%E7%B1%BB%E5%9E%8B/","summary":"é¸­å­ç±»å‹ 1. ä»€ä¹ˆæ˜¯é¸­å­ç±»å‹ åªè¦èµ°èµ·è·¯æ¥åƒé¸­å­ï¼Œå«èµ·æ¥åƒé¸­å­ï¼Œå°±å¯ä»¥è®¤ä¸ºæ˜¯é¸­å­ã€‚è¿™å°±æ˜¯é¸­å­ç±»å‹\n2. é¸­å­ç±»å‹æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ å¯¹åº”äºgolangä¸­çš„æ¥å£çš„æ¦‚å¿µï¼Œä¸€ä¸ªæ¥å£å®šä¹‰äº†ä¸€ç»„æ“ä½œï¼Œè¿™ç»„æ“ä½œå¯ä»¥çœ‹åšæ˜¯é¸­å­çš„èµ°è·¯ï¼Œå«ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦ä»»ä½•ç±»å‹æ»¡è¶³äº†è¿™ç»„æ–¹æ³•ï¼Œé‚£ä¹ˆå°±å¯ä»¥çœ‹åšæ˜¯é¸­å­\u0026ndash;å³æ»¡è¶³äº†è¿™ä¸ªæ¥å£ï¼Œå¯ä»¥çœ‹åšæ˜¯è¿™ä¸ªæ¥å£ç±»å‹ã€‚","title":"é¸­å­ç±»å‹"},{"content":"ä¸€åˆ‡è¡ŒåŠ¨æœ‰è§„åˆ’ ä½œä¸ºè®¡ç®—æœºä¸“ä¸šçš„å­¦ç”Ÿï¼Œæˆ‘ä»¬è¦è€ƒçš„ç§‘ç›®å¾ˆå¤šï¼Œéå†ä¸‹æ¥æœ‰æ”¿æ²»ã€è‹±è¯­ã€é«˜ç­‰æ•°å­¦ã€çº¿æ€§ä»£æ•°ã€æ¦‚ç‡è®ºä¸æ•°ç†ç»Ÿè®¡ã€408è®¡ç®—æœºä¸“ä¸šç»¼åˆï¼ˆæ•°æ®ç»“æ„ã€è®¡ç®—æœºç»„æˆåŸç†ã€æ“ä½œç³»ç»Ÿã€è®¡ç®—æœºç½‘ç»œï¼‰ï¼Œå¦‚æœæ²¡æœ‰ä¸€ä¸ªè¯¦ç»†çš„è§„åˆ’ï¼Œä¸çŸ¥é“å¦‚ä½•å®‰æ’æ—¶é—´ï¼Œå°±ä¼šæ„Ÿè§‰ä¸€å›¢ä¹±éº»ï¼Œæ€»æ˜¯æ„Ÿè§‰åšæ­¤è–„å½¼æˆ–æ˜¯æ¯«æ— å¤´ç»ªã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªåˆç†çš„æ—¶é—´å®‰æ’ã€‚é¦–å…ˆæ˜¯ä¸€ä¸ªæ€»çš„æ—¶é—´å®‰æ’ï¼Œå³å¤ä¹ çš„è¿›åº¦å®‰æ’ï¼Œæ¯”å¦‚ï¼Œè¦åœ¨9æœˆä¹‹å‰å®Œæˆä¸€è½®å¤ä¹ ã€11æœˆä¹‹å‰å®ŒæˆäºŒè½®å¤ä¹ ç­‰ã€‚æ¥ä¸‹æ¥ï¼Œè¦æ ¹æ®è¿›åº¦å®‰æ’ï¼Œé€‚å½“å®‰æ’è‡ªå·±çš„æ¯ä¸€å¤©ï¼Œè¿™é‡Œæ‰€è¯´çš„é€‚å½“æ˜¯æŒ‡ï¼šæŒ‰ç…§ä½ çš„èƒ½åŠ›å’Œå¤ä¹ è¿›åº¦ç»™è‡ªå·±ä¸€ä¸ªåœ¨èƒ½åŠ›èŒƒå›´ä¹‹å†…çš„ç›®æ ‡å€¼ï¼Œå¹¶åŠªåŠ›å»å®Œæˆå®ƒï¼Œä½†åŒæ—¶æˆ‘ä»¬è¦ç»™è‡ªå·±è®¾å®šä¸€ä¸ªæœ€ä½ç›®æ ‡ä»¥é­ç­–è‡ªå·±ã€‚æ”¿æ²»ä¸­è¯´ï¼Œæˆ‘ä»¬è¦åšæŒåº•çº¿æ€ç»´ï¼Œç«‹è¶³æœ€ä½ç‚¹ï¼Œäº‰å–æœ€å¤§å€¼ï¼Œå°±æ˜¯è¿™ä¸ªé“ç†ã€‚\nä¸æµªè´¹ä¸€åˆ†ä¸€ç§’ å¾ˆæ˜æ˜¾ï¼Œè€ƒç ”æ—¶é—´éå¸¸ä¹‹ç´§å¼ ï¼Œæˆ‘ä»¬ä¸€èˆ¬æ˜¯ä»3æœˆå·¦å³å¼€å§‹å¤ä¹ ï¼Œè€Œæ­¤æ—¶çš„å¤ä¹ æ˜¾ç„¶ä¸èƒ½å¾ˆå¿«è¿›å…¥çŠ¶æ€ã€‚å› æ­¤ï¼Œå¾ˆå¤šäººçš„å¤ä¹ å®é™…ä¸Šæ˜¯ä»æš‘å‡æ‰çœŸæ­£å¼€å§‹ï¼Œå‰é¢åªèƒ½ç®—æ˜¯é¢„çƒ­ã€‚ä»æš‘å‡å¼€å§‹ï¼Œæˆ‘ä»¬å°±è¦è¿›å…¥ä¸€ä¸ªç´§å¼ çš„çŠ¶æ€ï¼Œæ¯å¤©åŸºæœ¬åªæœ‰ä¸‰ä»¶äº‹ï¼šçœ‹ä¹¦ã€åƒé¥­ã€ç¡è§‰ã€‚æˆ‘å‘Šè¯‰å¤§å®¶ä¸è¦æµªè´¹ä¸€åˆ†ä¸€ç§’ï¼Œä¸æ˜¯è®©å¤§å®¶åºŸå¯å¿˜é£Ÿï¼Œä¸é¡¾èº«ä½“ï¼Œæ¯å¤©åšä¸€ä¸ªè«å¾—æ„Ÿæƒ…çš„åˆ·é¢˜æœºå™¨ï¼Œè€Œæ˜¯è®©å¤§å®¶çæƒœå­¦ä¹ æ—¶é—´ä¸­çš„æ¯ä¸€åˆ†ï¼Œæ¯ä¸€ç§’ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ å¯ä»¥æœ‰é€‚å½“çš„ä¼‘æ¯æ—¶é—´ï¼Œæš‘å‡ä¹Ÿå¯ä»¥é€‚å½“å›å®¶ç©ç©ï¼Œä½†æ˜¯å½“ä½ ååˆ°ä¹¦æ¡Œæ—ï¼Œå°±å¿…é¡»å¿ƒæ— æ—éª›ï¼Œä¸“å¿ƒå­¦ä¹ ã€‚\nä¸€åˆ‡ç›®æ ‡ä¸ºè€ƒç ” è€ƒç ”çš„æ—¶å€™ï¼Œä½ å¯èƒ½è§‰å¾—æœ‰å¾ˆå¤šäº‹æƒ³åšï¼Œä½†æ˜¯ä½ è¦è€ƒè™‘åˆ°ï¼Œåšè¿™ä»¶äº‹å¯¹ä½ çš„è€ƒç ”åˆè¯•æˆç»©æé«˜æœ‰æ²¡æœ‰æ„ä¹‰ã€‚è¿™é‡Œä¹‹æ‰€ä»¥å¼ºè°ƒåˆè¯•ï¼Œæ˜¯å› ä¸ºå¾ˆå¤šäººè§‰å¾—ï¼Œè¿™ä»¶äº‹å¯¹å¤è¯•å¾ˆå¥½ï¼Œæˆ‘å¯ä»¥æå‰åšã€‚å…¶å®ä¸ç„¶ï¼Œè¯´å¥ä¸å¥½å¬çš„ï¼Œè¿˜ä¸ä¸€å®šèƒ½è¿›å¤è¯•å‘¢ã€‚ç‰¢è®°è‡ªå·±çš„ç›®æ ‡ï¼Œå°†è€ƒç ”ä¼˜å…ˆçº§æåˆ°æœ€é«˜ï¼Œåœ¨è€ƒç ”æœŸé—´ï¼Œåªæœ‰é‚£äº›èƒ½æé«˜ä½ æˆç»©çš„äº‹åšçš„æ‰æœ‰æ„ä¹‰ï¼Œå…¶ä»–çš„äº‹ï¼Œå…ˆæ”¾ä¸€æ”¾ç½¢ã€‚å»¶è¿Ÿäº«å—ã€‚\n é€‚å½“ä¼‘æ¯ å¤§å®¶éƒ½è¯´è€ƒç ”æ˜¯ä¸€åœºæŒä¹…æˆ˜ï¼Œäº‹å®å¦‚æ­¤ã€‚æ¯å¤©ä»æ—©ä¸Šåˆ°æ™šä¸Šååœ¨ä¹¦æ¡Œæ—ï¼Œåˆšå¼€å§‹å¯èƒ½ä¸è§‰å¾—æœ‰ä»€ä¹ˆï¼Œç„¶åä½ ä¼šå¼€å§‹å±è‚¡ç–¼ï¼Œè¿™æ—¶å€™ä¸€ä¸ªåå«å°±å¯ä»¥è§£å†³é—®é¢˜ï¼Œå†ç„¶åä½ ä¼šæ„Ÿåˆ°éª¨å¤´ä»¿ä½›ç”Ÿé”ˆï¼Œè„–å­ä¸èˆ’æœï¼Œè¿™æ—¶å€™ä½ éœ€è¦ä¸€æœ¬é¢ˆå¤åº·æŒ‡å—ï¼Œæœ€åä½ ä¼šå‘ç°è§†åŠ›ä¸‹é™ã€å‘é‡å‡å°‘ï¼Œè¿™æ—¶å€™ä½ éœ€è¦ä¸€ç“¶éœ¸ç‹ã€‚æ¯å‘¨æˆ‘ä»¬åº”è¯¥ä¸ºè‡ªå·±å®‰æ’ä¸€ä¸ªä¼‘æ¯æ—¶é—´ï¼Œæ¯”å¦‚å‘¨æ—¥æˆ–å‘¨å…­ï¼Œè€Œä¸”æˆ‘å»ºè®®ï¼Œè¿™ä¸ªä¼‘æ¯æ—¶é—´åº”æ”¾åœ¨ä¸Šåˆï¼Œè€Œä¸æ˜¯ä¸‹åˆæˆ–æ™šä¸Šã€‚æ”¾åœ¨ä¸‹åˆçš„è¯ï¼Œæˆ‘ä»¬å¯èƒ½ä¼‘æ¯çš„æœ‰ç‚¹æ‡’æ•£ï¼Œå¹²è„†æ™šä¸Šä¹Ÿä¸å»äº†ï¼Œè¿™æ ·å°±æŠŠæ™šä¸Šä¹Ÿæµªè´¹æ‰äº†ï¼Œæ™šä¸Šçš„è¯ï¼Œå¤§å®¶å¯èƒ½åˆç©çš„å¤ªå—¨ï¼Œå¯¼è‡´ç¬¬äºŒå¤©èµ·ä¸æ¥ï¼Œè€Œæ”¾åœ¨ä¸Šåˆï¼Œä¸€æ˜¯å¯ä»¥ç¡ä¸ªæ‡’è§‰ï¼ŒäºŒæ˜¯å½“ä½ å­¦ä¹ äº†ä¸€ä¸ªä¸‹åˆåŠ ä¸€ä¸ªæ™šä¸Šåï¼Œæ™šä¸Šå›åˆ°å¯å®¤ï¼Œä¾ç„¶è¿˜è·Ÿä»¥å‰çš„çŠ¶æ€ä¸€æ ·ï¼Œæ„Ÿè§‰ä¸Šå°±åƒå­¦äº†ä¸€æ•´å¤©ï¼Œå¯ä»¥å……åˆ†ä¿æŒè‡ªå·±çš„çŠ¶æ€ã€‚åšæŒé”»ç‚¼ï¼Œèº«ä½“æ˜¯é©å‘½çš„æœ¬é’±ï¼Œæ²¡æœ‰è‰¯å¥½çš„èº«ä½“ç´ è´¨åšæ”¯æ’‘ï¼Œå¦‚ä½•èƒ½æ‰¿å—æ¯å¤©14ä¸ªå°æ—¶ï¼Œå…¨å¹´æ— ä¼‘çš„å­¦ä¹ .\nåšé¢˜è¦åšå® æ¯åšä¸€é¢˜ï¼Œåº”è¯¥åšä¸€ä¸ªæ·±å…¥çš„æ€è€ƒï¼Œå¹¶æ‹¿ç¬”è®°å½•ä¸‹æ¥ï¼Œè¿™å¹¶ä¸æ˜¯åœ¨æµªè´¹ä½ çš„åˆ·é¢˜æ—¶é—´ï¼Œè€Œæ˜¯åœ¨èŠ‚çœä½ å°†æ¥çš„å¤ä¹ æ—¶é—´ã€‚æ¯”å¦‚ï¼Œæˆ‘åšå®Œä¸€é¢˜ï¼Œæˆ‘ä¼šç»™ä»–è¯„ä¸€ä¸ªåˆ†æ•°ï¼ŒåæœŸè¿˜ä¼šæŒ‡å‡ºå…¶æ‰€è€ƒçš„çŸ¥è¯†ç‚¹ã€‚ä¹‹æ‰€ä»¥åæœŸæ‰æŒ‡å‡ºçŸ¥è¯†ç‚¹ï¼Œæ˜¯å› ä¸ºå‰æœŸæˆ‘å¯¹çŸ¥è¯†ç‚¹çš„æŒæ¡è¿˜ä¸å…¨é¢ä¸åˆ°ä½ã€‚æˆ‘å¯¹é¢˜ç›®çš„è¯„åˆ†è§„åˆ™å¦‚ä¸‹ï¼šï¼ˆå¤§å®¶éƒ½çŸ¥é“ï¼Œåœ¨Linuxç³»ç»Ÿä¸­æœ‰æƒé™ç®¡ç†ï¼Œæ¯”å¦‚ä¸€ä¸ªæ–‡ä»¶ï¼Œå®ƒå¯¹äºæ–‡ä»¶æ‰€æœ‰è€…çš„æƒé™å¯èƒ½æ˜¯rwx,ä»£è¡¨å¯è¯»å¯å†™å¯æ‰§è¡Œï¼Œå…¶ä¸­rä¸ºè¯»ï¼Œç”¨æ•°å­—1è¡¨ç¤ºï¼Œwä¸ºå†™ï¼Œç”¨æ•°å­—3è¡¨ç¤ºï¼Œxä¸ºæ‰§è¡Œï¼Œç”¨æ•°å­—5è¡¨ç¤ºï¼Œé‚£ä¹ˆæ­¤æ–‡ä»¶å¯¹äºå¦ä¸€ä¸ªç”¨æˆ·çš„æƒé™ä¸º5ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“å°±å¯æ¨ç®—å‡ºè¿™ä¸ªç”¨æˆ·å¯¹è¿™ä¸ªæ–‡ä»¶åªå…·æœ‰è¯»å’Œæ‰§è¡Œæƒé™ï¼Œä¸å…·æœ‰å†™æƒé™ã€‚ï¼‰[â€œç¬¬ä¸€æ¬¡ä¸ä¼šåšâ€ï¼Œâ€œå¥½é¢˜â€ï¼Œâ€œéš¾é¢˜â€ï¼Œâ€œç»¼åˆé¢˜â€], å…¶ä¸­â€œç¬¬ä¸€æ¬¡ä¸ä¼šåšâ€å¯¹åº”1ï¼Œâ€œå¥½é¢˜â€å¯¹åº”2ï¼Œâ€œéš¾é¢˜â€å¯¹åº”4ï¼Œâ€œç»¼åˆé¢˜â€å¯¹åº”8ï¼Œè¿™æ ·çš„è¯ï¼Œå¦‚æœæˆ‘å¯¹ä¸€ä¸ªé¢˜ç›®çš„è¯„åˆ†ä¸º6ï¼ˆå¯ä»¥å†™ä½œ$=6æˆ–ä»»ä½•å…¶ä»–æ ‡å¿—ï¼‰ï¼Œé‚£ä¹ˆå°±å¯ä»¥å¾ˆå®¹æ˜“å¾—çŸ¥ï¼Œè¿™ä¸ªé¢˜æ¯”è¾ƒå¥½ï¼Œå¹¶ä¸”æ¯”è¾ƒéš¾ï¼Œä½†æ˜¯æˆ‘ç¬¬ä¸€æ¬¡å¯ä»¥åšå‡ºæ¥ã€‚å½“ç„¶ï¼Œè¿™å››ä¸ªè¯„ä»·å®Œå…¨å¯ä»¥æ¢æˆä»»ä½•å…¶ä»–è¯„ä»·ï¼Œåªè¦ä½ è§‰å¾—æœ‰ç”¨å°±å¥½ã€‚çŸ¥è¯†ç‚¹æˆ‘ä¼šç”¨[]æ¥æ ‡æ³¨ï¼Œæ¯”å¦‚æŸä¸ªé¢˜è€ƒäº†äºŒç»´æ¦‚ç‡å¯†åº¦ï¼Œé‚£ä¹ˆå°±ç”¨çº¢ç¬”æ ‡æ³¨[äºŒç»´æ¦‚ç‡å¯†åº¦]ã€‚ä½ å¯ä»¥ç”¨ä½ ç‹¬ç‰¹çš„æ–¹æ³•æ¥æ ‡æ³¨ä½ åšè¿‡çš„é¢˜ç›®ï¼Œæ¥è®©è‡ªå·±ä»¥åçš„å¤ä¹ æ›´åŠ å…·æœ‰é’ˆå¯¹æ€§ã€‚ä½†æ˜¯ä¸è¦å¿˜è®°ï¼Œè¿™äº›ä¸œè¥¿åªæ˜¯å¸®ä½ è®°å½•ä¸€äº›ä¸œè¥¿ï¼Œä½ éœ€è¦è‡ªå·±åŠ¨è„‘æƒ³ä¸€æƒ³ï¼Œå°†è¿™ä¸ªé¢˜çš„å‡ºé¢˜ç›®çš„ï¼Œç­”é¢˜æŠ€å·§ï¼Œç›¸ä¼¼è€ƒé¢˜ç­‰éƒ½è¿‡ä¸€éã€‚æœ€é‡è¦çš„è¿˜æ˜¯è‡ªå·±çš„æ€è€ƒè¿‡ç¨‹ï¼Œä¸è¦è¢«è¿™äº›èŠ±é‡Œèƒ¡å“¨çš„ä¸œè¥¿è¿·èŠ±äº†çœ¼ã€‚\nçŸ¥è¯†è¦æ€»ç»“ å­¦è¿‡çš„çŸ¥è¯†ï¼Œè¦è¶çƒ­æ‰“é“ï¼Œå¯¹å…¶è¿›è¡Œæœ‰é’ˆå¯¹æ€§çš„æ€»ç»“ï¼Œå°†çŸ¥è¯†ç‚¹ï¼Œè‡ªå·±çš„ç†è§£ç­‰éƒ½è®°ä¸‹æ¥ã€‚ä¸è¿‡ä¸å¯èƒ½ä¼šè¯´ï¼Œé‚£äº›çŸ¥è¯†ç‚¹è¾…å¯¼ä¹¦ä¸Šéƒ½å·²ç»æœ‰äº†ï¼Œæˆ‘ä¸ºä»€ä¹ˆè¦å†å†™ä¸€éï¼Œè¿™ä¸æ˜¯æµªè´¹æˆ‘æ—¶é—´å˜›ã€‚æˆ‘æƒ³å‘Šè¯‰ä½ çš„æ˜¯ï¼Œä¹¦ä¸Šçš„æ˜¯é¢å‘æ‰€æœ‰è€ƒç”Ÿçš„ï¼Œè€Œä½ å†™ä¸‹æ¥ï¼Œåªæ˜¯é¢å¯¹ä½ è‡ªå·±ã€‚ç°åœ¨çš„ä¸œè¥¿éƒ½è®²ç©¶ä¸ªæ€§åŒ–ï¼Œæˆ‘ä»¬ä¹Ÿè¦ç»™è‡ªå·±ä¸€ä¸ªä¸ªæ€§åŒ–å®šåˆ¶çš„çŸ¥è¯†ç³»ç»Ÿã€‚æ€»ç»“ä¸åªæ˜¯ç®€å•çš„æŠŠçŸ¥è¯†ç‚¹æŠ„ä¸‹æ¥ï¼Œå…¶ä¸­è¿˜åŒ…å«è¿™ä½ å¯¹çŸ¥è¯†ç‚¹çš„ç†è§£ï¼Œç”šè‡³ä½ è¿˜å¯ä»¥åŠ ä¸Šè¿™ä¸ªçŸ¥è¯†ç‚¹çš„ç»å…¸ä¾‹é¢˜ã€‚ä¸è¿‡ï¼Œæˆ‘è§è¿‡å¾ˆå¤šäººï¼ŒçŸ¥è¯†ç‚¹æ€»ç»“çš„å¾ˆå¥½ï¼Œå¯æƒœåˆ°æœ€åéƒ½æ²¡çœ‹ï¼Œè¯¸å›è¦é¿å…è¿™ä¸ªé—®é¢˜ï¼Œä¸ç„¶ä¸å¦‚çœä¸‹æ—¶é—´èƒŒå‡ ä¸ªè‹±è¯­å•è¯ã€‚\nåšé”™é¢˜è¦è®¢æ­£å¹¶ç‰¢è®° è€ƒç ”å¤ä¹ ï¼Œå‰æœŸåšåŠ æ³•ï¼Œå³ä¸æ–­å¢åŠ è‡ªå·±çš„çŸ¥è¯†ï¼ŒåæœŸåšå‡æ³•ï¼Œå³å‡å°‘è‡ªå·±ä¸ä¼šçš„ï¼ŒæŸ¥æ¼è¡¥ç¼ºã€‚é‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆçŸ¥é“å“ªé‡Œæœ‰æ¼æ´ï¼Œå“ªé‡Œéœ€è¦è¡¥å‘¢ï¼Ÿæ˜¾ç„¶ï¼Œé”™é¢˜å¯ä»¥å¸®æˆ‘ä»¬å¿«é€Ÿå®šä½ï¼Œå°±å¥½åƒä¸€ä¸ªé”™è¯¯çš„è¾“å‡ºå¯ä»¥å¸®æˆ‘ä»¬å®šä½ä¸€ä¸ªbugã€‚é¢˜ç›®åšé”™ï¼Œä¸ä¸€å®šæ˜¯å› ä¸ºæ­¤å¤„æœªæŒæ¡å¥½ï¼Œè¿˜æœ‰å¯èƒ½æ˜¯é¢˜ç›®å¤ªéš¾ã€ç²—å¿ƒåšé”™ï¼Œä½†æ— è®ºæ˜¯å“ªç§é—®é¢˜ï¼Œé”™é¢˜éƒ½æ˜¯æˆ‘ä»¬å¿«é€Ÿæ‰¾åˆ°æ¼æ´çš„æœ€å¥½åŠæ³•ã€‚å¯¹å¾…é”™é¢˜ï¼Œæˆ‘ä»¬æœ€å¥½æœ‰ä¸€ä¸ªä¸“é—¨çš„é”™é¢˜æœ¬ï¼ˆæ‰¾ä¸€ä¸ªå¥½ç‚¹çš„æœ¬å­ï¼Œè¿™æ ·ä½ ä¸¢ä¹Ÿä¸èˆå¾—ä¸¢ï¼Œå†™èµ·æ¥ä¹Ÿèˆ’æœï¼‰ï¼Œå°†è‡ªå·±çš„é”™é¢˜æ‘˜æŠ„åˆ°ä¸Šé¢å¹¶å†™ä¸‹é”™è¯¯åŸå› ä¸æ­£ç¡®ç­”æ¡ˆã€‚åæœŸé”™é¢˜æœ¬å°†æ´¾ä¸Šå¤§ç”¨åœºã€‚\nä¸ç•éš¾ ä¸ç•éš¾ï¼ŒæŒ‡ä¸æ€•éš¾é¢˜ï¼Œä¸æ€•éš¾å­¦çš„çŸ¥è¯†ç‚¹ï¼Œä»»ä½•çŸ¥è¯†ç‚¹åªè¦å‡ºç°ï¼Œå°±è¯´æ˜å®ƒå®Œå…¨åœ¨æˆ‘ä»¬å¯ç†è§£çš„èŒƒå›´ä¹‹å†…ã€‚ä¸è¦è®©ä¸€ä¸ªåŸºæœ¬çš„çŸ¥è¯†ç‚¹æˆä¸ºä½ çš„ç»Šè„šçŸ³ï¼Œé‚£å°±å¤ªè ¢äº†ã€‚ä¸ä¼šçš„å¯ä»¥å‘åˆ«äººè™šå¿ƒè¯·æ•™ï¼Œå¯ä»¥å’ŒåŒå­¦æˆ–æœ‹å‹çº¦å¥½ï¼Œæ¯å‘¨æ‰¾ä¸ªæ—¶é—´ä¸“é—¨è®¨è®ºè¿™ä¸ªæ˜ŸæœŸé‡åˆ°çš„ç¡¬éª¨å¤´ã€‚\nä¸æµ®èº è€ƒç ”æ˜¯ååˆ†æ¯ç‡¥ä¹å‘³çš„ï¼Œç»ˆæ—¥åŸ‹å¤´è‹¦å­¦ï¼Œæ²¡äººè¯´è¯ï¼Œä¹Ÿæ²¡äººç®¡ä½ ï¼Œä½ éœ€è¦è°ƒèŠ‚è‡ªå·±çš„å¿ƒç†ï¼Œä¸è¦å¿ƒæµ®æ°”èºã€‚è€ƒç ”çš„æ—¶å€™å¤§å®¶ä¸€èˆ¬éƒ½ä¸å¸¦æ‰‹æœºï¼Œæœ‰çš„äººä¼šå¸¦ä¸ªè€³æœºï¼Œå¸¦ä¸ªMP3å¬ä¸ªéŸ³ä¹ã€‚è¿œç¦»æ‰‹æœºï¼Œä»ä½ åšèµ·ã€‚\nä¸å¦„è‡ªè²è–„ ä¸ç®¡æ˜¯è€ƒç ”å‰æœŸã€ä¸­æœŸè¿˜æ˜¯åæœŸï¼Œæ€»ä¼šå¬åˆ°ä¸€äº›â€œå¤§ç¥â€çš„æˆ˜ç»©ã€‚æ¯”å¦‚è€ƒç ”åˆï¼Œå¬è¯´å“ªä¸ªå“ªä¸ªè¾…å¯¼ä¹¦éƒ½äºŒåˆ·äº†ï¼Œè€ƒç ”åæœŸï¼Œå¬è¯´å“ªä¸ªå“ªä¸ªæ•°å­¦çœŸé¢˜åšäº†å¥½å‡ ä¸ª150ã€‚æˆ‘æƒ³è¯´ï¼Œè¿™äº›å’Œä½ æ²¡å…³ç³»ï¼Œè¾…å¯¼ä¹¦äºŒåˆ·çš„æœªå¿…åšæŒåˆ°è€ƒè¯•ï¼Œå¯èƒ½ä¸­é—´å°±ä¸šç­¾ä¸‰æ–¹èµ°äººäº†ï¼ˆçœŸå®ç»å†ï¼Œå½“æ—¶å¬è¯´è¾…å¯¼ä¹¦äºŒåˆ·ç»™æˆ‘æ•´è’™äº†ï¼Œåæ¥å¬è¯´ç­¾ä¸‰æ–¹åˆè’™äº†ï¼ŒçœŸå¯è°“æ˜¯ï¼šæ‡µé€¼æ ‘ä¸Šæ‡µé€¼æœï¼Œæ‡µé€¼æœè½ç ¸æ­»æˆ‘ï¼‰ï¼Œè€ƒ150çš„å¤§ç¥æœ‰å¯èƒ½åœ¨å¹ç‰›ï¼Œå¯èƒ½æœ€åè€ƒè¯•åªè€ƒäº†100ä¸åˆ°ï¼Œå¯èƒ½è¿˜æœ‰çš„çœŸå¤§ç¥ï¼Œå¹³æ—¶å¾ˆå‰å®³ï¼Œä¸€é—®å•¥éƒ½ä¼šï¼Œä½†æ˜¯ä¸€åˆ°è€ƒè¯•å¯èƒ½åˆä¸è¡Œäº†ã€‚è¯´è¿™äº›æ˜¯æƒ³å‘Šè¯‰å¤§å®¶ï¼ŒæŒ‰ç…§è‡ªå·±çš„è®¡åˆ’ï¼Œå®Œæˆè‡ªå·±çš„é¢„å®šç›®æ ‡å°±å¯ä»¥äº†ã€‚ä¹é˜³çœŸç»ä¸­æœ‰ä¸€å¥è¯é€ç»™å¤§å®¶ï¼šä»–å¼ºä»»ä»–å¼ºï¼Œæ¸…é£æ‹‚å±±å²—ï¼Œä»–æ¨ªä»»ä»–æ¨ªï¼Œæ˜æœˆç…§å¤§æ±Ÿã€‚\nä¸è‡ªæˆ‘è†¨èƒ€ æœ‰çš„æ—¶å€™ï¼Œå¯èƒ½æ˜¯ç»™æŸä¸ªåŒå­¦è§£ç­”äº†é—®é¢˜ã€å¯èƒ½æ˜¯ä»Šå¤©çš„è‹±è¯­é˜…è¯»å…¨å¯¹äº†ã€å¯èƒ½æ˜¯ä»Šå¤©çš„æ•°å­¦è€ƒäº†140ï¼Œæ€»ä¹‹å°±æ˜¯è†¨èƒ€äº†ã€‚è¿™æ—¶å€™ä¸€å®šè¦å‘Šè¯‰è‡ªå·±ï¼Œå¤©å¤–æœ‰å¤©ï¼Œäººå¤–æœ‰äººï¼Œä¸èƒ½è†¨èƒ€ï¼Œä¸€å®šæ˜¯åŒå­¦å¤ªèœã€è‹±è¯­èµ°äº†ç‹—å±è¿ã€æ•°å­¦å¤ªç®€å•ï¼Œæƒ³åŠæ³•æ‰“å‡»ä¸€ä¸‹è‡ªå·±ã€‚ä¸èƒ½è†¨èƒ€ï¼Œä½†ä¹Ÿè¦ä¿æŒè‡ªä¿¡ï¼Œæˆ‘å°±æ˜¯å›¾ä¹¦é¦†æœ€é“çš„ä»”ã€‚\n Q\u0026amp;A Q:ä¸“ä¸šè¯¾å¦‚ä½•å¤ä¹ ï¼Ÿï¼ˆ408ï¼‰\nAï¼šä¸“ä¸šè¯¾ä¸€èˆ¬ä»9æœˆå¼€å§‹å¤ä¹ ï¼Œå‰é¢å¯ä»¥ç¨å¾®çœ‹çœ‹ï¼Œä½†ä¸è¦ä½œä¸ºé‡ç‚¹ã€‚ä¸“ä¸šè¯¾çš„ç‰¹ç‚¹æ˜¯çŸ¥è¯†ç‚¹å¤šï¼Œéœ€è¦åœ¨ç†è§£çš„åŸºç¡€ä¸Šè¿›è¡Œè®°å¿†ã€‚å› æ­¤æˆ‘ä»¬ä¸€å®šè¦æ‰“ç‰¢åŸºç¡€ï¼Œé¦–å…ˆå°†ä¹¦æœ¬çŸ¥è¯†è¿‡ä¸€éï¼Œåœ¨ä¹¦æœ¬çŸ¥è¯†å…¨éƒ¨ç†è§£çš„åŸºç¡€ä¸Šï¼Œå†åšè¾…å¯¼ä¹¦ä¸Šçš„ä¹ é¢˜ã€‚è¾…å¯¼ä¹¦éœ€è¦çœ‹å¾ˆå¤šéï¼Œæ‰€ä»¥æˆ‘ä»¬åšçš„æ—¶å€™å¯ä»¥åœ¨å…¶ä»–åœ°æ–¹æ¯”å¦‚è‰ç¨¿çº¸ä¸Šå†™ä¸‹ç­”æ¡ˆï¼Œå¹¶å°†é”™é¢˜è®°å½•ä¸‹æ¥ã€‚ä¸“ä¸šè¯¾è¦æƒ³è€ƒçš„å¥½ï¼Œä¸€å®šè¦å¤šçœ‹å‡ è½®ï¼Œå¤ä¹ çš„å…¨é¢ä¸€ç‚¹ï¼Œ408è€ƒ4é—¨è¯¾ï¼Œæ¯ä¸€é—¨è¯¾éƒ½æœ‰å¾ˆå¤šçŸ¥è¯†ç‚¹ï¼Œæä¸å®šå°±è€ƒåˆ°å“ªä¸ªçŸ¥è¯†ç‚¹ï¼Œæˆ‘ä»¬åªèƒ½å°½é‡å¤ä¹ çš„å…¨é¢ã€‚åæœŸä¹Ÿè¦åˆ·çœŸé¢˜ï¼Œæœ€å¥½å¤šåˆ·å‡ éã€‚\n Qï¼šæ€æ ·æ‰èƒ½çœ‹åˆ°ä¸€ä¸ªå­¦æ ¡çš„æŠ¥å½•æ¯”ä¹‹ç±»çš„ï¼Ÿ\nAï¼šæ¯ä¸ªå­¦æ ¡å¯èƒ½ä¸å¤§ä¸€æ ·ï¼Œä½ å¯ä»¥å»è¯¥æ ¡çš„ç ”ç©¶ç”Ÿæ‹›ç”Ÿç½‘çœ‹ä¸€çœ‹ï¼Œæˆ–è€…å»ä»–ä»¬çš„è€ƒç ”ç¾¤æ‰¾ä¸€äº›å­¦é•¿é—®é—®ã€‚\n Qï¼šè‹±è¯­æ•°å­¦ä¹‹ç±»çœ‹çš„è§†é¢‘ä»å“ªæ‰¾?\nAï¼šå¯ä»¥ä»ç™¾åº¦äº‘ã€Bç«™ã€å…¬ä¼—å·ç­‰å¤„ï¼Œç”šè‡³ä½ è¿˜å¯ä»¥å»Pornhubçœ‹è€ƒç ”è§†é¢‘ã€‚ã€‚ã€‚ã€‚\n Q: ä¸€å®šè¦æŠ¥è¡¥ä¹ ç­æˆ–è€…è·Ÿç€æŸä¸ªè€å¸ˆçš„æ•™å­¦è§†é¢‘å­¦å—ï¼Ÿ\nAï¼šä¸ä¸€å®šï¼Œå› äººè€Œå¼‚ï¼Œæœ‰çš„äººå–œæ¬¢çœ‹è§†é¢‘ï¼Œè§‰å¾—è‡ªå·±çœ‹ä¹¦å¤ªæ…¢ï¼Œæœ‰çš„äººçœ‹è§†é¢‘çŠ¯å›°ï¼Œåªå–œæ¬¢è‡ªå·±æ…¢æ…¢å•ƒï¼ˆæ¯”å¦‚æˆ‘ï¼‰ã€‚è¡¥ä¹ ç­è¿™ä¸ªå˜›ï¼Œå’±ä¹Ÿæ²¡ä¸Šè¿‡ï¼Œå’±ä¹Ÿä¸çŸ¥é“ã€‚\n Any problems?\n","permalink":"http://yangchnet.github.io/Dessert/posts/%E6%9D%82%E8%AE%B0/%E8%80%83%E7%A0%94/","summary":"ä¸€åˆ‡è¡ŒåŠ¨æœ‰è§„åˆ’ ä½œä¸ºè®¡ç®—æœºä¸“ä¸šçš„å­¦ç”Ÿï¼Œæˆ‘ä»¬è¦è€ƒçš„ç§‘ç›®å¾ˆå¤šï¼Œéå†ä¸‹æ¥æœ‰æ”¿æ²»ã€è‹±è¯­ã€é«˜ç­‰æ•°å­¦ã€çº¿æ€§ä»£æ•°ã€æ¦‚ç‡è®ºä¸æ•°ç†ç»Ÿè®¡ã€408è®¡ç®—æœºä¸“ä¸šç»¼åˆï¼ˆæ•°æ®ç»“æ„ã€è®¡ç®—æœºç»„æˆåŸç†ã€æ“ä½œç³»ç»Ÿã€è®¡ç®—æœºç½‘ç»œï¼‰ï¼Œå¦‚æœæ²¡æœ‰ä¸€ä¸ªè¯¦ç»†çš„è§„åˆ’ï¼Œä¸çŸ¥é“å¦‚ä½•å®‰æ’æ—¶é—´ï¼Œå°±ä¼šæ„Ÿè§‰ä¸€å›¢ä¹±éº»ï¼Œæ€»æ˜¯æ„Ÿè§‰åšæ­¤è–„å½¼æˆ–æ˜¯æ¯«æ— å¤´ç»ªã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªåˆç†çš„æ—¶é—´å®‰æ’ã€‚é¦–å…ˆæ˜¯ä¸€ä¸ªæ€»çš„æ—¶é—´å®‰æ’ï¼Œå³å¤ä¹ çš„è¿›åº¦å®‰æ’ï¼Œæ¯”å¦‚ï¼Œè¦åœ¨9æœˆä¹‹å‰å®Œæˆä¸€è½®å¤ä¹ ã€11æœˆä¹‹å‰å®ŒæˆäºŒè½®å¤ä¹ ç­‰ã€‚æ¥ä¸‹æ¥ï¼Œè¦æ ¹æ®è¿›åº¦å®‰æ’ï¼Œé€‚å½“å®‰æ’è‡ªå·±çš„æ¯ä¸€å¤©ï¼Œè¿™é‡Œæ‰€è¯´çš„é€‚å½“æ˜¯æŒ‡ï¼šæŒ‰ç…§ä½ çš„èƒ½åŠ›å’Œå¤ä¹ è¿›åº¦ç»™è‡ªå·±ä¸€ä¸ªåœ¨èƒ½åŠ›èŒƒå›´ä¹‹å†…çš„ç›®æ ‡å€¼ï¼Œå¹¶åŠªåŠ›å»å®Œæˆå®ƒï¼Œä½†åŒæ—¶æˆ‘ä»¬è¦ç»™è‡ªå·±è®¾å®šä¸€ä¸ªæœ€ä½ç›®æ ‡ä»¥é­ç­–è‡ªå·±ã€‚æ”¿æ²»ä¸­è¯´ï¼Œæˆ‘ä»¬è¦åšæŒåº•çº¿æ€ç»´ï¼Œç«‹è¶³æœ€ä½ç‚¹ï¼Œäº‰å–æœ€å¤§å€¼ï¼Œå°±æ˜¯è¿™ä¸ªé“ç†ã€‚\nä¸æµªè´¹ä¸€åˆ†ä¸€ç§’ å¾ˆæ˜æ˜¾ï¼Œè€ƒç ”æ—¶é—´éå¸¸ä¹‹ç´§å¼ ï¼Œæˆ‘ä»¬ä¸€èˆ¬æ˜¯ä»3æœˆå·¦å³å¼€å§‹å¤ä¹ ï¼Œè€Œæ­¤æ—¶çš„å¤ä¹ æ˜¾ç„¶ä¸èƒ½å¾ˆå¿«è¿›å…¥çŠ¶æ€ã€‚å› æ­¤ï¼Œå¾ˆå¤šäººçš„å¤ä¹ å®é™…ä¸Šæ˜¯ä»æš‘å‡æ‰çœŸæ­£å¼€å§‹ï¼Œå‰é¢åªèƒ½ç®—æ˜¯é¢„çƒ­ã€‚ä»æš‘å‡å¼€å§‹ï¼Œæˆ‘ä»¬å°±è¦è¿›å…¥ä¸€ä¸ªç´§å¼ çš„çŠ¶æ€ï¼Œæ¯å¤©åŸºæœ¬åªæœ‰ä¸‰ä»¶äº‹ï¼šçœ‹ä¹¦ã€åƒé¥­ã€ç¡è§‰ã€‚æˆ‘å‘Šè¯‰å¤§å®¶ä¸è¦æµªè´¹ä¸€åˆ†ä¸€ç§’ï¼Œä¸æ˜¯è®©å¤§å®¶åºŸå¯å¿˜é£Ÿï¼Œä¸é¡¾èº«ä½“ï¼Œæ¯å¤©åšä¸€ä¸ªè«å¾—æ„Ÿæƒ…çš„åˆ·é¢˜æœºå™¨ï¼Œè€Œæ˜¯è®©å¤§å®¶çæƒœå­¦ä¹ æ—¶é—´ä¸­çš„æ¯ä¸€åˆ†ï¼Œæ¯ä¸€ç§’ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ å¯ä»¥æœ‰é€‚å½“çš„ä¼‘æ¯æ—¶é—´ï¼Œæš‘å‡ä¹Ÿå¯ä»¥é€‚å½“å›å®¶ç©ç©ï¼Œä½†æ˜¯å½“ä½ ååˆ°ä¹¦æ¡Œæ—ï¼Œå°±å¿…é¡»å¿ƒæ— æ—éª›ï¼Œä¸“å¿ƒå­¦ä¹ ã€‚\nä¸€åˆ‡ç›®æ ‡ä¸ºè€ƒç ” è€ƒç ”çš„æ—¶å€™ï¼Œä½ å¯èƒ½è§‰å¾—æœ‰å¾ˆå¤šäº‹æƒ³åšï¼Œä½†æ˜¯ä½ è¦è€ƒè™‘åˆ°ï¼Œåšè¿™ä»¶äº‹å¯¹ä½ çš„è€ƒç ”åˆè¯•æˆç»©æé«˜æœ‰æ²¡æœ‰æ„ä¹‰ã€‚è¿™é‡Œä¹‹æ‰€ä»¥å¼ºè°ƒåˆè¯•ï¼Œæ˜¯å› ä¸ºå¾ˆå¤šäººè§‰å¾—ï¼Œè¿™ä»¶äº‹å¯¹å¤è¯•å¾ˆå¥½ï¼Œæˆ‘å¯ä»¥æå‰åšã€‚å…¶å®ä¸ç„¶ï¼Œè¯´å¥ä¸å¥½å¬çš„ï¼Œè¿˜ä¸ä¸€å®šèƒ½è¿›å¤è¯•å‘¢ã€‚ç‰¢è®°è‡ªå·±çš„ç›®æ ‡ï¼Œå°†è€ƒç ”ä¼˜å…ˆçº§æåˆ°æœ€é«˜ï¼Œåœ¨è€ƒç ”æœŸé—´ï¼Œåªæœ‰é‚£äº›èƒ½æé«˜ä½ æˆç»©çš„äº‹åšçš„æ‰æœ‰æ„ä¹‰ï¼Œå…¶ä»–çš„äº‹ï¼Œå…ˆæ”¾ä¸€æ”¾ç½¢ã€‚å»¶è¿Ÿäº«å—ã€‚\n é€‚å½“ä¼‘æ¯ å¤§å®¶éƒ½è¯´è€ƒç ”æ˜¯ä¸€åœºæŒä¹…æˆ˜ï¼Œäº‹å®å¦‚æ­¤ã€‚æ¯å¤©ä»æ—©ä¸Šåˆ°æ™šä¸Šååœ¨ä¹¦æ¡Œæ—ï¼Œåˆšå¼€å§‹å¯èƒ½ä¸è§‰å¾—æœ‰ä»€ä¹ˆï¼Œç„¶åä½ ä¼šå¼€å§‹å±è‚¡ç–¼ï¼Œè¿™æ—¶å€™ä¸€ä¸ªåå«å°±å¯ä»¥è§£å†³é—®é¢˜ï¼Œå†ç„¶åä½ ä¼šæ„Ÿåˆ°éª¨å¤´ä»¿ä½›ç”Ÿé”ˆï¼Œè„–å­ä¸èˆ’æœï¼Œè¿™æ—¶å€™ä½ éœ€è¦ä¸€æœ¬é¢ˆå¤åº·æŒ‡å—ï¼Œæœ€åä½ ä¼šå‘ç°è§†åŠ›ä¸‹é™ã€å‘é‡å‡å°‘ï¼Œè¿™æ—¶å€™ä½ éœ€è¦ä¸€ç“¶éœ¸ç‹ã€‚æ¯å‘¨æˆ‘ä»¬åº”è¯¥ä¸ºè‡ªå·±å®‰æ’ä¸€ä¸ªä¼‘æ¯æ—¶é—´ï¼Œæ¯”å¦‚å‘¨æ—¥æˆ–å‘¨å…­ï¼Œè€Œä¸”æˆ‘å»ºè®®ï¼Œè¿™ä¸ªä¼‘æ¯æ—¶é—´åº”æ”¾åœ¨ä¸Šåˆï¼Œè€Œä¸æ˜¯ä¸‹åˆæˆ–æ™šä¸Šã€‚æ”¾åœ¨ä¸‹åˆçš„è¯ï¼Œæˆ‘ä»¬å¯èƒ½ä¼‘æ¯çš„æœ‰ç‚¹æ‡’æ•£ï¼Œå¹²è„†æ™šä¸Šä¹Ÿä¸å»äº†ï¼Œè¿™æ ·å°±æŠŠæ™šä¸Šä¹Ÿæµªè´¹æ‰äº†ï¼Œæ™šä¸Šçš„è¯ï¼Œå¤§å®¶å¯èƒ½åˆç©çš„å¤ªå—¨ï¼Œå¯¼è‡´ç¬¬äºŒå¤©èµ·ä¸æ¥ï¼Œè€Œæ”¾åœ¨ä¸Šåˆï¼Œä¸€æ˜¯å¯ä»¥ç¡ä¸ªæ‡’è§‰ï¼ŒäºŒæ˜¯å½“ä½ å­¦ä¹ äº†ä¸€ä¸ªä¸‹åˆåŠ ä¸€ä¸ªæ™šä¸Šåï¼Œæ™šä¸Šå›åˆ°å¯å®¤ï¼Œä¾ç„¶è¿˜è·Ÿä»¥å‰çš„çŠ¶æ€ä¸€æ ·ï¼Œæ„Ÿè§‰ä¸Šå°±åƒå­¦äº†ä¸€æ•´å¤©ï¼Œå¯ä»¥å……åˆ†ä¿æŒè‡ªå·±çš„çŠ¶æ€ã€‚åšæŒé”»ç‚¼ï¼Œèº«ä½“æ˜¯é©å‘½çš„æœ¬é’±ï¼Œæ²¡æœ‰è‰¯å¥½çš„èº«ä½“ç´ è´¨åšæ”¯æ’‘ï¼Œå¦‚ä½•èƒ½æ‰¿å—æ¯å¤©14ä¸ªå°æ—¶ï¼Œå…¨å¹´æ— ä¼‘çš„å­¦ä¹ .\nåšé¢˜è¦åšå® æ¯åšä¸€é¢˜ï¼Œåº”è¯¥åšä¸€ä¸ªæ·±å…¥çš„æ€è€ƒï¼Œå¹¶æ‹¿ç¬”è®°å½•ä¸‹æ¥ï¼Œè¿™å¹¶ä¸æ˜¯åœ¨æµªè´¹ä½ çš„åˆ·é¢˜æ—¶é—´ï¼Œè€Œæ˜¯åœ¨èŠ‚çœä½ å°†æ¥çš„å¤ä¹ æ—¶é—´ã€‚æ¯”å¦‚ï¼Œæˆ‘åšå®Œä¸€é¢˜ï¼Œæˆ‘ä¼šç»™ä»–è¯„ä¸€ä¸ªåˆ†æ•°ï¼ŒåæœŸè¿˜ä¼šæŒ‡å‡ºå…¶æ‰€è€ƒçš„çŸ¥è¯†ç‚¹ã€‚ä¹‹æ‰€ä»¥åæœŸæ‰æŒ‡å‡ºçŸ¥è¯†ç‚¹ï¼Œæ˜¯å› ä¸ºå‰æœŸæˆ‘å¯¹çŸ¥è¯†ç‚¹çš„æŒæ¡è¿˜ä¸å…¨é¢ä¸åˆ°ä½ã€‚æˆ‘å¯¹é¢˜ç›®çš„è¯„åˆ†è§„åˆ™å¦‚ä¸‹ï¼šï¼ˆå¤§å®¶éƒ½çŸ¥é“ï¼Œåœ¨Linuxç³»ç»Ÿä¸­æœ‰æƒé™ç®¡ç†ï¼Œæ¯”å¦‚ä¸€ä¸ªæ–‡ä»¶ï¼Œå®ƒå¯¹äºæ–‡ä»¶æ‰€æœ‰è€…çš„æƒé™å¯èƒ½æ˜¯rwx,ä»£è¡¨å¯è¯»å¯å†™å¯æ‰§è¡Œï¼Œå…¶ä¸­rä¸ºè¯»ï¼Œç”¨æ•°å­—1è¡¨ç¤ºï¼Œwä¸ºå†™ï¼Œç”¨æ•°å­—3è¡¨ç¤ºï¼Œxä¸ºæ‰§è¡Œï¼Œç”¨æ•°å­—5è¡¨ç¤ºï¼Œé‚£ä¹ˆæ­¤æ–‡ä»¶å¯¹äºå¦ä¸€ä¸ªç”¨æˆ·çš„æƒé™ä¸º5ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“å°±å¯æ¨ç®—å‡ºè¿™ä¸ªç”¨æˆ·å¯¹è¿™ä¸ªæ–‡ä»¶åªå…·æœ‰è¯»å’Œæ‰§è¡Œæƒé™ï¼Œä¸å…·æœ‰å†™æƒé™ã€‚ï¼‰[â€œç¬¬ä¸€æ¬¡ä¸ä¼šåšâ€ï¼Œâ€œå¥½é¢˜â€ï¼Œâ€œéš¾é¢˜â€ï¼Œâ€œç»¼åˆé¢˜â€], å…¶ä¸­â€œç¬¬ä¸€æ¬¡ä¸ä¼šåšâ€å¯¹åº”1ï¼Œâ€œå¥½é¢˜â€å¯¹åº”2ï¼Œâ€œéš¾é¢˜â€å¯¹åº”4ï¼Œâ€œç»¼åˆé¢˜â€å¯¹åº”8ï¼Œè¿™æ ·çš„è¯ï¼Œå¦‚æœæˆ‘å¯¹ä¸€ä¸ªé¢˜ç›®çš„è¯„åˆ†ä¸º6ï¼ˆå¯ä»¥å†™ä½œ$=6æˆ–ä»»ä½•å…¶ä»–æ ‡å¿—ï¼‰ï¼Œé‚£ä¹ˆå°±å¯ä»¥å¾ˆå®¹æ˜“å¾—çŸ¥ï¼Œè¿™ä¸ªé¢˜æ¯”è¾ƒå¥½ï¼Œå¹¶ä¸”æ¯”è¾ƒéš¾ï¼Œä½†æ˜¯æˆ‘ç¬¬ä¸€æ¬¡å¯ä»¥åšå‡ºæ¥ã€‚å½“ç„¶ï¼Œè¿™å››ä¸ªè¯„ä»·å®Œå…¨å¯ä»¥æ¢æˆä»»ä½•å…¶ä»–è¯„ä»·ï¼Œåªè¦ä½ è§‰å¾—æœ‰ç”¨å°±å¥½ã€‚çŸ¥è¯†ç‚¹æˆ‘ä¼šç”¨[]æ¥æ ‡æ³¨ï¼Œæ¯”å¦‚æŸä¸ªé¢˜è€ƒäº†äºŒç»´æ¦‚ç‡å¯†åº¦ï¼Œé‚£ä¹ˆå°±ç”¨çº¢ç¬”æ ‡æ³¨[äºŒç»´æ¦‚ç‡å¯†åº¦]ã€‚ä½ å¯ä»¥ç”¨ä½ ç‹¬ç‰¹çš„æ–¹æ³•æ¥æ ‡æ³¨ä½ åšè¿‡çš„é¢˜ç›®ï¼Œæ¥è®©è‡ªå·±ä»¥åçš„å¤ä¹ æ›´åŠ å…·æœ‰é’ˆå¯¹æ€§ã€‚ä½†æ˜¯ä¸è¦å¿˜è®°ï¼Œè¿™äº›ä¸œè¥¿åªæ˜¯å¸®ä½ è®°å½•ä¸€äº›ä¸œè¥¿ï¼Œä½ éœ€è¦è‡ªå·±åŠ¨è„‘æƒ³ä¸€æƒ³ï¼Œå°†è¿™ä¸ªé¢˜çš„å‡ºé¢˜ç›®çš„ï¼Œç­”é¢˜æŠ€å·§ï¼Œç›¸ä¼¼è€ƒé¢˜ç­‰éƒ½è¿‡ä¸€éã€‚æœ€é‡è¦çš„è¿˜æ˜¯è‡ªå·±çš„æ€è€ƒè¿‡ç¨‹ï¼Œä¸è¦è¢«è¿™äº›èŠ±é‡Œèƒ¡å“¨çš„ä¸œè¥¿è¿·èŠ±äº†çœ¼ã€‚\nçŸ¥è¯†è¦æ€»ç»“ å­¦è¿‡çš„çŸ¥è¯†ï¼Œè¦è¶çƒ­æ‰“é“ï¼Œå¯¹å…¶è¿›è¡Œæœ‰é’ˆå¯¹æ€§çš„æ€»ç»“ï¼Œå°†çŸ¥è¯†ç‚¹ï¼Œè‡ªå·±çš„ç†è§£ç­‰éƒ½è®°ä¸‹æ¥ã€‚ä¸è¿‡ä¸å¯èƒ½ä¼šè¯´ï¼Œé‚£äº›çŸ¥è¯†ç‚¹è¾…å¯¼ä¹¦ä¸Šéƒ½å·²ç»æœ‰äº†ï¼Œæˆ‘ä¸ºä»€ä¹ˆè¦å†å†™ä¸€éï¼Œè¿™ä¸æ˜¯æµªè´¹æˆ‘æ—¶é—´å˜›ã€‚æˆ‘æƒ³å‘Šè¯‰ä½ çš„æ˜¯ï¼Œä¹¦ä¸Šçš„æ˜¯é¢å‘æ‰€æœ‰è€ƒç”Ÿçš„ï¼Œè€Œä½ å†™ä¸‹æ¥ï¼Œåªæ˜¯é¢å¯¹ä½ è‡ªå·±ã€‚ç°åœ¨çš„ä¸œè¥¿éƒ½è®²ç©¶ä¸ªæ€§åŒ–ï¼Œæˆ‘ä»¬ä¹Ÿè¦ç»™è‡ªå·±ä¸€ä¸ªä¸ªæ€§åŒ–å®šåˆ¶çš„çŸ¥è¯†ç³»ç»Ÿã€‚æ€»ç»“ä¸åªæ˜¯ç®€å•çš„æŠŠçŸ¥è¯†ç‚¹æŠ„ä¸‹æ¥ï¼Œå…¶ä¸­è¿˜åŒ…å«è¿™ä½ å¯¹çŸ¥è¯†ç‚¹çš„ç†è§£ï¼Œç”šè‡³ä½ è¿˜å¯ä»¥åŠ ä¸Šè¿™ä¸ªçŸ¥è¯†ç‚¹çš„ç»å…¸ä¾‹é¢˜ã€‚ä¸è¿‡ï¼Œæˆ‘è§è¿‡å¾ˆå¤šäººï¼ŒçŸ¥è¯†ç‚¹æ€»ç»“çš„å¾ˆå¥½ï¼Œå¯æƒœåˆ°æœ€åéƒ½æ²¡çœ‹ï¼Œè¯¸å›è¦é¿å…è¿™ä¸ªé—®é¢˜ï¼Œä¸ç„¶ä¸å¦‚çœä¸‹æ—¶é—´èƒŒå‡ ä¸ªè‹±è¯­å•è¯ã€‚\nåšé”™é¢˜è¦è®¢æ­£å¹¶ç‰¢è®° è€ƒç ”å¤ä¹ ï¼Œå‰æœŸåšåŠ æ³•ï¼Œå³ä¸æ–­å¢åŠ è‡ªå·±çš„çŸ¥è¯†ï¼ŒåæœŸåšå‡æ³•ï¼Œå³å‡å°‘è‡ªå·±ä¸ä¼šçš„ï¼ŒæŸ¥æ¼è¡¥ç¼ºã€‚é‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆçŸ¥é“å“ªé‡Œæœ‰æ¼æ´ï¼Œå“ªé‡Œéœ€è¦è¡¥å‘¢ï¼Ÿæ˜¾ç„¶ï¼Œé”™é¢˜å¯ä»¥å¸®æˆ‘ä»¬å¿«é€Ÿå®šä½ï¼Œå°±å¥½åƒä¸€ä¸ªé”™è¯¯çš„è¾“å‡ºå¯ä»¥å¸®æˆ‘ä»¬å®šä½ä¸€ä¸ªbugã€‚é¢˜ç›®åšé”™ï¼Œä¸ä¸€å®šæ˜¯å› ä¸ºæ­¤å¤„æœªæŒæ¡å¥½ï¼Œè¿˜æœ‰å¯èƒ½æ˜¯é¢˜ç›®å¤ªéš¾ã€ç²—å¿ƒåšé”™ï¼Œä½†æ— è®ºæ˜¯å“ªç§é—®é¢˜ï¼Œé”™é¢˜éƒ½æ˜¯æˆ‘ä»¬å¿«é€Ÿæ‰¾åˆ°æ¼æ´çš„æœ€å¥½åŠæ³•ã€‚å¯¹å¾…é”™é¢˜ï¼Œæˆ‘ä»¬æœ€å¥½æœ‰ä¸€ä¸ªä¸“é—¨çš„é”™é¢˜æœ¬ï¼ˆæ‰¾ä¸€ä¸ªå¥½ç‚¹çš„æœ¬å­ï¼Œè¿™æ ·ä½ ä¸¢ä¹Ÿä¸èˆå¾—ä¸¢ï¼Œå†™èµ·æ¥ä¹Ÿèˆ’æœï¼‰ï¼Œå°†è‡ªå·±çš„é”™é¢˜æ‘˜æŠ„åˆ°ä¸Šé¢å¹¶å†™ä¸‹é”™è¯¯åŸå› ä¸æ­£ç¡®ç­”æ¡ˆã€‚åæœŸé”™é¢˜æœ¬å°†æ´¾ä¸Šå¤§ç”¨åœºã€‚\nä¸ç•éš¾ ä¸ç•éš¾ï¼ŒæŒ‡ä¸æ€•éš¾é¢˜ï¼Œä¸æ€•éš¾å­¦çš„çŸ¥è¯†ç‚¹ï¼Œä»»ä½•çŸ¥è¯†ç‚¹åªè¦å‡ºç°ï¼Œå°±è¯´æ˜å®ƒå®Œå…¨åœ¨æˆ‘ä»¬å¯ç†è§£çš„èŒƒå›´ä¹‹å†…ã€‚ä¸è¦è®©ä¸€ä¸ªåŸºæœ¬çš„çŸ¥è¯†ç‚¹æˆä¸ºä½ çš„ç»Šè„šçŸ³ï¼Œé‚£å°±å¤ªè ¢äº†ã€‚ä¸ä¼šçš„å¯ä»¥å‘åˆ«äººè™šå¿ƒè¯·æ•™ï¼Œå¯ä»¥å’ŒåŒå­¦æˆ–æœ‹å‹çº¦å¥½ï¼Œæ¯å‘¨æ‰¾ä¸ªæ—¶é—´ä¸“é—¨è®¨è®ºè¿™ä¸ªæ˜ŸæœŸé‡åˆ°çš„ç¡¬éª¨å¤´ã€‚\nä¸æµ®èº è€ƒç ”æ˜¯ååˆ†æ¯ç‡¥ä¹å‘³çš„ï¼Œç»ˆæ—¥åŸ‹å¤´è‹¦å­¦ï¼Œæ²¡äººè¯´è¯ï¼Œä¹Ÿæ²¡äººç®¡ä½ ï¼Œä½ éœ€è¦è°ƒèŠ‚è‡ªå·±çš„å¿ƒç†ï¼Œä¸è¦å¿ƒæµ®æ°”èºã€‚è€ƒç ”çš„æ—¶å€™å¤§å®¶ä¸€èˆ¬éƒ½ä¸å¸¦æ‰‹æœºï¼Œæœ‰çš„äººä¼šå¸¦ä¸ªè€³æœºï¼Œå¸¦ä¸ªMP3å¬ä¸ªéŸ³ä¹ã€‚è¿œç¦»æ‰‹æœºï¼Œä»ä½ åšèµ·ã€‚\nä¸å¦„è‡ªè²è–„ ä¸ç®¡æ˜¯è€ƒç ”å‰æœŸã€ä¸­æœŸè¿˜æ˜¯åæœŸï¼Œæ€»ä¼šå¬åˆ°ä¸€äº›â€œå¤§ç¥â€çš„æˆ˜ç»©ã€‚æ¯”å¦‚è€ƒç ”åˆï¼Œå¬è¯´å“ªä¸ªå“ªä¸ªè¾…å¯¼ä¹¦éƒ½äºŒåˆ·äº†ï¼Œè€ƒç ”åæœŸï¼Œå¬è¯´å“ªä¸ªå“ªä¸ªæ•°å­¦çœŸé¢˜åšäº†å¥½å‡ ä¸ª150ã€‚æˆ‘æƒ³è¯´ï¼Œè¿™äº›å’Œä½ æ²¡å…³ç³»ï¼Œè¾…å¯¼ä¹¦äºŒåˆ·çš„æœªå¿…åšæŒåˆ°è€ƒè¯•ï¼Œå¯èƒ½ä¸­é—´å°±ä¸šç­¾ä¸‰æ–¹èµ°äººäº†ï¼ˆçœŸå®ç»å†ï¼Œå½“æ—¶å¬è¯´è¾…å¯¼ä¹¦äºŒåˆ·ç»™æˆ‘æ•´è’™äº†ï¼Œåæ¥å¬è¯´ç­¾ä¸‰æ–¹åˆè’™äº†ï¼ŒçœŸå¯è°“æ˜¯ï¼šæ‡µé€¼æ ‘ä¸Šæ‡µé€¼æœï¼Œæ‡µé€¼æœè½ç ¸æ­»æˆ‘ï¼‰ï¼Œè€ƒ150çš„å¤§ç¥æœ‰å¯èƒ½åœ¨å¹ç‰›ï¼Œå¯èƒ½æœ€åè€ƒè¯•åªè€ƒäº†100ä¸åˆ°ï¼Œå¯èƒ½è¿˜æœ‰çš„çœŸå¤§ç¥ï¼Œå¹³æ—¶å¾ˆå‰å®³ï¼Œä¸€é—®å•¥éƒ½ä¼šï¼Œä½†æ˜¯ä¸€åˆ°è€ƒè¯•å¯èƒ½åˆä¸è¡Œäº†ã€‚è¯´è¿™äº›æ˜¯æƒ³å‘Šè¯‰å¤§å®¶ï¼ŒæŒ‰ç…§è‡ªå·±çš„è®¡åˆ’ï¼Œå®Œæˆè‡ªå·±çš„é¢„å®šç›®æ ‡å°±å¯ä»¥äº†ã€‚ä¹é˜³çœŸç»ä¸­æœ‰ä¸€å¥è¯é€ç»™å¤§å®¶ï¼šä»–å¼ºä»»ä»–å¼ºï¼Œæ¸…é£æ‹‚å±±å²—ï¼Œä»–æ¨ªä»»ä»–æ¨ªï¼Œæ˜æœˆç…§å¤§æ±Ÿã€‚\nä¸è‡ªæˆ‘è†¨èƒ€ æœ‰çš„æ—¶å€™ï¼Œå¯èƒ½æ˜¯ç»™æŸä¸ªåŒå­¦è§£ç­”äº†é—®é¢˜ã€å¯èƒ½æ˜¯ä»Šå¤©çš„è‹±è¯­é˜…è¯»å…¨å¯¹äº†ã€å¯èƒ½æ˜¯ä»Šå¤©çš„æ•°å­¦è€ƒäº†140ï¼Œæ€»ä¹‹å°±æ˜¯è†¨èƒ€äº†ã€‚è¿™æ—¶å€™ä¸€å®šè¦å‘Šè¯‰è‡ªå·±ï¼Œå¤©å¤–æœ‰å¤©ï¼Œäººå¤–æœ‰äººï¼Œä¸èƒ½è†¨èƒ€ï¼Œä¸€å®šæ˜¯åŒå­¦å¤ªèœã€è‹±è¯­èµ°äº†ç‹—å±è¿ã€æ•°å­¦å¤ªç®€å•ï¼Œæƒ³åŠæ³•æ‰“å‡»ä¸€ä¸‹è‡ªå·±ã€‚ä¸èƒ½è†¨èƒ€ï¼Œä½†ä¹Ÿè¦ä¿æŒè‡ªä¿¡ï¼Œæˆ‘å°±æ˜¯å›¾ä¹¦é¦†æœ€é“çš„ä»”ã€‚\n Q\u0026amp;A Q:ä¸“ä¸šè¯¾å¦‚ä½•å¤ä¹ ï¼Ÿï¼ˆ408ï¼‰\nAï¼šä¸“ä¸šè¯¾ä¸€èˆ¬ä»9æœˆå¼€å§‹å¤ä¹ ï¼Œå‰é¢å¯ä»¥ç¨å¾®çœ‹çœ‹ï¼Œä½†ä¸è¦ä½œä¸ºé‡ç‚¹ã€‚ä¸“ä¸šè¯¾çš„ç‰¹ç‚¹æ˜¯çŸ¥è¯†ç‚¹å¤šï¼Œéœ€è¦åœ¨ç†è§£çš„åŸºç¡€ä¸Šè¿›è¡Œè®°å¿†ã€‚å› æ­¤æˆ‘ä»¬ä¸€å®šè¦æ‰“ç‰¢åŸºç¡€ï¼Œé¦–å…ˆå°†ä¹¦æœ¬çŸ¥è¯†è¿‡ä¸€éï¼Œåœ¨ä¹¦æœ¬çŸ¥è¯†å…¨éƒ¨ç†è§£çš„åŸºç¡€ä¸Šï¼Œå†åšè¾…å¯¼ä¹¦ä¸Šçš„ä¹ é¢˜ã€‚è¾…å¯¼ä¹¦éœ€è¦çœ‹å¾ˆå¤šéï¼Œæ‰€ä»¥æˆ‘ä»¬åšçš„æ—¶å€™å¯ä»¥åœ¨å…¶ä»–åœ°æ–¹æ¯”å¦‚è‰ç¨¿çº¸ä¸Šå†™ä¸‹ç­”æ¡ˆï¼Œå¹¶å°†é”™é¢˜è®°å½•ä¸‹æ¥ã€‚ä¸“ä¸šè¯¾è¦æƒ³è€ƒçš„å¥½ï¼Œä¸€å®šè¦å¤šçœ‹å‡ è½®ï¼Œå¤ä¹ çš„å…¨é¢ä¸€ç‚¹ï¼Œ408è€ƒ4é—¨è¯¾ï¼Œæ¯ä¸€é—¨è¯¾éƒ½æœ‰å¾ˆå¤šçŸ¥è¯†ç‚¹ï¼Œæä¸å®šå°±è€ƒåˆ°å“ªä¸ªçŸ¥è¯†ç‚¹ï¼Œæˆ‘ä»¬åªèƒ½å°½é‡å¤ä¹ çš„å…¨é¢ã€‚åæœŸä¹Ÿè¦åˆ·çœŸé¢˜ï¼Œæœ€å¥½å¤šåˆ·å‡ éã€‚\n Qï¼šæ€æ ·æ‰èƒ½çœ‹åˆ°ä¸€ä¸ªå­¦æ ¡çš„æŠ¥å½•æ¯”ä¹‹ç±»çš„ï¼Ÿ\nAï¼šæ¯ä¸ªå­¦æ ¡å¯èƒ½ä¸å¤§ä¸€æ ·ï¼Œä½ å¯ä»¥å»è¯¥æ ¡çš„ç ”ç©¶ç”Ÿæ‹›ç”Ÿç½‘çœ‹ä¸€çœ‹ï¼Œæˆ–è€…å»ä»–ä»¬çš„è€ƒç ”ç¾¤æ‰¾ä¸€äº›å­¦é•¿é—®é—®ã€‚\n Qï¼šè‹±è¯­æ•°å­¦ä¹‹ç±»çœ‹çš„è§†é¢‘ä»å“ªæ‰¾?\nAï¼šå¯ä»¥ä»ç™¾åº¦äº‘ã€Bç«™ã€å…¬ä¼—å·ç­‰å¤„ï¼Œç”šè‡³ä½ è¿˜å¯ä»¥å»Pornhubçœ‹è€ƒç ”è§†é¢‘ã€‚ã€‚ã€‚ã€‚\n Q: ä¸€å®šè¦æŠ¥è¡¥ä¹ ç­æˆ–è€…è·Ÿç€æŸä¸ªè€å¸ˆçš„æ•™å­¦è§†é¢‘å­¦å—ï¼Ÿ\nAï¼šä¸ä¸€å®šï¼Œå› äººè€Œå¼‚ï¼Œæœ‰çš„äººå–œæ¬¢çœ‹è§†é¢‘ï¼Œè§‰å¾—è‡ªå·±çœ‹ä¹¦å¤ªæ…¢ï¼Œæœ‰çš„äººçœ‹è§†é¢‘çŠ¯å›°ï¼Œåªå–œæ¬¢è‡ªå·±æ…¢æ…¢å•ƒï¼ˆæ¯”å¦‚æˆ‘ï¼‰ã€‚è¡¥ä¹ ç­è¿™ä¸ªå˜›ï¼Œå’±ä¹Ÿæ²¡ä¸Šè¿‡ï¼Œå’±ä¹Ÿä¸çŸ¥é“ã€‚\n Any problems?","title":"è€ƒç ”"},{"content":"Q: DaemonSetçš„çš„ä½œç”¨ A: åœ¨ Kubernetes é›†ç¾¤é‡Œï¼Œè¿è¡Œä¸€ä¸ª Daemon Podã€‚ è¿™ä¸ª Pod æœ‰å¦‚ä¸‹ä¸‰ä¸ªç‰¹å¾ï¼š\n è¿™ä¸ª Pod è¿è¡Œåœ¨ Kubernetes é›†ç¾¤é‡Œçš„æ¯ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆNodeï¼‰ä¸Šï¼› æ¯ä¸ªèŠ‚ç‚¹ä¸Šåªæœ‰ä¸€ä¸ªè¿™æ ·çš„ Pod å®ä¾‹ï¼› å½“æœ‰æ–°çš„èŠ‚ç‚¹åŠ å…¥ Kubernetes é›†ç¾¤åï¼Œè¯¥ Pod ä¼šè‡ªåŠ¨åœ°åœ¨æ–°èŠ‚ç‚¹ä¸Šè¢«åˆ›å»ºå‡ºæ¥ï¼›è€Œå½“æ—§èŠ‚ç‚¹è¢«åˆ é™¤åï¼Œå®ƒä¸Šé¢çš„ Pod ä¹Ÿç›¸åº”åœ°ä¼šè¢«å›æ”¶æ‰ã€‚  Q: DaemonSetçš„åº”ç”¨å®ä¾‹ A:\n å„ç§ç½‘ç»œæ’ä»¶çš„ Agent ç»„ä»¶ï¼Œéƒ½å¿…é¡»è¿è¡Œåœ¨æ¯ä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œç”¨æ¥å¤„ç†è¿™ä¸ªèŠ‚ç‚¹ä¸Šçš„å®¹å™¨ç½‘ç»œï¼› å„ç§å­˜å‚¨æ’ä»¶çš„ Agent ç»„ä»¶ï¼Œä¹Ÿå¿…é¡»è¿è¡Œåœ¨æ¯ä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œç”¨æ¥åœ¨è¿™ä¸ªèŠ‚ç‚¹ä¸ŠæŒ‚è½½è¿œç¨‹å­˜å‚¨ç›®å½•ï¼Œæ“ä½œå®¹å™¨çš„ Volume ç›®å½•ï¼› å„ç§ç›‘æ§ç»„ä»¶å’Œæ—¥å¿—ç»„ä»¶ï¼Œä¹Ÿå¿…é¡»è¿è¡Œåœ¨æ¯ä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œè´Ÿè´£è¿™ä¸ªèŠ‚ç‚¹ä¸Šçš„ç›‘æ§ä¿¡æ¯å’Œæ—¥å¿—æœé›†ã€‚  DaemonSet å¼€å§‹è¿è¡Œçš„æ—¶æœºï¼Œå¾ˆå¤šæ—¶å€™æ¯”æ•´ä¸ª Kubernetes é›†ç¾¤å‡ºç°çš„æ—¶æœºéƒ½è¦æ—©\nQ: DaemonSet å¦‚ä½•ä¿è¯æ¯ä¸ª Node ä¸Šæœ‰ä¸”åªæœ‰ä¸€ä¸ªè¢«ç®¡ç†çš„ Pod A: DaemonSet Controllerï¼Œé¦–å…ˆä» Etcd é‡Œè·å–æ‰€æœ‰çš„ Node åˆ—è¡¨ï¼Œç„¶åéå†æ‰€æœ‰çš„ Nodeã€‚è¿™æ—¶ï¼Œå®ƒå°±å¯ä»¥å¾ˆå®¹æ˜“åœ°å»æ£€æŸ¥ï¼Œå½“å‰è¿™ä¸ª Node ä¸Šæ˜¯ä¸æ˜¯æœ‰ä¸€ä¸ªæºå¸¦äº† name=fluentd-elasticsearch æ ‡ç­¾çš„ Pod åœ¨è¿è¡Œã€‚è€Œæ£€æŸ¥çš„ç»“æœï¼Œå¯èƒ½æœ‰è¿™ä¹ˆä¸‰ç§æƒ…å†µï¼š\n æ²¡æœ‰è¿™ç§ Podï¼Œé‚£ä¹ˆå°±æ„å‘³ç€è¦åœ¨è¿™ä¸ª Node ä¸Šåˆ›å»ºè¿™æ ·ä¸€ä¸ª Podï¼› æœ‰è¿™ç§ Podï¼Œä½†æ˜¯æ•°é‡å¤§äº 1ï¼Œé‚£å°±è¯´æ˜è¦æŠŠå¤šä½™çš„ Pod ä»è¿™ä¸ª Node ä¸Šåˆ é™¤æ‰ï¼› æ­£å¥½åªæœ‰ä¸€ä¸ªè¿™ç§ Podï¼Œé‚£è¯´æ˜è¿™ä¸ªèŠ‚ç‚¹æ˜¯æ­£å¸¸çš„ã€‚å…¶ä¸­ï¼Œåˆ é™¤èŠ‚ç‚¹ï¼ˆNodeï¼‰ä¸Šå¤šä½™çš„ Pod éå¸¸ç®€å•ï¼Œç›´æ¥è°ƒç”¨ Kubernetes API å°±å¯ä»¥äº†ã€‚ DaemonSeté€šè¿‡æ±¡ç‚¹å®¹å¿æœºåˆ¶é€‰æ‹©node  ç›¸æ¯”äº Deploymentï¼ŒDaemonSet åªç®¡ç† Pod å¯¹è±¡ï¼Œç„¶åé€šè¿‡ nodeAffinity å’Œ Toleration è¿™ä¸¤ä¸ªè°ƒåº¦å™¨çš„å°åŠŸèƒ½ï¼Œä¿è¯äº†æ¯ä¸ªèŠ‚ç‚¹ä¸Šæœ‰ä¸”åªæœ‰ä¸€ä¸ª Podã€‚\nDaemonSet ä½¿ç”¨ ControllerRevisionï¼Œæ¥ä¿å­˜å’Œç®¡ç†è‡ªå·±å¯¹åº”çš„â€œç‰ˆæœ¬â€ã€‚\n","permalink":"http://yangchnet.github.io/Dessert/posts/_tmp/kubernetes%E4%B9%8Bdaemonset/","summary":"Q: DaemonSetçš„çš„ä½œç”¨ A: åœ¨ Kubernetes é›†ç¾¤é‡Œï¼Œè¿è¡Œä¸€ä¸ª Daemon Podã€‚ è¿™ä¸ª Pod æœ‰å¦‚ä¸‹ä¸‰ä¸ªç‰¹å¾ï¼š\n è¿™ä¸ª Pod è¿è¡Œåœ¨ Kubernetes é›†ç¾¤é‡Œçš„æ¯ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆNodeï¼‰ä¸Šï¼› æ¯ä¸ªèŠ‚ç‚¹ä¸Šåªæœ‰ä¸€ä¸ªè¿™æ ·çš„ Pod å®ä¾‹ï¼› å½“æœ‰æ–°çš„èŠ‚ç‚¹åŠ å…¥ Kubernetes é›†ç¾¤åï¼Œè¯¥ Pod ä¼šè‡ªåŠ¨åœ°åœ¨æ–°èŠ‚ç‚¹ä¸Šè¢«åˆ›å»ºå‡ºæ¥ï¼›è€Œå½“æ—§èŠ‚ç‚¹è¢«åˆ é™¤åï¼Œå®ƒä¸Šé¢çš„ Pod ä¹Ÿç›¸åº”åœ°ä¼šè¢«å›æ”¶æ‰ã€‚  Q: DaemonSetçš„åº”ç”¨å®ä¾‹ A:\n å„ç§ç½‘ç»œæ’ä»¶çš„ Agent ç»„ä»¶ï¼Œéƒ½å¿…é¡»è¿è¡Œåœ¨æ¯ä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œç”¨æ¥å¤„ç†è¿™ä¸ªèŠ‚ç‚¹ä¸Šçš„å®¹å™¨ç½‘ç»œï¼› å„ç§å­˜å‚¨æ’ä»¶çš„ Agent ç»„ä»¶ï¼Œä¹Ÿå¿…é¡»è¿è¡Œåœ¨æ¯ä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œç”¨æ¥åœ¨è¿™ä¸ªèŠ‚ç‚¹ä¸ŠæŒ‚è½½è¿œç¨‹å­˜å‚¨ç›®å½•ï¼Œæ“ä½œå®¹å™¨çš„ Volume ç›®å½•ï¼› å„ç§ç›‘æ§ç»„ä»¶å’Œæ—¥å¿—ç»„ä»¶ï¼Œä¹Ÿå¿…é¡»è¿è¡Œåœ¨æ¯ä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œè´Ÿè´£è¿™ä¸ªèŠ‚ç‚¹ä¸Šçš„ç›‘æ§ä¿¡æ¯å’Œæ—¥å¿—æœé›†ã€‚  DaemonSet å¼€å§‹è¿è¡Œçš„æ—¶æœºï¼Œå¾ˆå¤šæ—¶å€™æ¯”æ•´ä¸ª Kubernetes é›†ç¾¤å‡ºç°çš„æ—¶æœºéƒ½è¦æ—©\nQ: DaemonSet å¦‚ä½•ä¿è¯æ¯ä¸ª Node ä¸Šæœ‰ä¸”åªæœ‰ä¸€ä¸ªè¢«ç®¡ç†çš„ Pod A: DaemonSet Controllerï¼Œé¦–å…ˆä» Etcd é‡Œè·å–æ‰€æœ‰çš„ Node åˆ—è¡¨ï¼Œç„¶åéå†æ‰€æœ‰çš„ Nodeã€‚è¿™æ—¶ï¼Œå®ƒå°±å¯ä»¥å¾ˆå®¹æ˜“åœ°å»æ£€æŸ¥ï¼Œå½“å‰è¿™ä¸ª Node ä¸Šæ˜¯ä¸æ˜¯æœ‰ä¸€ä¸ªæºå¸¦äº† name=fluentd-elasticsearch æ ‡ç­¾çš„ Pod åœ¨è¿è¡Œã€‚è€Œæ£€æŸ¥çš„ç»“æœï¼Œå¯èƒ½æœ‰è¿™ä¹ˆä¸‰ç§æƒ…å†µï¼š\n æ²¡æœ‰è¿™ç§ Podï¼Œé‚£ä¹ˆå°±æ„å‘³ç€è¦åœ¨è¿™ä¸ª Node ä¸Šåˆ›å»ºè¿™æ ·ä¸€ä¸ª Podï¼› æœ‰è¿™ç§ Podï¼Œä½†æ˜¯æ•°é‡å¤§äº 1ï¼Œé‚£å°±è¯´æ˜è¦æŠŠå¤šä½™çš„ Pod ä»è¿™ä¸ª Node ä¸Šåˆ é™¤æ‰ï¼› æ­£å¥½åªæœ‰ä¸€ä¸ªè¿™ç§ Podï¼Œé‚£è¯´æ˜è¿™ä¸ªèŠ‚ç‚¹æ˜¯æ­£å¸¸çš„ã€‚å…¶ä¸­ï¼Œåˆ é™¤èŠ‚ç‚¹ï¼ˆNodeï¼‰ä¸Šå¤šä½™çš„ Pod éå¸¸ç®€å•ï¼Œç›´æ¥è°ƒç”¨ Kubernetes API å°±å¯ä»¥äº†ã€‚ DaemonSeté€šè¿‡æ±¡ç‚¹å®¹å¿æœºåˆ¶é€‰æ‹©node  ç›¸æ¯”äº Deploymentï¼ŒDaemonSet åªç®¡ç† Pod å¯¹è±¡ï¼Œç„¶åé€šè¿‡ nodeAffinity å’Œ Toleration è¿™ä¸¤ä¸ªè°ƒåº¦å™¨çš„å°åŠŸèƒ½ï¼Œä¿è¯äº†æ¯ä¸ªèŠ‚ç‚¹ä¸Šæœ‰ä¸”åªæœ‰ä¸€ä¸ª Podã€‚","title":""},{"content":"","permalink":"http://yangchnet.github.io/Dessert/posts/_tmp/kubernetes%E4%B9%8Bjob/","summary":"","title":""},{"content":"Pre Q:ä½¿ç”¨å®¹å™¨çš„â€œæœ€ä½³å®è·µâ€è¦æ±‚å®¹å™¨ä¸­åªè¿è¡Œä¸€ä¸ªè¿›ç¨‹ï¼Œæ˜¯ä¸æ˜¯å®¹å™¨ä¸­åªèƒ½è¿è¡Œä¸€ä¸ªè¿›ç¨‹å‘¢ï¼Ÿ\nAï¼šå®¹å™¨çš„â€œå•è¿›ç¨‹æ¨¡å‹â€ï¼Œå¹¶ä¸æ˜¯æŒ‡å®¹å™¨é‡Œåªèƒ½è¿è¡Œâ€œä¸€ä¸ªâ€è¿›ç¨‹ï¼Œè€Œæ˜¯æŒ‡å®¹å™¨æ²¡æœ‰ç®¡ç†å¤šä¸ªè¿›ç¨‹çš„èƒ½åŠ›ã€‚è¿™æ˜¯å› ä¸ºå®¹å™¨é‡Œ PID=1 çš„è¿›ç¨‹å°±æ˜¯åº”ç”¨æœ¬èº«ï¼Œå…¶ä»–çš„è¿›ç¨‹éƒ½æ˜¯è¿™ä¸ª PID=1 è¿›ç¨‹çš„å­è¿›ç¨‹ã€‚å¯æ˜¯ï¼Œç”¨æˆ·ç¼–å†™çš„åº”ç”¨ï¼Œå¹¶ä¸èƒ½å¤Ÿåƒæ­£å¸¸æ“ä½œç³»ç»Ÿé‡Œçš„ init è¿›ç¨‹æˆ–è€… systemd é‚£æ ·æ‹¥æœ‰è¿›ç¨‹ç®¡ç†çš„åŠŸèƒ½ã€‚æ¯”å¦‚ï¼Œä½ çš„åº”ç”¨æ˜¯ä¸€ä¸ª Java Web ç¨‹åºï¼ˆPID=1ï¼‰ï¼Œç„¶åä½ æ‰§è¡Œ docker exec åœ¨åå°å¯åŠ¨äº†ä¸€ä¸ª Nginx è¿›ç¨‹ï¼ˆPID=3ï¼‰ã€‚å¯æ˜¯ï¼Œå½“è¿™ä¸ª Nginx è¿›ç¨‹å¼‚å¸¸é€€å‡ºçš„æ—¶å€™ï¼Œä½ è¯¥æ€ä¹ˆçŸ¥é“å‘¢ï¼Ÿè¿™ä¸ªè¿›ç¨‹é€€å‡ºåçš„åƒåœ¾æ”¶é›†å·¥ä½œï¼Œåˆåº”è¯¥ç”±è°å»åšå‘¢ï¼Ÿå› æ­¤ï¼Œåªæœ‰å½“å®¹å™¨ä¸­åªå­˜åœ¨ä¸€ä¸ªè¿›ç¨‹æ—¶ï¼Œæ‰èƒ½å¯¹å®¹å™¨å†…çš„è¿›ç¨‹è¿›è¡Œæœ‰æ•ˆçš„ç®¡ç†ã€‚\nQ:ä¸ºä»€ä¹ˆéœ€è¦Podï¼Ÿ\nA:\n æœ‰äº›å®¹å™¨ä¹‹é—´æœ‰ç€ä¸€ç§â€œè¶…äº²å¯†å…³ç³»â€ã€‚è¿™äº›å…·æœ‰â€œè¶…äº²å¯†å…³ç³»â€çš„å®¹å™¨çš„å…¸å‹ç‰¹å¾åŒ…æ‹¬ä½†ä¸é™äºï¼šäº’ç›¸ä¹‹é—´ä¼šå‘ç”Ÿç›´æ¥çš„æ–‡ä»¶äº¤æ¢ã€ä½¿ç”¨ localhost æˆ–è€… Socket æ–‡ä»¶è¿›è¡Œæœ¬åœ°é€šä¿¡ã€ä¼šå‘ç”Ÿéå¸¸é¢‘ç¹çš„è¿œç¨‹è°ƒç”¨ã€éœ€è¦å…±äº«æŸäº› Linux Namespaceï¼ˆæ¯”å¦‚ï¼Œä¸€ä¸ªå®¹å™¨è¦åŠ å…¥å¦ä¸€ä¸ªå®¹å™¨çš„ Network Namespaceï¼‰ç­‰ç­‰ã€‚è¿™äº›å®¹å™¨æœ‰å¿…è¦éƒ¨ç½²åœ¨åŒä¸€ç¯å¢ƒä¸­ æœ‰äº›å®¹å™¨éœ€è¦ä¸å…¶ä»–å®¹å™¨å…±äº«Networkæˆ–Volumeç­‰ï¼Œä¾‹å¦‚Béœ€è¦å…±äº«Açš„Networkã€‚ä½†è¿™æ ·å°±ä¼šå‡ºç°Bä¾èµ–ä¸Açš„æƒ…å†µï¼Œå®¹å™¨ä¹‹é—´ä»å¯¹ç­‰å…³ç³»é€€åŒ–ä¸ºæ‹“æ‰‘å…³ç³»ã€‚å¦‚æœå°†Networkä»¥åŠVolumeå®šä¹‰åœ¨å®¹å™¨ä¹‹ä¸Šï¼ˆä¹Ÿå°±æ˜¯Podï¼‰çš„ä¸€ä¸ªçº§åˆ«ï¼ŒåŒä¸€Podä¸­çš„å®¹å™¨å…±äº«Networkå’ŒVolumeï¼Œé‚£å®¹å™¨ä¹‹é—´è¿˜æ˜¯å•çº¯çš„å¯¹ç­‰å…³ç³»ã€‚  Podæ˜¯Kubernetesä¸­æœ€å°çš„ç¼–æ’å•ä½, å¯ä»¥ç±»æ¯”ä¸ä¼ ç»Ÿéƒ¨ç½²ç¯å¢ƒä¸­çš„â€œè™šæ‹Ÿæœºâ€ã€‚å‡¡æ˜¯è°ƒåº¦ã€ç½‘ç»œã€å­˜å‚¨ï¼Œä»¥åŠå®‰å…¨ç›¸å…³çš„å±æ€§ï¼ŒåŸºæœ¬ä¸Šæ˜¯ Pod çº§åˆ«çš„ã€‚è¿™äº›å±æ€§çš„å…±åŒç‰¹å¾åœ¨äºï¼Œä»–ä»¬éƒ½æ˜¯å¯¹â€œæœºå™¨â€è¿›è¡Œæè¿°ã€‚\nPodä¸­å¸¸ç”¨çš„å­—æ®µ  nodeSelector.ä¾›ç”¨æˆ·å°†Podä¸Nodeè¿›è¡Œç»‘å®šã€‚  ç”¨æ³•ç¤ºä¾‹ï¼š\napiVersion: v1 kind: Pod ... spec: nodeSelector: disktype: ssd è¿™ä»£è¡¨è¿™ä¸ªPodåªèƒ½è¿è¡Œåœ¨æºå¸¦äº†disktype:ssdæ ‡ç­¾çš„èŠ‚ç‚¹ä¸Šã€‚\n  nodeName. ä¸€æ—¦ Pod çš„è¿™ä¸ªå­—æ®µè¢«èµ‹å€¼ï¼ŒKubernetes é¡¹ç›®å°±ä¼šè¢«è®¤ä¸ºè¿™ä¸ª Pod å·²ç»ç»è¿‡äº†è°ƒåº¦ï¼Œè°ƒåº¦çš„ç»“æœå°±æ˜¯èµ‹å€¼çš„èŠ‚ç‚¹åå­—ã€‚æ‰€ä»¥ï¼Œè¿™ä¸ªå­—æ®µä¸€èˆ¬ç”±è°ƒåº¦å™¨è´Ÿè´£è®¾ç½®ï¼Œä½†ç”¨æˆ·ä¹Ÿå¯ä»¥è®¾ç½®å®ƒæ¥â€œéª—è¿‡â€è°ƒåº¦å™¨ï¼Œå½“ç„¶è¿™ä¸ªåšæ³•ä¸€èˆ¬æ˜¯åœ¨æµ‹è¯•æˆ–è€…è°ƒè¯•çš„æ—¶å€™æ‰ä¼šç”¨åˆ°ã€‚\n  hostAliases. å®šä¹‰Podçš„hostsæ–‡ä»¶\n  apiVersion: v1 kind: Pod ... spec: hostAliases: - ip: \u0026#34;10.1.2.3\u0026#34; hostnames: - \u0026#34;foo.remote\u0026#34; - \u0026#34;bar.remote\u0026#34; ... è¿™æ ·ï¼Œè¿™ä¸ªPodå¯åŠ¨åï¼Œ/etc/hostsä¸­å°±ä¼šæœ‰å¦‚ä¸‹é…ç½®:\n10.1.2.3 foo.remote 10.1.2.3 bar.remote éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨kubernetesä¸­ï¼Œå¦‚æœæƒ³è¦é…ç½®hostsæ–‡ä»¶ï¼Œå¿…é¡»ä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œå¦åˆ™åœ¨Podé‡å»ºåï¼Œhostsæ–‡ä»¶ä¼šè¢«è¦†ç›–ã€‚\nQ:Podçš„ç”Ÿå‘½å‘¨æœŸ A:\n Pendingã€‚è¿™ä¸ªçŠ¶æ€æ„å‘³ç€ï¼ŒPod çš„ YAML æ–‡ä»¶å·²ç»æäº¤ç»™äº† Kubernetesï¼ŒAPI å¯¹è±¡å·²ç»è¢«åˆ›å»ºå¹¶ä¿å­˜åœ¨ Etcd å½“ä¸­ã€‚ä½†æ˜¯ï¼Œè¿™ä¸ª Pod é‡Œæœ‰äº›å®¹å™¨å› ä¸ºæŸç§åŸå› è€Œä¸èƒ½è¢«é¡ºåˆ©åˆ›å»ºã€‚æ¯”å¦‚ï¼Œè°ƒåº¦ä¸æˆåŠŸã€‚ Runningã€‚è¿™ä¸ªçŠ¶æ€ä¸‹ï¼ŒPod å·²ç»è°ƒåº¦æˆåŠŸï¼Œè·Ÿä¸€ä¸ªå…·ä½“çš„èŠ‚ç‚¹ç»‘å®šã€‚å®ƒåŒ…å«çš„å®¹å™¨éƒ½å·²ç»åˆ›å»ºæˆåŠŸï¼Œå¹¶ä¸”è‡³å°‘æœ‰ä¸€ä¸ªæ­£åœ¨è¿è¡Œä¸­ã€‚ Succeededã€‚è¿™ä¸ªçŠ¶æ€æ„å‘³ç€ï¼ŒPod é‡Œçš„æ‰€æœ‰å®¹å™¨éƒ½æ­£å¸¸è¿è¡Œå®Œæ¯•ï¼Œå¹¶ä¸”å·²ç»é€€å‡ºäº†ã€‚è¿™ç§æƒ…å†µåœ¨è¿è¡Œä¸€æ¬¡æ€§ä»»åŠ¡æ—¶æœ€ä¸ºå¸¸è§ã€‚ Failedã€‚è¿™ä¸ªçŠ¶æ€ä¸‹ï¼ŒPod é‡Œè‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨ä»¥ä¸æ­£å¸¸çš„çŠ¶æ€ï¼ˆé 0 çš„è¿”å›ç ï¼‰é€€å‡ºã€‚è¿™ä¸ªçŠ¶æ€çš„å‡ºç°ï¼Œæ„å‘³ç€ä½ å¾—æƒ³åŠæ³• Debug è¿™ä¸ªå®¹å™¨çš„åº”ç”¨ï¼Œæ¯”å¦‚æŸ¥çœ‹ Pod çš„ Events å’Œæ—¥å¿—ã€‚ Unknownã€‚è¿™æ˜¯ä¸€ä¸ªå¼‚å¸¸çŠ¶æ€ï¼Œæ„å‘³ç€ Pod çš„çŠ¶æ€ä¸èƒ½æŒç»­åœ°è¢« kubelet æ±‡æŠ¥ç»™ kube-apiserverï¼Œè¿™å¾ˆæœ‰å¯èƒ½æ˜¯ä¸»ä»èŠ‚ç‚¹ï¼ˆMaster å’Œ Kubeletï¼‰é—´çš„é€šä¿¡å‡ºç°äº†é—®é¢˜ã€‚  ","permalink":"http://yangchnet.github.io/Dessert/posts/_tmp/kubernetes%E4%B9%8Bpod%E7%AF%87/","summary":"Pre Q:ä½¿ç”¨å®¹å™¨çš„â€œæœ€ä½³å®è·µâ€è¦æ±‚å®¹å™¨ä¸­åªè¿è¡Œä¸€ä¸ªè¿›ç¨‹ï¼Œæ˜¯ä¸æ˜¯å®¹å™¨ä¸­åªèƒ½è¿è¡Œä¸€ä¸ªè¿›ç¨‹å‘¢ï¼Ÿ\nAï¼šå®¹å™¨çš„â€œå•è¿›ç¨‹æ¨¡å‹â€ï¼Œå¹¶ä¸æ˜¯æŒ‡å®¹å™¨é‡Œåªèƒ½è¿è¡Œâ€œä¸€ä¸ªâ€è¿›ç¨‹ï¼Œè€Œæ˜¯æŒ‡å®¹å™¨æ²¡æœ‰ç®¡ç†å¤šä¸ªè¿›ç¨‹çš„èƒ½åŠ›ã€‚è¿™æ˜¯å› ä¸ºå®¹å™¨é‡Œ PID=1 çš„è¿›ç¨‹å°±æ˜¯åº”ç”¨æœ¬èº«ï¼Œå…¶ä»–çš„è¿›ç¨‹éƒ½æ˜¯è¿™ä¸ª PID=1 è¿›ç¨‹çš„å­è¿›ç¨‹ã€‚å¯æ˜¯ï¼Œç”¨æˆ·ç¼–å†™çš„åº”ç”¨ï¼Œå¹¶ä¸èƒ½å¤Ÿåƒæ­£å¸¸æ“ä½œç³»ç»Ÿé‡Œçš„ init è¿›ç¨‹æˆ–è€… systemd é‚£æ ·æ‹¥æœ‰è¿›ç¨‹ç®¡ç†çš„åŠŸèƒ½ã€‚æ¯”å¦‚ï¼Œä½ çš„åº”ç”¨æ˜¯ä¸€ä¸ª Java Web ç¨‹åºï¼ˆPID=1ï¼‰ï¼Œç„¶åä½ æ‰§è¡Œ docker exec åœ¨åå°å¯åŠ¨äº†ä¸€ä¸ª Nginx è¿›ç¨‹ï¼ˆPID=3ï¼‰ã€‚å¯æ˜¯ï¼Œå½“è¿™ä¸ª Nginx è¿›ç¨‹å¼‚å¸¸é€€å‡ºçš„æ—¶å€™ï¼Œä½ è¯¥æ€ä¹ˆçŸ¥é“å‘¢ï¼Ÿè¿™ä¸ªè¿›ç¨‹é€€å‡ºåçš„åƒåœ¾æ”¶é›†å·¥ä½œï¼Œåˆåº”è¯¥ç”±è°å»åšå‘¢ï¼Ÿå› æ­¤ï¼Œåªæœ‰å½“å®¹å™¨ä¸­åªå­˜åœ¨ä¸€ä¸ªè¿›ç¨‹æ—¶ï¼Œæ‰èƒ½å¯¹å®¹å™¨å†…çš„è¿›ç¨‹è¿›è¡Œæœ‰æ•ˆçš„ç®¡ç†ã€‚\nQ:ä¸ºä»€ä¹ˆéœ€è¦Podï¼Ÿ\nA:\n æœ‰äº›å®¹å™¨ä¹‹é—´æœ‰ç€ä¸€ç§â€œè¶…äº²å¯†å…³ç³»â€ã€‚è¿™äº›å…·æœ‰â€œè¶…äº²å¯†å…³ç³»â€çš„å®¹å™¨çš„å…¸å‹ç‰¹å¾åŒ…æ‹¬ä½†ä¸é™äºï¼šäº’ç›¸ä¹‹é—´ä¼šå‘ç”Ÿç›´æ¥çš„æ–‡ä»¶äº¤æ¢ã€ä½¿ç”¨ localhost æˆ–è€… Socket æ–‡ä»¶è¿›è¡Œæœ¬åœ°é€šä¿¡ã€ä¼šå‘ç”Ÿéå¸¸é¢‘ç¹çš„è¿œç¨‹è°ƒç”¨ã€éœ€è¦å…±äº«æŸäº› Linux Namespaceï¼ˆæ¯”å¦‚ï¼Œä¸€ä¸ªå®¹å™¨è¦åŠ å…¥å¦ä¸€ä¸ªå®¹å™¨çš„ Network Namespaceï¼‰ç­‰ç­‰ã€‚è¿™äº›å®¹å™¨æœ‰å¿…è¦éƒ¨ç½²åœ¨åŒä¸€ç¯å¢ƒä¸­ æœ‰äº›å®¹å™¨éœ€è¦ä¸å…¶ä»–å®¹å™¨å…±äº«Networkæˆ–Volumeç­‰ï¼Œä¾‹å¦‚Béœ€è¦å…±äº«Açš„Networkã€‚ä½†è¿™æ ·å°±ä¼šå‡ºç°Bä¾èµ–ä¸Açš„æƒ…å†µï¼Œå®¹å™¨ä¹‹é—´ä»å¯¹ç­‰å…³ç³»é€€åŒ–ä¸ºæ‹“æ‰‘å…³ç³»ã€‚å¦‚æœå°†Networkä»¥åŠVolumeå®šä¹‰åœ¨å®¹å™¨ä¹‹ä¸Šï¼ˆä¹Ÿå°±æ˜¯Podï¼‰çš„ä¸€ä¸ªçº§åˆ«ï¼ŒåŒä¸€Podä¸­çš„å®¹å™¨å…±äº«Networkå’ŒVolumeï¼Œé‚£å®¹å™¨ä¹‹é—´è¿˜æ˜¯å•çº¯çš„å¯¹ç­‰å…³ç³»ã€‚  Podæ˜¯Kubernetesä¸­æœ€å°çš„ç¼–æ’å•ä½, å¯ä»¥ç±»æ¯”ä¸ä¼ ç»Ÿéƒ¨ç½²ç¯å¢ƒä¸­çš„â€œè™šæ‹Ÿæœºâ€ã€‚å‡¡æ˜¯è°ƒåº¦ã€ç½‘ç»œã€å­˜å‚¨ï¼Œä»¥åŠå®‰å…¨ç›¸å…³çš„å±æ€§ï¼ŒåŸºæœ¬ä¸Šæ˜¯ Pod çº§åˆ«çš„ã€‚è¿™äº›å±æ€§çš„å…±åŒç‰¹å¾åœ¨äºï¼Œä»–ä»¬éƒ½æ˜¯å¯¹â€œæœºå™¨â€è¿›è¡Œæè¿°ã€‚\nPodä¸­å¸¸ç”¨çš„å­—æ®µ  nodeSelector.ä¾›ç”¨æˆ·å°†Podä¸Nodeè¿›è¡Œç»‘å®šã€‚  ç”¨æ³•ç¤ºä¾‹ï¼š\napiVersion: v1 kind: Pod ... spec: nodeSelector: disktype: ssd è¿™ä»£è¡¨è¿™ä¸ªPodåªèƒ½è¿è¡Œåœ¨æºå¸¦äº†disktype:ssdæ ‡ç­¾çš„èŠ‚ç‚¹ä¸Šã€‚\n  nodeName. ä¸€æ—¦ Pod çš„è¿™ä¸ªå­—æ®µè¢«èµ‹å€¼ï¼ŒKubernetes é¡¹ç›®å°±ä¼šè¢«è®¤ä¸ºè¿™ä¸ª Pod å·²ç»ç»è¿‡äº†è°ƒåº¦ï¼Œè°ƒåº¦çš„ç»“æœå°±æ˜¯èµ‹å€¼çš„èŠ‚ç‚¹åå­—ã€‚æ‰€ä»¥ï¼Œè¿™ä¸ªå­—æ®µä¸€èˆ¬ç”±è°ƒåº¦å™¨è´Ÿè´£è®¾ç½®ï¼Œä½†ç”¨æˆ·ä¹Ÿå¯ä»¥è®¾ç½®å®ƒæ¥â€œéª—è¿‡â€è°ƒåº¦å™¨ï¼Œå½“ç„¶è¿™ä¸ªåšæ³•ä¸€èˆ¬æ˜¯åœ¨æµ‹è¯•æˆ–è€…è°ƒè¯•çš„æ—¶å€™æ‰ä¼šç”¨åˆ°ã€‚\n  hostAliases. å®šä¹‰Podçš„hostsæ–‡ä»¶\n  apiVersion: v1 kind: Pod .","title":""},{"content":"Service Service æ˜¯ Kubernetes é¡¹ç›®ä¸­ç”¨æ¥å°†ä¸€ç»„ Pod æš´éœ²ç»™å¤–ç•Œè®¿é—®çš„ä¸€ç§æœºåˆ¶ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ª Deployment æœ‰ 3 ä¸ª Podï¼Œé‚£ä¹ˆæˆ‘å°±å¯ä»¥å®šä¹‰ä¸€ä¸ª Serviceã€‚ç„¶åï¼Œç”¨æˆ·åªè¦èƒ½è®¿é—®åˆ°è¿™ä¸ª Serviceï¼Œå®ƒå°±èƒ½è®¿é—®åˆ°æŸä¸ªå…·ä½“çš„ Podã€‚\nQ: Serviceæ˜¯å¦‚ä½•è¢«è®¿é—®åˆ°çš„ï¼Ÿ A: ä¸¤ç§æ–¹å¼\n ä»¥ Service çš„ VIPï¼ˆVirtual IPï¼Œå³ï¼šè™šæ‹Ÿ IPï¼‰æ–¹å¼ã€‚æ¯”å¦‚ï¼šå½“æˆ‘è®¿é—® 10.0.23.1 è¿™ä¸ª Service çš„ IP åœ°å€æ—¶ï¼Œ10.0.23.1 å…¶å®å°±æ˜¯ä¸€ä¸ª VIPï¼Œå®ƒä¼šæŠŠè¯·æ±‚è½¬å‘åˆ°è¯¥ Service æ‰€ä»£ç†çš„æŸä¸€ä¸ª Pod ä¸Šã€‚ ä»¥ Service çš„ DNS æ–¹å¼ã€‚æ¯”å¦‚ï¼šè¿™æ—¶å€™ï¼Œåªè¦æˆ‘è®¿é—®â€œmy-svc.my-namespace.svc.cluster.localâ€è¿™æ¡ DNS è®°å½•ï¼Œå°±å¯ä»¥è®¿é—®åˆ°åå« my-svc çš„ Service æ‰€ä»£ç†çš„æŸä¸€ä¸ª Podã€‚è¿™é‡Œåˆæœ‰ä¸¤ç§å¤„ç†æ–¹æ³•ï¼š  ç¬¬ä¸€ç§å¤„ç†æ–¹æ³•ï¼Œæ˜¯ Normal Serviceã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œä½ è®¿é—®â€œmy-svc.my-namespace.svc.cluster.localâ€è§£æåˆ°çš„ï¼Œæ­£æ˜¯ my-svc è¿™ä¸ª Service çš„ VIPï¼Œåé¢çš„æµç¨‹å°±è·Ÿ VIP æ–¹å¼ä¸€è‡´äº†ã€‚ ç¬¬äºŒç§å¤„ç†æ–¹æ³•ï¼Œæ˜¯ Headless Serviceã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œä½ è®¿é—®â€œmy-svc.my-namespace.svc.cluster.localâ€è§£æåˆ°çš„ï¼Œç›´æ¥å°±æ˜¯ my-svc ä»£ç†çš„æŸä¸€ä¸ª Pod çš„ IP åœ°å€ã€‚å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œçš„åŒºåˆ«åœ¨äºï¼ŒHeadless Service ä¸éœ€è¦åˆ†é…ä¸€ä¸ª VIPï¼Œè€Œæ˜¯å¯ä»¥ç›´æ¥ä»¥ DNS è®°å½•çš„æ–¹å¼è§£æå‡ºè¢«ä»£ç† Pod çš„ IP åœ°å€ã€‚    Headless Service\nHeadless Service ä¸­çš„â€œHeadlessâ€çš„å«ä¹‰åœ¨äºè¿™ä¸ªServiceï¼Œæ²¡æœ‰ä¸€ä¸ªVIPä½œä¸ºå¤´ï¼Œå®ƒä»¥DNSçš„æ–¹å¼æš´éœ²å‡ºå®ƒæ‰€ä»£ç†çš„IPã€‚\nå½“åˆ›å»ºäº†ä¸€ä¸ªHeadless Serviceåï¼Œå®ƒæ‰€ä»£ç†çš„æ‰€æœ‰Podçš„IPåœ°å€ï¼Œéƒ½ä¼šè¢«ç»‘å®šä¸€ä¸ªè¿™æ ·æ ¼å¼çš„ DNS è®°å½•ï¼š\n\u0026lt;pod-name\u0026gt;.\u0026lt;svc-name\u0026gt;.\u0026lt;namespace\u0026gt;.svc.cluster.local è¿™ä¸ª DNS è®°å½•ï¼Œæ­£æ˜¯ Kubernetes é¡¹ç›®ä¸º Pod åˆ†é…çš„å”¯ä¸€çš„â€œå¯è§£æèº«ä»½â€ï¼ˆResolvable Identityï¼‰ã€‚\næœ‰äº†è¿™ä¸ªâ€œå¯è§£æèº«ä»½â€ï¼Œåªè¦ä½ çŸ¥é“äº†ä¸€ä¸ª Pod çš„åå­—ï¼Œä»¥åŠå®ƒå¯¹åº”çš„ Service çš„åå­—ï¼Œä½ å°±å¯ä»¥éå¸¸ç¡®å®šåœ°é€šè¿‡è¿™æ¡ DNS è®°å½•è®¿é—®åˆ° Pod çš„ IP åœ°å€ã€‚\n","permalink":"http://yangchnet.github.io/Dessert/posts/_tmp/kubernetes%E4%B9%8Bservice/","summary":"Service Service æ˜¯ Kubernetes é¡¹ç›®ä¸­ç”¨æ¥å°†ä¸€ç»„ Pod æš´éœ²ç»™å¤–ç•Œè®¿é—®çš„ä¸€ç§æœºåˆ¶ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ª Deployment æœ‰ 3 ä¸ª Podï¼Œé‚£ä¹ˆæˆ‘å°±å¯ä»¥å®šä¹‰ä¸€ä¸ª Serviceã€‚ç„¶åï¼Œç”¨æˆ·åªè¦èƒ½è®¿é—®åˆ°è¿™ä¸ª Serviceï¼Œå®ƒå°±èƒ½è®¿é—®åˆ°æŸä¸ªå…·ä½“çš„ Podã€‚\nQ: Serviceæ˜¯å¦‚ä½•è¢«è®¿é—®åˆ°çš„ï¼Ÿ A: ä¸¤ç§æ–¹å¼\n ä»¥ Service çš„ VIPï¼ˆVirtual IPï¼Œå³ï¼šè™šæ‹Ÿ IPï¼‰æ–¹å¼ã€‚æ¯”å¦‚ï¼šå½“æˆ‘è®¿é—® 10.0.23.1 è¿™ä¸ª Service çš„ IP åœ°å€æ—¶ï¼Œ10.0.23.1 å…¶å®å°±æ˜¯ä¸€ä¸ª VIPï¼Œå®ƒä¼šæŠŠè¯·æ±‚è½¬å‘åˆ°è¯¥ Service æ‰€ä»£ç†çš„æŸä¸€ä¸ª Pod ä¸Šã€‚ ä»¥ Service çš„ DNS æ–¹å¼ã€‚æ¯”å¦‚ï¼šè¿™æ—¶å€™ï¼Œåªè¦æˆ‘è®¿é—®â€œmy-svc.my-namespace.svc.cluster.localâ€è¿™æ¡ DNS è®°å½•ï¼Œå°±å¯ä»¥è®¿é—®åˆ°åå« my-svc çš„ Service æ‰€ä»£ç†çš„æŸä¸€ä¸ª Podã€‚è¿™é‡Œåˆæœ‰ä¸¤ç§å¤„ç†æ–¹æ³•ï¼š  ç¬¬ä¸€ç§å¤„ç†æ–¹æ³•ï¼Œæ˜¯ Normal Serviceã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œä½ è®¿é—®â€œmy-svc.my-namespace.svc.cluster.localâ€è§£æåˆ°çš„ï¼Œæ­£æ˜¯ my-svc è¿™ä¸ª Service çš„ VIPï¼Œåé¢çš„æµç¨‹å°±è·Ÿ VIP æ–¹å¼ä¸€è‡´äº†ã€‚ ç¬¬äºŒç§å¤„ç†æ–¹æ³•ï¼Œæ˜¯ Headless Serviceã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œä½ è®¿é—®â€œmy-svc.my-namespace.svc.cluster.localâ€è§£æåˆ°çš„ï¼Œç›´æ¥å°±æ˜¯ my-svc ä»£ç†çš„æŸä¸€ä¸ª Pod çš„ IP åœ°å€ã€‚å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œçš„åŒºåˆ«åœ¨äºï¼ŒHeadless Service ä¸éœ€è¦åˆ†é…ä¸€ä¸ª VIPï¼Œè€Œæ˜¯å¯ä»¥ç›´æ¥ä»¥ DNS è®°å½•çš„æ–¹å¼è§£æå‡ºè¢«ä»£ç† Pod çš„ IP åœ°å€ã€‚    Headless Service","title":""},{"content":"Deploymentæ˜¯Kubernetesä¸­çš„ä¸€ä¸ªæ§åˆ¶å™¨ï¼Œè´Ÿè´£å¯¹podè¿›è¡Œæ§åˆ¶\nQ:æ§åˆ¶å™¨å¯¹å¯¹è±¡è¿›è¡Œæ§åˆ¶çš„é€»è¾‘æ˜¯ä»€ä¹ˆæ ·çš„ A:é€šè¿‡æ§åˆ¶å¾ªç¯å¯¹APIå¯¹è±¡è¿›è¡Œæ§åˆ¶ï¼Œå…¶æ§åˆ¶é€»è¾‘ç”¨ä¼ªä»£ç è¡¨ç¤ºå¦‚ä¸‹ï¼š\nfor { å®é™…çŠ¶æ€ := è·å–é›†ç¾¤ä¸­å¯¹è±¡Xçš„å®é™…çŠ¶æ€ï¼ˆActual Stateï¼‰ æœŸæœ›çŠ¶æ€ := è·å–é›†ç¾¤ä¸­å¯¹è±¡Xçš„æœŸæœ›çŠ¶æ€ï¼ˆDesired Stateï¼‰ if å®é™…çŠ¶æ€ == æœŸæœ›çŠ¶æ€{ ä»€ä¹ˆéƒ½ä¸åš } else { æ‰§è¡Œç¼–æ’åŠ¨ä½œï¼Œå°†å®é™…çŠ¶æ€è°ƒæ•´ä¸ºæœŸæœ›çŠ¶æ€ } } åœ¨å…·ä½“å®ç°æ—¶ï¼Œå®é™…çŠ¶æ€æ¥è‡ªKubernetesæœ¬èº«ï¼Œè€ŒæœŸæœ›çŠ¶æ€æ¥è‡ªç”¨æˆ·æäº¤çš„Yamlæ–‡ä»¶ã€‚è¿™ä¸ªæ“ä½œï¼Œé€šå¸¸è¢«å«ä½œè°ƒè°ï¼ˆReconcileï¼‰ã€‚è¿™ä¸ªè°ƒè°çš„è¿‡ç¨‹ï¼Œåˆ™è¢«ç§°ä½œâ€œReconcile Loopâ€ï¼ˆè°ƒè°å¾ªç¯ï¼‰æˆ–è€…â€œSync Loopâ€ï¼ˆåŒæ­¥å¾ªç¯ï¼‰ã€‚\nQ:å¯¹äºDeploymentï¼Œå…¶åˆ›å»ºå‡ºçš„Podçš„ownerReferenceæ˜¯è°ï¼Œæ˜¯Deploymentæœ¬èº«å— A:Deploymentæ“ä½œçš„æ˜¯ReplicaSetå¯¹è±¡ã€‚åœ¨Podè¿›è¡Œæ°´å¹³ä¼¸ç¼©æ—¶ï¼ŒDeploymentå°±å¯ä»¥å®Œæˆä»»åŠ¡ï¼ˆä½†å…¶å®ä¸æ˜¯è¿™æ ·çš„ï¼Œè¿™é‡Œåªæ˜¯æ¢è®¨ä¸€ç§å¯èƒ½æ€§ï¼‰ï¼›ä½†è¦æƒ³åšåˆ°æ»šåŠ¨æ›´æ–°ï¼Œå…‰æœ‰Deploymentæ˜¯ä¸è¡Œçš„ï¼Œå› ä¸ºDeploymentçš„templateå­—æ®µå†³å®šäº†å…¶åªèƒ½ç®¡ç†ä¸€ç§é…ç½®çš„Podã€‚Deploymentç®¡ç†ReplicaSetï¼ŒReplicaSetç®¡ç†Podï¼Œè¿™æ ·å¦‚æœéœ€è¦è¿›è¡Œæ»šåŠ¨æ›´æ–°ï¼ŒDeploymentåªéœ€åˆ›å»ºæ–°çš„ReplicaSetï¼Œç„¶åé€æ­¥ä¸‹çº¿åŸæœ‰çš„ReplicaSetå³å¯ã€‚ ä¸€ä¸ªåº”ç”¨çš„ç‰ˆæœ¬ï¼Œå¯¹åº”çš„æ­£æ˜¯ä¸€ä¸ªReplicaSetï¼Œè¿™ä¸ªç‰ˆæœ¬åº”ç”¨çš„ Pod æ•°é‡ï¼Œåˆ™ç”± ReplicaSet é€šè¿‡å®ƒè‡ªå·±çš„æ§åˆ¶å™¨ï¼ˆReplicaSet Controllerï¼‰æ¥ä¿è¯ã€‚ è€ŒDeploymentï¼Œå…¶å®å°±æ˜¯å¯¹â€œåº”ç”¨â€çš„æŠ½è±¡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ª Deployment å¯¹è±¡æ¥æè¿°åº”ç”¨ï¼Œä½¿ç”¨ kubectl rollout å‘½ä»¤æ§åˆ¶åº”ç”¨çš„ç‰ˆæœ¬ã€‚\nä½†Deploymentåªé€‚åˆé‚£äº›è¾ƒç®€å•çš„åº”ç”¨ã€‚\n","permalink":"http://yangchnet.github.io/Dessert/posts/_tmp/kuberntes%E4%B9%8Bdeployment/","summary":"Deploymentæ˜¯Kubernetesä¸­çš„ä¸€ä¸ªæ§åˆ¶å™¨ï¼Œè´Ÿè´£å¯¹podè¿›è¡Œæ§åˆ¶\nQ:æ§åˆ¶å™¨å¯¹å¯¹è±¡è¿›è¡Œæ§åˆ¶çš„é€»è¾‘æ˜¯ä»€ä¹ˆæ ·çš„ A:é€šè¿‡æ§åˆ¶å¾ªç¯å¯¹APIå¯¹è±¡è¿›è¡Œæ§åˆ¶ï¼Œå…¶æ§åˆ¶é€»è¾‘ç”¨ä¼ªä»£ç è¡¨ç¤ºå¦‚ä¸‹ï¼š\nfor { å®é™…çŠ¶æ€ := è·å–é›†ç¾¤ä¸­å¯¹è±¡Xçš„å®é™…çŠ¶æ€ï¼ˆActual Stateï¼‰ æœŸæœ›çŠ¶æ€ := è·å–é›†ç¾¤ä¸­å¯¹è±¡Xçš„æœŸæœ›çŠ¶æ€ï¼ˆDesired Stateï¼‰ if å®é™…çŠ¶æ€ == æœŸæœ›çŠ¶æ€{ ä»€ä¹ˆéƒ½ä¸åš } else { æ‰§è¡Œç¼–æ’åŠ¨ä½œï¼Œå°†å®é™…çŠ¶æ€è°ƒæ•´ä¸ºæœŸæœ›çŠ¶æ€ } } åœ¨å…·ä½“å®ç°æ—¶ï¼Œå®é™…çŠ¶æ€æ¥è‡ªKubernetesæœ¬èº«ï¼Œè€ŒæœŸæœ›çŠ¶æ€æ¥è‡ªç”¨æˆ·æäº¤çš„Yamlæ–‡ä»¶ã€‚è¿™ä¸ªæ“ä½œï¼Œé€šå¸¸è¢«å«ä½œè°ƒè°ï¼ˆReconcileï¼‰ã€‚è¿™ä¸ªè°ƒè°çš„è¿‡ç¨‹ï¼Œåˆ™è¢«ç§°ä½œâ€œReconcile Loopâ€ï¼ˆè°ƒè°å¾ªç¯ï¼‰æˆ–è€…â€œSync Loopâ€ï¼ˆåŒæ­¥å¾ªç¯ï¼‰ã€‚\nQ:å¯¹äºDeploymentï¼Œå…¶åˆ›å»ºå‡ºçš„Podçš„ownerReferenceæ˜¯è°ï¼Œæ˜¯Deploymentæœ¬èº«å— A:Deploymentæ“ä½œçš„æ˜¯ReplicaSetå¯¹è±¡ã€‚åœ¨Podè¿›è¡Œæ°´å¹³ä¼¸ç¼©æ—¶ï¼ŒDeploymentå°±å¯ä»¥å®Œæˆä»»åŠ¡ï¼ˆä½†å…¶å®ä¸æ˜¯è¿™æ ·çš„ï¼Œè¿™é‡Œåªæ˜¯æ¢è®¨ä¸€ç§å¯èƒ½æ€§ï¼‰ï¼›ä½†è¦æƒ³åšåˆ°æ»šåŠ¨æ›´æ–°ï¼Œå…‰æœ‰Deploymentæ˜¯ä¸è¡Œçš„ï¼Œå› ä¸ºDeploymentçš„templateå­—æ®µå†³å®šäº†å…¶åªèƒ½ç®¡ç†ä¸€ç§é…ç½®çš„Podã€‚Deploymentç®¡ç†ReplicaSetï¼ŒReplicaSetç®¡ç†Podï¼Œè¿™æ ·å¦‚æœéœ€è¦è¿›è¡Œæ»šåŠ¨æ›´æ–°ï¼ŒDeploymentåªéœ€åˆ›å»ºæ–°çš„ReplicaSetï¼Œç„¶åé€æ­¥ä¸‹çº¿åŸæœ‰çš„ReplicaSetå³å¯ã€‚ ä¸€ä¸ªåº”ç”¨çš„ç‰ˆæœ¬ï¼Œå¯¹åº”çš„æ­£æ˜¯ä¸€ä¸ªReplicaSetï¼Œè¿™ä¸ªç‰ˆæœ¬åº”ç”¨çš„ Pod æ•°é‡ï¼Œåˆ™ç”± ReplicaSet é€šè¿‡å®ƒè‡ªå·±çš„æ§åˆ¶å™¨ï¼ˆReplicaSet Controllerï¼‰æ¥ä¿è¯ã€‚ è€ŒDeploymentï¼Œå…¶å®å°±æ˜¯å¯¹â€œåº”ç”¨â€çš„æŠ½è±¡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ª Deployment å¯¹è±¡æ¥æè¿°åº”ç”¨ï¼Œä½¿ç”¨ kubectl rollout å‘½ä»¤æ§åˆ¶åº”ç”¨çš„ç‰ˆæœ¬ã€‚\nä½†Deploymentåªé€‚åˆé‚£äº›è¾ƒç®€å•çš„åº”ç”¨ã€‚","title":""},{"content":"æœ‰çŠ¶æ€åº”ç”¨ ä»€ä¹ˆæ˜¯æœ‰çŠ¶æ€åº”ç”¨ å®ä¾‹ä¹‹é—´æœ‰ä¸å¯¹ç­‰å…³ç³»ï¼Œä»¥åŠå®ä¾‹å¯¹å¤–éƒ¨æ•°æ®æœ‰ä¾èµ–å…³ç³»çš„åº”ç”¨ï¼Œå°±è¢«ç§°ä¸ºâ€œæœ‰çŠ¶æ€åº”ç”¨â€ï¼ˆStateful Applicationï¼‰\nStatefulSet æŠŠçœŸå®ä¸–ç•Œé‡Œçš„åº”ç”¨çŠ¶æ€ï¼ŒæŠ½è±¡ä¸ºäº†ä¸¤ç§æƒ…å†µï¼š\n æ‹“æ‰‘çŠ¶æ€ã€‚è¿™ç§æƒ…å†µæ„å‘³ç€ï¼Œåº”ç”¨çš„å¤šä¸ªå®ä¾‹ä¹‹é—´ä¸æ˜¯å®Œå…¨å¯¹ç­‰çš„å…³ç³»ã€‚è¿™äº›åº”ç”¨å®ä¾‹ï¼Œå¿…é¡»æŒ‰ç…§æŸäº›é¡ºåºå¯åŠ¨ï¼Œæ¯”å¦‚åº”ç”¨çš„ä¸»èŠ‚ç‚¹ A è¦å…ˆäºä»èŠ‚ç‚¹ B å¯åŠ¨ã€‚è€Œå¦‚æœä½ æŠŠ A å’Œ B ä¸¤ä¸ª Pod åˆ é™¤æ‰ï¼Œå®ƒä»¬å†æ¬¡è¢«åˆ›å»ºå‡ºæ¥æ—¶ä¹Ÿå¿…é¡»ä¸¥æ ¼æŒ‰ç…§è¿™ä¸ªé¡ºåºæ‰è¡Œã€‚å¹¶ä¸”ï¼Œæ–°åˆ›å»ºå‡ºæ¥çš„ Podï¼Œå¿…é¡»å’ŒåŸæ¥ Pod çš„ç½‘ç»œæ ‡è¯†ä¸€æ ·ï¼Œè¿™æ ·åŸå…ˆçš„è®¿é—®è€…æ‰èƒ½ä½¿ç”¨åŒæ ·çš„æ–¹æ³•ï¼Œè®¿é—®åˆ°è¿™ä¸ªæ–° Podã€‚ å­˜å‚¨çŠ¶æ€ã€‚è¿™ç§æƒ…å†µæ„å‘³ç€ï¼Œåº”ç”¨çš„å¤šä¸ªå®ä¾‹åˆ†åˆ«ç»‘å®šäº†ä¸åŒçš„å­˜å‚¨æ•°æ®ã€‚å¯¹äºè¿™äº›åº”ç”¨å®ä¾‹æ¥è¯´ï¼ŒPod A ç¬¬ä¸€æ¬¡è¯»å–åˆ°çš„æ•°æ®ï¼Œå’Œéš”äº†ååˆ†é’Ÿä¹‹åå†æ¬¡è¯»å–åˆ°çš„æ•°æ®ï¼Œåº”è¯¥æ˜¯åŒä¸€ä»½ï¼Œå“ªæ€•åœ¨æ­¤æœŸé—´ Pod A è¢«é‡æ–°åˆ›å»ºè¿‡ã€‚è¿™ç§æƒ…å†µæœ€å…¸å‹çš„ä¾‹å­ï¼Œå°±æ˜¯ä¸€ä¸ªæ•°æ®åº“åº”ç”¨çš„å¤šä¸ªå­˜å‚¨å®ä¾‹ã€‚  StatefulSet çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œå°±æ˜¯é€šè¿‡æŸç§æ–¹å¼è®°å½•è¿™äº›çŠ¶æ€ï¼Œç„¶ååœ¨ Pod è¢«é‡æ–°åˆ›å»ºæ—¶ï¼Œèƒ½å¤Ÿä¸ºæ–° Pod æ¢å¤è¿™äº›çŠ¶æ€ã€‚\nQ: StatefulSet å¦‚ä½•ä¿è¯åº”ç”¨å®ä¾‹ä¹‹é—´â€œæ‹“æ‰‘çŠ¶æ€â€çš„ç¨³å®šæ€§ A: StatefulSet è¿™ä¸ªæ§åˆ¶å™¨çš„ä¸»è¦ä½œç”¨ä¹‹ä¸€ï¼Œå°±æ˜¯ä½¿ç”¨ Pod æ¨¡æ¿åˆ›å»º Pod çš„æ—¶å€™ï¼Œå¯¹å®ƒä»¬è¿›è¡Œç¼–å·ï¼Œå¹¶ä¸”æŒ‰ç…§ç¼–å·é¡ºåºé€ä¸€å®Œæˆåˆ›å»ºå·¥ä½œã€‚è€Œå½“ StatefulSet çš„â€œæ§åˆ¶å¾ªç¯â€å‘ç° Pod çš„â€œå®é™…çŠ¶æ€â€ä¸â€œæœŸæœ›çŠ¶æ€â€ä¸ä¸€è‡´ï¼Œéœ€è¦æ–°å»ºæˆ–è€…åˆ é™¤ Pod è¿›è¡Œâ€œè°ƒè°â€çš„æ—¶å€™ï¼Œå®ƒä¼šä¸¥æ ¼æŒ‰ç…§è¿™äº› Pod ç¼–å·çš„é¡ºåºï¼Œé€ä¸€å®Œæˆè¿™äº›æ“ä½œã€‚\nQ: StatefulSetå¦‚ä½•å®ç°å¯¹å­˜å‚¨çŠ¶æ€çš„ç®¡ç† A: PVCã€PV çš„è®¾è®¡ï¼Œä¹Ÿä½¿å¾— StatefulSet å¯¹å­˜å‚¨çŠ¶æ€çš„ç®¡ç†æˆä¸ºäº†å¯èƒ½ã€‚åœ¨å®šä¹‰äº†PVCçš„StatefulSetè¢«åˆ›å»ºåï¼ŒKubernetesä¼šåˆ›å»ºåä¸º\u0026lt;PVC åå­— \u0026gt;-\u0026lt;StatefulSet åå­— \u0026gt;-\u0026lt; ç¼–å· \u0026gt;çš„PVCï¼Œå¹¶å°†è¿™äº›PVCç»‘å®šåˆ°Podä¸Šã€‚å½“Podè¢«åˆ é™¤é‡å»ºåï¼Œä¾ç„¶ä¼šç»‘å®šåˆ°è¿™ä¸ªPVCä¸Šï¼Œè¿™æ ·ï¼Œå°±æ¢å¤äº†åŸæ¥çš„çŠ¶æ€ã€‚\nQ: StatefulSetæ¢å¤Podçš„è¿‡ç¨‹ A:\n å½“ä¸€ä¸ª Pod ï¼ˆä¾‹å¦‚è¿™ä¸ªPodå«åšweb-0, å®ƒå£°æ˜ä½¿ç”¨çš„ PVC çš„åå­—ï¼Œæ˜¯å«ä½œï¼šwww-web-0ï¼‰è¢«åˆ é™¤ä¹‹åï¼Œè¿™ä¸ª Pod å¯¹åº”çš„ PVC å’Œ PVï¼Œå¹¶ä¸ä¼šè¢«åˆ é™¤ï¼Œè€Œè¿™ä¸ª Volume é‡Œå·²ç»å†™å…¥çš„æ•°æ®ï¼Œä¹Ÿä¾ç„¶ä¼šä¿å­˜åœ¨è¿œç¨‹å­˜å‚¨æœåŠ¡é‡Œã€‚ StatefulSet æ§åˆ¶å™¨å‘ç°ï¼Œweb-0 è¿™ä¸ªPod æ¶ˆå¤±äº†ã€‚æ‰€ä»¥ï¼Œæ§åˆ¶å™¨å°±ä¼šé‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„ã€åå­—è¿˜æ˜¯å«ä½œ web-0 çš„ Pod æ¥ï¼Œâ€œçº æ­£â€è¿™ä¸ªä¸ä¸€è‡´çš„æƒ…å†µã€‚ Kubernetes ä¸ºé‡å»ºçš„web-0 PodæŸ¥æ‰¾åå« www-web-0 çš„ PVCï¼Œç›´æ¥æ‰¾åˆ°æ—§ Pod é—ç•™ä¸‹æ¥çš„åŒåçš„ PVCï¼Œè¿›è€Œæ‰¾åˆ°è·Ÿè¿™ä¸ª PVC ç»‘å®šåœ¨ä¸€èµ·çš„ PVã€‚ æ–°çš„ Pod å°±å¯ä»¥æŒ‚è½½åˆ°æ—§ Pod å¯¹åº”çš„é‚£ä¸ª Volumeï¼Œå¹¶ä¸”è·å–åˆ°ä¿å­˜åœ¨ Volume é‡Œçš„æ•°æ®ã€‚  Q: StatefulSetæ˜¯å¦‚ä½•è§£å†³æ‹“æ‰‘çŠ¶æ€ä¸å­˜å‚¨çŠ¶æ€è¿™ä¸¤ä¸ªé—®é¢˜çš„ï¼Ÿ A:\n é¦–å…ˆï¼ŒStatefulSet çš„æ§åˆ¶å™¨ç›´æ¥ç®¡ç†çš„æ˜¯ Podã€‚è¿™æ˜¯å› ä¸ºï¼ŒStatefulSet é‡Œçš„ä¸åŒ Pod å®ä¾‹ï¼Œä¸å†åƒ ReplicaSet ä¸­é‚£æ ·éƒ½æ˜¯å®Œå…¨ä¸€æ ·çš„ï¼Œè€Œæ˜¯æœ‰äº†ç»†å¾®åŒºåˆ«çš„ã€‚æ¯”å¦‚ï¼Œæ¯ä¸ª Pod çš„ hostnameã€åå­—ç­‰éƒ½æ˜¯ä¸åŒçš„ã€æºå¸¦äº†ç¼–å·çš„ã€‚è€Œ StatefulSet åŒºåˆ†è¿™äº›å®ä¾‹çš„æ–¹å¼ï¼Œå°±æ˜¯é€šè¿‡åœ¨ Pod çš„åå­—é‡ŒåŠ ä¸Šäº‹å…ˆçº¦å®šå¥½çš„ç¼–å·ã€‚ å…¶æ¬¡ï¼ŒKubernetes é€šè¿‡ Headless Serviceï¼Œä¸ºè¿™äº›æœ‰ç¼–å·çš„ Podï¼Œåœ¨ DNS æœåŠ¡å™¨ä¸­ç”Ÿæˆå¸¦æœ‰åŒæ ·ç¼–å·çš„ DNS è®°å½•ã€‚åªè¦ StatefulSet èƒ½å¤Ÿä¿è¯è¿™äº› Pod åå­—é‡Œçš„ç¼–å·ä¸å˜ï¼Œé‚£ä¹ˆ Service é‡Œç±»ä¼¼äº web-0.nginx.default.svc.cluster.local è¿™æ ·çš„ DNS è®°å½•ä¹Ÿå°±ä¸ä¼šå˜ï¼Œè€Œè¿™æ¡è®°å½•è§£æå‡ºæ¥çš„ Pod çš„ IP åœ°å€ï¼Œåˆ™ä¼šéšç€åç«¯ Pod çš„åˆ é™¤å’Œå†åˆ›å»ºè€Œè‡ªåŠ¨æ›´æ–°ã€‚è¿™å½“ç„¶æ˜¯ Service æœºåˆ¶æœ¬èº«çš„èƒ½åŠ›ï¼Œä¸éœ€è¦ StatefulSet æ“å¿ƒã€‚ æœ€åï¼ŒStatefulSet è¿˜ä¸ºæ¯ä¸€ä¸ª Pod åˆ†é…å¹¶åˆ›å»ºä¸€ä¸ªåŒæ ·ç¼–å·çš„ PVCã€‚è¿™æ ·ï¼ŒKubernetes å°±å¯ä»¥é€šè¿‡ Persistent Volume æœºåˆ¶ä¸ºè¿™ä¸ª PVC ç»‘å®šä¸Šå¯¹åº”çš„ PVï¼Œä»è€Œä¿è¯äº†æ¯ä¸€ä¸ª Pod éƒ½æ‹¥æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ Volumeã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå³ä½¿ Pod è¢«åˆ é™¤ï¼Œå®ƒæ‰€å¯¹åº”çš„ PVC å’Œ PV ä¾ç„¶ä¼šä¿ç•™ä¸‹æ¥ã€‚æ‰€ä»¥å½“è¿™ä¸ª Pod è¢«é‡æ–°åˆ›å»ºå‡ºæ¥ä¹‹åï¼ŒKubernetes ä¼šä¸ºå®ƒæ‰¾åˆ°åŒæ ·ç¼–å·çš„ PVCï¼ŒæŒ‚è½½è¿™ä¸ª PVC å¯¹åº”çš„ Volumeï¼Œä»è€Œè·å–åˆ°ä»¥å‰ä¿å­˜åœ¨ Volume é‡Œçš„æ•°æ®ã€‚  ","permalink":"http://yangchnet.github.io/Dessert/posts/_tmp/kuberntets%E4%B9%8Bstatefulset/","summary":"æœ‰çŠ¶æ€åº”ç”¨ ä»€ä¹ˆæ˜¯æœ‰çŠ¶æ€åº”ç”¨ å®ä¾‹ä¹‹é—´æœ‰ä¸å¯¹ç­‰å…³ç³»ï¼Œä»¥åŠå®ä¾‹å¯¹å¤–éƒ¨æ•°æ®æœ‰ä¾èµ–å…³ç³»çš„åº”ç”¨ï¼Œå°±è¢«ç§°ä¸ºâ€œæœ‰çŠ¶æ€åº”ç”¨â€ï¼ˆStateful Applicationï¼‰\nStatefulSet æŠŠçœŸå®ä¸–ç•Œé‡Œçš„åº”ç”¨çŠ¶æ€ï¼ŒæŠ½è±¡ä¸ºäº†ä¸¤ç§æƒ…å†µï¼š\n æ‹“æ‰‘çŠ¶æ€ã€‚è¿™ç§æƒ…å†µæ„å‘³ç€ï¼Œåº”ç”¨çš„å¤šä¸ªå®ä¾‹ä¹‹é—´ä¸æ˜¯å®Œå…¨å¯¹ç­‰çš„å…³ç³»ã€‚è¿™äº›åº”ç”¨å®ä¾‹ï¼Œå¿…é¡»æŒ‰ç…§æŸäº›é¡ºåºå¯åŠ¨ï¼Œæ¯”å¦‚åº”ç”¨çš„ä¸»èŠ‚ç‚¹ A è¦å…ˆäºä»èŠ‚ç‚¹ B å¯åŠ¨ã€‚è€Œå¦‚æœä½ æŠŠ A å’Œ B ä¸¤ä¸ª Pod åˆ é™¤æ‰ï¼Œå®ƒä»¬å†æ¬¡è¢«åˆ›å»ºå‡ºæ¥æ—¶ä¹Ÿå¿…é¡»ä¸¥æ ¼æŒ‰ç…§è¿™ä¸ªé¡ºåºæ‰è¡Œã€‚å¹¶ä¸”ï¼Œæ–°åˆ›å»ºå‡ºæ¥çš„ Podï¼Œå¿…é¡»å’ŒåŸæ¥ Pod çš„ç½‘ç»œæ ‡è¯†ä¸€æ ·ï¼Œè¿™æ ·åŸå…ˆçš„è®¿é—®è€…æ‰èƒ½ä½¿ç”¨åŒæ ·çš„æ–¹æ³•ï¼Œè®¿é—®åˆ°è¿™ä¸ªæ–° Podã€‚ å­˜å‚¨çŠ¶æ€ã€‚è¿™ç§æƒ…å†µæ„å‘³ç€ï¼Œåº”ç”¨çš„å¤šä¸ªå®ä¾‹åˆ†åˆ«ç»‘å®šäº†ä¸åŒçš„å­˜å‚¨æ•°æ®ã€‚å¯¹äºè¿™äº›åº”ç”¨å®ä¾‹æ¥è¯´ï¼ŒPod A ç¬¬ä¸€æ¬¡è¯»å–åˆ°çš„æ•°æ®ï¼Œå’Œéš”äº†ååˆ†é’Ÿä¹‹åå†æ¬¡è¯»å–åˆ°çš„æ•°æ®ï¼Œåº”è¯¥æ˜¯åŒä¸€ä»½ï¼Œå“ªæ€•åœ¨æ­¤æœŸé—´ Pod A è¢«é‡æ–°åˆ›å»ºè¿‡ã€‚è¿™ç§æƒ…å†µæœ€å…¸å‹çš„ä¾‹å­ï¼Œå°±æ˜¯ä¸€ä¸ªæ•°æ®åº“åº”ç”¨çš„å¤šä¸ªå­˜å‚¨å®ä¾‹ã€‚  StatefulSet çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œå°±æ˜¯é€šè¿‡æŸç§æ–¹å¼è®°å½•è¿™äº›çŠ¶æ€ï¼Œç„¶ååœ¨ Pod è¢«é‡æ–°åˆ›å»ºæ—¶ï¼Œèƒ½å¤Ÿä¸ºæ–° Pod æ¢å¤è¿™äº›çŠ¶æ€ã€‚\nQ: StatefulSet å¦‚ä½•ä¿è¯åº”ç”¨å®ä¾‹ä¹‹é—´â€œæ‹“æ‰‘çŠ¶æ€â€çš„ç¨³å®šæ€§ A: StatefulSet è¿™ä¸ªæ§åˆ¶å™¨çš„ä¸»è¦ä½œç”¨ä¹‹ä¸€ï¼Œå°±æ˜¯ä½¿ç”¨ Pod æ¨¡æ¿åˆ›å»º Pod çš„æ—¶å€™ï¼Œå¯¹å®ƒä»¬è¿›è¡Œç¼–å·ï¼Œå¹¶ä¸”æŒ‰ç…§ç¼–å·é¡ºåºé€ä¸€å®Œæˆåˆ›å»ºå·¥ä½œã€‚è€Œå½“ StatefulSet çš„â€œæ§åˆ¶å¾ªç¯â€å‘ç° Pod çš„â€œå®é™…çŠ¶æ€â€ä¸â€œæœŸæœ›çŠ¶æ€â€ä¸ä¸€è‡´ï¼Œéœ€è¦æ–°å»ºæˆ–è€…åˆ é™¤ Pod è¿›è¡Œâ€œè°ƒè°â€çš„æ—¶å€™ï¼Œå®ƒä¼šä¸¥æ ¼æŒ‰ç…§è¿™äº› Pod ç¼–å·çš„é¡ºåºï¼Œé€ä¸€å®Œæˆè¿™äº›æ“ä½œã€‚\nQ: StatefulSetå¦‚ä½•å®ç°å¯¹å­˜å‚¨çŠ¶æ€çš„ç®¡ç† A: PVCã€PV çš„è®¾è®¡ï¼Œä¹Ÿä½¿å¾— StatefulSet å¯¹å­˜å‚¨çŠ¶æ€çš„ç®¡ç†æˆä¸ºäº†å¯èƒ½ã€‚åœ¨å®šä¹‰äº†PVCçš„StatefulSetè¢«åˆ›å»ºåï¼ŒKubernetesä¼šåˆ›å»ºåä¸º\u0026lt;PVC åå­— \u0026gt;-\u0026lt;StatefulSet åå­— \u0026gt;-\u0026lt; ç¼–å· \u0026gt;çš„PVCï¼Œå¹¶å°†è¿™äº›PVCç»‘å®šåˆ°Podä¸Šã€‚å½“Podè¢«åˆ é™¤é‡å»ºåï¼Œä¾ç„¶ä¼šç»‘å®šåˆ°è¿™ä¸ªPVCä¸Šï¼Œè¿™æ ·ï¼Œå°±æ¢å¤äº†åŸæ¥çš„çŠ¶æ€ã€‚\nQ: StatefulSetæ¢å¤Podçš„è¿‡ç¨‹ A:\n å½“ä¸€ä¸ª Pod ï¼ˆä¾‹å¦‚è¿™ä¸ªPodå«åšweb-0, å®ƒå£°æ˜ä½¿ç”¨çš„ PVC çš„åå­—ï¼Œæ˜¯å«ä½œï¼šwww-web-0ï¼‰è¢«åˆ é™¤ä¹‹åï¼Œè¿™ä¸ª Pod å¯¹åº”çš„ PVC å’Œ PVï¼Œå¹¶ä¸ä¼šè¢«åˆ é™¤ï¼Œè€Œè¿™ä¸ª Volume é‡Œå·²ç»å†™å…¥çš„æ•°æ®ï¼Œä¹Ÿä¾ç„¶ä¼šä¿å­˜åœ¨è¿œç¨‹å­˜å‚¨æœåŠ¡é‡Œã€‚ StatefulSet æ§åˆ¶å™¨å‘ç°ï¼Œweb-0 è¿™ä¸ªPod æ¶ˆå¤±äº†ã€‚æ‰€ä»¥ï¼Œæ§åˆ¶å™¨å°±ä¼šé‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„ã€åå­—è¿˜æ˜¯å«ä½œ web-0 çš„ Pod æ¥ï¼Œâ€œçº æ­£â€è¿™ä¸ªä¸ä¸€è‡´çš„æƒ…å†µã€‚ Kubernetes ä¸ºé‡å»ºçš„web-0 PodæŸ¥æ‰¾åå« www-web-0 çš„ PVCï¼Œç›´æ¥æ‰¾åˆ°æ—§ Pod é—ç•™ä¸‹æ¥çš„åŒåçš„ PVCï¼Œè¿›è€Œæ‰¾åˆ°è·Ÿè¿™ä¸ª PVC ç»‘å®šåœ¨ä¸€èµ·çš„ PVã€‚ æ–°çš„ Pod å°±å¯ä»¥æŒ‚è½½åˆ°æ—§ Pod å¯¹åº”çš„é‚£ä¸ª Volumeï¼Œå¹¶ä¸”è·å–åˆ°ä¿å­˜åœ¨ Volume é‡Œçš„æ•°æ®ã€‚  Q: StatefulSetæ˜¯å¦‚ä½•è§£å†³æ‹“æ‰‘çŠ¶æ€ä¸å­˜å‚¨çŠ¶æ€è¿™ä¸¤ä¸ªé—®é¢˜çš„ï¼Ÿ A:","title":""},{"content":"PVä¸PVC PV ï¼ˆPersistent Volumeï¼‰æè¿°çš„ï¼Œæ˜¯æŒä¹…åŒ–å­˜å‚¨æ•°æ®å·ã€‚è¿™ä¸ª API å¯¹è±¡ä¸»è¦å®šä¹‰çš„æ˜¯ä¸€ä¸ªæŒä¹…åŒ–å­˜å‚¨åœ¨å®¿ä¸»æœºä¸Šçš„ç›®å½•ï¼Œæ¯”å¦‚ä¸€ä¸ª NFS çš„æŒ‚è½½ç›®å½•ã€‚\nè€Œ PVC ï¼ˆPersistent Volume Claimï¼‰æè¿°çš„ï¼Œåˆ™æ˜¯ Pod æ‰€å¸Œæœ›ä½¿ç”¨çš„æŒä¹…åŒ–å­˜å‚¨çš„å±æ€§ã€‚æ¯”å¦‚ï¼ŒVolume å­˜å‚¨çš„å¤§å°ã€å¯è¯»å†™æƒé™ç­‰ç­‰ã€‚\nPVCæ˜¯å’ŒPVé…åˆä½¿ç”¨çš„ã€‚åœ¨æ™®é€šå¼€å‘äººå‘˜éœ€è¦ä½¿ç”¨å­˜å‚¨æ—¶ï¼Œä»–ä¸çŸ¥é“K8sä¸­åˆ°åº•æœ‰é‚£äº›å­˜å‚¨ç©ºé—´å¯ä»¥ä½¿ç”¨ï¼Œä¹Ÿä¸éœ€è¦çŸ¥é“ã€‚ä»–æ‰€éœ€è¦åšçš„ï¼Œä»…ä»…ï¼š1. å®šä¹‰ä¸€ä¸ª PVCï¼Œå£°æ˜æƒ³è¦çš„ Volume çš„å±æ€§ï¼š2. åœ¨åº”ç”¨çš„Podä¸­ï¼Œå£°æ˜ä½¿ç”¨è¿™ä¸ªPVCã€‚\nPVä¸PVCçš„å…³ç³»ç±»ä¼¼äºæ¥å£ä¸æ¥å£çš„å®ç°ï¼Œå¼€å‘äººå‘˜åªéœ€ä½¿ç”¨æ¥å£å³å¯ï¼Œè€Œä¸ç”¨å…³å¿ƒæ¥å£çš„å…·ä½“å®ç°ï¼Œè€Œæ¥å£çš„å®ç°ï¼ˆå³å­˜å‚¨å¯¹è±¡çš„å…·ä½“å®šä¹‰ï¼‰ç”±è¿ç»´äººå‘˜å®Œæˆã€‚è¿™ç§è§£è€¦ï¼Œå°±é¿å…äº†å› ä¸ºå‘å¼€å‘è€…æš´éœ²è¿‡å¤šçš„å­˜å‚¨ç³»ç»Ÿç»†èŠ‚è€Œå¸¦æ¥çš„éšæ‚£ã€‚æ­¤å¤–ï¼Œè¿™ç§èŒè´£çš„åˆ†ç¦»ï¼Œå¾€å¾€ä¹Ÿæ„å‘³ç€å‡ºç°äº‹æ•…æ—¶å¯ä»¥æ›´å®¹æ˜“å®šä½é—®é¢˜å’Œæ˜ç¡®è´£ä»»ï¼Œä»è€Œé¿å…â€œæ‰¯çš®â€ç°è±¡çš„å‡ºç°ã€‚\nç”¨æˆ·åˆ›å»ºçš„ PVC è¦çœŸæ­£è¢«å®¹å™¨ä½¿ç”¨èµ·æ¥ï¼Œå°±å¿…é¡»å…ˆå’ŒæŸä¸ªç¬¦åˆæ¡ä»¶çš„ PV è¿›è¡Œç»‘å®šã€‚è¿™é‡Œè¦æ£€æŸ¥çš„æ¡ä»¶ï¼ŒåŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼š\n  ç¬¬ä¸€ä¸ªæ¡ä»¶ï¼Œå½“ç„¶æ˜¯ PV å’Œ PVC çš„ spec å­—æ®µã€‚æ¯”å¦‚ï¼ŒPV çš„å­˜å‚¨ï¼ˆstorageï¼‰å¤§å°ï¼Œå°±å¿…é¡»æ»¡è¶³ PVC çš„è¦æ±‚ã€‚\n  è€Œç¬¬äºŒä¸ªæ¡ä»¶ï¼Œåˆ™æ˜¯ PV å’Œ PVC çš„ storageClassName å­—æ®µå¿…é¡»ä¸€æ ·ã€‚\n  PVä¸PVCæ˜¯å¦‚ä½•ç»‘å®šçš„ åœ¨ Kubernetes ä¸­ï¼Œå­˜åœ¨ä¸€ä¸ªä¸“é—¨å¤„ç†æŒä¹…åŒ–å­˜å‚¨çš„æ§åˆ¶å™¨ï¼Œå«ä½œ Volume Controllerã€‚è¿™ä¸ª Volume Controller ç»´æŠ¤ç€å¤šä¸ªæ§åˆ¶å¾ªç¯ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªå¾ªç¯ï¼Œæ‰®æ¼”çš„å°±æ˜¯æ’®åˆ PV å’Œ PVC çš„â€œçº¢å¨˜â€çš„è§’è‰²ã€‚å®ƒçš„åå­—å«ä½œ PersistentVolumeControllerã€‚\nPersistentVolumeController ä¼šä¸æ–­åœ°æŸ¥çœ‹å½“å‰æ¯ä¸€ä¸ª PVCï¼Œæ˜¯ä¸æ˜¯å·²ç»å¤„äº Boundï¼ˆå·²ç»‘å®šï¼‰çŠ¶æ€ã€‚å¦‚æœä¸æ˜¯ï¼Œé‚£å®ƒå°±ä¼šéå†æ‰€æœ‰çš„ã€å¯ç”¨çš„ PVï¼Œå¹¶å°è¯•å°†å…¶ä¸è¿™ä¸ªâ€œå•èº«â€çš„ PVC è¿›è¡Œç»‘å®šã€‚è¿™æ ·ï¼ŒKubernetes å°±å¯ä»¥ä¿è¯ç”¨æˆ·æäº¤çš„æ¯ä¸€ä¸ª PVCï¼Œåªè¦æœ‰åˆé€‚çš„ PV å‡ºç°ï¼Œå®ƒå°±èƒ½å¤Ÿå¾ˆå¿«è¿›å…¥ç»‘å®šçŠ¶æ€ï¼Œä»è€Œç»“æŸâ€œå•èº«â€ä¹‹æ—…ã€‚\nè€Œæ‰€è°“å°†ä¸€ä¸ª PV ä¸ PVC è¿›è¡Œâ€œç»‘å®šâ€ï¼Œå…¶å®å°±æ˜¯å°†è¿™ä¸ª PV å¯¹è±¡çš„åå­—ï¼Œå¡«åœ¨äº† PVC å¯¹è±¡çš„ spec.volumeName å­—æ®µä¸Šã€‚æ‰€ä»¥ï¼Œæ¥ä¸‹æ¥ Kubernetes åªè¦è·å–åˆ°è¿™ä¸ª PVC å¯¹è±¡ï¼Œå°±ä¸€å®šèƒ½å¤Ÿæ‰¾åˆ°å®ƒæ‰€ç»‘å®šçš„ PVã€‚\nå®¹å™¨çš„æŒä¹…åŒ–å­˜å‚¨ å®¹å™¨çš„æŒä¹…åŒ–å­˜å‚¨ï¼Œæ˜¯é€šè¿‡ä¸ºå®¹å™¨æŒ‚è½½â€œæŒä¹…åŒ–volumeâ€å®ç°çš„ã€‚\næ‰€è°“å®¹å™¨çš„ Volumeï¼Œå…¶å®å°±æ˜¯å°†ä¸€ä¸ªå®¿ä¸»æœºä¸Šçš„ç›®å½•ï¼Œè·Ÿä¸€ä¸ªå®¹å™¨é‡Œçš„ç›®å½•ç»‘å®šæŒ‚è½½åœ¨äº†ä¸€èµ·ã€‚è€Œæ‰€è°“çš„â€œæŒä¹…åŒ– Volumeâ€ï¼ŒæŒ‡çš„å°±æ˜¯è¿™ä¸ªå®¿ä¸»æœºä¸Šçš„ç›®å½•ï¼Œå…·å¤‡â€œæŒä¹…æ€§â€ã€‚å³ï¼šè¿™ä¸ªç›®å½•é‡Œé¢çš„å†…å®¹ï¼Œæ—¢ä¸ä¼šå› ä¸ºå®¹å™¨çš„åˆ é™¤è€Œè¢«æ¸…ç†æ‰ï¼Œä¹Ÿä¸ä¼šè·Ÿå½“å‰çš„å®¿ä¸»æœºç»‘å®šã€‚è¿™æ ·ï¼Œå½“å®¹å™¨è¢«é‡å¯æˆ–è€…åœ¨å…¶ä»–èŠ‚ç‚¹ä¸Šé‡å»ºå‡ºæ¥ä¹‹åï¼Œå®ƒä»ç„¶èƒ½å¤Ÿé€šè¿‡æŒ‚è½½è¿™ä¸ª Volumeï¼Œè®¿é—®åˆ°è¿™äº›å†…å®¹ã€‚\nå¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒæŒä¹…åŒ– Volume çš„å®ç°ï¼Œå¾€å¾€ä¾èµ–äºä¸€ä¸ªè¿œç¨‹å­˜å‚¨æœåŠ¡ï¼Œæ¯”å¦‚ï¼šè¿œç¨‹æ–‡ä»¶å­˜å‚¨ï¼ˆæ¯”å¦‚ï¼ŒNFSã€GlusterFSï¼‰ã€è¿œç¨‹å—å­˜å‚¨ï¼ˆæ¯”å¦‚ï¼Œå…¬æœ‰äº‘æä¾›çš„è¿œç¨‹ç£ç›˜ï¼‰ç­‰ç­‰ã€‚\nKubernetesåˆ¶å¤‡PVçš„è¿‡ç¨‹ è€Œ Kubernetes éœ€è¦åšçš„å·¥ä½œï¼Œå°±æ˜¯ä½¿ç”¨è¿™äº›å­˜å‚¨æœåŠ¡ï¼Œæ¥ä¸ºå®¹å™¨å‡†å¤‡ä¸€ä¸ªæŒä¹…åŒ–çš„å®¿ä¸»æœºç›®å½•ï¼Œä»¥ä¾›å°†æ¥è¿›è¡Œç»‘å®šæŒ‚è½½æ—¶ä½¿ç”¨ã€‚è€Œæ‰€è°“â€œæŒä¹…åŒ–â€ï¼ŒæŒ‡çš„æ˜¯å®¹å™¨åœ¨è¿™ä¸ªç›®å½•é‡Œå†™å…¥çš„æ–‡ä»¶ï¼Œéƒ½ä¼šä¿å­˜åœ¨è¿œç¨‹å­˜å‚¨ä¸­ï¼Œä»è€Œä½¿å¾—è¿™ä¸ªç›®å½•å…·å¤‡äº†â€œæŒä¹…æ€§â€ã€‚\nè¿™ä¸ªå‡†å¤‡â€œæŒä¹…åŒ–â€å®¿ä¸»æœºç›®å½•çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥å½¢è±¡åœ°ç§°ä¸ºâ€œä¸¤é˜¶æ®µå¤„ç†â€ã€‚\nç¬¬ä¸€é˜¶æ®µç§°ä¸ºAttachï¼Œå³â€œæŒ‚è½½â€ã€‚è¿™ä¸ªé˜¶æ®µï¼ŒKubernetes ä¼šè°ƒç”¨è¿œç¨‹å­˜å‚¨æœåŠ¡çš„ APIï¼Œæ¥ä¸ºå®¹å™¨å‡†å¤‡ä¸€ä¸ªâ€œæŒä¹…åŒ–â€ç›®å½•ã€‚è¿™ä¸ªç›®å½•ï¼Œä¼šè¢«æŒ‚è½½åˆ°å®¿ä¸»æœºä¸Šçš„æŸä¸ªç›®å½•ä¸Šï¼Œæ¯”å¦‚ /var/lib/kubelet/pods/xxxx/volumes/kubernetes.io~nfs/pvc-xxxxã€‚è¿™ä¸ªç›®å½•ï¼Œå°±æ˜¯ Kubernetes ä¸ºå®¹å™¨å‡†å¤‡çš„â€œæŒä¹…åŒ–â€ç›®å½•ã€‚\nAttach é˜¶æ®µå®Œæˆåï¼Œä¸ºäº†èƒ½å¤Ÿä½¿ç”¨è¿™ä¸ªè¿œç¨‹ç£ç›˜ï¼Œkubelet è¿˜è¦è¿›è¡Œç¬¬äºŒä¸ªæ“ä½œï¼Œå³ï¼šæ ¼å¼åŒ–è¿™ä¸ªç£ç›˜è®¾å¤‡ï¼Œç„¶åå°†å®ƒæŒ‚è½½åˆ°å®¿ä¸»æœºæŒ‡å®šçš„æŒ‚è½½ç‚¹ä¸Šã€‚è¿™ä¸ªå°†ç£ç›˜è®¾å¤‡æ ¼å¼åŒ–å¹¶æŒ‚è½½åˆ° Volume å®¿ä¸»æœºç›®å½•çš„æ“ä½œï¼Œå¯¹åº”çš„æ­£æ˜¯â€œä¸¤é˜¶æ®µå¤„ç†â€çš„ç¬¬äºŒä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬ä¸€èˆ¬ç§°ä¸ºï¼šMountã€‚\nDynamic Provisioningæœºåˆ¶ Dynamic Provisioningæœºåˆ¶ç”¨æ¥è‡ªåŠ¨åˆ›å»ºPVã€‚è¿™ä¸ªæœºåˆ¶å·¥ä½œçš„æ ¸å¿ƒï¼Œåœ¨äºä¸€ä¸ªå«åšStorageClassçš„APIå¯¹è±¡ã€‚\nè€Œ StorageClass å¯¹è±¡çš„ä½œç”¨ï¼Œå…¶å®å°±æ˜¯åˆ›å»º PV çš„æ¨¡æ¿ã€‚å…·ä½“åœ°è¯´ï¼ŒStorageClass å¯¹è±¡ä¼šå®šä¹‰å¦‚ä¸‹ä¸¤ä¸ªéƒ¨åˆ†å†…å®¹ï¼š\n ç¬¬ä¸€ï¼ŒPV çš„å±æ€§ã€‚æ¯”å¦‚ï¼Œå­˜å‚¨ç±»å‹ã€Volume çš„å¤§å°ç­‰ç­‰ã€‚ ç¬¬äºŒï¼Œåˆ›å»ºè¿™ç§ PV éœ€è¦ç”¨åˆ°çš„å­˜å‚¨æ’ä»¶ã€‚æ¯”å¦‚ï¼ŒCeph ç­‰ç­‰ã€‚  æœ‰äº†è¿™æ ·ä¸¤ä¸ªä¿¡æ¯ä¹‹åï¼ŒKubernetes å°±èƒ½å¤Ÿæ ¹æ®ç”¨æˆ·æäº¤çš„ PVCï¼Œæ‰¾åˆ°ä¸€ä¸ªå¯¹åº”çš„ StorageClass äº†ã€‚ç„¶åï¼ŒKubernetes å°±ä¼šè°ƒç”¨è¯¥ StorageClass å£°æ˜çš„å­˜å‚¨æ’ä»¶ï¼Œåˆ›å»ºå‡ºéœ€è¦çš„ PVã€‚\n","permalink":"http://yangchnet.github.io/Dessert/posts/_tmp/t-kubernetes%E4%B9%8B%E5%AD%98%E5%82%A8/","summary":"PVä¸PVC PV ï¼ˆPersistent Volumeï¼‰æè¿°çš„ï¼Œæ˜¯æŒä¹…åŒ–å­˜å‚¨æ•°æ®å·ã€‚è¿™ä¸ª API å¯¹è±¡ä¸»è¦å®šä¹‰çš„æ˜¯ä¸€ä¸ªæŒä¹…åŒ–å­˜å‚¨åœ¨å®¿ä¸»æœºä¸Šçš„ç›®å½•ï¼Œæ¯”å¦‚ä¸€ä¸ª NFS çš„æŒ‚è½½ç›®å½•ã€‚\nè€Œ PVC ï¼ˆPersistent Volume Claimï¼‰æè¿°çš„ï¼Œåˆ™æ˜¯ Pod æ‰€å¸Œæœ›ä½¿ç”¨çš„æŒä¹…åŒ–å­˜å‚¨çš„å±æ€§ã€‚æ¯”å¦‚ï¼ŒVolume å­˜å‚¨çš„å¤§å°ã€å¯è¯»å†™æƒé™ç­‰ç­‰ã€‚\nPVCæ˜¯å’ŒPVé…åˆä½¿ç”¨çš„ã€‚åœ¨æ™®é€šå¼€å‘äººå‘˜éœ€è¦ä½¿ç”¨å­˜å‚¨æ—¶ï¼Œä»–ä¸çŸ¥é“K8sä¸­åˆ°åº•æœ‰é‚£äº›å­˜å‚¨ç©ºé—´å¯ä»¥ä½¿ç”¨ï¼Œä¹Ÿä¸éœ€è¦çŸ¥é“ã€‚ä»–æ‰€éœ€è¦åšçš„ï¼Œä»…ä»…ï¼š1. å®šä¹‰ä¸€ä¸ª PVCï¼Œå£°æ˜æƒ³è¦çš„ Volume çš„å±æ€§ï¼š2. åœ¨åº”ç”¨çš„Podä¸­ï¼Œå£°æ˜ä½¿ç”¨è¿™ä¸ªPVCã€‚\nPVä¸PVCçš„å…³ç³»ç±»ä¼¼äºæ¥å£ä¸æ¥å£çš„å®ç°ï¼Œå¼€å‘äººå‘˜åªéœ€ä½¿ç”¨æ¥å£å³å¯ï¼Œè€Œä¸ç”¨å…³å¿ƒæ¥å£çš„å…·ä½“å®ç°ï¼Œè€Œæ¥å£çš„å®ç°ï¼ˆå³å­˜å‚¨å¯¹è±¡çš„å…·ä½“å®šä¹‰ï¼‰ç”±è¿ç»´äººå‘˜å®Œæˆã€‚è¿™ç§è§£è€¦ï¼Œå°±é¿å…äº†å› ä¸ºå‘å¼€å‘è€…æš´éœ²è¿‡å¤šçš„å­˜å‚¨ç³»ç»Ÿç»†èŠ‚è€Œå¸¦æ¥çš„éšæ‚£ã€‚æ­¤å¤–ï¼Œè¿™ç§èŒè´£çš„åˆ†ç¦»ï¼Œå¾€å¾€ä¹Ÿæ„å‘³ç€å‡ºç°äº‹æ•…æ—¶å¯ä»¥æ›´å®¹æ˜“å®šä½é—®é¢˜å’Œæ˜ç¡®è´£ä»»ï¼Œä»è€Œé¿å…â€œæ‰¯çš®â€ç°è±¡çš„å‡ºç°ã€‚\nç”¨æˆ·åˆ›å»ºçš„ PVC è¦çœŸæ­£è¢«å®¹å™¨ä½¿ç”¨èµ·æ¥ï¼Œå°±å¿…é¡»å…ˆå’ŒæŸä¸ªç¬¦åˆæ¡ä»¶çš„ PV è¿›è¡Œç»‘å®šã€‚è¿™é‡Œè¦æ£€æŸ¥çš„æ¡ä»¶ï¼ŒåŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼š\n  ç¬¬ä¸€ä¸ªæ¡ä»¶ï¼Œå½“ç„¶æ˜¯ PV å’Œ PVC çš„ spec å­—æ®µã€‚æ¯”å¦‚ï¼ŒPV çš„å­˜å‚¨ï¼ˆstorageï¼‰å¤§å°ï¼Œå°±å¿…é¡»æ»¡è¶³ PVC çš„è¦æ±‚ã€‚\n  è€Œç¬¬äºŒä¸ªæ¡ä»¶ï¼Œåˆ™æ˜¯ PV å’Œ PVC çš„ storageClassName å­—æ®µå¿…é¡»ä¸€æ ·ã€‚\n  PVä¸PVCæ˜¯å¦‚ä½•ç»‘å®šçš„ åœ¨ Kubernetes ä¸­ï¼Œå­˜åœ¨ä¸€ä¸ªä¸“é—¨å¤„ç†æŒä¹…åŒ–å­˜å‚¨çš„æ§åˆ¶å™¨ï¼Œå«ä½œ Volume Controllerã€‚è¿™ä¸ª Volume Controller ç»´æŠ¤ç€å¤šä¸ªæ§åˆ¶å¾ªç¯ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªå¾ªç¯ï¼Œæ‰®æ¼”çš„å°±æ˜¯æ’®åˆ PV å’Œ PVC çš„â€œçº¢å¨˜â€çš„è§’è‰²ã€‚å®ƒçš„åå­—å«ä½œ PersistentVolumeControllerã€‚\nPersistentVolumeController ä¼šä¸æ–­åœ°æŸ¥çœ‹å½“å‰æ¯ä¸€ä¸ª PVCï¼Œæ˜¯ä¸æ˜¯å·²ç»å¤„äº Boundï¼ˆå·²ç»‘å®šï¼‰çŠ¶æ€ã€‚å¦‚æœä¸æ˜¯ï¼Œé‚£å®ƒå°±ä¼šéå†æ‰€æœ‰çš„ã€å¯ç”¨çš„ PVï¼Œå¹¶å°è¯•å°†å…¶ä¸è¿™ä¸ªâ€œå•èº«â€çš„ PVC è¿›è¡Œç»‘å®šã€‚è¿™æ ·ï¼ŒKubernetes å°±å¯ä»¥ä¿è¯ç”¨æˆ·æäº¤çš„æ¯ä¸€ä¸ª PVCï¼Œåªè¦æœ‰åˆé€‚çš„ PV å‡ºç°ï¼Œå®ƒå°±èƒ½å¤Ÿå¾ˆå¿«è¿›å…¥ç»‘å®šçŠ¶æ€ï¼Œä»è€Œç»“æŸâ€œå•èº«â€ä¹‹æ—…ã€‚","title":""},{"content":"","permalink":"http://yangchnet.github.io/Dessert/posts/dlml/%E6%9C%AA%E5%91%BD%E5%90%8D/","summary":"","title":""},{"content":"ä¸€çº§æ ‡é¢˜ äºŒçº§æ ‡é¢˜ ä¸‰çº§æ ‡é¢˜ æ­£æ–‡æ­£æ–‡æ­£æ–‡æ­£æ–‡æ­£æ–‡æ­£æ–‡æ­£æ–‡æ­£æ–‡æ­£æ–‡æ­£æ–‡æ­£æ–‡æ­£æ–‡æ­£æ–‡æ­£æ–‡æ­£æ–‡æ­£æ–‡æ­£æ–‡æ­£æ–‡æ­£æ–‡æ­£æ–‡æ­£æ–‡æ­£æ–‡æ­£æ–‡æ­£æ–‡æ­£æ–‡\n æ— åºåˆ—è¡¨ æ— åºåˆ—è¡¨ æ— åºåˆ—è¡¨   æœ‰åºåˆ—è¡¨ æœ‰åºåˆ—è¡¨ æœ‰åºåˆ—è¡¨ æœ‰åºåˆ—è¡¨  åŠ ç²—åŠ ç²—åŠ ç²—åŠ ç²—åŠ ç²—åŠ ç²—åŠ ç²— æ–œä½“æ–œä½“æ–œä½“æ–œä½“æ–œä½“æ–œä½“æ–œä½“\nå›¾ç‰‡ è¶…é“¾æ¥ é“¾æ¥\nè¡Œå†…å…¬å¼ aaa$\\frac{a}{b}$bbbb\nè¡Œé—´å…¬å¼ $$ \\frac{a}{B} $$\nå¼•ç”¨  å¼•ç”¨å¼•ç”¨å¼•ç”¨å¼•ç”¨å¼•ç”¨å¼•ç”¨å¼•ç”¨å¼•\n äºŒå±‚å¼•ç”¨\n  ","permalink":"http://yangchnet.github.io/Dessert/posts/env/aa/","summary":"ä¸€çº§æ ‡é¢˜ äºŒçº§æ ‡é¢˜ ä¸‰çº§æ ‡é¢˜ æ­£æ–‡æ­£æ–‡æ­£æ–‡æ­£æ–‡æ­£æ–‡æ­£æ–‡æ­£æ–‡æ­£æ–‡æ­£æ–‡æ­£æ–‡æ­£æ–‡æ­£æ–‡æ­£æ–‡æ­£æ–‡æ­£æ–‡æ­£æ–‡æ­£æ–‡æ­£æ–‡æ­£æ–‡æ­£æ–‡æ­£æ–‡æ­£æ–‡æ­£æ–‡æ­£æ–‡æ­£æ–‡\n æ— åºåˆ—è¡¨ æ— åºåˆ—è¡¨ æ— åºåˆ—è¡¨   æœ‰åºåˆ—è¡¨ æœ‰åºåˆ—è¡¨ æœ‰åºåˆ—è¡¨ æœ‰åºåˆ—è¡¨  åŠ ç²—åŠ ç²—åŠ ç²—åŠ ç²—åŠ ç²—åŠ ç²—åŠ ç²— æ–œä½“æ–œä½“æ–œä½“æ–œä½“æ–œä½“æ–œä½“æ–œä½“\nå›¾ç‰‡ è¶…é“¾æ¥ é“¾æ¥\nè¡Œå†…å…¬å¼ aaa$\\frac{a}{b}$bbbb\nè¡Œé—´å…¬å¼ $$ \\frac{a}{B} $$\nå¼•ç”¨  å¼•ç”¨å¼•ç”¨å¼•ç”¨å¼•ç”¨å¼•ç”¨å¼•ç”¨å¼•ç”¨å¼•\n äºŒå±‚å¼•ç”¨\n  ","title":""},{"content":"su root kubeadm reset -f rm -rf /etc/cni /etc/kubernetes /var/lib/dockershim /var/lib/etcd /var/lib/kubelet /var/run/kubernetes ~/.kube/* iptables -F \u0026amp;\u0026amp; iptables -X iptables -t nat -F \u0026amp;\u0026amp; iptables -t nat -X iptables -t raw -F \u0026amp;\u0026amp; iptables -t raw -X iptables -t mangle -F \u0026amp;\u0026amp; iptables -t mangle -X systemctl restart docker ","permalink":"http://yangchnet.github.io/Dessert/posts/kubernetes/reinstall-kubernetes/","summary":"su root kubeadm reset -f rm -rf /etc/cni /etc/kubernetes /var/lib/dockershim /var/lib/etcd /var/lib/kubelet /var/run/kubernetes ~/.kube/* iptables -F \u0026amp;\u0026amp; iptables -X iptables -t nat -F \u0026amp;\u0026amp; iptables -t nat -X iptables -t raw -F \u0026amp;\u0026amp; iptables -t raw -X iptables -t mangle -F \u0026amp;\u0026amp; iptables -t mangle -X systemctl restart docker ","title":""},{"content":"","permalink":"http://yangchnet.github.io/Dessert/posts/net/tcp-%E6%8F%A1%E6%89%8B/","summary":"","title":""},{"content":"","permalink":"http://yangchnet.github.io/Dessert/posts/net/%E4%B8%80%E4%B8%AA%E6%B6%88%E6%81%AF%E7%9A%84%E7%94%9F%E5%91%BD%E5%8E%86%E7%A8%8B/","summary":"","title":""},{"content":" Revise in 2022-3-18\n deferç”¨æ³• deferç”¨æ¥å»¶è¿Ÿå¯¹æŸä¸ªè¯­å¥çš„è°ƒç”¨ï¼Œå¸¸ç”¨äºå¤„ç†æˆå¯¹çš„æ“ä½œï¼Œå¦‚æ‰“å¼€ã€å…³é—­ã€è¿æ¥ã€æ–­å¼€è¿æ¥ï¼ŒåŠ é”ã€é‡Šæ”¾é”ã€‚é€šè¿‡deferè¯­å¥ï¼Œæ— è®ºå‡½æ•°é€»è¾‘å¤šå¤æ‚ï¼Œéƒ½èƒ½ä¿è¯åœ¨ä»»ä½•ä»£ç æ‰§è¡Œè·¯å¾„ä¸‹ï¼Œèµ„æºè¢«é‡Šæ”¾ã€‚deferåº”è¯¥ç›´æ¥è·Ÿåœ¨è¯·æ±‚èµ„æºçš„è¯­å¥åã€‚\ndeferè¯­å¥å°†å‡½æ•°çš„è°ƒç”¨pushåˆ°ä¸€ä¸ªåˆ—è¡¨ä¸­ï¼Œå½“å¤–å±‚å‡½æ•°è¿”å›æ—¶ï¼Œä¼šæ‰§è¡Œä¿å­˜çš„å‡½æ•°åˆ—è¡¨\nä¸¾ä¸ªä¾‹å­ï¼Œè¿™ä¸ªç¨‹åºæ‰“å¼€ä¸¤ä¸ªæ–‡ä»¶å¹¶å°†ä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹å¤åˆ¶åˆ°å¦ä¸€ä¸ªæ–‡ä»¶çš„å‡½æ•°\nfunc CopyFile(dstName, srcName string) (written int64, err error) { src, err := os.Open(srcName) if err != nil { return } dst, err := os.Create(dstName) if err != nil { return } written, err = io.Copy(dst, src) dst.Close() src.Close() return } è¿™ä¸ªå‡½æ•°ä¼¼ä¹å¯ä»¥æ­£å¸¸å·¥ä½œï¼Œä½†å…¶å®å­˜åœ¨ä¸€ä¸ªbugï¼Œå¦‚æœå¯¹os.Createçš„è°ƒç”¨å¤±è´¥ï¼Œè¯¥å‡½æ•°å°†è¿”å›ä½†å´ä¸å…³é—­æºæ–‡ä»¶ï¼Œé€šè¿‡åœ¨ç¬¬äºŒä¸ªreturnè¯­å¥ä¸­è°ƒç”¨src.Closeå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ä½†æ˜¯å¦‚æœå‡½æ•°æ›´åŠ å¤æ‚ï¼Œé—®é¢˜å¯èƒ½ä¸ä¼šé‚£ä¹ˆå®¹æ˜“è¢«å‘ç°å’Œè§£å†³ã€‚é€šè¿‡ä½¿ç”¨deferè¯­å¥ï¼Œå¯ä»¥ç¡®ä¿å§‹ç»ˆå…³é—­æ–‡ä»¶ã€‚\nfunc CopyFile(dstName, srcName string) (written int64, err error) { src, err := os.Open(srcName) if err != nil { return } defer src.Close() dst, err := os.Create(dstName) if err != nil { return } defer dst.Close() return io.Copy(dst, src) } Deferè¯­å¥ä½¿æˆ‘ä»¬å¯ä»¥è€ƒè™‘åœ¨æ‰“å¼€æ¯ä¸ªæ–‡ä»¶åç«‹å³å°†å…¶å…³é—­ï¼Œä»è€Œç¡®ä¿æ— è®ºå‡½æ•°ä¸­æœ‰returnè¯­å¥å¤šå°‘ï¼Œæ–‡ä»¶éƒ½å°†è¢«å…³é—­ã€‚\ndefer çš„ç‰¹æ€§ 1. deferå‡½æ•°çš„å‚æ•°æ˜¯åœ¨deferå‡½æ•°å£°æ˜æ—¶çš„å‚æ•° è¢«deferè°ƒç”¨çš„å‡½æ•°æ˜¯åœ¨å…¶è°ƒç”¨è¢«æ¨å…¥è°ƒç”¨å †æ ˆä¹‹å‰è¢«ä¼°å€¼çš„ã€‚\nfunc main() { var f = func() { fmt.Println(false) } defer f() f = func() { fmt.Println(true) } }  false ä¸€ä¸ªå»¶è¿Ÿè°ƒç”¨çš„å®å‚æ˜¯åœ¨æ­¤è°ƒç”¨è¢«æ¨å…¥å»¶è¿Ÿè°ƒç”¨å †æ ˆä¹‹å‰ä¼°å€¼çš„ã€‚\nimport \u0026#34;fmt\u0026#34; func a() { i := 0 defer fmt.Println(i) // è¿™é‡Œçš„iï¼Œå€¼ä¸º0,é‚£ä¹ˆdeferè°ƒç”¨æ—¶ï¼Œiä¹Ÿä¸º0  i++ return } a()  0 å¦‚æœä¼ å…¥å‡½æ•°çš„å®å‚ä¸ºæŒ‡é’ˆï¼Œé‚£ä¹ˆå¯¹æŒ‡é’ˆæŒ‡å‘çš„å€¼è¿›è¡Œçš„æ›´æ”¹ä¼šè¢«deferæ˜¾ç¤ºå‡ºæ¥ã€‚ä¾‹å¦‚ï¼š\ntype User struct { Name string Passwd string } func main() { u := \u0026amp;User{ Name: \u0026#34;tom\u0026#34;, } defer f(u) u.Name = \u0026#34;Alice\u0026#34; } func f(u *User) { fmt.Println(u.Name) }  Alice 2. deferå‡½æ•°çš„æ‰§è¡Œé¡ºåºä¸å£°æ˜é¡ºåºç›¸åï¼Œç±»ä¼¼äºæ ˆ func b() { for i := 0; i \u0026lt; 4; i++ { defer fmt.Println(i) } } b()  3 2 1 0 å½“é‡åˆ°panicæ—¶ï¼Œä¼šå…ˆæŒ‰ç…§ defer çš„åè¿›å…ˆå‡ºçš„é¡ºåºæ‰§è¡Œï¼Œæœ€åæ‰ä¼šæ‰§è¡Œpanic\nfunc main() { defer_call() } func defer_call() { defer func() { fmt.Println(\u0026#34;æ‰“å°å‰\u0026#34;) }() defer func() { fmt.Println(\u0026#34;æ‰“å°ä¸­\u0026#34;) }() defer func() { fmt.Println(\u0026#34;æ‰“å°å\u0026#34;) }() panic(\u0026#34;è§¦å‘å¼‚å¸¸\u0026#34;) } æ‰“å°å æ‰“å°ä¸­ æ‰“å°å‰ panic: è§¦å‘å¼‚å¸¸ 3. deferå‡½æ•°å¯ä»¥è¯»å–å‡½æ•°çš„è¿”å›å€¼ func c() (i int) { defer func() { i++ }() return 1 } c()  2 deferè¯­å¥ä¸­çš„å‡½æ•°ä¼šåœ¨returnè¯­å¥æ›´æ–°è¿”å›å€¼å˜é‡åå†æ‰§è¡Œï¼Œåˆå› ä¸ºåœ¨å‡½æ•°ä¸­å®šä¹‰çš„åŒ¿åå‡½æ•°å¯ä»¥è®¿é—®è¯¥å‡½æ•°åŒ…æ‹¬è¿”å›å€¼å˜é‡åœ¨å†…çš„æ‰€æœ‰å˜é‡ï¼Œæ‰€ä»¥ï¼Œå¯¹åŒ¿åå‡½æ•°é‡‡ç”¨deferæœºåˆ¶ï¼Œå¯ä»¥ä½¿å…¶è®¿é—®å‡½æ•°çš„è¿”å›å€¼ã€‚\nè¢«å»¶è¿Ÿæ‰§è¡Œçš„åŒ¿åå‡½æ•°ç”šè‡³å¯ä»¥ä¿®æ”¹å‡½æ•°è¿”å›ç»™è°ƒç”¨è€…çš„è¿”å›å€¼\nfunc triple(x int) ( result int){ defer func() {result += x}() return x*2 } fmt.Println(triple(4))  12 4. deferè°ƒç”¨çš„å±ä¸»å®å‚ æ–¹æ³•çš„å±ä¸»å®å‚æ˜¯åœ¨è¢«è°ƒç”¨æ—¶è¢«æ¨å…¥å»¶è¿Ÿè°ƒç”¨å †æ ˆçš„\ntype T int func (t T) M(n int) T { print(t) return t } func main() { var t T defer t.M(1).M(2) t.M(3).M(4) }  1342 5. å¾ªç¯ä½“ä¸­çš„deferè¯­å¥ åœ¨å¾ªç¯è¯­å¥ä¸­çš„deferè¯­å¥è¦ç‰¹åˆ«æ³¨æ„ï¼Œå› ä¸ºåªæœ‰åœ¨å‡½æ•°æ‰§è¡Œå®Œæ¯•åï¼Œè¿™äº›è¢«å»¶è¿Ÿçš„å‡½æ•°æ‰ä¼šæ‰§è¡Œã€‚ ä¸‹é¢çš„ä»£ç å°†ä¼šå¯¼è‡´ç³»ç»Ÿçš„æ–‡ä»¶æè¿°ç¬¦è€—å°½ï¼Œå› ä¸ºåœ¨æ‰€æœ‰æ–‡ä»¶éƒ½è¢«å¤„ç†ä¹‹å‰ï¼Œ æ²¡æœ‰æ–‡ä»¶ä¼šè¢«å…³é—­ã€‚\nfo _,filename := range filenames{ f, err := os.Open(filename) if err != nil { return err } defer f.close() descriptors //... } ä¸€ç§è§£å†³åŠæ³•æ˜¯å°†å¾ªç¯ä½“ä¸­çš„deferè¯­å¥ç§»è‡³å¦å¤–ä¸€ä¸ªå‡½æ•°ï¼Œåœ¨æ¯æ¬¡å¾ªç¯æ—¶ï¼Œè°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚\nfor _, filename := { if err := doFile(filename); err != nil { return err } } func doFile(filename string) error{ f, err := os.Open(filename) if err != nil { return err } defer f.Close() //...process } ","permalink":"http://yangchnet.github.io/Dessert/posts/golang/defer%E7%94%A8%E6%B3%95/","summary":"Revise in 2022-3-18\n deferç”¨æ³• deferç”¨æ¥å»¶è¿Ÿå¯¹æŸä¸ªè¯­å¥çš„è°ƒç”¨ï¼Œå¸¸ç”¨äºå¤„ç†æˆå¯¹çš„æ“ä½œï¼Œå¦‚æ‰“å¼€ã€å…³é—­ã€è¿æ¥ã€æ–­å¼€è¿æ¥ï¼ŒåŠ é”ã€é‡Šæ”¾é”ã€‚é€šè¿‡deferè¯­å¥ï¼Œæ— è®ºå‡½æ•°é€»è¾‘å¤šå¤æ‚ï¼Œéƒ½èƒ½ä¿è¯åœ¨ä»»ä½•ä»£ç æ‰§è¡Œè·¯å¾„ä¸‹ï¼Œèµ„æºè¢«é‡Šæ”¾ã€‚deferåº”è¯¥ç›´æ¥è·Ÿåœ¨è¯·æ±‚èµ„æºçš„è¯­å¥åã€‚\ndeferè¯­å¥å°†å‡½æ•°çš„è°ƒç”¨pushåˆ°ä¸€ä¸ªåˆ—è¡¨ä¸­ï¼Œå½“å¤–å±‚å‡½æ•°è¿”å›æ—¶ï¼Œä¼šæ‰§è¡Œä¿å­˜çš„å‡½æ•°åˆ—è¡¨\nä¸¾ä¸ªä¾‹å­ï¼Œè¿™ä¸ªç¨‹åºæ‰“å¼€ä¸¤ä¸ªæ–‡ä»¶å¹¶å°†ä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹å¤åˆ¶åˆ°å¦ä¸€ä¸ªæ–‡ä»¶çš„å‡½æ•°\nfunc CopyFile(dstName, srcName string) (written int64, err error) { src, err := os.Open(srcName) if err != nil { return } dst, err := os.Create(dstName) if err != nil { return } written, err = io.Copy(dst, src) dst.Close() src.Close() return } è¿™ä¸ªå‡½æ•°ä¼¼ä¹å¯ä»¥æ­£å¸¸å·¥ä½œï¼Œä½†å…¶å®å­˜åœ¨ä¸€ä¸ªbugï¼Œå¦‚æœå¯¹os.Createçš„è°ƒç”¨å¤±è´¥ï¼Œè¯¥å‡½æ•°å°†è¿”å›ä½†å´ä¸å…³é—­æºæ–‡ä»¶ï¼Œé€šè¿‡åœ¨ç¬¬äºŒä¸ªreturnè¯­å¥ä¸­è°ƒç”¨src.Closeå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ä½†æ˜¯å¦‚æœå‡½æ•°æ›´åŠ å¤æ‚ï¼Œé—®é¢˜å¯èƒ½ä¸ä¼šé‚£ä¹ˆå®¹æ˜“è¢«å‘ç°å’Œè§£å†³ã€‚é€šè¿‡ä½¿ç”¨deferè¯­å¥ï¼Œå¯ä»¥ç¡®ä¿å§‹ç»ˆå…³é—­æ–‡ä»¶ã€‚\nfunc CopyFile(dstName, srcName string) (written int64, err error) { src, err := os.Open(srcName) if err != nil { return } defer src.","title":"deferç”¨æ³•"}]