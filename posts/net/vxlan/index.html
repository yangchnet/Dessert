<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>vxlan | Linote</title><meta name=keywords content="net,vxlan"><meta name=description content="基本概念 VXLAN(Virtual Extensible LAN, 虚拟局域网扩展)是一种网络虚拟化技术，它试图改善大云计算部署相关的可扩展性问题。它采用类似 VLAN 的封装技术来封装基于 MAC 含括第4层的 UDP 数据包的 OSI 第2层 以太网帧，使用 4789 作为默认分配的 IANA 目的地 UDP 端口号。
VTEP是参与VXLAN网络中的主机、虚拟交换机或物理交换机设备，用于在VXLAN隧道和基础网络之间进行数据包的封装和解封装。 具体而言，VTEP设备负责将本地主机或虚拟机的数据包封装为VXLAN数据包，以便在底层IP网络中进行传输。它添加了VXLAN头部，其中包括VXLAN标识符（VNI）和源/目的VTEP IP地址。VTEP还负责在接收到VXLAN数据包时解封装数据包，并将其传递给目标主机或虚拟机。
VTEP (VXLAN Tunnel End Point（虚拟隧道端点）)：vxlan 网络的边缘设备，用来进行 vxlan 报文的处理（封包和解包）。vtep 可以是网络设备（比如交换机），也可以是一台机器（比如虚拟化集群中的宿主机） VNI（VXLAN Network Identifier）：VNI 是每个 vxlan 的标识，是个 24 位整数，一共有 2^24 = 16,777,216（一千多万），一般每个 VNI 对应一个租户，也就是说使用 vxlan 搭建的公有云可以理论上可以支撑千万级别的租户
在VXLAN（Virtual Extensible LAN）中，VNI（VXLAN Network Identifier）用于标识不同的虚拟网络。 VNI是一个32位的标识符，它在VXLAN隧道中的头部中承载，以便在底层IP网络中传递。VNI允许不同的虚拟网络共享同样的物理网络基础设施，每个虚拟网络都可以具有不同的VNI
具体而言，VNI的作用如下：
 虚拟网络隔离：VNI用于将不同的虚拟网络隔离开来。当VXLAN网络中的主机或虚拟机发送数据包时，VNI用于将数据包与特定的虚拟网络关联起来。这样，VXLAN网络可以在相同的物理基础设施上同时支持多个虚拟网络，而不会相互干扰。 数据包识别：当接收到VXLAN数据包时，目的VTEP（VXLAN Tunnel Endpoint）设备会根据VNI解析数据包，并根据VNI将数据包交付到正确的虚拟网络。VNI充当了在底层IP网络上传递数据包，并识别数据包的虚拟网络归属的关键标识符。  FDB(Forwarding Database) 二层网桥的FDB表项格式可表达为:
<MAC> <VLAN> <DEV PORT> VXLAN设备的表项与之类似，可以表达为:
<MAC> <VNI> <REMOTE IP> VXLAN设备根据MAC地址来查找相应的VTEP IP地址，继而将二层数据帧封装发送至相应VTEP。 可以使用如下命令查看fdb表项："><meta name=author content="李昌"><link rel=canonical href=http://yangchnet.github.io/Dessert/posts/net/vxlan/><link crossorigin=anonymous href=/Dessert/assets/css/stylesheet.min.7e145c6c051b0f6645e8d84c6faed7fed1214bbe82c223c2c19815bee6ee8403.css integrity="sha256-fhRcbAUbD2ZF6NhMb67X/tEhS76CwiPCwZgVvubuhAM=" rel="preload stylesheet" as=style><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Fira+Mono&display=swap" rel=stylesheet><script defer crossorigin=anonymous src=/Dessert/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://raw.githubusercontent.com/lich-Img/blogImg/master/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://raw.githubusercontent.com/lich-Img/blogImg/master/favicon.ico><link rel=icon type=image/png sizes=32x32 href=https://raw.githubusercontent.com/lich-Img/blogImg/master/favicon32.ico><link rel=apple-touch-icon href=http://yangchnet.github.io/Dessert/apple-touch-icon.png><link rel=mask-icon href=http://yangchnet.github.io/Dessert/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.81.0"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="vxlan"><meta property="og:description" content="基本概念 VXLAN(Virtual Extensible LAN, 虚拟局域网扩展)是一种网络虚拟化技术，它试图改善大云计算部署相关的可扩展性问题。它采用类似 VLAN 的封装技术来封装基于 MAC 含括第4层的 UDP 数据包的 OSI 第2层 以太网帧，使用 4789 作为默认分配的 IANA 目的地 UDP 端口号。
VTEP是参与VXLAN网络中的主机、虚拟交换机或物理交换机设备，用于在VXLAN隧道和基础网络之间进行数据包的封装和解封装。 具体而言，VTEP设备负责将本地主机或虚拟机的数据包封装为VXLAN数据包，以便在底层IP网络中进行传输。它添加了VXLAN头部，其中包括VXLAN标识符（VNI）和源/目的VTEP IP地址。VTEP还负责在接收到VXLAN数据包时解封装数据包，并将其传递给目标主机或虚拟机。
VTEP (VXLAN Tunnel End Point（虚拟隧道端点）)：vxlan 网络的边缘设备，用来进行 vxlan 报文的处理（封包和解包）。vtep 可以是网络设备（比如交换机），也可以是一台机器（比如虚拟化集群中的宿主机） VNI（VXLAN Network Identifier）：VNI 是每个 vxlan 的标识，是个 24 位整数，一共有 2^24 = 16,777,216（一千多万），一般每个 VNI 对应一个租户，也就是说使用 vxlan 搭建的公有云可以理论上可以支撑千万级别的租户
在VXLAN（Virtual Extensible LAN）中，VNI（VXLAN Network Identifier）用于标识不同的虚拟网络。 VNI是一个32位的标识符，它在VXLAN隧道中的头部中承载，以便在底层IP网络中传递。VNI允许不同的虚拟网络共享同样的物理网络基础设施，每个虚拟网络都可以具有不同的VNI
具体而言，VNI的作用如下：
 虚拟网络隔离：VNI用于将不同的虚拟网络隔离开来。当VXLAN网络中的主机或虚拟机发送数据包时，VNI用于将数据包与特定的虚拟网络关联起来。这样，VXLAN网络可以在相同的物理基础设施上同时支持多个虚拟网络，而不会相互干扰。 数据包识别：当接收到VXLAN数据包时，目的VTEP（VXLAN Tunnel Endpoint）设备会根据VNI解析数据包，并根据VNI将数据包交付到正确的虚拟网络。VNI充当了在底层IP网络上传递数据包，并识别数据包的虚拟网络归属的关键标识符。  FDB(Forwarding Database) 二层网桥的FDB表项格式可表达为:
<MAC> <VLAN> <DEV PORT> VXLAN设备的表项与之类似，可以表达为:
<MAC> <VNI> <REMOTE IP> VXLAN设备根据MAC地址来查找相应的VTEP IP地址，继而将二层数据帧封装发送至相应VTEP。 可以使用如下命令查看fdb表项："><meta property="og:type" content="article"><meta property="og:url" content="http://yangchnet.github.io/Dessert/posts/net/vxlan/"><meta property="og:image" content="http://yangchnet.github.io/Dessert/papermod-cover.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-08-21T00:00:00+00:00"><meta property="article:modified_time" content="2023-08-21T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://yangchnet.github.io/Dessert/papermod-cover.png"><meta name=twitter:title content="vxlan"><meta name=twitter:description content="基本概念 VXLAN(Virtual Extensible LAN, 虚拟局域网扩展)是一种网络虚拟化技术，它试图改善大云计算部署相关的可扩展性问题。它采用类似 VLAN 的封装技术来封装基于 MAC 含括第4层的 UDP 数据包的 OSI 第2层 以太网帧，使用 4789 作为默认分配的 IANA 目的地 UDP 端口号。
VTEP是参与VXLAN网络中的主机、虚拟交换机或物理交换机设备，用于在VXLAN隧道和基础网络之间进行数据包的封装和解封装。 具体而言，VTEP设备负责将本地主机或虚拟机的数据包封装为VXLAN数据包，以便在底层IP网络中进行传输。它添加了VXLAN头部，其中包括VXLAN标识符（VNI）和源/目的VTEP IP地址。VTEP还负责在接收到VXLAN数据包时解封装数据包，并将其传递给目标主机或虚拟机。
VTEP (VXLAN Tunnel End Point（虚拟隧道端点）)：vxlan 网络的边缘设备，用来进行 vxlan 报文的处理（封包和解包）。vtep 可以是网络设备（比如交换机），也可以是一台机器（比如虚拟化集群中的宿主机） VNI（VXLAN Network Identifier）：VNI 是每个 vxlan 的标识，是个 24 位整数，一共有 2^24 = 16,777,216（一千多万），一般每个 VNI 对应一个租户，也就是说使用 vxlan 搭建的公有云可以理论上可以支撑千万级别的租户
在VXLAN（Virtual Extensible LAN）中，VNI（VXLAN Network Identifier）用于标识不同的虚拟网络。 VNI是一个32位的标识符，它在VXLAN隧道中的头部中承载，以便在底层IP网络中传递。VNI允许不同的虚拟网络共享同样的物理网络基础设施，每个虚拟网络都可以具有不同的VNI
具体而言，VNI的作用如下：
 虚拟网络隔离：VNI用于将不同的虚拟网络隔离开来。当VXLAN网络中的主机或虚拟机发送数据包时，VNI用于将数据包与特定的虚拟网络关联起来。这样，VXLAN网络可以在相同的物理基础设施上同时支持多个虚拟网络，而不会相互干扰。 数据包识别：当接收到VXLAN数据包时，目的VTEP（VXLAN Tunnel Endpoint）设备会根据VNI解析数据包，并根据VNI将数据包交付到正确的虚拟网络。VNI充当了在底层IP网络上传递数据包，并识别数据包的虚拟网络归属的关键标识符。  FDB(Forwarding Database) 二层网桥的FDB表项格式可表达为:
<MAC> <VLAN> <DEV PORT> VXLAN设备的表项与之类似，可以表达为:
<MAC> <VNI> <REMOTE IP> VXLAN设备根据MAC地址来查找相应的VTEP IP地址，继而将二层数据帧封装发送至相应VTEP。 可以使用如下命令查看fdb表项："><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"http://yangchnet.github.io/Dessert/posts/"},{"@type":"ListItem","position":3,"name":"vxlan","item":"http://yangchnet.github.io/Dessert/posts/net/vxlan/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"vxlan","name":"vxlan","description":"基本概念 VXLAN(Virtual Extensible LAN, 虚拟局域网扩展)是一种网络虚拟化技术，它试图改善大云计算部署相关的可扩展性问题。它采用类似 VLAN 的封装技术来封装基于 MAC 含括第4层的 UDP 数据包的 OSI 第2层 以太网帧，使用 4789 作为默认分配的 IANA 目的地 UDP 端口号。\nVTEP是参与VXLAN网络中的主机、虚拟交换机或物理交换机设备，用于在VXLAN隧道和基础网络之间进行数据包的封装和解封装。 具体而言，VTEP设备负责将本地主机或虚拟机的数据包封装为VXLAN数据包，以便在底层IP网络中进行传输。它添加了VXLAN头部，其中包括VXLAN标识符（VNI）和源/目的VTEP IP地址。VTEP还负责在接收到VXLAN数据包时解封装数据包，并将其传递给目标主机或虚拟机。\nVTEP (VXLAN Tunnel End Point（虚拟隧道端点）)：vxlan 网络的边缘设备，用来进行 vxlan 报文的处理（封包和解包）。vtep 可以是网络设备（比如交换机），也可以是一台机器（比如虚拟化集群中的宿主机） VNI（VXLAN Network Identifier）：VNI 是每个 vxlan 的标识，是个 24 位整数，一共有 2^24 = 16,777,216（一千多万），一般每个 VNI 对应一个租户，也就是说使用 vxlan 搭建的公有云可以理论上可以支撑千万级别的租户\n在VXLAN（Virtual Extensible LAN）中，VNI（VXLAN Network Identifier）用于标识不同的虚拟网络。 VNI是一个32位的标识符，它在VXLAN隧道中的头部中承载，以便在底层IP网络中传递。VNI允许不同的虚拟网络共享同样的物理网络基础设施，每个虚拟网络都可以具有不同的VNI\n具体而言，VNI的作用如下：\n 虚拟网络隔离：VNI用于将不同的虚拟网络隔离开来。当VXLAN网络中的主机或虚拟机发送数据包时，VNI用于将数据包与特定的虚拟网络关联起来。这样，VXLAN网络可以在相同的物理基础设施上同时支持多个虚拟网络，而不会相互干扰。 数据包识别：当接收到VXLAN数据包时，目的VTEP（VXLAN Tunnel Endpoint）设备会根据VNI解析数据包，并根据VNI将数据包交付到正确的虚拟网络。VNI充当了在底层IP网络上传递数据包，并识别数据包的虚拟网络归属的关键标识符。  FDB(Forwarding Database) 二层网桥的FDB表项格式可表达为:\n\u0026lt;MAC\u0026gt; \u0026lt;VLAN\u0026gt; \u0026lt;DEV PORT\u0026gt; VXLAN设备的表项与之类似，可以表达为:\n\u0026lt;MAC\u0026gt; \u0026lt;VNI\u0026gt; \u0026lt;REMOTE IP\u0026gt; VXLAN设备根据MAC地址来查找相应的VTEP IP地址，继而将二层数据帧封装发送至相应VTEP。 可以使用如下命令查看fdb表项：","keywords":["net","vxlan"],"articleBody":"基本概念 VXLAN(Virtual Extensible LAN, 虚拟局域网扩展)是一种网络虚拟化技术，它试图改善大云计算部署相关的可扩展性问题。它采用类似 VLAN 的封装技术来封装基于 MAC 含括第4层的 UDP 数据包的 OSI 第2层 以太网帧，使用 4789 作为默认分配的 IANA 目的地 UDP 端口号。\nVTEP是参与VXLAN网络中的主机、虚拟交换机或物理交换机设备，用于在VXLAN隧道和基础网络之间进行数据包的封装和解封装。 具体而言，VTEP设备负责将本地主机或虚拟机的数据包封装为VXLAN数据包，以便在底层IP网络中进行传输。它添加了VXLAN头部，其中包括VXLAN标识符（VNI）和源/目的VTEP IP地址。VTEP还负责在接收到VXLAN数据包时解封装数据包，并将其传递给目标主机或虚拟机。\nVTEP (VXLAN Tunnel End Point（虚拟隧道端点）)：vxlan 网络的边缘设备，用来进行 vxlan 报文的处理（封包和解包）。vtep 可以是网络设备（比如交换机），也可以是一台机器（比如虚拟化集群中的宿主机） VNI（VXLAN Network Identifier）：VNI 是每个 vxlan 的标识，是个 24 位整数，一共有 2^24 = 16,777,216（一千多万），一般每个 VNI 对应一个租户，也就是说使用 vxlan 搭建的公有云可以理论上可以支撑千万级别的租户\n在VXLAN（Virtual Extensible LAN）中，VNI（VXLAN Network Identifier）用于标识不同的虚拟网络。 VNI是一个32位的标识符，它在VXLAN隧道中的头部中承载，以便在底层IP网络中传递。VNI允许不同的虚拟网络共享同样的物理网络基础设施，每个虚拟网络都可以具有不同的VNI\n具体而言，VNI的作用如下：\n 虚拟网络隔离：VNI用于将不同的虚拟网络隔离开来。当VXLAN网络中的主机或虚拟机发送数据包时，VNI用于将数据包与特定的虚拟网络关联起来。这样，VXLAN网络可以在相同的物理基础设施上同时支持多个虚拟网络，而不会相互干扰。 数据包识别：当接收到VXLAN数据包时，目的VTEP（VXLAN Tunnel Endpoint）设备会根据VNI解析数据包，并根据VNI将数据包交付到正确的虚拟网络。VNI充当了在底层IP网络上传递数据包，并识别数据包的虚拟网络归属的关键标识符。  FDB(Forwarding Database) 二层网桥的FDB表项格式可表达为:\n  VXLAN设备的表项与之类似，可以表达为:\n  VXLAN设备根据MAC地址来查找相应的VTEP IP地址，继而将二层数据帧封装发送至相应VTEP。 可以使用如下命令查看fdb表项：\n$ bridge fdb 点对点vxlan $ ip link add vxlan0 type vxlan \\  id 1 \\  remote 192.168.56.3 \\  local 192.168.56.2 \\  dstport 4789 \\  dev eth1 $ ip addr add 10.0.0.2/24 dev vxlan0 # 设置ip $ ip link set vxlan0 up # 启动设备 $ ip -d link show dev vxlan0 # 查看设备 ip link add vxlan0 type vxlan \\  id 1 \\  remote 192.168.56.2 \\  local 192.168.56.3 \\  dstport 4789 \\  dev eth1 $ ip addr add 10.0.0.3/24 dev vxlan0 # 设置ip $ ip link set vxlan0 up # 启动设备 $ ip -d link show dev vxlan0 # 查看设备 多播vxlan 如果 vxlan 要使用多播模式，那么底层的网络结构需要支持多播的功能， virtualbox 网络支持多播。 要组成同一个 vxlan 网络，vtep 必须能感知到彼此的存在。\n$ ip link add vxlan0 type vxlan \\  id 42 \\  dstport 4789 \\  group 239.1.1.1 \\  dev eth1 $ ip addr add 10.20.1.2/24 dev vxlan0 # 设置ip $ ip link set vxlan0 up # 启动vxlan0 $ ip link add vxlan0 type vxlan \\  id 42 \\  dstport 4789 \\  group 239.1.1.1 \\  dev eth1 $ ip addr add 10.20.1.3/24 dev vxlan0 # 设置ip $ ip link set vxlan0 up # 启动vxlan0 References linux 上实现 vxlan 网络 | Cizixs Write Here\n","wordCount":"263","inLanguage":"en","datePublished":"2023-08-21T00:00:00Z","dateModified":"2023-08-21T00:00:00Z","author":{"@type":"Person","name":"李昌"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://yangchnet.github.io/Dessert/posts/net/vxlan/"},"publisher":{"@type":"Organization","name":"Linote","logo":{"@type":"ImageObject","url":"https://raw.githubusercontent.com/lich-Img/blogImg/master/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><header class=header><nav class=nav><div class=logo><a href=http://yangchnet.github.io/Dessert accesskey=h title="Linote (Alt + H)">Linote</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=http://yangchnet.github.io/Dessert/archives/ title=存档><span>存档</span></a></li><li><a href=http://yangchnet.github.io/Dessert/categories/ title=分类><span>分类</span></a></li><li><a href=http://yangchnet.github.io/Dessert/search/ title=搜索><span>搜索</span></a></li><li><a href=http://yangchnet.github.io/Dessert/tags/ title=标签><span>标签</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://yangchnet.github.io/Dessert>Home</a>&nbsp;»&nbsp;<a href=http://yangchnet.github.io/Dessert/posts/>Posts</a></div><h1 class=post-title>vxlan</h1><div class=post-meta><span title="2023-08-21 00:00:00 +0000 UTC">August 21, 2023</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;李昌</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e5%9f%ba%e6%9c%ac%e6%a6%82%e5%bf%b5 aria-label=基本概念>基本概念</a></li><li><a href=#%e7%82%b9%e5%af%b9%e7%82%b9vxlan aria-label=点对点vxlan>点对点vxlan</a></li><li><a href=#%e5%a4%9a%e6%92%advxlan aria-label=多播vxlan>多播vxlan</a></li><li><a href=#references aria-label=References>References</a></li></ul></div></details></div><div class=post-content><h2 id=基本概念>基本概念<a hidden class=anchor aria-hidden=true href=#基本概念>#</a></h2><p><code>VXLAN</code>(Virtual Extensible LAN, 虚拟局域网扩展)是一种网络虚拟化技术，它试图改善大云计算部署相关的可扩展性问题。它采用类似 VLAN 的封装技术来封装基于 MAC 含括第4层的 UDP 数据包的 OSI 第2层 以太网帧，使用 4789 作为默认分配的 IANA 目的地 UDP 端口号。</p><p><code>VTEP</code>是参与VXLAN网络中的主机、虚拟交换机或物理交换机设备，用于在VXLAN隧道和基础网络之间进行数据包的封装和解封装。
具体而言，VTEP设备负责将本地主机或虚拟机的数据包封装为VXLAN数据包，以便在底层IP网络中进行传输。它添加了VXLAN头部，其中包括VXLAN标识符（VNI）和源/目的VTEP IP地址。VTEP还负责在接收到VXLAN数据包时解封装数据包，并将其传递给目标主机或虚拟机。</p><p>VTEP (VXLAN Tunnel End Point（虚拟隧道端点）)：vxlan 网络的边缘设备，用来进行 vxlan 报文的处理（封包和解包）。vtep 可以是网络设备（比如交换机），也可以是一台机器（比如虚拟化集群中的宿主机）
VNI（VXLAN Network Identifier）：VNI 是每个 vxlan 的标识，是个 24 位整数，一共有 2^24 = 16,777,216（一千多万），一般每个 VNI 对应一个租户，也就是说使用 vxlan 搭建的公有云可以理论上可以支撑千万级别的租户</p><p>在VXLAN（Virtual Extensible LAN）中，<code>VNI</code>（VXLAN Network Identifier）用于标识不同的虚拟网络。
VNI是一个32位的标识符，它在VXLAN隧道中的头部中承载，以便在底层IP网络中传递。VNI允许不同的虚拟网络共享同样的物理网络基础设施，每个虚拟网络都可以具有不同的VNI</p><p>具体而言，VNI的作用如下：</p><ol><li>虚拟网络隔离：VNI用于将不同的虚拟网络隔离开来。当VXLAN网络中的主机或虚拟机发送数据包时，VNI用于将数据包与特定的虚拟网络关联起来。这样，VXLAN网络可以在相同的物理基础设施上同时支持多个虚拟网络，而不会相互干扰。</li><li>数据包识别：当接收到VXLAN数据包时，目的VTEP（VXLAN Tunnel Endpoint）设备会根据VNI解析数据包，并根据VNI将数据包交付到正确的虚拟网络。VNI充当了在底层IP网络上传递数据包，并识别数据包的虚拟网络归属的关键标识符。</li></ol><p><code>FDB(Forwarding Database)</code>
二层网桥的FDB表项格式可表达为:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>&lt;MAC&gt; &lt;VLAN&gt; &lt;DEV PORT&gt;
</code></pre></div><p>VXLAN设备的表项与之类似，可以表达为:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>&lt;MAC&gt; &lt;VNI&gt; &lt;REMOTE IP&gt;
</code></pre></div><p>VXLAN设备根据MAC地址来查找相应的VTEP IP地址，继而将二层数据帧封装发送至相应VTEP。
可以使用如下命令查看fdb表项：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ bridge fdb
</code></pre></div><h2 id=点对点vxlan>点对点vxlan<a hidden class=anchor aria-hidden=true href=#点对点vxlan>#</a></h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ ip link add vxlan0 type vxlan <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    id <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    remote 192.168.56.3 <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    local 192.168.56.2 <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    dstport <span style=color:#ae81ff>4789</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    dev eth1

$ ip addr add 10.0.0.2/24 dev vxlan0 <span style=color:#75715e># 设置ip</span>

$ ip link set vxlan0 up <span style=color:#75715e># 启动设备</span>

$ ip -d link show dev vxlan0 <span style=color:#75715e># 查看设备</span>
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>ip link add vxlan0 type vxlan <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    id <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    remote 192.168.56.2 <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    local 192.168.56.3 <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    dstport <span style=color:#ae81ff>4789</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    dev eth1

$ ip addr add 10.0.0.3/24 dev vxlan0 <span style=color:#75715e># 设置ip</span>

$ ip link set vxlan0 up <span style=color:#75715e>#  启动设备</span>

$ ip -d link show dev vxlan0 <span style=color:#75715e># 查看设备</span>
</code></pre></div><h2 id=多播vxlan>多播vxlan<a hidden class=anchor aria-hidden=true href=#多播vxlan>#</a></h2><p>如果 vxlan 要使用多播模式，那么底层的网络结构需要支持多播的功能， virtualbox 网络支持多播。
要组成同一个 vxlan 网络，vtep 必须能感知到彼此的存在。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ ip link add vxlan0 type vxlan <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    id <span style=color:#ae81ff>42</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    dstport <span style=color:#ae81ff>4789</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    group 239.1.1.1 <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    dev eth1

$ ip addr add 10.20.1.2/24 dev vxlan0 <span style=color:#75715e># 设置ip</span>

$ ip link set vxlan0 up <span style=color:#75715e># 启动vxlan0</span>
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ ip link add vxlan0 type vxlan <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    id <span style=color:#ae81ff>42</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    dstport <span style=color:#ae81ff>4789</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    group 239.1.1.1 <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    dev eth1

$ ip addr add 10.20.1.3/24 dev vxlan0 <span style=color:#75715e># 设置ip</span>

$ ip link set vxlan0 up <span style=color:#75715e># 启动vxlan0</span>
</code></pre></div><h2 id=references>References<a hidden class=anchor aria-hidden=true href=#references>#</a></h2><p><a href=https://cizixs.com/2017/09/28/linux-vxlan/>linux 上实现 vxlan 网络 | Cizixs Write Here</a></p></div><footer class=post-footer><ul class=post-tags><li><a href=http://yangchnet.github.io/Dessert/tags/net/>NET</a></li><li><a href=http://yangchnet.github.io/Dessert/tags/vxlan/>vxlan</a></li></ul><nav class=paginav><a class=prev href=http://yangchnet.github.io/Dessert/posts/linux/nc/><span class=title>« Prev Page</span><br><span>nc-任意的TCP/UDP连接和监听</span></a>
<a class=next href=http://yangchnet.github.io/Dessert/posts/tool/%E5%9C%A8manjaro%E5%8F%B0%E5%BC%8F%E6%9C%BA%E4%B8%8A%E4%BD%BF%E7%94%A8%E7%BD%97%E6%8A%80%E8%93%9D%E7%89%99%E9%BC%A0%E6%A0%87/><span class=title>Next Page »</span><br><span>在manjaro台式机上使用罗技蓝牙鼠标</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href=http://yangchnet.github.io/Dessert>Linote</a></span>
<script src=https://utteranc.es/client.js repo=yangchnet/Dessert issue-term=pathname theme=github-light crossorigin=anonymous async></script><span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script></body></html>