<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>在AUR上发布包 | Linote</title><meta name=keywords content="Linux,arch"><meta name=description content="如何在AUR上发布包 1. 准备PKGBUILD 文件  https://wiki.archlinux.org/title/PKGBUILD https://wiki.archlinux.org/title/Creating_packages
 想要打包一个可以在AUR上发布的package， 需要使用makepkg工具，makepkg在运行时会寻找当前工作目录下的PKGBUILD文件。
找到之后，会从PKGBUILD配置的source去获取源码并根据PKGBUILD的配置去进行编译，最终产生二进制文件以及一些元信息文件。
如果你使用的是arch系的系统，可以在/usr/share/pacman/目录下找到一些PKGBUILD示例文件。例如：
$ cat /usr/share/pacman/PKGBUILD.proto # This is an example PKGBUILD file. Use this as a start to creating your own, # and remove these comments. For more information, see 'man PKGBUILD'. # NOTE: Please fill out the license field for your package! If it is unknown, # then please put 'unknown'. # Maintainer: Your Name <youremail@domain.com> pkgname=NAME pkgver=VERSION pkgrel=1 epoch= pkgdesc=&#34;&#34; arch=() url=&#34;&#34; license=('GPL') groups=() depends=() makedepends=() checkdepends=() optdepends=() provides=() conflicts=() replaces=() backup=() options=() install= changelog= source=(&#34;$pkgname-$pkgver."><meta name=author content="李昌"><link rel=canonical href=http://yangchnet.github.io/posts/linux/%E5%9C%A8aur%E4%B8%8A%E5%8F%91%E5%B8%83%E5%8C%85/><link crossorigin=anonymous href=/assets/css/stylesheet.min.7e145c6c051b0f6645e8d84c6faed7fed1214bbe82c223c2c19815bee6ee8403.css integrity="sha256-fhRcbAUbD2ZF6NhMb67X/tEhS76CwiPCwZgVvubuhAM=" rel="preload stylesheet" as=style><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Fira+Mono&display=swap" rel=stylesheet><script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://raw.githubusercontent.com/lich-Img/blogImg/master/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://raw.githubusercontent.com/lich-Img/blogImg/master/favicon.ico><link rel=icon type=image/png sizes=32x32 href=https://raw.githubusercontent.com/lich-Img/blogImg/master/favicon32.ico><link rel=apple-touch-icon href=http://yangchnet.github.io/apple-touch-icon.png><link rel=mask-icon href=http://yangchnet.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.81.0"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="在AUR上发布包"><meta property="og:description" content="如何在AUR上发布包 1. 准备PKGBUILD 文件  https://wiki.archlinux.org/title/PKGBUILD https://wiki.archlinux.org/title/Creating_packages
 想要打包一个可以在AUR上发布的package， 需要使用makepkg工具，makepkg在运行时会寻找当前工作目录下的PKGBUILD文件。
找到之后，会从PKGBUILD配置的source去获取源码并根据PKGBUILD的配置去进行编译，最终产生二进制文件以及一些元信息文件。
如果你使用的是arch系的系统，可以在/usr/share/pacman/目录下找到一些PKGBUILD示例文件。例如：
$ cat /usr/share/pacman/PKGBUILD.proto # This is an example PKGBUILD file. Use this as a start to creating your own, # and remove these comments. For more information, see 'man PKGBUILD'. # NOTE: Please fill out the license field for your package! If it is unknown, # then please put 'unknown'. # Maintainer: Your Name <youremail@domain.com> pkgname=NAME pkgver=VERSION pkgrel=1 epoch= pkgdesc=&#34;&#34; arch=() url=&#34;&#34; license=('GPL') groups=() depends=() makedepends=() checkdepends=() optdepends=() provides=() conflicts=() replaces=() backup=() options=() install= changelog= source=(&#34;$pkgname-$pkgver."><meta property="og:type" content="article"><meta property="og:url" content="http://yangchnet.github.io/posts/linux/%E5%9C%A8aur%E4%B8%8A%E5%8F%91%E5%B8%83%E5%8C%85/"><meta property="og:image" content="http://yangchnet.github.io/papermod-cover.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-02-10T00:00:00+00:00"><meta property="article:modified_time" content="2023-02-10T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://yangchnet.github.io/papermod-cover.png"><meta name=twitter:title content="在AUR上发布包"><meta name=twitter:description content="如何在AUR上发布包 1. 准备PKGBUILD 文件  https://wiki.archlinux.org/title/PKGBUILD https://wiki.archlinux.org/title/Creating_packages
 想要打包一个可以在AUR上发布的package， 需要使用makepkg工具，makepkg在运行时会寻找当前工作目录下的PKGBUILD文件。
找到之后，会从PKGBUILD配置的source去获取源码并根据PKGBUILD的配置去进行编译，最终产生二进制文件以及一些元信息文件。
如果你使用的是arch系的系统，可以在/usr/share/pacman/目录下找到一些PKGBUILD示例文件。例如：
$ cat /usr/share/pacman/PKGBUILD.proto # This is an example PKGBUILD file. Use this as a start to creating your own, # and remove these comments. For more information, see 'man PKGBUILD'. # NOTE: Please fill out the license field for your package! If it is unknown, # then please put 'unknown'. # Maintainer: Your Name <youremail@domain.com> pkgname=NAME pkgver=VERSION pkgrel=1 epoch= pkgdesc=&#34;&#34; arch=() url=&#34;&#34; license=('GPL') groups=() depends=() makedepends=() checkdepends=() optdepends=() provides=() conflicts=() replaces=() backup=() options=() install= changelog= source=(&#34;$pkgname-$pkgver."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://yangchnet.github.io/posts/"},{"@type":"ListItem","position":2,"name":"在AUR上发布包","item":"http://yangchnet.github.io/posts/linux/%E5%9C%A8aur%E4%B8%8A%E5%8F%91%E5%B8%83%E5%8C%85/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"在AUR上发布包","name":"在AUR上发布包","description":"如何在AUR上发布包 1. 准备PKGBUILD 文件  https://wiki.archlinux.org/title/PKGBUILD https://wiki.archlinux.org/title/Creating_packages\n 想要打包一个可以在AUR上发布的package， 需要使用makepkg工具，makepkg在运行时会寻找当前工作目录下的PKGBUILD文件。\n找到之后，会从PKGBUILD配置的source去获取源码并根据PKGBUILD的配置去进行编译，最终产生二进制文件以及一些元信息文件。\n如果你使用的是arch系的系统，可以在/usr/share/pacman/目录下找到一些PKGBUILD示例文件。例如：\n$ cat /usr/share/pacman/PKGBUILD.proto # This is an example PKGBUILD file. Use this as a start to creating your own, # and remove these comments. For more information, see \u0026#39;man PKGBUILD\u0026#39;. # NOTE: Please fill out the license field for your package! If it is unknown, # then please put \u0026#39;unknown\u0026#39;. # Maintainer: Your Name \u0026lt;youremail@domain.com\u0026gt; pkgname=NAME pkgver=VERSION pkgrel=1 epoch= pkgdesc=\u0026#34;\u0026#34; arch=() url=\u0026#34;\u0026#34; license=(\u0026#39;GPL\u0026#39;) groups=() depends=() makedepends=() checkdepends=() optdepends=() provides=() conflicts=() replaces=() backup=() options=() install= changelog= source=(\u0026#34;$pkgname-$pkgver.","keywords":["Linux","arch"],"articleBody":"如何在AUR上发布包 1. 准备PKGBUILD 文件  https://wiki.archlinux.org/title/PKGBUILD https://wiki.archlinux.org/title/Creating_packages\n 想要打包一个可以在AUR上发布的package， 需要使用makepkg工具，makepkg在运行时会寻找当前工作目录下的PKGBUILD文件。\n找到之后，会从PKGBUILD配置的source去获取源码并根据PKGBUILD的配置去进行编译，最终产生二进制文件以及一些元信息文件。\n如果你使用的是arch系的系统，可以在/usr/share/pacman/目录下找到一些PKGBUILD示例文件。例如：\n$ cat /usr/share/pacman/PKGBUILD.proto # This is an example PKGBUILD file. Use this as a start to creating your own, # and remove these comments. For more information, see 'man PKGBUILD'. # NOTE: Please fill out the license field for your package! If it is unknown, # then please put 'unknown'. # Maintainer: Your Name  pkgname=NAME pkgver=VERSION pkgrel=1 epoch= pkgdesc=\"\" arch=() url=\"\" license=('GPL') groups=() depends=() makedepends=() checkdepends=() optdepends=() provides=() conflicts=() replaces=() backup=() options=() install= changelog= source=(\"$pkgname-$pkgver.tar.gz\" \"$pkgname-$pkgver.patch\") noextract=() md5sums=() validpgpkeys=() prepare() { cd \"$pkgname-$pkgver\" patch -p1 -i \"$srcdir/$pkgname-$pkgver.patch\" } build() { cd \"$pkgname-$pkgver\" ./configure --prefix=/usr make } check() { cd \"$pkgname-$pkgver\" make -k check } package() { cd \"$pkgname-$pkgver\" make DESTDIR=\"$pkgdir/\" install } 文件类型是proto，不过这跟grpc的protobuf应该关系不大。。\n1.1 PKGBUILD中的常见变量 PKGBUILD中有很多字段，下面介绍一些常用的：\n pkgname: 包的名称 pkgver: 包的版本 pkgrel: 版本号，应该为一个正整数，将显示在最终打包的文件名中 pkgdesc: 包的说明，建议小于80个字符 arch: 支持的架构 url: 软件官网地址 license: 证书 depends: 依赖的包 source: 软件源地址，可以是文件路径、HTTP、FTP、Git地址 sha1sums: source中包含的文件的sha1校验值,这对于git仓库来说并不是必须的  1.2 PKGBUILD中的内建变量 除此之外，PKGBUILD还有一些内建的变量, 通过$variable的方式使用：\n srcdir: 指向 makepkg 提取或符号链接源数组中所有文件的目录，可简单理解为makepkg运行的目录 pkgdir: 指向 makepkg 打包安装包的目录，它成为构建包的根目录  1.3 PKGBUILD的内建函数 当使用makepkg构建包时，将调用PKGBUILD中存在的以下五个函数：\n注意: package()是必须的\n  prepare() 这个函数在包被提取后， 在pkgver()和build()运行。调用这个函数，将运行用于准备生成源的命令。\n  pkgver()\n  pkgver()在包被拉取、解压以及prepare()运行之后运行。你可以在这一阶段调整包的版本\n需要注意的是，在pkgver()中的输出、sed修改，都会被认为是在操作$pkgver变量\nbuild() 此函数使用 Bash 语法中的常见 shell 命令自动编译软件并创建一个名为pkg的安装软件的目录。这允许 makepkg 打包文件，而无需筛选文件系统。  build()函数的第一步是切换到解压缩源码包时创建的目录。makepkg 会在执行build()之前将$srcdir设为当前目录。因此，在大多数情况下，如/usr/share/pacman/PKGBUILD.proto中建议的那样，第一个命令将如下所示：\ncd \"$pkgname-$pkgver\" 然后，你可以在下面列出编译软件所需的命令，比如make build等\n check() 调用make check以及其他任何检查逻辑的地方。\n  package() 最后一步是将编译的文件放在一个目录中，makepkg可以在其中检索这些文件并创建包。默认情况下，这是pkg文件夹：一个“fakeroot”环境，即一个假的根目录。这个pkg目录将复制软件安装目录的根目录层次结构。例如，如果你要安装一个文件到/usr/bin，则应将其放在$pkgdir/usr/bin中，\n  1.4 检查PKGBUILD的语法 使用namcap进行检查\n$ namcap PKGBUILD 2. 实战进行打包 2.1 打包本地二进制文件 准备一个可执行文件hello, 该文件的作用是输出\"hello aur\"，存放在workspace目录中：\nmkdir workspace \u0026\u0026 cd workspace mv /path/to/hello . 计算出hello文件的md5:\n$ md5sum hello 2acd771608bd1552ae27795a864d87ac hello 在当前目录下创建PKGBUILD文件，内容如下:\n# Maintainer: Crest Lee  pkgname=hello pkgver=0.1 pkgrel=1 pkgdesc='say hello to everyone' arch=('any') license=('GPL3') source=(\"$srcdir/hello\") md5sums=('2acd771608bd1552ae27795a864d87ac') package() { cd $srcdir mkdir -p $pkgdir/usr/bin install hello $pkgdir/usr/bin/$pkgname } 然后执行：\n$ makepkg == 正在创建软件包：hello 0.1-1 (2023年02月10日 星期五 18时27分27秒) == 正在检查运行时依赖关系... == 正在检查编译时依赖关系== 获取源代码... - 找到 hello == 正在验证 source 文件，使用md5sums... hello ... 通过== 正在释放源码... == 正在删除现存的 $pkgdir/ 目录... == 正在进入 fakeroot 环境... == 正在开始 package()... == 正在清理安装... - 正在删除 libtool 文件... - 正在清除不打算要的文件... - 正在移除静态库文件... - 正在从二进制文件和库中清除不需要的系统符号... - 正在压缩 man 及 info 文档... == 正在检查打包问题... == 正在构建软件包\"hello\"... - 正在生成 .PKGINFO 文件... - 正在生成 .BUILDINFO 文件... - 正在生成 .MTREE 文件... - 正在压缩软件包... == 正在离开 fakeroot 环境。== 完成创建：hello 0.1-1 (2023年02月10日 星期五 18时27分28秒) 构建完成后，workspace的目录结构为：\n. ├── hello ├── hello-0.1-1-any.pkg.tar.zst ├── pkg │ └── hello │ ├── .BUILDINFO │ ├── .MTREE │ ├── .PKGINFO │ └── usr │ └── bin │ └── hello ├── PKGBUILD └── src └── hello - /path/to/hello 可以看到，生成了一些元信息文件。打包结果为：hello-0.1-1-any.pkg.tar.zst\n安装它：\n$ sudo pacman -U hello-0.1-1-any.pkg.tar.zst 测试：\n$ hello hello world $ which hello /usr/bin/hello 卸载这个包：\n$ sudo pacman -R hello 完成\n2.2 打包git仓库 准备一个git仓库：https://github.com/yangchnet/hello-aur\n这是一个golang语言编写的简单程序，输出\nhello, aur. Version:  因此，在本例中，你可能需要安装golang。\n新建一个工作目录：\nmkdir workspace \u0026\u0026 cd workspace 创建一个PKGBUILD文件，内容如下：\n# Maintainer: yangchent 1048887414@qq.com _pkgname=hello-aur pkgname=\"$_pkgname\"-git pkgver=1 pkgrel=1 pkgdesc=\"say hello to aur in your computer\" arch=(\"any\") license=('GPL') source=(\"git+https://github.com/yangchnet/$_pkgname.git\") md5sums=(\"SKIP\") pkgver() { cd \"$_pkgname\" printf \"r%s.%s\" \"$(git rev-list --count HEAD)\" \"$(git rev-parse --short=8 HEAD)\" sed -i 's/{{.version}}/'$pkgver'/' main.go } build() { cd \"$_pkgname\" go build -o hello-aur main.go } check() { cd \"$_pkgname\" if [ -f \"hello-aur\" ];then echo \"检查通过\" else exit 1 fi } package() { cd \"$_pkgname\" mkdir -p $pkgdir/usr/bin mv hello-aur $pkgdir/usr/bin/hello-aur } 这里跟构建本地二进制文件有点不同，例如\n  pkgname必须以”-git“结尾\n  source必须符合’project_name::git+https://project_url#branch=project_branch’的格式\n  对于md5或sha1的验证可以通过配置\"SKIP\"略过，因为git本身已经进行了验证\n  需要参考：https://wiki.archlinux.org/title/VCS_package_guidelines#top-page https://bbs.archlinux.org/viewtopic.php?id=223966\n构建：\n$ makepkg 安装：\n$ sudo pacman -U hello-aur-git-r1.9f29fc45-1-any.pkg.tar.zst 测试：\n$ hello-aur hello, aur. Version: 1 这里需要注意，看一下pkgver()函数，我们在最后将代码内部{{.Version}}替换为由git commit id组成的版本号，但并没有生效，仍然是初始的1，这可能表明：$pkgver是在pkgver()函数结束后才被赋值的。\n卸载:\nsudo pacman -R hello-aur-git # 注意pkgname多了\"-git\"后缀 3. 发布 TODO\nReferences https://wiki.archlinux.org/title/Arch_User_Repository#top-page\nhttps://wiki.archlinux.org/title/Makepkg\nhttps://wiki.archlinux.org/title/PKGBUILD\nhttps://wiki.archlinux.org/title/Creating_packages\nhttps://wiki.archlinux.org/title/VCS_package_guidelines#top-page\n","wordCount":"517","inLanguage":"en","datePublished":"2023-02-10T00:00:00Z","dateModified":"2023-02-10T00:00:00Z","author":{"@type":"Person","name":"李昌"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://yangchnet.github.io/posts/linux/%E5%9C%A8aur%E4%B8%8A%E5%8F%91%E5%B8%83%E5%8C%85/"},"publisher":{"@type":"Organization","name":"Linote","logo":{"@type":"ImageObject","url":"https://raw.githubusercontent.com/lich-Img/blogImg/master/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><header class=header><nav class=nav><div class=logo><a href=http://yangchnet.github.io/ accesskey=h title="Linote (Alt + H)">Linote</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=http://yangchnet.github.io/archives/ title=存档><span>存档</span></a></li><li><a href=http://yangchnet.github.io/categories/ title=分类><span>分类</span></a></li><li><a href=http://yangchnet.github.io/search/ title=搜索><span>搜索</span></a></li><li><a href=http://yangchnet.github.io/tags/ title=标签><span>标签</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://yangchnet.github.io/>Home</a>&nbsp;»&nbsp;<a href=http://yangchnet.github.io/posts/>Posts</a></div><h1 class=post-title>在AUR上发布包</h1><div class=post-meta><span title="2023-02-10 00:00:00 +0000 UTC">February 10, 2023</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;李昌</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e5%a6%82%e4%bd%95%e5%9c%a8aur%e4%b8%8a%e5%8f%91%e5%b8%83%e5%8c%85 aria-label=如何在AUR上发布包>如何在AUR上发布包</a><ul><li><a href=#1-%e5%87%86%e5%a4%87pkgbuild-%e6%96%87%e4%bb%b6 aria-label="1. 准备PKGBUILD 文件">1. 准备<code>PKGBUILD</code> 文件</a><ul><li><a href=#11-pkgbuild%e4%b8%ad%e7%9a%84%e5%b8%b8%e8%a7%81%e5%8f%98%e9%87%8f aria-label="1.1 PKGBUILD中的常见变量">1.1 <code>PKGBUILD</code>中的常见变量</a></li><li><a href=#12-pkgbuild%e4%b8%ad%e7%9a%84%e5%86%85%e5%bb%ba%e5%8f%98%e9%87%8f aria-label="1.2 PKGBUILD中的内建变量">1.2 <code>PKGBUILD</code>中的内建变量</a></li><li><a href=#13-pkgbuild%e7%9a%84%e5%86%85%e5%bb%ba%e5%87%bd%e6%95%b0 aria-label="1.3 PKGBUILD的内建函数">1.3 <code>PKGBUILD</code>的内建函数</a></li><li><a href=#14-%e6%a3%80%e6%9f%a5pkgbuild%e7%9a%84%e8%af%ad%e6%b3%95 aria-label="1.4 检查PKGBUILD的语法">1.4 检查<code>PKGBUILD</code>的语法</a></li></ul></li><li><a href=#2-%e5%ae%9e%e6%88%98%e8%bf%9b%e8%a1%8c%e6%89%93%e5%8c%85 aria-label="2. 实战进行打包">2. 实战进行打包</a><ul><li><a href=#21-%e6%89%93%e5%8c%85%e6%9c%ac%e5%9c%b0%e4%ba%8c%e8%bf%9b%e5%88%b6%e6%96%87%e4%bb%b6 aria-label="2.1 打包本地二进制文件">2.1 打包本地二进制文件</a></li><li><a href=#22-%e6%89%93%e5%8c%85git%e4%bb%93%e5%ba%93 aria-label="2.2 打包git仓库">2.2 打包git仓库</a></li></ul></li><li><a href=#3-%e5%8f%91%e5%b8%83 aria-label="3. 发布">3. 发布</a></li><li><a href=#references aria-label=References>References</a></li></ul></li></ul></div></details></div><div class=post-content><h1 id=如何在aur上发布包>如何在AUR上发布包<a hidden class=anchor aria-hidden=true href=#如何在aur上发布包>#</a></h1><h2 id=1-准备pkgbuild-文件>1. 准备<code>PKGBUILD</code> 文件<a hidden class=anchor aria-hidden=true href=#1-准备pkgbuild-文件>#</a></h2><blockquote><p><a href=https://wiki.archlinux.org/title/PKGBUILD>https://wiki.archlinux.org/title/PKGBUILD</a>
<a href=https://wiki.archlinux.org/title/Creating_packages>https://wiki.archlinux.org/title/Creating_packages</a></p></blockquote><p>想要打包一个可以在AUR上发布的package， 需要使用<code>makepkg</code>工具，<code>makepkg</code>在运行时会寻找当前工作目录下的<code>PKGBUILD</code>文件。</p><p>找到之后，会从<code>PKGBUILD</code>配置的<code>source</code>去获取源码并根据<code>PKGBUILD</code>的配置去进行编译，最终产生二进制文件以及一些元信息文件。</p><p>如果你使用的是arch系的系统，可以在<code>/usr/share/pacman/</code>目录下找到一些PKGBUILD示例文件。例如：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ cat /usr/share/pacman/PKGBUILD.proto
<span style=color:#75715e># This is an example PKGBUILD file. Use this as a start to creating your own,</span>
<span style=color:#75715e># and remove these comments. For more information, see &#39;man PKGBUILD&#39;.</span>
<span style=color:#75715e># NOTE: Please fill out the license field for your package! If it is unknown,</span>
<span style=color:#75715e># then please put &#39;unknown&#39;.</span>

<span style=color:#75715e># Maintainer: Your Name &lt;youremail@domain.com&gt;</span>
pkgname<span style=color:#f92672>=</span>NAME
pkgver<span style=color:#f92672>=</span>VERSION
pkgrel<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
epoch<span style=color:#f92672>=</span>
pkgdesc<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>
arch<span style=color:#f92672>=()</span>
url<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>
license<span style=color:#f92672>=(</span><span style=color:#e6db74>&#39;GPL&#39;</span><span style=color:#f92672>)</span>
groups<span style=color:#f92672>=()</span>
depends<span style=color:#f92672>=()</span>
makedepends<span style=color:#f92672>=()</span>
checkdepends<span style=color:#f92672>=()</span>
optdepends<span style=color:#f92672>=()</span>
provides<span style=color:#f92672>=()</span>
conflicts<span style=color:#f92672>=()</span>
replaces<span style=color:#f92672>=()</span>
backup<span style=color:#f92672>=()</span>
options<span style=color:#f92672>=()</span>
install<span style=color:#f92672>=</span>
changelog<span style=color:#f92672>=</span>
source<span style=color:#f92672>=(</span><span style=color:#e6db74>&#34;</span>$pkgname<span style=color:#e6db74>-</span>$pkgver<span style=color:#e6db74>.tar.gz&#34;</span>
        <span style=color:#e6db74>&#34;</span>$pkgname<span style=color:#e6db74>-</span>$pkgver<span style=color:#e6db74>.patch&#34;</span><span style=color:#f92672>)</span>
noextract<span style=color:#f92672>=()</span>
md5sums<span style=color:#f92672>=()</span>
validpgpkeys<span style=color:#f92672>=()</span>

prepare<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
        cd <span style=color:#e6db74>&#34;</span>$pkgname<span style=color:#e6db74>-</span>$pkgver<span style=color:#e6db74>&#34;</span>
        patch -p1 -i <span style=color:#e6db74>&#34;</span>$srcdir<span style=color:#e6db74>/</span>$pkgname<span style=color:#e6db74>-</span>$pkgver<span style=color:#e6db74>.patch&#34;</span>
<span style=color:#f92672>}</span>

build<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
        cd <span style=color:#e6db74>&#34;</span>$pkgname<span style=color:#e6db74>-</span>$pkgver<span style=color:#e6db74>&#34;</span>
        ./configure --prefix<span style=color:#f92672>=</span>/usr
        make
<span style=color:#f92672>}</span>

check<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
        cd <span style=color:#e6db74>&#34;</span>$pkgname<span style=color:#e6db74>-</span>$pkgver<span style=color:#e6db74>&#34;</span>
        make -k check
<span style=color:#f92672>}</span>

package<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
        cd <span style=color:#e6db74>&#34;</span>$pkgname<span style=color:#e6db74>-</span>$pkgver<span style=color:#e6db74>&#34;</span>
        make DESTDIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$pkgdir<span style=color:#e6db74>/&#34;</span> install
<span style=color:#f92672>}</span>

</code></pre></div><p>文件类型是proto，不过这跟grpc的protobuf应该关系不大。。</p><h3 id=11-pkgbuild中的常见变量>1.1 <code>PKGBUILD</code>中的常见变量<a hidden class=anchor aria-hidden=true href=#11-pkgbuild中的常见变量>#</a></h3><p>PKGBUILD中有很多字段，下面介绍一些常用的：</p><ul><li><code>pkgname</code>: 包的名称</li><li><code>pkgver</code>: 包的版本</li><li><code>pkgrel</code>: 版本号，应该为一个正整数，将显示在最终打包的文件名中</li><li><code>pkgdesc</code>: 包的说明，建议小于80个字符</li><li><code>arch</code>: 支持的架构</li><li><code>url</code>: 软件官网地址</li><li><code>license</code>: 证书</li><li><code>depends</code>: 依赖的包</li><li><code>source</code>: 软件源地址，可以是文件路径、HTTP、FTP、Git地址</li><li><code>sha1sums</code>: source中包含的文件的sha1校验值,这对于git仓库来说并不是必须的</li></ul><h3 id=12-pkgbuild中的内建变量>1.2 <code>PKGBUILD</code>中的内建变量<a hidden class=anchor aria-hidden=true href=#12-pkgbuild中的内建变量>#</a></h3><p>除此之外，<code>PKGBUILD</code>还有一些内建的变量, 通过<code>$variable</code>的方式使用：</p><ul><li><code>srcdir</code>: 指向 makepkg 提取或符号链接源数组中所有文件的目录，可简单理解为makepkg运行的目录</li><li><code>pkgdir</code>: 指向 makepkg 打包安装包的目录，它成为构建包的根目录</li></ul><h3 id=13-pkgbuild的内建函数>1.3 <code>PKGBUILD</code>的内建函数<a hidden class=anchor aria-hidden=true href=#13-pkgbuild的内建函数>#</a></h3><p>当使用<code>makepkg</code>构建包时，将调用<code>PKGBUILD</code>中存在的以下五个函数：</p><p><strong>注意: <code>package()</code>是必须的</strong></p><ol><li><p><code>prepare()</code>
这个函数在包被提取后， 在<code>pkgver()</code>和<code>build()</code>运行。调用这个函数，将运行用于准备生成源的命令。</p></li><li><p><code>pkgver()</code></p></li></ol><p><code>pkgver()</code>在包被拉取、解压以及<code>prepare()</code>运行之后运行。你可以在这一阶段调整包的版本</p><p>需要注意的是，在<code>pkgver()</code>中的输出、sed修改，都会被认为是在操作<code>$pkgver</code>变量</p><ol start=3><li><code>build()</code>
此函数使用 Bash 语法中的常见 shell 命令自动编译软件并创建一个名为<code>pkg</code>的安装软件的目录。这允许 makepkg 打包文件，而无需筛选文件系统。</li></ol><p><code>build()</code>函数的第一步是切换到解压缩源码包时创建的目录。makepkg 会在执行<code>build()</code>之前将<code>$srcdir</code>设为当前目录。因此，在大多数情况下，如<code>/usr/share/pacman/PKGBUILD.proto</code>中建议的那样，第一个命令将如下所示：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>cd <span style=color:#e6db74>&#34;</span>$pkgname<span style=color:#e6db74>-</span>$pkgver<span style=color:#e6db74>&#34;</span>
</code></pre></div><p>然后，你可以在下面列出编译软件所需的命令，比如<code>make build</code>等</p><ol start=4><li><p><code>check()</code>
调用<code>make check</code>以及其他任何检查逻辑的地方。</p></li><li><p><code>package()</code>
最后一步是将编译的文件放在一个目录中，<code>makepkg</code>可以在其中检索这些文件并创建包。默认情况下，这是<code>pkg</code>文件夹：一个“fakeroot”环境，即一个假的根目录。这个<code>pkg</code>目录将复制软件安装目录的根目录层次结构。例如，如果你要安装一个文件到<code>/usr/bin</code>，则应将其放在<code>$pkgdir/usr/bin</code>中，</p></li></ol><h3 id=14-检查pkgbuild的语法>1.4 检查<code>PKGBUILD</code>的语法<a hidden class=anchor aria-hidden=true href=#14-检查pkgbuild的语法>#</a></h3><p>使用<code>namcap</code>进行检查</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ namcap PKGBUILD
</code></pre></div><h2 id=2-实战进行打包>2. 实战进行打包<a hidden class=anchor aria-hidden=true href=#2-实战进行打包>#</a></h2><h3 id=21-打包本地二进制文件>2.1 打包本地二进制文件<a hidden class=anchor aria-hidden=true href=#21-打包本地二进制文件>#</a></h3><p>准备一个可执行文件<code>hello</code>, 该文件的作用是输出"hello aur"，存放在workspace目录中：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>mkdir workspace <span style=color:#f92672>&amp;&amp;</span> cd workspace
mv /path/to/hello .
</code></pre></div><p>计算出<code>hello</code>文件的md5:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ md5sum hello
2acd771608bd1552ae27795a864d87ac hello
</code></pre></div><p>在当前目录下创建<code>PKGBUILD</code>文件，内容如下:</p><pre><code># Maintainer: Crest Lee &lt;crest@selefra.io&gt;
pkgname=hello
pkgver=0.1
pkgrel=1
pkgdesc='say hello to everyone'
arch=('any')
license=('GPL3')
source=(&quot;$srcdir/hello&quot;)
md5sums=('2acd771608bd1552ae27795a864d87ac')

package() {
        cd $srcdir
        mkdir -p $pkgdir/usr/bin
        install hello $pkgdir/usr/bin/$pkgname
}
</code></pre><p>然后执行：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ makepkg

<span style=color:#f92672>==</span>&gt; 正在创建软件包：hello 0.1-1 <span style=color:#f92672>(</span>2023年02月10日 星期五 18时27分27秒<span style=color:#f92672>)</span>
<span style=color:#f92672>==</span>&gt; 正在检查运行时依赖关系...
<span style=color:#f92672>==</span>&gt; 正在检查编译时依赖关系<span style=color:#f92672>==</span>&gt; 获取源代码...
  -&gt; 找到 hello
<span style=color:#f92672>==</span>&gt; 正在验证 source 文件，使用md5sums...
    hello ... 通过<span style=color:#f92672>==</span>&gt; 正在释放源码...
<span style=color:#f92672>==</span>&gt; 正在删除现存的 $pkgdir/ 目录...
<span style=color:#f92672>==</span>&gt; 正在进入 fakeroot 环境...
<span style=color:#f92672>==</span>&gt; 正在开始 package<span style=color:#f92672>()</span>...
<span style=color:#f92672>==</span>&gt; 正在清理安装...
  -&gt; 正在删除 libtool 文件...
  -&gt; 正在清除不打算要的文件...
  -&gt; 正在移除静态库文件...
  -&gt; 正在从二进制文件和库中清除不需要的系统符号...
  -&gt; 正在压缩 man 及 info 文档...
<span style=color:#f92672>==</span>&gt; 正在检查打包问题...
<span style=color:#f92672>==</span>&gt; 正在构建软件包<span style=color:#e6db74>&#34;hello&#34;</span>...
  -&gt; 正在生成 .PKGINFO 文件...
  -&gt; 正在生成 .BUILDINFO 文件...
  -&gt; 正在生成 .MTREE 文件...
  -&gt; 正在压缩软件包...
<span style=color:#f92672>==</span>&gt; 正在离开 fakeroot 环境。<span style=color:#f92672>==</span>&gt; 完成创建：hello 0.1-1 <span style=color:#f92672>(</span>2023年02月10日 星期五 18时27分28秒<span style=color:#f92672>)</span>
</code></pre></div><p>构建完成后，workspace的目录结构为：</p><pre><code>.
├── hello
├── hello-0.1-1-any.pkg.tar.zst
├── pkg
│   └── hello
│       ├── .BUILDINFO
│       ├── .MTREE
│       ├── .PKGINFO
│       └── usr
│           └── bin
│               └── hello
├── PKGBUILD
└── src
    └── hello -&gt; /path/to/hello
</code></pre><p>可以看到，生成了一些元信息文件。打包结果为：hello-0.1-1-any.pkg.tar.zst</p><p>安装它：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo pacman -U hello-0.1-1-any.pkg.tar.zst
</code></pre></div><p>测试：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ hello
hello world

$ which hello
/usr/bin/hello
</code></pre></div><p>卸载这个包：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo pacman -R hello
</code></pre></div><p>完成</p><h3 id=22-打包git仓库>2.2 打包git仓库<a hidden class=anchor aria-hidden=true href=#22-打包git仓库>#</a></h3><p>准备一个git仓库：https://github.com/yangchnet/hello-aur</p><p>这是一个golang语言编写的简单程序，输出</p><pre><code>hello, aur. Version: &lt;version&gt;
</code></pre><p>因此，在本例中，你可能需要安装golang。</p><p>新建一个工作目录：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>mkdir workspace <span style=color:#f92672>&amp;&amp;</span> cd workspace
</code></pre></div><p>创建一个<code>PKGBUILD</code>文件，内容如下：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-PKGBUILD data-lang=PKGBUILD><span style=color:#75715e># Maintainer: yangchent 1048887414@qq.com</span>
_pkgname<span style=color:#f92672>=</span>hello-aur
pkgname<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$_pkgname<span style=color:#e6db74>&#34;</span>-git
pkgver<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
pkgrel<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
pkgdesc<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;say hello to aur in your computer&#34;</span>
arch<span style=color:#f92672>=(</span><span style=color:#e6db74>&#34;any&#34;</span><span style=color:#f92672>)</span>
license<span style=color:#f92672>=(</span><span style=color:#e6db74>&#39;GPL&#39;</span><span style=color:#f92672>)</span>
source<span style=color:#f92672>=(</span><span style=color:#e6db74>&#34;git+https://github.com/yangchnet/</span>$_pkgname<span style=color:#e6db74>.git&#34;</span><span style=color:#f92672>)</span>
md5sums<span style=color:#f92672>=(</span><span style=color:#e6db74>&#34;SKIP&#34;</span><span style=color:#f92672>)</span>

pkgver<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
    cd <span style=color:#e6db74>&#34;</span>$_pkgname<span style=color:#e6db74>&#34;</span>
    printf <span style=color:#e6db74>&#34;r%s.%s&#34;</span> <span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>git rev-list --count HEAD<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>git rev-parse --short<span style=color:#f92672>=</span><span style=color:#ae81ff>8</span> HEAD<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
    sed -i <span style=color:#e6db74>&#39;s/{{.version}}/&#39;</span>$pkgver<span style=color:#e6db74>&#39;/&#39;</span> main.go
<span style=color:#f92672>}</span>

build<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
    cd <span style=color:#e6db74>&#34;</span>$_pkgname<span style=color:#e6db74>&#34;</span>
    go build -o hello-aur main.go
<span style=color:#f92672>}</span>

check<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
    cd <span style=color:#e6db74>&#34;</span>$_pkgname<span style=color:#e6db74>&#34;</span>
    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> -f <span style=color:#e6db74>&#34;hello-aur&#34;</span> <span style=color:#f92672>]</span>;<span style=color:#66d9ef>then</span>
        echo <span style=color:#e6db74>&#34;检查通过&#34;</span>
    <span style=color:#66d9ef>else</span>
        exit <span style=color:#ae81ff>1</span>
    <span style=color:#66d9ef>fi</span>
<span style=color:#f92672>}</span>

package<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
    cd <span style=color:#e6db74>&#34;</span>$_pkgname<span style=color:#e6db74>&#34;</span>
    mkdir -p $pkgdir/usr/bin
    mv hello-aur $pkgdir/usr/bin/hello-aur
<span style=color:#f92672>}</span>
</code></pre></div><p>这里跟构建本地二进制文件有点不同，例如</p><ul><li><p>pkgname必须以”-git“结尾</p></li><li><p>source必须符合&rsquo;project_name::git+https://project_url#branch=project_branch&rsquo;的格式</p></li><li><p>对于md5或sha1的验证可以通过配置"SKIP"略过，因为git本身已经进行了验证</p></li></ul><p>需要参考：https://wiki.archlinux.org/title/VCS_package_guidelines#top-page
<a href="https://bbs.archlinux.org/viewtopic.php?id=223966">https://bbs.archlinux.org/viewtopic.php?id=223966</a></p><p>构建：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ makepkg
</code></pre></div><p>安装：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo pacman -U hello-aur-git-r1.9f29fc45-1-any.pkg.tar.zst
</code></pre></div><p>测试：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ hello-aur
hello, aur. Version: <span style=color:#ae81ff>1</span>
</code></pre></div><p>这里需要注意，看一下pkgver()函数，我们在最后将代码内部{{.Version}}替换为由git commit id组成的版本号，但并没有生效，仍然是初始的1，这可能表明：<code>$pkgver</code>是在<code>pkgver()</code>函数结束后才被赋值的。</p><p>卸载:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>sudo pacman -R hello-aur-git <span style=color:#75715e># 注意pkgname多了&#34;-git&#34;后缀</span>
</code></pre></div><h2 id=3-发布>3. 发布<a hidden class=anchor aria-hidden=true href=#3-发布>#</a></h2><p>TODO</p><h2 id=references>References<a hidden class=anchor aria-hidden=true href=#references>#</a></h2><p><a href=https://wiki.archlinux.org/title/Arch_User_Repository#top-page>https://wiki.archlinux.org/title/Arch_User_Repository#top-page</a></p><p><a href=https://wiki.archlinux.org/title/Makepkg>https://wiki.archlinux.org/title/Makepkg</a></p><p><a href=https://wiki.archlinux.org/title/PKGBUILD>https://wiki.archlinux.org/title/PKGBUILD</a></p><p><a href=https://wiki.archlinux.org/title/Creating_packages>https://wiki.archlinux.org/title/Creating_packages</a></p><p><a href=https://wiki.archlinux.org/title/VCS_package_guidelines#top-page>https://wiki.archlinux.org/title/VCS_package_guidelines#top-page</a></p></div><footer class=post-footer><ul class=post-tags><li><a href=http://yangchnet.github.io/tags/linux/>Linux</a></li><li><a href=http://yangchnet.github.io/tags/arch/>arch</a></li></ul><nav class=paginav><a class=prev href=http://yangchnet.github.io/posts/linux/manjaro%E6%81%A2%E5%A4%8Dgrub/><span class=title>« Prev Page</span><br><span>Manjaro恢复grub</span></a>
<a class=next href=http://yangchnet.github.io/posts/python/python%E7%94%9F%E6%88%90%E5%99%A8%E5%87%BD%E6%95%B0%E5%92%8Cgo%E9%80%9A%E9%81%93/><span class=title>Next Page »</span><br><span>python生成器函数和go通道</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href=http://yangchnet.github.io/>Linote</a></span>
<script src=https://utteranc.es/client.js repo=yangchnet/Dessert issue-term=pathname theme=github-light crossorigin=anonymous async></script><span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script></body></html>