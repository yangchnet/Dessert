<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>inotify | Linote</title><meta name=keywords content="Linux"><meta name=description content="1. 什么是inotify Inotify API提供了一种监视文件系统的机制事件。 Inotify可用于监视单个文件或监视目录。当监视目录时，Inotify将返回目录本身的事件，以及内部的文件目录。
简单的说，就是inotify可以为你监控文件系统的变化，在发生一些事件时通知你。
2. 实验 需要安装inotify-tools包
# arch系统 yay -S inotify-tools inotify-tools提供了两个命令：inotifywait和inotifywatch
2.1 inotifywait 先来看inotifywait,它被用来&#34;Wait for a particular event on a file or set of files.&#34;, 也就是说等待在文件上的某些事件发生。使用inotifywait -h查看其支持的参数：
-h show this help info --exclude <pattern> 排除匹配所给正则的所有事件 --excludei <pattern> 类似前一个命令但非敏感 --include <pattern> 排除除匹配正则之外的所有事件 --includei <pattern> 类似前一个命令但非敏感 -m|--monitor 在timeout之前保持监听，若不设置此标志，inotifywait将在一个事件后退出。 -d|--daemon 类似前一个命令但在后台运行，将日志输出到`--outfile`所指定的文件 -P|--no-dereference 不跟踪符号链接 -r|--recursive 递归的监听、 --fromfile <file> Read files to watch from <file> or `-' for stdin. -o|--outfile <file> 输出到<file>而不是标准输出 -s|--syslog 向syslog发送错误而不是Stderr -q|--quiet 只输出事件 -qq 啥也不输出 --format <fmt> 以特定格式输出 --no-newline 在格式化输出后不打印换行符 --timefmt <fmt> strftime-compatible format string for use with %T in --format string."><meta name=author content="李昌"><link rel=canonical href=http://yangchnet.github.io/Dessert/posts/linux/inotify/><link crossorigin=anonymous href=/Dessert/assets/css/stylesheet.min.7e145c6c051b0f6645e8d84c6faed7fed1214bbe82c223c2c19815bee6ee8403.css integrity="sha256-fhRcbAUbD2ZF6NhMb67X/tEhS76CwiPCwZgVvubuhAM=" rel="preload stylesheet" as=style><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Fira+Mono&display=swap" rel=stylesheet><script defer crossorigin=anonymous src=/Dessert/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://raw.githubusercontent.com/lich-Img/blogImg/master/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://raw.githubusercontent.com/lich-Img/blogImg/master/favicon.ico><link rel=icon type=image/png sizes=32x32 href=https://raw.githubusercontent.com/lich-Img/blogImg/master/favicon32.ico><link rel=apple-touch-icon href=http://yangchnet.github.io/Dessert/apple-touch-icon.png><link rel=mask-icon href=http://yangchnet.github.io/Dessert/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.81.0"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="inotify"><meta property="og:description" content="1. 什么是inotify Inotify API提供了一种监视文件系统的机制事件。 Inotify可用于监视单个文件或监视目录。当监视目录时，Inotify将返回目录本身的事件，以及内部的文件目录。
简单的说，就是inotify可以为你监控文件系统的变化，在发生一些事件时通知你。
2. 实验 需要安装inotify-tools包
# arch系统 yay -S inotify-tools inotify-tools提供了两个命令：inotifywait和inotifywatch
2.1 inotifywait 先来看inotifywait,它被用来&#34;Wait for a particular event on a file or set of files.&#34;, 也就是说等待在文件上的某些事件发生。使用inotifywait -h查看其支持的参数：
-h show this help info --exclude <pattern> 排除匹配所给正则的所有事件 --excludei <pattern> 类似前一个命令但非敏感 --include <pattern> 排除除匹配正则之外的所有事件 --includei <pattern> 类似前一个命令但非敏感 -m|--monitor 在timeout之前保持监听，若不设置此标志，inotifywait将在一个事件后退出。 -d|--daemon 类似前一个命令但在后台运行，将日志输出到`--outfile`所指定的文件 -P|--no-dereference 不跟踪符号链接 -r|--recursive 递归的监听、 --fromfile <file> Read files to watch from <file> or `-' for stdin. -o|--outfile <file> 输出到<file>而不是标准输出 -s|--syslog 向syslog发送错误而不是Stderr -q|--quiet 只输出事件 -qq 啥也不输出 --format <fmt> 以特定格式输出 --no-newline 在格式化输出后不打印换行符 --timefmt <fmt> strftime-compatible format string for use with %T in --format string."><meta property="og:type" content="article"><meta property="og:url" content="http://yangchnet.github.io/Dessert/posts/linux/inotify/"><meta property="og:image" content="http://yangchnet.github.io/Dessert/papermod-cover.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-07-04T00:00:00+00:00"><meta property="article:modified_time" content="2022-07-04T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://yangchnet.github.io/Dessert/papermod-cover.png"><meta name=twitter:title content="inotify"><meta name=twitter:description content="1. 什么是inotify Inotify API提供了一种监视文件系统的机制事件。 Inotify可用于监视单个文件或监视目录。当监视目录时，Inotify将返回目录本身的事件，以及内部的文件目录。
简单的说，就是inotify可以为你监控文件系统的变化，在发生一些事件时通知你。
2. 实验 需要安装inotify-tools包
# arch系统 yay -S inotify-tools inotify-tools提供了两个命令：inotifywait和inotifywatch
2.1 inotifywait 先来看inotifywait,它被用来&#34;Wait for a particular event on a file or set of files.&#34;, 也就是说等待在文件上的某些事件发生。使用inotifywait -h查看其支持的参数：
-h show this help info --exclude <pattern> 排除匹配所给正则的所有事件 --excludei <pattern> 类似前一个命令但非敏感 --include <pattern> 排除除匹配正则之外的所有事件 --includei <pattern> 类似前一个命令但非敏感 -m|--monitor 在timeout之前保持监听，若不设置此标志，inotifywait将在一个事件后退出。 -d|--daemon 类似前一个命令但在后台运行，将日志输出到`--outfile`所指定的文件 -P|--no-dereference 不跟踪符号链接 -r|--recursive 递归的监听、 --fromfile <file> Read files to watch from <file> or `-' for stdin. -o|--outfile <file> 输出到<file>而不是标准输出 -s|--syslog 向syslog发送错误而不是Stderr -q|--quiet 只输出事件 -qq 啥也不输出 --format <fmt> 以特定格式输出 --no-newline 在格式化输出后不打印换行符 --timefmt <fmt> strftime-compatible format string for use with %T in --format string."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"http://yangchnet.github.io/Dessert/posts/"},{"@type":"ListItem","position":3,"name":"inotify","item":"http://yangchnet.github.io/Dessert/posts/linux/inotify/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"inotify","name":"inotify","description":"1. 什么是inotify Inotify API提供了一种监视文件系统的机制事件。 Inotify可用于监视单个文件或监视目录。当监视目录时，Inotify将返回目录本身的事件，以及内部的文件目录。\n简单的说，就是inotify可以为你监控文件系统的变化，在发生一些事件时通知你。\n2. 实验 需要安装inotify-tools包\n# arch系统 yay -S inotify-tools inotify-tools提供了两个命令：inotifywait和inotifywatch\n2.1 inotifywait 先来看inotifywait,它被用来\u0026quot;Wait for a particular event on a file or set of files.\u0026quot;, 也就是说等待在文件上的某些事件发生。使用inotifywait -h查看其支持的参数：\n-h show this help info --exclude \u0026lt;pattern\u0026gt; 排除匹配所给正则的所有事件 --excludei \u0026lt;pattern\u0026gt; 类似前一个命令但非敏感 --include \u0026lt;pattern\u0026gt; 排除除匹配正则之外的所有事件 --includei \u0026lt;pattern\u0026gt; 类似前一个命令但非敏感 -m|--monitor 在timeout之前保持监听，若不设置此标志，inotifywait将在一个事件后退出。 -d|--daemon 类似前一个命令但在后台运行，将日志输出到`--outfile`所指定的文件 -P|--no-dereference 不跟踪符号链接 -r|--recursive 递归的监听、 --fromfile \u0026lt;file\u0026gt; Read files to watch from \u0026lt;file\u0026gt; or `-' for stdin. -o|--outfile \u0026lt;file\u0026gt; 输出到\u0026lt;file\u0026gt;而不是标准输出 -s|--syslog 向syslog发送错误而不是Stderr -q|--quiet 只输出事件 -qq 啥也不输出 --format \u0026lt;fmt\u0026gt; 以特定格式输出 --no-newline 在格式化输出后不打印换行符 --timefmt \u0026lt;fmt\u0026gt; strftime-compatible format string for use with %T in --format string.","keywords":["Linux"],"articleBody":"1. 什么是inotify Inotify API提供了一种监视文件系统的机制事件。 Inotify可用于监视单个文件或监视目录。当监视目录时，Inotify将返回目录本身的事件，以及内部的文件目录。\n简单的说，就是inotify可以为你监控文件系统的变化，在发生一些事件时通知你。\n2. 实验 需要安装inotify-tools包\n# arch系统 yay -S inotify-tools inotify-tools提供了两个命令：inotifywait和inotifywatch\n2.1 inotifywait 先来看inotifywait,它被用来\"Wait for a particular event on a file or set of files.\", 也就是说等待在文件上的某些事件发生。使用inotifywait -h查看其支持的参数：\n-h show this help info --exclude  排除匹配所给正则的所有事件 --excludei  类似前一个命令但非敏感 --include  排除除匹配正则之外的所有事件 --includei  类似前一个命令但非敏感 -m|--monitor 在timeout之前保持监听，若不设置此标志，inotifywait将在一个事件后退出。 -d|--daemon 类似前一个命令但在后台运行，将日志输出到`--outfile`所指定的文件 -P|--no-dereference 不跟踪符号链接 -r|--recursive 递归的监听、 --fromfile  Read files to watch from  or `-' for stdin. -o|--outfile  输出到而不是标准输出 -s|--syslog 向syslog发送错误而不是Stderr -q|--quiet 只输出事件 -qq 啥也不输出 --format  以特定格式输出 --no-newline 在格式化输出后不打印换行符 --timefmt  strftime-compatible format string for use with %T in --format string. -c|--csv 以csv格式输出 -t|--timeout  当监听一个事件时，在秒后超时 -e|--event  监听特定事件，若不设置，则监听所有事件 支持的event有：\nEvents: access file or directory contents were read modify file or directory contents were written attrib file or directory attributes changed close_write file or directory closed, after being opened in writable mode close_nowrite file or directory closed, after being opened in read-only mode close file or directory closed, regardless of read/write mode open file or directory opened moved_to file or directory moved to watched directory moved_from file or directory moved from watched directory move file or directory moved to or from watched directory move_self A watched file or directory was moved. create file or directory created within watched directory delete file or directory deleted within watched directory delete_self file or directory was deleted unmount file system containing file or directory unmounted 在终端1中：\nmkdir ~/inotify-demo \u0026\u0026 cd inotify-demo # 建立测试文件夹 inotifywait -rmc -q . 在终端2中：\ncd ~/inotify-demo touch aa.txt 此时切换到终端1，可以看到事件输出：\n... ./,CREATE,aa.txt ./,OPEN,aa.txt ./,ATTRIB,aa.txt ./,\"CLOSE_WRITE,CLOSE\",aa.txt ./,\"OPEN,ISDIR\", ./,\"CLOSE_NOWRITE,CLOSE,ISDIR\", ./,OPEN,aa.txt ./,\"CLOSE_NOWRITE,CLOSE\",aa.txt 打开文件aa.txt，写入一行\ninotify-demo 可看到终端1中也已将事件打印出：\n... ./,CREATE,4913 ./,OPEN,4913 ./,ATTRIB,4913 ./,\"CLOSE_WRITE,CLOSE\",4913 ./,DELETE,4913 ./,MOVED_FROM,aa.txt ./,CREATE,aa.txt ./,OPEN,aa.txt ./,MODIFY,aa.txt ./,MODIFY,aa.txt ./,ATTRIB,aa.txt ./,\"CLOSE_WRITE,CLOSE\",aa.txt ./,ATTRIB,aa.txt ./,\"OPEN,ISDIR\", ./,\"CLOSE_NOWRITE,CLOSE,ISDIR\", 将所有的事件都打印出略显杂乱，这里我们只让其监听modify事件\ninotifywait -rmc -q -e modify . 创建文件bb.txt\ntouch bb.txt 可观察到，未有任何事件被打印。\n在bb.txt中写入一行inotify-demo\n可观察到事件打印：\n./,MODIFY,bb.txt ./,MODIFY,bb.txt 2.2 inotifywatch inotifywatch被用于收集文件系统使用信息\n其命令参数和inotifywait大致相同，可使用inotifywatch查看\n实验：\ncd ~/inotify-demo # 在30秒内监听crate,modify,delete三个事件，在30秒结束后打印统计信息 inotifywatch -v -e create -e modify -e delete -t 30 -r . 接下来30秒，创建了4个文件，修改了2个文件，删除了1个文件\n事件统计信息为:\nEstablishing watches... Setting up watch(es) on . OK, . is now being watched. Total of 1 watches. Finished establishing watches, now collecting statistics. Will listen for events for 30 seconds. total modify create delete filename 15 4 8 3 ./ TODO：统计信息与实际操作有所不符，目前不清楚为啥\n3. 使用golang调用inotify  https://github.com/fsnotify/fsnotify\n package main import ( \"log\" \"github.com/fsnotify/fsnotify\" ) func main() { watcher, err := fsnotify.NewWatcher() if err != nil { log.Fatal(err) } defer watcher.Close() done := make(chan bool) go func() { for { select { case event, ok := watcher.Events: if !ok { return } log.Println(\"event:\", event) if event.Op\u0026fsnotify.Write == fsnotify.Write { log.Println(\"modified file:\", event.Name) } case err, ok := watcher.Errors: if !ok { return } log.Println(\"error:\", err) } } }() err = watcher.Add(\"/tmp/foo\") if err != nil { log.Fatal(err) } done } References https://juejin.cn/post/6988561056364757022\nhttps://www.infoq.cn/article/inotify-linux-file-system-event-monitoring\nhttps://www.cnblogs.com/centos2017/p/7896715.html\n","wordCount":"438","inLanguage":"en","datePublished":"2022-07-04T00:00:00Z","dateModified":"2022-07-04T00:00:00Z","author":{"@type":"Person","name":"李昌"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://yangchnet.github.io/Dessert/posts/linux/inotify/"},"publisher":{"@type":"Organization","name":"Linote","logo":{"@type":"ImageObject","url":"https://raw.githubusercontent.com/lich-Img/blogImg/master/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><header class=header><nav class=nav><div class=logo><a href=http://yangchnet.github.io/Dessert accesskey=h title="Linote (Alt + H)">Linote</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=http://yangchnet.github.io/Dessert/archives/ title=存档><span>存档</span></a></li><li><a href=http://yangchnet.github.io/Dessert/categories/ title=分类><span>分类</span></a></li><li><a href=http://yangchnet.github.io/Dessert/search/ title=搜索><span>搜索</span></a></li><li><a href=http://yangchnet.github.io/Dessert/tags/ title=标签><span>标签</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://yangchnet.github.io/Dessert>Home</a>&nbsp;»&nbsp;<a href=http://yangchnet.github.io/Dessert/posts/>Posts</a></div><h1 class=post-title>inotify</h1><div class=post-meta><span title="2022-07-04 00:00:00 +0000 UTC">July 4, 2022</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;李昌</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#1-%e4%bb%80%e4%b9%88%e6%98%afinotify aria-label="1. 什么是inotify">1. 什么是inotify</a></li><li><a href=#2-%e5%ae%9e%e9%aa%8c aria-label="2. 实验">2. 实验</a><ul><li><a href=#21-inotifywait aria-label="2.1 inotifywait">2.1 inotifywait</a></li><li><a href=#22-inotifywatch aria-label="2.2 inotifywatch">2.2 inotifywatch</a></li></ul></li><li><a href=#3-%e4%bd%bf%e7%94%a8golang%e8%b0%83%e7%94%a8inotify aria-label="3. 使用golang调用inotify">3. 使用golang调用inotify</a></li><li><a href=#references aria-label=References>References</a></li></ul></div></details></div><div class=post-content><h2 id=1-什么是inotify>1. 什么是inotify<a hidden class=anchor aria-hidden=true href=#1-什么是inotify>#</a></h2><p>Inotify API提供了一种监视文件系统的机制事件。 Inotify可用于监视单个文件或监视目录。当监视目录时，Inotify将返回目录本身的事件，以及内部的文件目录。</p><p>简单的说，就是inotify可以为你监控文件系统的变化，在发生一些事件时通知你。</p><h2 id=2-实验>2. 实验<a hidden class=anchor aria-hidden=true href=#2-实验>#</a></h2><p>需要安装<code>inotify-tools</code>包</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#75715e># arch系统</span>
yay -S inotify-tools
</code></pre></div><p><code>inotify-tools</code>提供了两个命令：<code>inotifywait</code>和<code>inotifywatch</code></p><h3 id=21-inotifywait>2.1 inotifywait<a hidden class=anchor aria-hidden=true href=#21-inotifywait>#</a></h3><p>先来看<code>inotifywait</code>,它被用来"Wait for a particular event on a file or set of files.", 也就是说等待在文件上的某些事件发生。使用<code>inotifywait -h</code>查看其支持的参数：</p><pre><code>-h show this help info

--exclude &lt;pattern&gt; 排除匹配所给正则的所有事件

--excludei &lt;pattern&gt; 类似前一个命令但非敏感

--include &lt;pattern&gt; 排除除匹配正则之外的所有事件

--includei &lt;pattern&gt; 类似前一个命令但非敏感

-m|--monitor 在timeout之前保持监听，若不设置此标志，inotifywait将在一个事件后退出。

-d|--daemon 类似前一个命令但在后台运行，将日志输出到`--outfile`所指定的文件

-P|--no-dereference 不跟踪符号链接

-r|--recursive  递归的监听、

--fromfile &lt;file&gt; Read files to watch from &lt;file&gt; or `-' for stdin.

-o|--outfile &lt;file&gt; 输出到&lt;file&gt;而不是标准输出

-s|--syslog 向syslog发送错误而不是Stderr

-q|--quiet 只输出事件

-qq 啥也不输出

--format &lt;fmt&gt;  以特定格式输出

--no-newline 在格式化输出后不打印换行符

--timefmt &lt;fmt&gt; strftime-compatible format string for use with
                        %T in --format string.

-c|--csv 以csv格式输出

-t|--timeout &lt;seconds&gt; 当监听一个事件时，在&lt;seconds&gt;秒后超时

-e|--event &lt;event1&gt; 监听特定事件，若不设置，则监听所有事件

</code></pre><p>支持的event有：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>Events:
        access          file or directory contents were read
        modify          file or directory contents were written
        attrib          file or directory attributes changed
        close_write     file or directory closed, after being opened in
                        writable mode
        close_nowrite   file or directory closed, after being opened in
                        read-only mode
        close           file or directory closed, regardless of read/write mode
        open            file or directory opened
        moved_to        file or directory moved to watched directory
        moved_from      file or directory moved from watched directory
        move            file or directory moved to or from watched directory
        move_self               A watched file or directory was moved.
        create          file or directory created within watched directory
        delete          file or directory deleted within watched directory
        delete_self     file or directory was deleted
        unmount         file system containing file or directory unmounted
</code></pre></div><p>在终端1中：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>mkdir ~/inotify-demo <span style=color:#f92672>&amp;&amp;</span> cd inotify-demo <span style=color:#75715e># 建立测试文件夹</span>

inotifywait -rmc -q .
</code></pre></div><p>在终端2中：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>cd ~/inotify-demo

touch aa.txt

</code></pre></div><p>此时切换到终端1，可以看到事件输出：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>...
./,CREATE,aa.txt
./,OPEN,aa.txt
./,ATTRIB,aa.txt
./,<span style=color:#e6db74>&#34;CLOSE_WRITE,CLOSE&#34;</span>,aa.txt
./,<span style=color:#e6db74>&#34;OPEN,ISDIR&#34;</span>,
./,<span style=color:#e6db74>&#34;CLOSE_NOWRITE,CLOSE,ISDIR&#34;</span>,
./,OPEN,aa.txt
./,<span style=color:#e6db74>&#34;CLOSE_NOWRITE,CLOSE&#34;</span>,aa.txt
</code></pre></div><p>打开文件<code>aa.txt</code>，写入一行</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>inotify-demo
</code></pre></div><p>可看到终端1中也已将事件打印出：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>...
./,CREATE,4913
./,OPEN,4913
./,ATTRIB,4913
./,<span style=color:#e6db74>&#34;CLOSE_WRITE,CLOSE&#34;</span>,4913
./,DELETE,4913
./,MOVED_FROM,aa.txt
./,CREATE,aa.txt
./,OPEN,aa.txt
./,MODIFY,aa.txt
./,MODIFY,aa.txt
./,ATTRIB,aa.txt
./,<span style=color:#e6db74>&#34;CLOSE_WRITE,CLOSE&#34;</span>,aa.txt
./,ATTRIB,aa.txt
./,<span style=color:#e6db74>&#34;OPEN,ISDIR&#34;</span>,
./,<span style=color:#e6db74>&#34;CLOSE_NOWRITE,CLOSE,ISDIR&#34;</span>,
</code></pre></div><p>将所有的事件都打印出略显杂乱，这里我们只让其监听<code>modify</code>事件</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>inotifywait -rmc -q -e modify .
</code></pre></div><p>创建文件<code>bb.txt</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>touch bb.txt
</code></pre></div><p>可观察到，未有任何事件被打印。</p><p>在<code>bb.txt</code>中写入一行<code>inotify-demo</code></p><p>可观察到事件打印：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>./,MODIFY,bb.txt
./,MODIFY,bb.txt
</code></pre></div><h3 id=22-inotifywatch>2.2 inotifywatch<a hidden class=anchor aria-hidden=true href=#22-inotifywatch>#</a></h3><p>inotifywatch被用于收集文件系统使用信息</p><p>其命令参数和<code>inotifywait</code>大致相同，可使用<code>inotifywatch</code>查看</p><p>实验：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>cd ~/inotify-demo

<span style=color:#75715e># 在30秒内监听crate,modify,delete三个事件，在30秒结束后打印统计信息</span>
inotifywatch -v -e create -e modify -e delete -t <span style=color:#ae81ff>30</span> -r .
</code></pre></div><p>接下来30秒，创建了4个文件，修改了2个文件，删除了1个文件</p><p>事件统计信息为:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>Establishing watches...
Setting up watch<span style=color:#f92672>(</span>es<span style=color:#f92672>)</span> on .
OK, . is now being watched.
Total of <span style=color:#ae81ff>1</span> watches.
Finished establishing watches, now collecting statistics.
Will listen <span style=color:#66d9ef>for</span> events <span style=color:#66d9ef>for</span> <span style=color:#ae81ff>30</span> seconds.
total  modify  create  delete  filename
<span style=color:#ae81ff>15</span>     <span style=color:#ae81ff>4</span>       <span style=color:#ae81ff>8</span>       <span style=color:#ae81ff>3</span>       ./
</code></pre></div><p>TODO：统计信息与实际操作有所不符，目前不清楚为啥</p><h2 id=3-使用golang调用inotify>3. 使用golang调用inotify<a hidden class=anchor aria-hidden=true href=#3-使用golang调用inotify>#</a></h2><blockquote><p><a href=https://github.com/fsnotify/fsnotify>https://github.com/fsnotify/fsnotify</a></p></blockquote><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>

<span style=color:#f92672>import</span> (
	<span style=color:#e6db74>&#34;log&#34;</span>

	<span style=color:#e6db74>&#34;github.com/fsnotify/fsnotify&#34;</span>
)

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
	<span style=color:#a6e22e>watcher</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>fsnotify</span>.<span style=color:#a6e22e>NewWatcher</span>()
	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
		<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>err</span>)
	}
	<span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>watcher</span>.<span style=color:#a6e22e>Close</span>()

	<span style=color:#a6e22e>done</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>bool</span>)
	<span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>() {
		<span style=color:#66d9ef>for</span> {
			<span style=color:#66d9ef>select</span> {
			<span style=color:#66d9ef>case</span> <span style=color:#a6e22e>event</span>, <span style=color:#a6e22e>ok</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>watcher</span>.<span style=color:#a6e22e>Events</span>:
				<span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>ok</span> {
					<span style=color:#66d9ef>return</span>
				}
				<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;event:&#34;</span>, <span style=color:#a6e22e>event</span>)
				<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>Op</span><span style=color:#f92672>&amp;</span><span style=color:#a6e22e>fsnotify</span>.<span style=color:#a6e22e>Write</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>fsnotify</span>.<span style=color:#a6e22e>Write</span> {
					<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;modified file:&#34;</span>, <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>Name</span>)
				}
			<span style=color:#66d9ef>case</span> <span style=color:#a6e22e>err</span>, <span style=color:#a6e22e>ok</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>watcher</span>.<span style=color:#a6e22e>Errors</span>:
				<span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>ok</span> {
					<span style=color:#66d9ef>return</span>
				}
				<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;error:&#34;</span>, <span style=color:#a6e22e>err</span>)
			}
		}
	}()

	<span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>watcher</span>.<span style=color:#a6e22e>Add</span>(<span style=color:#e6db74>&#34;/tmp/foo&#34;</span>)
	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
		<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>err</span>)
	}
	<span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>done</span>
}
</code></pre></div><h2 id=references>References<a hidden class=anchor aria-hidden=true href=#references>#</a></h2><p><a href=https://juejin.cn/post/6988561056364757022>https://juejin.cn/post/6988561056364757022</a></p><p><a href=https://www.infoq.cn/article/inotify-linux-file-system-event-monitoring>https://www.infoq.cn/article/inotify-linux-file-system-event-monitoring</a></p><p><a href=https://www.cnblogs.com/centos2017/p/7896715.html>https://www.cnblogs.com/centos2017/p/7896715.html</a></p></div><footer class=post-footer><ul class=post-tags><li><a href=http://yangchnet.github.io/Dessert/tags/linux/>Linux</a></li></ul><nav class=paginav><a class=prev href=http://yangchnet.github.io/Dessert/posts/cache/%E6%A6%82%E8%A7%88redis%E7%AF%87%E4%B8%80%E5%8D%95%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B/><span class=title>« Prev Page</span><br><span>概览Redis篇一：单线程模型</span></a>
<a class=next href=http://yangchnet.github.io/Dessert/posts/%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%A6%82%E8%A7%88mysql%E7%AF%87mysql%E6%9E%B6%E6%9E%84/><span class=title>Next Page »</span><br><span>概览MySQL篇〇：MySQL架构</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=http://yangchnet.github.io/Dessert>Linote</a></span>
<script src=https://utteranc.es/client.js repo=yangchnet/Dessert issue-term=pathname theme=github-light crossorigin=anonymous async></script><span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script></body></html>